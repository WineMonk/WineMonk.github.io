<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ArcGIS Pro SDK 地理数据库 | WineMonk</title><meta name="keywords" content="CSharp,ArcGIS Pro SDK"><meta name="author" content="shaozhy,1361151272@qq.com"><meta name="copyright" content="shaozhy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="地理数据库地理数据库和数据存储打开给定路径的文件地理数据库123456789101112131415161718192021public async Task OpenFileGDB()&amp;#123;  try  &amp;#123;    await ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() &#x3D;&gt;    &amp;#123;">
<meta property="og:type" content="article">
<meta property="og:title" content="ArcGIS Pro SDK 地理数据库">
<meta property="og:url" content="https://shaoshao.net.cn/2022/12/28/20221228135207000/index.html">
<meta property="og:site_name" content="WineMonk">
<meta property="og:description" content="地理数据库地理数据库和数据存储打开给定路径的文件地理数据库123456789101112131415161718192021public async Task OpenFileGDB()&amp;#123;  try  &amp;#123;    await ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() &#x3D;&gt;    &amp;#123;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg">
<meta property="article:published_time" content="2022-12-28T05:52:07.000Z">
<meta property="article:modified_time" content="2023-04-14T01:28:34.000Z">
<meta property="article:author" content="shaozhy">
<meta property="article:tag" content="CSharp">
<meta property="article:tag" content="ArcGIS Pro SDK">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg"><link rel="shortcut icon" href="/cover/head_portrait.jpg"><link rel="canonical" href="https://shaoshao.net.cn/2022/12/28/20221228135207000/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ArcGIS Pro SDK 地理数据库',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-14 09:28:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://shaoshao.net.cn/images/blog/cover/headportrait/shsh_cn.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/discover/archives/"><div class="headline">文章</div><div class="length-num">165</div></a></div><div class="data-item"><a href="/discover/tags/"><div class="headline">标签</div><div class="length-num">106</div></a></div><div class="data-item"><a href="/discover/categories/"><div class="headline">分类</div><div class="length-num">79</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">WineMonk</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ArcGIS Pro SDK 地理数据库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-28T05:52:07.000Z" title="发表于 2022-12-28 13:52:07">2022-12-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-14T01:28:34.000Z" title="更新于 2023-04-14 09:28:34">2023-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/">GIS相关</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>84分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ArcGIS Pro SDK 地理数据库"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="地理数据库"><a href="#地理数据库" class="headerlink" title="地理数据库"></a>地理数据库</h1><h2 id="地理数据库和数据存储"><a href="#地理数据库和数据存储" class="headerlink" title="地理数据库和数据存储"></a>地理数据库和数据存储</h2><h3 id="打开给定路径的文件地理数据库"><a href="#打开给定路径的文件地理数据库" class="headerlink" title="打开给定路径的文件地理数据库"></a>打开给定路径的文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenFileGDB</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Opens a file geodatabase. This will open the geodatabase if the folder exists and contains a valid geodatabase.</span></span><br><span class="line">      <span class="keyword">using</span> (</span><br><span class="line">        Geodatabase geodatabase =</span><br><span class="line">          <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the geodatabase.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (GeodatabaseNotFoundOrOpenedException exception)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Handle Exception.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用连接属性打开企业级地理数据库"><a href="#使用连接属性打开企业级地理数据库" class="headerlink" title="使用连接属性打开企业级地理数据库"></a>使用连接属性打开企业级地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenEnterpriseGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Opening a Non-Versioned SQL Server instance.</span></span><br><span class="line">    DatabaseConnectionProperties connectionProperties = <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Where testMachine is the machine where the instance is running and testInstance is the name of the SqlServer instance.</span></span><br><span class="line">      Instance = <span class="string">@&quot;testMachine\testInstance&quot;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Provided that a database called LocalGovernment has been created on the testInstance and geodatabase has been enabled on the database.</span></span><br><span class="line">      Database = <span class="string">&quot;LocalGovernment&quot;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Provided that a login called gdb has been created and corresponding schema has been created with the required permissions.</span></span><br><span class="line">      User = <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;dbo.DEFAULT&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(connectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Use the geodatabase</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-sde-文件路径打开企业级地理数据库"><a href="#使用-sde-文件路径打开企业级地理数据库" class="headerlink" title="使用 sde 文件路径打开企业级地理数据库"></a>使用 sde 文件路径打开企业级地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenEnterpriseGeodatabaseUsingSDEFilePath</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Use the geodatabase.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从工程项获取地理数据库"><a href="#从工程项获取地理数据库" class="headerlink" title="从工程项获取地理数据库"></a>从工程项获取地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingGeodatabaseFromProjectItem</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  IEnumerable&lt;GDBProjectItem&gt; gdbProjectItems = Project.Current.GetItems&lt;GDBProjectItem&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (GDBProjectItem gdbProjectItem <span class="keyword">in</span> gdbProjectItems)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Datastore datastore = gdbProjectItem.GetDatastore())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Unsupported datastores (non File GDB and non Enterprise GDB) will be of type UnknownDatastore</span></span><br><span class="line">        <span class="keyword">if</span> (datastore <span class="keyword">is</span> UnknownDatastore)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        Geodatabase geodatabase = datastore <span class="keyword">as</span> Geodatabase;</span><br><span class="line">        <span class="comment">// Use the geodatabase.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从连接文件获取数据库连接属性"><a href="#从连接文件获取数据库连接属性" class="headerlink" title="从连接文件获取数据库连接属性"></a>从连接文件获取数据库连接属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DatabaseConnectionFile connectionFile = <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>));</span><br><span class="line">DatabaseConnectionProperties connectionProperties = DatabaseClient.GetDatabaseConnectionProperties(connectionFile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now you could, for example, change the user name and password in the connection properties prior to use them to open a geodatabase</span></span><br></pre></td></tr></table></figure>

<h3 id="从要素图层获取地理数据库"><a href="#从要素图层获取地理数据库" class="headerlink" title="从要素图层获取地理数据库"></a>从要素图层获取地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingGeodatabaseFromFeatureLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  IEnumerable&lt;Layer&gt; layers = MapView.Active.Map.Layers.Where(layer =&gt; layer <span class="keyword">is</span> FeatureLayer);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (FeatureLayer featureLayer <span class="keyword">in</span> layers)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Table table = featureLayer.GetTable())</span><br><span class="line">      <span class="keyword">using</span> (Datastore datastore = table.GetDatastore())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (datastore <span class="keyword">is</span> UnknownDatastore)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        Geodatabase geodatabase = datastore <span class="keyword">as</span> Geodatabase;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行-SQL-语句"><a href="#执行-SQL-语句" class="headerlink" title="执行 SQL 语句"></a>执行 SQL 语句</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Executes raw SQL on the underlying database management system.</span></span><br><span class="line"><span class="comment">//  Any SQL is permitted (DDL or DML), but no results can be returned</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExecuteSQLOnGeodatabase</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> statement</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseClient.ExecuteStatement(geodatabase, statement);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="从地理数据库获取定义"><a href="#从地理数据库获取定义" class="headerlink" title="从地理数据库获取定义"></a>从地理数据库获取定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingDefinitionFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Remember that for Enterprise databases you have to qualify your dataset names with the DatabaseName and UserName.</span></span><br><span class="line">      TableDefinition enterpriseTableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.CitizenContactInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// It does not matter if the dataset is within a FeatureDataset or not.</span></span><br><span class="line">      FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.FireStation&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// GetDefinition For a RelationshipClass.</span></span><br><span class="line">      RelationshipClassDefinition relationshipClassDefinition = geodatabase.GetDefinition&lt;RelationshipClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// GetDefinition For a FeatureDataset.</span></span><br><span class="line">      FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地理数据库获取定义列表"><a href="#从地理数据库获取定义列表" class="headerlink" title="从地理数据库获取定义列表"></a>从地理数据库获取定义列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingDefinitionsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> enterpriseDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;FeatureClassDefinition&gt;();</span><br><span class="line">      IEnumerable&lt;Definition&gt; featureClassesHavingGlobalID = </span><br><span class="line">        enterpriseDefinitions.Where(definition =&gt; definition.HasGlobalID());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> featureDatasetDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;FeatureDatasetDefinition&gt;();</span><br><span class="line">      <span class="built_in">bool</span> electionRelatedFeatureDatasets = </span><br><span class="line">        featureDatasetDefinitions.Any(</span><br><span class="line">          definition =&gt; definition.GetName().Contains(<span class="string">&quot;Election&quot;</span>));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> attributedRelationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;AttributedRelationshipClassDefinition&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> relationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;RelationshipClassDefinition&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地理数据库获取相关定义"><a href="#从地理数据库获取相关定义" class="headerlink" title="从地理数据库获取相关定义"></a>从地理数据库获取相关定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingRelatedDefinitionsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Remember the qualification of DatabaseName. for the RelationshipClass.</span></span><br><span class="line"></span><br><span class="line">      RelationshipClassDefinition enterpriseDefinition = </span><br><span class="line">      geodatabase.GetDefinition&lt;RelationshipClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>);</span><br><span class="line">      IReadOnlyList&lt;Definition&gt; enterpriseDefinitions = </span><br><span class="line">      geodatabase.GetRelatedDefinitions(enterpriseDefinition, DefinitionRelationshipType.DatasetsRelatedThrough);</span><br><span class="line">      FeatureClassDefinition enterpriseAddressPointDefinition = </span><br><span class="line">      enterpriseDefinitions.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>)) <span class="keyword">as</span> FeatureClassDefinition;</span><br><span class="line"></span><br><span class="line">      FeatureDatasetDefinition featureDatasetDefinition = </span><br><span class="line">        geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>);</span><br><span class="line">      IReadOnlyList&lt;Definition&gt; datasetsInAddressDataset = </span><br><span class="line">        geodatabase.GetRelatedDefinitions(featureDatasetDefinition, DefinitionRelationshipType.DatasetInFeatureDataset);</span><br><span class="line">      FeatureClassDefinition addressPointInAddressDataset = </span><br><span class="line">        datasetsInAddressDataset.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>)) <span class="keyword">as</span> FeatureClassDefinition;</span><br><span class="line"></span><br><span class="line">      RelationshipClassDefinition addressPointHasSiteAddressInAddressDataset = datasetsInAddressDataset.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>)) <span class="keyword">as</span> RelationshipClassDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从层获取表定义"><a href="#从层获取表定义" class="headerlink" title="从层获取表定义"></a>从层获取表定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetDefinitionFromLayer - This code works even if the layer has a join to another table</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> TableDefinition <span class="title">GetDefinitionFromLayer</span>(<span class="params">FeatureLayer featureLayer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get feature class from the layer</span></span><br><span class="line">  FeatureClass featureClass = featureLayer.GetFeatureClass();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Determine if feature class is a join</span></span><br><span class="line">  <span class="keyword">if</span> (featureClass.IsJoinedTable())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get join from feature class</span></span><br><span class="line">    Join <span class="keyword">join</span> = featureClass.GetJoin();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get origin table from join</span></span><br><span class="line">    Table originTable = <span class="keyword">join</span>.GetOriginTable();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return feature class definition from the join&#x27;s origin table</span></span><br><span class="line">    <span class="keyword">return</span> originTable.GetDefinition();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> featureClass.GetDefinition();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h2><h3 id="从地理数据库打开数据集"><a href="#从地理数据库打开数据集" class="headerlink" title="从地理数据库打开数据集"></a>从地理数据库打开数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpeningDatasetsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Table table = </span><br><span class="line">      geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.EmployeeInfo&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a featureClass (within a feature dataset or outside a feature dataset).</span></span><br><span class="line">      <span class="keyword">using</span> (FeatureClass featureClass = </span><br><span class="line">      geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// You can open a FeatureClass as a Table which will give you a Table Reference.</span></span><br><span class="line">      <span class="keyword">using</span> (Table featureClassAsTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// But it is really a FeatureClass object.</span></span><br><span class="line">        FeatureClass featureClassOpenedAsTable = featureClassAsTable <span class="keyword">as</span> FeatureClass;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a FeatureDataset.</span></span><br><span class="line">      <span class="keyword">using</span> (FeatureDataset featureDataset = geodatabase.OpenDataset&lt;FeatureDataset&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a RelationsipClass.  Just as you can open a FeatureClass as a Table, you can also open an AttributedRelationshipClass as a RelationshipClass.</span></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查表是否存在"><a href="#检查表是否存在" class="headerlink" title="检查表是否存在"></a>检查表是否存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run9)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">TableExists</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> tableName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableName);</span><br><span class="line">    tableDefinition.Dispose();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// GetDefinition throws an exception if the definition doesn&#x27;t exist</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查要素类是否存在"><a href="#检查要素类是否存在" class="headerlink" title="检查要素类是否存在"></a>检查要素类是否存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">FeatureClassExists</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> featureClassName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">    featureClassDefinition.Dispose();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// GetDefinition throws an exception if the definition doesn&#x27;t exist</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开关系两个表之间的类"><a href="#打开关系两个表之间的类" class="headerlink" title="打开关系两个表之间的类"></a>打开关系两个表之间的类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run().  </span></span><br><span class="line"><span class="comment">// When used with file or enterprise geodatabases, this routine takes two table names.</span></span><br><span class="line"><span class="comment">// When used with feature services, this routine takes layer IDs, or the names of the tables as they are exposed through the service (e.g., &quot;L0States&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IReadOnlyList&lt;RelationshipClass&gt; <span class="title">OpenRelationshipClassFeatureServices</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> originClass, <span class="built_in">string</span> destinationClass</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> geodatabase.OpenRelationshipClasses(originClass, destinationClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从关系类获取相关要素类"><a href="#从关系类获取相关要素类" class="headerlink" title="从关系类获取相关要素类"></a>从关系类获取相关要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">GetFeatureClassesInRelationshipClassAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      IReadOnlyList&lt;RelationshipClassDefinition&gt; relationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;RelationshipClassDefinition&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> relationshipClassDefinition <span class="keyword">in</span> relationshipClassDefinitions)</span><br><span class="line">      &#123;</span><br><span class="line">        IReadOnlyList&lt;Definition&gt; definitions = </span><br><span class="line">          geodatabase.GetRelatedDefinitions(relationshipClassDefinition,</span><br><span class="line">            DefinitionRelationshipType.DatasetsRelatedThrough);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> definition <span class="keyword">in</span> definitions)</span><br><span class="line">        &#123;</span><br><span class="line">          System.Diagnostics.Debug.WriteLine(</span><br><span class="line">            <span class="string">$&quot;Feature class in the RelationshipClass is:<span class="subst">&#123;definition.GetName()&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从-shapefile-数据存储打开要素类"><a href="#从-shapefile-数据存储打开要素类" class="headerlink" title="从 shapefile 数据存储打开要素类"></a>从 shapefile 数据存储打开要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenShapefileFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fileConnection = <span class="keyword">new</span> FileSystemConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\folder\\containing\\shapefiles&quot;</span>), FileSystemDatastoreType.Shapefile);</span><br><span class="line">    <span class="keyword">using</span> (FileSystemDatastore shapefile = <span class="keyword">new</span> FileSystemDatastore(fileConnection))</span><br><span class="line">    &#123;</span><br><span class="line">      FeatureClass taxLotsFeatureClass = shapefile.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;TaxLots&quot;</span>);</span><br><span class="line">      FeatureClass manHolesFeatureClass = shapefile.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;ManHoles.shp&quot;</span>); <span class="comment">// Can use the .shp extension, but its not needed.</span></span><br><span class="line">      Table taxDetailsTableWithoutExtension = shapefile.OpenDataset&lt;Table&gt;(<span class="string">&quot;TaxDetails&quot;</span>);</span><br><span class="line">      Table taxDetailsTable = shapefile.OpenDataset&lt;Table&gt;(<span class="string">&quot;TaxDetails.dbf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开-CAD-数据存储"><a href="#打开-CAD-数据存储" class="headerlink" title="打开 CAD 数据存储"></a>打开 CAD 数据存储</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenCADFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fileConnection = <span class="keyword">new</span> FileSystemConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\folder\\containing\\CAD&quot;</span>), FileSystemDatastoreType.Cad);</span><br><span class="line">    <span class="keyword">using</span> (FileSystemDatastore cadDatastore = <span class="keyword">new</span> FileSystemDatastore(fileConnection))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// note - extension is required</span></span><br><span class="line">      <span class="keyword">var</span> cadDataset = cadDatastore.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;hatchplayboundaries.dwg&quot;</span>);</span><br><span class="line">      <span class="comment">// take note of the pattern for referencing a feature class. </span></span><br><span class="line">      <span class="keyword">var</span> cadfeatureClass = cadDatastore.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;hatchplayboundaries.dwg:Polyline&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">int</span> numRows = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> cursor = cadfeatureClass.Search())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">          numRows++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="使用查询筛选器搜索表"><a href="#使用查询筛选器搜索表" class="headerlink" title="使用查询筛选器搜索表"></a>使用查询筛选器搜索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SearchingATable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">      <span class="keyword">using</span> (Table table = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;EmployeeInfo&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line"></span><br><span class="line">        QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter</span><br><span class="line">        &#123;</span><br><span class="line">          WhereClause = <span class="string">&quot;COSTCTRN = &#x27;Information Technology&#x27;&quot;</span>,</span><br><span class="line">          SubFields = <span class="string">&quot;KNOWNAS, OFFICE, LOCATION&quot;</span>,</span><br><span class="line">          PostfixClause = <span class="string">&quot;ORDER BY OFFICE&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = table.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">string</span> location = Convert.ToString(row[<span class="string">&quot;LOCATION&quot;</span>]);</span><br><span class="line">              <span class="built_in">string</span> knownAs = Convert.ToString(row[<span class="string">&quot;KNOWNAS&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (GeodatabaseFieldException fieldException)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// One of the fields in the where clause might not exist. There are multiple ways this can be handled:</span></span><br><span class="line">    <span class="comment">// Handle error appropriately</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// logger.Error(exception.Message);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在表中搜索非拉丁字符"><a href="#在表中搜索非拉丁字符" class="headerlink" title="在表中搜索非拉丁字符"></a>在表中搜索非拉丁字符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line"><span class="keyword">using</span> (Table table = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;TableWithChineseCharacters&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// This will fail with many database systems that expect Latin characters by default</span></span><br><span class="line">  <span class="built_in">string</span> incorrectWhereClause = <span class="string">&quot;颜色 = &#x27;绿&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Correct solution is to prepend the &#x27;National String Prefix&#x27; to the attribute value</span></span><br><span class="line">  <span class="comment">// For example, with SQL Server this value is &#x27;N&#x27;</span></span><br><span class="line">  <span class="comment">// This value is obtained using the SQLSyntax class</span></span><br><span class="line">  <span class="built_in">string</span> nationalStringPrefix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  SQLSyntax sqlSyntax = geodatabase.GetSQLSyntax();</span><br><span class="line">  nationalStringPrefix = sqlSyntax.GetSupportedStrings(SQLStringType.NationalStringPrefix).First();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This Where clause will work</span></span><br><span class="line">  QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    WhereClause = <span class="string">&quot;颜色 = &quot;</span> + nationalStringPrefix + <span class="string">&quot;&#x27;绿&#x27;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用一组对象-ID-搜索表"><a href="#使用一组对象-ID-搜索表" class="headerlink" title="使用一组对象 ID 搜索表"></a>使用一组对象 ID 搜索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RowCursor <span class="title">SearchingATable</span>(<span class="params">Table table, IReadOnlyList&lt;<span class="built_in">long</span>&gt; objectIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    ObjectIDs = objectIDs</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> table.Search(queryFilter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用空间查询过滤器搜索要素类"><a href="#使用空间查询过滤器搜索要素类" class="headerlink" title="使用空间查询过滤器搜索要素类"></a>使用空间查询过滤器搜索要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SearchingAFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass schoolBoundaryFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.SchoolBoundary&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Using a spatial query filter to find all features which have a certain district name and lying within a given Polygon.</span></span><br><span class="line">      SpatialQueryFilter spatialQueryFilter = <span class="keyword">new</span> SpatialQueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;DISTRCTNAME = &#x27;Indian Prairie School District 204&#x27;&quot;</span>,</span><br><span class="line">        FilterGeometry = <span class="keyword">new</span> PolygonBuilderEx(<span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1021880</span>, <span class="number">1867396</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1028223</span>, <span class="number">1870705</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1031165</span>, <span class="number">1866844</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1025373</span>, <span class="number">1860501</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1021788</span>, <span class="number">1863810</span>)</span><br><span class="line">        &#125;).ToGeometry(),</span><br><span class="line"></span><br><span class="line">        SpatialRelationship = SpatialRelationship.Within</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor indianPrairieCursor = schoolBoundaryFeatureClass.Search(spatialQueryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (indianPrairieCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Feature feature = (Feature)indianPrairieCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Process the feature. For example...</span></span><br><span class="line">            Console.WriteLine(feature.GetObjectID());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从表中选择行"><a href="#从表中选择行" class="headerlink" title="从表中选择行"></a>从表中选择行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SelectingRowsFromATable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter anotherQueryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;FLOOR = 1 AND WING = &#x27;E&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// For Selecting all matching entries.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection anotherSelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to get one record which matches the criteria. No assumptions can be made about which record satisfying the criteria is selected.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection onlyOneSelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.OnlyOne))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to obtain a empty selction which can be used as a container to combine results from different selections.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection emptySelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If you want to select all the records in a table.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection allRecordSelection = enterpriseTable.Select(<span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从要素类中选择要素"><a href="#从要素类中选择要素" class="headerlink" title="从要素类中选择要素"></a>从要素类中选择要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SelectingFeaturesFromAFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      SpatialQueryFilter spatialFilter = <span class="keyword">new</span> SpatialQueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;FCODE = &#x27;Park&#x27;&quot;</span>,</span><br><span class="line">        FilterGeometry = <span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry(),</span><br><span class="line">        SpatialRelationship = SpatialRelationship.Crosses</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// For Selecting all matching entries.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection anotherSelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to get one record which matches the criteria. No assumptions can be made about which record satisfying the </span></span><br><span class="line">      <span class="comment">// criteria is selected.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection onlyOneSelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.OnlyOne))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to obtain a empty selction which can be used as a container to combine results from different selections.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection emptySelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If you want to select all the records in a table.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection allRecordSelection = enterpriseFeatureClass.Select(<span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取表中当前有多少行的计数"><a href="#获取表中当前有多少行的计数" class="headerlink" title="获取表中当前有多少行的计数"></a>获取表中当前有多少行的计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> table = featureLayer.GetTable();</span><br><span class="line"><span class="keyword">var</span> count = table.GetCount();</span><br></pre></td></tr></table></figure>

<h3 id="获取图层的特征计数"><a href="#获取图层的特征计数" class="headerlink" title="获取图层的特征计数"></a>获取图层的特征计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  FeatureClass featureClass = lyr.GetFeatureClass();</span><br><span class="line">  <span class="built_in">long</span> nCount = featureClass.GetCount();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="对表进行排序"><a href="#对表进行排序" class="headerlink" title="对表进行排序"></a>对表进行排序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RowCursor <span class="title">SortWorldCities</span>(<span class="params">FeatureClass worldCitiesTable</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = worldCitiesTable.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    Field countryField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;COUNTRY_NAME&quot;</span>));</span><br><span class="line">    Field cityNameField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;CITY_NAME&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create SortDescription for Country field</span></span><br><span class="line">    SortDescription countrySortDescription = <span class="keyword">new</span> SortDescription(countryField);</span><br><span class="line">    countrySortDescription.CaseSensitivity = CaseSensitivity.Insensitive;</span><br><span class="line">    countrySortDescription.SortOrder = SortOrder.Ascending;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create SortDescription for City field</span></span><br><span class="line">    SortDescription citySortDescription = <span class="keyword">new</span> SortDescription(cityNameField);</span><br><span class="line">    citySortDescription.CaseSensitivity = CaseSensitivity.Insensitive;</span><br><span class="line">    citySortDescription.SortOrder = SortOrder.Ascending;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create our TableSortDescription</span></span><br><span class="line">    TableSortDescription tableSortDescription = <span class="keyword">new</span> TableSortDescription(</span><br><span class="line">      <span class="keyword">new</span> List&lt;SortDescription&gt;() &#123; countrySortDescription, citySortDescription &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> worldCitiesTable.Sort(tableSortDescription);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="计算表的统计信息"><a href="#计算表的统计信息" class="headerlink" title="计算表的统计信息"></a>计算表的统计信息</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calculate the Sum and Average of the Population_1990 and Population_2000 fields, grouped and ordered by Region</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CalculateStatistics</span>(<span class="params">FeatureClass countryFeatureClass</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = </span><br><span class="line">    countryFeatureClass.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get fields</span></span><br><span class="line">    Field regionField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Region&quot;</span>));</span><br><span class="line">    Field pop1990Field = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Population_1990&quot;</span>));</span><br><span class="line">    Field pop2000Field = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Population_2000&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create StatisticsDescriptions</span></span><br><span class="line">    StatisticsDescription pop1990StatisticsDescription = </span><br><span class="line">      <span class="keyword">new</span> StatisticsDescription(pop1990Field, </span><br><span class="line">              <span class="keyword">new</span> List&lt;StatisticsFunction&gt;() &#123; StatisticsFunction.Sum, </span><br><span class="line">                                                StatisticsFunction.Average &#125;);</span><br><span class="line">    StatisticsDescription pop2000StatisticsDescription = </span><br><span class="line">      <span class="keyword">new</span> StatisticsDescription(pop2000Field, </span><br><span class="line">              <span class="keyword">new</span> List&lt;StatisticsFunction&gt;() &#123; StatisticsFunction.Sum, </span><br><span class="line">                                                StatisticsFunction.Average &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create TableStatisticsDescription</span></span><br><span class="line">    TableStatisticsDescription tableStatisticsDescription = </span><br><span class="line">        <span class="keyword">new</span> TableStatisticsDescription(<span class="keyword">new</span> List&lt;StatisticsDescription&gt;() &#123; </span><br><span class="line">                  pop1990StatisticsDescription, pop2000StatisticsDescription &#125;);</span><br><span class="line">    tableStatisticsDescription.GroupBy = <span class="keyword">new</span> List&lt;Field&gt;() &#123; regionField &#125;;</span><br><span class="line">    tableStatisticsDescription.OrderBy = </span><br><span class="line">      <span class="keyword">new</span> List&lt;SortDescription&gt;() &#123; <span class="keyword">new</span> SortDescription(regionField) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calculate Statistics</span></span><br><span class="line">    IReadOnlyList&lt;TableStatisticsResult&gt; tableStatisticsResults = </span><br><span class="line">      countryFeatureClass.CalculateStatistics(tableStatisticsDescription);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (TableStatisticsResult tableStatisticsResult <span class="keyword">in</span> tableStatisticsResults)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Get the Region name</span></span><br><span class="line">      <span class="comment">// If multiple fields had been passed into TableStatisticsDescription.GroupBy, there would be multiple values in TableStatisticsResult.GroupBy</span></span><br><span class="line">      <span class="built_in">string</span> regionName = tableStatisticsResult.GroupBy.First().Value.ToString();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the statistics results for the Population_1990 field</span></span><br><span class="line">      StatisticsResult pop1990Statistics = tableStatisticsResult.StatisticsResults[<span class="number">0</span>];</span><br><span class="line">      <span class="built_in">double</span> population1990Sum = pop1990Statistics.Sum;</span><br><span class="line">      <span class="built_in">double</span> population1990Average = pop1990Statistics.Average;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the statistics results for the Population_2000 field</span></span><br><span class="line">      StatisticsResult pop2000Statistics = tableStatisticsResult.StatisticsResults[<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">double</span> population2000Sum = pop2000Statistics.Sum;</span><br><span class="line">      <span class="built_in">double</span> population2000Average = pop2000Statistics.Average;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Do something with the results here...</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在单个表上评估-QueryDef"><a href="#在单个表上评估-QueryDef" class="headerlink" title="在单个表上评估 QueryDef"></a>在单个表上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SimpleQueryDef</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef adaCompilantParksQueryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;Park&quot;</span>,</span><br><span class="line">        WhereClause = <span class="string">&quot;ADACOMPLY = &#x27;Yes&#x27;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(adaCompilantParksQueryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            String type = Convert.ToString(row[<span class="string">&quot;ADACOMPLY&quot;</span>]); <span class="comment">// will be &quot;Yes&quot; for each row.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">              Table table = row.GetTable(); <span class="comment">// Will always throw exception.</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (NotSupportedException exception)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// Handle not supported exception.</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-WHERE-子句计算连接上的-QueryDef"><a href="#使用-WHERE-子句计算连接上的-QueryDef" class="headerlink" title="使用 WHERE 子句计算连接上的 QueryDef"></a>使用 WHERE 子句计算连接上的 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoiningWithWhereQueryDef</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef municipalEmergencyFacilitiesQueryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        SubFields = <span class="string">&quot;EmergencyFacility.OBJECTID, EmergencyFacility.Shape, EmergencyFacility.FACILITYID, FacilitySite.FACILITYID, FacilitySite.FCODE&quot;</span>,</span><br><span class="line">        Tables = <span class="string">&quot;EmergencyFacility, FacilitySite&quot;</span>,</span><br><span class="line">        WhereClause = <span class="string">&quot;EmergencyFacility.FACNAME = FacilitySite.NAME AND EmergencyFacility.JURISDICT = &#x27;Municipal&#x27;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(municipalEmergencyFacilitiesQueryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">long</span> objectID = Convert.ToInt64(row[<span class="string">&quot;EmergencyFacility.OBJECTID&quot;</span>]);</span><br><span class="line">            String featureCode = Convert.ToString(row[<span class="string">&quot;FacilitySite.FCODE&quot;</span>]);</span><br><span class="line"></span><br><span class="line">            IReadOnlyList&lt;Field&gt; fields = feature.GetFields(); <span class="comment">//Contains one ArcGIS.Core.Data.Field objects for every subfield</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在外部连接上计算-QueryDef"><a href="#在外部连接上计算-QueryDef" class="headerlink" title="在外部连接上计算 QueryDef"></a>在外部连接上计算 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithOuterJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDefWithLeftOuterJoin = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;CommunityAddress LEFT OUTER JOIN MunicipalBoundary on CommunityAddress.Municipality = MunicipalBoundary.Name&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;CommunityAddress.OBJECTID, CommunityAddress.Shape, CommunityAddress.SITEADDID, CommunityAddress.ADDRNUM, CommunityAddress.FULLNAME, CommunityAddress.FULLADDR, CommunityAddress.MUNICIPALITY, MunicipalBoundary.Name, MunicipalBoundary.MUNITYP, MunicipalBoundary.LOCALFIPS&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(queryDefWithLeftOuterJoin, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> siteAddressId = Convert.ToInt32(row[<span class="string">&quot;CommunityAddress.SITEADDID&quot;</span>]);</span><br><span class="line">            String stateName = Convert.ToString(row[<span class="string">&quot;MunicipalBoundary.name&quot;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在内部连接上评估-QueryDef"><a href="#在内部连接上评估-QueryDef" class="headerlink" title="在内部连接上评估 QueryDef"></a>在内部连接上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithInnerJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDef = <span class="keyword">new</span> QueryDef()</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;People INNER JOIN States ON People.FK_STATE_ID = States.OBJECTID&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;People.OBJECTID, People.First_Name, People.Last_Name, People.City, States.State_Name&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = geodatabase.Evaluate(queryDef))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Handle row</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在嵌套-INNER-和-OUTER-连接上评估-QueryDef"><a href="#在嵌套-INNER-和-OUTER-连接上评估-QueryDef" class="headerlink" title="在嵌套 - INNER 和 OUTER 连接上评估 QueryDef"></a>在嵌套 - INNER 和 OUTER 连接上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithNestedJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDef = <span class="keyword">new</span> QueryDef()</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;((People INNER JOIN States ON People.FK_STATE_ID = States.OBJECTID) LEFT OUTER JOIN Homes ON People.OBJECTID = Homes.FK_People_ID)&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;People.OBJECTID, People.First_Name, People.Last_Name, States.State_Name, Homes.Address&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = geodatabase.Evaluate(queryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Handle row</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为数据库表创建默认查询描述并获取查询描述的-ArcGIS-Core-Data-Table"><a href="#为数据库表创建默认查询描述并获取查询描述的-ArcGIS-Core-Data-Table" class="headerlink" title="为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table"></a>为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DefaultQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;CUSTOMERS&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use table</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从数据库表的自定义查询创建查询说明"><a href="#从数据库表的自定义查询创建查询说明" class="headerlink" title="从数据库表的自定义查询创建查询说明"></a>从数据库表的自定义查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CustomQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;SELECT OBJECTID, Shape, FACILITYID FROM EmergencyFacility WHERE JURISDICT = &#x27;Municipal&#x27;&quot;</span>, <span class="string">&quot;MunicipalEmergencyFacilities&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the table.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从没有不可为空的唯一-id-列的联接查询创建查询说明"><a href="#从没有不可为空的唯一-id-列的联接查询创建查询说明" class="headerlink" title="从没有不可为空的唯一 id 列的联接查询创建查询说明"></a>从没有不可为空的唯一 id 列的联接查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoinQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;SELECT BUSLINES.ID as BUSLINESID, BUSSTOPS.ID as BUSSTOPSID, BUSLINES.RTE_DESC, BUSLINES.DIR, BUSSTOPS.JURISDIC, BUSSTOPS.LOCATION, BUSSTOPS.ROUTE,BUSSTOPS.SHAPE from demosql.dbo.BUSSTOPS JOIN demosql.dbo.BUSLINES ON BUSSTOPS.ROUTE = BUSLINES.ROUTE&quot;</span>, <span class="string">&quot;BusInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      queryDescription.SetObjectIDFields(<span class="string">&quot;BUSLINESID,BUSSTOPSID&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the table.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从具有多个形状类型的数据库表的查询创建查询说明"><a href="#从具有多个形状类型的数据库表的查询创建查询说明" class="headerlink" title="从具有多个形状类型的数据库表的查询创建查询说明"></a>从具有多个形状类型的数据库表的查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">MultiGeometryQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription pointQueryDescription = database.GetQueryDescription(<span class="string">&quot;select Description, SHAPE, UniqueID from MULTIGEOMETRYTEST&quot;</span>, <span class="string">&quot;MultiGeometryPoint&quot;</span>);</span><br><span class="line">      pointQueryDescription.SetShapeType(GeometryType.Point);</span><br><span class="line">      <span class="keyword">using</span> (Table pointTable = database.OpenTable(pointQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use pointTable</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      QueryDescription polygonQueryDescription = database.GetQueryDescription(<span class="string">&quot;select Description, SHAPE, UniqueID from MULTIGEOMETRYTEST&quot;</span>, <span class="string">&quot;MultiGeometryPolygon&quot;</span>);</span><br><span class="line">      polygonQueryDescription.SetShapeType(GeometryType.Polygon);</span><br><span class="line">      <span class="keyword">using</span> (Table polygonTable = database.OpenTable(polygonQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use polygonTable</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从-SQLite-数据库表的查询创建查询说明"><a href="#从-SQLite-数据库表的查询创建查询说明" class="headerlink" title="从 SQLite 数据库表的查询创建查询说明"></a>从 SQLite 数据库表的查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SqliteQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(<span class="keyword">new</span> SQLiteConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path\\To\\Sqlite\\Database\\USA.sqlite&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription washingtonCitiesQueryDescription = database.GetQueryDescription(<span class="string">&quot;select OBJECTID, Shape, CITY_FIPS, CITY_NAME, STATE_FIPS, STATE_CITY, TYPE, CAPITAL from main.cities where STATE_NAME=&#x27;Washington&#x27;&quot;</span>, <span class="string">&quot;WashingtonCities&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table washingtonTable = database.OpenTable(washingtonCitiesQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use washingtonTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-SQLSyntax-形成与平台无关的查询"><a href="#使用-SQLSyntax-形成与平台无关的查询" class="headerlink" title="使用 SQLSyntax 形成与平台无关的查询"></a>使用 SQLSyntax 形成与平台无关的查询</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UsingSqlSyntaxToFormPlatformAgnosticQueries</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;C:\\Data\\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      SQLSyntax sqlSyntax = geodatabase.GetSQLSyntax();</span><br><span class="line">      <span class="built_in">string</span> substringFunctionName = sqlSyntax.GetFunctionName(SQLFunction.Substring);</span><br><span class="line">      <span class="built_in">string</span> upperFunctionName = sqlSyntax.GetFunctionName(SQLFunction.Upper);</span><br><span class="line">      <span class="built_in">string</span> substringfunction = <span class="built_in">string</span>.Format(<span class="string">&quot;&#123;0&#125;(&#123;1&#125;(FCODE, 1, 6)) = &#x27;SCHOOL&#x27;&quot;</span>, upperFunctionName, substringFunctionName);</span><br><span class="line"></span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = substringfunction</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">using</span> (Selection selection = featureClass.Select(queryFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// work with the selection.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将文件地理数据库要素类连接到具有虚拟关系类的-Oracle-数据库查询图层要素类"><a href="#将文件地理数据库要素类连接到具有虚拟关系类的-Oracle-数据库查询图层要素类" class="headerlink" title="将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类"></a>将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoiningFileGeodatabaseFeatureClassToOracleQueryLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;C:\\Data\\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (FeatureClass leftFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;Hospital&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table rightTable = database.OpenTable(database.GetQueryDescription(<span class="string">&quot;FacilitySite&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">      Field originPrimaryKey = leftFeatureClass.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;facilityId&quot;</span>));</span><br><span class="line">      Field destinationForeignKey = rightTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;hospitalID&quot;</span>));</span><br><span class="line"></span><br><span class="line">      VirtualRelationshipClassDescription description = </span><br><span class="line">      <span class="keyword">new</span> VirtualRelationshipClassDescription(</span><br><span class="line">        originPrimaryKey, destinationForeignKey, RelationshipCardinality.OneToOne);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = leftFeatureClass.RelateTo(rightTable, description))</span><br><span class="line">      &#123;</span><br><span class="line">        JoinDescription joinDescription = <span class="keyword">new</span> JoinDescription(relationshipClass)</span><br><span class="line">        &#123;</span><br><span class="line">          JoinDirection = JoinDirection.Forward,</span><br><span class="line">          JoinType = JoinType.LeftOuterJoin</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Join <span class="keyword">join</span> = <span class="keyword">new</span> Join(joinDescription);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Table joinedTable = <span class="keyword">join</span>.GetJoinedTable())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Perform operation on joined table.</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="连接来自不同地理数据库的两个表"><a href="#连接来自不同地理数据库的两个表" class="headerlink" title="连接来自不同地理数据库的两个表"></a>连接来自不同地理数据库的两个表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoinTablesFromDifferentGeodatabases</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase sourceGeodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path \\ to \\Geodatabase \\ one&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase destinationGeodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path \\ to \\Geodatabase \\ two&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table sourceTable = sourceGeodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;State&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table destinationTable = destinationGeodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;Cities&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      Field primaryKeyField = sourceTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;State.State_Abbreviation&quot;</span>));</span><br><span class="line">      Field foreignKeyField = destinationTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;Cities.State&quot;</span>));</span><br><span class="line"></span><br><span class="line">      VirtualRelationshipClassDescription virtualRelationshipClassDescription = <span class="keyword">new</span> VirtualRelationshipClassDescription(primaryKeyField, foreignKeyField, RelationshipCardinality.OneToMany);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = sourceTable.RelateTo(destinationTable, virtualRelationshipClassDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        JoinDescription joinDescription = <span class="keyword">new</span> JoinDescription(relationshipClass)</span><br><span class="line">        &#123;</span><br><span class="line">          JoinDirection = JoinDirection.Forward,</span><br><span class="line">          JoinType = JoinType.InnerJoin,</span><br><span class="line">          TargetFields = sourceTable.GetDefinition().GetFields()</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Join <span class="keyword">join</span> = <span class="keyword">new</span> Join(joinDescription))</span><br><span class="line">        &#123;</span><br><span class="line">          Table joinedTable = <span class="keyword">join</span>.GetJoinedTable();</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Process the joined table. For example ..</span></span><br><span class="line">          <span class="keyword">using</span> (RowCursor cursor = joinedTable.Search())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Use Row</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用在地理数据库中连接两个版本化表的查询创建查询表"><a href="#使用在地理数据库中连接两个版本化表的查询创建查询表" class="headerlink" title="使用在地理数据库中连接两个版本化表的查询创建查询表"></a>使用在地理数据库中连接两个版本化表的查询创建查询表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">QueryTableJoinWithVersionedData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    QueryDef queryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">    &#123;</span><br><span class="line">      Tables = <span class="string">&quot;CommunityAddress JOIN MunicipalBoundary on CommunityAddress.Municipality = MunicipalBoundary.Name&quot;</span>,</span><br><span class="line">      SubFields = <span class="string">&quot;CommunityAddress.OBJECTID, CommunityAddress.Shape, CommunityAddress.SITEADDID, CommunityAddress.ADDRNUM, CommunityAddress.FULLNAME, CommunityAddress.FULLADDR, CommunityAddress.MUNICIPALITY, MunicipalBoundary.Name, MunicipalBoundary.MUNITYP, MunicipalBoundary.LOCALFIPS&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase testVersion1Geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;user.testVersion1&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryTableDescription queryTableDescription = <span class="keyword">new</span> QueryTableDescription(queryDef)</span><br><span class="line">      &#123;</span><br><span class="line">        Name = <span class="string">&quot;CommunityAddrJounMunicipalBoundr&quot;</span>,</span><br><span class="line">        PrimaryKeys = testVersion1Geodatabase.GetSQLSyntax().QualifyColumnName(<span class="string">&quot;CommunityAddress&quot;</span>, <span class="string">&quot;OBJECTID&quot;</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Will be based on testVersion1.</span></span><br><span class="line">      <span class="keyword">using</span> (Table queryTable = testVersion1Geodatabase.OpenQueryTable(queryTableDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use queryTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase testVersion2Geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;user.testVersion2&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryTableDescription queryTableDescription = <span class="keyword">new</span> QueryTableDescription(queryDef)</span><br><span class="line">      &#123;</span><br><span class="line">        Name = <span class="string">&quot;CommunityAddrJounMunicipalBoundr&quot;</span>,</span><br><span class="line">        PrimaryKeys = testVersion2Geodatabase.GetSQLSyntax().QualifyColumnName(<span class="string">&quot;CommunityAddress&quot;</span>, <span class="string">&quot;OBJECTID&quot;</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Will be based on testVersion2.</span></span><br><span class="line">      <span class="keyword">using</span> (Table queryTable = testVersion2Geodatabase.OpenQueryTable(queryTableDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use queryTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查字段值是否为空"><a href="#检查字段值是否为空" class="headerlink" title="检查字段值是否为空"></a>检查字段值是否为空</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = row[field.Name];</span><br><span class="line"><span class="keyword">if</span> (val <span class="keyword">is</span> DBNull || val == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// field value is null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// field value is not null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从字段中获取域字符串"><a href="#从字段中获取域字符串" class="headerlink" title="从字段中获取域字符串"></a>从字段中获取域字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetDomainStringFromField</span>(<span class="params">Row row, Field field</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the table and table definition from the Row</span></span><br><span class="line">  <span class="keyword">using</span> (Table table = row.GetTable())</span><br><span class="line">  <span class="keyword">using</span> (TableDefinition tableDefinition = table.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get name of subtype field</span></span><br><span class="line">    <span class="built_in">string</span> subtypeFieldName = tableDefinition.GetSubtypeField();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get subtype, if any</span></span><br><span class="line">    Subtype subtype = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (subtypeFieldName.Length != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Get value of subtype field for this row</span></span><br><span class="line">      <span class="keyword">var</span> varSubtypeCode = row[subtypeFieldName];</span><br><span class="line">      <span class="built_in">long</span> subtypeCode = (<span class="built_in">long</span>)varSubtypeCode;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get subtype for this row</span></span><br><span class="line">      subtype = tableDefinition.GetSubtypes().First(x =&gt; x.GetCode() == subtypeCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the coded value domain for this field</span></span><br><span class="line">    CodedValueDomain domain = field.GetDomain(subtype) <span class="keyword">as</span> CodedValueDomain;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the text string for this field</span></span><br><span class="line">    <span class="keyword">if</span> (domain != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> domain.GetName(row[field.Name]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> row[field.Name].ToString();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><h3 id="创建行"><a href="#创建行" class="headerlink" title="创建行"></a>创建行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingARow</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> creationResult = <span class="literal">false</span>;</span><br><span class="line">  EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//declare the callback here. We are not executing it ~yet~</span></span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        TableDefinition tableDefinition = enterpriseTable.GetDefinition();</span><br><span class="line">        <span class="built_in">int</span> assetNameIndex = tableDefinition.FindField(<span class="string">&quot;ASSETNA&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = enterpriseTable.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Either the field index or the field name can be used in the indexer.</span></span><br><span class="line">          rowBuffer[assetNameIndex] = <span class="string">&quot;wMain&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;COST&quot;</span>] = <span class="number">700</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;ACTION&quot;</span>] = <span class="string">&quot;Open Cut&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// subtype value for &quot;Abandon&quot;.</span></span><br><span class="line">          rowBuffer[tableDefinition.GetSubtypeField()] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Row row = enterpriseTable.CreateRow(rowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// To Indicate that the attribute table has to be updated.</span></span><br><span class="line">            context.Invalidate(row);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        creationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!creationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建特征"><a href="#创建特征" class="headerlink" title="创建特征"></a>创建特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingAFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> creationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//declare the callback here. We are not executing it ~yet~</span></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        FeatureClassDefinition facilitySiteDefinition = enterpriseFeatureClass.GetDefinition();</span><br><span class="line">        <span class="built_in">int</span> facilityIdIndex = facilitySiteDefinition.FindField(<span class="string">&quot;FACILITYID&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = enterpriseFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Either the field index or the field name can be used in the indexer.</span></span><br><span class="line">          rowBuffer[facilityIdIndex] = <span class="string">&quot;wMain&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;NAME&quot;</span>] = <span class="string">&quot;Griffith Park&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;OWNTYPE&quot;</span>] = <span class="string">&quot;Municipal&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;FCODE&quot;</span>] = <span class="string">&quot;Park&quot;</span>;</span><br><span class="line">          <span class="comment">// Add it to Public Attractions Subtype.</span></span><br><span class="line">          rowBuffer[facilitySiteDefinition.GetSubtypeField()] = <span class="number">820</span>;</span><br><span class="line"></span><br><span class="line">          List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          rowBuffer[facilitySiteDefinition.GetShapeField()] = <span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Feature feature = enterpriseFeatureClass.CreateRow(rowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">//To Indicate that the attribute table has to be updated</span></span><br><span class="line">            context.Invalidate(feature);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;, enterpriseFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        creationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!creationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改行"><a href="#修改行" class="headerlink" title="修改行"></a>修改行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ModifyingARow</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> modificationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter openCutFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;Open Cut&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseTable.Search(openCutFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          TableDefinition tableDefinition = enterpriseTable.GetDefinition();</span><br><span class="line">          <span class="built_in">int</span> subtypeFieldIndex = tableDefinition.FindField(tableDefinition.GetSubtypeField());</span><br><span class="line"></span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table.</span></span><br><span class="line">              <span class="comment">// Has to be called before any changes are made to the row.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line"></span><br><span class="line">              row[<span class="string">&quot;ASSETNA&quot;</span>] = <span class="string">&quot;wMainOpenCut&quot;</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (Convert.ToDouble(row[<span class="string">&quot;COST&quot;</span>]) &gt; <span class="number">700</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Abandon asset if cost is higher than 700 (if that is what you want to do).</span></span><br><span class="line">                row[<span class="string">&quot;ACTION&quot;</span>] = <span class="string">&quot;Open Cut Abandon&quot;</span>;</span><br><span class="line">                row[subtypeFieldIndex] = <span class="number">3</span>; <span class="comment">//subtype value for &quot;Abandon&quot;   </span></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="comment">//After all the changes are done, persist it.</span></span><br><span class="line">              row.Store();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Has to be called after the store too.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        modificationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!modificationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改特征"><a href="#修改特征" class="headerlink" title="修改特征"></a>修改特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ModifyingAFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> modificationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      FeatureClassDefinition facilitySiteDefinition = enterpriseFeatureClass.GetDefinition();</span><br><span class="line"></span><br><span class="line">      <span class="built_in">int</span> ownTypeIndex = facilitySiteDefinition.FindField(<span class="string">&quot;OWNTYPE&quot;</span>);</span><br><span class="line">      <span class="built_in">int</span> areaIndex = facilitySiteDefinition.FindField(facilitySiteDefinition.GetAreaField());</span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;FCODE = &#x27;Hazardous Materials Facility&#x27; AND OWNTYPE = &#x27;Private&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Feature feature = (Feature)rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table.</span></span><br><span class="line">              <span class="comment">// Has to be called before any changes are made to the row</span></span><br><span class="line">              context.Invalidate(feature);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Transfer all Hazardous Material Facilities to the City.</span></span><br><span class="line">              feature[ownTypeIndex] = <span class="string">&quot;Municipal&quot;</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (Convert.ToDouble(feature[areaIndex]) &gt; <span class="number">50000</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Set the Shape of the feature to whatever you need.</span></span><br><span class="line">                List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                feature.SetShape(<span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry());</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              feature.Store();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Has to be called after the store too</span></span><br><span class="line">              context.Invalidate(feature);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        modificationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!modificationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将值写入-Guid-列"><a href="#将值写入-Guid-列" class="headerlink" title="将值写入 Guid 列"></a>将值写入 Guid 列</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">row[field.Name] = <span class="string">&quot;&#123;&quot;</span> + guid.ToString() + <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="删除行-x2F-要素"><a href="#删除行-x2F-要素" class="headerlink" title="删除行&#x2F;要素"></a>删除行&#x2F;要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingARowOrFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> deletionResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter openCutFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;Open Cut&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseTable.Search(openCutFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table. Has to be called before the delete.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line"></span><br><span class="line">              row.Delete();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        deletionResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!deletionResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加附件"><a href="#添加附件" class="headerlink" title="添加附件"></a>添加附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">AddingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass parkFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.Park&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;NUMPARKING &gt; 0&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor parkingCursor = parkFeatureClass.Search(filter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (parkingCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (MemoryStream stream = CreateMemoryStreamFromContentsOf(<span class="string">&quot;Sample.xml&quot;</span>))</span><br><span class="line">          &#123;</span><br><span class="line">            Attachment attachment = <span class="keyword">new</span> Attachment(<span class="string">&quot;Sample.xml&quot;</span>, <span class="string">&quot;text/xml&quot;</span>, stream);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (Row row = parkingCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">long</span> attachmentId = row.AddAttachment(attachment);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> MemoryStream <span class="title">CreateMemoryStreamFromContentsOf</span>(<span class="params">String fileNameWithPath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(fileNameWithPath, FileMode.Open, FileAccess.Read))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[file.Length];</span><br><span class="line">    file.Read(bytes, <span class="number">0</span>, (<span class="built_in">int</span>)file.Length);</span><br><span class="line">    memoryStream.Write(bytes, <span class="number">0</span>, (<span class="built_in">int</span>)file.Length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> memoryStream;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新附件"><a href="#更新附件" class="headerlink" title="更新附件"></a>更新附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UpdatingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass landUseCaseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.LandUseCase&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;CASETYPE = &#x27;Rezoning&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor landUseCursor = landUseCaseFeatureClass.Search(filter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (landUseCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Feature rezoningUseCase = (Feature)landUseCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            IReadOnlyList&lt;Attachment&gt; rezoningAttachments = rezoningUseCase.GetAttachments();</span><br><span class="line">            IEnumerable&lt;Attachment&gt; filteredAttachments = rezoningAttachments.Where(attachment =&gt; !attachment.GetName().Contains(<span class="string">&quot;rezoning&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (Attachment attachmentToUpdate <span class="keyword">in</span> filteredAttachments)</span><br><span class="line">            &#123;</span><br><span class="line">              attachmentToUpdate.SetName(attachmentToUpdate.GetName().Replace(<span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;Rezoning.pdf&quot;</span>));</span><br><span class="line">              rezoningUseCase.UpdateAttachment(attachmentToUpdate);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除附件"><a href="#删除附件" class="headerlink" title="删除附件"></a>删除附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table inspectionTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;luCodeInspection&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;1st Notice&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = inspectionTable.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row currentRow = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            IReadOnlyList&lt;Attachment&gt; rowAttachments = currentRow.GetAttachments(<span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">            IEnumerable&lt;Attachment&gt; attachments = rowAttachments.Where(attachment =&gt; attachment.GetContentType().Equals(<span class="string">&quot;application/pdf&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> attachmentIDs = attachments.Select(attachment =&gt; attachment.GetAttachmentID()) <span class="keyword">as</span> IReadOnlyList&lt;<span class="built_in">long</span>&gt;;</span><br><span class="line">            IReadOnlyDictionary&lt;<span class="built_in">long</span>, Exception&gt; failures = currentRow.DeleteAttachments(attachmentIDs);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (failures.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">//process errors</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="写入-Blob-字段"><a href="#写入-Blob-字段" class="headerlink" title="写入 Blob 字段"></a>写入 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">WriteBlobField</span>(<span class="params">Table table, <span class="built_in">string</span> blobFieldName, <span class="built_in">string</span> imageFileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Read the image file into a MemoryStream</span></span><br><span class="line">    MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream(); ;</span><br><span class="line">    <span class="keyword">using</span> (FileStream imageFile = <span class="keyword">new</span> FileStream(imageFileName, FileMode.Open, FileAccess.Read))</span><br><span class="line">    &#123;</span><br><span class="line">      imageFile.CopyTo(memoryStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new row in the table, and write the Memory Stream into a blob fiele</span></span><br><span class="line">    <span class="keyword">using</span> (RowBuffer rowBuffer = table.CreateRowBuffer())</span><br><span class="line">    &#123;</span><br><span class="line">      rowBuffer[blobFieldName] = memoryStream;</span><br><span class="line">      table.CreateRow(rowBuffer).Dispose();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读取-Blob-字段"><a href="#读取-Blob-字段" class="headerlink" title="读取 Blob 字段"></a>读取 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ReadBlobField</span>(<span class="params">Table table, QueryFilter queryFilter, <span class="built_in">string</span> blobFieldName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> imageFileBaseName = <span class="string">&quot;C:\\path\\to\\image\\directory\\Image&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for each row that satisfies the search criteria, write the blob field out to an image file</span></span><br><span class="line">    <span class="keyword">using</span> (RowCursor rowCursor = table.Search(queryFilter))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">int</span> fileCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Read the blob field into a MemoryStream</span></span><br><span class="line">          MemoryStream memoryStream = row[blobFieldName] <span class="keyword">as</span> MemoryStream;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Create a file</span></span><br><span class="line">          <span class="keyword">using</span> (FileStream outputFile = <span class="keyword">new</span> FileStream(imageFileBaseName + fileCount.ToString(), FileMode.Create, FileAccess.Write))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Write the MemoryStream into the file</span></span><br><span class="line">            memoryStream.WriteTo(outputFile);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取按关系类关联的行"><a href="#获取按关系类关联的行" class="headerlink" title="获取按关系类关联的行"></a>获取按关系类关联的行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">GettingRowsRelatedByRelationshipClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolationHasInspections&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass violationsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolation&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table inspectionTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeInspection&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      List&lt;Row&gt; jeffersonAveViolations = <span class="keyword">new</span> List&lt;Row&gt;();</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;LOCDESC LIKE &#x27;///%Jefferson///%&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = violationsFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          jeffersonAveViolations.Add(rowCursor.Current);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      IReadOnlyList&lt;Row&gt; relatedOriginRows = <span class="literal">null</span>;</span><br><span class="line">      IReadOnlyList&lt;Row&gt; relatedDestinationRows = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;1st Notice&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Selection selection = inspectionTable.Select(filter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">        &#123;</span><br><span class="line">          relatedOriginRows = relationshipClass.GetRowsRelatedToDestinationRows(selection.GetObjectIDs());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">bool</span> containsJeffersonAve = relatedOriginRows.Any(row =&gt; Convert.ToString(row[<span class="string">&quot;LOCDESC&quot;</span>]).Contains(<span class="string">&quot;Jefferson&quot;</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;<span class="built_in">long</span>&gt; jeffersonAveViolationObjectIds = jeffersonAveViolations.Select(row =&gt; row.GetObjectID()).ToList();</span><br><span class="line"></span><br><span class="line">        relatedDestinationRows = relationshipClass.GetRowsRelatedToOriginRows(jeffersonAveViolationObjectIds);</span><br><span class="line">        <span class="built_in">bool</span> hasFirstNoticeInspections = relatedDestinationRows.Any(row =&gt; Convert.ToString(row[<span class="string">&quot;ACTION&quot;</span>]).Contains(<span class="string">&quot;1st Notice&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span></span><br><span class="line">      &#123;</span><br><span class="line">        Dispose(jeffersonAveViolations);</span><br><span class="line">        Dispose(relatedOriginRows);</span><br><span class="line">        Dispose(relatedDestinationRows);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params">IEnumerable&lt;Row&gt; rows</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">foreach</span> (Row row <span class="keyword">in</span> rows)</span><br><span class="line">    row.Dispose();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建关系"><a href="#创建关系" class="headerlink" title="创建关系"></a>创建关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingARelationship</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.OverviewToProject&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass projectsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.CIPProjects&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass overviewFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.CIPProjectsOverview&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// This will be PROJNAME. This can be used to get the field index or used directly as the field name.</span></span><br><span class="line">      <span class="built_in">string</span> originKeyField = relationshipClass.GetDefinition().GetOriginKeyField();</span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// The rows are being added to illustrate adding relationships. If one has existing rows, those can be used to add a relationship.</span></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer projectsRowBuffer = projectsFeatureClass.CreateRowBuffer())</span><br><span class="line">        <span class="keyword">using</span> (RowBuffer overviewRowBuffer = overviewFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          projectsRowBuffer[<span class="string">&quot;TOTCOST&quot;</span>] = <span class="number">500000</span>;</span><br><span class="line"></span><br><span class="line">          overviewRowBuffer[originKeyField] = <span class="string">&quot;LibraryConstruction&quot;</span>;</span><br><span class="line">          overviewRowBuffer[<span class="string">&quot;PROJECTMAN&quot;</span>] = <span class="string">&quot;John Doe&quot;</span>;</span><br><span class="line">          overviewRowBuffer[<span class="string">&quot;FUNDSOUR&quot;</span>] = <span class="string">&quot;Public&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Row projectsRow = projectsFeatureClass.CreateRow(projectsRowBuffer))</span><br><span class="line">          <span class="keyword">using</span> (Row overviewRow = overviewFeatureClass.CreateRow(overviewRowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            Relationship relationship = relationshipClass.CreateRelationship(overviewRow, projectsRow);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//To Indicate that the Map has to draw this feature/row and/or the attribute table has to be updated</span></span><br><span class="line">            context.Invalidate(projectsRow);</span><br><span class="line">            context.Invalidate(overviewRow);</span><br><span class="line">            context.Invalidate(relationshipClass);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, projectsFeatureClass, overviewFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">bool</span> editResult = editOperation.Execute();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除关系"><a href="#删除关系" class="headerlink" title="删除关系"></a>删除关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingARelationship</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolationHasInspections&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass violationsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolation&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;LOCDESC LIKE &#x27;///%Jefferson///%&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = violationsFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (!rowCursor.MoveNext())</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Row jeffersonAveViolation = rowCursor.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          IReadOnlyList&lt;Row&gt; relatedDestinationRows = relationshipClass.GetRowsRelatedToOriginRows(<span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt; &#123; jeffersonAveViolation.GetObjectID() &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span></span><br><span class="line">          &#123;</span><br><span class="line">            EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">            editOperation.Callback(context =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">foreach</span> (Row relatedDestinationRow <span class="keyword">in</span> relatedDestinationRows)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                  relationshipClass.DeleteRelationship(jeffersonAveViolation, relatedDestinationRow);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (GeodatabaseRelationshipClassException exception)</span><br><span class="line">                &#123;</span><br><span class="line">                  Console.WriteLine(exception);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, relationshipClass);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">bool</span> editResult = editOperation.Execute();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">finally</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (Row row <span class="keyword">in</span> relatedDestinationRows)</span><br><span class="line">              row.Dispose();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用插入游标"><a href="#使用插入游标" class="headerlink" title="使用插入游标"></a>使用插入游标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insert Cursors are intended for use in CoreHost applications, not Pro Add-ins</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UsingInsertCursor</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Table citiesTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;name\\of\\cities_table&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (InsertCursor insertCursor = citiesTable.CreateInsertCursor())</span><br><span class="line">      <span class="keyword">using</span> (RowBuffer rowBuffer = citiesTable.CreateRowBuffer())</span><br><span class="line">      &#123;</span><br><span class="line">        rowBuffer[<span class="string">&quot;State&quot;</span>] = <span class="string">&quot;Colorado&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rowBuffer[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;Fort Collins&quot;</span>;</span><br><span class="line">        rowBuffer[<span class="string">&quot;Population&quot;</span>] = <span class="number">167830</span>;</span><br><span class="line">        insertCursor.Insert(rowBuffer);</span><br><span class="line"></span><br><span class="line">        rowBuffer[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;Denver&quot;</span>;</span><br><span class="line">        rowBuffer[<span class="string">&quot;Population&quot;</span>] = <span class="number">727211</span>;</span><br><span class="line">        insertCursor.Insert(rowBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Insert more rows here</span></span><br><span class="line">        <span class="comment">// A more realistic example would be reading source data from a file</span></span><br><span class="line"></span><br><span class="line">        insertCursor.Flush();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-RowBuffer-在注记要素类中创建新的注记要素"><a href="#使用-RowBuffer-在注记要素类中创建新的注记要素" class="headerlink" title="使用 RowBuffer 在注记要素类中创建新的注记要素"></a>使用 RowBuffer 在注记要素类中创建新的注记要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingAnAnnotationFeature</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeatureClass annotationFeatureClass = geodatabase.OpenDataset&lt;AnnotationFeatureClass&gt;(<span class="string">&quot;Annotation // feature // class // name&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeatureClassDefinition annotationFeatureClassDefinition = annotationFeatureClass.GetDefinition())</span><br><span class="line">    <span class="keyword">using</span> (RowBuffer rowBuffer = annotationFeatureClass.CreateRowBuffer())</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeature annotationFeature = annotationFeatureClass.CreateRow(rowBuffer))</span><br><span class="line">    &#123;</span><br><span class="line">      annotationFeature.SetAnnotationClassID(<span class="number">0</span>);</span><br><span class="line">      annotationFeature.SetStatus(AnnotationStatus.Placed);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the annotation labels from the label collection</span></span><br><span class="line">      IReadOnlyList&lt;CIMLabelClass&gt; labelClasses = </span><br><span class="line">        annotationFeatureClassDefinition.GetLabelClassCollection();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Setup the symbol reference with the symbol id and the text symbol</span></span><br><span class="line">      CIMSymbolReference cimSymbolReference = <span class="keyword">new</span> CIMSymbolReference();</span><br><span class="line">      cimSymbolReference.Symbol = labelClasses[<span class="number">0</span>].TextSymbol.Symbol;</span><br><span class="line">      cimSymbolReference.SymbolName = labelClasses[<span class="number">0</span>].TextSymbol.SymbolName;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Setup the text graphic</span></span><br><span class="line">      CIMTextGraphic cimTextGraphic = <span class="keyword">new</span> CIMTextGraphic();</span><br><span class="line">      cimTextGraphic.Text = <span class="string">&quot;Charlotte, North Carolina&quot;</span>;</span><br><span class="line">      cimTextGraphic.Shape = <span class="keyword">new</span> MapPointBuilderEx(<span class="keyword">new</span> Coordinate2D(<span class="number">-80.843</span>, <span class="number">35.234</span>), SpatialReferences.WGS84).ToGeometry();</span><br><span class="line">      cimTextGraphic.Symbol = cimSymbolReference;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the symbol reference on the graphic and store</span></span><br><span class="line">      annotationFeature.SetGraphic(cimTextGraphic);</span><br><span class="line">      annotationFeature.Store();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h2><h3 id="连接到版本"><a href="#连接到版本" class="headerlink" title="连接到版本"></a>连接到版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Geodatabase <span class="title">ConnectToVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Geodatabase connectedVersion = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version version = versionManager.GetVersion(versionName))</span><br><span class="line">    &#123;</span><br><span class="line">      connectedVersion = version.Connect();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> connectedVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在单独的编辑会话中协调版本并将其与其父级进行核对和提交"><a href="#在单独的编辑会话中协调版本并将其与其父级进行核对和提交" class="headerlink" title="在单独的编辑会话中协调版本并将其与其父级进行核对和提交"></a>在单独的编辑会话中协调版本并将其与其父级进行核对和提交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReconcileAndPost</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get a reference to our version and our parent</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">    <span class="keyword">using</span> (Version parentVersion = currentVersion.GetParent())</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Create a ReconcileDescription object</span></span><br><span class="line">      <span class="comment">//At 2.x - </span></span><br><span class="line">      <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription(parentVersion);</span></span><br><span class="line">      <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue; // continue if conflicts are found</span></span><br><span class="line">      <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Reconcile and post</span></span><br><span class="line">      <span class="comment">//ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ReconcileResult.HasConflicts can be checked as-needed</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create a ReconcileOptions object</span></span><br><span class="line">      <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions(parentVersion);</span><br><span class="line">      reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue; <span class="comment">// continue if conflicts are found</span></span><br><span class="line">      reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByRow; <span class="comment">//Default</span></span><br><span class="line">      reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorTargetVersion;<span class="comment">//or FavorEditVersion</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Reconcile</span></span><br><span class="line">      ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileOptions);</span><br><span class="line">      <span class="keyword">if</span> (!reconcileResult.HasConflicts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//No conflicts, perform the post</span></span><br><span class="line">        <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions(parentVersion);</span><br><span class="line">        <span class="comment">//var postOptions = new PostOptions(); for default version</span></span><br><span class="line">        postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;<span class="comment">//Default</span></span><br><span class="line">        currentVersion.Post(postOptions);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在同一编辑会话中协调版本并将其与其父级提交"><a href="#在同一编辑会话中协调版本并将其与其父级提交" class="headerlink" title="在同一编辑会话中协调版本并将其与其父级提交"></a>在同一编辑会话中协调版本并将其与其父级提交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReconcileAndPost2</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get a reference to our version and our parent</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">    <span class="keyword">using</span> (Version parentVersion = currentVersion.GetParent())</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Create a ReconcileDescription object</span></span><br><span class="line">      <span class="comment">//At 2.x - </span></span><br><span class="line">      <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription(parentVersion);</span></span><br><span class="line">      <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue; // continue if conflicts are found</span></span><br><span class="line">      <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Reconcile and post</span></span><br><span class="line">      <span class="comment">//ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ReconcileResult.HasConflicts can be checked as-needed</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create a ReconcileOptions object</span></span><br><span class="line">      <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions(parentVersion);</span><br><span class="line">      reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue; <span class="comment">// continue if conflicts are found</span></span><br><span class="line">      reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByRow; <span class="comment">//Default</span></span><br><span class="line">      reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorTargetVersion;<span class="comment">//or FavorEditVersion</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions(parentVersion);</span><br><span class="line">      <span class="comment">//var postOptions = new PostOptions(); for default version</span></span><br><span class="line">      postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;<span class="comment">//Default</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Reconcile</span></span><br><span class="line">      ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileOptions, postOptions);</span><br><span class="line">      <span class="keyword">if</span> (reconcileResult.HasConflicts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//TODO resolve conflicts</span></span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用版本"><a href="#使用版本" class="headerlink" title="使用版本"></a>使用版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">WorkingWithVersions</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    &#123;</span><br><span class="line">      IReadOnlyList&lt;Version&gt; versionList = versionManager.GetVersions();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//The default version will have a null Parent</span></span><br><span class="line">      Version defaultVersion = versionList.First(version =&gt; version.GetParent() == <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">      IEnumerable&lt;Version&gt; publicVersions = versionList.Where(</span><br><span class="line">        version =&gt; version.GetAccessType() == VersionAccessType.Public);</span><br><span class="line">      Version qaVersion = defaultVersion.GetChildren().First(</span><br><span class="line">        version =&gt; version.GetName().Contains(<span class="string">&quot;QA&quot;</span>));</span><br><span class="line"></span><br><span class="line">      Geodatabase qaVersionGeodatabase = qaVersion.Connect();</span><br><span class="line"></span><br><span class="line">      FeatureClass currentFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;featureClassName&quot;</span>);</span><br><span class="line">      FeatureClass qaFeatureClass = qaVersionGeodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;featureClassName&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用默认版本"><a href="#使用默认版本" class="headerlink" title="使用默认版本"></a>使用默认版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check to see if the current version is default.</span></span><br><span class="line"><span class="comment">// Works with both branch and traditional versioning.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsDefaultVersion</span>(<span class="params">Version version</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Version parentVersion = version.GetParent();</span><br><span class="line">  <span class="keyword">if</span> (parentVersion == <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  parentVersion.Dispose();</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsDefaultVersion</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> IsDefaultVersion(currentVersion);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets the default version.</span></span><br><span class="line"><span class="comment">// Works with both branch and traditional versioning.</span></span><br><span class="line"><span class="comment">// Note that this routine depends on IsDefaultVersion(), above.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">GetDefaultVersion</span>(<span class="params">Version version</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (IsDefaultVersion(version))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    Version parent = version.GetParent();</span><br><span class="line">    Version ancestor = GetDefaultVersion(parent);</span><br><span class="line">    <span class="keyword">if</span> (parent != ancestor)</span><br><span class="line">    &#123;</span><br><span class="line">      parent.Dispose(); <span class="comment">//If the versioning tree is more than 2 deep, we want to dispose any intermediary versions</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ancestor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">GetDefaultVersion</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    Version currentVersion = versionManager.GetCurrentVersion();</span><br><span class="line">    Version defaultVersion = GetDefaultVersion(currentVersion);</span><br><span class="line">    <span class="keyword">if</span> (currentVersion != defaultVersion)</span><br><span class="line">    &#123;</span><br><span class="line">      currentVersion.Dispose(); <span class="comment">// If we are not pointing to default, we want to dispose this Version object</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultVersion;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建版本"><a href="#创建版本" class="headerlink" title="创建版本"></a>创建版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">CreateVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName, <span class="built_in">string</span> description, VersionAccessType versionAccessType</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    VersionDescription versionDescription = <span class="keyword">new</span> VersionDescription(versionName, description, versionAccessType);</span><br><span class="line">    <span class="keyword">return</span> versionManager.CreateVersion(versionDescription);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建历史版本"><a href="#创建历史版本" class="headerlink" title="创建历史版本"></a>创建历史版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> HistoricalVersion <span class="title">CreateHistoricalVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    HistoricalVersionDescription historicalVersionDescription = <span class="keyword">new</span> HistoricalVersionDescription(versionName, DateTime.Now);</span><br><span class="line">    HistoricalVersion historicalVersion = versionManager.CreateHistoricalVersion(historicalVersionDescription);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> historicalVersion;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在版本之间切换"><a href="#在版本之间切换" class="headerlink" title="在版本之间切换"></a>在版本之间切换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeVersions</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> toVersionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">   VersionBaseType versionBaseType = versionManager.GetCurrentVersionBaseType();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (versionBaseType == VersionBaseType.Version)</span><br><span class="line">   &#123;</span><br><span class="line">     Version fromVersion = versionManager.GetCurrentVersion();</span><br><span class="line">     Version toVersion = versionManager.GetVersion(toVersionName);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Switch between versions</span></span><br><span class="line">     MapView.Active.Map.ChangeVersion(fromVersion,toVersion);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (versionBaseType == VersionBaseType.HistoricalVersion)</span><br><span class="line">   &#123;</span><br><span class="line">     HistoricalVersion fromHistoricalVersion = versionManager.GetCurrentHistoricalVersion();</span><br><span class="line">     HistoricalVersion toHistoricalVersion = versionManager.GetHistoricalVersion(toVersionName);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Switch between historical versions</span></span><br><span class="line">     MapView.Active.Map.ChangeVersion(fromHistoricalVersion, toHistoricalVersion);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Switch from HistoricalVersion to Version and vice-versa </span></span><br><span class="line">   <span class="comment">// MapView.Active.Map.ChangeVersion(fromHistoricalVersion, toVersion);</span></span><br><span class="line">   <span class="comment">// MapView.Active.Map.ChangeVersion(fromVersion, toHistoricalVersion);</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="部分过账"><a href="#部分过账" class="headerlink" title="部分过账"></a>部分过账</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Partial posting allows developers to post a subset of changes made in a version.</span></span><br><span class="line"><span class="comment">// One sample use case is an electric utility that uses a version to design the facilities in</span></span><br><span class="line"><span class="comment">// a new housing subdivision. At some point in the process, one block of new houses have been</span></span><br><span class="line"><span class="comment">// completed, while the rest of the subdivision remains unbuilt.  Partial posting allows the user</span></span><br><span class="line"><span class="comment">// to post the completed work, while leaving not yet constructed features in the version to be</span></span><br><span class="line"><span class="comment">// posted later. Partial posting requires a branch-versioned feature service using ArcGIS</span></span><br><span class="line"><span class="comment">// Enterprise 10.9 and higher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Specify a set of features that were constructed</span></span><br><span class="line">QueryFilter constructedFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">&#123;</span><br><span class="line">  WhereClause = <span class="string">&quot;ConstructedStatus = &#x27;True&#x27;&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// This selection represents the inserts and updates to the support</span></span><br><span class="line"><span class="comment">// structure feature class that we wish to post</span></span><br><span class="line"><span class="keyword">using</span> (Selection constructedSupportStructures = </span><br><span class="line">    supportStructureFeatureClass.Select(</span><br><span class="line">      constructedFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Specifying which feature deletions you wish to post is slightly trickier, since you cannot issue</span></span><br><span class="line">  <span class="comment">// a query to fetch a set of deleted features Instead, a list of ObjectIDs must be used</span></span><br><span class="line">  <span class="keyword">using</span> (Selection deletedSupportStructures = supportStructureFeatureClass.Select(</span><br><span class="line">                                      <span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">  &#123;</span><br><span class="line">    deletedSupportStructures.Add(deletedSupportStructureObjectIDs);  <span class="comment">//deletedSupportStructureObjectIDs is</span></span><br><span class="line">                                                                     <span class="comment">//defined as List&lt;long&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Perform the reconcile with partial post</span></span><br><span class="line">    <span class="comment">//At 2.x - </span></span><br><span class="line">    <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription();</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictDetectionType = ConflictDetectionType.ByColumn;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictResolutionType = ConflictResolutionType.FavorEditVersion;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.PartialPostSelections = new List&lt;Selection&gt;() &#123; constructedSupportStructures, deletedSupportStructures &#125;;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ReconcileResult reconcileResult = designVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions();<span class="comment">//reconcile against Default</span></span><br><span class="line">    reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByColumn;</span><br><span class="line">    reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue;</span><br><span class="line">    reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorEditVersion;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions();<span class="comment">//post against Default</span></span><br><span class="line">    postOptions.PartialPostSelections = <span class="keyword">new</span> List&lt;Selection&gt;() &#123; </span><br><span class="line">                    constructedSupportStructures, deletedSupportStructures &#125;;</span><br><span class="line">    postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> reconcileResult = designVersion.Reconcile(reconcileOptions, postOptions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO process result(s)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a PoleInspection table with the following fields</span></span><br><span class="line"><span class="comment">//  GlobalID</span></span><br><span class="line"><span class="comment">//  ObjectID</span></span><br><span class="line"><span class="comment">//  InspectionDate (date)</span></span><br><span class="line"><span class="comment">//  InspectionResults (pre-existing InspectionResults coded value domain)</span></span><br><span class="line"><span class="comment">//  InspectionNotes (string)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a GlobalID field with default values</span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an ObjectID field with default values</span></span><br><span class="line">FieldDescription objectIDFieldDescription = FieldDescription.CreateObjectIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FieldDescription for the InspectionDate field</span></span><br><span class="line">FieldDescription inspectionDateFieldDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;InspectionDate&quot;</span>, FieldType.Date)</span><br><span class="line">&#123;</span><br><span class="line">  AliasName = <span class="string">&quot;Inspection Date&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a Domain field (from a pre-existing domain)</span></span><br><span class="line">FieldDescription inspectionResultsFieldDescription = FieldDescription.CreateDomainField(<span class="string">&quot;InspectionResults&quot;</span>, <span class="keyword">new</span> CodedValueDomainDescription(inspectionResultsDomain));</span><br><span class="line">inspectionResultsFieldDescription.AliasName = <span class="string">&quot;Inspection Results&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a string field</span></span><br><span class="line">FieldDescription inspectionNotesFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;InspectionNotes&quot;</span>, <span class="number">512</span>);</span><br><span class="line">inspectionNotesFieldDescription.AliasName = <span class="string">&quot;Inspection Notes&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assemble a list of all of our field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123; globalIDFieldDescription, objectIDFieldDescription, inspectionDateFieldDescription, inspectionResultsFieldDescription, inspectionNotesFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a TableDescription object to describe the table to create</span></span><br><span class="line">TableDescription tableDescription = <span class="keyword">new</span> TableDescription(<span class="string">&quot;PoleInspection&quot;</span>, fieldDescriptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of PoleInspection to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(tableDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建要素类"><a href="#创建要素类" class="headerlink" title="创建要素类"></a>创建要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a Cities feature class with the following fields</span></span><br><span class="line"><span class="comment">//  GlobalID</span></span><br><span class="line"><span class="comment">//  ObjectID</span></span><br><span class="line"><span class="comment">//  Name (string)</span></span><br><span class="line"><span class="comment">//  Population (integer)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a GlobalID field with default values</span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an ObjectID field with default values</span></span><br><span class="line">FieldDescription objectIDFieldDescription = FieldDescription.CreateObjectIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a string field</span></span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an integer field</span></span><br><span class="line">FieldDescription populationFieldDescription = FieldDescription.CreateIntegerField(<span class="string">&quot;Population&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assemble a list of all of our field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123; globalIDFieldDescription, objectIDFieldDescription, nameFieldDescription, populationFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Point, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively, ShapeDescriptions can be created from another feature class.  In this case, the new feature class will inherit the same shape properties of the existing class</span></span><br><span class="line">ShapeDescription alternativeShapeDescription = <span class="keyword">new</span> ShapeDescription(existingFeatureClass.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClassDescription object to describe the feature class to create</span></span><br><span class="line">FeatureClassDescription featureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(<span class="string">&quot;Cities&quot;</span>, fieldDescriptions, shapeDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the Cities feature class to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a TableDescription object</span></span><br><span class="line">TableDescription tableDescription = <span class="keyword">new</span> TableDescription(table.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the deletion of the table to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Delete(tableDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="删除要素类"><a href="#删除要素类" class="headerlink" title="删除要素类"></a>删除要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FeatureClassDescription object</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClass.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the deletion fo the feature class to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Delete(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="打开内存地理数据库"><a href="#打开内存地理数据库" class="headerlink" title="打开内存地理数据库"></a>打开内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Connects to the default memory geodatabase, if exists otherwise throws exception</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively, connects to memory geodatabase named as &#x27;InterimMemoryGeodatabase&#x27;</span></span><br><span class="line"><span class="comment">// MemoryConnectionProperties memoryConnectionProperties = new MemoryConnectionProperties(&quot;InterimMemoryGeodatabase&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Opens the memory geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(memoryConnectionProperties))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Use memory geodatabase</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建内存地理数据库"><a href="#创建内存地理数据库" class="headerlink" title="创建内存地理数据库"></a>创建内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the memory connection properties to connect to  default memory geodatabase</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively create the memory connection properties to connect to memory geodatabase named as &#x27;InterimMemoryGeodatabase&#x27;</span></span><br><span class="line"><span class="comment">// MemoryConnectionProperties memoryConnectionProperties = new MemoryConnectionProperties(&quot;InterimMemoryGeodatabase&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the memory geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = SchemaBuilder.CreateGeodatabase(memoryConnectionProperties))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除内存地理数据库"><a href="#删除内存地理数据库" class="headerlink" title="删除内存地理数据库"></a>删除内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the memory connection properties to connect to default memory geodatabase</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the memory geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(memoryConnectionProperties);</span><br></pre></td></tr></table></figure>

<h3 id="创建文件地理数据库"><a href="#创建文件地理数据库" class="headerlink" title="创建文件地理数据库"></a>创建文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileGeodatabaseConnectionPath with the name of the file geodatabase you wish to create</span></span><br><span class="line">FileGeodatabaseConnectionPath fileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-File-Geodatabase\YourName.gdb&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the file geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = </span><br><span class="line">  SchemaBuilder.CreateGeodatabase(fileGeodatabaseConnectionPath))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除文件地理数据库"><a href="#删除文件地理数据库" class="headerlink" title="删除文件地理数据库"></a>删除文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileGeodatabaseConnectionPath with the name of the file geodatabase you wish to delete</span></span><br><span class="line">FileGeodatabaseConnectionPath fileGeodatabaseConnectionPath = <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-File-Geodatabase\YourName.gdb&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the file geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(fileGeodatabaseConnectionPath);</span><br></pre></td></tr></table></figure>

<h3 id="创建移动地理数据库"><a href="#创建移动地理数据库" class="headerlink" title="创建移动地理数据库"></a>创建移动地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a MobileGeodatabaseConnectionPath with the name of the mobile geodatabase you wish to create</span></span><br><span class="line">MobileGeodatabaseConnectionPath mobileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> MobileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-Mobile-Geodatabase\YourName.geodatabase&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the mobile geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = SchemaBuilder.CreateGeodatabase(mobileGeodatabaseConnectionPath))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除移动地理数据库"><a href="#删除移动地理数据库" class="headerlink" title="删除移动地理数据库"></a>删除移动地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a MobileGeodatabaseConnectionPath with the name of the mobile geodatabase you wish to delete</span></span><br><span class="line">MobileGeodatabaseConnectionPath mobileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> MobileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-Mobile-Geodatabase\YourName.geodatabase&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the mobile geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(mobileGeodatabaseConnectionPath);</span><br></pre></td></tr></table></figure>

<h3 id="创建范围域"><a href="#创建范围域" class="headerlink" title="创建范围域"></a>创建范围域</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a range description with minimum value = 0 and maximum value = 1000</span></span><br><span class="line">RangeDomainDescription rangeDomainDescriptionMinMax = <span class="keyword">new</span> RangeDomainDescription(<span class="string">&quot;RangeDomain_0_1000&quot;</span>,</span><br><span class="line">  FieldType.Integer, <span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">&#123; Description = <span class="string">&quot;Domain value ranges from 0 to 1000&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create  a range domain </span></span><br><span class="line">schemaBuilder.Create(rangeDomainDescriptionMinMax);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建编码值域"><a href="#创建编码值域" class="headerlink" title="创建编码值域"></a>创建编码值域</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a CodedValueDomain description for water pipes</span></span><br><span class="line">CodedValueDomainDescription codedValueDomainDescription = <span class="keyword">new</span> CodedValueDomainDescription(<span class="string">&quot;WaterPipeTypes&quot;</span>, FieldType.String,</span><br><span class="line">  <span class="keyword">new</span> SortedList&lt;<span class="built_in">object</span>, <span class="built_in">string</span>&gt; &#123; &#123; <span class="string">&quot;Copper&quot;</span>, <span class="string">&quot;C_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;Steel&quot;</span>, <span class="string">&quot;S_2&quot;</span> &#125; &#125;)</span><br><span class="line">&#123;</span><br><span class="line">  SplitPolicy = SplitPolicy.Duplicate,</span><br><span class="line">  MergePolicy = MergePolicy.DefaultValue</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a coded value domain </span></span><br><span class="line">CodedValueDomainToken codedValueDomainToken = schemaBuilder.Create(codedValueDomainDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建要素数据集"><a href="#创建要素数据集" class="headerlink" title="创建要素数据集"></a>创建要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureDataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureDataset named as &#x27;Parcel Information&#x27;</span></span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(<span class="string">&quot;Parcel_Information&quot;</span>, SpatialReferences.WGS84);</span><br><span class="line">schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除要素数据集"><a href="#删除要素数据集" class="headerlink" title="删除要素数据集"></a>删除要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Deleting a FeatureDataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;Parcel_Information&quot;</span>);</span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete an existing feature dataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line">schemaBuilder.Delete(featureDatasetDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="重命名要素数据集"><a href="#重命名要素数据集" class="headerlink" title="重命名要素数据集"></a>重命名要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Renaming a FeatureDataset from &#x27;Parcel_Information&#x27; to &#x27;Parcel_Information_With_Tax_Jurisdiction&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> originalDatasetName = <span class="string">&quot;Parcel_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> datasetRenameAs = <span class="string">&quot;Parcel_Information_With_Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition originalDatasetDefinition = </span><br><span class="line">  geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(originalDatasetName);</span><br><span class="line">FeatureDatasetDescription originalFeatureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(originalDatasetDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rename the existing FeatureDataset, &#x27;Parcel_Information&#x27; to &#x27;Parcel_Information_With_Tax_Jurisdiction&#x27;</span></span><br><span class="line">schemaBuilder.Rename(originalFeatureDatasetDescription, datasetRenameAs);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="在一次操作中创建具有要素类的要素数据集"><a href="#在一次操作中创建具有要素类的要素数据集" class="headerlink" title="在一次操作中创建具有要素类的要素数据集"></a>在一次操作中创建具有要素类的要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureDataset named as &#x27;Parcel_Information&#x27; and a FeatureClass with name &#x27;Parcels&#x27; in one operation</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcel_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureDataset token</span></span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetName, SpatialReferences.WGS84);</span><br><span class="line">FeatureDatasetToken featureDatasetToken = schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass description</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassName,</span><br><span class="line">  <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Id&quot;</span>, FieldType.Integer),</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Address&quot;</span>, FieldType.String)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Point, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass inside a FeatureDataset</span></span><br><span class="line">FeatureClassToken featureClassToken = schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetToken), featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在现有要素数据集中创建要素类"><a href="#在现有要素数据集中创建要素类" class="headerlink" title="在现有要素数据集中创建要素类"></a>在现有要素数据集中创建要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureClass named as &#x27;Tax_Jurisdiction&#x27; in existing FeatureDataset with name &#x27;Parcels_Information&#x27;</span></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcels_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass description</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassName,</span><br><span class="line">  <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Tax_Id&quot;</span>, FieldType.Integer),</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Address&quot;</span>, FieldType.String)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Point, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(featureDatasetName);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass inside a FeatureDataset using a FeatureDatasetDefinition</span></span><br><span class="line">schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition), featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将要素类添加到要素数据集"><a href="#将要素类添加到要素数据集" class="headerlink" title="将要素类添加到要素数据集"></a>将要素类添加到要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding a FeatureClass with name &#x27;Tax_Jurisdiction&#x27; into a FeatureDataset named as &#x27;Parcels_Information&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcels_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassNameToAdd = <span class="string">&quot;Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(featureDatasetName);</span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition);</span><br><span class="line"></span><br><span class="line">FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassNameToAdd);</span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the &#x27;Tax_Jurisdiction&#x27; FeatureClass to the &#x27;Parcels_Information&#x27; FeatureDataset </span></span><br><span class="line">schemaBuilder.AddFeatureClass(featureDatasetDescription, featureClassDescription);</span><br><span class="line"><span class="built_in">bool</span> addStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!addStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Renaming a table from &#x27;Original_Table&#x27; to &#x27;Renamed_Table&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> tableToBeRenamed = <span class="string">&quot;Original_Table&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> tableRenameAs = <span class="string">&quot;Renamed_Table&quot;</span>;</span><br><span class="line"></span><br><span class="line">TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableToBeRenamed);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Table rename </span></span><br><span class="line">schemaBuilder.Rename(<span class="keyword">new</span> TableDescription(tableDefinition), tableRenameAs);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="向要素类添加字段"><a href="#向要素类添加字段" class="headerlink" title="向要素类添加字段"></a>向要素类添加字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding following fields to the &#x27;Parcels&#x27; FeatureClass</span></span><br><span class="line"><span class="comment">// Global ID</span></span><br><span class="line"><span class="comment">// Parcel_ID</span></span><br><span class="line"><span class="comment">// Tax_Code</span></span><br><span class="line"><span class="comment">// Parcel_Address</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The FeatureClass to add fields</span></span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureClassDefinition originalFeatureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">FeatureClassDescription originalFeatureClassDescription = <span class="keyword">new</span> </span><br><span class="line">   FeatureClassDescription(originalFeatureClassDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The four new fields to add on the &#x27;Parcels&#x27; FeatureClass</span></span><br><span class="line">FieldDescription globalIdField = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription parcelIdDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Parcel_ID&quot;</span>, FieldType.GUID);</span><br><span class="line">FieldDescription taxCodeDescription = FieldDescription.CreateIntegerField(<span class="string">&quot;Tax_Code&quot;</span>);</span><br><span class="line">FieldDescription addressDescription = FieldDescription.CreateStringField(<span class="string">&quot;Parcel_Address&quot;</span>, <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">List&lt;FieldDescription&gt; fieldsToAdd = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; globalIdField, parcelIdDescription,</span><br><span class="line">  taxCodeDescription, addressDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add new fields on the new FieldDescription list</span></span><br><span class="line">List&lt;FieldDescription&gt; modifiedFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;(originalFeatureClassDescription.FieldDescriptions);</span><br><span class="line">modifiedFieldDescriptions.AddRange(fieldsToAdd);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The new FeatureClassDescription with additional fields</span></span><br><span class="line">FeatureClassDescription modifiedFeatureClassDescription = <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDescription.Name,</span><br><span class="line">  modifiedFieldDescriptions, originalFeatureClassDescription.ShapeDescription);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the &#x27;Parcels&#x27; FeatureClass with newly added fields</span></span><br><span class="line">schemaBuilder.Modify(modifiedFeatureClassDescription);</span><br><span class="line"><span class="built_in">bool</span> modifyStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!modifyStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加使用域的字段"><a href="#添加使用域的字段" class="headerlink" title="添加使用域的字段"></a>添加使用域的字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding a field,&#x27;PipeType&#x27;, which uses the coded value domain to the &#x27;Pipes&#x27; FeatureClass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//The FeatureClass to add field</span></span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Pipes&quot;</span>;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a CodedValueDomain description for water pipes</span></span><br><span class="line">CodedValueDomainDescription pipeDomainDescription = </span><br><span class="line">  <span class="keyword">new</span> CodedValueDomainDescription(<span class="string">&quot;WaterPipeTypes&quot;</span>, FieldType.String,</span><br><span class="line">  <span class="keyword">new</span> SortedList&lt;<span class="built_in">object</span>, <span class="built_in">string</span>&gt; &#123; &#123; <span class="string">&quot;Copper&quot;</span>, <span class="string">&quot;C_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;Steel&quot;</span>, <span class="string">&quot;S_2&quot;</span> &#125; &#125;)</span><br><span class="line">&#123;</span><br><span class="line">  SplitPolicy = SplitPolicy.Duplicate,</span><br><span class="line">  MergePolicy = MergePolicy.DefaultValue</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a coded value domain token</span></span><br><span class="line">CodedValueDomainToken codedValueDomainToken = schemaBuilder.Create(pipeDomainDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a new description from domain token</span></span><br><span class="line">CodedValueDomainDescription codedValueDomainDescription = <span class="keyword">new</span> CodedValueDomainDescription(codedValueDomainToken);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a field named as &#x27;PipeType&#x27; using a domain description</span></span><br><span class="line">FieldDescription domainFieldDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;PipeType&quot;</span>, FieldType.String)</span><br><span class="line">&#123; DomainDescription = codedValueDomainDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Retrieve existing information for &#x27;Pipes&#x27; FeatureClass</span></span><br><span class="line">FeatureClassDefinition originalFeatureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">FeatureClassDescription originalFeatureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add domain field on existing fields</span></span><br><span class="line">List&lt;FieldDescription&gt; modifiedFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;(originalFeatureClassDescription.FieldDescriptions) &#123; domainFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a new description with updated fields for &#x27;Pipes&#x27; FeatureClass </span></span><br><span class="line">FeatureClassDescription featureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDescription.Name, modifiedFieldDescriptions,</span><br><span class="line">                                 originalFeatureClassDescription.ShapeDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the &#x27;Pipes&#x27; FeatureClass with domain field</span></span><br><span class="line">schemaBuilder.Modify(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从表中删除字段"><a href="#从表中删除字段" class="headerlink" title="从表中删除字段"></a>从表中删除字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Removing all fields from &#x27;Parcels&#x27; table except following </span></span><br><span class="line"><span class="comment">// Tax_Code</span></span><br><span class="line"><span class="comment">// Parcel_Address</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The table to remove fields</span></span><br><span class="line"><span class="built_in">string</span> tableName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableName);</span><br><span class="line">IReadOnlyList&lt;Field&gt; fields = tableDefinition.GetFields();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Existing fields from &#x27;Parcels&#x27; table</span></span><br><span class="line">Field taxCodeField = fields.First(f =&gt; f.Name.Equals(<span class="string">&quot;Tax_Code&quot;</span>));</span><br><span class="line">Field parcelAddressField = fields.First(f =&gt; f.Name.Equals(<span class="string">&quot;Parcel_Address&quot;</span>));</span><br><span class="line"></span><br><span class="line">FieldDescription taxFieldDescription = <span class="keyword">new</span> FieldDescription(taxCodeField);</span><br><span class="line">FieldDescription parcelAddressFieldDescription = <span class="keyword">new</span> FieldDescription(parcelAddressField);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fields to retain in modified table</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldsToBeRetained = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  taxFieldDescription, parcelAddressFieldDescription</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New description of the &#x27;Parcels&#x27; table with the &#x27;Tax_Code&#x27; and &#x27;Parcel_Address&#x27; fields</span></span><br><span class="line">TableDescription modifiedTableDescription = <span class="keyword">new</span> TableDescription(tableName, fieldsToBeRetained);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove all fields except the &#x27;Tax_Code&#x27; and &#x27;Parcel_Address&#x27; fields</span></span><br><span class="line">schemaBuilder.Modify(modifiedTableDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建注记要素类"><a href="#创建注记要素类" class="headerlink" title="创建注记要素类"></a>创建注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a Cities annotation feature class</span></span><br><span class="line"><span class="comment">// with following user defined fields</span></span><br><span class="line"><span class="comment">// Name </span></span><br><span class="line"><span class="comment">// GlobalID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;CitiesAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create user defined attribute fields for annotation feature class </span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of all field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; globalIDFieldDescription, nameFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Polygon, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Maplex engine </span></span><br><span class="line">CIMMaplexGeneralPlacementProperties generalPlacementProperties =</span><br><span class="line">  <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowBorderOverlap = <span class="literal">true</span>,</span><br><span class="line">    PlacementQuality = MaplexQualityType.High,</span><br><span class="line">    DrawUnplacedLabels = <span class="literal">true</span>,</span><br><span class="line">    InvertedLabelTolerance = <span class="number">1.0</span>,</span><br><span class="line">    RotateLabelWithDisplay = <span class="literal">true</span>,</span><br><span class="line">    UnplacedLabelColor = <span class="keyword">new</span> CIMRGBColor</span><br><span class="line">    &#123;</span><br><span class="line">      R = <span class="number">0</span>,</span><br><span class="line">      G = <span class="number">255</span>,</span><br><span class="line">      B = <span class="number">0</span>,</span><br><span class="line">      Alpha = <span class="number">0.5f</span> <span class="comment">// Green</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Standard engine</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//CIMStandardGeneralPlacementProperties generalPlacementProperties =</span></span><br><span class="line"><span class="comment">//  new CIMStandardGeneralPlacementProperties</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//    DrawUnplacedLabels = true,</span></span><br><span class="line"><span class="comment">//    InvertedLabelTolerance = 3.0,</span></span><br><span class="line"><span class="comment">//    RotateLabelWithDisplay = true,</span></span><br><span class="line"><span class="comment">//    UnplacedLabelColor = new CIMRGBColor</span></span><br><span class="line"><span class="comment">//    &#123;</span></span><br><span class="line"><span class="comment">//      R = 255, G = 0, B = 0, Alpha = 0.5f // Red</span></span><br><span class="line"><span class="comment">//    &#125; </span></span><br><span class="line"><span class="comment">//   &#125;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create annotation  label classes</span></span><br><span class="line"><span class="comment">// Green label</span></span><br><span class="line">CIMLabelClass greenLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Green&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Green&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">1</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Tahoma&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Green&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blue label</span></span><br><span class="line">CIMLabelClass blueLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Blue&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Blue&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">2</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Blue&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of labels</span></span><br><span class="line">List&lt;CIMLabelClass&gt; labelClasses = <span class="keyword">new</span> List&lt;CIMLabelClass&gt; &#123; greenLabelClass, blueLabelClass &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an annotation feature class description object to describe the feature class to create</span></span><br><span class="line">AnnotationFeatureClassDescription annotationFeatureClassDescription =</span><br><span class="line">  <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, fieldDescriptions, shapeDescription,</span><br><span class="line">    generalPlacementProperties, labelClasses)</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the Cities annotation feature class to the list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建关联要素的注记要素类"><a href="#创建关联要素的注记要素类" class="headerlink" title="创建关联要素的注记要素类"></a>创建关联要素的注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a feature-linked annotation feature class between water pipe and valve in water distribution network</span></span><br><span class="line"><span class="comment">// with following user defined fields</span></span><br><span class="line"><span class="comment">// PipeName </span></span><br><span class="line"><span class="comment">// GlobalID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;WaterPipeAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create user defined attribute fields for annotation feature class</span></span><br><span class="line">FieldDescription pipeGlobalID = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of all field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; pipeGlobalID, nameFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Polygon, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Maplex engine </span></span><br><span class="line">CIMMaplexGeneralPlacementProperties generalPlacementProperties = <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties</span><br><span class="line">&#123;</span><br><span class="line">  AllowBorderOverlap = <span class="literal">true</span>,</span><br><span class="line">  PlacementQuality = MaplexQualityType.High,</span><br><span class="line">  DrawUnplacedLabels = <span class="literal">true</span>,</span><br><span class="line">  InvertedLabelTolerance = <span class="number">1.0</span>,</span><br><span class="line">  RotateLabelWithDisplay = <span class="literal">true</span>,</span><br><span class="line">  UnplacedLabelColor = <span class="keyword">new</span> CIMRGBColor</span><br><span class="line">  &#123;</span><br><span class="line">    R = <span class="number">255</span>,</span><br><span class="line">    G = <span class="number">0</span>,</span><br><span class="line">    B = <span class="number">0</span>,</span><br><span class="line">    Alpha = <span class="number">0.5f</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create annotation  label classes</span></span><br><span class="line"><span class="comment">// Green label</span></span><br><span class="line">CIMLabelClass greenLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Green&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Green&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">1</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Tahoma&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Green&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blue label</span></span><br><span class="line">CIMLabelClass blueLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Blue&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Blue&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">2</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Blue&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of labels</span></span><br><span class="line">List&lt;CIMLabelClass&gt; labelClasses = <span class="keyword">new</span> List&lt;CIMLabelClass&gt; &#123; greenLabelClass, blueLabelClass &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create linked feature description</span></span><br><span class="line"><span class="comment">// Linked feature class name</span></span><br><span class="line"><span class="built_in">string</span> linkedFeatureClassName = <span class="string">&quot;WaterPipe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create fields for water pipe</span></span><br><span class="line">FieldDescription waterPipeGlobalID = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription pipeName = FieldDescription.CreateStringField(<span class="string">&quot;PipeName&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of water pipe field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; pipeFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; waterPipeGlobalID, pipeName &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a linked feature class description</span></span><br><span class="line">FeatureClassDescription linkedFeatureClassDescription = <span class="keyword">new</span> FeatureClassDescription(linkedFeatureClassName, pipeFieldDescriptions,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Polyline, spatialReference));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the linked feature class to the list of DDL tasks</span></span><br><span class="line">FeatureClassToken linkedFeatureClassToken = schemaBuilder.Create(linkedFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an annotation feature class description object to describe the feature class to create</span></span><br><span class="line">AnnotationFeatureClassDescription annotationFeatureClassDescription =</span><br><span class="line">  <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, fieldDescriptions, shapeDescription,</span><br><span class="line">    generalPlacementProperties, labelClasses, <span class="keyword">new</span> FeatureClassDescription(linkedFeatureClassToken))</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the annotation feature class to the list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在要素数据集内创建注记要素类"><a href="#在要素数据集内创建注记要素类" class="headerlink" title="在要素数据集内创建注记要素类"></a>在要素数据集内创建注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a Cities annotation feature class inside Places feature dataset using existing annotation feature class </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Feature dataset name</span></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Places&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;CitiesAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open existing annotation feature class name</span></span><br><span class="line"><span class="keyword">using</span> (AnnotationFeatureClass existingAnnotationFeatureClass = geodatabase.OpenDataset&lt;AnnotationFeatureClass&gt;(<span class="string">&quot;ExistingAnnotationFeatureClass&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create Feature dataset description</span></span><br><span class="line">  FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">    <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetName, existingAnnotationFeatureClass.GetDefinition().GetSpatialReference());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the creation of the Places dataset to DDL task</span></span><br><span class="line">  FeatureDatasetToken featureDatasetToken = schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create an annotation feature class description using existing annotation feature class</span></span><br><span class="line">  AnnotationFeatureClassDescription annotationFeatureClassDescription = <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, existingAnnotationFeatureClass.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the creation of the Cities annotation feature class inside Places feature dataset</span></span><br><span class="line">  schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetToken), annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Execute the DDL</span></span><br><span class="line">  <span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inspect error messages</span></span><br><span class="line">  <span class="keyword">if</span> (!success)</span><br><span class="line">  &#123;</span><br><span class="line">    IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">    <span class="comment">//etc.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地理数据库拓扑代码段"><a href="#地理数据库拓扑代码段" class="headerlink" title="地理数据库拓扑代码段"></a>地理数据库拓扑代码段</h2><h3 id="开放拓扑和进程定义"><a href="#开放拓扑和进程定义" class="headerlink" title="开放拓扑和进程定义"></a>开放拓扑和进程定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OpenTopologyAndProcessDefinition</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Open a geodatabase topology from a file geodatabase and process the topology definition.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    ProcessDefinition(geodatabase, topology);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Open a feature service topology and process the topology definition.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">string</span> TOPOLOGY_LAYER_ID = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> ServiceConnectionProperties(<span class="keyword">new</span> Uri(<span class="string">&quot;https://sdkexamples.esri.com/server/rest/services/GrandTeton/FeatureServer&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(TOPOLOGY_LAYER_ID))</span><br><span class="line">  &#123;</span><br><span class="line">    ProcessDefinition(geodatabase, topology);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ProcessDefinition</span>(<span class="params">Geodatabase geodatabase, Topology topology</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Similar to the rest of the Definition objects in the Core.Data API, there are two ways to open a dataset&#x27;s </span></span><br><span class="line">  <span class="comment">// definition -- via the Topology dataset itself or via the Geodatabase.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (TopologyDefinition definitionViaTopology = topology.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    OutputDefinition(geodatabase, definitionViaTopology);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (TopologyDefinition definitionViaGeodatabase = </span><br><span class="line">    geodatabase.GetDefinition&lt;TopologyDefinition&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    OutputDefinition(geodatabase, definitionViaGeodatabase);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OutputDefinition</span>(<span class="params">Geodatabase geodatabase, TopologyDefinition topologyDefinition</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Topology cluster tolerance =&gt; <span class="subst">&#123;topologyDefinition.GetClusterTolerance()&#125;</span>&quot;</span>);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Topology Z cluster tolerance =&gt; <span class="subst">&#123;topologyDefinition.GetZClusterTolerance()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; featureClassNames = topologyDefinition.GetFeatureClassNames();</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;featureClassNames.Count&#125;</span> feature classes that are participating in the topology:&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="built_in">string</span> name <span class="keyword">in</span> featureClassNames)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Open each feature class that participates in the topology.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(name))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = featureClass.GetDefinition())</span><br><span class="line">    &#123;</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;\t<span class="subst">&#123;featureClass.GetName()&#125;</span> (<span class="subst">&#123;featureClassDefinition.GetShapeType()&#125;</span>)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取拓扑规则"><a href="#获取拓扑规则" class="headerlink" title="获取拓扑规则"></a>获取拓扑规则</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (TopologyDefinition topologyDefinition = topology.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;TopologyRule&gt; rules = topologyDefinition.GetRules();</span><br><span class="line"></span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;rules.Count&#125;</span> topology rules defined for the topology:&quot;</span>);</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;ID \t Origin Class \t Origin Subtype \t Destination Class \t Destination Subtype \t Rule Type&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyRule rule <span class="keyword">in</span> rules)</span><br><span class="line">  &#123;</span><br><span class="line">    Console.Write(<span class="string">$&quot;<span class="subst">&#123;rule.ID&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(!String.IsNullOrEmpty(rule.OriginClass) ? <span class="string">$&quot;\t<span class="subst">&#123;rule.OriginClass&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(rule.OriginSubtype != <span class="literal">null</span> ? <span class="string">$&quot;\t<span class="subst">&#123;rule.OriginSubtype.GetName()&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(!String.IsNullOrEmpty(rule.DestinationClass) ? <span class="string">$&quot;\t<span class="subst">&#123;rule.DestinationClass&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(rule.DestinationSubtype != <span class="literal">null</span> ? <span class="string">$&quot;\t<span class="subst">&#123;rule.DestinationSubtype.GetName()&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(<span class="string">$&quot;\t<span class="subst">&#123;rule.RuleType&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证拓扑"><a href="#验证拓扑" class="headerlink" title="验证拓扑"></a>验证拓扑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ValidateTopology</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// If the topology currently does not have dirty areas, calling Validate() returns an empty envelope.</span></span><br><span class="line"></span><br><span class="line">    ValidationResult result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has not been edited =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now create a feature that purposely violates the &quot;PointProperlyInsideArea&quot; topology rule.  This action will</span></span><br><span class="line">    <span class="comment">// create dirty areas.</span></span><br><span class="line"></span><br><span class="line">    Feature newFeature = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Fetch the feature in the Campsites feature class whose objectID is 2.  Then create a new geometry slightly</span></span><br><span class="line">      <span class="comment">// altered from this and use it to create a new feature.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Feature featureViaCampsites2 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">2</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        Geometry currentGeometry = featureViaCampsites2.GetShape();</span><br><span class="line">        Geometry newGeometry = GeometryEngine.Instance.Move(currentGeometry, (currentGeometry.Extent.XMax / <span class="number">8</span>),</span><br><span class="line">          (currentGeometry.Extent.YMax / <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (FeatureClass campsitesFeatureClass = featureViaCampsites2.GetTable())</span><br><span class="line">        <span class="keyword">using</span> (FeatureClassDefinition definition = campsitesFeatureClass.GetDefinition())</span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = campsitesFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          rowBuffer[definition.GetShapeField()] = newGeometry;</span><br><span class="line"></span><br><span class="line">          geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            newFeature = campsitesFeatureClass.CreateRow(rowBuffer);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// After creating a new feature in the &#x27;Campsites&#x27; participating feature class, the topology&#x27;s state should be </span></span><br><span class="line">      <span class="comment">// &quot;Unanalyzed&quot; because it has not been validated.</span></span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;The topology state after an edit has been applied =&gt; <span class="subst">&#123;topology.GetState()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Now validate the topology.  The result envelope corresponds to the dirty areas.</span></span><br><span class="line"></span><br><span class="line">      result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has just been edited =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// After Validate(), the topology&#x27;s state should be &quot;AnalyzedWithErrors&quot; because the topology currently has errors.</span></span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;The topology state after validate topology =&gt; <span class="subst">&#123;topology.GetState()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If there are no dirty areas, the result envelope should be empty.</span></span><br><span class="line"></span><br><span class="line">      result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has just been validated =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (newFeature != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          newFeature.Delete();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        newFeature.Dispose();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Validate again after deleting the newly-created feature.</span></span><br><span class="line"></span><br><span class="line">    topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Feature <span class="title">GetFeature</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> featureClassName, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(featureClassName))</span><br><span class="line">  &#123;</span><br><span class="line">    QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">    &#123;</span><br><span class="line">      ObjectIDs = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; objectID &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (RowCursor cursor = featureClass.Search(queryFilter))</span><br><span class="line">    &#123;</span><br><span class="line">      System.Diagnostics.Debug.Assert(cursor.MoveNext());</span><br><span class="line">      <span class="keyword">return</span> (Feature)cursor.Current;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取拓扑错误"><a href="#获取拓扑错误" class="headerlink" title="获取拓扑错误"></a>获取拓扑错误</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get all the errors and exceptions currently associated with the topology.</span></span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;TopologyError&gt; allErrorsAndExceptions = topology.GetErrors(<span class="keyword">new</span> ErrorDescription(topology.GetExtent()));</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;errors and exceptions count =&gt; <span class="subst">&#123;allErrorsAndExceptions.Count&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;OriginClassName \t OriginObjectID \t DestinationClassName \t DestinationObjectID \t RuleType \t IsException \t Shape type \t Shape width &amp; height \t  Rule ID \t&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> allErrorsAndExceptions)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;&#x27;<span class="subst">&#123;error.OriginClassName&#125;</span>&#x27; \t <span class="subst">&#123;error.OriginObjectID&#125;</span> \t &#x27;<span class="subst">&#123;error.DestinationClassName&#125;</span>&#x27; \t &quot;</span> +</span><br><span class="line">                    <span class="string">$&quot;<span class="subst">&#123;error.DestinationObjectID&#125;</span> \t <span class="subst">&#123;error.RuleType&#125;</span> \t <span class="subst">&#123;error.IsException&#125;</span> \t <span class="subst">&#123;error.Shape.GeometryType&#125;</span> \t &quot;</span> +</span><br><span class="line">                    <span class="string">$&quot;<span class="subst">&#123;error.Shape.Extent.Width&#125;</span>,<span class="subst">&#123;error.Shape.Extent.Height&#125;</span> \t <span class="subst">&#123;error.RuleID&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MarkAndUnmarkAsErrors"><a href="#MarkAndUnmarkAsErrors" class="headerlink" title="MarkAndUnmarkAsErrors"></a>MarkAndUnmarkAsErrors</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get all the errors due to features violating the &quot;PointProperlyInsideArea&quot; topology rule.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> (TopologyDefinition topologyDefinition = topology.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  TopologyRule pointProperlyInsideAreaRule = topologyDefinition.GetRules().First(rule =&gt; rule.RuleType == TopologyRuleType.PointProperlyInsideArea);</span><br><span class="line"></span><br><span class="line">  ErrorDescription errorDescription = <span class="keyword">new</span> ErrorDescription(topology.GetExtent())</span><br><span class="line">  &#123;</span><br><span class="line">    TopologyRule = pointProperlyInsideAreaRule</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsDueToViolatingPointProperlyInsideAreaRule = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsDueToViolatingPointProperlyInsideAreaRule.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Mark all errors from features violating the &#x27;PointProperlyInsideArea&#x27; topology rule as exceptions.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> errorsDueToViolatingPointProperlyInsideAreaRule)</span><br><span class="line">  &#123;</span><br><span class="line">    topology.MarkAsException(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now verify all the errors from features violating the &#x27;PointProperlyInsideArea&#x27; topology rule have indeed been</span></span><br><span class="line">  <span class="comment">// marked as exceptions.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// By default, ErrorDescription is initialized to ErrorType.ErrorAndException.  Here we want ErrorType.ErrorOnly.</span></span><br><span class="line"></span><br><span class="line">  errorDescription = <span class="keyword">new</span> ErrorDescription(topology.GetExtent())</span><br><span class="line">  &#123;</span><br><span class="line">    ErrorType = ErrorType.ErrorOnly,</span><br><span class="line">    TopologyRule = pointProperlyInsideAreaRule</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsAfterMarkedAsExceptions = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsAfterMarkedAsExceptions.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule after all the errors have been marked as exceptions.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Finally, reset all the exceptions as errors by unmarking them as exceptions.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> errorsDueToViolatingPointProperlyInsideAreaRule)</span><br><span class="line">  &#123;</span><br><span class="line">    topology.UnmarkAsException(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsAfterUnmarkedAsExceptions = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsAfterUnmarkedAsExceptions.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule after all the exceptions have been reset as errors.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="探索拓扑图"><a href="#探索拓扑图" class="headerlink" title="探索拓扑图"></a>探索拓扑图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExploreTopologyGraph</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Build a topology graph using the extent of the topology dataset.</span></span><br><span class="line"></span><br><span class="line">    topology.BuildGraph(topology.GetExtent(), (topologyGraph) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Feature campsites12 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">12</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        IReadOnlyList&lt;TopologyNode&gt; topologyNodesViaCampsites12 = topologyGraph.GetNodes(campsites12);</span><br><span class="line"></span><br><span class="line">        TopologyNode topologyNodeViaCampsites12 = topologyNodesViaCampsites12[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        IReadOnlyList&lt;TopologyEdge&gt; allEdgesConnectedToNodeViaCampsites12 = topologyNodeViaCampsites12.GetEdges();</span><br><span class="line">        IReadOnlyList&lt;TopologyEdge&gt; allEdgesConnectedToNodeViaCampsites12CounterClockwise = topologyNodeViaCampsites12.GetEdges(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        System.Diagnostics.Debug.Assert(allEdgesConnectedToNodeViaCampsites12.Count == allEdgesConnectedToNodeViaCampsites12CounterClockwise.Count);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (TopologyEdge edgeConnectedToNodeViaCampsites12 <span class="keyword">in</span> allEdgesConnectedToNodeViaCampsites12)</span><br><span class="line">        &#123;</span><br><span class="line">          TopologyNode fromNode = edgeConnectedToNodeViaCampsites12.GetFromNode();</span><br><span class="line">          TopologyNode toNode = edgeConnectedToNodeViaCampsites12.GetToNode();</span><br><span class="line"></span><br><span class="line">          <span class="built_in">bool</span> fromNodeIsTheSameAsTopologyNodeViaCampsites12 = (fromNode == topologyNodeViaCampsites12);</span><br><span class="line">          <span class="built_in">bool</span> toNodeIsTheSameAsTopologyNodeViaCampsites12 = (toNode == topologyNodeViaCampsites12);</span><br><span class="line"></span><br><span class="line">          System.Diagnostics.Debug.Assert(fromNodeIsTheSameAsTopologyNodeViaCampsites12 || toNodeIsTheSameAsTopologyNodeViaCampsites12,</span><br><span class="line">            <span class="string">&quot;The FromNode *or* ToNode of each edge connected to &#x27;topologyNodeViaCampsites12&#x27; should be the same as &#x27;topologyNodeViaCampsites12&#x27; itself.&quot;</span>);</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; leftParentFeaturesBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetLeftParentFeatures();</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> leftParentFeaturesBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; leftParentFeaturesNotBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetLeftParentFeatures(<span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> leftParentFeaturesNotBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; rightParentFeaturesBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetRightParentFeatures();</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> rightParentFeaturesBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; rightParentFeaturesNotBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetRightParentFeatures(<span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> rightParentFeaturesNotBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EnsureShapeIsNotEmpty</span>(<span class="params">FeatureInfo featureInfo</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Feature feature = featureInfo.GetFeature())</span><br><span class="line">  &#123;</span><br><span class="line">    System.Diagnostics.Debug.Assert(!feature.GetShape().IsEmpty, <span class="string">&quot;The feature&#x27;s shape should not be empty.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FindClosestElement"><a href="#FindClosestElement" class="headerlink" title="FindClosestElement"></a>FindClosestElement</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FindClosestElement</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Build a topology graph using the extent of the topology dataset.</span></span><br><span class="line"></span><br><span class="line">    topology.BuildGraph(topology.GetExtent(), (topologyGraph) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      MapPoint queryPointViaCampsites12 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Feature campsites12 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">12</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        queryPointViaCampsites12 = campsites12.GetShape() <span class="keyword">as</span> MapPoint;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">double</span> searchRadius = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">      TopologyElement topologyElementViaCampsites12 = </span><br><span class="line">          topologyGraph.FindClosestElement&lt;TopologyElement&gt;(</span><br><span class="line">                    queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      System.Diagnostics.Debug.Assert(</span><br><span class="line">        topologyElementViaCampsites12 != <span class="literal">null</span>, <span class="string">&quot;There should be a topology element corresponding to &#x27;queryPointViaCampsites12&#x27; within the &#x27;searchRadius&#x27; units.&quot;</span>);</span><br><span class="line"></span><br><span class="line">      IReadOnlyList&lt;FeatureInfo&gt; parentFeatures = topologyElementViaCampsites12.GetParentFeatures();</span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">&quot;The parent features that spawn &#x27;topologyElementViaCampsites12&#x27; are:&quot;</span>);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureInfo parentFeature <span class="keyword">in</span> parentFeatures)</span><br><span class="line">      &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;\t<span class="subst">&#123;parentFeature.FeatureClassName&#125;</span>; OID: <span class="subst">&#123;parentFeature.ObjectID&#125;</span>&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      TopologyNode topologyNodeViaCampsites12 = topologyGraph.FindClosestElement&lt;TopologyNode&gt;(queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (topologyNodeViaCampsites12 != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// There exists a TopologyNode nearest to the query point within searchRadius units.</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      TopologyEdge topologyEdgeViaCampsites12 = topologyGraph.FindClosestElement&lt;TopologyEdge&gt;(queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (topologyEdgeViaCampsites12 != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// There exists a TopologyEdge nearest to the query point within searchRadius units.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>}</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1361151272@qq.com">shaozhy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://shaoshao.net.cn/2022/12/28/20221228135207000/">https://shaoshao.net.cn/2022/12/28/20221228135207000/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shaoshao.net.cn" target="_blank">WineMonk</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/discover/tags/CSharp/">CSharp</a><a class="post-meta__tags" href="/discover/tags/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></div><div class="post_share"><div class="social-share" data-image="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/28/20221228135428000/"><img class="prev-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_09.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ArcGIS Pro SDK 几何</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/28/20221228134946000/"><img class="next-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_07.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ArcGIS Pro SDK 编辑</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/28/20221228133712000/" title="ArcGIS Pro SDK 框架"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_04.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 框架</div></div></a></div><div><a href="/2022/12/28/20221228134215000/" title="ArcGIS Pro SDK 内容"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 内容</div></div></a></div><div><a href="/2022/12/28/20221228134536000/" title="ArcGIS Pro SDK 核心主机"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_06.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 核心主机</div></div></a></div><div><a href="/2022/12/28/20221228135620000/" title="ArcGIS Pro SDK 地理处理"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 地理处理</div></div></a></div><div><a href="/2022/12/28/20221228134946000/" title="ArcGIS Pro SDK 编辑"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_07.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 编辑</div></div></a></div><div><a href="/2022/12/28/20221228135824000/" title="ArcGIS Pro SDK 图形图层"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 图形图层</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">地理数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-number">1.1.</span> <span class="toc-text">地理数据库和数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BB%99%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%9A%84%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">打开给定路径的文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7%E6%89%93%E5%BC%80%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.2.</span> <span class="toc-text">使用连接属性打开企业级地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-sde-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%89%93%E5%BC%80%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.3.</span> <span class="toc-text">使用 sde 文件路径打开企业级地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%B7%A5%E7%A8%8B%E9%A1%B9%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.4.</span> <span class="toc-text">从工程项获取地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.5.</span> <span class="toc-text">从连接文件获取数据库连接属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.6.</span> <span class="toc-text">从要素图层获取地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.7.</span> <span class="toc-text">执行 SQL 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.</span> <span class="toc-text">定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">从地理数据库获取定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AE%9A%E4%B9%89%E5%88%97%E8%A1%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">从地理数据库获取定义列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.3.</span> <span class="toc-text">从地理数据库获取相关定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%B1%82%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">从层获取表定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.</span> <span class="toc-text">数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%93%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">从地理数据库打开数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">检查表是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">检查要素类是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%85%B3%E7%B3%BB%E4%B8%A4%E4%B8%AA%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E7%B1%BB"><span class="toc-number">1.3.4.</span> <span class="toc-text">打开关系两个表之间的类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%B3%E7%B3%BB%E7%B1%BB%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.3.5.</span> <span class="toc-text">从关系类获取相关要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-shapefile-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%89%93%E5%BC%80%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.3.6.</span> <span class="toc-text">从 shapefile 数据存储打开要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80-CAD-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-number">1.3.7.</span> <span class="toc-text">打开 CAD 数据存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E7%AD%9B%E9%80%89%E5%99%A8%E6%90%9C%E7%B4%A2%E8%A1%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">使用查询筛选器搜索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A1%A8%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%9D%9E%E6%8B%89%E4%B8%81%E5%AD%97%E7%AC%A6"><span class="toc-number">1.4.2.</span> <span class="toc-text">在表中搜索非拉丁字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%80%E7%BB%84%E5%AF%B9%E8%B1%A1-ID-%E6%90%9C%E7%B4%A2%E8%A1%A8"><span class="toc-number">1.4.3.</span> <span class="toc-text">使用一组对象 ID 搜索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A9%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%E8%BF%87%E6%BB%A4%E5%99%A8%E6%90%9C%E7%B4%A2%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.4.4.</span> <span class="toc-text">使用空间查询过滤器搜索要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E9%80%89%E6%8B%A9%E8%A1%8C"><span class="toc-number">1.4.5.</span> <span class="toc-text">从表中选择行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A6%81%E7%B4%A0%E7%B1%BB%E4%B8%AD%E9%80%89%E6%8B%A9%E8%A6%81%E7%B4%A0"><span class="toc-number">1.4.6.</span> <span class="toc-text">从要素类中选择要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E4%B8%AD%E5%BD%93%E5%89%8D%E6%9C%89%E5%A4%9A%E5%B0%91%E8%A1%8C%E7%9A%84%E8%AE%A1%E6%95%B0"><span class="toc-number">1.4.7.</span> <span class="toc-text">获取表中当前有多少行的计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E7%9A%84%E7%89%B9%E5%BE%81%E8%AE%A1%E6%95%B0"><span class="toc-number">1.4.8.</span> <span class="toc-text">获取图层的特征计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%A1%A8%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">1.4.9.</span> <span class="toc-text">对表进行排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%A1%A8%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.10.</span> <span class="toc-text">计算表的统计信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E4%B8%AA%E8%A1%A8%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">1.4.11.</span> <span class="toc-text">在单个表上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WHERE-%E5%AD%90%E5%8F%A5%E8%AE%A1%E7%AE%97%E8%BF%9E%E6%8E%A5%E4%B8%8A%E7%9A%84-QueryDef"><span class="toc-number">1.4.12.</span> <span class="toc-text">使用 WHERE 子句计算连接上的 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%A4%96%E9%83%A8%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AE%A1%E7%AE%97-QueryDef"><span class="toc-number">1.4.13.</span> <span class="toc-text">在外部连接上计算 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%86%85%E9%83%A8%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">1.4.14.</span> <span class="toc-text">在内部连接上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B5%8C%E5%A5%97-INNER-%E5%92%8C-OUTER-%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">1.4.15.</span> <span class="toc-text">在嵌套 - INNER 和 OUTER 连接上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%88%9B%E5%BB%BA%E9%BB%98%E8%AE%A4%E6%9F%A5%E8%AF%A2%E6%8F%8F%E8%BF%B0%E5%B9%B6%E8%8E%B7%E5%8F%96%E6%9F%A5%E8%AF%A2%E6%8F%8F%E8%BF%B0%E7%9A%84-ArcGIS-Core-Data-Table"><span class="toc-number">1.4.16.</span> <span class="toc-text">为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.17.</span> <span class="toc-text">从数据库表的自定义查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%B2%A1%E6%9C%89%E4%B8%8D%E5%8F%AF%E4%B8%BA%E7%A9%BA%E7%9A%84%E5%94%AF%E4%B8%80-id-%E5%88%97%E7%9A%84%E8%81%94%E6%8E%A5%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.18.</span> <span class="toc-text">从没有不可为空的唯一 id 列的联接查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%B7%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%BD%A2%E7%8A%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.19.</span> <span class="toc-text">从具有多个形状类型的数据库表的查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-SQLite-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.20.</span> <span class="toc-text">从 SQLite 数据库表的查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-SQLSyntax-%E5%BD%A2%E6%88%90%E4%B8%8E%E5%B9%B3%E5%8F%B0%E6%97%A0%E5%85%B3%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.21.</span> <span class="toc-text">使用 SQLSyntax 形成与平台无关的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A6%81%E7%B4%A0%E7%B1%BB%E8%BF%9E%E6%8E%A5%E5%88%B0%E5%85%B7%E6%9C%89%E8%99%9A%E6%8B%9F%E5%85%B3%E7%B3%BB%E7%B1%BB%E7%9A%84-Oracle-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E5%9B%BE%E5%B1%82%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.4.22.</span> <span class="toc-text">将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9D%A5%E8%87%AA%E4%B8%8D%E5%90%8C%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%A4%E4%B8%AA%E8%A1%A8"><span class="toc-number">1.4.23.</span> <span class="toc-text">连接来自不同地理数据库的两个表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%BF%9E%E6%8E%A5%E4%B8%A4%E4%B8%AA%E7%89%88%E6%9C%AC%E5%8C%96%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%A1%A8"><span class="toc-number">1.4.24.</span> <span class="toc-text">使用在地理数据库中连接两个版本化表的查询创建查询表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AD%97%E6%AE%B5%E5%80%BC%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA"><span class="toc-number">1.4.25.</span> <span class="toc-text">检查字段值是否为空</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AD%97%E6%AE%B5%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.4.26.</span> <span class="toc-text">从字段中获取域字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91"><span class="toc-number">1.5.</span> <span class="toc-text">编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%8C"><span class="toc-number">1.5.1.</span> <span class="toc-text">创建行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%B9%E5%BE%81"><span class="toc-number">1.5.2.</span> <span class="toc-text">创建特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%8C"><span class="toc-number">1.5.3.</span> <span class="toc-text">修改行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%89%B9%E5%BE%81"><span class="toc-number">1.5.4.</span> <span class="toc-text">修改特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%80%BC%E5%86%99%E5%85%A5-Guid-%E5%88%97"><span class="toc-number">1.5.5.</span> <span class="toc-text">将值写入 Guid 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%8C-x2F-%E8%A6%81%E7%B4%A0"><span class="toc-number">1.5.6.</span> <span class="toc-text">删除行&#x2F;要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%99%84%E4%BB%B6"><span class="toc-number">1.5.7.</span> <span class="toc-text">添加附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%99%84%E4%BB%B6"><span class="toc-number">1.5.8.</span> <span class="toc-text">更新附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%99%84%E4%BB%B6"><span class="toc-number">1.5.9.</span> <span class="toc-text">删除附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.5.10.</span> <span class="toc-text">写入 Blob 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.5.11.</span> <span class="toc-text">读取 Blob 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%89%E5%85%B3%E7%B3%BB%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E8%A1%8C"><span class="toc-number">1.5.12.</span> <span class="toc-text">获取按关系类关联的行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B3%E7%B3%BB"><span class="toc-number">1.5.13.</span> <span class="toc-text">创建关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%B3%E7%B3%BB"><span class="toc-number">1.5.14.</span> <span class="toc-text">删除关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E5%85%A5%E6%B8%B8%E6%A0%87"><span class="toc-number">1.5.15.</span> <span class="toc-text">使用插入游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-RowBuffer-%E5%9C%A8%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0"><span class="toc-number">1.5.16.</span> <span class="toc-text">使用 RowBuffer 在注记要素类中创建新的注记要素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">版本控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%88%B0%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.1.</span> <span class="toc-text">连接到版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E7%8B%AC%E7%9A%84%E7%BC%96%E8%BE%91%E4%BC%9A%E8%AF%9D%E4%B8%AD%E5%8D%8F%E8%B0%83%E7%89%88%E6%9C%AC%E5%B9%B6%E5%B0%86%E5%85%B6%E4%B8%8E%E5%85%B6%E7%88%B6%E7%BA%A7%E8%BF%9B%E8%A1%8C%E6%A0%B8%E5%AF%B9%E5%92%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">在单独的编辑会话中协调版本并将其与其父级进行核对和提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%90%8C%E4%B8%80%E7%BC%96%E8%BE%91%E4%BC%9A%E8%AF%9D%E4%B8%AD%E5%8D%8F%E8%B0%83%E7%89%88%E6%9C%AC%E5%B9%B6%E5%B0%86%E5%85%B6%E4%B8%8E%E5%85%B6%E7%88%B6%E7%BA%A7%E6%8F%90%E4%BA%A4"><span class="toc-number">1.6.3.</span> <span class="toc-text">在同一编辑会话中协调版本并将其与其父级提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.4.</span> <span class="toc-text">使用版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.5.</span> <span class="toc-text">使用默认版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.6.</span> <span class="toc-text">创建版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.7.</span> <span class="toc-text">创建历史版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E5%88%87%E6%8D%A2"><span class="toc-number">1.6.8.</span> <span class="toc-text">在版本之间切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E8%BF%87%E8%B4%A6"><span class="toc-number">1.6.9.</span> <span class="toc-text">部分过账</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL"><span class="toc-number">1.7.</span> <span class="toc-text">DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.2.</span> <span class="toc-text">创建要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">1.7.3.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.4.</span> <span class="toc-text">删除要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.5.</span> <span class="toc-text">打开内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.6.</span> <span class="toc-text">创建内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.7.</span> <span class="toc-text">删除内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.8.</span> <span class="toc-text">创建文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.9.</span> <span class="toc-text">删除文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A7%BB%E5%8A%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.10.</span> <span class="toc-text">创建移动地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%A7%BB%E5%8A%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.7.11.</span> <span class="toc-text">删除移动地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%8C%83%E5%9B%B4%E5%9F%9F"><span class="toc-number">1.7.12.</span> <span class="toc-text">创建范围域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BC%96%E7%A0%81%E5%80%BC%E5%9F%9F"><span class="toc-number">1.7.13.</span> <span class="toc-text">创建编码值域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.7.14.</span> <span class="toc-text">创建要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.7.15.</span> <span class="toc-text">删除要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.7.16.</span> <span class="toc-text">重命名要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E6%AC%A1%E6%93%8D%E4%BD%9C%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E8%A6%81%E7%B4%A0%E7%B1%BB%E7%9A%84%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.7.17.</span> <span class="toc-text">在一次操作中创建具有要素类的要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%8E%B0%E6%9C%89%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.18.</span> <span class="toc-text">在现有要素数据集中创建要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.7.19.</span> <span class="toc-text">将要素类添加到要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">1.7.20.</span> <span class="toc-text">重命名表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5"><span class="toc-number">1.7.21.</span> <span class="toc-text">向要素类添加字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BD%BF%E7%94%A8%E5%9F%9F%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">1.7.22.</span> <span class="toc-text">添加使用域的字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="toc-number">1.7.23.</span> <span class="toc-text">从表中删除字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.24.</span> <span class="toc-text">创建注记要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B3%E8%81%94%E8%A6%81%E7%B4%A0%E7%9A%84%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.25.</span> <span class="toc-text">创建关联要素的注记要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86%E5%86%85%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">1.7.26.</span> <span class="toc-text">在要素数据集内创建注记要素类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8B%93%E6%89%91%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="toc-number">1.8.</span> <span class="toc-text">地理数据库拓扑代码段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E6%8B%93%E6%89%91%E5%92%8C%E8%BF%9B%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">开放拓扑和进程定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8B%93%E6%89%91%E8%A7%84%E5%88%99"><span class="toc-number">1.8.2.</span> <span class="toc-text">获取拓扑规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%8B%93%E6%89%91"><span class="toc-number">1.8.3.</span> <span class="toc-text">验证拓扑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8B%93%E6%89%91%E9%94%99%E8%AF%AF"><span class="toc-number">1.8.4.</span> <span class="toc-text">获取拓扑错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MarkAndUnmarkAsErrors"><span class="toc-number">1.8.5.</span> <span class="toc-text">MarkAndUnmarkAsErrors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">1.8.6.</span> <span class="toc-text">探索拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FindClosestElement"><span class="toc-number">1.8.7.</span> <span class="toc-text">FindClosestElement</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By shaozhy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img class="icp-icon" src="/img/icp.png"><span>冀ICP备2023009991号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'd990e8cbbd1dabc9c98e',
      clientSecret: '59676d5926f4df676ec1ba6b36395bf90a0aeb54',
      repo: 'WineMonk.github.io',
      owner: 'WineMonk',
      admin: ['WineMonk'],
      id: '00ed3a124b427af517f7ba0b27bd2a92',
      updateCountCallback: commentCount
    },{"proxy":"https://vercel.prohibitorum.top/github_access_token"}))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="茶飘香,酒罢去,聚朋友,再回楼" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>