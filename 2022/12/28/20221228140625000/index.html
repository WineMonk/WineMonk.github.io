<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ArcGIS Pro SDK 地图创作 | WineMonk</title><meta name="keywords" content="CSharp,ArcGIS Pro SDK"><meta name="author" content="shaozhy,1361151272@qq.com"><meta name="copyright" content="shaozhy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="地图创作地图获取活动地图1Map map &#x3D; MapView.Active.Map;  使用默认底图图层创建新地图12345await QueuedTask.Run(() &#x3D;&gt;&amp;#123;  var map &#x3D; MapFactory.Instance.CreateMap(mapName, basemap: Basemap.ProjectDefault);  &#x2F;&#x2F;TODO: use the m">
<meta property="og:type" content="article">
<meta property="og:title" content="ArcGIS Pro SDK 地图创作">
<meta property="og:url" content="https://shaoshao.net.cn/2022/12/28/20221228140625000/index.html">
<meta property="og:site_name" content="WineMonk">
<meta property="og:description" content="地图创作地图获取活动地图1Map map &#x3D; MapView.Active.Map;  使用默认底图图层创建新地图12345await QueuedTask.Run(() &#x3D;&gt;&amp;#123;  var map &#x3D; MapFactory.Instance.CreateMap(mapName, basemap: Basemap.ProjectDefault);  &#x2F;&#x2F;TODO: use the m">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_14.jpg">
<meta property="article:published_time" content="2022-12-28T06:06:25.000Z">
<meta property="article:modified_time" content="2023-04-14T01:28:34.000Z">
<meta property="article:author" content="shaozhy">
<meta property="article:tag" content="CSharp">
<meta property="article:tag" content="ArcGIS Pro SDK">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_14.jpg"><link rel="shortcut icon" href="/cover/head_portrait.jpg"><link rel="canonical" href="https://shaoshao.net.cn/2022/12/28/20221228140625000/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ArcGIS Pro SDK 地图创作',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-14 09:28:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://shaoshao.net.cn/images/blog/cover/headportrait/shsh_cn.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/discover/archives/"><div class="headline">文章</div><div class="length-num">170</div></a></div><div class="data-item"><a href="/discover/tags/"><div class="headline">标签</div><div class="length-num">108</div></a></div><div class="data-item"><a href="/discover/categories/"><div class="headline">分类</div><div class="length-num">80</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_14.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">WineMonk</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ArcGIS Pro SDK 地图创作</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-28T06:06:25.000Z" title="发表于 2022-12-28 14:06:25">2022-12-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-14T01:28:34.000Z" title="更新于 2023-04-14 09:28:34">2023-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/">GIS相关</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>93分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ArcGIS Pro SDK 地图创作"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="地图创作"><a href="#地图创作" class="headerlink" title="地图创作"></a>地图创作</h1><h2 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h2><h3 id="获取活动地图"><a href="#获取活动地图" class="headerlink" title="获取活动地图"></a>获取活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map map = MapView.Active.Map;</span><br></pre></td></tr></table></figure>

<h3 id="使用默认底图图层创建新地图"><a href="#使用默认底图图层创建新地图" class="headerlink" title="使用默认底图图层创建新地图"></a>使用默认底图图层创建新地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> map = MapFactory.Instance.CreateMap(mapName, basemap: Basemap.ProjectDefault);</span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span> use the map...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在工程中查找地图并将其打开"><a href="#在工程中查找地图并将其打开" class="headerlink" title="在工程中查找地图并将其打开"></a>在工程中查找地图并将其打开</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;Map&gt; <span class="title">FindOpenExistingMapAsync</span>(<span class="params"><span class="built_in">string</span> mapName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    Map map = <span class="literal">null</span>;</span><br><span class="line">    Project proj = Project.Current;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Finding the first project item with name matches with mapName</span></span><br><span class="line">    MapProjectItem mpi =</span><br><span class="line">        proj.GetItems&lt;MapProjectItem&gt;()</span><br><span class="line">            .FirstOrDefault(m =&gt; m.Name.Equals(mapName, StringComparison.CurrentCultureIgnoreCase));</span><br><span class="line">    <span class="keyword">if</span> (mpi != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      map = mpi.GetMap();</span><br><span class="line">      <span class="comment">//Opening the map in a mapview</span></span><br><span class="line">      <span class="keyword">await</span> ProApp.Panes.CreateMapPaneAsync(map);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开-web-地图"><a href="#打开-web-地图" class="headerlink" title="打开 web 地图"></a>打开 web 地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map map = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Assume we get the selected webmap from the Project pane&#x27;s Portal tab</span></span><br><span class="line"><span class="keyword">if</span> (Project.Current.SelectedItems.Count &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (MapFactory.Instance.CanCreateMapFrom(Project.Current.SelectedItems[<span class="number">0</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">    map = MapFactory.Instance.CreateMapFromItem(Project.Current.SelectedItems[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">await</span> ProApp.Panes.CreateMapPaneAsync(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取地图窗格"><a href="#获取地图窗格" class="headerlink" title="获取地图窗格"></a>获取地图窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">IEnumerable</span>&lt;<span class="title">IMapPane</span>&gt; <span class="title">GetMapPanes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sorted by Map Uri</span></span><br><span class="line">  <span class="keyword">return</span> ProApp.Panes.OfType&lt;IMapPane&gt;().OrderBy((mp) =&gt; mp.MapView.Map.URI ?? mp.MapView.Map.Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地图窗格中获取唯一的地图列表"><a href="#从地图窗格中获取唯一的地图列表" class="headerlink" title="从地图窗格中获取唯一的地图列表"></a>从地图窗格中获取唯一的地图列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IReadOnlyList&lt;Map&gt; <span class="title">GetMapsFromMapPanes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Gets the unique list of Maps from all the MapPanes.</span></span><br><span class="line">  <span class="comment">//Note: The list of maps retrieved from the MapPanes</span></span><br><span class="line">  <span class="comment">//maybe less than the total number of Maps in the project.</span></span><br><span class="line">  <span class="comment">//It depends on what maps the user has actually opened.</span></span><br><span class="line">  <span class="keyword">var</span> mapPanes = ProApp.Panes.OfType&lt;IMapPane&gt;()</span><br><span class="line">              .GroupBy((mp) =&gt; mp.MapView.Map.URI).Select(grp =&gt; grp.FirstOrDefault());</span><br><span class="line">  List&lt;Map&gt; uniqueMaps = <span class="keyword">new</span> List&lt;Map&gt;();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> pane <span class="keyword">in</span> mapPanes)</span><br><span class="line">    uniqueMaps.Add(pane.MapView.Map);</span><br><span class="line">  <span class="keyword">return</span> uniqueMaps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改地图名称"><a href="#更改地图名称" class="headerlink" title="更改地图名称"></a>更改地图名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MapView.Active.Map.SetName(<span class="string">&quot;Test&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="重命名窗格的标题"><a href="#重命名窗格的标题" class="headerlink" title="重命名窗格的标题"></a>重命名窗格的标题</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProApp.Panes.ActivePane.Caption = <span class="string">&quot;Caption&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="将地图转换为局部场景"><a href="#将地图转换为局部场景" class="headerlink" title="将地图转换为局部场景"></a>将地图转换为局部场景</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within the context of QueuedTask.Run</span></span><br><span class="line"><span class="built_in">bool</span> canConvertMap = MapFactory.Instance.CanConvertMap(map, MapConversionType.SceneLocal);</span><br><span class="line"><span class="keyword">if</span> (canConvertMap)</span><br><span class="line">  MapFactory.Instance.ConvertMap(map, MapConversionType.SceneLocal, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取底图"><a href="#获取底图" class="headerlink" title="获取底图"></a>获取底图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Basemaps stored locally in the project. This is usually an empty collection</span></span><br><span class="line"><span class="built_in">string</span> localBasemapTypeID = <span class="string">&quot;cim_map_basemap&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> localBasemaps = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;Map&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> mapContainer.GetItems().Where(i =&gt; i.TypeID == localBasemapTypeID).ToList();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//portal basemaps. If there is no current active portal, the usual default</span></span><br><span class="line"><span class="comment">//is arcgis online</span></span><br><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetActivePortal();</span><br><span class="line"><span class="keyword">var</span> portalBaseMaps = <span class="keyword">await</span> portal.GetBasemapsAsync();</span><br><span class="line"></span><br><span class="line"><span class="comment">//use one of them...local or portal...</span></span><br><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//QueuedTask.Run(() =&gt; map?.SetBasemapLayers(portalBaseMaps[0]));</span></span><br></pre></td></tr></table></figure>

<h3 id="将地图另存为-MapX"><a href="#将地图另存为-MapX" class="headerlink" title="将地图另存为 MapX"></a>将地图另存为 MapX</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.SaveAsFile(<span class="string">@&quot;C:\Data\MyMap.mapx&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将-2D-地图另存为-Web-地图-在磁盘上"><a href="#将-2D-地图另存为-Web-地图-在磁盘上" class="headerlink" title="将 2D 地图另存为 Web 地图 在磁盘上"></a>将 2D 地图另存为 Web 地图 在磁盘上</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2D maps only</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run(...)</span></span><br><span class="line"><span class="keyword">if</span> (map.DefaultViewingMode == MapViewingMode.Map)</span><br><span class="line">  <span class="comment">//Only webmap compatible layers will be saved out to the file</span></span><br><span class="line">  map.SaveAsWebMapFile(<span class="string">@&quot;C:\Data\MyMap.json&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="裁剪映射到提供的裁剪多边形"><a href="#裁剪映射到提供的裁剪多边形" class="headerlink" title="裁剪映射到提供的裁剪多边形"></a>裁剪映射到提供的裁剪多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Run within QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//A layer to use for the clip extent</span></span><br><span class="line"><span class="keyword">var</span> lyrOfInterest = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().Where(l =&gt; l.Name == <span class="string">&quot;TestPoly&quot;</span>).FirstOrDefault();</span><br><span class="line"><span class="comment">//Get the polygon to use to clip the map</span></span><br><span class="line"><span class="keyword">var</span> extent = lyrOfInterest.QueryExtent();</span><br><span class="line"><span class="keyword">var</span> polygonForClipping = PolygonBuilderEx.CreatePolygon(extent);</span><br><span class="line"><span class="comment">//Clip the map using the layer&#x27;s extent</span></span><br><span class="line">map.SetClipGeometry(polygonForClipping,</span><br><span class="line">    SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">      SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">        ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.Dash)));</span><br></pre></td></tr></table></figure>

<h3 id="清除当前地图剪辑几何"><a href="#清除当前地图剪辑几何" class="headerlink" title="清除当前地图剪辑几何"></a>清除当前地图剪辑几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Run within QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//Clear the Map clip.</span></span><br><span class="line"><span class="comment">//If no clipping is set then this is a no-op.</span></span><br><span class="line">map.ClearClipGeometry();</span><br></pre></td></tr></table></figure>

<h3 id="获取地图裁剪几何"><a href="#获取地图裁剪几何" class="headerlink" title="获取地图裁剪几何"></a>获取地图裁剪几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//If clipping is set to ArcGIS.Core.CIM.ClippingMode.None or ArcGIS.Core.CIM.ClippingMode.MapSeries null is returned</span></span><br><span class="line"><span class="comment">//If clipping is set to ArcGIS.Core.CIM.ClippingMode.MapExtent the ArcGIS.Core.CIM.CIMMap.CustomFullExtent is returned.</span></span><br><span class="line"><span class="comment">//Otherwise, if clipping is set to ArcGIS.Core.CIM.ClippingMode.CustomShape the custom clip polygon is returned.</span></span><br><span class="line"><span class="keyword">var</span> poly = map.GetClipGeometry();</span><br><span class="line"><span class="comment">//You can use the polygon returned</span></span><br><span class="line"><span class="comment">//For example: We make a polygon graphic element and add it to a Graphics Layer.</span></span><br><span class="line"><span class="keyword">var</span> gl = map.GetLayersAsFlattenedList().OfType&lt;GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (gl == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> polygonSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line"><span class="keyword">var</span> cimGraphicElement = <span class="keyword">new</span> CIMPolygonGraphic</span><br><span class="line">&#123;</span><br><span class="line">  Polygon = poly,</span><br><span class="line">  Symbol = polygonSymbol.MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">gl.AddElement(cimGraphicElement);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图位置单元"><a href="#获取当前地图位置单元" class="headerlink" title="获取当前地图位置单元"></a>获取当前地图位置单元</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the current location unit</span></span><br><span class="line"><span class="keyword">var</span> loc_unit = map.GetLocationUnitFormat();</span><br><span class="line"><span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;loc_unit.DisplayName&#125;</span>, <span class="subst">&#123;loc_unit.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(line);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用的地图位置单位列表"><a href="#获取可用的地图位置单位列表" class="headerlink" title="获取可用的地图位置单位列表"></a>获取可用的地图位置单位列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Linear location unit formats are not included if the map sr</span></span><br><span class="line"><span class="comment">//is geographic.</span></span><br><span class="line"><span class="keyword">var</span> loc_units = map.GetAvailableLocationUnitFormats();</span><br></pre></td></tr></table></figure>

<h3 id="使用当前地图位置单元设置位置格式"><a href="#使用当前地图位置单元设置位置格式" class="headerlink" title="使用当前地图位置单元设置位置格式"></a>使用当前地图位置单元设置位置格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the current view camera location</span></span><br><span class="line">  <span class="keyword">var</span> center_pt = <span class="keyword">new</span> Coordinate2D(mv.Camera.X, mv.Camera.Y);</span><br><span class="line">  <span class="comment">//Get the current location unit</span></span><br><span class="line">  <span class="keyword">var</span> loc_unit = map.GetLocationUnitFormat();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Format the camera location</span></span><br><span class="line">  <span class="keyword">var</span> str = loc_unit.FormatLocation(center_pt, map.SpatialReference);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;Formatted location: <span class="subst">&#123;str&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图的位置单位"><a href="#设置当前地图的位置单位" class="headerlink" title="设置当前地图的位置单位"></a>设置当前地图的位置单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the list of available location unit formats</span></span><br><span class="line">  <span class="comment">//for the current map</span></span><br><span class="line">  <span class="keyword">var</span> loc_units = map.GetAvailableLocationUnitFormats();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//arbitrarily use the last unit in the list</span></span><br><span class="line">  map.SetLocationUnitFormat(loc_units.Last());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图高程单位"><a href="#获取当前地图高程单位" class="headerlink" title="获取当前地图高程单位"></a>获取当前地图高程单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//If the map is not a scene, the default Project distance</span></span><br><span class="line"><span class="comment">//unit will be returned</span></span><br><span class="line"><span class="keyword">var</span> elev_unit = map.GetElevationUnitFormat();</span><br><span class="line"><span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;elev_unit.DisplayName&#125;</span>, <span class="subst">&#123;elev_unit.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(line);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用的地图高程单位列表"><a href="#获取可用的地图高程单位列表" class="headerlink" title="获取可用的地图高程单位列表"></a>获取可用的地图高程单位列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//If the map is not a scene, the list of current</span></span><br><span class="line"><span class="comment">//Project distance units will be returned</span></span><br><span class="line"><span class="keyword">var</span> elev_units = map.GetAvailableElevationUnitFormats();</span><br></pre></td></tr></table></figure>

<h3 id="使用当前地图高程单位设置高程格式"><a href="#使用当前地图高程单位设置高程格式" class="headerlink" title="使用当前地图高程单位设置高程格式"></a>使用当前地图高程单位设置高程格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the current elevation unit. If the map is not</span></span><br><span class="line">  <span class="comment">//a scene the default Project distance unit is returned</span></span><br><span class="line">  <span class="keyword">var</span> elev_unit = map.GetElevationUnitFormat();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Format the view camera elevation</span></span><br><span class="line">  <span class="keyword">var</span> str = elev_unit.FormatValue(mv.Camera.Z);</span><br><span class="line"></span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;Formatted elevation: <span class="subst">&#123;str&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图的高程单位"><a href="#设置当前地图的高程单位" class="headerlink" title="设置当前地图的高程单位"></a>设置当前地图的高程单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Trying to set the elevation unit on a map other than</span></span><br><span class="line">  <span class="comment">//a scene will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">if</span> (map.IsScene)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the list of available elevation unit formats</span></span><br><span class="line">    <span class="comment">//for the current map</span></span><br><span class="line">    <span class="keyword">var</span> loc_units = map.GetAvailableElevationUnitFormats();</span><br><span class="line">    <span class="comment">//arbitrarily use the last unit in the list</span></span><br><span class="line">    map.SetElevationUnitFormat(loc_units.Last());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="离线地图"><a href="#离线地图" class="headerlink" title="离线地图"></a>离线地图</h2><h3 id="检查地图是否具有启用同步的内容"><a href="#检查地图是否具有启用同步的内容" class="headerlink" title="检查地图是否具有启用同步的内容"></a>检查地图是否具有启用同步的内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> hasSyncEnabledContent = GenerateOfflineMap.Instance.GetCanGenerateReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (hasSyncEnabledContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO - use status...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="为启用同步的内容生成副本"><a href="#为启用同步的内容生成副本" class="headerlink" title="为启用同步的内容生成副本"></a>为启用同步的内容生成副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has sync-enabled content that can be taken offline</span></span><br><span class="line">  <span class="keyword">var</span> hasSyncEnabledContent = GenerateOfflineMap.Instance.GetCanGenerateReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (hasSyncEnabledContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Generate Replicas and take the content offline</span></span><br><span class="line">    <span class="comment">//sync-enabled content gets copied local into a SQLite DB</span></span><br><span class="line">    <span class="keyword">var</span> gen_params = <span class="keyword">new</span> GenerateReplicaParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent, <span class="comment">//SR of extent must match map SR</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//DestinationFolder can be left blank, if specified,</span></span><br><span class="line">      <span class="comment">//it must exist. Defaults to project offline maps location</span></span><br><span class="line">      DestinationFolder = <span class="string">@&quot;C:\Data\Offline&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//Sync-enabled layer content will be resourced to point to the</span></span><br><span class="line">    <span class="comment">//local replica content.</span></span><br><span class="line">    GenerateOfflineMap.Instance.GenerateReplicas(map, gen_params);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查地图是否具有本地可同步内容"><a href="#检查地图是否具有本地可同步内容" class="headerlink" title="检查地图是否具有本地可同步内容"></a>检查地图是否具有本地可同步内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="keyword">var</span> canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canSyncContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO - use status</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="同步可同步内容的副本"><a href="#同步可同步内容的副本" class="headerlink" title="同步可同步内容的副本"></a>同步可同步内容的副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="keyword">var</span> canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canSyncContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Sync Replicas - changes since last sync are pushed to the</span></span><br><span class="line">    <span class="comment">//parent replica. Parent changes are pulled to the client.</span></span><br><span class="line">    <span class="comment">//Unsaved edits are _not_ sync&#x27;d. </span></span><br><span class="line">    GenerateOfflineMap.Instance.SynchronizeReplicas(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除可同步内容的副本"><a href="#删除可同步内容的副本" class="headerlink" title="删除可同步内容的副本"></a>删除可同步内容的副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="comment">//Either..</span></span><br><span class="line">  <span class="comment">//var canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span></span><br><span class="line">  <span class="comment">//Or...both accomplish the same thing...</span></span><br><span class="line">  <span class="keyword">var</span> canRemove = GenerateOfflineMap.Instance.GetCanRemoveReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canRemove)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Remove Replicas - any unsync&#x27;d changes are lost</span></span><br><span class="line">    <span class="comment">//Call sync _first_ to push any outstanding changes if</span></span><br><span class="line">    <span class="comment">//needed. Local syncable content is re-sourced</span></span><br><span class="line">    <span class="comment">//to point to the service</span></span><br><span class="line">    GenerateOfflineMap.Instance.RemoveReplicas(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="导出地图栅格切片缓存内容"><a href="#导出地图栅格切片缓存内容" class="headerlink" title="导出地图栅格切片缓存内容"></a>导出地图栅格切片缓存内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Does the map have any exportable raster content?</span></span><br><span class="line">  <span class="keyword">var</span> canExport = GenerateOfflineMap.Instance.GetCanExportRasterTileCache(map);</span><br><span class="line">  <span class="keyword">if</span> (canExport)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Check the available LOD scale ranges</span></span><br><span class="line">    <span class="keyword">var</span> scales = GenerateOfflineMap.Instance.GetExportRasterTileCacheScales(map, extent);</span><br><span class="line">    <span class="comment">//Pick the desired LOD scale</span></span><br><span class="line">    <span class="keyword">var</span> max_scale = scales[scales.Count() / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Configure the export parameters</span></span><br><span class="line">    <span class="keyword">var</span> export_params = <span class="keyword">new</span> ExportTileCacheParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent,<span class="comment">//Use same extent as was used to retrieve scales</span></span><br><span class="line">      MaximumUserDefinedScale = max_scale</span><br><span class="line">      <span class="comment">//DestinationFolder = .... (optional)</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//If DestinationFolder is not set, output defaults to project</span></span><br><span class="line">    <span class="comment">//offline maps location set in the project properties. If that is </span></span><br><span class="line">    <span class="comment">//not set, output defaults to the current project folder location.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Do the export. Depending on the MaximumUserDefinedScale and the</span></span><br><span class="line">    <span class="comment">//area of the extent requested, this can take minutes for tile packages</span></span><br><span class="line">    <span class="comment">//over 1 GB or less if your network speed is slow...</span></span><br><span class="line">    GenerateOfflineMap.Instance.ExportRasterTileCache(map, export_params);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="导出地图矢量切片缓存内容"><a href="#导出地图矢量切片缓存内容" class="headerlink" title="导出地图矢量切片缓存内容"></a>导出地图矢量切片缓存内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Does the map have any exportable vector tile content?</span></span><br><span class="line">  <span class="keyword">var</span> canExport = GenerateOfflineMap.Instance.GetCanExportVectorTileCache(map);</span><br><span class="line">  <span class="keyword">if</span> (canExport)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Check the available LOD scale ranges</span></span><br><span class="line">    <span class="keyword">var</span> scales = GenerateOfflineMap.Instance.GetExportVectorTileCacheScales(map, extent);</span><br><span class="line">    <span class="comment">//Pick the desired LOD scale</span></span><br><span class="line">    <span class="keyword">var</span> max_scale = scales[scales.Count() / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Configure the export parameters</span></span><br><span class="line">    <span class="keyword">var</span> export_params = <span class="keyword">new</span> ExportTileCacheParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent,<span class="comment">//Use same extent as was used to retrieve scales</span></span><br><span class="line">      MaximumUserDefinedScale = max_scale,</span><br><span class="line">      DestinationFolder = <span class="string">@&quot;C:\Data\Offline&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//If DestinationFolder is not set, output defaults to project</span></span><br><span class="line">    <span class="comment">//offline maps location set in the project properties. If that is </span></span><br><span class="line">    <span class="comment">//not set, output defaults to the current project folder location.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Do the export. Depending on the MaximumUserDefinedScale and the</span></span><br><span class="line">    <span class="comment">//area of the extent requested, this can take minutes for tile packages</span></span><br><span class="line">    <span class="comment">//over 1 GB or less if your network speed is slow...</span></span><br><span class="line">    GenerateOfflineMap.Instance.ExportVectorTileCache(map, export_params);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建图层"><a href="#创建图层" class="headerlink" title="创建图层"></a>创建图层</h2><h3 id="创建图层并将其添加到活动地图"><a href="#创建图层并将其添加到活动地图" class="headerlink" title="创建图层并将其添加到活动地图"></a>创建图层并将其添加到活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\project.gdb\DEM&quot;;  //Raster dataset from a FileGeodatabase</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\connections\mySDEConnection.sde\roads&quot;;  //FeatureClass of a SDE</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\connections\mySDEConnection.sde\States\roads&quot;;  //FeatureClass within a FeatureDataset from a SDE</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\roads.shp&quot;;  //Shapefile</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\imagery.tif&quot;;  //Image from a folder</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\mySDEConnection.sde\roads&quot;;  //.lyrx or .lpkx file</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\CAD\Charlottesville\N1W1.dwg\Polyline&quot;;  //FeatureClass in a CAD dwg file</span></span><br><span class="line"><span class="comment">* string url = @&quot;C:\data\CAD\UrbanHouse.rvt\Architectural\Windows&quot;; //Features in a Revit file</span></span><br><span class="line"><span class="comment">* string url = @&quot;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer&quot;;  //map service</span></span><br><span class="line"><span class="comment">* string url = @&quot;http://sampleserver6.arcgisonline.com/arcgis/rest/services/NapervilleShelters/FeatureServer/0&quot;;  //FeatureLayer off a map service or feature service</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;c:\data\project.gdb\roads&quot;</span>;  <span class="comment">//FeatureClass of a FileGeodatabase</span></span><br><span class="line"></span><br><span class="line">Uri uri = <span class="keyword">new</span> Uri(url);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; LayerFactory.Instance.CreateLayer(uri, MapView.Active.Map));</span><br></pre></td></tr></table></figure>

<h3 id="使用创建参数创建图层"><a href="#使用创建参数创建图层" class="headerlink" title="使用创建参数创建图层"></a>使用创建参数创建图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flyrCreatnParam = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\world.gdb\cities&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;World Cities&quot;</span>,</span><br><span class="line">  IsVisible = <span class="literal">false</span>,</span><br><span class="line">  MinimumScale = <span class="number">1000000</span>,</span><br><span class="line">  MaximumScale = <span class="number">5000</span>,</span><br><span class="line">  <span class="comment">// At 2.x - DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line">  <span class="comment">//&#123;</span></span><br><span class="line">  <span class="comment">//  DefinitionExpression = &quot;Population &gt; 100000&quot;,</span></span><br><span class="line">  <span class="comment">//  Name = &quot;More than 100k&quot;</span></span><br><span class="line">  <span class="comment">//&#125;,</span></span><br><span class="line">  DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;Population &gt; 100000&quot;</span>, name: <span class="string">&quot;More than 100k&quot;</span>),</span><br><span class="line">  RendererDefinition = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">      CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> featureLayer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">  flyrCreatnParam, map);</span><br></pre></td></tr></table></figure>

<h3 id="创建要素图层并使用图层创建参数添加到地图"><a href="#创建要素图层并使用图层创建参数添加到地图" class="headerlink" title="创建要素图层并使用图层创建参数添加到地图"></a>创建要素图层并使用图层创建参数添加到地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> layerDoc = <span class="keyword">new</span> LayerDocument(<span class="string">@&quot;E:\Data\SDK\Default2DPointSymbols.lyrx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> LayerCreationParams(layerDoc.GetCIMLayerDocument());</span><br><span class="line">LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(createParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="创建要素图层并设置为不显示在地图中。"><a href="#创建要素图层并设置为不显示在地图中。" class="headerlink" title="创建要素图层并设置为不显示在地图中。"></a>创建要素图层并设置为不显示在地图中。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUriVisibility = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="keyword">var</span> layerParamsVisibility = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUriVisibility)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set visibility</span></span><br><span class="line">  IsVisible = <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFC = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParamsVisibility, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="使用渲染器创建要素图层"><a href="#使用渲染器创建要素图层" class="headerlink" title="使用渲染器创建要素图层"></a>使用渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Define a simple renderer to draw the Point US Cities feature class.</span></span><br><span class="line"><span class="keyword">var</span> simpleRender = <span class="keyword">new</span> SimpleRendererDefinition</span><br><span class="line">&#123;</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">4.0</span>, SimpleMarkerStyle.Circle).MakeSymbolReference()</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUri = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="keyword">var</span> layerParams = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUri)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set visibility</span></span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//Set Renderer</span></span><br><span class="line">  RendererDefinition = simpleRender,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFCWithRenderer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="使用查询定义创建要素图层"><a href="#使用查询定义创建要素图层" class="headerlink" title="使用查询定义创建要素图层"></a>使用查询定义创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUriDefinition = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="comment">//At 2.x - var layerParamsQueryDefn = new FeatureLayerCreationParams(featureClassUriDefinition)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  IsVisible = true,</span></span><br><span class="line"><span class="comment">//  DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//    Name = &quot;CACities&quot;,</span></span><br><span class="line"><span class="comment">//    DefinitionExpression = &quot;STATE_NAME = &#x27;California&#x27;&quot;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="keyword">var</span> layerParamsQueryDefn = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUriDefinition)</span><br><span class="line">&#123;</span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">  DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;STATE_NAME = &#x27;California&#x27;&quot;</span>, name: <span class="string">&quot;CACities&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFCWithQueryDefn = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParamsQueryDefn, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="将地图注释添加到活动地图"><a href="#将地图注释添加到活动地图" class="headerlink" title="将地图注释添加到活动地图"></a>将地图注释添加到活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets the collection of layer template packages installed with Pro for use with maps</span></span><br><span class="line"><span class="keyword">var</span> items = MapView.Active.Map.LayerTemplatePackages;</span><br><span class="line"><span class="comment">//Iterate through the collection of items to add each Map Note to the active map</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> items)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create a parameter item for the map note</span></span><br><span class="line">  <span class="keyword">var</span> layer_params = <span class="keyword">new</span> LayerCreationParams(item);</span><br><span class="line">  layer_params.IsVisible = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Create a feature layer for the map note</span></span><br><span class="line">    <span class="keyword">var</span> layer = LayerFactory.Instance.CreateLayer&lt;Layer&gt;(layer_params, MapView.Active.Map);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用目录中图层的符号系统"><a href="#应用目录中图层的符号系统" class="headerlink" title="应用目录中图层的符号系统"></a>应用目录中图层的符号系统</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">if</span> (MapView.Active.Map == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get an existing Layer. This layer has a symbol you want to use in a new layer.</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;()</span><br><span class="line">      .Where(l =&gt; l.ShapeType == esriGeometryType.esriGeometryPoint).FirstOrDefault();</span><br><span class="line"><span class="comment">//This is the renderer to use in the new Layer</span></span><br><span class="line"><span class="keyword">var</span> renderer = lyr.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line"><span class="comment">//Set the Dataconnection for the new layer</span></span><br><span class="line">Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">  <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;E:\Data\Admin\AdminData.gdb&quot;</span>)));</span><br><span class="line">FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;Cities&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> dataConnection = featureClass.GetDataConnection();</span><br><span class="line"><span class="comment">//Create the definition for the new feature layer</span></span><br><span class="line"><span class="keyword">var</span> featureLayerParams = <span class="keyword">new</span> FeatureLayerCreationParams(dataConnection)</span><br><span class="line">&#123;</span><br><span class="line">  RendererDefinition = <span class="keyword">new</span> SimpleRendererDefinition(renderer.Symbol),</span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//create the new layer</span></span><br><span class="line">LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">  featureLayerParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="创建新的子类型图层组"><a href="#创建新的子类型图层组" class="headerlink" title="创建新的子类型图层组"></a>创建新的子类型图层组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subtypeGroupLayerCreateParam = <span class="keyword">new</span> SubtypeGroupLayerCreationParams</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\SubtypeAndDomain.gdb\Fittings&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define Subtype layers</span></span><br><span class="line"><span class="comment">//At 2.x - var rendererDefn1 = new UniqueValueRendererDefinition(new string[] &#123; &quot;type&quot; &#125;);</span></span><br><span class="line"><span class="keyword">var</span> rendererDefn1 = <span class="keyword">new</span> UniqueValueRendererDefinition(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;type&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> renderDefn2 = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">          CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">subtypeGroupLayerCreateParam.SubtypeLayers = <span class="keyword">new</span> List&lt;SubtypeFeatureLayerCreationParams&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//define first subtype layer with unique value renderer</span></span><br><span class="line">  <span class="comment">//At 2.x - new SubtypeFeatureLayerCreationParams(new UniqueValueRendererDefinition(new string[] &#123; &quot;type&quot; &#125;), 1),</span></span><br><span class="line">  <span class="keyword">new</span> SubtypeFeatureLayerCreationParams(<span class="keyword">new</span> UniqueValueRendererDefinition(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;type&quot;</span> &#125;), <span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">//define second subtype layer with simple symbol renderer</span></span><br><span class="line">  <span class="keyword">new</span> SubtypeFeatureLayerCreationParams(renderDefn2, <span class="number">2</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define additional parameters</span></span><br><span class="line"><span class="comment">//At - 2.x subtypeGroupLayerCreateParam.DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  Name = &quot;IsActive&quot;,</span></span><br><span class="line"><span class="comment">//  DefinitionExpression = &quot;Enabled = 1&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line">subtypeGroupLayerCreateParam.DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;Enabled = 1&quot;</span>, name: <span class="string">&quot;IsActive&quot;</span>);</span><br><span class="line">subtypeGroupLayerCreateParam.IsVisible = <span class="literal">true</span>;</span><br><span class="line">subtypeGroupLayerCreateParam.MinimumScale = <span class="number">50000</span>;</span><br><span class="line"></span><br><span class="line">SubtypeGroupLayer subtypeGroupLayer2 = LayerFactory.Instance.CreateLayer&lt;SubtypeGroupLayer&gt;(</span><br><span class="line">              subtypeGroupLayerCreateParam, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="从-lyrx-文件创建图层"><a href="#从-lyrx-文件创建图层" class="headerlink" title="从 lyrx 文件创建图层"></a>从 lyrx 文件创建图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyrDocFromLyrxFile = <span class="keyword">new</span> LayerDocument(<span class="string">@&quot;d:\data\cities.lyrx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//modifying its renderer symbol to red</span></span><br><span class="line"><span class="keyword">var</span> r = ((CIMFeatureLayer)cimLyrDoc.LayerDefinitions[<span class="number">0</span>]).Renderer <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">r.Symbol.Symbol.SetColor(<span class="keyword">new</span> CIMRGBColor() &#123; R = <span class="number">255</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//optionally save the updates out as a file</span></span><br><span class="line">lyrDocFromLyrxFile.Save(<span class="string">@&quot;c:\data\cities_red.lyrx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//get a json representation of the layer document and you want store away...</span></span><br><span class="line"><span class="keyword">var</span> aJSONString = lyrDocFromLyrxFile.AsJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">//... and load it back when needed</span></span><br><span class="line">lyrDocFromLyrxFile.Load(aJSONString);</span><br><span class="line">cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a layer and add it to a map</span></span><br><span class="line"><span class="keyword">var</span> lcp = <span class="keyword">new</span> LayerCreationParams(cimLyrDoc);</span><br><span class="line"><span class="keyword">var</span> lyr = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(lcp, map);</span><br></pre></td></tr></table></figure>

<h3 id="将符号系统应用于图层文件中的图层"><a href="#将符号系统应用于图层文件中的图层" class="headerlink" title="将符号系统应用于图层文件中的图层"></a>将符号系统应用于图层文件中的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within QueuedTask.Run</span></span><br><span class="line"><span class="comment">//Get the Layer Document from the lyrx file</span></span><br><span class="line"><span class="keyword">var</span> lyrDocFromLyrxFile = <span class="keyword">new</span> LayerDocument(layerFile);</span><br><span class="line"><span class="keyword">var</span> cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the renderer from the layer file</span></span><br><span class="line"><span class="keyword">var</span> rendererFromLayerFile = ((CIMFeatureLayer)cimLyrDoc.LayerDefinitions[<span class="number">0</span>]).Renderer <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Apply the renderer to the feature layer</span></span><br><span class="line"><span class="comment">//Note: If working with a raster layer, use the SetColorizer method.</span></span><br><span class="line">featureLayer?.SetRenderer(rendererFromLayerFile);</span><br></pre></td></tr></table></figure>

<h3 id="添加-WMS-服务"><a href="#添加-WMS-服务" class="headerlink" title="添加 WMS 服务"></a>添加 WMS 服务</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a connection to the WMS server</span></span><br><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection &#123; URL = <span class="string">&quot;URL of the WMS service&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> CIMWMSServiceConnection &#123; ServerConnection = serverConnection &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a new layer to the map</span></span><br><span class="line"><span class="keyword">var</span> layerParams = <span class="keyword">new</span> LayerCreationParams(connection);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> layer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParams, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="添加-WFS-服务"><a href="#添加-WFS-服务" class="headerlink" title="添加 WFS 服务"></a>添加 WFS 服务</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CIMStandardDataConnection cIMStandardDataConnection = <span class="keyword">new</span> CIMStandardDataConnection()</span><br><span class="line">&#123;</span><br><span class="line">  WorkspaceConnectionString = <span class="string">@&quot;SWAPXY=TRUE;SWAPXYFILTER=FALSE;URL=http://sampleserver6.arcgisonline.com/arcgis/services/SampleWorldCities/MapServer/WFSServer;VERSION=2.0.0&quot;</span>,</span><br><span class="line">  WorkspaceFactory = WorkspaceFactory.WFS,</span><br><span class="line">  Dataset = <span class="string">&quot;Continent&quot;</span>,</span><br><span class="line">  DatasetType = esriDatasetType.esriDTFeatureClass</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a new layer to the map</span></span><br><span class="line"><span class="keyword">var</span> layerPamsDC = <span class="keyword">new</span> LayerCreationParams(cIMStandardDataConnection);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Layer layer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerPamsDC, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="添加和更改-WMS-服务图层的样式"><a href="#添加和更改-WMS-服务图层的样式" class="headerlink" title="添加和更改 WMS 服务图层的样式"></a>添加和更改 WMS 服务图层的样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection &#123; URL = <span class="string">&quot;https://spritle.esri.com/arcgis/services/sanfrancisco_sld/MapServer/WMSServer&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> CIMWMSServiceConnection &#123; ServerConnection = serverConnection &#125;;</span><br><span class="line">LayerCreationParams parameters = <span class="keyword">new</span> LayerCreationParams(connection);</span><br><span class="line">parameters.MapMemberPosition = MapMemberPosition.AddToBottom;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> compositeLyr = LayerFactory.Instance.CreateLayer&lt;WMSLayer&gt;(parameters, MapView.Active.Map);</span><br><span class="line">  <span class="comment">//wms layer in ArcGIS Pro always has a composite layer inside it</span></span><br><span class="line">  <span class="keyword">var</span> wmsLayers = compositeLyr.Layers[<span class="number">0</span>] <span class="keyword">as</span> ServiceCompositeSubLayer;</span><br><span class="line">  <span class="comment">//each wms sublayer belongs in that composite layer</span></span><br><span class="line">  <span class="keyword">var</span> highwayLayerWMSSub = wmsLayers.Layers[<span class="number">1</span>] <span class="keyword">as</span> WMSSubLayer;</span><br><span class="line">  <span class="comment">//toggling a sublayer&#x27;s visibility</span></span><br><span class="line">  <span class="keyword">if</span> ((highwayLayerWMSSub != <span class="literal">null</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bool</span> visibility = highwayLayerWMSSub.IsVisible;</span><br><span class="line">    highwayLayerWMSSub.SetVisibility(!visibility);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//applying an existing style to a wms sub layer</span></span><br><span class="line">  <span class="keyword">var</span> pizzaLayerWMSSub = wmsLayers.Layers[<span class="number">0</span>] <span class="keyword">as</span> WMSSubLayer;</span><br><span class="line">  <span class="keyword">var</span> currentStyles = pizzaLayerWMSSub.GetStyleNames();</span><br><span class="line">  pizzaLayerWMSSub.SetStyleName(currentStyles[<span class="number">1</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建查询图层"><a href="#创建查询图层" class="headerlink" title="创建查询图层"></a>创建查询图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Map map = MapView.Active.Map;</span><br><span class="line">  Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Connections\mySDE.sde&quot;</span>)));</span><br><span class="line">  CIMSqlQueryDataConnection sqldc = <span class="keyword">new</span> CIMSqlQueryDataConnection()</span><br><span class="line">  &#123;</span><br><span class="line">    WorkspaceConnectionString = geodatabase.GetConnectionString(),</span><br><span class="line">    GeometryType = esriGeometryType.esriGeometryPolygon,</span><br><span class="line">    OIDFields = <span class="string">&quot;OBJECTID&quot;</span>,</span><br><span class="line">    Srid = <span class="string">&quot;102008&quot;</span>,</span><br><span class="line">    SqlQuery = <span class="string">&quot;select * from MySDE.dbo.STATES&quot;</span>,</span><br><span class="line">    Dataset = <span class="string">&quot;States&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> lcp = <span class="keyword">new</span> LayerCreationParams(sqldc)</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;States&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  FeatureLayer flyr = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(lcp, map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用默认值分类间隔渲染器创建要素图层"><a href="#使用默认值分类间隔渲染器创建要素图层" class="headerlink" title="使用默认值分类间隔渲染器创建要素图层"></a>使用默认值分类间隔渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> featureLayerCreationParams = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\countydata.gdb\counties&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Population Density (sq mi) Year 2010&quot;</span>,</span><br><span class="line">    RendererDefinition = <span class="keyword">new</span> GraduatedColorsRendererDefinition(<span class="string">&quot;POP10_SQMI&quot;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">    featureLayerCreationParams,</span><br><span class="line">    MapView.Active.Map</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用分类间隔渲染器创建要素图层"><a href="#使用分类间隔渲染器创建要素图层" class="headerlink" title="使用分类间隔渲染器创建要素图层"></a>使用分类间隔渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ColorBrewer Schemes (RGB)&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Greens (Continuous)&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  GraduatedColorsRendererDefinition gcDef = <span class="keyword">new</span> GraduatedColorsRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    ClassificationField = <span class="string">&quot;CROP_ACR07&quot;</span>,</span><br><span class="line">    ClassificationMethod = ArcGIS.Core.CIM.ClassificationMethod.NaturalBreaks,</span><br><span class="line">    BreakCount = <span class="number">6</span>,</span><br><span class="line">    ColorRamp = colorRamp.ColorRamp,</span><br><span class="line">    SymbolTemplate = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                            ColorFactory.Instance.GreenRGB, SimpleFillStyle.Solid, <span class="literal">null</span>).MakeSymbolReference(),</span><br><span class="line">    ExclusionClause = <span class="string">&quot;CROP_ACR07 = -99&quot;</span>,</span><br><span class="line">    ExclusionSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                            ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, <span class="literal">null</span>).MakeSymbolReference(),</span><br><span class="line">    ExclusionLabel = <span class="string">&quot;No yield&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> featureLayerCreationParams = <span class="keyword">new</span> FeatureLayerCreationParams((<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\Data\CountyData.gdb\Counties&quot;</span>)))</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Crop&quot;</span>,</span><br><span class="line">    RendererDefinition = gcDef</span><br><span class="line">  &#125;;</span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(featureLayerCreationParams, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="底图图层"><a href="#底图图层" class="headerlink" title="底图图层"></a>底图图层</h2><h3 id="更新地图的底图图层"><a href="#更新地图的底图图层" class="headerlink" title="更新地图的底图图层"></a>更新地图的底图图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aMap.SetBasemapLayers(Basemap.Gray);</span><br></pre></td></tr></table></figure>

<h3 id="从地图中移除底图图层"><a href="#从地图中移除底图图层" class="headerlink" title="从地图中移除底图图层"></a>从地图中移除底图图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aMap.SetBasemapLayers(Basemap.None);</span><br></pre></td></tr></table></figure>

<h2 id="使用图层"><a href="#使用图层" class="headerlink" title="使用图层"></a>使用图层</h2><h3 id="从地图中获取按图层类型过滤的图层列表"><a href="#从地图中获取按图层类型过滤的图层列表" class="headerlink" title="从地图中获取按图层类型过滤的图层列表"></a>从地图中获取按图层类型过滤的图层列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeatureLayer&gt; featureLayerList = aMap.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().ToList();</span><br></pre></td></tr></table></figure>

<h3 id="获取特定几何类型的图层"><a href="#获取特定几何类型的图层" class="headerlink" title="获取特定几何类型的图层"></a>获取特定几何类型的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get an existing Layer. This layer has a symbol you want to use in a new layer.</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;()</span><br><span class="line">      .Where(l =&gt; l.ShapeType == esriGeometryType.esriGeometryPoint).FirstOrDefault();</span><br></pre></td></tr></table></figure>

<h3 id="查找图层"><a href="#查找图层" class="headerlink" title="查找图层"></a>查找图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Finds layers by name and returns a read only list of Layers</span></span><br><span class="line">IReadOnlyList&lt;Layer&gt; layers = aMap.FindLayers(<span class="string">&quot;cities&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Finds a layer using a URI.</span></span><br><span class="line"><span class="comment">//The Layer URI you pass in helps you search for a specific layer in a map</span></span><br><span class="line"><span class="keyword">var</span> lyrFindLayer = MapView.Active.Map.FindLayer(<span class="string">&quot;CIMPATH=map/u_s__states__generalized_.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//This returns a collection of layers of the &quot;name&quot; specified. You can use any Linq expression to query the collection.  </span></span><br><span class="line"><span class="keyword">var</span> lyrExists = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                   .OfType&lt;FeatureLayer&gt;().Any(f =&gt; f.Name == <span class="string">&quot;U.S. States (Generalized)&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查找独立表"><a href="#查找独立表" class="headerlink" title="查找独立表"></a>查找独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// these routines find a standalone table whether it is a child of the Map or a GroupLayer</span></span><br><span class="line"><span class="keyword">var</span> tblFind = aMap.FindStandaloneTable(<span class="string">&quot;CIMPATH=map/address_audit.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;StandaloneTable&gt; tables = aMap.FindStandaloneTables(<span class="string">&quot;addresses&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// this method finds a standalone table as a child of the map only</span></span><br><span class="line"><span class="keyword">var</span> table = aMap.StandaloneTables.FirstOrDefault(t =&gt; t.Name == <span class="string">&quot;Addresses&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用部分名称搜索查找图层"><a href="#使用部分名称搜索查找图层" class="headerlink" title="使用部分名称搜索查找图层"></a>使用部分名称搜索查找图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map map = MapView.Active.Map;</span><br><span class="line">IEnumerable&lt;Layer&gt; matches = map.GetLayersAsFlattenedList().Where(l =&gt; l.Name.IndexOf(partialName, StringComparison.CurrentCultureIgnoreCase) &gt;= <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="更改图层可见性、可编辑性、捕捉性"><a href="#更改图层可见性、可编辑性、捕捉性" class="headerlink" title="更改图层可见性、可编辑性、捕捉性"></a>更改图层可见性、可编辑性、捕捉性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!layer.IsVisible)</span><br><span class="line">  layer.SetVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (layer <span class="keyword">is</span> FeatureLayer featureLayer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsEditable)</span><br><span class="line">    featureLayer.SetEditable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsSnappable)</span><br><span class="line">    featureLayer.SetSnappable(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-Lyrx-文件"><a href="#创建-Lyrx-文件" class="headerlink" title="创建 Lyrx 文件"></a>创建 Lyrx 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LayerDocument layerDocument = <span class="keyword">new</span> LayerDocument(layer);</span><br><span class="line">layerDocument.Save(<span class="string">@&quot;c:\Data\MyLayerDocument.lyrx&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="计算图层上所选要素的数量"><a href="#计算图层上所选要素的数量" class="headerlink" title="计算图层上所选要素的数量"></a>计算图层上所选要素的数量</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> noFeaturesSelected = lyr.SelectionCount;</span><br></pre></td></tr></table></figure>

<h3 id="访问图层的显示字段"><a href="#访问图层的显示字段" class="headerlink" title="访问图层的显示字段"></a>访问图层的显示字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM definition from the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimFeatureDefinition = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">// get the view of the source table underlying the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimDisplayTable = cimFeatureDefinition.FeatureTable;</span><br><span class="line">  <span class="comment">// this field is used as the &#x27;label&#x27; to represent the row</span></span><br><span class="line">  <span class="keyword">var</span> displayField = cimDisplayTable.DisplayField;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在图层上启用标注"><a href="#在图层上启用标注" class="headerlink" title="在图层上启用标注"></a>在图层上启用标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// toggle the label visibility</span></span><br><span class="line">  featureLayer.SetLabelVisibility(!featureLayer.IsLabelVisible);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将-2D-组中的图层移动到局部场景中的-3D-组"><a href="#将-2D-组中的图层移动到局部场景中的-3D-组" class="headerlink" title="将 2D 组中的图层移动到局部场景中的 3D 组"></a>将 2D 组中的图层移动到局部场景中的 3D 组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer in the 2D group to move to the 3D Group in a Local Scene</span></span><br><span class="line"><span class="keyword">var</span> layer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">  <span class="keyword">var</span> lyrDefn = layer.GetDefinition() <span class="keyword">as</span> CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">//setting this property moves the layer to 3D group in a scene</span></span><br><span class="line">  lyrDefn.IsFlattened = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">//Set the definition back to the layer</span></span><br><span class="line">  layer.SetDefinition(lyrDefn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="重置要素服务图层的-URL"><a href="#重置要素服务图层的-URL" class="headerlink" title="重置要素服务图层的 URL"></a>重置要素服务图层的 URL</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CIMStandardDataConnection dataConnection = dataConnectionLayer.GetDataConnection() <span class="keyword">as</span> CIMStandardDataConnection;</span><br><span class="line">dataConnection.WorkspaceConnectionString = newConnectionString;</span><br><span class="line">dataConnectionLayer.SetDataConnection(dataConnection);</span><br></pre></td></tr></table></figure>

<h3 id="更改要素图层的基础数据源-相同的工作空间类型"><a href="#更改要素图层的基础数据源-相同的工作空间类型" class="headerlink" title="更改要素图层的基础数据源 - 相同的工作空间类型"></a>更改要素图层的基础数据源 - 相同的工作空间类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//This is the existing layer for which we want to switch the underlying datasource</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> connectionStringToReplace = lyr.GetFeatureClass().GetDatastore().GetConnectionString();</span><br><span class="line">  <span class="built_in">string</span> databaseConnectionPath = <span class="string">@&quot;Path to the .sde connection file to replace with&quot;</span>;</span><br><span class="line">  <span class="comment">//If the new SDE connection did not have a dataset with the same name as in the feature layer,</span></span><br><span class="line">  <span class="comment">//pass false for the validate parameter of the FindAndReplaceWorkspacePath method to achieve this. </span></span><br><span class="line">  <span class="comment">//If validate is true and the SDE did not have a dataset with the same name, </span></span><br><span class="line">  <span class="comment">//FindAndReplaceWorkspacePath will return failure</span></span><br><span class="line">  lyr.FindAndReplaceWorkspacePath(connectionStringToReplace, databaseConnectionPath, <span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将图层的地理数据库版本更改为地图中的指定版本"><a href="#将图层的地理数据库版本更改为地图中的指定版本" class="headerlink" title="将图层的地理数据库版本更改为地图中的指定版本"></a>将图层的地理数据库版本更改为地图中的指定版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Getting the current version name from the first feature layer of the map</span></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">          .OfType&lt;FeatureLayer&gt;().FirstOrDefault();  <span class="comment">//first feature layer</span></span><br><span class="line">  Datastore dataStore = flyr.GetFeatureClass().GetDatastore();  <span class="comment">//getting datasource</span></span><br><span class="line">  Geodatabase geodatabase = dataStore <span class="keyword">as</span> Geodatabase; <span class="comment">//casting to Geodatabase</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  VersionManager versionManager = geodatabase.GetVersionManager();</span><br><span class="line">  ArcGIS.Core.Data.Version currentVersion = versionManager.GetCurrentVersion();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Getting all available versions except the current one</span></span><br><span class="line">  IEnumerable&lt;ArcGIS.Core.Data.Version&gt; versions = versionManager.GetVersions()</span><br><span class="line">          .Where(v =&gt; !v.GetName().Equals(currentVersion.GetName(), StringComparison.CurrentCultureIgnoreCase));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Assuming there is at least one other version we pick the first one from the list</span></span><br><span class="line">  ArcGIS.Core.Data.Version toVersion = versions.FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (toVersion != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Changing version</span></span><br><span class="line">    MapView.Active.Map.ChangeVersion(currentVersion, toVersion);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查询要素图层"><a href="#查询要素图层" class="headerlink" title="查询要素图层"></a>查询要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  QueryFilter qf = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    WhereClause = <span class="string">&quot;Class = &#x27;city&#x27;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Getting the first selected feature layer of the map view</span></span><br><span class="line">  <span class="keyword">var</span> flyr = (FeatureLayer)MapView.Active.GetSelectedLayers()</span><br><span class="line">                    .OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">using</span> (RowCursor rows = flyr.Search(qf)) <span class="comment">//execute</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Looping through to count</span></span><br><span class="line">    <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (rows.MoveNext()) i++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">MessageBox.Show(String.Format(</span><br><span class="line">   <span class="string">&quot;Total features that matched the search criteria: &#123;0&#125;&quot;</span>, count));</span><br></pre></td></tr></table></figure>

<h3 id="获取图层的属性旋转字段"><a href="#获取图层的属性旋转字段" class="headerlink" title="获取图层的属性旋转字段"></a>获取图层的属性旋转字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> cimRenderer = featureLayer.GetRenderer() <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line">  <span class="keyword">var</span> cimRotationVariable = cimRenderer.VisualVariables.OfType&lt;CIMRotationVisualVariable&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">var</span> rotationInfoZ = cimRotationVariable.VisualVariableInfoZ;</span><br><span class="line">  <span class="keyword">var</span> rotationExpression = rotationInfoZ.ValueExpressionInfo.Expression; <span class="comment">// this expression stores the field name  </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查找要旋转的连接属性字段"><a href="#查找要旋转的连接属性字段" class="headerlink" title="查找要旋转的连接属性字段"></a>查找要旋转的连接属性字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM renderer from the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimRenderer = featureLayer.GetRenderer() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMSimpleRenderer;</span><br><span class="line">  <span class="comment">// get the collection of connected attributes for rotation</span></span><br><span class="line">  <span class="keyword">var</span> cimRotationVariable = cimRenderer.VisualVariables.OfType&lt;ArcGIS.Core.CIM.CIMRotationVisualVariable&gt;().FirstOrDefault();</span><br><span class="line">  <span class="comment">// the z direction is describing the heading rotation</span></span><br><span class="line">  <span class="keyword">var</span> rotationInfoZ = cimRotationVariable.VisualVariableInfoZ;</span><br><span class="line">  <span class="keyword">var</span> rotationExpression = rotationInfoZ.Expression; <span class="comment">// this expression stores the field name  </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="切换“设置参考比例时缩放图层符号”"><a href="#切换“设置参考比例时缩放图层符号”" class="headerlink" title="切换“设置参考比例时缩放图层符号”"></a>切换“设置参考比例时缩放图层符号”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM layer definition</span></span><br><span class="line">  <span class="keyword">var</span> cimFeatureLayer = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMFeatureLayer;</span><br><span class="line">  <span class="comment">// turn on the option to scale the symbols in this layer based in the map&#x27;s reference scale</span></span><br><span class="line">  cimFeatureLayer.ScaleSymbols = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置图层缓存"><a href="#设置图层缓存" class="headerlink" title="设置图层缓存"></a>设置图层缓存</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// change the layer cache type to maximum age</span></span><br><span class="line">  <span class="comment">//At 2.x - featureLayer.SetDisplayCacheType(ArcGIS.Core.CIM.DisplayCacheType.MaxAge);</span></span><br><span class="line">  featureLayer.SetCacheOptions(LayerCacheType.MaxAge);</span><br><span class="line">  <span class="comment">// change from the default 5 min to 2 min</span></span><br><span class="line">  featureLayer.SetDisplayCacheMaxAge(TimeSpan.FromMinutes(<span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更改图层选择颜色"><a href="#更改图层选择颜色" class="headerlink" title="更改图层选择颜色"></a>更改图层选择颜色</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM definition of the layer</span></span><br><span class="line">  <span class="keyword">var</span> layerDef = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">// disable the default symbol</span></span><br><span class="line">  layerDef.UseSelectionSymbol = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// assign a new color</span></span><br><span class="line">  layerDef.SelectionColor = ColorFactory.Instance.RedRGB;</span><br><span class="line">  <span class="comment">// apply the definition to the layer</span></span><br><span class="line">  featureLayer.SetDefinition(layerDef);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsVisible) </span><br><span class="line">    featureLayer.SetVisibility(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">//Do a selection</span></span><br><span class="line"></span><br><span class="line">  MapView.Active.SelectFeatures(MapView.Active.Extent);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除所有未选中的图层"><a href="#删除所有未选中的图层" class="headerlink" title="删除所有未选中的图层"></a>删除所有未选中的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get the group layers first</span></span><br><span class="line">IReadOnlyList&lt;GroupLayer&gt; groupLayers = map.Layers.OfType&lt;GroupLayer&gt;().ToList();</span><br><span class="line"><span class="comment">//Iterate and remove the layers within the group layers that are unchecked.</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> groupLayer <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get layers that not visible within the group</span></span><br><span class="line">  <span class="keyword">var</span> layers = groupLayer.Layers.Where(l =&gt; l.IsVisible == <span class="literal">false</span>).ToList();</span><br><span class="line">  <span class="comment">//Remove all the layers that are not visible within the group</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayers(layers));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Group Layers that are empty and are unchecked</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">group</span>.Layers.Count == <span class="number">0</span> &amp;&amp; <span class="keyword">group</span>.IsVisible == <span class="literal">false</span>) <span class="comment">//No layers in the group</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//remove the group</span></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayer(<span class="keyword">group</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get Layers that are NOT Group layers and are unchecked</span></span><br><span class="line"><span class="keyword">var</span> notAGroupAndUnCheckedLayers = map.Layers.Where(l =&gt; !(l <span class="keyword">is</span> GroupLayer) &amp;&amp; l.IsVisible == <span class="literal">false</span>).ToList();</span><br><span class="line"><span class="comment">//Remove all the non group layers that are not visible</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayers(notAGroupAndUnCheckedLayers));</span><br></pre></td></tr></table></figure>

<h3 id="删除空组"><a href="#删除空组" class="headerlink" title="删除空组"></a>删除空组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get the group layers</span></span><br><span class="line">IReadOnlyList&lt;GroupLayer&gt; groupLayers = map.Layers.OfType&lt;GroupLayer&gt;().ToList();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">group</span>.Layers.Count == <span class="number">0</span>) <span class="comment">//No layers in the group</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//remove the group</span></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayer(<span class="keyword">group</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在地图定义中创建缩写字典并将其应用于图层"><a href="#在地图定义中创建缩写字典并将其应用于图层" class="headerlink" title="在地图定义中创建缩写字典并将其应用于图层"></a>在地图定义中创建缩写字典并将其应用于图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateDictionary</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the map&#x27;s defintion</span></span><br><span class="line">  <span class="keyword">var</span> mapDefn = MapView.Active.Map.GetDefinition();</span><br><span class="line">  <span class="comment">//Get the Map&#x27;s Maplex labelling engine properties</span></span><br><span class="line">  <span class="keyword">var</span> mapDefnPlacementProps = mapDefn.GeneralPlacementProperties <span class="keyword">as</span> CIMMaplexGeneralPlacementProperties;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Define the abbreaviations we need in an array            </span></span><br><span class="line">  List&lt;CIMMaplexDictionaryEntry&gt; abbreviationDictionary = <span class="keyword">new</span> List&lt;CIMMaplexDictionaryEntry&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionaryEntry &#123;</span><br><span class="line">            Abbreviation = <span class="string">&quot;Hts&quot;</span>,</span><br><span class="line">            Text = <span class="string">&quot;Heights&quot;</span>,</span><br><span class="line">            MaplexAbbreviationType = MaplexAbbreviationType.Ending</span><br><span class="line"></span><br><span class="line">         &#125;,</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionaryEntry</span><br><span class="line">            &#123;</span><br><span class="line">                Abbreviation = <span class="string">&quot;Ct&quot;</span>,</span><br><span class="line">                Text = <span class="string">&quot;Text&quot;</span>,</span><br><span class="line">                MaplexAbbreviationType = MaplexAbbreviationType.Ending</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//etc</span></span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="comment">//The Maplex Dictionary - can hold multiple Abbreviation collections</span></span><br><span class="line">  <span class="keyword">var</span> maplexDictionary = <span class="keyword">new</span> List&lt;CIMMaplexDictionary&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionary &#123;</span><br><span class="line">                Name = <span class="string">&quot;NameEndingsAbbreviations&quot;</span>,</span><br><span class="line">                MaplexDictionary = abbreviationDictionary.ToArray()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="comment">//Set the Maplex Label Engine Dictionary property to the Maplex Dictionary collection created above.</span></span><br><span class="line">  mapDefnPlacementProps.Dictionaries = maplexDictionary.ToArray();</span><br><span class="line">  <span class="comment">//Set the Map defintion </span></span><br><span class="line">  MapView.Active.Map.SetDefinition(mapDefn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ApplyDictionary</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().First();</span><br><span class="line"></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Creates Abbreviation dictionary and adds to Map Defintion                                </span></span><br><span class="line">    CreateDictionary();</span><br><span class="line">    <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">    <span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line">    <span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line">    <span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line">    <span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line">    <span class="comment">//Modify label Placement props to use abbreviation dictionary </span></span><br><span class="line">    CIMGeneralPlacementProperties labelEngine = MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.DictionaryName = <span class="string">&quot;NameEndingsAbbreviations&quot;</span>;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.CanAbbreviateLabel = <span class="literal">true</span>;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.CanStackLabel = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//Set the labelClasses back</span></span><br><span class="line">    lyrDefn.LabelClasses = listLabelClasses.ToArray();</span><br><span class="line">    <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">    featureLayer.SetDefinition(lyrDefn);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性表-ITablePane"><a href="#属性表-ITablePane" class="headerlink" title="属性表 - ITablePane"></a>属性表 - ITablePane</h2><h3 id="设置属性表的缩放级别"><a href="#设置属性表的缩放级别" class="headerlink" title="设置属性表的缩放级别"></a>设置属性表的缩放级别</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> currentZoomLevel = tablePane.ZoomLevel;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newZoomLevel = currentZoomLevel + <span class="number">50</span>;</span><br><span class="line">  tablePane.SetZoomLevel(newZoomLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检索属性表中所选像元的值"><a href="#检索属性表中所选像元的值" class="headerlink" title="检索属性表中所选像元的值"></a>检索属性表中所选像元的值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapMember = tablePane.MapMember;</span><br><span class="line">  <span class="keyword">var</span> oid = tablePane.ActiveObjectID;</span><br><span class="line">  <span class="keyword">if</span> (oid.HasValue &amp;&amp; oid.Value != <span class="number">-1</span> &amp;&amp; mapMember != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> activeField = tablePane.ActiveColumn;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run&lt;<span class="built_in">object</span>&gt;(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> Use core objects to retrieve record and get value</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="移动到特定行"><a href="#移动到特定行" class="headerlink" title="移动到特定行"></a>移动到特定行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// move to first row</span></span><br><span class="line">  tablePane.BringIntoView(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// move to sixth row</span></span><br><span class="line">  tablePane.BringIntoView(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h2 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h2><h3 id="获取和设置地图元数据"><a href="#获取和设置地图元数据" class="headerlink" title="获取和设置地图元数据"></a>获取和设置地图元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get map&#x27;s metadata</span></span><br><span class="line"><span class="keyword">var</span> mapMetadata = map.GetMetadata();</span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>Make edits to metadata using the retrieved mapMetadata string.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the modified metadata back to the map.</span></span><br><span class="line"><span class="keyword">if</span> (map.GetCanEditMetadata())</span><br><span class="line">  map.SetMetadata(mapMetadata);</span><br></pre></td></tr></table></figure>

<h3 id="图层元数据"><a href="#图层元数据" class="headerlink" title="图层元数据"></a>图层元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MapMember mapMember = map.GetLayersAsFlattenedList().FirstOrDefault(); <span class="comment">//Search for only layers/tables here if needed.</span></span><br><span class="line"><span class="keyword">if</span> (mapMember == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Gets whether or not the MapMember stores its own metadata or uses metadata retrieved</span></span><br><span class="line"><span class="comment">//from its source. This method must be called on the MCT. Use QueuedTask.Run</span></span><br><span class="line"><span class="built_in">bool</span> doesUseSourceMetadata = mapMember.GetUseSourceMetadata();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sets whether or not the MapMember will use its own metadata or the metadata from</span></span><br><span class="line"><span class="comment">//its underyling source (if it has one). This method must be called on the MCT.</span></span><br><span class="line"><span class="comment">//Use QueuedTask.Run</span></span><br><span class="line">mapMember.SetUseSourceMetadata(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Does the MapMember supports metadata</span></span><br><span class="line"><span class="keyword">var</span> supportsMetadata = mapMember.SupportsMetadata;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get MapMember metadata</span></span><br><span class="line"><span class="keyword">var</span> metadatstring = mapMember.GetMetadata();</span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>Make edits to metadata using the retrieved mapMetadata string.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the modified metadata back to the mapmember (layer, table..)</span></span><br><span class="line"><span class="keyword">if</span> (mapMember.GetCanEditMetadata())</span><br><span class="line">  mapMember.SetMetadata(metadatstring);</span><br></pre></td></tr></table></figure>

<h2 id="渲染器"><a href="#渲染器" class="headerlink" title="渲染器"></a>渲染器</h2><h3 id="将唯一值渲染器设置为活动地图的所选要素图层"><a href="#将唯一值渲染器设置为活动地图的所选要素图层" class="headerlink" title="将唯一值渲染器设置为活动地图的所选要素图层"></a>将唯一值渲染器设置为活动地图的所选要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> fields = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Type&quot;</span> &#125;; <span class="comment">//field to be used to retrieve unique values</span></span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">            ColorFactory.Instance.GreenRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Pushpin);  <span class="comment">//constructing a point symbol as a template symbol</span></span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//constructing renderer definition for unique value renderer</span></span><br><span class="line">  UniqueValueRendererDefinition uniqueValueRendererDef =</span><br><span class="line">      <span class="keyword">new</span> UniqueValueRendererDefinition(fields, symbolPointTemplate);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//creating a unique value renderer</span></span><br><span class="line">  <span class="keyword">var</span> flyr = MapView.Active.GetSelectedLayers()[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMUniqueValueRenderer uniqueValueRenderer = flyr.CreateRenderer(uniqueValueRendererDef) <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setting the renderer to the feature layer</span></span><br><span class="line">  flyr.SetRenderer(uniqueValueRenderer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建一个唯一值呈现器以指定值的符号"><a href="#创建一个唯一值呈现器以指定值的符号" class="headerlink" title="创建一个唯一值呈现器以指定值的符号"></a>创建一个唯一值呈现器以指定值的符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//The goal is to construct the CIMUniqueValueRenderer which will be applied to the feature layer.</span></span><br><span class="line">  <span class="comment">// To do this, the following are the objects we need to set the renderer up with the fields and symbols.</span></span><br><span class="line">  <span class="comment">// As a reference, this is the USCities dataset. Snippet will create a unique value renderer that applies </span></span><br><span class="line">  <span class="comment">// specific symbols to all the cities in California and Alabama.  The rest of the cities will use a default symbol.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// First create a &quot;CIMUniqueValueClass&quot; for the cities in Alabama.</span></span><br><span class="line">  List&lt;CIMUniqueValue&gt; listUniqueValuesAlabama = <span class="keyword">new</span> List&lt;CIMUniqueValue&gt; &#123; <span class="keyword">new</span> CIMUniqueValue &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;Alabama&quot;</span> &#125; &#125; &#125;;</span><br><span class="line">  CIMUniqueValueClass alabamaUniqueValueClass = <span class="keyword">new</span> CIMUniqueValueClass</span><br><span class="line">  &#123;</span><br><span class="line">    Editable = <span class="literal">true</span>,</span><br><span class="line">    Label = <span class="string">&quot;Alabama&quot;</span>,</span><br><span class="line">    Patch = PatchShape.Default,</span><br><span class="line">    Symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB).MakeSymbolReference(),</span><br><span class="line">    Visible = <span class="literal">true</span>,</span><br><span class="line">    Values = listUniqueValuesAlabama.ToArray()</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Create a &quot;CIMUniqueValueClass&quot; for the cities in California.</span></span><br><span class="line">  List&lt;CIMUniqueValue&gt; listUniqueValuescalifornia = <span class="keyword">new</span> List&lt;CIMUniqueValue&gt; &#123; <span class="keyword">new</span> CIMUniqueValue &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;California&quot;</span> &#125; &#125; &#125;;</span><br><span class="line">  CIMUniqueValueClass californiaUniqueValueClass = <span class="keyword">new</span> CIMUniqueValueClass</span><br><span class="line">  &#123;</span><br><span class="line">    Editable = <span class="literal">true</span>,</span><br><span class="line">    Label = <span class="string">&quot;California&quot;</span>,</span><br><span class="line">    Patch = PatchShape.Default,</span><br><span class="line">    Symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.BlueRGB).MakeSymbolReference(),</span><br><span class="line">    Visible = <span class="literal">true</span>,</span><br><span class="line">    Values = listUniqueValuescalifornia.ToArray()</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//Create a list of the above two CIMUniqueValueClasses</span></span><br><span class="line">  List&lt;CIMUniqueValueClass&gt; listUniqueValueClasses = <span class="keyword">new</span> List&lt;CIMUniqueValueClass&gt;</span><br><span class="line">    &#123;</span><br><span class="line">                  alabamaUniqueValueClass, californiaUniqueValueClass</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="comment">//Create a list of CIMUniqueValueGroup</span></span><br><span class="line">  CIMUniqueValueGroup uvg = <span class="keyword">new</span> CIMUniqueValueGroup</span><br><span class="line">  &#123;</span><br><span class="line">    Classes = listUniqueValueClasses.ToArray(),</span><br><span class="line">  &#125;;</span><br><span class="line">  List&lt;CIMUniqueValueGroup&gt; listUniqueValueGroups = <span class="keyword">new</span> List&lt;CIMUniqueValueGroup&gt; &#123; uvg &#125;;</span><br><span class="line">  <span class="comment">//Create the CIMUniqueValueRenderer</span></span><br><span class="line">  CIMUniqueValueRenderer uvr = <span class="keyword">new</span> CIMUniqueValueRenderer</span><br><span class="line">  &#123;</span><br><span class="line">    UseDefaultSymbol = <span class="literal">true</span>,</span><br><span class="line">    DefaultLabel = <span class="string">&quot;all other values&quot;</span>,</span><br><span class="line">    DefaultSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreyRGB).MakeSymbolReference(),</span><br><span class="line">    Groups = listUniqueValueGroups.ToArray(),</span><br><span class="line">    Fields = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;STATE_NAME&quot;</span> &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//Set the feature layer&#x27;s renderer.</span></span><br><span class="line">  featureLayer.SetRenderer(uvr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建热图渲染器"><a href="#创建热图渲染器" class="headerlink" title="创建热图渲染器"></a>创建热图渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//defining a heatmap renderer that uses values from Population field as the weights</span></span><br><span class="line">  HeatMapRendererDefinition heatMapDef = <span class="keyword">new</span> HeatMapRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    Radius = <span class="number">20</span>,</span><br><span class="line">    WeightField = <span class="string">&quot;Population&quot;</span>,</span><br><span class="line">    ColorRamp = colorRamp.ColorRamp,</span><br><span class="line">    RendereringQuality = <span class="number">8</span>,</span><br><span class="line">    UpperLabel = <span class="string">&quot;High Density&quot;</span>,</span><br><span class="line">    LowerLabel = <span class="string">&quot;Low Density&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMHeatMapRenderer heatMapRndr = flyr.CreateRenderer(heatMapDef) <span class="keyword">as</span> CIMHeatMapRenderer;</span><br><span class="line">  flyr.SetRenderer(heatMapRndr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建未分类渲染器"><a href="#创建未分类渲染器" class="headerlink" title="创建未分类渲染器"></a>创建未分类渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Diamond);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//defining an unclassed renderer with custom upper and lower stops</span></span><br><span class="line">  <span class="comment">//all features with value &gt;= 5,000,000 will be drawn with the upper color from the color ramp</span></span><br><span class="line">  <span class="comment">//all features with value &lt;= 50,000 will be drawn with the lower color from the color ramp</span></span><br><span class="line">  UnclassedColorsRendererDefinition unclassRndrDef = <span class="keyword">new</span> UnclassedColorsRendererDefinition</span><br><span class="line">                              (<span class="string">&quot;Population&quot;</span>, symbolPointTemplate, colorRamp.ColorRamp, <span class="string">&quot;Highest&quot;</span>, <span class="string">&quot;Lowest&quot;</span>, <span class="number">5000000</span>, <span class="number">50000</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//drawing features with null values with a different symbol</span></span><br><span class="line">    ShowNullValues = <span class="literal">true</span>,</span><br><span class="line">    NullValueLabel = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  CIMPointSymbol nullSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  unclassRndrDef.NullValueSymbol = nullSym.MakeSymbolReference();</span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMClassBreaksRenderer cbRndr = flyr.CreateRenderer(unclassRndrDef) <span class="keyword">as</span> CIMClassBreaksRenderer;</span><br><span class="line">  flyr.SetRenderer(cbRndr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建最大和最小符号大小上限的比例渲染器"><a href="#创建最大和最小符号大小上限的比例渲染器" class="headerlink" title="创建最大和最小符号大小上限的比例渲染器"></a>创建最大和最小符号大小上限的比例渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//minimum symbol size is capped to 4 point while the maximum symbol size is set to 50 point</span></span><br><span class="line">  ProportionalRendererDefinition prDef = <span class="keyword">new</span> ProportionalRendererDefinition(<span class="string">&quot;POPULATION&quot;</span>, symbolPointTemplate, <span class="number">4</span>, <span class="number">50</span>, <span class="literal">true</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setting upper and lower size stops to stop symbols growing or shrinking beyond those thresholds</span></span><br><span class="line">    UpperSizeStop = <span class="number">5000000</span>,  <span class="comment">//features with values &gt;= 5,000,000 will be drawn with maximum symbol size</span></span><br><span class="line">    LowerSizeStop = <span class="number">50000</span>    <span class="comment">//features with values &lt;= 50,000 will be drawn with minimum symbol size</span></span><br><span class="line">  &#125;;</span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMProportionalRenderer propRndr = flyr.CreateRenderer(prDef) <span class="keyword">as</span> CIMProportionalRenderer;</span><br><span class="line">  flyr.SetRenderer(propRndr);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建真实比例渲染器"><a href="#创建真实比例渲染器" class="headerlink" title="创建真实比例渲染器"></a>创建真实比例渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Defining proportional renderer where size of symbol will be same as its value in field used in the renderer.</span></span><br><span class="line">  ProportionalRendererDefinition prDef = <span class="keyword">new</span> ProportionalRendererDefinition(<span class="string">&quot;POPULATION&quot;</span>, esriUnits.esriMeters, symbolPointTemplate, SymbolShapes.Square, ValueRepresentations.Radius);</span><br><span class="line"></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMProportionalRenderer propRndr = flyr.CreateRenderer(prDef) <span class="keyword">as</span> CIMProportionalRenderer;</span><br><span class="line">  flyr.SetRenderer(propRndr);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="拱廊"><a href="#拱廊" class="headerlink" title="拱廊"></a>拱廊</h2><h3 id="使用-Arcade-修改渲染器"><a href="#使用-Arcade-修改渲染器" class="headerlink" title="使用 Arcade 修改渲染器"></a>使用 Arcade 修改渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault(f =&gt; f.ShapeType == esriGeometryType.esriGeometryPolygon);</span><br><span class="line"><span class="keyword">if</span> (lyr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// GetRenderer from Layer (assumes it is a unique value renderer)</span></span><br><span class="line">  <span class="keyword">var</span> uvRenderer = lyr.GetRenderer() <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line">  <span class="keyword">if</span> (uvRenderer == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//layer has STATE_NAME field</span></span><br><span class="line">  <span class="comment">//community sample Data\Admin\AdminSample.aprx</span></span><br><span class="line">  <span class="built_in">string</span> expression = <span class="string">&quot;if ($view.scale &gt; 21000000) &#123; return $feature.STATE_NAME &#125; else &#123; return &#x27;All&#x27; &#125;&quot;</span>;</span><br><span class="line">  CIMExpressionInfo updatedExpressionInfo = <span class="keyword">new</span> CIMExpressionInfo</span><br><span class="line">  &#123;</span><br><span class="line">    Expression = expression,</span><br><span class="line">    Title = <span class="string">&quot;Custom&quot;</span> <span class="comment">// can be any string used for UI purpose.</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//set the renderer&#x27;s expression</span></span><br><span class="line">  uvRenderer.ValueExpressionInfo = updatedExpressionInfo;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//SetRenderer on Layer</span></span><br><span class="line">  lyr.SetRenderer(uvRenderer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用-Arcade-修改标注表达式"><a href="#使用-Arcade-修改标注表达式" class="headerlink" title="使用 Arcade 修改标注表达式"></a>使用 Arcade 修改标注表达式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault(f =&gt; f.ShapeType == esriGeometryType.esriGeometryPolygon);</span><br><span class="line"><span class="keyword">if</span> (lyr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">  <span class="comment">//community sample Data\Admin\AdminSample.aprx</span></span><br><span class="line">  <span class="keyword">var</span> lyrDefn = lyr.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line">  <span class="keyword">if</span> (lyrDefn == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line">  <span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line">  <span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line">  <span class="comment">//set the label class Expression to use the Arcade expression</span></span><br><span class="line">  theLabelClass.Expression = <span class="string">&quot;return $feature.STATE_NAME + TextFormatting.NewLine + $feature.POP2000;&quot;</span>;</span><br><span class="line">  <span class="comment">//Set the label definition back to the layer.</span></span><br><span class="line">  lyr.SetDefinition(lyrDefn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="高程表面图层"><a href="#高程表面图层" class="headerlink" title="高程表面图层"></a>高程表面图层</h2><h3 id="创建具有地表图层的场景"><a href="#创建具有地表图层的场景" class="headerlink" title="创建具有地表图层的场景"></a>创建具有地表图层的场景</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> scene = MapFactory.Instance.CreateScene(<span class="string">&quot;My scene&quot;</span>, groundSourceUri, MapViewingMode.SceneGlobal);</span><br></pre></td></tr></table></figure>

<h3 id="创建新的高程表面"><a href="#创建新的高程表面" class="headerlink" title="创建新的高程表面"></a>创建新的高程表面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Define a ServiceConnection to use for the new Elevation surface</span></span><br><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection</span><br><span class="line">&#123;</span><br><span class="line">  Anonymous = <span class="literal">true</span>,</span><br><span class="line">  HideUserProperty = <span class="literal">true</span>,</span><br><span class="line">  URL = <span class="string">&quot;https://elevation.arcgis.com/arcgis/services&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">CIMAGSServiceConnection serviceConnection = <span class="keyword">new</span> CIMAGSServiceConnection</span><br><span class="line">&#123;</span><br><span class="line">  ObjectName = <span class="string">&quot;WorldElevation/Terrain&quot;</span>,</span><br><span class="line">  ObjectType = <span class="string">&quot;ImageServer&quot;</span>,</span><br><span class="line">  URL = <span class="string">&quot;https://elevation.arcgis.com/arcgis/services/WorldElevation/Terrain/ImageServer&quot;</span>,</span><br><span class="line">  ServerConnection = serverConnection</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Defines a new elevation source set to the CIMAGSServiceConnection defined above</span></span><br><span class="line"><span class="comment">//At 2.x - var newElevationSource = new ArcGIS.Core.CIM.CIMElevationSource</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  VerticalUnit = ArcGIS.Core.Geometry.LinearUnit.Meters,</span></span><br><span class="line"><span class="comment">//  DataConnection = serviceConnection,</span></span><br><span class="line"><span class="comment">//  Name = &quot;WorldElevation/Terrain&quot;,</span></span><br><span class="line"><span class="comment">//  Visibility = true</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="comment">//The elevation surface</span></span><br><span class="line"><span class="comment">//At 2.x - var newElevationSurface = new ArcGIS.Core.CIM.CIMMapElevationSurface</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  Name = &quot;New Elevation Surface&quot;,</span></span><br><span class="line"><span class="comment">//  BaseSources = new ArcGIS.Core.CIM.CIMElevationSource[1] &#123; newElevationSource &#125;,</span></span><br><span class="line"><span class="comment">//  Visibility = true,</span></span><br><span class="line"><span class="comment">//  ElevationMode = ElevationMode.CustomSurface,</span></span><br><span class="line"><span class="comment">//  VerticalExaggeration = 1,</span></span><br><span class="line"><span class="comment">//  EnableSurfaceShading = false,</span></span><br><span class="line"><span class="comment">//  SurfaceTINShadingMode = SurfaceTINShadingMode.Smooth,</span></span><br><span class="line"><span class="comment">//  Expanded = false,</span></span><br><span class="line"><span class="comment">//  MapElevationID = &quot;&#123;3DEC3CC5-7C69-4132-A700-DCD5BDED14D6&#125;&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="comment">//Get the active map</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//Get the elevation surfaces defined in the map</span></span><br><span class="line"><span class="comment">//At 2.x - var listOfElevationSurfaces = definition.ElevationSurfaces.ToList();</span></span><br><span class="line"><span class="keyword">var</span> listOfElevationSurfaces = map.GetElevationSurfaceLayers();</span><br><span class="line"><span class="comment">//Add the new elevation surface </span></span><br><span class="line"><span class="comment">//At 2.x - listOfElevationSurfaces.Add(newElevationSurface);</span></span><br><span class="line"><span class="keyword">var</span> elevationLyrCreationParams = <span class="keyword">new</span> ElevationLayerCreationParams(serviceConnection);</span><br><span class="line"><span class="keyword">var</span> elevationSurface = LayerFactory.Instance.CreateLayer&lt;ElevationSurfaceLayer&gt;(</span><br><span class="line">       elevationLyrCreationParams, map);</span><br></pre></td></tr></table></figure>

<h3 id="将自定义高程表面设置为-Z-感知图层"><a href="#将自定义高程表面设置为-Z-感知图层" class="headerlink" title="将自定义高程表面设置为 Z 感知图层"></a>将自定义高程表面设置为 Z 感知图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Define the custom elevation surface to use</span></span><br><span class="line"><span class="comment">//At 2.x - var layerElevationSurface = new CIMLayerElevationSurface</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  MapElevationID = &quot;&#123;3DEC3CC5-7C69-4132-A700-DCD5BDED14D6&#125;&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="keyword">var</span> layerElevationSurface = <span class="keyword">new</span> CIMLayerElevationSurface</span><br><span class="line">&#123;</span><br><span class="line">  ElevationSurfaceLayerURI = <span class="string">&quot;https://elevation3d.arcgis.com/arcgis/services/WorldElevation3D/Terrain3D/ImageServer&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMBasicFeatureLayer;</span><br><span class="line"><span class="comment">//Set the layer&#x27;s elevation surface</span></span><br><span class="line">lyrDefn.LayerElevation = layerElevationSurface;</span><br><span class="line"><span class="comment">//Set the layer&#x27;s definition</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn);</span><br></pre></td></tr></table></figure>

<h3 id="将高程源添加到现有高程表面图层"><a href="#将高程源添加到现有高程表面图层" class="headerlink" title="将高程源添加到现有高程表面图层"></a>将高程源添加到现有高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in QueuendTask.Run</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// surfaceLayer could also be the ground layer</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> uri = <span class="string">&quot;https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> ElevationLayerCreationParams(<span class="keyword">new</span> Uri(uri));</span><br><span class="line">createParams.Name = <span class="string">&quot;Terrain 3D&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> eleSourceLayer = LayerFactory.Instance.CreateLayer&lt;Layer&gt;(createParams, surfaceLayer);</span><br></pre></td></tr></table></figure>

<h3 id="从地图中获取高程表面图层和高程源图层"><a href="#从地图中获取高程表面图层和高程源图层" class="headerlink" title="从地图中获取高程表面图层和高程源图层"></a>从地图中获取高程表面图层和高程源图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the elevation surface layers in the map including the Ground</span></span><br><span class="line"><span class="keyword">var</span> surfaceLayers = map.GetElevationSurfaceLayers();</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve the single ground elevation surface layer in the map</span></span><br><span class="line"><span class="keyword">var</span> groundSurfaceLayer = map.GetGroundElevationSurfaceLayer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// determine the number of elevation sources in the ground elevation surface layer</span></span><br><span class="line"><span class="built_in">int</span> numberGroundSources = groundSurfaceLayer.Layers.Count;</span><br><span class="line"><span class="comment">// get the first elevation source layer from the ground elevation surface layer</span></span><br><span class="line"><span class="keyword">var</span> groundSourceLayer = groundSurfaceLayer.Layers.FirstOrDefault();</span><br></pre></td></tr></table></figure>

<h3 id="查找高程表面图层"><a href="#查找高程表面图层" class="headerlink" title="查找高程表面图层"></a>查找高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> surfaceLayers = map.GetElevationSurfaceLayers();</span><br><span class="line"><span class="keyword">var</span> surfaceLayer = surfaceLayers.FirstOrDefault(l =&gt; l.Name == <span class="string">&quot;Surface2&quot;</span>);</span><br><span class="line"></span><br><span class="line">surfaceLayer = map.FindElevationSurfaceLayer(layerUri);</span><br></pre></td></tr></table></figure>

<h3 id="移除高程表面图层"><a href="#移除高程表面图层" class="headerlink" title="移除高程表面图层"></a>移除高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in a QueuedTask.Run</span></span><br><span class="line"></span><br><span class="line">map.ClearElevationSurfaceLayers();   <span class="comment">//Ground will not be removed</span></span><br><span class="line"></span><br><span class="line">map.RemoveLayer(surfaceLayer);<span class="comment">//Cannot remove ground</span></span><br><span class="line">map.RemoveLayers(map.GetElevationSurfaceLayers()); <span class="comment">//Ground will not be removed</span></span><br></pre></td></tr></table></figure>

<h3 id="从曲面获取-Z-值"><a href="#从曲面获取-Z-值" class="headerlink" title="从曲面获取 Z 值"></a>从曲面获取 Z 值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">await</span> QueuedTask.Run&lt;Geometry&gt;(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Geometry mapCentergeometry = MapView.Active.Map.CalculateFullExtent().Center;</span><br><span class="line">  <span class="keyword">return</span> mapCentergeometry;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//Pass any Geometry type to GetZsFromSurfaceAsync</span></span><br><span class="line"><span class="keyword">var</span> surfaceZResult = <span class="keyword">await</span> MapView.Active.Map.GetZsFromSurfaceAsync(geometry);</span><br><span class="line"><span class="keyword">return</span> surfaceZResult;</span><br></pre></td></tr></table></figure>

<h2 id="栅格图层"><a href="#栅格图层" class="headerlink" title="栅格图层"></a>栅格图层</h2><h3 id="创建栅格图层"><a href="#创建栅格图层" class="headerlink" title="创建栅格图层"></a>创建栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;C:\Images\Italy.tif&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a raster layer using a path to an image.</span></span><br><span class="line">  <span class="comment">// Note: You can create a raster layer from a url, project item, or data connection.</span></span><br><span class="line">  rasterLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> RasterLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新栅格图层上的栅格着色器"><a href="#更新栅格图层上的栅格着色器" class="headerlink" title="更新栅格图层上的栅格着色器"></a>更新栅格图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the raster layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = rasterLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update raster colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the raster layer with the changed colorizer.</span></span><br><span class="line">  rasterLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新栅格图层上的-RGB-着色器"><a href="#更新栅格图层上的-RGB-着色器" class="headerlink" title="更新栅格图层上的 RGB 着色器"></a>更新栅格图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the raster layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = rasterLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the raster layer with the changed colorizer.</span></span><br><span class="line">    rasterLayer.SetColorizer(rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将某个着色器应用于栅格图层"><a href="#检查是否可以将某个着色器应用于栅格图层" class="headerlink" title="检查是否可以将某个着色器应用于栅格图层"></a>检查是否可以将某个着色器应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the raster layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList = rasterLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于栅格图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于栅格图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于栅格图层"></a>基于默认着色器定义创建新的着色器并将其应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the raster layer.</span></span><br><span class="line">  <span class="keyword">if</span> (rasterLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> rasterLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the raster layer.</span></span><br><span class="line">    rasterLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于栅格图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于栅格图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于栅格图层"></a>基于自定义着色器定义创建新的着色器并将其应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the raster layer.</span></span><br><span class="line">  <span class="keyword">if</span> (rasterLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition specifying parameters </span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> rasterLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the raster layer.</span></span><br><span class="line">    rasterLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建栅格图层"><a href="#使用新的着色器定义创建栅格图层" class="headerlink" title="使用新的着色器定义创建栅格图层"></a>使用新的着色器定义创建栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new stretch colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  Name = layerName,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a raster layer using the colorizer definition created above.</span></span><br><span class="line">  <span class="comment">// Note: You can create a raster layer from a url, project item, or data connection.</span></span><br><span class="line">  RasterLayer rasterLayerfromURL =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;RasterLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="马赛克图层"><a href="#马赛克图层" class="headerlink" title="马赛克图层"></a>马赛克图层</h2><h3 id="创建镶嵌图层"><a href="#创建镶嵌图层" class="headerlink" title="创建镶嵌图层"></a>创建镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MosaicLayer mosaicLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;C:\Images\countries.gdb\Italy&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a mosaic layer using a path to a mosaic dataset.</span></span><br><span class="line">  <span class="comment">// Note: You can create a mosaic layer from a url, project item, or data connection.</span></span><br><span class="line">  mosaicLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> MosaicLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的栅格着色器"><a href="#更新镶嵌图层上的栅格着色器" class="headerlink" title="更新镶嵌图层上的栅格着色器"></a>更新镶嵌图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the colorizer from the image sub-layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = mosaicImageSubLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update raster colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the image sub-layer with the changed colorizer.</span></span><br><span class="line">  mosaicImageSubLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的-RGB-着色器"><a href="#更新镶嵌图层上的-RGB-着色器" class="headerlink" title="更新镶嵌图层上的 RGB 着色器"></a>更新镶嵌图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the colorizer from the image sub-layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = mosaicImageSubLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the image sub-layer with the changed colorizer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将某种着色器应用于马赛克图层"><a href="#检查是否可以将某种着色器应用于马赛克图层" class="headerlink" title="检查是否可以将某种着色器应用于马赛克图层"></a>检查是否可以将某种着色器应用于马赛克图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the image sub-layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList =</span><br><span class="line">    mosaicImageSubLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于镶嵌图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于镶嵌图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于镶嵌图层"></a>基于默认着色器定义创建新的着色器并将其应用于镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image sub-layer.</span></span><br><span class="line">  <span class="keyword">if</span> (mosaicImageSubLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> mosaicImageSubLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image sub-layer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层"></a>基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image sub-layer.</span></span><br><span class="line">  <span class="keyword">if</span> (mosaicImageSubLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer definition specifying parameters</span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> mosaicImageSubLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image sub-layer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建镶嵌图层"><a href="#使用新的着色器定义创建镶嵌图层" class="headerlink" title="使用新的着色器定义创建镶嵌图层"></a>使用新的着色器定义创建镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  Name = layerName,</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a mosaic layer using the colorizer definition created above.</span></span><br><span class="line">  <span class="comment">// Note: You can create a mosaic layer from a url, project item, or data connection.</span></span><br><span class="line">  MosaicLayer newMosaicLayer =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;MosaicLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的排序顺序-镶嵌方法"><a href="#更新镶嵌图层上的排序顺序-镶嵌方法" class="headerlink" title="更新镶嵌图层上的排序顺序 - 镶嵌方法"></a>更新镶嵌图层上的排序顺序 - 镶嵌方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageServiceLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer() <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">  <span class="comment">// Get the mosaic rule.</span></span><br><span class="line">  CIMMosaicRule mosaicingRule = mosaicImageSubLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Method to Center.</span></span><br><span class="line">  mosaicingRule.MosaicMethod = RasterMosaicMethod.Center;</span><br><span class="line">  <span class="comment">// Update the mosaic with the changed mosaic rule.</span></span><br><span class="line">  mosaicImageSubLayer.SetMosaicRule(mosaicingRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的解析重叠-镶嵌运算符"><a href="#更新镶嵌图层上的解析重叠-镶嵌运算符" class="headerlink" title="更新镶嵌图层上的解析重叠 - 镶嵌运算符"></a>更新镶嵌图层上的解析重叠 - 镶嵌运算符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageServiceLayer mosaicImageSublayer = mosaicLayer.GetImageLayer() <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">  <span class="comment">// Get the mosaic rule.</span></span><br><span class="line">  CIMMosaicRule mosaicRule = mosaicImageSublayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Operator to Mean.</span></span><br><span class="line">  mosaicRule.MosaicOperatorType = RasterMosaicOperatorType.Mean;</span><br><span class="line">  <span class="comment">// Update the mosaic with the changed mosaic rule.</span></span><br><span class="line">  mosaicImageSublayer.SetMosaicRule(mosaicRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="影像服务图层"><a href="#影像服务图层" class="headerlink" title="影像服务图层"></a>影像服务图层</h2><h3 id="创建影像服务图层"><a href="#创建影像服务图层" class="headerlink" title="创建影像服务图层"></a>创建影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ImageServiceLayer isLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">string</span> url =</span><br><span class="line"><span class="string">@&quot;http://imagery.arcgisonline.com/arcgis/services/LandsatGLS/GLS2010_Enhanced/ImageServer&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create an image service layer using the url for an image service.</span></span><br><span class="line">  isLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的栅格着色器"><a href="#更新影像服务图层上的栅格着色器" class="headerlink" title="更新影像服务图层上的栅格着色器"></a>更新影像服务图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the image service layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = isLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update the colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the image service layer with the changed colorizer.</span></span><br><span class="line">  isLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的-RGB-着色器"><a href="#更新影像服务图层上的-RGB-着色器" class="headerlink" title="更新影像服务图层上的 RGB 着色器"></a>更新影像服务图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the image service layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = isLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the image service layer with the changed colorizer.</span></span><br><span class="line">    isLayer.SetColorizer((CIMRasterColorizer)rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将特定着色器应用于影像服务图层"><a href="#检查是否可以将特定着色器应用于影像服务图层" class="headerlink" title="检查是否可以将特定着色器应用于影像服务图层"></a>检查是否可以将特定着色器应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the imager service layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList = isLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于影像服务图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于影像服务图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于影像服务图层"></a>基于默认着色器定义创建新的着色器并将其应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image service layer.</span></span><br><span class="line">  <span class="keyword">if</span> (isLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> isLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image service layer.</span></span><br><span class="line">    isLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于影像服务图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于影像服务图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于影像服务图层"></a>基于自定义着色器定义创建新的着色器并将其应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image service layer.</span></span><br><span class="line">  <span class="keyword">if</span> (isLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition specifying parameters</span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp. </span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> isLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image service layer.</span></span><br><span class="line">    isLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建影像服务图层"><a href="#使用新的着色器定义创建影像服务图层" class="headerlink" title="使用新的着色器定义创建影像服务图层"></a>使用新的着色器定义创建影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  Name = layerName,</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create an image service layer using the colorizer definition created above.</span></span><br><span class="line">  ImageServiceLayer imageServiceLayer =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;ImageServiceLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的排序顺序-镶嵌方法"><a href="#更新影像服务图层上的排序顺序-镶嵌方法" class="headerlink" title="更新影像服务图层上的排序顺序 - 镶嵌方法"></a>更新影像服务图层上的排序顺序 - 镶嵌方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the mosaic rule of the image service.</span></span><br><span class="line">  CIMMosaicRule mosaicRule = isLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Method to Center.</span></span><br><span class="line">  mosaicRule.MosaicMethod = RasterMosaicMethod.Center;</span><br><span class="line">  <span class="comment">// Update the image service with the changed mosaic rule.</span></span><br><span class="line">  isLayer.SetMosaicRule(mosaicRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的解决重叠-镶嵌运算符"><a href="#更新影像服务图层上的解决重叠-镶嵌运算符" class="headerlink" title="更新影像服务图层上的解决重叠 - 镶嵌运算符"></a>更新影像服务图层上的解决重叠 - 镶嵌运算符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the mosaic rule of the image service.</span></span><br><span class="line">  CIMMosaicRule mosaicingRule = isLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Operator to Mean.</span></span><br><span class="line">  mosaicingRule.MosaicOperatorType = RasterMosaicOperatorType.Mean;</span><br><span class="line">  <span class="comment">// Update the image service with the changed mosaic rule.</span></span><br><span class="line">  isLayer.SetMosaicRule(mosaicingRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用独立表"><a href="#使用独立表" class="headerlink" title="使用独立表"></a>使用独立表</h2><h3 id="创建独立表"><a href="#创建独立表" class="headerlink" title="创建独立表"></a>创建独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//container can be a map or group layer</span></span><br><span class="line"><span class="keyword">var</span> container = MapView.Active.Map;</span><br><span class="line"><span class="comment">//var container =  MapView.Active.Map.GetLayersAsFlattenedList()</span></span><br><span class="line"><span class="comment">//                                  .OfType&lt;GroupLayer&gt;().First();</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//use a local path</span></span><br><span class="line">  <span class="keyword">var</span> table = StandaloneTableFactory.Instance.CreateStandaloneTable(</span><br><span class="line">      <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Temp\Data\SDK.gdb\EarthquakeDamage&quot;</span>, UriKind.Absolute),</span><br><span class="line">      container);</span><br><span class="line">  <span class="comment">//use a URI to a feature service table endpoint</span></span><br><span class="line">  <span class="keyword">var</span> table2 = StandaloneTableFactory.Instance.CreateStandaloneTable(</span><br><span class="line">    <span class="keyword">new</span> Uri(<span class="string">@&quot;https://bexdog.esri.com/server/rest/services/FeatureServer&quot;</span> + <span class="string">&quot;/2&quot;</span>, UriKind.Absolute),</span><br><span class="line">    container);</span><br><span class="line">  <span class="comment">//Use an item</span></span><br><span class="line">  <span class="keyword">var</span> item = ItemFactory.Instance.Create(<span class="string">@&quot;C:\Temp\Data\SDK.gdb\ParcelOwners&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> tableCreationParams = <span class="keyword">new</span> StandaloneTableCreationParams(item);</span><br><span class="line">  <span class="keyword">var</span> table3 = StandaloneTableFactory.Instance.CreateStandaloneTable(tableCreationParams, container);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//use table creation params</span></span><br><span class="line">  <span class="keyword">var</span> table_params = <span class="keyword">new</span> StandaloneTableCreationParams(item)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// At 2.x - DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//  //optional - use a filter</span></span><br><span class="line">    <span class="comment">//  DefinitionExpression = &quot;LAND_USE = 3&quot;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;LAND_USE = 3&quot;</span>, name: <span class="string">&quot;Landuse&quot;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> table4 = StandaloneTableFactory.Instance.CreateStandaloneTable(table_params,</span><br><span class="line">                           container);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从表的容器中检索表"><a href="#从表的容器中检索表" class="headerlink" title="从表的容器中检索表"></a>从表的容器中检索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//the map standalone table collection</span></span><br><span class="line"><span class="keyword">var</span> table = container.GetStandaloneTablesAsFlattenedList()</span><br><span class="line">                        .FirstOrDefault(tbl =&gt; tbl.Name == <span class="string">&quot;EarthquakeDamage&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//or from a group layer</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.FindLayers(<span class="string">&quot;GroupLayer1&quot;</span>).First() <span class="keyword">as</span> GroupLayer;</span><br><span class="line"><span class="keyword">var</span> table2 = grp_layer.FindStandaloneTables(<span class="string">&quot;EarthquakeDamage&quot;</span>).First();</span><br><span class="line"><span class="comment">//or         grp_layer.GetStandaloneTablesAsFlattenedList().First()</span></span><br><span class="line"><span class="comment">//or         grp_layer.StandaloneTables.Where(...).First(), etc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//show the table in a table view </span></span><br><span class="line"><span class="comment">//use FrameworkApplication.Current.Dispatcher.BeginInvoke if not on the UI thread</span></span><br><span class="line">FrameworkApplication.Panes.OpenTablePane(table2);</span><br></pre></td></tr></table></figure>

<h3 id="移动独立表"><a href="#移动独立表" class="headerlink" title="移动独立表"></a>移动独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the first group layer that has at least one table</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;GroupLayer&gt;().First(g =&gt; g.StandaloneTables.Count &gt; <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;<span class="comment">//assumes non-null</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//move the first table to the bottom of the container</span></span><br><span class="line">  grp_layer.MoveStandaloneTable(grp_layer.StandaloneTables.First(), <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//move the last table in the map standalone tables to a group</span></span><br><span class="line">  <span class="comment">//layer and place it at position 3. If 3 is invalid, the table</span></span><br><span class="line">  <span class="comment">//will be placed at the bottom of the target container</span></span><br><span class="line">  <span class="comment">//assumes the map has at least one standalone table...</span></span><br><span class="line">  <span class="keyword">var</span> table = map.StandaloneTables.Last();</span><br><span class="line">  map.MoveStandaloneTable(table, grp_layer, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//move a table from a group layer to the map standalone tables</span></span><br><span class="line">  <span class="comment">//collection - assumes a table called &#x27;Earthquakes&#x27; exists</span></span><br><span class="line">  <span class="keyword">var</span> table2 = grp_layer.FindStandaloneTables(<span class="string">&quot;Earthquakes&quot;</span>).First();</span><br><span class="line">  <span class="comment">//move to the map container</span></span><br><span class="line">  map.MoveStandaloneTable(table2, <span class="number">0</span>);<span class="comment">//will be placed at the top</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除独立表"><a href="#删除独立表" class="headerlink" title="删除独立表"></a>删除独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the first group layer that has at least one table</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;GroupLayer&gt;().First(g =&gt; g.StandaloneTables.Count &gt; <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;<span class="comment">//assumes non-null</span></span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//get the tables from the map container</span></span><br><span class="line">  <span class="keyword">var</span> tables = map.GetStandaloneTablesAsFlattenedList();</span><br><span class="line">  <span class="comment">//delete the first...</span></span><br><span class="line">  <span class="keyword">if</span> (tables.Count() &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    map.RemoveStandaloneTable(tables.First());</span><br><span class="line">    <span class="comment">//or delete all of them</span></span><br><span class="line">    map.RemoveStandaloneTables(tables);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//delete a table from a group layer</span></span><br><span class="line">  <span class="comment">//assumes it has at least one table...</span></span><br><span class="line">  grp_layer.RemoveStandaloneTable(grp_layer.StandaloneTables.First());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="符号图层绘制-（SLD）"><a href="#符号图层绘制-（SLD）" class="headerlink" title="符号图层绘制 （SLD）"></a>符号图层绘制 （SLD）</h2><h3 id="添加-SLD"><a href="#添加-SLD" class="headerlink" title="添加 SLD"></a>添加 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//check if it can be added to the layer</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.CanAddSymbolLayerDrawing())</span><br><span class="line">    featLayer.AddSymbolLayerDrawing();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ditto for a group layer...must have at least</span></span><br><span class="line">  <span class="comment">//one child feature layer that can participate</span></span><br><span class="line">  <span class="keyword">if</span> (groupLayer.CanAddSymbolLayerDrawing())</span><br><span class="line">    groupLayer.AddSymbolLayerDrawing();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="确定图层是否添加了-SLD"><a href="#确定图层是否添加了-SLD" class="headerlink" title="确定图层是否添加了 SLD"></a>确定图层是否添加了 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SLD can be added to feature layers and group layers</span></span><br><span class="line"><span class="comment">//For a group layer, SLD controls all child feature layers</span></span><br><span class="line"><span class="comment">//that are participating in the SLD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var featLayer = ...;//retrieve the feature layer</span></span><br><span class="line"><span class="comment">//var groupLayer = ...;//retrieve the group layer</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check if the layer has SLD added -returns a tuple</span></span><br><span class="line">  <span class="keyword">var</span> tuple = featLayer.HasSymbolLayerDrawingAdded();</span><br><span class="line">  <span class="keyword">if</span> (tuple.addedOnLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//SLD is added on the layer</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (tuple.addedOnParent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//SLD is added on the parent (group layer) - </span></span><br><span class="line">    <span class="comment">//check parent...this can be recursive</span></span><br><span class="line">    <span class="keyword">var</span> parentLayer = GetParentLayerWithSLD(featLayer.Parent <span class="keyword">as</span> GroupLayer);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">   //Recursively get the parent with SLD</span></span><br><span class="line"><span class="comment">   public GroupLayer GetParentLayerWithSLD(GroupLayer groupLayer) </span></span><br><span class="line"><span class="comment">   &#123;</span></span><br><span class="line"><span class="comment">     if (groupLayer == null)</span></span><br><span class="line"><span class="comment">       return null;</span></span><br><span class="line"><span class="comment">     //Must be on QueuedTask</span></span><br><span class="line"><span class="comment">     var sld_added = groupLayer.HasSymbolLayerDrawingAdded();</span></span><br><span class="line"><span class="comment">     if (sld_added.addedOnLayer)</span></span><br><span class="line"><span class="comment">       return groupLayer;</span></span><br><span class="line"><span class="comment">     else if (sld_added.addedOnParent)</span></span><br><span class="line"><span class="comment">       return GetParentLayerWithSLD(groupLayer.Parent as GroupLayer);</span></span><br><span class="line"><span class="comment">     return null;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="启用-x2F-禁用-SLD"><a href="#启用-x2F-禁用-SLD" class="headerlink" title="启用&#x2F;禁用 SLD"></a>启用&#x2F;禁用 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//A layer may have SLD added but is not using it</span></span><br><span class="line">  <span class="comment">//HasSymbolLayerDrawingAdded returns a tuple - to check</span></span><br><span class="line">  <span class="comment">//the layer has SLD (not its parent) check addedOnLayer</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.HasSymbolLayerDrawingAdded().addedOnLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//the layer has SLD but is the layer currently using it?</span></span><br><span class="line">    <span class="comment">//GetUseSymbolLayerDrawing returns a tuple - useOnLayer for </span></span><br><span class="line">    <span class="comment">//the layer (and useOnParent for the parent layer)</span></span><br><span class="line">    <span class="keyword">if</span> (!featLayer.GetUseSymbolLayerDrawing().useOnLayer)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//enable it</span></span><br><span class="line">      featLayer.SetUseSymbolLayerDrawing(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Enable/Disable SLD on a layer parent</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.HasSymbolLayerDrawingAdded().addedOnParent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//check parent...this can be recursive</span></span><br><span class="line">    <span class="keyword">var</span> parent = GetParentLayerWithSLD(featLayer.Parent <span class="keyword">as</span> GroupLayer);</span><br><span class="line">    <span class="keyword">if</span> (parent.GetUseSymbolLayerDrawing().useOnLayer)</span><br><span class="line">      parent.SetUseSymbolLayerDrawing(<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   //Recursively get the parent with SLD</span></span><br><span class="line"><span class="comment">   public GroupLayer GetParentLayerWithSLD(GroupLayer groupLayer) </span></span><br><span class="line"><span class="comment">   &#123;</span></span><br><span class="line"><span class="comment">     if (groupLayer == null)</span></span><br><span class="line"><span class="comment">       return null;</span></span><br><span class="line"><span class="comment">     //Must be on QueuedTask</span></span><br><span class="line"><span class="comment">     var sld_added = groupLayer.HasSymbolLayerDrawingAdded();</span></span><br><span class="line"><span class="comment">     if (sld_added.addedOnLayer)</span></span><br><span class="line"><span class="comment">       return groupLayer;</span></span><br><span class="line"><span class="comment">     else if (sld_added.addedOnParent)</span></span><br><span class="line"><span class="comment">       return GetParentLayerWithSLD(groupLayer.Parent as GroupLayer);</span></span><br><span class="line"><span class="comment">     return null;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="设备位置-API、GPS-x2F-GNSS-设备"><a href="#设备位置-API、GPS-x2F-GNSS-设备" class="headerlink" title="设备位置 API、GPS&#x2F;GNSS 设备"></a>设备位置 API、GPS&#x2F;GNSS 设备</h2><h3 id="连接到设备位置源"><a href="#连接到设备位置源" class="headerlink" title="连接到设备位置源"></a>连接到设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newSrc = <span class="keyword">new</span> SerialPortDeviceLocationSource();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Specify the COM port the device is connected to</span></span><br><span class="line">newSrc.ComPort = <span class="string">&quot;Com3&quot;</span>;</span><br><span class="line">newSrc.BaudRate = <span class="number">4800</span>;</span><br><span class="line">newSrc.AntennaHeight = <span class="number">3</span>;  <span class="comment">// meters</span></span><br><span class="line"><span class="comment">//fill in other properties as needed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> props = <span class="keyword">new</span> DeviceLocationProperties();</span><br><span class="line">props.AccuracyThreshold = <span class="number">10</span>;   <span class="comment">// meters</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jump to the background thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//open the device</span></span><br><span class="line">  DeviceLocationService.Instance.Open(newSrc, props);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前设备位置源"><a href="#获取当前设备位置源" class="headerlink" title="获取当前设备位置源"></a>获取当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = DeviceLocationService.Instance.GetSource();</span><br><span class="line"><span class="keyword">if</span> (source == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//There is no current source</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭当前设备位置源"><a href="#关闭当前设备位置源" class="headerlink" title="关闭当前设备位置源"></a>关闭当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Is there a current device source?</span></span><br><span class="line"><span class="keyword">var</span> src = DeviceLocationService.Instance.GetSource();</span><br><span class="line"><span class="keyword">if</span> (src == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//no current source</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationService.Instance.Close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前设备位置源和属性"><a href="#获取当前设备位置源和属性" class="headerlink" title="获取当前设备位置源和属性"></a>获取当前设备位置源和属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> isConnected = DeviceLocationService.Instance.IsDeviceConnected();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = DeviceLocationService.Instance.GetSource();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (src <span class="keyword">is</span> SerialPortDeviceLocationSource serialPortSrc)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> port = serialPortSrc.ComPort;</span><br><span class="line">  <span class="keyword">var</span> antennaHeight = serialPortSrc.AntennaHeight;</span><br><span class="line">  <span class="keyword">var</span> dataBits = serialPortSrc.DataBits;</span><br><span class="line">  <span class="keyword">var</span> baudRate = serialPortSrc.BaudRate;</span><br><span class="line">  <span class="keyword">var</span> parity = serialPortSrc.Parity;</span><br><span class="line">  <span class="keyword">var</span> stopBits = serialPortSrc.StopBits;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// retrieving spatial reference needs the MCT</span></span><br><span class="line">  <span class="keyword">var</span> sr = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> serialPortSrc.GetSpatialReference();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> dlProps = DeviceLocationService.Instance.GetProperties();</span><br><span class="line"><span class="keyword">var</span> accuracy = dlProps.AccuracyThreshold;</span><br></pre></td></tr></table></figure>

<h3 id="更新当前设备位置源上的属性"><a href="#更新当前设备位置源上的属性" class="headerlink" title="更新当前设备位置源上的属性"></a>更新当前设备位置源上的属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> dlProps = DeviceLocationService.Instance.GetProperties();</span><br><span class="line">  <span class="comment">//Change the accuracy threshold</span></span><br><span class="line">  dlProps.AccuracyThreshold = <span class="number">22.5</span>; <span class="comment">// meters</span></span><br><span class="line"></span><br><span class="line">  DeviceLocationService.Instance.UpdateProperties(dlProps);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="订阅设备位置属性更新事件"><a href="#订阅设备位置属性更新事件" class="headerlink" title="订阅设备位置属性更新事件"></a>订阅设备位置属性更新事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToPropertiesEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationPropertiesUpdatedEvent.Subscribe(OnDeviceLocationPropertiesUpdated);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDeviceLocationPropertiesUpdated</span>(<span class="params">DeviceLocationPropertiesUpdatedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> properties = args.DeviceLocationProperties;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  TODO - something with the updated properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="订阅设备位置源更改事件"><a href="#订阅设备位置源更改事件" class="headerlink" title="订阅设备位置源更改事件"></a>订阅设备位置源更改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToSourceEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationSourceChangedEvent.Subscribe(OnDeviceLocationSourceChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDeviceLocationSourceChanged</span>(<span class="params">DeviceLocationSourceChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> source = args.DeviceLocationSource; </span><br><span class="line"></span><br><span class="line">  <span class="comment">//  TODO - something with the updated source properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="映射设备位置选项"><a href="#映射设备位置选项" class="headerlink" title="映射设备位置选项"></a>映射设备位置选项</h2><h3 id="启用-x2F-禁用地图的当前设备位置源"><a href="#启用-x2F-禁用地图的当前设备位置源" class="headerlink" title="启用&#x2F;禁用地图的当前设备位置源"></a>启用&#x2F;禁用地图的当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> enabled = MapDeviceLocationService.Instance.IsDeviceLocationEnabled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  MapDeviceLocationService.Instance.SetDeviceLocationEnabled(!enabled);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图设备位置选项"><a href="#获取当前地图设备位置选项" class="headerlink" title="获取当前地图设备位置选项"></a>获取当前地图设备位置选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = MapDeviceLocationService.Instance.GetDeviceLocationOptions();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> visibility = options.DeviceLocationVisibility;</span><br><span class="line"><span class="keyword">var</span> navMode = options.NavigationMode;</span><br><span class="line"><span class="keyword">var</span> trackUp = options.TrackUpNavigation;</span><br><span class="line"><span class="keyword">var</span> showBuffer = options.ShowAccuracyBuffer;</span><br></pre></td></tr></table></figure>

<h3 id="检查地图上是否启用了当前设备位置"><a href="#检查地图上是否启用了当前设备位置" class="headerlink" title="检查地图上是否启用了当前设备位置"></a>检查地图上是否启用了当前设备位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//The Device Location Source is Enabled</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图设备位置选项"><a href="#设置当前地图设备位置选项" class="headerlink" title="设置当前地图设备位置选项"></a>设置当前地图设备位置选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Check there is a source first...</span></span><br><span class="line"><span class="keyword">if</span> (DeviceLocationService.Instance.GetSource() == <span class="literal">null</span>)</span><br><span class="line">  <span class="comment">//Setting DeviceLocationOptions w/ no Device Location Source</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (!MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">  <span class="comment">//Setting DeviceLocationOptions w/ no Device Location Enabled</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">MapDeviceLocationService.Instance.SetDeviceLocationOptions(</span><br><span class="line">  <span class="keyword">new</span> MapDeviceLocationOptions()</span><br><span class="line">  &#123;</span><br><span class="line">    DeviceLocationVisibility = <span class="literal">true</span>,</span><br><span class="line">    NavigationMode = MappingDeviceLocationNavigationMode.KeepAtCenter,</span><br><span class="line">    TrackUpNavigation = <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="缩放-x2F-平移地图到最新位置"><a href="#缩放-x2F-平移地图到最新位置" class="headerlink" title="缩放&#x2F;平移地图到最新位置"></a>缩放&#x2F;平移地图到最新位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">  <span class="comment">//Calling ZoomOrPanToCurrentLocation w/ no Device Location Enabled</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// true for zoom, false for pan</span></span><br><span class="line">MapDeviceLocationService.Instance.ZoomOrPanToCurrentLocation(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将最新位置添加到图形图层"><a href="#将最新位置添加到图形图层" class="headerlink" title="将最新位置添加到图形图层"></a>将最新位置添加到图形图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var graphicsLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get the last location</span></span><br><span class="line"><span class="keyword">var</span> pt = DeviceLocationService.Instance.GetCurrentSnapshot()?.GetPositionAsMapPoint();</span><br><span class="line"><span class="keyword">if</span> (pt != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create a point symbol</span></span><br><span class="line">  <span class="keyword">var</span> ptSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                    CIMColor.CreateRGBColor(<span class="number">125</span>, <span class="number">125</span>, <span class="number">0</span>), <span class="number">10</span>, SimpleMarkerStyle.Triangle);</span><br><span class="line">  <span class="comment">//Add a graphic to the graphics layer</span></span><br><span class="line">  graphicsLayer.AddElement(pt, ptSymbol);</span><br><span class="line">  <span class="comment">//unselect it</span></span><br><span class="line">  graphicsLayer.ClearSelection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="订阅位置快照事件"><a href="#订阅位置快照事件" class="headerlink" title="订阅位置快照事件"></a>订阅位置快照事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToSnapshotEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  SnapshotChangedEvent.Subscribe(OnSnapshotChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSnapshotChanged</span>(<span class="params">SnapshotChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> snapshot = args.Snapshot <span class="keyword">as</span> NMEASnapshot;</span><br><span class="line">  <span class="keyword">if</span> (snapshot == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> pt = snapshot.GetPositionAsMapPoint();</span><br><span class="line">    <span class="keyword">if</span> (pt?.IsEmpty ?? <span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// access properties</span></span><br><span class="line">    <span class="keyword">var</span> alt = snapshot.Altitude;</span><br><span class="line">    <span class="keyword">var</span> dt = snapshot.DateTime;</span><br><span class="line">    <span class="keyword">var</span> vdop = snapshot.VDOP;</span><br><span class="line">    <span class="keyword">var</span> hdop = snapshot.HDOP;</span><br><span class="line">    <span class="comment">// etc</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> use the snapshot</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="特征遮罩"><a href="#特征遮罩" class="headerlink" title="特征遮罩"></a>特征遮罩</h2><h3 id="获取要素的遮罩几何"><a href="#获取要素的遮罩几何" class="headerlink" title="获取要素的遮罩几何"></a>获取要素的遮罩几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                           .OfType&lt;BasicFeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (featureLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> table = featureLayer.GetTable())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = table.Search())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//get the first feature...</span></span><br><span class="line">      <span class="comment">//...assuming at least one feature gets retrieved</span></span><br><span class="line">      rc.MoveNext();</span><br><span class="line">      <span class="keyword">var</span> oid = rc.Current.GetObjectID();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use DrawingOutlineType.BoundingEnvelope to retrieve a generalized</span></span><br><span class="line">      <span class="comment">//mask geometry or &quot;Box&quot;. The mask will be in the same SpatRef as the map</span></span><br><span class="line">      <span class="comment">//At 2.x - var mask_geom = featureLayer.QueryDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span></span><br><span class="line">      <span class="keyword">var</span> mask_geom = featureLayer.GetDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//TODO - use the mask geometry...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="风格管理"><a href="#风格管理" class="headerlink" title="风格管理"></a>风格管理</h2><h3 id="如何按名称获取项目中的样式"><a href="#如何按名称获取项目中的样式" class="headerlink" title="如何按名称获取项目中的样式"></a>如何按名称获取项目中的样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get all styles in the project</span></span><br><span class="line"><span class="keyword">var</span> ProjectStyles = Project.Current.GetItems&lt;StyleProjectItem&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get a specific style in the project by name</span></span><br><span class="line">StyleProjectItem style = ProjectStyles.First(x =&gt; x.Name == <span class="string">&quot;NameOfTheStyle&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="如何创建新样式"><a href="#如何创建新样式" class="headerlink" title="如何创建新样式"></a>如何创建新样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Full path for the new style file (.stylx) to be created</span></span><br><span class="line"><span class="built_in">string</span> styleToCreate = <span class="string">@&quot;C:\Temp\NewStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.CreateStyle(Project.Current, styleToCreate));</span><br></pre></td></tr></table></figure>

<h3 id="如何向项目添加样式"><a href="#如何向项目添加样式" class="headerlink" title="如何向项目添加样式"></a>如何向项目添加样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//For ArcGIS Pro system styles, just pass in the name of the style to add to the project</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, <span class="string">&quot;3D Vehicles&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//For custom styles, pass in the full path to the style file on disk</span></span><br><span class="line"><span class="built_in">string</span> customStyleToAdd = <span class="string">@&quot;C:\Temp\CustomStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, customStyleToAdd));</span><br></pre></td></tr></table></figure>

<h3 id="如何从项目中删除样式"><a href="#如何从项目中删除样式" class="headerlink" title="如何从项目中删除样式"></a>如何从项目中删除样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//For ArcGIS Pro system styles, just pass in the name of the style to remove from the project</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.RemoveStyle(Project.Current, <span class="string">&quot;3D Vehicles&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//For custom styles, pass in the full path to the style file on disk</span></span><br><span class="line"><span class="built_in">string</span> customStyleToAdd = <span class="string">@&quot;C:\Temp\CustomStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.RemoveStyle(Project.Current, customStyleToAdd));</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式项添加到样式"><a href="#如何将样式项添加到样式" class="headerlink" title="如何将样式项添加到样式"></a>如何将样式项添加到样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">AddStyleItemAsync</span>(<span class="params">StyleProjectItem style, StyleItem itemToAdd</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span> || itemToAdd == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Add the item to style</span></span><br><span class="line">    style.AddItem(itemToAdd);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何从样式中删除样式项"><a href="#如何从样式中删除样式项" class="headerlink" title="如何从样式中删除样式项"></a>如何从样式中删除样式项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">RemoveStyleItemAsync</span>(<span class="params">StyleProjectItem style, StyleItem itemToRemove</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span> || itemToRemove == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Remove the item from style</span></span><br><span class="line">    style.RemoveItem(itemToRemove);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否可以升级"><a href="#如何确定样式是否可以升级" class="headerlink" title="如何确定样式是否可以升级"></a>如何确定样式是否可以升级</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">CanUpgradeStyleAsync</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style can be upgraded</span></span><br><span class="line">  <span class="keyword">return</span> style.CanUpgrade;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否为只读"><a href="#如何确定样式是否为只读" class="headerlink" title="如何确定样式是否为只读"></a>如何确定样式是否为只读</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">IsReadOnly</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style is read-only</span></span><br><span class="line">  <span class="keyword">return</span> style.IsReadOnly;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否为当前样式"><a href="#如何确定样式是否为当前样式" class="headerlink" title="如何确定样式是否为当前样式"></a>如何确定样式是否为当前样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">IsCurrent</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style matches the current Pro version</span></span><br><span class="line">  <span class="keyword">return</span> style.IsCurrent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何升级样式"><a href="#如何升级样式" class="headerlink" title="如何升级样式"></a>如何升级样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">UpgradeStyleAsync</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> success = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Verify that style can be upgraded</span></span><br><span class="line">  <span class="keyword">if</span> (style.CanUpgrade)</span><br><span class="line">  &#123;</span><br><span class="line">    success = <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.UpgradeStyle(style));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//return true if style was upgraded</span></span><br><span class="line">  <span class="keyword">return</span> success;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h2><h3 id="如何构建特定颜色和大小的点符号"><a href="#如何构建特定颜色和大小的点符号" class="headerlink" title="如何构建特定颜色和大小的点符号"></a>如何构建特定颜色和大小的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">10.0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、大小和形状的点符号"><a href="#如何构建特定颜色、大小和形状的点符号" class="headerlink" title="如何构建特定颜色、大小和形状的点符号"></a>如何构建特定颜色、大小和形状的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol starPointSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">10.0</span>, SimpleMarkerStyle.Star);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何根据标记构造点符号"><a href="#如何根据标记构造点符号" class="headerlink" title="如何根据标记构造点符号"></a>如何根据标记构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMMarker marker = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.GreenRGB, <span class="number">8.0</span>, SimpleMarkerStyle.Pushpin);</span><br><span class="line">  CIMPointSymbol pointSymbolFromMarker = SymbolFactory.Instance.ConstructPointSymbol(marker);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何从磁盘上的文件构造点符号"><a href="#如何从磁盘上的文件构造点符号" class="headerlink" title="如何从磁盘上的文件构造点符号"></a>如何从磁盘上的文件构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The following file formats can be used to create the marker: DAE, 3DS, FLT, EMF, JPG, PNG, BMP, GIF</span></span><br><span class="line">CIMMarker markerFromFile = <span class="keyword">await</span> QueuedTask.Run(() =&gt; SymbolFactory.Instance.ConstructMarkerFromFile(<span class="string">@&quot;C:\Temp\fileName.dae&quot;</span>));</span><br><span class="line"></span><br><span class="line">CIMPointSymbol pointSymbolFromFile = SymbolFactory.Instance.ConstructPointSymbol(markerFromFile);</span><br></pre></td></tr></table></figure>

<h3 id="如何从内存图形构造点符号"><a href="#如何从内存图形构造点符号" class="headerlink" title="如何从内存图形构造点符号"></a>如何从内存图形构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a stream for the image</span></span><br><span class="line"><span class="comment">//At 3.0 you need https://www.nuget.org/packages/Microsoft.Windows.Compatibility</span></span><br><span class="line"><span class="comment">//System.Drawing</span></span><br><span class="line"></span><br><span class="line">System.Drawing.Image newImage = System.Drawing.Image.FromFile(<span class="string">@&quot;C:\PathToImage\Image.png&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> stream = <span class="keyword">new</span> System.IO.MemoryStream();</span><br><span class="line">newImage.Save(stream, System.Drawing.Imaging.ImageFormat.Png);</span><br><span class="line">stream.Position = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//Create marker using the stream</span></span><br><span class="line">CIMMarker markerFromStream = SymbolFactory.Instance.ConstructMarkerFromStream(stream);</span><br><span class="line"><span class="comment">//Create the point symbol from the marker</span></span><br><span class="line">CIMPointSymbol pointSymbolFromStream = SymbolFactory.Instance.ConstructPointSymbol(markerFromStream);</span><br></pre></td></tr></table></figure>

<h3 id="如何构造特定颜色和填充样式的面符号"><a href="#如何构造特定颜色和填充样式的面符号" class="headerlink" title="如何构造特定颜色和填充样式的面符号"></a>如何构造特定颜色和填充样式的面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol polygonSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、填充样式和轮廓的多边形符号"><a href="#如何构建特定颜色、填充样式和轮廓的多边形符号" class="headerlink" title="如何构建特定颜色、填充样式和轮廓的多边形符号"></a>如何构建特定颜色、填充样式和轮廓的多边形符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">CIMPolygonSymbol fillWithOutline = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, outline);</span><br></pre></td></tr></table></figure>

<h3 id="如何在没有轮廓的情况下构建面符号"><a href="#如何在没有轮廓的情况下构建面符号" class="headerlink" title="如何在没有轮廓的情况下构建面符号"></a>如何在没有轮廓的情况下构建面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol fillWithoutOutline = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、大小和线条样式的线符号"><a href="#如何构建特定颜色、大小和线条样式的线符号" class="headerlink" title="如何构建特定颜色、大小和线条样式的线符号"></a>如何构建特定颜色、大小和线条样式的线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMLineSymbol lineSymbol = SymbolFactory.Instance.ConstructLineSymbol(ColorFactory.Instance.BlueRGB, <span class="number">4.0</span>, SimpleLineStyle.Solid);</span><br></pre></td></tr></table></figure>

<h3 id="如何根据笔划构造线条符号"><a href="#如何根据笔划构造线条符号" class="headerlink" title="如何根据笔划构造线条符号"></a>如何根据笔划构造线条符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CIMStroke stroke = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>);</span><br><span class="line">CIMLineSymbol lineSymbolFromStroke = SymbolFactory.Instance.ConstructLineSymbol(stroke);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建线端带有圆形标记的多图层线符号"><a href="#如何构建线端带有圆形标记的多图层线符号" class="headerlink" title="如何构建线端带有圆形标记的多图层线符号"></a>如何构建线端带有圆形标记的多图层线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//These methods must be called within the lambda passed to QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> lineStrokeRed = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.RedRGB, <span class="number">4.0</span>);</span><br><span class="line"><span class="keyword">var</span> markerCircle = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.RedRGB, <span class="number">12</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">markerCircle.MarkerPlacement = <span class="keyword">new</span> CIMMarkerPlacementOnVertices()</span><br><span class="line">&#123;</span><br><span class="line">  AngleToLine = <span class="literal">true</span>,</span><br><span class="line">  PlaceOnEndPoints = <span class="literal">true</span>,</span><br><span class="line">  Offset = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> lineSymbolWithCircles = <span class="keyword">new</span> CIMLineSymbol()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[<span class="number">2</span>] &#123; markerCircle, lineStrokeRed &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="如何构建末端带有箭头的多图层线符号"><a href="#如何构建末端带有箭头的多图层线符号" class="headerlink" title="如何构建末端带有箭头的多图层线符号"></a>如何构建末端带有箭头的多图层线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//These methods must be called within the lambda passed to QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> markerTriangle = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.RedRGB, <span class="number">12</span>, SimpleMarkerStyle.Triangle);</span><br><span class="line">markerTriangle.Rotation = <span class="number">-90</span>; <span class="comment">// or -90</span></span><br><span class="line">markerTriangle.MarkerPlacement = <span class="keyword">new</span> CIMMarkerPlacementOnLine() &#123; AngleToLine = <span class="literal">true</span>, RelativeTo = PlacementOnLineRelativeTo.LineEnd &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lineSymbolWithArrow = <span class="keyword">new</span> CIMLineSymbol()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[<span class="number">2</span>] &#123; markerTriangle,</span><br><span class="line">              SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.RedRGB, <span class="number">2</span>)</span><br><span class="line">          &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="如何从符号获取符号引用"><a href="#如何从符号获取符号引用" class="headerlink" title="如何从符号获取符号引用"></a>如何从符号获取符号引用</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol symbol = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get symbol reference from the symbol</span></span><br><span class="line">CIMSymbolReference symbolReference = symbol.MakeSymbolReference();</span><br></pre></td></tr></table></figure>

<h3 id="修改从字符标记创建的点符号"><a href="#修改从字符标记创建的点符号" class="headerlink" title="修改从字符标记创建的点符号"></a>修改从字符标记创建的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//create marker from the Font, char index,size,color</span></span><br><span class="line"><span class="keyword">var</span> cimMarker = SymbolFactory.Instance.ConstructMarker(<span class="number">125</span>, <span class="string">&quot;Wingdings 3&quot;</span>, <span class="string">&quot;Regular&quot;</span>, <span class="number">6</span>, ColorFactory.Instance.BlueRGB) <span class="keyword">as</span> CIMCharacterMarker;</span><br><span class="line">  <span class="keyword">var</span> polygonMarker = cimMarker.Symbol;</span><br><span class="line">  <span class="comment">//modifying the polygon&#x27;s outline and fill</span></span><br><span class="line">  <span class="comment">//This is the outline</span></span><br><span class="line">  polygonMarker.SymbolLayers[<span class="number">0</span>] = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.GreenRGB, <span class="number">2</span>, SimpleLineStyle.Solid);</span><br><span class="line">  <span class="comment">//This is the fill</span></span><br><span class="line">  polygonMarker.SymbolLayers[<span class="number">1</span>] = SymbolFactory.Instance.ConstructSolidFill(ColorFactory.Instance.BlueRGB);</span><br><span class="line">  <span class="comment">//create a symbol from the marker </span></span><br><span class="line">  <span class="comment">//Note this overload of ConstructPointSymbol does not need to be run within QueuedTask.Run.</span></span><br><span class="line">  <span class="keyword">var</span> pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(cimMarker);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用字体的列表"><a href="#获取可用字体的列表" class="headerlink" title="获取可用字体的列表"></a>获取可用字体的列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must use QueuedTask.Run(...)</span></span><br><span class="line"><span class="comment">//returns a tuple per font: (string fontName, List&lt;string&gt; fontStyles)</span></span><br><span class="line"><span class="keyword">var</span> fonts = SymbolFactory.Instance.GetAvailableFonts();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> font <span class="keyword">in</span> fonts)</span><br><span class="line">      &#123;</span><br><span class="line">  <span class="keyword">var</span> styles = <span class="built_in">string</span>.Join(<span class="string">&quot;,&quot;</span>, font.fontStyles);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;font.fontName&#125;</span>, styles: <span class="subst">&#123;styles&#125;</span>&quot;</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取-x2F-设置默认字体"><a href="#获取-x2F-设置默认字体" class="headerlink" title="获取&#x2F;设置默认字体"></a>获取&#x2F;设置默认字体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must use QueuedTask.Run(...)</span></span><br><span class="line"><span class="keyword">var</span> def_font = SymbolFactory.Instance.DefaultFont;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;def_font.fontName&#125;</span>, styles: <span class="subst">&#123;def_font.styleName&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//set default font - set through application options</span></span><br><span class="line"><span class="comment">//Must use QueuedTask</span></span><br><span class="line">ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>);</span><br><span class="line">ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>,<span class="string">&quot;bold&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用选项构建文本符号"><a href="#使用选项构建文本符号" class="headerlink" title="使用选项构建文本符号"></a>使用选项构建文本符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//using the default font</span></span><br><span class="line">  <span class="keyword">var</span> textSym1 = SymbolFactory.Instance.ConstructTextSymbol();</span><br><span class="line">  <span class="keyword">var</span> textSym2 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                     ColorFactory.Instance.BlueRGB, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//using a specific font</span></span><br><span class="line">  <span class="keyword">var</span> textSym3 = SymbolFactory.Instance.ConstructTextSymbol(<span class="string">&quot;Arial&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> textSym4 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                    <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Narrow Bold&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//or query available fonts to ensure the font is there</span></span><br><span class="line">  <span class="keyword">var</span> all_fonts = SymbolFactory.Instance.GetAvailableFonts();</span><br><span class="line">  <span class="keyword">var</span> font = all_fonts.FirstOrDefault(f =&gt; f.fontName == <span class="string">&quot;Arial&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(font.fontName))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> textSym5 = SymbolFactory.Instance.ConstructTextSymbol(font.fontName);</span><br><span class="line">    <span class="comment">//or with a font+style</span></span><br><span class="line">    <span class="keyword">var</span> textSym6 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                                    font.fontName, font.fontStyles.First());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//overloads - font + color and size, etc</span></span><br><span class="line">  <span class="keyword">var</span> textSym7 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                  ColorFactory.Instance.BlueRGB, <span class="number">14</span>, <span class="string">&quot;Times New Roman&quot;</span>, <span class="string">&quot;Italic&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//custom symbol - black stroke, red fill</span></span><br><span class="line">  <span class="keyword">var</span> poly_symbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">    SymbolFactory.Instance.ConstructSolidFill(ColorFactory.Instance.RedRGB),</span><br><span class="line">    SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">var</span> textSym8 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">          poly_symbol, <span class="number">14</span>, <span class="string">&quot;Georgia&quot;</span>, <span class="string">&quot;Bold&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="为给定符号创建色板"><a href="#为给定符号创建色板" class="headerlink" title="为给定符号创建色板"></a>为给定符号创建色板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line">CIMSymbol symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  <span class="comment">//You can generate a swatch for a text symbols also.</span></span><br><span class="line">  <span class="keyword">var</span> si = <span class="keyword">new</span> SymbolStyleItem()</span><br><span class="line">  &#123;</span><br><span class="line">      Symbol = symbol,</span><br><span class="line">      PatchHeight = <span class="number">64</span>,</span><br><span class="line">      PatchWidth = <span class="number">64</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> si.PreviewImage;</span><br></pre></td></tr></table></figure>

<h3 id="查找符号"><a href="#查找符号" class="headerlink" title="查找符号"></a>查找符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within QueuedTask.Run</span></span><br><span class="line"><span class="comment">//Get the selection</span></span><br><span class="line"><span class="keyword">var</span> selection = featureLayer.GetSelection();</span><br><span class="line">  <span class="comment">//Get the first Object ID</span></span><br><span class="line">  <span class="keyword">var</span> firstOID = selection.GetObjectIDs().FirstOrDefault();</span><br><span class="line">  <span class="comment">//Determine whether the layer&#x27;s renderer type supports symbol lookup.</span></span><br><span class="line">  <span class="keyword">if</span> (featureLayer.CanLookupSymbol())</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//Looks up the symbol for the corresponding feature identified by the object id.</span></span><br><span class="line">      <span class="keyword">var</span> symbol = featureLayer.LookupSymbol(firstOID, MapView.Active);</span><br><span class="line">      <span class="keyword">var</span> jSon = symbol.ToJson(); <span class="comment">//Create a JSON encoding of the symbol</span></span><br><span class="line">      <span class="comment">//Do something with symbol</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="符号搜索"><a href="#符号搜索" class="headerlink" title="符号搜索"></a>符号搜索</h2><h3 id="如何在样式中搜索特定项目"><a href="#如何在样式中搜索特定项目" class="headerlink" title="如何在样式中搜索特定项目"></a>如何在样式中搜索特定项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;SymbolStyleItem&gt; <span class="title">GetSymbolFromStyleAsync</span>(<span class="params">StyleProjectItem style, <span class="built_in">string</span> key</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Search for a specific point symbol in style</span></span><br><span class="line">    SymbolStyleItem item = (SymbolStyleItem)style.LookupItem(StyleItemType.PointSymbol, key);</span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索点符号"><a href="#如何在样式中搜索点符号" class="headerlink" title="如何在样式中搜索点符号"></a>如何在样式中搜索点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetPointSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for point symbols</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.PointSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索线符号"><a href="#如何在样式中搜索线符号" class="headerlink" title="如何在样式中搜索线符号"></a>如何在样式中搜索线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetLineSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for line symbols</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.LineSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索面符号"><a href="#如何在样式中搜索面符号" class="headerlink" title="如何在样式中搜索面符号"></a>如何在样式中搜索面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetPolygonSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for polygon symbols</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.PolygonSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索颜色"><a href="#如何在样式中搜索颜色" class="headerlink" title="如何在样式中搜索颜色"></a>如何在样式中搜索颜色</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;ColorStyleItem&gt;&gt; GetColorsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for colors</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchColors(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索色带"><a href="#如何在样式中搜索色带" class="headerlink" title="如何在样式中搜索色带"></a>如何在样式中搜索色带</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;ColorRampStyleItem&gt;&gt; GetColorRampsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//StyleProjectItem can be &quot;ColorBrewer Schemes (RGB)&quot;, &quot;ArcGIS 2D&quot;...</span></span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for color ramps</span></span><br><span class="line">  <span class="comment">//Color Ramp searchString can be &quot;Spectral (7 Classes)&quot;, &quot;Pastel 1 (3 Classes)&quot;, &quot;Red-Gray (10 Classes)&quot;..</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchColorRamps(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索指北针"><a href="#如何在样式中搜索指北针" class="headerlink" title="如何在样式中搜索指北针"></a>如何在样式中搜索指北针</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;NorthArrowStyleItem&gt;&gt; GetNorthArrowsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for north arrows</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchNorthArrows(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索比例尺"><a href="#如何在样式中搜索比例尺" class="headerlink" title="如何在样式中搜索比例尺"></a>如何在样式中搜索比例尺</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;ScaleBarStyleItem&gt;&gt; GetScaleBarsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for scale bars</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchScaleBars(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索标签展示位置"><a href="#如何在样式中搜索标签展示位置" class="headerlink" title="如何在样式中搜索标签展示位置"></a>如何在样式中搜索标签展示位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LabelPlacementStyleItem&gt;&gt; GetLabelPlacementsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for standard label placement</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLabelPlacements(StyleItemType.StandardLabelPlacement, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索图例"><a href="#如何在样式中搜索图例" class="headerlink" title="如何在样式中搜索图例"></a>如何在样式中搜索图例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LegendStyleItem&gt;&gt; GetLegendFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLegends(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索图例项"><a href="#如何在样式中搜索图例项" class="headerlink" title="如何在样式中搜索图例项"></a>如何在样式中搜索图例项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LegendItemStyleItem&gt;&gt; GetLegendItemsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLegendItems(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索网格"><a href="#如何在样式中搜索网格" class="headerlink" title="如何在样式中搜索网格"></a>如何在样式中搜索网格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;GridStyleItem&gt;&gt; GetGridsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchGrids(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索地图整饰"><a href="#如何在样式中搜索地图整饰" class="headerlink" title="如何在样式中搜索地图整饰"></a>如何在样式中搜索地图整饰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;MapSurroundStyleItem&gt;&gt; GetMapSurroundsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchMapSurrounds(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索表格框"><a href="#如何在样式中搜索表格框" class="headerlink" title="如何在样式中搜索表格框"></a>如何在样式中搜索表格框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;TableFrameStyleItem&gt;&gt; GetTableFramesFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchTableFrames(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索表格框字段"><a href="#如何在样式中搜索表格框字段" class="headerlink" title="如何在样式中搜索表格框字段"></a>如何在样式中搜索表格框字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;TableFrameFieldStyleItem&gt;&gt; GetTableFrameFieldsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchTableFrameFields(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="要素图层符号系统"><a href="#要素图层符号系统" class="headerlink" title="要素图层符号系统"></a>要素图层符号系统</h2><h3 id="如何为使用简单渲染器符号化的要素图层设置符号"><a href="#如何为使用简单渲染器符号化的要素图层设置符号" class="headerlink" title="如何为使用简单渲染器符号化的要素图层设置符号"></a>如何为使用简单渲染器符号化的要素图层设置符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">SetFeatureLayerSymbolAsync</span>(<span class="params">FeatureLayer ftrLayer, CIMSymbol symbolToApply</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (ftrLayer == <span class="literal">null</span> || symbolToApply == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get simple renderer from the feature layer</span></span><br><span class="line">    CIMSimpleRenderer currentRenderer = ftrLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">    <span class="keyword">if</span> (currentRenderer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbolToApply.SetRealWorldUnits(ftrLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Update the symbol of the current simple renderer</span></span><br><span class="line">    currentRenderer.Symbol = symbolToApply.MakeSymbolReference();</span><br><span class="line">    <span class="comment">//Update the feature layer renderer</span></span><br><span class="line">    ftrLayer.SetRenderer(currentRenderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式中的符号应用于要素图层"><a href="#如何将样式中的符号应用于要素图层" class="headerlink" title="如何将样式中的符号应用于要素图层"></a>如何将样式中的符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">SetFeatureLayerSymbolFromStyleItemAsync</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">           FeatureLayer ftrLayer, SymbolStyleItem symbolItem</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (ftrLayer == <span class="literal">null</span> || symbolItem == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get simple renderer from the feature layer</span></span><br><span class="line">    CIMSimpleRenderer currentRenderer = ftrLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">    <span class="keyword">if</span> (currentRenderer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//Get symbol from the SymbolStyleItem</span></span><br><span class="line">    CIMSymbol symbol = symbolItem.Symbol;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbol.SetRealWorldUnits(ftrLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Update the symbol of the current simple renderer</span></span><br><span class="line">    currentRenderer.Symbol = symbol.MakeSymbolReference();</span><br><span class="line">    <span class="comment">//Update the feature layer renderer</span></span><br><span class="line">    ftrLayer.SetRenderer(currentRenderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式中的点符号应用于要素图层"><a href="#如何将样式中的点符号应用于要素图层" class="headerlink" title="如何将样式中的点符号应用于要素图层"></a>如何将样式中的点符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">// if (map == null)</span></span><br><span class="line"><span class="comment">//        return;</span></span><br><span class="line"><span class="comment">// var pointFeatureLayer =</span></span><br><span class="line"><span class="comment">//       map.GetLayersAsFlattenedList()</span></span><br><span class="line"><span class="comment">//          .OfType&lt;FeatureLayer&gt;()</span></span><br><span class="line"><span class="comment">//         .Where(fl =&gt; fl.ShapeType == esriGeometryType.esriGeometryPoint);</span></span><br><span class="line"><span class="comment">//   await ApplySymbolToFeatureLayerAsync(pointFeatureLayer.FirstOrDefault(), &quot;Fire Station&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">ApplySymbolToFeatureLayerAsync</span>(<span class="params">FeatureLayer featureLayer, <span class="built_in">string</span> symbolName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the ArcGIS 2D System style from the Project</span></span><br><span class="line">    <span class="keyword">var</span> arcGIS2DStyle =</span><br><span class="line">  Project.Current.GetItems&lt;StyleProjectItem&gt;().FirstOrDefault(s =&gt; s.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Search for the symbolName style items within the ArcGIS 2D style project item.</span></span><br><span class="line">    <span class="keyword">var</span> items = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    arcGIS2DStyle.SearchSymbols(StyleItemType.PointSymbol, symbolName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Gets the CIMSymbol</span></span><br><span class="line">    CIMSymbol symbol = items.FirstOrDefault().Symbol;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the renderer of the point feature layer</span></span><br><span class="line">    CIMSimpleRenderer renderer = featureLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbol.SetRealWorldUnits(featureLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Apply the symbol to the feature layer&#x27;s current renderer</span></span><br><span class="line">    renderer.Symbol = symbol.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Appy the renderer to the feature layer</span></span><br><span class="line">    featureLayer.SetRenderer(renderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式的色带应用于要素图层"><a href="#如何将样式的色带应用于要素图层" class="headerlink" title="如何将样式的色带应用于要素图层"></a>如何将样式的色带应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ApplyColorRampAsync</span>(<span class="params">FeatureLayer featureLayer, List&lt;<span class="built_in">string</span>&gt; fields</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    StyleProjectItem style =</span><br><span class="line">        Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">            .FirstOrDefault(s =&gt; s.Name == <span class="string">&quot;ColorBrewer Schemes (RGB)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt; </span><br><span class="line">                style.SearchColorRamps(<span class="string">&quot;Red-Gray (10 Classes)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (colorRampList == <span class="literal">null</span> || colorRampList.Count == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    CIMColorRamp cimColorRamp = <span class="literal">null</span>;</span><br><span class="line">    CIMRenderer renderer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        cimColorRamp = colorRampList[<span class="number">0</span>].ColorRamp;</span><br><span class="line">        <span class="keyword">var</span> rendererDef = <span class="keyword">new</span> UniqueValueRendererDefinition(fields, <span class="literal">null</span>, cimColorRamp);</span><br><span class="line">        renderer = featureLayer?.CreateRenderer(rendererDef);</span><br><span class="line">        featureLayer?.SetRenderer(renderer);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地图创作-注释片段"><a href="#地图创作-注释片段" class="headerlink" title="地图创作-注释片段"></a>地图创作-注释片段</h2><h3 id="创建注记构造工具"><a href="#创建注记构造工具" class="headerlink" title="创建注记构造工具"></a>创建注记构造工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//In your config.daml...set the categoryRefID</span></span><br><span class="line"><span class="comment">//&lt;tool id=&quot;...&quot; categoryRefID=&quot;esri_editing_construction_annotation&quot; caption=&quot;Create Anno&quot; ...&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Sketch type Point or Line or BezierLine in the constructor...</span></span><br><span class="line"><span class="comment">//internal class AnnoConstructionTool : MapTool  &#123;</span></span><br><span class="line"><span class="comment">//  public AnnoConstructionTool()  &#123;</span></span><br><span class="line"><span class="comment">//    IsSketchTool = true;</span></span><br><span class="line"><span class="comment">//    UseSnapping = true;</span></span><br><span class="line"><span class="comment">//    SketchType = SketchGeometryType.Point;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="keyword">override</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (CurrentTemplate == <span class="literal">null</span> || geometry == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an edit operation</span></span><br><span class="line">    <span class="keyword">var</span> createOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">    createOperation.Name = <span class="built_in">string</span>.Format(<span class="string">&quot;Create &#123;0&#125;&quot;</span>, CurrentTemplate.Layer.Name);</span><br><span class="line">    createOperation.SelectNewFeatures = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update the geometry point into a 2 point line</span></span><br><span class="line">    <span class="comment">//annotation needs at minimum a 2 point line for the text to be placed</span></span><br><span class="line">    <span class="built_in">double</span> tol = <span class="number">0.01</span>;</span><br><span class="line">    <span class="keyword">var</span> polyline = <span class="keyword">await</span> CreatePolylineFromPointAsync((MapPoint)geometry, tol);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Queue feature creation</span></span><br><span class="line">    createOperation.Create(CurrentTemplate, polyline);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute the operation</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> createOperation.ExecuteAsync();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> Task&lt;Polyline&gt; <span class="title">CreatePolylineFromPointAsync</span>(<span class="params">MapPoint pt, <span class="built_in">double</span> tolerance</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// create a polyline from a starting point</span></span><br><span class="line">    <span class="comment">//use a tolerance to construct the second point</span></span><br><span class="line">    MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(pt.X + tolerance, pt.Y, pt.SpatialReference);</span><br><span class="line">        <span class="keyword">return</span> PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt, pt2 &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在"><a href="#通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在" class="headerlink" title="通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在"></a>通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//See &quot;Change Annotation Text Graphic&quot; for an alternative if TEXTSTRING is missing from the schema</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//annoLayer is ~your~ Annotation layer...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// use the inspector methodology</span></span><br><span class="line">    <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">    insp.Load(annoLayer, oid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure TextString attribute exists.</span></span><br><span class="line">    <span class="comment">//It is not guaranteed to be in the schema</span></span><br><span class="line">    ArcGIS.Desktop.Editing.Attributes.Attribute att = insp.FirstOrDefault(a =&gt; a.FieldName == <span class="string">&quot;TEXTSTRING&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (att != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        insp[<span class="string">&quot;TEXTSTRING&quot;</span>] = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create and execute the edit operation</span></span><br><span class="line">        EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">        op.Name = <span class="string">&quot;Update annotation&quot;</span>;</span><br><span class="line">        op.Modify(insp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//OR using a Dictionary - again TEXTSTRING has to exist in the schema</span></span><br><span class="line">        <span class="comment">//Dictionary&lt;string, object&gt; newAtts = new Dictionary&lt;string, object&gt;();</span></span><br><span class="line">        <span class="comment">//newAtts.Add(&quot;TEXTSTRING&quot;, &quot;hello world&quot;);</span></span><br><span class="line">        <span class="comment">//op.Modify(annoLayer, oid, newAtts);</span></span><br><span class="line"></span><br><span class="line">        op.Execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="旋转或移动批注"><a href="#旋转或移动批注" class="headerlink" title="旋转或移动批注"></a>旋转或移动批注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Don&#x27;t use &#x27;Shape&#x27;....Shape is the bounding box of the annotation text. This is NOT what you want...</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//var insp = new Inspector();</span></span><br><span class="line">    <span class="comment">//insp.Load(annoLayer, oid);</span></span><br><span class="line">    <span class="comment">//var shape = insp[&quot;SHAPE&quot;] as Polygon;</span></span><br><span class="line">    <span class="comment">//...wrong shape...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Instead, we must get the TextGraphic from the anno feature.</span></span><br><span class="line">    <span class="comment">//The TextGraphic shape will be the anno baseline...</span></span><br><span class="line">    <span class="comment">//At 2.1 the only way to retrieve this textLine is to obtain the TextGraphic from the AnnotationFeature</span></span><br><span class="line">    QueryFilter qf = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">    &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;OBJECTID = 1&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//annoLayer is ~your~ Annotation layer</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rowCursor = annoLayer.Search(qf))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> annoFeature = rowCursor.Current <span class="keyword">as</span> </span><br><span class="line">            ArcGIS.Core.Data.Mapping.AnnotationFeature)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> graphic = annoFeature.GetGraphic();</span><br><span class="line">  <span class="keyword">var</span> textGraphic = graphic <span class="keyword">as</span> CIMTextGraphic;</span><br><span class="line">  <span class="keyword">var</span> textLine = textGraphic.Shape <span class="keyword">as</span> Polyline;</span><br><span class="line">  <span class="comment">// rotate the shape 90 degrees</span></span><br><span class="line">  <span class="keyword">var</span> origin = GeometryEngine.Instance.Centroid(textLine);</span><br><span class="line">  Geometry rotatedPolyline = GeometryEngine.Instance.Rotate(textLine, origin, System.Math.PI / <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//Move the line 5 &quot;units&quot; in the x and y direction</span></span><br><span class="line">  <span class="comment">//GeometryEngine.Instance.Move(textLine, 5, 5);</span></span><br><span class="line"></span><br><span class="line">  EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;Change annotation angle&quot;</span>;</span><br><span class="line">  op.Modify(annoLayer, oid, rotatedPolyline);</span><br><span class="line">  op.Execute();</span><br><span class="line">&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取批注文本图形"><a href="#获取批注文本图形" class="headerlink" title="获取批注文本图形"></a>获取批注文本图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> table = annoLayer.GetTable())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = table.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> af = rc.Current <span class="keyword">as</span> AnnotationFeature)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> graphic = af.GetGraphic();</span><br><span class="line">                <span class="keyword">var</span> textGraphic = graphic <span class="keyword">as</span> CIMTextGraphic;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Note: </span></span><br><span class="line">                <span class="comment">//var outline_geom = af.GetGraphicOutline(); </span></span><br><span class="line">                <span class="comment">//gets the anno text outline geometry...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取注释的轮廓几何图形"><a href="#获取注释的轮廓几何图形" class="headerlink" title="获取注释的轮廓几何图形"></a>获取注释的轮廓几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> annoLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                               .OfType&lt;AnnotationLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (annoLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//get the first annotation feature...</span></span><br><span class="line">    <span class="comment">//...assuming at least one feature gets selected</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> fc = annoLayer.GetFeatureClass())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = fc.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> af = rc.Current <span class="keyword">as</span> AnnotationFeature)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> outline_geom = af.GetGraphicOutline();</span><br><span class="line">                <span class="comment">//TODO - use the outline...</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//Note: </span></span><br><span class="line">                <span class="comment">//var graphic = annoFeature.GetGraphic(); </span></span><br><span class="line">                <span class="comment">//gets the CIMTextGraphic...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取注释的遮罩几何图形"><a href="#获取注释的遮罩几何图形" class="headerlink" title="获取注释的遮罩几何图形"></a>获取注释的遮罩几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> annoLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                         .OfType&lt;AnnotationLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (annoLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//get the first annotation feature...</span></span><br><span class="line">    <span class="comment">//...assuming at least one feature gets selected</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> fc = annoLayer.GetFeatureClass())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = fc.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> oid = row.GetObjectID();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Use DrawingOutlineType.BoundingEnvelope to retrieve a generalized</span></span><br><span class="line">                <span class="comment">//mask geometry or &quot;Box&quot;. The mask will be in the same SpatRef as the map.</span></span><br><span class="line">                <span class="comment">//The mask will be constructed using the anno class reference scale</span></span><br><span class="line">                <span class="comment">//At 2.x - var mask_geom = annoLayer.QueryDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> mask_geom = annoLayer.GetDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="地图创作标记代码段"><a href="#地图创作标记代码段" class="headerlink" title="地图创作标记代码段"></a>地图创作标记代码段</h2><h3 id="获取活动地图的标注引擎-Maplex-或标准标注引擎"><a href="#获取活动地图的标注引擎-Maplex-或标准标注引擎" class="headerlink" title="获取活动地图的标注引擎 - Maplex 或标准标注引擎"></a>获取活动地图的标注引擎 - Maplex 或标准标注引擎</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the active map&#x27;s definition - CIMMap.</span></span><br><span class="line"><span class="keyword">var</span> cimMap = MapView.Active.Map.GetDefinition();</span><br><span class="line"><span class="comment">//Get the labeling engine from the map definition</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = cimMap.GeneralPlacementProperties;</span><br></pre></td></tr></table></figure>

<h3 id="将活动地图的标注引擎从标准更改为-Maplex，反之亦然"><a href="#将活动地图的标注引擎从标准更改为-Maplex，反之亦然" class="headerlink" title="将活动地图的标注引擎从标准更改为 Maplex，反之亦然"></a>将活动地图的标注引擎从标准更改为 Maplex，反之亦然</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the active map&#x27;s definition - CIMMap.</span></span><br><span class="line"><span class="keyword">var</span> cimMap = MapView.Active.Map.GetDefinition();</span><br><span class="line"><span class="comment">//Get the labeling engine from the map definition</span></span><br><span class="line"><span class="keyword">var</span> cimGeneralPlacement = cimMap.GeneralPlacementProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cimGeneralPlacement <span class="keyword">is</span> CIMMaplexGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">  <span class="comment">//Create a new standard label engine properties</span></span><br><span class="line">  <span class="keyword">var</span> cimStandardPlacementProperties = <span class="keyword">new</span> CIMStandardGeneralPlacementProperties();</span><br><span class="line">  <span class="comment">//Set the CIMMap&#x27;s GeneralPlacementProperties to the new label engine</span></span><br><span class="line">  cimMap.GeneralPlacementProperties = cimStandardPlacementProperties;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard labeling engine</span></span><br><span class="line">  <span class="comment">//Create a new Maplex label engine properties</span></span><br><span class="line">  <span class="keyword">var</span> cimMaplexGeneralPlacementProperties = <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties();</span><br><span class="line">  <span class="comment">//Set the CIMMap&#x27;s GeneralPlacementProperties to the new label engine</span></span><br><span class="line">  cimMap.GeneralPlacementProperties = cimMaplexGeneralPlacementProperties;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Set the map&#x27;s definition</span></span><br><span class="line">MapView.Active.Map.SetDefinition(cimMap);</span><br></pre></td></tr></table></figure>

<h3 id="将文本符号应用于要素图层"><a href="#将文本符号应用于要素图层" class="headerlink" title="将文本符号应用于要素图层"></a>将文本符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Set the label classes&#x27; symbol to the custom text symbol</span></span><br><span class="line"><span class="comment">//Refer to the ProSnippets-TextSymbols wiki page for help with creating custom text symbols.</span></span><br><span class="line"><span class="comment">//Example: var textSymbol = await CreateTextSymbolWithHaloAsync();</span></span><br><span class="line">theLabelClass.TextSymbol.Symbol = textSymbol;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">                                     <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="启用图层标注"><a href="#启用图层标注" class="headerlink" title="启用图层标注"></a>启用图层标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!featureLayer.IsLabelVisible)</span><br><span class="line">  <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">  featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="修改标签的位置-x2F-位置-点几何"><a href="#修改标签的位置-x2F-位置-点几何" class="headerlink" title="修改标签的位置&#x2F;位置 - 点几何"></a>修改标签的位置&#x2F;位置 - 点几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = </span><br><span class="line">   MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties) <span class="comment">//Current labeling engine is Standard labeling engine               </span></span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PointPlacementMethod = </span><br><span class="line">           StandardPointPlacementMethod.OnTopPoint;</span><br><span class="line"><span class="keyword">else</span>    <span class="comment">//Current labeling engine is Maplex labeling engine            </span></span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PointPlacementMethod = </span><br><span class="line">          MaplexPointPlacementMethod.CenteredOnPoint;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签的位置-x2F-位置-线几何"><a href="#修改标签的位置-x2F-位置-线几何" class="headerlink" title="修改标签的位置&#x2F;位置 - 线几何"></a>修改标签的位置&#x2F;位置 - 线几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = </span><br><span class="line">    MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard labeling engine</span></span><br><span class="line">  <span class="keyword">var</span> lineLablePosition = <span class="keyword">new</span> CIMStandardLineLabelPosition</span><br><span class="line">  &#123;</span><br><span class="line">    Perpendicular = <span class="literal">true</span>,</span><br><span class="line">    Parallel = <span class="literal">false</span>,</span><br><span class="line">    ProduceCurvedLabels = <span class="literal">false</span>,</span><br><span class="line">    Horizontal = <span class="literal">false</span>,</span><br><span class="line">    OnTop = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.LineLabelPosition = </span><br><span class="line">      lineLablePosition;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">&#123;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.LinePlacementMethod = </span><br><span class="line">                MaplexLinePlacementMethod.CenteredPerpendicularOnLine;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.LineFeatureType = </span><br><span class="line">                MaplexLineFeatureType.General;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//theLabelClass.MaplexLabelPlacementProperties.LinePlacementMethod = MaplexLinePlacementMethod.CenteredPerpendicularOnLine;</span></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标注的位置-x2F-位置-多边形几何"><a href="#修改标注的位置-x2F-位置-多边形几何" class="headerlink" title="修改标注的位置&#x2F;位置 - 多边形几何"></a>修改标注的位置&#x2F;位置 - 多边形几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard Labeling engine</span></span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PolygonPlacementMethod = </span><br><span class="line">           StandardPolygonPlacementMethod.AlwaysHorizontal;</span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PlaceOnlyInsidePolygon = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PolygonFeatureType = </span><br><span class="line">                           MaplexPolygonFeatureType.LandParcel;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.AvoidPolygonHoles = <span class="literal">true</span>;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PolygonPlacementMethod = </span><br><span class="line">                      MaplexPolygonPlacementMethod.HorizontalInPolygon;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.CanPlaceLabelOutsidePolygon = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">                                     <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用-MaplexEngine-修改标注的方向-点和面几何"><a href="#使用-MaplexEngine-修改标注的方向-点和面几何" class="headerlink" title="使用 MaplexEngine 修改标注的方向 - 点和面几何"></a>使用 MaplexEngine 修改标注的方向 - 点和面几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Orientation                 </span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.GraticuleAlignment = <span class="literal">true</span>;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.GraticuleAlignmentType = MaplexGraticuleAlignmentType.Curved;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-MaplexEngine-线几何修改标注的方向"><a href="#使用-MaplexEngine-线几何修改标注的方向" class="headerlink" title="使用 MaplexEngine - 线几何修改标注的方向"></a>使用 MaplexEngine - 线几何修改标注的方向</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Orientation</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.AlignLabelToLineDirection = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签旋转-点几何"><a href="#修改标签旋转-点几何" class="headerlink" title="修改标签旋转 - 点几何"></a>修改标签旋转 - 点几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Rotation</span></span><br><span class="line">CIMMaplexRotationProperties rotationProperties = <span class="keyword">new</span> CIMMaplexRotationProperties</span><br><span class="line">&#123;</span><br><span class="line">  Enable = <span class="literal">true</span>, <span class="comment">//Enable rotation</span></span><br><span class="line">  RotationField = <span class="string">&quot;ELEVATION&quot;</span>, <span class="comment">//Field that is used to define rotation angle</span></span><br><span class="line">  AdditionalAngle = <span class="number">15</span>, <span class="comment">//Additional rotation </span></span><br><span class="line">  RotationType = MaplexLabelRotationType.Arithmetic,</span><br><span class="line">  AlignmentType = MaplexRotationAlignmentType.Perpendicular,</span><br><span class="line">  AlignLabelToAngle = <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.RotationProperties = rotationProperties;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="在多边形几何中展开标注"><a href="#在多边形几何中展开标注" class="headerlink" title="在多边形几何中展开标注"></a>在多边形几何中展开标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Spread Labels (words and characters to fill feature)</span></span><br><span class="line"><span class="comment">// Spread words to fill feature</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.SpreadWords = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//Spread Characters to a fixed limit of 50%</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.SpreadCharacters = <span class="literal">true</span>;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.MaximumCharacterSpacing = <span class="number">50.0</span>;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签的引出线锚点属性-多边形几何"><a href="#修改标签的引出线锚点属性-多边形几何" class="headerlink" title="修改标签的引出线锚点属性 - 多边形几何"></a>修改标签的引出线锚点属性 - 多边形几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//If TextSymbol is a callout the leader line anachor point can be modified</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.PolygonAnchorPointType = MaplexAnchorPointType.Perimeter;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<p>n</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1361151272@qq.com">shaozhy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://shaoshao.net.cn/2022/12/28/20221228140625000/">https://shaoshao.net.cn/2022/12/28/20221228140625000/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shaoshao.net.cn" target="_blank">WineMonk</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/discover/tags/CSharp/">CSharp</a><a class="post-meta__tags" href="/discover/tags/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></div><div class="post_share"><div class="social-share" data-image="https://shaoshao.net.cn/images/blog/cover/current/post_14.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/28/20221228140815000/"><img class="prev-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_15.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ArcGIS Pro SDK 地图创作-体素图层</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/28/20221228140451000/"><img class="next-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_13.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ArcGIS Pro SDK 布局-报告</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/28/20221228134215000/" title="ArcGIS Pro SDK 内容"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 内容</div></div></a></div><div><a href="/2022/12/28/20221228134536000/" title="ArcGIS Pro SDK 核心主机"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_06.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 核心主机</div></div></a></div><div><a href="/2022/12/28/20221228134946000/" title="ArcGIS Pro SDK 编辑"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_07.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 编辑</div></div></a></div><div><a href="/2022/12/28/20221228133712000/" title="ArcGIS Pro SDK 框架"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_04.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 框架</div></div></a></div><div><a href="/2022/12/28/20221228135620000/" title="ArcGIS Pro SDK 地理处理"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 地理处理</div></div></a></div><div><a href="/2022/12/28/20221228135824000/" title="ArcGIS Pro SDK 图形图层"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 图形图层</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">地图创作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.1.1.</span> <span class="toc-text">获取活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82%E5%88%9B%E5%BB%BA%E6%96%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.1.2.</span> <span class="toc-text">使用默认底图图层创建新地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E7%A8%8B%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%9C%B0%E5%9B%BE%E5%B9%B6%E5%B0%86%E5%85%B6%E6%89%93%E5%BC%80"><span class="toc-number">1.1.3.</span> <span class="toc-text">在工程中查找地图并将其打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80-web-%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.1.4.</span> <span class="toc-text">打开 web 地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9B%BE%E7%AA%97%E6%A0%BC"><span class="toc-number">1.1.5.</span> <span class="toc-text">获取地图窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E7%AA%97%E6%A0%BC%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%94%AF%E4%B8%80%E7%9A%84%E5%9C%B0%E5%9B%BE%E5%88%97%E8%A1%A8"><span class="toc-number">1.1.6.</span> <span class="toc-text">从地图窗格中获取唯一的地图列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9C%B0%E5%9B%BE%E5%90%8D%E7%A7%B0"><span class="toc-number">1.1.7.</span> <span class="toc-text">更改地图名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E7%AA%97%E6%A0%BC%E7%9A%84%E6%A0%87%E9%A2%98"><span class="toc-number">1.1.8.</span> <span class="toc-text">重命名窗格的标题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%B1%80%E9%83%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.1.9.</span> <span class="toc-text">将地图转换为局部场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BA%95%E5%9B%BE"><span class="toc-number">1.1.10.</span> <span class="toc-text">获取底图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E5%8F%A6%E5%AD%98%E4%B8%BA-MapX"><span class="toc-number">1.1.11.</span> <span class="toc-text">将地图另存为 MapX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-2D-%E5%9C%B0%E5%9B%BE%E5%8F%A6%E5%AD%98%E4%B8%BA-Web-%E5%9C%B0%E5%9B%BE-%E5%9C%A8%E7%A3%81%E7%9B%98%E4%B8%8A"><span class="toc-number">1.1.12.</span> <span class="toc-text">将 2D 地图另存为 Web 地图 在磁盘上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%81%E5%89%AA%E6%98%A0%E5%B0%84%E5%88%B0%E6%8F%90%E4%BE%9B%E7%9A%84%E8%A3%81%E5%89%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">1.1.13.</span> <span class="toc-text">裁剪映射到提供的裁剪多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E5%89%AA%E8%BE%91%E5%87%A0%E4%BD%95"><span class="toc-number">1.1.14.</span> <span class="toc-text">清除当前地图剪辑几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9B%BE%E8%A3%81%E5%89%AA%E5%87%A0%E4%BD%95"><span class="toc-number">1.1.15.</span> <span class="toc-text">获取地图裁剪几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E5%85%83"><span class="toc-number">1.1.16.</span> <span class="toc-text">获取当前地图位置单元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E7%9A%84%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E4%BD%8D%E5%88%97%E8%A1%A8"><span class="toc-number">1.1.17.</span> <span class="toc-text">获取可用的地图位置单位列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E5%85%83%E8%AE%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.18.</span> <span class="toc-text">使用当前地图位置单元设置位置格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%8D%95%E4%BD%8D"><span class="toc-number">1.1.19.</span> <span class="toc-text">设置当前地图的位置单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">1.1.20.</span> <span class="toc-text">获取当前地图高程单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E7%9A%84%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D%E5%88%97%E8%A1%A8"><span class="toc-number">1.1.21.</span> <span class="toc-text">获取可用的地图高程单位列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D%E8%AE%BE%E7%BD%AE%E9%AB%98%E7%A8%8B%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.22.</span> <span class="toc-text">使用当前地图高程单位设置高程格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E7%9A%84%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">1.1.23.</span> <span class="toc-text">设置当前地图的高程单位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.2.</span> <span class="toc-text">离线地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E6%98%AF%E5%90%A6%E5%85%B7%E6%9C%89%E5%90%AF%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">检查地图是否具有启用同步的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%90%AF%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E5%86%85%E5%AE%B9%E7%94%9F%E6%88%90%E5%89%AF%E6%9C%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">为启用同步的内容生成副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E6%98%AF%E5%90%A6%E5%85%B7%E6%9C%89%E6%9C%AC%E5%9C%B0%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">检查地图是否具有本地可同步内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9%E7%9A%84%E5%89%AF%E6%9C%AC"><span class="toc-number">1.2.4.</span> <span class="toc-text">同步可同步内容的副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9%E7%9A%84%E5%89%AF%E6%9C%AC"><span class="toc-number">1.2.5.</span> <span class="toc-text">删除可同步内容的副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%9C%B0%E5%9B%BE%E6%A0%85%E6%A0%BC%E5%88%87%E7%89%87%E7%BC%93%E5%AD%98%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.6.</span> <span class="toc-text">导出地图栅格切片缓存内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%9C%B0%E5%9B%BE%E7%9F%A2%E9%87%8F%E5%88%87%E7%89%87%E7%BC%93%E5%AD%98%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.7.</span> <span class="toc-text">导出地图矢量切片缓存内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.</span> <span class="toc-text">创建图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建图层并将其添加到活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.2.</span> <span class="toc-text">使用创建参数创建图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%B1%82%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.3.3.</span> <span class="toc-text">创建要素图层并使用图层创建参数添加到地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%B8%8D%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%9C%B0%E5%9B%BE%E4%B8%AD%E3%80%82"><span class="toc-number">1.3.4.</span> <span class="toc-text">创建要素图层并设置为不显示在地图中。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.5.</span> <span class="toc-text">使用渲染器创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.6.</span> <span class="toc-text">使用查询定义创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%B3%A8%E9%87%8A%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.3.7.</span> <span class="toc-text">将地图注释添加到活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%9B%BE%E5%B1%82%E7%9A%84%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.3.8.</span> <span class="toc-text">应用目录中图层的符号系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%AD%90%E7%B1%BB%E5%9E%8B%E5%9B%BE%E5%B1%82%E7%BB%84"><span class="toc-number">1.3.9.</span> <span class="toc-text">创建新的子类型图层组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-lyrx-%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.10.</span> <span class="toc-text">从 lyrx 文件创建图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E5%BA%94%E7%94%A8%E4%BA%8E%E5%9B%BE%E5%B1%82%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.11.</span> <span class="toc-text">将符号系统应用于图层文件中的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-WMS-%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.12.</span> <span class="toc-text">添加 WMS 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-WFS-%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.13.</span> <span class="toc-text">添加 WFS 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%92%8C%E6%9B%B4%E6%94%B9-WMS-%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.3.14.</span> <span class="toc-text">添加和更改 WMS 服务图层的样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.15.</span> <span class="toc-text">创建查询图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%80%BC%E5%88%86%E7%B1%BB%E9%97%B4%E9%9A%94%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.16.</span> <span class="toc-text">使用默认值分类间隔渲染器创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%86%E7%B1%BB%E9%97%B4%E9%9A%94%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.3.17.</span> <span class="toc-text">使用分类间隔渲染器创建要素图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">1.4.</span> <span class="toc-text">底图图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">1.4.1.</span> <span class="toc-text">更新地图的底图图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%A7%BB%E9%99%A4%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">从地图中移除底图图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">使用图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%8C%89%E5%9B%BE%E5%B1%82%E7%B1%BB%E5%9E%8B%E8%BF%87%E6%BB%A4%E7%9A%84%E5%9B%BE%E5%B1%82%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">从地图中获取按图层类型过滤的图层列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.2.</span> <span class="toc-text">获取特定几何类型的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.3.</span> <span class="toc-text">查找图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">1.5.4.</span> <span class="toc-text">查找独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%83%A8%E5%88%86%E5%90%8D%E7%A7%B0%E6%90%9C%E7%B4%A2%E6%9F%A5%E6%89%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.5.</span> <span class="toc-text">使用部分名称搜索查找图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%B1%82%E5%8F%AF%E8%A7%81%E6%80%A7%E3%80%81%E5%8F%AF%E7%BC%96%E8%BE%91%E6%80%A7%E3%80%81%E6%8D%95%E6%8D%89%E6%80%A7"><span class="toc-number">1.5.6.</span> <span class="toc-text">更改图层可见性、可编辑性、捕捉性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Lyrx-%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.7.</span> <span class="toc-text">创建 Lyrx 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%9B%BE%E5%B1%82%E4%B8%8A%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">1.5.8.</span> <span class="toc-text">计算图层上所选要素的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9A%84%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5"><span class="toc-number">1.5.9.</span> <span class="toc-text">访问图层的显示字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9B%BE%E5%B1%82%E4%B8%8A%E5%90%AF%E7%94%A8%E6%A0%87%E6%B3%A8"><span class="toc-number">1.5.10.</span> <span class="toc-text">在图层上启用标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-2D-%E7%BB%84%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%B1%80%E9%83%A8%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84-3D-%E7%BB%84"><span class="toc-number">1.5.11.</span> <span class="toc-text">将 2D 组中的图层移动到局部场景中的 3D 组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E8%A6%81%E7%B4%A0%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E7%9A%84-URL"><span class="toc-number">1.5.12.</span> <span class="toc-text">重置要素服务图层的 URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E6%BA%90-%E7%9B%B8%E5%90%8C%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.13.</span> <span class="toc-text">更改要素图层的基础数据源 - 相同的工作空间类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E6%9B%B4%E6%94%B9%E4%B8%BA%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.14.</span> <span class="toc-text">将图层的地理数据库版本更改为地图中的指定版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.15.</span> <span class="toc-text">查询要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E7%9A%84%E5%B1%9E%E6%80%A7%E6%97%8B%E8%BD%AC%E5%AD%97%E6%AE%B5"><span class="toc-number">1.5.16.</span> <span class="toc-text">获取图层的属性旋转字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E8%A6%81%E6%97%8B%E8%BD%AC%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7%E5%AD%97%E6%AE%B5"><span class="toc-number">1.5.17.</span> <span class="toc-text">查找要旋转的连接属性字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E2%80%9C%E8%AE%BE%E7%BD%AE%E5%8F%82%E8%80%83%E6%AF%94%E4%BE%8B%E6%97%B6%E7%BC%A9%E6%94%BE%E5%9B%BE%E5%B1%82%E7%AC%A6%E5%8F%B7%E2%80%9D"><span class="toc-number">1.5.18.</span> <span class="toc-text">切换“设置参考比例时缩放图层符号”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%BE%E5%B1%82%E7%BC%93%E5%AD%98"><span class="toc-number">1.5.19.</span> <span class="toc-text">设置图层缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%B1%82%E9%80%89%E6%8B%A9%E9%A2%9C%E8%89%B2"><span class="toc-number">1.5.20.</span> <span class="toc-text">更改图层选择颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%9C%AA%E9%80%89%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.21.</span> <span class="toc-text">删除所有未选中的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%A9%BA%E7%BB%84"><span class="toc-number">1.5.22.</span> <span class="toc-text">删除空组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9C%B0%E5%9B%BE%E5%AE%9A%E4%B9%89%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%BC%A9%E5%86%99%E5%AD%97%E5%85%B8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%9B%BE%E5%B1%82"><span class="toc-number">1.5.23.</span> <span class="toc-text">在地图定义中创建缩写字典并将其应用于图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A1%A8-ITablePane"><span class="toc-number">1.6.</span> <span class="toc-text">属性表 - ITablePane</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E8%A1%A8%E7%9A%84%E7%BC%A9%E6%94%BE%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.1.</span> <span class="toc-text">设置属性表的缩放级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%B1%9E%E6%80%A7%E8%A1%A8%E4%B8%AD%E6%89%80%E9%80%89%E5%83%8F%E5%85%83%E7%9A%84%E5%80%BC"><span class="toc-number">1.6.2.</span> <span class="toc-text">检索属性表中所选像元的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%88%B0%E7%89%B9%E5%AE%9A%E8%A1%8C"><span class="toc-number">1.6.3.</span> <span class="toc-text">移动到特定行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.</span> <span class="toc-text">元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%92%8C%E8%AE%BE%E7%BD%AE%E5%9C%B0%E5%9B%BE%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.1.</span> <span class="toc-text">获取和设置地图元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%B1%82%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">图层元数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.8.</span> <span class="toc-text">渲染器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93%E5%99%A8%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.8.1.</span> <span class="toc-text">将唯一值渲染器设置为活动地图的所选要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E5%80%BC%E5%91%88%E7%8E%B0%E5%99%A8%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%80%BC%E7%9A%84%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.8.2.</span> <span class="toc-text">创建一个唯一值呈现器以指定值的符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%83%AD%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.8.3.</span> <span class="toc-text">创建热图渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%AA%E5%88%86%E7%B1%BB%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.8.4.</span> <span class="toc-text">创建未分类渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%80%E5%A4%A7%E5%92%8C%E6%9C%80%E5%B0%8F%E7%AC%A6%E5%8F%B7%E5%A4%A7%E5%B0%8F%E4%B8%8A%E9%99%90%E7%9A%84%E6%AF%94%E4%BE%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.8.5.</span> <span class="toc-text">创建最大和最小符号大小上限的比例渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9C%9F%E5%AE%9E%E6%AF%94%E4%BE%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.8.6.</span> <span class="toc-text">创建真实比例渲染器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%B1%E5%BB%8A"><span class="toc-number">1.9.</span> <span class="toc-text">拱廊</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Arcade-%E4%BF%AE%E6%94%B9%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">1.9.1.</span> <span class="toc-text">使用 Arcade 修改渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Arcade-%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.9.2.</span> <span class="toc-text">使用 Arcade 修改标注表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.</span> <span class="toc-text">高程表面图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%9C%B0%E8%A1%A8%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">1.10.1.</span> <span class="toc-text">创建具有地表图层的场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2"><span class="toc-number">1.10.2.</span> <span class="toc-text">创建新的高程表面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E8%AE%BE%E7%BD%AE%E4%B8%BA-Z-%E6%84%9F%E7%9F%A5%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.3.</span> <span class="toc-text">将自定义高程表面设置为 Z 感知图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E9%AB%98%E7%A8%8B%E6%BA%90%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%8E%B0%E6%9C%89%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.4.</span> <span class="toc-text">将高程源添加到现有高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E8%8E%B7%E5%8F%96%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82%E5%92%8C%E9%AB%98%E7%A8%8B%E6%BA%90%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.5.</span> <span class="toc-text">从地图中获取高程表面图层和高程源图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.6.</span> <span class="toc-text">查找高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.10.7.</span> <span class="toc-text">移除高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%9B%B2%E9%9D%A2%E8%8E%B7%E5%8F%96-Z-%E5%80%BC"><span class="toc-number">1.10.8.</span> <span class="toc-text">从曲面获取 Z 值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.</span> <span class="toc-text">栅格图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.1.</span> <span class="toc-text">创建栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.11.2.</span> <span class="toc-text">更新栅格图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.11.3.</span> <span class="toc-text">更新栅格图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%9F%90%E4%B8%AA%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.4.</span> <span class="toc-text">检查是否可以将某个着色器应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">1.11.7.</span> <span class="toc-text">使用新的着色器定义创建栅格图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%AC%E8%B5%9B%E5%85%8B%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.</span> <span class="toc-text">马赛克图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.1.</span> <span class="toc-text">创建镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.12.2.</span> <span class="toc-text">更新镶嵌图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.12.3.</span> <span class="toc-text">更新镶嵌图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%9F%90%E7%A7%8D%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E9%A9%AC%E8%B5%9B%E5%85%8B%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.4.</span> <span class="toc-text">检查是否可以将某种着色器应用于马赛克图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">1.12.7.</span> <span class="toc-text">使用新的着色器定义创建镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E9%A1%BA%E5%BA%8F-%E9%95%B6%E5%B5%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.12.8.</span> <span class="toc-text">更新镶嵌图层上的排序顺序 - 镶嵌方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E8%A7%A3%E6%9E%90%E9%87%8D%E5%8F%A0-%E9%95%B6%E5%B5%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.12.9.</span> <span class="toc-text">更新镶嵌图层上的解析重叠 - 镶嵌运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.</span> <span class="toc-text">影像服务图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.1.</span> <span class="toc-text">创建影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.13.2.</span> <span class="toc-text">更新影像服务图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.13.3.</span> <span class="toc-text">更新影像服务图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E7%89%B9%E5%AE%9A%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.4.</span> <span class="toc-text">检查是否可以将特定着色器应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">1.13.7.</span> <span class="toc-text">使用新的着色器定义创建影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E9%A1%BA%E5%BA%8F-%E9%95%B6%E5%B5%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.13.8.</span> <span class="toc-text">更新影像服务图层上的排序顺序 - 镶嵌方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E8%A7%A3%E5%86%B3%E9%87%8D%E5%8F%A0-%E9%95%B6%E5%B5%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.13.9.</span> <span class="toc-text">更新影像服务图层上的解决重叠 - 镶嵌运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">1.14.</span> <span class="toc-text">使用独立表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">1.14.1.</span> <span class="toc-text">创建独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E7%9A%84%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%A3%80%E7%B4%A2%E8%A1%A8"><span class="toc-number">1.14.2.</span> <span class="toc-text">从表的容器中检索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">1.14.3.</span> <span class="toc-text">移动独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">1.14.4.</span> <span class="toc-text">删除独立表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E5%9B%BE%E5%B1%82%E7%BB%98%E5%88%B6-%EF%BC%88SLD%EF%BC%89"><span class="toc-number">1.15.</span> <span class="toc-text">符号图层绘制 （SLD）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-SLD"><span class="toc-number">1.15.1.</span> <span class="toc-text">添加 SLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%9B%BE%E5%B1%82%E6%98%AF%E5%90%A6%E6%B7%BB%E5%8A%A0%E4%BA%86-SLD"><span class="toc-number">1.15.2.</span> <span class="toc-text">确定图层是否添加了 SLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-x2F-%E7%A6%81%E7%94%A8-SLD"><span class="toc-number">1.15.3.</span> <span class="toc-text">启用&#x2F;禁用 SLD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE-API%E3%80%81GPS-x2F-GNSS-%E8%AE%BE%E5%A4%87"><span class="toc-number">1.16.</span> <span class="toc-text">设备位置 API、GPS&#x2F;GNSS 设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%88%B0%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">1.16.1.</span> <span class="toc-text">连接到设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">1.16.2.</span> <span class="toc-text">获取当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">1.16.3.</span> <span class="toc-text">关闭当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">1.16.4.</span> <span class="toc-text">获取当前设备位置源和属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E4%B8%8A%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.16.5.</span> <span class="toc-text">更新当前设备位置源上的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.16.6.</span> <span class="toc-text">订阅设备位置属性更新事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E6%9B%B4%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.16.7.</span> <span class="toc-text">订阅设备位置源更改事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">1.17.</span> <span class="toc-text">映射设备位置选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-x2F-%E7%A6%81%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">1.17.1.</span> <span class="toc-text">启用&#x2F;禁用地图的当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">1.17.2.</span> <span class="toc-text">获取当前地图设备位置选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E4%B8%8A%E6%98%AF%E5%90%A6%E5%90%AF%E7%94%A8%E4%BA%86%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.17.3.</span> <span class="toc-text">检查地图上是否启用了当前设备位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">1.17.4.</span> <span class="toc-text">设置当前地图设备位置选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-x2F-%E5%B9%B3%E7%A7%BB%E5%9C%B0%E5%9B%BE%E5%88%B0%E6%9C%80%E6%96%B0%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.17.5.</span> <span class="toc-text">缩放&#x2F;平移地图到最新位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%9C%80%E6%96%B0%E4%BD%8D%E7%BD%AE%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">1.17.6.</span> <span class="toc-text">将最新位置添加到图形图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E4%BD%8D%E7%BD%AE%E5%BF%AB%E7%85%A7%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.17.7.</span> <span class="toc-text">订阅位置快照事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E9%81%AE%E7%BD%A9"><span class="toc-number">1.18.</span> <span class="toc-text">特征遮罩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A6%81%E7%B4%A0%E7%9A%84%E9%81%AE%E7%BD%A9%E5%87%A0%E4%BD%95"><span class="toc-number">1.18.1.</span> <span class="toc-text">获取要素的遮罩几何</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A3%8E%E6%A0%BC%E7%AE%A1%E7%90%86"><span class="toc-number">1.19.</span> <span class="toc-text">风格管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8C%89%E5%90%8D%E7%A7%B0%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.1.</span> <span class="toc-text">如何按名称获取项目中的样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E6%96%B0%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.2.</span> <span class="toc-text">如何创建新样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%90%91%E9%A1%B9%E7%9B%AE%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.3.</span> <span class="toc-text">如何向项目添加样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%88%A0%E9%99%A4%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.4.</span> <span class="toc-text">如何从项目中删除样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E9%A1%B9%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.5.</span> <span class="toc-text">如何将样式项添加到样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E6%A0%B7%E5%BC%8F%E4%B8%AD%E5%88%A0%E9%99%A4%E6%A0%B7%E5%BC%8F%E9%A1%B9"><span class="toc-number">1.19.6.</span> <span class="toc-text">如何从样式中删除样式项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%8D%87%E7%BA%A7"><span class="toc-number">1.19.7.</span> <span class="toc-text">如何确定样式是否可以升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E4%B8%BA%E5%8F%AA%E8%AF%BB"><span class="toc-number">1.19.8.</span> <span class="toc-text">如何确定样式是否为只读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E4%B8%BA%E5%BD%93%E5%89%8D%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.9.</span> <span class="toc-text">如何确定样式是否为当前样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%8D%87%E7%BA%A7%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.19.10.</span> <span class="toc-text">如何升级样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.</span> <span class="toc-text">符号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E5%92%8C%E5%A4%A7%E5%B0%8F%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.1.</span> <span class="toc-text">如何构建特定颜色和大小的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%BD%A2%E7%8A%B6%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.2.</span> <span class="toc-text">如何构建特定颜色、大小和形状的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E6%A0%87%E8%AE%B0%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.3.</span> <span class="toc-text">如何根据标记构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E7%A3%81%E7%9B%98%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.4.</span> <span class="toc-text">如何从磁盘上的文件构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E5%86%85%E5%AD%98%E5%9B%BE%E5%BD%A2%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.5.</span> <span class="toc-text">如何从内存图形构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E9%80%A0%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E5%92%8C%E5%A1%AB%E5%85%85%E6%A0%B7%E5%BC%8F%E7%9A%84%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.6.</span> <span class="toc-text">如何构造特定颜色和填充样式的面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A1%AB%E5%85%85%E6%A0%B7%E5%BC%8F%E5%92%8C%E8%BD%AE%E5%BB%93%E7%9A%84%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.7.</span> <span class="toc-text">如何构建特定颜色、填充样式和轮廓的多边形符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%B2%A1%E6%9C%89%E8%BD%AE%E5%BB%93%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E6%9E%84%E5%BB%BA%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.8.</span> <span class="toc-text">如何在没有轮廓的情况下构建面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A4%A7%E5%B0%8F%E5%92%8C%E7%BA%BF%E6%9D%A1%E6%A0%B7%E5%BC%8F%E7%9A%84%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.9.</span> <span class="toc-text">如何构建特定颜色、大小和线条样式的线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E7%AC%94%E5%88%92%E6%9E%84%E9%80%A0%E7%BA%BF%E6%9D%A1%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.10.</span> <span class="toc-text">如何根据笔划构造线条符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%BA%BF%E7%AB%AF%E5%B8%A6%E6%9C%89%E5%9C%86%E5%BD%A2%E6%A0%87%E8%AE%B0%E7%9A%84%E5%A4%9A%E5%9B%BE%E5%B1%82%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.11.</span> <span class="toc-text">如何构建线端带有圆形标记的多图层线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E6%9C%AB%E7%AB%AF%E5%B8%A6%E6%9C%89%E7%AE%AD%E5%A4%B4%E7%9A%84%E5%A4%9A%E5%9B%BE%E5%B1%82%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.12.</span> <span class="toc-text">如何构建末端带有箭头的多图层线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E7%AC%A6%E5%8F%B7%E8%8E%B7%E5%8F%96%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8"><span class="toc-number">1.20.13.</span> <span class="toc-text">如何从符号获取符号引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BB%8E%E5%AD%97%E7%AC%A6%E6%A0%87%E8%AE%B0%E5%88%9B%E5%BB%BA%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.14.</span> <span class="toc-text">修改从字符标记创建的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E5%AD%97%E4%BD%93%E7%9A%84%E5%88%97%E8%A1%A8"><span class="toc-number">1.20.15.</span> <span class="toc-text">获取可用字体的列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-x2F-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%97%E4%BD%93"><span class="toc-number">1.20.16.</span> <span class="toc-text">获取&#x2F;设置默认字体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%80%89%E9%A1%B9%E6%9E%84%E5%BB%BA%E6%96%87%E6%9C%AC%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.17.</span> <span class="toc-text">使用选项构建文本符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E7%BB%99%E5%AE%9A%E7%AC%A6%E5%8F%B7%E5%88%9B%E5%BB%BA%E8%89%B2%E6%9D%BF"><span class="toc-number">1.20.18.</span> <span class="toc-text">为给定符号创建色板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.20.19.</span> <span class="toc-text">查找符号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E6%90%9C%E7%B4%A2"><span class="toc-number">1.21.</span> <span class="toc-text">符号搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%89%B9%E5%AE%9A%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.21.1.</span> <span class="toc-text">如何在样式中搜索特定项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.21.2.</span> <span class="toc-text">如何在样式中搜索点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.21.3.</span> <span class="toc-text">如何在样式中搜索线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.21.4.</span> <span class="toc-text">如何在样式中搜索面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%A2%9C%E8%89%B2"><span class="toc-number">1.21.5.</span> <span class="toc-text">如何在样式中搜索颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%89%B2%E5%B8%A6"><span class="toc-number">1.21.6.</span> <span class="toc-text">如何在样式中搜索色带</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%8C%87%E5%8C%97%E9%92%88"><span class="toc-number">1.21.7.</span> <span class="toc-text">如何在样式中搜索指北针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%AF%94%E4%BE%8B%E5%B0%BA"><span class="toc-number">1.21.8.</span> <span class="toc-text">如何在样式中搜索比例尺</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%A0%87%E7%AD%BE%E5%B1%95%E7%A4%BA%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.21.9.</span> <span class="toc-text">如何在样式中搜索标签展示位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9B%BE%E4%BE%8B"><span class="toc-number">1.21.10.</span> <span class="toc-text">如何在样式中搜索图例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9B%BE%E4%BE%8B%E9%A1%B9"><span class="toc-number">1.21.11.</span> <span class="toc-text">如何在样式中搜索图例项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%BD%91%E6%A0%BC"><span class="toc-number">1.21.12.</span> <span class="toc-text">如何在样式中搜索网格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9C%B0%E5%9B%BE%E6%95%B4%E9%A5%B0"><span class="toc-number">1.21.13.</span> <span class="toc-text">如何在样式中搜索地图整饰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%A1%A8%E6%A0%BC%E6%A1%86"><span class="toc-number">1.21.14.</span> <span class="toc-text">如何在样式中搜索表格框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%A1%A8%E6%A0%BC%E6%A1%86%E5%AD%97%E6%AE%B5"><span class="toc-number">1.21.15.</span> <span class="toc-text">如何在样式中搜索表格框字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.22.</span> <span class="toc-text">要素图层符号系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%B8%BA%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E6%B8%B2%E6%9F%93%E5%99%A8%E7%AC%A6%E5%8F%B7%E5%8C%96%E7%9A%84%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.22.1.</span> <span class="toc-text">如何为使用简单渲染器符号化的要素图层设置符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E4%B8%AD%E7%9A%84%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.22.2.</span> <span class="toc-text">如何将样式中的符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E4%B8%AD%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.22.3.</span> <span class="toc-text">如何将样式中的点符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E7%9A%84%E8%89%B2%E5%B8%A6%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.22.4.</span> <span class="toc-text">如何将样式的色带应用于要素图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C-%E6%B3%A8%E9%87%8A%E7%89%87%E6%AE%B5"><span class="toc-number">1.23.</span> <span class="toc-text">地图创作-注释片段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E6%9E%84%E9%80%A0%E5%B7%A5%E5%85%B7"><span class="toc-number">1.23.1.</span> <span class="toc-text">创建注记构造工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E3%80%82%E8%AD%A6%E5%91%8A%EF%BC%9ATEXTSTRING-Anno-%E5%B1%9E%E6%80%A7%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8"><span class="toc-number">1.23.2.</span> <span class="toc-text">通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%88%96%E7%A7%BB%E5%8A%A8%E6%89%B9%E6%B3%A8"><span class="toc-number">1.23.3.</span> <span class="toc-text">旋转或移动批注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">1.23.4.</span> <span class="toc-text">获取批注文本图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A8%E9%87%8A%E7%9A%84%E8%BD%AE%E5%BB%93%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">1.23.5.</span> <span class="toc-text">获取注释的轮廓几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A8%E9%87%8A%E7%9A%84%E9%81%AE%E7%BD%A9%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">1.23.6.</span> <span class="toc-text">获取注释的遮罩几何图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C%E6%A0%87%E8%AE%B0%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="toc-number">1.24.</span> <span class="toc-text">地图创作标记代码段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E-Maplex-%E6%88%96%E6%A0%87%E5%87%86%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.24.1.</span> <span class="toc-text">获取活动地图的标注引擎 - Maplex 或标准标注引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E%E4%BB%8E%E6%A0%87%E5%87%86%E6%9B%B4%E6%94%B9%E4%B8%BA-Maplex%EF%BC%8C%E5%8F%8D%E4%B9%8B%E4%BA%A6%E7%84%B6"><span class="toc-number">1.24.2.</span> <span class="toc-text">将活动地图的标注引擎从标准更改为 Maplex，反之亦然</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E6%9C%AC%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">1.24.3.</span> <span class="toc-text">将文本符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%9B%BE%E5%B1%82%E6%A0%87%E6%B3%A8"><span class="toc-number">1.24.4.</span> <span class="toc-text">启用图层标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E7%82%B9%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.5.</span> <span class="toc-text">修改标签的位置&#x2F;位置 - 点几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E7%BA%BF%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.6.</span> <span class="toc-text">修改标签的位置&#x2F;位置 - 线几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.7.</span> <span class="toc-text">修改标注的位置&#x2F;位置 - 多边形几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MaplexEngine-%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E6%96%B9%E5%90%91-%E7%82%B9%E5%92%8C%E9%9D%A2%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.8.</span> <span class="toc-text">使用 MaplexEngine 修改标注的方向 - 点和面几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MaplexEngine-%E7%BA%BF%E5%87%A0%E4%BD%95%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E6%96%B9%E5%90%91"><span class="toc-number">1.24.9.</span> <span class="toc-text">使用 MaplexEngine - 线几何修改标注的方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E6%97%8B%E8%BD%AC-%E7%82%B9%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.10.</span> <span class="toc-text">修改标签旋转 - 点几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95%E4%B8%AD%E5%B1%95%E5%BC%80%E6%A0%87%E6%B3%A8"><span class="toc-number">1.24.11.</span> <span class="toc-text">在多边形几何中展开标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E5%BC%95%E5%87%BA%E7%BA%BF%E9%94%9A%E7%82%B9%E5%B1%9E%E6%80%A7-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95"><span class="toc-number">1.24.12.</span> <span class="toc-text">修改标签的引出线锚点属性 - 多边形几何</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_14.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By shaozhy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img class="icp-icon" src="/img/icp.png"><span>冀ICP备2023009991号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'd990e8cbbd1dabc9c98e',
      clientSecret: '59676d5926f4df676ec1ba6b36395bf90a0aeb54',
      repo: 'WineMonk.github.io',
      owner: 'WineMonk',
      admin: ['WineMonk'],
      id: '754126ba428eaa9ed534dbaaa7d5868b',
      updateCountCallback: commentCount
    },{"proxy":"https://vercel.prohibitorum.top/github_access_token"}))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="茶飘香,酒罢去,聚朋友,再回楼" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>