<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ArcGIS Pro SDK 汇总 | WineMonk</title><meta name="keywords" content="CSharp,ArcGIS Pro SDK"><meta name="author" content="shaozhy,1361151272@qq.com"><meta name="copyright" content="shaozhy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="框架如何在停靠窗格可见或隐藏时订阅和取消订阅事件1234567891011121314151617181920private SubscriptionToken _eventToken &#x3D; null;&#x2F;&#x2F; Called when the visibility of the DockPane changes.protected override void OnShow(bool isVisible)">
<meta property="og:type" content="article">
<meta property="og:title" content="ArcGIS Pro SDK 汇总">
<meta property="og:url" content="https://shaoshao.net.cn/2022/12/31/20221231171113000/index.html">
<meta property="og:site_name" content="WineMonk">
<meta property="og:description" content="框架如何在停靠窗格可见或隐藏时订阅和取消订阅事件1234567891011121314151617181920private SubscriptionToken _eventToken &#x3D; null;&#x2F;&#x2F; Called when the visibility of the DockPane changes.protected override void OnShow(bool isVisible)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg">
<meta property="article:published_time" content="2022-12-31T09:11:13.000Z">
<meta property="article:modified_time" content="2023-11-11T08:11:22.323Z">
<meta property="article:author" content="shaozhy">
<meta property="article:tag" content="CSharp">
<meta property="article:tag" content="ArcGIS Pro SDK">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg"><link rel="shortcut icon" href="/cover/head_portrait.jpg"><link rel="canonical" href="https://shaoshao.net.cn/2022/12/31/20221231171113000/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ArcGIS Pro SDK 汇总',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-11 16:11:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://shaoshao.net.cn/images/blog/cover/headportrait/shsh_cn.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/discover/archives/"><div class="headline">文章</div><div class="length-num">171</div></a></div><div class="data-item"><a href="/discover/tags/"><div class="headline">标签</div><div class="length-num">108</div></a></div><div class="data-item"><a href="/discover/categories/"><div class="headline">分类</div><div class="length-num">80</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">WineMonk</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/discover/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/discover/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/discover/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/discover/codingStandards/"><i class="fa-fw fas fa-code"></i><span> 军规</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-commenting"></i><span> 留言</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ArcGIS Pro SDK 汇总</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-31T09:11:13.000Z" title="发表于 2022-12-31 17:11:13">2022-12-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-11T08:11:22.323Z" title="更新于 2023-11-11 16:11:22">2023-11-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/">GIS相关</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/discover/categories/GIS%E7%9B%B8%E5%85%B3/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">120.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>706分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ArcGIS Pro SDK 汇总"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h1><h3 id="如何在停靠窗格可见或隐藏时订阅和取消订阅事件"><a href="#如何在停靠窗格可见或隐藏时订阅和取消订阅事件" class="headerlink" title="如何在停靠窗格可见或隐藏时订阅和取消订阅事件"></a>如何在停靠窗格可见或隐藏时订阅和取消订阅事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SubscriptionToken _eventToken = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// Called when the visibility of the DockPane changes.</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params"><span class="built_in">bool</span> isVisible</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (isVisible &amp;&amp; _eventToken == <span class="literal">null</span>) <span class="comment">//Subscribe to event when dockpane is visible</span></span><br><span class="line">  &#123;</span><br><span class="line">    _eventToken = MapSelectionChangedEvent.Subscribe(OnMapSelectionChangedEvent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!isVisible &amp;&amp; _eventToken != <span class="literal">null</span>) <span class="comment">//Unsubscribe as the dockpane closes.</span></span><br><span class="line">  &#123;</span><br><span class="line">    MapSelectionChangedEvent.Unsubscribe(_eventToken);</span><br><span class="line">    _eventToken = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Event handler when the MapSelection event is triggered.</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnMapSelectionChangedEvent</span>(<span class="params">MapSelectionChangedEventArgs obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  MessageBox.Show(<span class="string">&quot;Selection has changed&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IPlugInWrapper wrapper = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;esri_editing_ShowAttributes&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> command = wrapper <span class="keyword">as</span> ICommand; <span class="comment">// tool and command(Button) supports this</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((command != <span class="literal">null</span>) &amp;&amp; command.CanExecute(<span class="literal">null</span>))</span><br><span class="line">  command.Execute(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置当前工具"><a href="#设置当前工具" class="headerlink" title="设置当前工具"></a>设置当前工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use SetCurrentToolAsync</span></span><br><span class="line">FrameworkApplication.SetCurrentToolAsync(<span class="string">&quot;esri_mapping_selectByRectangleTool&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use ICommand.Execute</span></span><br><span class="line">ICommand cmd = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;esri_mapping_selectByRectangleTool&quot;</span>) <span class="keyword">as</span> ICommand;</span><br><span class="line"><span class="keyword">if</span> ((cmd != <span class="literal">null</span>) &amp;&amp; cmd.CanExecute(<span class="literal">null</span>))</span><br><span class="line">  cmd.Execute(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="激活选项卡"><a href="#激活选项卡" class="headerlink" title="激活选项卡"></a>激活选项卡</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FrameworkApplication.ActivateTab(<span class="string">&quot;esri_mapping_insertTab&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="激活-x2F-停用状态-修改条件"><a href="#激活-x2F-停用状态-修改条件" class="headerlink" title="激活&#x2F;停用状态 - 修改条件"></a>激活&#x2F;停用状态 - 修改条件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define the condition in the DAML file based on the state </span></span><br><span class="line"><span class="keyword">if</span> (activate)</span><br><span class="line">  FrameworkApplication.State.Activate(<span class="string">&quot;someState&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  FrameworkApplication.State.Deactivate(<span class="string">&quot;someState&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="确定应用程序是否繁忙"><a href="#确定应用程序是否繁忙" class="headerlink" title="确定应用程序是否繁忙"></a>确定应用程序是否繁忙</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The application is considered busy if a task is currently running on the main worker thread or any </span></span><br><span class="line"><span class="comment">// pane or dock pane reports that it is busy or intiializing.   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Many Pro styles (such as Esri_SimpleButton) ensure that a button is disabled when FrameworkApplication.IsBusy is true</span></span><br><span class="line"><span class="comment">// You would use this property to bind to the IsEnabled property of a control (such as a listbox) on a dockpane or pane in order</span></span><br><span class="line"><span class="comment">// to disable it from user interaction while the application is busy. </span></span><br><span class="line"><span class="built_in">bool</span> isbusy = FrameworkApplication.IsBusy;</span><br></pre></td></tr></table></figure>

<h3 id="获取应用程序主窗口"><a href="#获取应用程序主窗口" class="headerlink" title="获取应用程序主窗口"></a>获取应用程序主窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">System.Windows.Window window = FrameworkApplication.Current.MainWindow;</span><br><span class="line"></span><br><span class="line"><span class="comment">// center it</span></span><br><span class="line">Rect rect = System.Windows.SystemParameters.WorkArea;</span><br><span class="line">FrameworkApplication.Current.MainWindow.Left = rect.Left + (rect.Width - FrameworkApplication.Current.MainWindow.ActualWidth) / <span class="number">2</span>;</span><br><span class="line">FrameworkApplication.Current.MainWindow.Top = rect.Top + (rect.Height - FrameworkApplication.Current.MainWindow.ActualHeight) / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="关闭-ArcGIS-Pro"><a href="#关闭-ArcGIS-Pro" class="headerlink" title="关闭 ArcGIS Pro"></a>关闭 ArcGIS Pro</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FrameworkApplication.Close();</span><br></pre></td></tr></table></figure>

<h3 id="获取-ArcGIS-专业版"><a href="#获取-ArcGIS-专业版" class="headerlink" title="获取 ArcGIS 专业版"></a>获取 ArcGIS 专业版</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&quot;GetEntryAssembly&quot; should be ArcGISPro.exe </span></span><br><span class="line"><span class="built_in">string</span> version = System.Reflection.Assembly.GetEntryAssembly()</span><br><span class="line">                                       .GetName().Version.ToString();</span><br></pre></td></tr></table></figure>

<h3 id="关闭特定窗格"><a href="#关闭特定窗格" class="headerlink" title="关闭特定窗格"></a>关闭特定窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> _viewPaneID = <span class="string">&quot;my pane&quot;</span>; <span class="comment">//DAML ID of your pane</span></span><br><span class="line">                                <span class="comment">//You could have multiple instances (InstanceIDs) of your pane. </span></span><br><span class="line">                                <span class="comment">//So you can iterate through the Panes to get &quot;your&quot; panes only</span></span><br><span class="line">IList&lt;<span class="built_in">uint</span>&gt; myPaneInstanceIDs = <span class="keyword">new</span> List&lt;<span class="built_in">uint</span>&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (Pane pane <span class="keyword">in</span> FrameworkApplication.Panes)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (pane.ContentID == _viewPaneID)</span><br><span class="line">  &#123;</span><br><span class="line">    myPaneInstanceIDs.Add(pane.InstanceID); <span class="comment">//InstanceID of your pane, could be multiple, so build the collection                    </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> instanceID <span class="keyword">in</span> myPaneInstanceIDs) <span class="comment">//close each of &quot;your&quot; panes.</span></span><br><span class="line">&#123;</span><br><span class="line">  FrameworkApplication.Panes.ClosePane(instanceID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="激活窗格"><a href="#激活窗格" class="headerlink" title="激活窗格"></a>激活窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapPanes = ProApp.Panes.OfType&lt;IMapPane&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (Pane pane <span class="keyword">in</span> mapPanes)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (pane.Caption == <span class="string">&quot;MyMap&quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    pane.Activate();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取有关当前安装的加载项的信息"><a href="#获取有关当前安装的加载项的信息" class="headerlink" title="获取有关当前安装的加载项的信息"></a>获取有关当前安装的加载项的信息</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addin_infos = FrameworkApplication.GetAddInInfos();</span><br><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> info <span class="keyword">in</span> addin_infos)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (info == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">break</span>;<span class="comment">//no addins probed</span></span><br><span class="line"></span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Addin: <span class="subst">&#123;info.Name&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Description <span class="subst">&#123;info.Description&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;ImagePath <span class="subst">&#123;info.ImagePath&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Author <span class="subst">&#123;info.Author&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Company <span class="subst">&#123;info.Company&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Date <span class="subst">&#123;info.Date&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;Version <span class="subst">&#123;info.Version&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;FullPath <span class="subst">&#123;info.FullPath&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;DigitalSignature <span class="subst">&#123;info.DigitalSignature&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;IsCompatible <span class="subst">&#123;info.IsCompatible&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;IsDeleted <span class="subst">&#123;info.IsDeleted&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;TargetVersion <span class="subst">&#123;info.TargetVersion&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;ErrorMsg <span class="subst">&#123;info.ErrorMsg&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">$&quot;ID <span class="subst">&#123;info.ID&#125;</span>&quot;</span>);</span><br><span class="line">  sb.AppendLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(sb.ToString());</span><br><span class="line">MessageBox.Show(sb.ToString(), <span class="string">&quot;Addin Infos&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查找码头窗格"><a href="#查找码头窗格" class="headerlink" title="查找码头窗格"></a>查找码头窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in order to find a dockpane you need to know it&#x27;s DAML id</span></span><br><span class="line"><span class="keyword">var</span> pane = FrameworkApplication.DockPaneManager.Find(<span class="string">&quot;esri_core_ProjectDockPane&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="码头窗格属性和方法"><a href="#码头窗格属性和方法" class="headerlink" title="码头窗格属性和方法"></a>码头窗格属性和方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in order to find a dockpane you need to know it&#x27;s DAML id</span></span><br><span class="line"><span class="keyword">var</span> pane = FrameworkApplication.DockPaneManager.Find(<span class="string">&quot;esri_core_ProjectDockPane&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// determine visibility</span></span><br><span class="line"><span class="built_in">bool</span> visible = pane.IsVisible;</span><br><span class="line"></span><br><span class="line"><span class="comment">// activate it</span></span><br><span class="line">pane.Activate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// determine dockpane state</span></span><br><span class="line">DockPaneState state = pane.DockState;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pin it</span></span><br><span class="line">pane.Pin();</span><br><span class="line"></span><br><span class="line"><span class="comment">// hide it</span></span><br><span class="line">pane.Hide();</span><br></pre></td></tr></table></figure>

<h3 id="码头窗格撤消-x2F-重做"><a href="#码头窗格撤消-x2F-重做" class="headerlink" title="码头窗格撤消&#x2F;重做"></a>码头窗格撤消&#x2F;重做</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in order to find a dockpane you need to know it&#x27;s DAML id</span></span><br><span class="line"><span class="keyword">var</span> pane = FrameworkApplication.DockPaneManager.Find(<span class="string">&quot;esri_core_contentsDockPane&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the undo stack</span></span><br><span class="line">OperationManager manager = pane.OperationManager;</span><br><span class="line"><span class="keyword">if</span> (manager != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// undo an operation</span></span><br><span class="line">  <span class="keyword">if</span> (manager.CanUndo)</span><br><span class="line">    <span class="keyword">await</span> manager.UndoAsync();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// redo an operation</span></span><br><span class="line">  <span class="keyword">if</span> (manager.CanRedo)</span><br><span class="line">    <span class="keyword">await</span> manager.RedoAsync();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clear the undo and redo stack of operations of a particular category</span></span><br><span class="line">  manager.ClearUndoCategory(<span class="string">&quot;Some category&quot;</span>);</span><br><span class="line">  manager.ClearRedoCategory(<span class="string">&quot;Some category&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找停靠窗格并获取其视图模型"><a href="#查找停靠窗格并获取其视图模型" class="headerlink" title="查找停靠窗格并获取其视图模型"></a>查找停靠窗格并获取其视图模型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in order to find a dockpane you need to know it&#x27;s DAML id.  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Here is a DAML example with a dockpane defined. Once you have found the dockpane you can cast it</span></span><br><span class="line"><span class="comment">// to the dockpane viewModel which is defined by the className attribute. </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//&lt;dockPanes&gt;</span></span><br><span class="line"><span class="comment">//  &lt;dockPane id=&quot;MySample_Dockpane&quot; caption=&quot;Dockpane 1&quot; className=&quot;Dockpane1ViewModel&quot; dock=&quot;bottom&quot; height=&quot;5&quot;&gt;</span></span><br><span class="line"><span class="comment">//    &lt;content className=&quot;Dockpane1View&quot; /&gt;</span></span><br><span class="line"><span class="comment">//  &lt;/dockPane&gt;</span></span><br><span class="line"><span class="comment">//&lt;/dockPanes&gt;</span></span><br><span class="line"></span><br><span class="line">Dockpane1ViewModel vm = FrameworkApplication.DockPaneManager.Find(<span class="string">&quot;MySample_Dockpane&quot;</span>) <span class="keyword">as</span> Dockpane1ViewModel;</span><br></pre></td></tr></table></figure>

<h3 id="打开“后台”选项卡"><a href="#打开“后台”选项卡" class="headerlink" title="打开“后台”选项卡"></a>打开“后台”选项卡</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Opens the Backstage to the &quot;About ArcGIS Pro&quot; tab.</span></span><br><span class="line">FrameworkApplication.OpenBackstage(<span class="string">&quot;esri_core_aboutTab&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="访问当前主题"><a href="#访问当前主题" class="headerlink" title="访问当前主题"></a>访问当前主题</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets the application&#x27;s theme</span></span><br><span class="line"><span class="keyword">var</span> theme = FrameworkApplication.ApplicationTheme;</span><br><span class="line"><span class="comment">//ApplicationTheme enumeration</span></span><br><span class="line"><span class="keyword">if</span> (FrameworkApplication.ApplicationTheme == ApplicationTheme.Dark)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Dark theme</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (FrameworkApplication.ApplicationTheme == ApplicationTheme.HighContrast)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//High Contrast</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (FrameworkApplication.ApplicationTheme == ApplicationTheme.Default)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Light/Default theme</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="显示专业消息框"><a href="#显示专业消息框" class="headerlink" title="显示专业消息框"></a>显示专业消息框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="string">&quot;Some Message&quot;</span>, <span class="string">&quot;Some title&quot;</span>, MessageBoxButton.YesNo, MessageBoxImage.Information, MessageBoxResult.Yes);</span><br></pre></td></tr></table></figure>

<h3 id="添加吐司通知"><a href="#添加吐司通知" class="headerlink" title="添加吐司通知"></a>添加吐司通知</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Notification notification = <span class="keyword">new</span> Notification();</span><br><span class="line">notification.Title = FrameworkApplication.Title;</span><br><span class="line">notification.Message = <span class="string">&quot;Notification 1&quot;</span>;</span><br><span class="line">notification.ImageUrl = <span class="string">@&quot;pack://application:,,,/ArcGIS.Desktop.Resources;component/Images/ToastLicensing32.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Framework.FrameworkApplication.AddNotification(notification);</span><br></pre></td></tr></table></figure>

<h3 id="更改按钮标题或图像"><a href="#更改按钮标题或图像" class="headerlink" title="更改按钮标题或图像"></a>更改按钮标题或图像</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ChangeCaptionImage</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  IPlugInWrapper wrapper = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;MyAddin_MyCustomButton&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (wrapper != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    wrapper.Caption = <span class="string">&quot;new caption&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ensure that T-Rex16 and T-Rex32 are included in your add-in under the images folder and have </span></span><br><span class="line">    <span class="comment">// BuildAction = Resource and Copy to OutputDirectory = Do not copy</span></span><br><span class="line">    wrapper.SmallImage = BuildImage(<span class="string">&quot;T-Rex16.png&quot;</span>);</span><br><span class="line">    wrapper.LargeImage = BuildImage(<span class="string">&quot;T-Rex32.png&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ImageSource <span class="title">BuildImage</span>(<span class="params"><span class="built_in">string</span> imageName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> BitmapImage(PackUriForResource(imageName));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Uri <span class="title">PackUriForResource</span>(<span class="params"><span class="built_in">string</span> resourceName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> asm = System.IO.Path.GetFileNameWithoutExtension(</span><br><span class="line">      System.Reflection.Assembly.GetExecutingAssembly().Location);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Uri(<span class="built_in">string</span>.Format(<span class="string">&quot;pack://application:,,,/&#123;0&#125;;component/Images/&#123;1&#125;&quot;</span>, asm, resourceName), UriKind.Absolute);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取按钮的工具提示标题"><a href="#获取按钮的工具提示标题" class="headerlink" title="获取按钮的工具提示标题"></a>获取按钮的工具提示标题</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the daml id of your button. Or pass in any Pro button ID.</span></span><br><span class="line">IPlugInWrapper wrapper = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;button_id_from daml&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> buttonTooltipHeading = wrapper.TooltipHeading;</span><br></pre></td></tr></table></figure>

<h3 id="订阅活动工具更改事件"><a href="#订阅活动工具更改事件" class="headerlink" title="订阅活动工具更改事件"></a>订阅活动工具更改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Events.ActiveToolChangedEvent.Subscribe(OnActiveToolChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UnSubscribeEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Events.ActiveToolChangedEvent.Unsubscribe(OnActiveToolChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnActiveToolChanged</span>(<span class="params">ArcGIS.Desktop.Framework.Events.ToolEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> prevTool = args.PreviousID;</span><br><span class="line">  <span class="built_in">string</span> newTool = args.CurrentID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="进度器-简单且不可取消"><a href="#进度器-简单且不可取消" class="headerlink" title="进度器 - 简单且不可取消"></a>进度器 - 简单且不可取消</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">Progressor_NonCancelable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Threading.Tasks.ProgressorSource ps = <span class="keyword">new</span> ArcGIS.Desktop.Framework.Threading.Tasks.ProgressorSource(<span class="string">&quot;Doing my thing...&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> numSecondsDelay = <span class="number">5</span>;</span><br><span class="line">  <span class="comment">//If you run this in the DEBUGGER you will NOT see the dialog</span></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt; Task.Delay(numSecondsDelay * <span class="number">1000</span>).Wait(), ps.Progressor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="进度器-可取消"><a href="#进度器-可取消" class="headerlink" title="进度器 - 可取消"></a>进度器 - 可取消</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">Progressor_Cancelable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Threading.Tasks.CancelableProgressorSource cps =</span><br><span class="line">    <span class="keyword">new</span> ArcGIS.Desktop.Framework.Threading.Tasks.CancelableProgressorSource(<span class="string">&quot;Doing my thing - cancelable&quot;</span>, <span class="string">&quot;Canceled&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> numSecondsDelay = <span class="number">5</span>;</span><br><span class="line">  <span class="comment">//If you run this in the DEBUGGER you will NOT see the dialog</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//simulate doing some work which can be canceled</span></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    cps.Progressor.Max = (<span class="built_in">uint</span>)numSecondsDelay;</span><br><span class="line">    <span class="comment">//check every second</span></span><br><span class="line">    <span class="keyword">while</span> (!cps.Progressor.CancellationToken.IsCancellationRequested)</span><br><span class="line">    &#123;</span><br><span class="line">      cps.Progressor.Value += <span class="number">1</span>;</span><br><span class="line">      cps.Progressor.Status = <span class="string">&quot;Status &quot;</span> + cps.Progressor.Value;</span><br><span class="line">      cps.Progressor.Message = <span class="string">&quot;Message &quot;</span> + cps.Progressor.Value;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (System.Diagnostics.Debugger.IsAttached)</span><br><span class="line">      &#123;</span><br><span class="line">        System.Diagnostics.Debug.WriteLine(<span class="built_in">string</span>.Format(<span class="string">&quot;RunCancelableProgress Loop&#123;0&#125;&quot;</span>, cps.Progressor.Value));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//are we done?</span></span><br><span class="line">      <span class="keyword">if</span> (cps.Progressor.Value == cps.Progressor.Max) <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">//block the CIM for a second</span></span><br><span class="line">      Task.Delay(<span class="number">1000</span>).Wait();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(<span class="built_in">string</span>.Format(<span class="string">&quot;RunCancelableProgress: Canceled &#123;0&#125;&quot;</span>,</span><br><span class="line">                                        cps.Progressor.CancellationToken.IsCancellationRequested));</span><br><span class="line"></span><br><span class="line">  &#125;, cps.Progressor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义按钮或工具的-disabedText-属性"><a href="#自定义按钮或工具的-disabedText-属性" class="headerlink" title="自定义按钮或工具的 disabedText 属性"></a>自定义按钮或工具的 disabedText 属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Set the tool&#x27;s loadOnClick attribute to &quot;false&quot; in the config.daml. </span></span><br><span class="line"><span class="comment">//This will allow the tool to be created when Pro launches, so that the disabledText property can display customized text at startup.</span></span><br><span class="line"><span class="comment">//Remove the &quot;condition&quot; attribute from the tool. Use the OnUpdate method(below) to set the enable\disable state of the tool.</span></span><br><span class="line"><span class="comment">//Add the OnUpdate method to the tool.</span></span><br><span class="line"><span class="comment">//Note: since OnUpdate is called very frequently, you should avoid lengthy operations in this method </span></span><br><span class="line"><span class="comment">//as this would reduce the responsiveness of the application user interface.</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">SnippetButton</span> : <span class="title">ArcGIS.Desktop.Framework.Contracts.Button</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bool</span> enableSate = <span class="literal">true</span>; <span class="comment">//<span class="doctag">TODO:</span> Code your enabled state  </span></span><br><span class="line">    <span class="built_in">bool</span> criteria = <span class="literal">true</span>;  <span class="comment">//<span class="doctag">TODO:</span> Evaluate criteria for disabledText  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enableSate)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">this</span>.Enabled = <span class="literal">true</span>;  <span class="comment">//tool is enabled  </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">this</span>.Enabled = <span class="literal">false</span>;  <span class="comment">//tool is disabled  </span></span><br><span class="line">                             <span class="comment">//customize your disabledText here  </span></span><br><span class="line">      <span class="keyword">if</span> (criteria)</span><br><span class="line">        <span class="keyword">this</span>.DisabledTooltip = <span class="string">&quot;Missing criteria 1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从当前程序集获取图像资源"><a href="#从当前程序集获取图像资源" class="headerlink" title="从当前程序集获取图像资源"></a>从当前程序集获取图像资源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ExampleUsage</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Image &#x27;Dino32.png&#x27; is added as Build Action: Resource, &#x27;Do not copy&#x27;</span></span><br><span class="line">  <span class="keyword">var</span> img = ForImage(<span class="string">&quot;Dino32.png&quot;</span>);</span><br><span class="line">  <span class="comment">//Use the image...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BitmapImage <span class="title">ForImage</span>(<span class="params"><span class="built_in">string</span> imageName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> BitmapImage(PackUriForResource(imageName));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Uri <span class="title">PackUriForResource</span>(<span class="params"><span class="built_in">string</span> resourceName, <span class="built_in">string</span> folderName = <span class="string">&quot;Images&quot;</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> asm = System.IO.Path.GetFileNameWithoutExtension(</span><br><span class="line">      System.Reflection.Assembly.GetExecutingAssembly().Location);</span><br><span class="line">  <span class="built_in">string</span> uriString = folderName.Length &gt; <span class="number">0</span></span><br><span class="line">      ? <span class="built_in">string</span>.Format(<span class="string">&quot;pack://application:,,,/&#123;0&#125;;component/&#123;1&#125;/&#123;2&#125;&quot;</span>, asm, folderName, resourceName)</span><br><span class="line">      : <span class="built_in">string</span>.Format(<span class="string">&quot;pack://application:,,,/&#123;0&#125;;component/&#123;1&#125;&quot;</span>, asm, resourceName);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Uri(uriString, UriKind.Absolute);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="阻止-ArcGIS-Pro-关闭"><a href="#阻止-ArcGIS-Pro-关闭" class="headerlink" title="阻止 ArcGIS Pro 关闭"></a>阻止 ArcGIS Pro 关闭</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// There are two ways to prevent ArcGIS Pro from closing</span></span><br><span class="line"><span class="comment">// 1. Override the CanUnload method on your add-in&#x27;s module and return false.</span></span><br><span class="line"><span class="comment">// 2. Subscribe to the ApplicationClosing event and cancel the event when you receive it</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Module1</span> : <span class="title">Module</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Called by Framework when ArcGIS Pro is closing</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">CanUnload</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//return false to ~cancel~ Application close</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Module2</span> : <span class="title">Module</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Module2</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">      ArcGIS.Desktop.Framework.Events.ApplicationClosingEvent.Subscribe(OnApplicationClosing);</span><br><span class="line">    &#125;</span><br><span class="line">    ~Module2()</span><br><span class="line">    &#123;</span><br><span class="line">      ArcGIS.Desktop.Framework.Events.ApplicationClosingEvent.Unsubscribe(OnApplicationClosing);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Task <span class="title">OnApplicationClosing</span>(<span class="params">System.ComponentModel.CancelEventArgs args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">      args.Cancel = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> Task.FromResult(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cref: ARCGIS.DESKTOP.CORE.EVENTS.PROJECTOPENEDEVENT</span></span><br><span class="line">    <span class="comment">// cref: ARCGIS.DESKTOP.CORE.EVENTS.PROJECTOPENEDEVENT.SUBSCRIBE</span></span><br><span class="line">    <span class="comment">// cref: ARCGIS.DESKTOP.CORE.EVENTS.PROJECTOPENEDEVENT.UNSUBSCRIBE</span></span><br><span class="line">    <span class="comment">// cref: ARCGIS.DESKTOP.FRAMEWORK.CONTRACTS.MODULE.INITIALIZE</span></span><br><span class="line">    <span class="comment">// cref: ARCGIS.DESKTOP.FRAMEWORK.CONTRACTS.MODULE.UNINITIALIZE</span></span><br><span class="line">    <span class="meta">#<span class="keyword">region</span> How to determine when a project is opened</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Initialize</span>() <span class="comment">//Called when the Module is initialized.</span></span></span><br><span class="line">    &#123;</span><br><span class="line">      ProjectOpenedEvent.Subscribe(OnProjectOpened); <span class="comment">//subscribe to Project opened event</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">base</span>.Initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnProjectOpened</span>(<span class="params">ProjectEventArgs obj</span>) <span class="comment">//Project Opened event handler</span></span></span><br><span class="line">    &#123;</span><br><span class="line">      MessageBox.Show(<span class="string">$&quot;<span class="subst">&#123;Project.Current&#125;</span> has opened&quot;</span>); <span class="comment">//show your message box</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Uninitialize</span>() <span class="comment">//unsubscribe to the project opened event</span></span></span><br><span class="line">    &#123;</span><br><span class="line">      ProjectOpenedEvent.Unsubscribe(OnProjectOpened); <span class="comment">//unsubscribe</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在-MapView-中定位可嵌入控件"><a href="#如何在-MapView-中定位可嵌入控件" class="headerlink" title="如何在 MapView 中定位可嵌入控件"></a>如何在 MapView 中定位可嵌入控件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProSnippetMapTool</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set the MapTool base class&#x27; OverlayControlID to the DAML id of your embeddable control in the constructor</span></span><br><span class="line">  <span class="keyword">this</span>.OverlayControlID = <span class="string">&quot;ProAppModule1_EmbeddableControl1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolMouseDown</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.ChangedButton == System.Windows.Input.MouseButton.Left)</span><br><span class="line">    e.Handled = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleMouseDownAsync</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//assign the screen coordinate clicked point to the MapTool base class&#x27; OverlayControlLocation property.</span></span><br><span class="line">    <span class="keyword">this</span>.OverlayControlPositionRatio = e.ClientPoint;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="激活选项卡时命令搜索中建议的命令选项。"><a href="#激活选项卡时命令搜索中建议的命令选项。" class="headerlink" title="激活选项卡时命令搜索中建议的命令选项。"></a>激活选项卡时命令搜索中建议的命令选项。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//In the module class..</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span>[] <span class="title">GetSuggestedCMDIDs</span>(<span class="params"><span class="built_in">string</span> activeTabID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Return the static list of daml ids you want to be the (suggested) </span></span><br><span class="line">  <span class="comment">//defaults relevant to the given tab. It can be none, some, or all of the</span></span><br><span class="line">  <span class="comment">//commands associated with the activeTabID.</span></span><br><span class="line">  <span class="comment">//In this example, there are two tabs. This example arbitrarily</span></span><br><span class="line">  <span class="comment">//identifies just one command on each tab to be a default to show in the</span></span><br><span class="line">  <span class="comment">//command search list (when _that_ particular tab is active)</span></span><br><span class="line">  <span class="keyword">switch</span> (activeTabID)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;CommandSearch_Example_Tab1&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;CommandSearch_Example_Button2&quot;</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;CommandSearch_Example_Tab2&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;CommandSearch_Example_Button4&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;&quot;</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从命令行启动-ArcGIS-Pro"><a href="#从命令行启动-ArcGIS-Pro" class="headerlink" title="从命令行启动 ArcGIS Pro"></a>从命令行启动 ArcGIS Pro</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;<span class="string">&quot;C:\Program Files\ArcGIS Pro\bin\ArcGISPro.exe&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取命令行参数"><a href="#获取命令行参数" class="headerlink" title="获取命令行参数"></a>获取命令行参数</h3><p>如果您的外接程序需要使用自定义命令行参数，则参数的格式必须为“&#x2F;argument” - 请注意正斜杠“&#x2F;”。不能有空格。如果命令行包含要打开的项目（请参阅从命令行打开项目），则必须将自定义参数或开关放在项目文件名参数之前。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span>[] args = System.Environment.GetCommandLineArgs();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> arg <span class="keyword">in</span> args)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// look for your command line switches</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用程序加速器（快捷键）"><a href="#应用程序加速器（快捷键）" class="headerlink" title="应用程序加速器（快捷键）"></a>应用程序加速器（快捷键）</h3><p>可以使用加速器&#x2F;插入加速器 DAML 元素将应用程序加速器添加到外接程序 config.daml 中，该元素具有要与加速器关联的元素的 refID（即快捷方式）。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;accelerators&gt;</span><br><span class="line">    &lt;insertAccelerator refID=<span class="string">&quot;esri_core_openProjectButton&quot;</span> flags=<span class="string">&quot;Ctrl&quot;</span> key=<span class="string">&quot;O&quot;</span> /&gt;</span><br><span class="line">    &lt;insertAccelerator refID=<span class="string">&quot;esri_core_redoButton&quot;</span> flags=<span class="string">&quot;Ctrl&quot;</span> key=<span class="string">&quot;Y&quot;</span> /&gt;</span><br><span class="line">    &lt;insertAccelerator refID=<span class="string">&quot;esri_core_undoButton&quot;</span> flags=<span class="string">&quot;Ctrl&quot;</span> key=<span class="string">&quot;Z&quot;</span> /&gt;</span><br><span class="line">&lt;/accelerators&gt;</span><br></pre></td></tr></table></figure>

<p>注意：使用 updateModule 元素中的 deleteAccelerator 和 updateAccelerator DAML 元素分别删除或更改应用程序加速器。 标志可以是以下之一：Shift、Ctrl、Alt、Ctrl+Shift、Alt+Shift、Ctrl+Alt、Ctrl+Alt+Shift</p>
<h3 id="使用专业样式在-DAML-中定义控件"><a href="#使用专业样式在-DAML-中定义控件" class="headerlink" title="使用专业样式在 DAML 中定义控件"></a>使用专业样式在 DAML 中定义控件</h3><p>定义了许多 ArcGIS Pro 样式，这些样式可应用于窗格和停靠窗格上的按钮、标注和其他控件，以使加载项的外观与 ArcGIS Pro 无缝衔接。下面列出了一些最常见的样式。有关更多样式和颜色，请参阅社区示例存储库中的使用 ArcGIS Pro 设置样式示例。</p>
<p>按钮样式</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Content=<span class="string">&quot;Button&quot;</span> Style=<span class="string">&quot;&#123;StaticResource Esri_SimpleButton&#125;&quot;</span> ToolTip=<span class="string">&quot;Button&quot;</span>&gt;</span><br><span class="line">&lt;Button Content=<span class="string">&quot;Button&quot;</span> Style=<span class="string">&quot;&#123;StaticResource Esri_BackButton&#125;&quot;</span> ToolTip=<span class="string">&quot;Button&quot;</span>&gt;</span><br><span class="line">&lt;Button Content=<span class="string">&quot;Button&quot;</span> Style=<span class="string">&quot;&#123;StaticResource Esri_BackButtonSmall&#125;&quot;</span> ToolTip=<span class="string">&quot;Button&quot;</span>&gt;</span><br><span class="line">&lt;Button Content=<span class="string">&quot;Button&quot;</span> Style=<span class="string">&quot;&#123;StaticResource Esri_CloseButton&#125;&quot;</span> ToolTip=<span class="string">&quot;Button&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>码头窗格标题样式</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextBlock Text=<span class="string">&quot;MyDockPane&quot;</span> Style=<span class="string">&quot;&#123;StaticResource DockPaneHeading&#125;&quot;</span> </span><br><span class="line">                   VerticalAlignment=<span class="string">&quot;Center&quot;</span> HorizontalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><h2 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h2><h3 id="创建一个空项目"><a href="#创建一个空项目" class="headerlink" title="创建一个空项目"></a>创建一个空项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create an empty project. The project will be created in the default folder</span></span><br><span class="line"><span class="comment">//It will be named MyProject1, MyProject2, or similar...</span></span><br><span class="line"><span class="keyword">await</span> Project.CreateAsync();</span><br></pre></td></tr></table></figure>

<h3 id="创建具有指定名称的新项目"><a href="#创建具有指定名称的新项目" class="headerlink" title="创建具有指定名称的新项目"></a>创建具有指定名称的新项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Settings used to create a new project</span></span><br><span class="line">CreateProjectSettings projectSettings = <span class="keyword">new</span> CreateProjectSettings()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sets the name of the project that will be created</span></span><br><span class="line">  Name = <span class="string">@&quot;C:\Data\MyProject1\MyProject1.aprx&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the new project</span></span><br><span class="line"><span class="keyword">await</span> Project.CreateAsync(projectSettings);</span><br></pre></td></tr></table></figure>

<h3 id="使用-Pro-的默认设置创建新项目"><a href="#使用-Pro-的默认设置创建新项目" class="headerlink" title="使用 Pro 的默认设置创建新项目"></a>使用 Pro 的默认设置创建新项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get Pro&#x27;s default project settings.</span></span><br><span class="line"><span class="keyword">var</span> defaultProjectSettings = Project.GetDefaultProjectSettings();</span><br><span class="line"><span class="comment">//Create a new project using the default project settings</span></span><br><span class="line"><span class="keyword">await</span> Project.CreateAsync(defaultProjectSettings);</span><br></pre></td></tr></table></figure>

<h3 id="使用自定义模板文件新建项目"><a href="#使用自定义模板文件新建项目" class="headerlink" title="使用自定义模板文件新建项目"></a>使用自定义模板文件新建项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Settings used to create a new project</span></span><br><span class="line">CreateProjectSettings projectSettings = <span class="keyword">new</span> CreateProjectSettings()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sets the project&#x27;s name</span></span><br><span class="line">  Name = <span class="string">&quot;New Project&quot;</span>,</span><br><span class="line">  <span class="comment">//Path where new project will be stored in</span></span><br><span class="line">  LocationPath = <span class="string">@&quot;C:\Data\NewProject&quot;</span>,</span><br><span class="line">  <span class="comment">//Sets the project template that will be used to create the new project</span></span><br><span class="line">  TemplatePath = <span class="string">@&quot;C:\Data\MyProject1\CustomTemplate.aptx&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the new project</span></span><br><span class="line"><span class="keyword">await</span> Project.CreateAsync(projectSettings);</span><br></pre></td></tr></table></figure>

<h3 id="使用-ArcGIS-Pro-提供的模板创建工程"><a href="#使用-ArcGIS-Pro-提供的模板创建工程" class="headerlink" title="使用 ArcGIS Pro 提供的模板创建工程"></a>使用 ArcGIS Pro 提供的模板创建工程</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Settings used to create a new project</span></span><br><span class="line">CreateProjectSettings proTemplateSettings = <span class="keyword">new</span> CreateProjectSettings()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sets the project&#x27;s name</span></span><br><span class="line">  Name = <span class="string">&quot;New Project&quot;</span>,</span><br><span class="line">  <span class="comment">//Path where new project will be stored in</span></span><br><span class="line">  LocationPath = <span class="string">@&quot;C:\Data\NewProject&quot;</span>,</span><br><span class="line">  <span class="comment">//Select which Pro template you like to use</span></span><br><span class="line">  TemplateType = TemplateType.Catalog</span><br><span class="line">  <span class="comment">//TemplateType = TemplateType.LocalScene</span></span><br><span class="line">  <span class="comment">//TemplateType = TemplateType.GlobalScene</span></span><br><span class="line">  <span class="comment">//TemplateType = TemplateType.Map</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the new project</span></span><br><span class="line"><span class="keyword">await</span> Project.CreateAsync(proTemplateSettings);</span><br></pre></td></tr></table></figure>

<h3 id="打开现有项目"><a href="#打开现有项目" class="headerlink" title="打开现有项目"></a>打开现有项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Opens an existing project or project package</span></span><br><span class="line"><span class="keyword">await</span> Project.OpenAsync(<span class="string">@&quot;C:\Data\MyProject1\MyProject1.aprx&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目"><a href="#获取当前项目" class="headerlink" title="获取当前项目"></a>获取当前项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets the current project</span></span><br><span class="line"><span class="keyword">var</span> project = Project.Current;</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目的位置"><a href="#获取当前项目的位置" class="headerlink" title="获取当前项目的位置"></a>获取当前项目的位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets the location of the current project; that is, the path to the current project file (*.aprx)  </span></span><br><span class="line"><span class="built_in">string</span> projectPath = Project.Current.URI;</span><br></pre></td></tr></table></figure>

<h3 id="获取项目的默认-gdb-路径"><a href="#获取项目的默认-gdb-路径" class="headerlink" title="获取项目的默认 gdb 路径"></a>获取项目的默认 gdb 路径</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> projGDBPath = Project.Current.DefaultGeodatabasePath;</span><br></pre></td></tr></table></figure>

<h3 id="保存项目"><a href="#保存项目" class="headerlink" title="保存项目"></a>保存项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Saves the project</span></span><br><span class="line"><span class="keyword">await</span> Project.Current.SaveAsync();</span><br></pre></td></tr></table></figure>

<h3 id="检查是否需要保存项目"><a href="#检查是否需要保存项目" class="headerlink" title="检查是否需要保存项目"></a>检查是否需要保存项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The project&#x27;s dirty state indicates changes made to the project have not yet been saved. </span></span><br><span class="line"><span class="built_in">bool</span> isProjectDirty = Project.Current.IsDirty;</span><br></pre></td></tr></table></figure>

<h3 id="另存为项目"><a href="#另存为项目" class="headerlink" title="另存为项目"></a>另存为项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Saves a copy of the current project file (*.aprx) to the specified location with the specified file name, </span></span><br><span class="line"><span class="comment">//then opens the new project file</span></span><br><span class="line"><span class="keyword">await</span> Project.Current.SaveAsAsync(<span class="string">@&quot;C:\Data\MyProject1\MyNewProject1.aprx&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="关闭项目"><a href="#关闭项目" class="headerlink" title="关闭项目"></a>关闭项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//A project cannot be closed using the ArcGIS Pro API. </span></span><br><span class="line"><span class="comment">//A project is only closed when another project is opened, a new one is created, or the application is shutdown.</span></span><br></pre></td></tr></table></figure>

<h3 id="如何向工程添加新地图"><a href="#如何向工程添加新地图" class="headerlink" title="如何向工程添加新地图"></a>如何向工程添加新地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Note: see also MapFactory in ArcGIS.Desktop.Mapping</span></span><br><span class="line">  <span class="keyword">var</span> map = MapFactory.Instance.CreateMap(<span class="string">&quot;New Map&quot;</span>, MapType.Map, MapViewingMode.Map, Basemap.Oceans);</span><br><span class="line">  ProApp.Panes.CreateMapPaneAsync(map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="项目项"><a href="#项目项" class="headerlink" title="项目项"></a>项目项</h2><h3 id="将文件夹连接项添加到当前项目"><a href="#将文件夹连接项添加到当前项目" class="headerlink" title="将文件夹连接项添加到当前项目"></a>将文件夹连接项添加到当前项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Adding a folder connection</span></span><br><span class="line"><span class="built_in">string</span> folderPath = <span class="string">&quot;@C:\\myDataFolder&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> folder = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create the folder connection project item</span></span><br><span class="line">  <span class="keyword">var</span> item = ItemFactory.Instance.Create(folderPath) <span class="keyword">as</span> IProjectItem;</span><br><span class="line">  <span class="comment">//If it is succesfully added to the project, return it otherwise null</span></span><br><span class="line">  <span class="keyword">return</span> Project.Current.AddItem(item) ? item <span class="keyword">as</span> FolderConnectionProjectItem : <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Adding a Geodatabase:</span></span><br><span class="line"><span class="built_in">string</span> gdbPath = <span class="string">&quot;@C:\\myDataFolder\\myData.gdb&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> newlyAddedGDB = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create the File GDB project item</span></span><br><span class="line">  <span class="keyword">var</span> item = ItemFactory.Instance.Create(gdbPath) <span class="keyword">as</span> IProjectItem;</span><br><span class="line">  <span class="comment">//If it is succesfully added to the project, return it otherwise null</span></span><br><span class="line">  <span class="keyword">return</span> Project.Current.AddItem(item) ? item <span class="keyword">as</span> GDBProjectItem : <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取所有项目项"><a href="#获取所有项目项" class="headerlink" title="获取所有项目项"></a>获取所有项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;Item&gt; allProjectItems = Project.Current.GetItems&lt;Item&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> pi <span class="keyword">in</span> allProjectItems)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取项目的所有“MapProjectItems”"><a href="#获取项目的所有“MapProjectItems”" class="headerlink" title="获取项目的所有“MapProjectItems”"></a>获取项目的所有“MapProjectItems”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;MapProjectItem&gt; newMapItemsContainer = project.GetItems&lt;MapProjectItem&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> mp <span class="keyword">in</span> newMapItemsContainer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Do Something with the map. For Example:</span></span><br><span class="line">    Map myMap = mp.GetMap();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“MapProjectItem”"><a href="#获取特定的“MapProjectItem”" class="headerlink" title="获取特定的“MapProjectItem”"></a>获取特定的“MapProjectItem”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MapProjectItem mapProjItem = Project.Current.GetItems&lt;MapProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;EuropeMap&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="获取所有“样式项目项”"><a href="#获取所有“样式项目项”" class="headerlink" title="获取所有“样式项目项”"></a>获取所有“样式项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;StyleProjectItem&gt; newStyleItemsContainer = <span class="literal">null</span>;</span><br><span class="line">newStyleItemsContainer = Project.Current.GetItems&lt;StyleProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> styleItem <span class="keyword">in</span> newStyleItemsContainer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the style.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“样式项目项”"><a href="#获取特定的“样式项目项”" class="headerlink" title="获取特定的“样式项目项”"></a>获取特定的“样式项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = Project.Current.GetItems&lt;StyleProjectItem&gt;();</span><br><span class="line">StyleProjectItem testStyle = container.FirstOrDefault(style =&gt; (style.Name == <span class="string">&quot;ArcGIS 3D&quot;</span>));</span><br><span class="line">StyleItem cone = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (testStyle != <span class="literal">null</span>)</span><br><span class="line">  cone = testStyle.LookupItem(StyleItemType.PointSymbol, <span class="string">&quot;Cone_Volume_3&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取“收藏夹”样式项目项"><a href="#获取“收藏夹”样式项目项" class="headerlink" title="获取“收藏夹”样式项目项"></a>获取“收藏夹”样式项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fav_style_item = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> containerStyle = Project.Current.GetProjectItemContainer(<span class="string">&quot;Style&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> containerStyle.GetItems().OfType&lt;StyleProjectItem&gt;().First(item =&gt; item.TypeID == <span class="string">&quot;personal_style&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取所有“GDBProjectItems”"><a href="#获取所有“GDBProjectItems”" class="headerlink" title="获取所有“GDBProjectItems”"></a>获取所有“GDBProjectItems”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;GDBProjectItem&gt; newGDBItemsContainer = <span class="literal">null</span>;</span><br><span class="line">newGDBItemsContainer = Project.Current.GetItems&lt;GDBProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> GDBItem <span class="keyword">in</span> newGDBItemsContainer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the GDB.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“GDBProjectItem”"><a href="#获取特定的“GDBProjectItem”" class="headerlink" title="获取特定的“GDBProjectItem”"></a>获取特定的“GDBProjectItem”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GDBProjectItem GDBProjItem = Project.Current.GetItems&lt;GDBProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;myGDB&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="获取所有“服务器连接项目项”"><a href="#获取所有“服务器连接项目项”" class="headerlink" title="获取所有“服务器连接项目项”"></a>获取所有“服务器连接项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;ServerConnectionProjectItem&gt; newServerConnections = <span class="literal">null</span>;</span><br><span class="line">newServerConnections = project.GetItems&lt;ServerConnectionProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> serverItem <span class="keyword">in</span> newServerConnections)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the server connection.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“服务器连接项目项”"><a href="#获取特定的“服务器连接项目项”" class="headerlink" title="获取特定的“服务器连接项目项”"></a>获取特定的“服务器连接项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerConnectionProjectItem serverProjItem = Project.Current.GetItems&lt;ServerConnectionProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;myServer&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="获取项目中的所有文件夹连接"><a href="#获取项目中的所有文件夹连接" class="headerlink" title="获取项目中的所有文件夹连接"></a>获取项目中的所有文件夹连接</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets all the folder connections in the current project</span></span><br><span class="line"><span class="keyword">var</span> projectFolders = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> FolderItem <span class="keyword">in</span> projectFolders)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the Folder connection.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定文件夹连接"><a href="#获取特定文件夹连接" class="headerlink" title="获取特定文件夹连接"></a>获取特定文件夹连接</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets a specific folder connection in the current project</span></span><br><span class="line">FolderConnectionProjectItem myProjectFolder = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;().FirstOrDefault(folderPI =&gt; folderPI.Name.Equals(<span class="string">&quot;myDataFolder&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="删除特定文件夹连接"><a href="#删除特定文件夹连接" class="headerlink" title="删除特定文件夹连接"></a>删除特定文件夹连接</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Remove a folder connection from a project; the folder stored on the local disk or the network is not deleted</span></span><br><span class="line">FolderConnectionProjectItem folderToRemove = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;().FirstOrDefault(myfolder =&gt; myfolder.Name.Equals(<span class="string">&quot;PlantSpecies&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (folderToRemove != <span class="literal">null</span>)</span><br><span class="line">  Project.Current.RemoveItem(folderToRemove <span class="keyword">as</span> IProjectItem);</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“布局项目项”"><a href="#获取特定的“布局项目项”" class="headerlink" title="获取特定的“布局项目项”"></a>获取特定的“布局项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LayoutProjectItem layoutProjItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;myLayout&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="获取项目中的所有布局"><a href="#获取项目中的所有布局" class="headerlink" title="获取项目中的所有布局"></a>获取项目中的所有布局</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets all the layouts in the current project</span></span><br><span class="line"><span class="keyword">var</span> projectLayouts = Project.Current.GetItems&lt;LayoutProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> layoutItem <span class="keyword">in</span> projectLayouts)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the layout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定的“地理处理项目项”"><a href="#获取特定的“地理处理项目项”" class="headerlink" title="获取特定的“地理处理项目项”"></a>获取特定的“地理处理项目项”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GeoprocessingProjectItem GPProjItem = Project.Current.GetItems&lt;GeoprocessingProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;myToolbox&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="获取工程中的所有地理处理工程项"><a href="#获取工程中的所有地理处理工程项" class="headerlink" title="获取工程中的所有地理处理工程项"></a>获取工程中的所有地理处理工程项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets all the GeoprocessingProjectItem in the current project</span></span><br><span class="line"><span class="keyword">var</span> GPItems = Project.Current.GetItems&lt;GeoprocessingProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> tbx <span class="keyword">in</span> GPItems)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the toolbox</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在项目中搜索特定项目"><a href="#在项目中搜索特定项目" class="headerlink" title="在项目中搜索特定项目"></a>在项目中搜索特定项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Item&gt; _mxd = <span class="keyword">new</span> List&lt;Item&gt;();</span><br><span class="line"><span class="comment">//Gets all the folder connections in the current project</span></span><br><span class="line"><span class="keyword">var</span> allFoldersItem = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;();</span><br><span class="line"><span class="keyword">if</span> (allFoldersItem != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//iterate through all the FolderConnectionProjectItems found</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> folderItem <span class="keyword">in</span> allFoldersItem)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Search for mxd files in that folder connection and add it to the List&lt;T&gt;</span></span><br><span class="line">    <span class="comment">//Note:ArcGIS Pro automatically creates and dynamically updates a searchable index as you build and work with projects. </span></span><br><span class="line">    <span class="comment">//Items are indexed when they are added to a project.</span></span><br><span class="line">    <span class="comment">//The first time a folder or database is indexed, indexing may take a while if it contains a large number of items. </span></span><br><span class="line">    <span class="comment">//While the index is being created, searches will not return any results.</span></span><br><span class="line">    _mxd.AddRange(folderItem.GetItems());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取默认项目文件夹"><a href="#获取默认项目文件夹" class="headerlink" title="获取默认项目文件夹"></a>获取默认项目文件夹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get Pro&#x27;s default project settings.</span></span><br><span class="line"><span class="keyword">var</span> defaultSettings = Project.GetDefaultProjectSettings();</span><br><span class="line"><span class="keyword">var</span> defaultProjectPath = defaultSettings.LocationPath;</span><br><span class="line"><span class="keyword">if</span> (defaultProjectPath == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// If not set, projects are saved in the user&#x27;s My Documents\ArcGIS\Projects folder;</span></span><br><span class="line">  <span class="comment">// this folder is created if it doesn&#x27;t already exist.</span></span><br><span class="line">  defaultProjectPath = System.IO.Path.Combine(</span><br><span class="line">              System.Environment.GetFolderPath(</span><br><span class="line">                   Environment.SpecialFolder.MyDocuments),</span><br><span class="line">              <span class="string">@&quot;ArcGIS\Projects&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="刷新文件夹连接项的子项"><a href="#刷新文件夹连接项的子项" class="headerlink" title="刷新文件夹连接项的子项"></a>刷新文件夹连接项的子项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> contentItem = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;().First();</span><br><span class="line"><span class="comment">//var contentItem = ...</span></span><br><span class="line"><span class="comment">//Check if the MCT is required for Refresh()</span></span><br><span class="line"><span class="keyword">if</span> (contentItem.IsMainThreadRequired)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//QueuedTask.Run must be used if item.IsMainThreadRequired</span></span><br><span class="line">  <span class="comment">//returns true</span></span><br><span class="line">  QueuedTask.Run(() =&gt; contentItem.Refresh());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//if item.IsMainThreadRequired returns false, any</span></span><br><span class="line">  <span class="comment">//thread can be used to invoke Refresh(), though</span></span><br><span class="line">  <span class="comment">//BackgroundTask is preferred.</span></span><br><span class="line">  contentItem.Refresh();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Or, via BackgroundTask</span></span><br><span class="line">  ArcGIS.Core.Threading.Tasks.BackgroundTask.Run(() =&gt;</span><br><span class="line">    contentItem.Refresh(), ArcGIS.Core.Threading.Tasks.BackgroundProgressor.None);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取项目类别"><a href="#获取项目类别" class="headerlink" title="获取项目类别"></a>获取项目类别</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get the ItemCategories with which an item is associated</span></span><br><span class="line">Item gdb = ItemFactory.Instance.Create(<span class="string">@&quot;E:\CurrentProject\RegionalPolling\polldata.gdb&quot;</span>);</span><br><span class="line">List&lt;ItemCategory&gt; gdbItemCategories = gdb.ItemCategories;</span><br></pre></td></tr></table></figure>

<h3 id="使用项目类别"><a href="#使用项目类别" class="headerlink" title="使用项目类别"></a>使用项目类别</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Browse items using an ItemCategory as a filter</span></span><br><span class="line">IEnumerable&lt;Item&gt; gdbContents = gdb.GetItems();</span><br><span class="line">IEnumerable&lt;Item&gt; filteredGDBContents1 = gdbContents.Where(item =&gt; item.ItemCategories.OfType&lt;ItemCategoryDataSet&gt;().Any());</span><br><span class="line">IEnumerable&lt;Item&gt; filteredGDBContents2 = <span class="keyword">new</span> ItemCategoryDataSet().Items(gdbContents);</span><br></pre></td></tr></table></figure>

<h3 id="使用模板创建项目"><a href="#使用模板创建项目" class="headerlink" title="使用模板创建项目"></a>使用模板创建项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> projectFolder = System.IO.Path.Combine(</span><br><span class="line">    System.Environment.GetFolderPath(</span><br><span class="line">        Environment.SpecialFolder.MyDocuments),</span><br><span class="line">    <span class="string">@&quot;ArcGIS\Projects&quot;</span>);</span><br><span class="line"></span><br><span class="line">CreateProjectSettings ps = <span class="keyword">new</span> CreateProjectSettings()</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;MyProject&quot;</span>,</span><br><span class="line">  LocationPath = projectFolder,</span><br><span class="line">  TemplatePath = <span class="string">@&quot;C:\data\my_templates\custom_template.aptx&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> project = <span class="keyword">await</span> Project.CreateAsync(ps);</span><br></pre></td></tr></table></figure>

<h3 id="选择项目容器-用于-SelectItemAsync"><a href="#选择项目容器-用于-SelectItemAsync" class="headerlink" title="选择项目容器 - 用于 SelectItemAsync"></a>选择项目容器 - 用于 SelectItemAsync</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Use Project.Current.ProjectItemContainers</span></span><br><span class="line"><span class="keyword">var</span> folderContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;FolderConnection&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> gdbContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;GDB&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> mapContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;Map&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> layoutContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;Layout&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> toolboxContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;GP&quot;</span>);</span><br><span class="line"><span class="comment">//etc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//or...use Project.Current.GetProjectItemContainer</span></span><br><span class="line"></span><br><span class="line">folderContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;FolderConnection&quot;</span>);</span><br><span class="line">gdbContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;GDB&quot;</span>);</span><br><span class="line">mapContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;Map&quot;</span>);</span><br><span class="line">layoutContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;Layout&quot;</span>);</span><br><span class="line">toolboxContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;GP&quot;</span>);</span><br><span class="line"><span class="comment">//etc.</span></span><br></pre></td></tr></table></figure>

<h3 id="项目项：获取项或查找项"><a href="#项目项：获取项或查找项" class="headerlink" title="项目项：获取项或查找项"></a>项目项：获取项或查找项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GetItems searches project content</span></span><br><span class="line"><span class="keyword">var</span> map = Project.Current.GetItems&lt;MapProjectItem&gt;().FirstOrDefault(m =&gt; m.Name == <span class="string">&quot;Map1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> layout = Project.Current.GetItems&lt;LayoutProjectItem&gt;().FirstOrDefault(m =&gt; m.Name == <span class="string">&quot;Layout1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> folders = Project.Current.GetItems&lt;FolderConnectionProjectItem&gt;();</span><br><span class="line"><span class="keyword">var</span> style = Project.Current.GetItems&lt;StyleProjectItem&gt;().FirstOrDefault(s =&gt; s.Name == <span class="string">&quot;ArcGIS 3D&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Find item uses a catalog path. The path can be to a file or dataset</span></span><br><span class="line"><span class="keyword">var</span> fcPath = <span class="string">@&quot;C:\Pro\CommunitySampleData\Interacting with Maps\Interacting with Maps.gdb\Crimes&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> pdfPath = <span class="string">@&quot;C:\Temp\Layout1.pdf&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> imgPath = <span class="string">@&quot;C:\Temp\AddinDesktop16.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fc = Project.Current.FindItem(fcPath);</span><br><span class="line"><span class="keyword">var</span> pdf = Project.Current.FindItem(pdfPath);</span><br><span class="line"><span class="keyword">var</span> img = Project.Current.FindItem(imgPath);</span><br></pre></td></tr></table></figure>

<h3 id="在目录窗格中选择一个项目"><a href="#在目录窗格中选择一个项目" class="headerlink" title="在目录窗格中选择一个项目"></a>在目录窗格中选择一个项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the catalog pane</span></span><br><span class="line">ArcGIS.Desktop.Core.IProjectWindow projectWindow = Project.GetCatalogPane();</span><br><span class="line"><span class="comment">//or get the active catalog view...</span></span><br><span class="line"><span class="comment">//ArcGIS.Desktop.Core.IProjectWindow projectWindow = Project.GetActiveCatalogWindow();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//eg Find a toolbox in the project</span></span><br><span class="line"><span class="built_in">string</span> gpName = <span class="string">&quot;Interacting with Maps.tbx&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> toolbox = Project.Current.GetItems&lt;GeoprocessingProjectItem&gt;().FirstOrDefault(tbx =&gt; tbx.Name == gpName);</span><br><span class="line"><span class="comment">//Select it under Toolboxes</span></span><br><span class="line">projectWindow.SelectItemAsync(toolbox, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">null</span>);<span class="comment">//null selects it in the first container - optionally await</span></span><br><span class="line">                                                         <span class="comment">//Note: Project.Current.GetProjectItemContainer(&quot;GP&quot;) would get toolbox container...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//assume toolbox is also under Folders container. Select it under Folders instead of Toolboxes</span></span><br><span class="line"><span class="keyword">var</span> foldersContainer = Project.Current.ProjectItemContainers.First(c =&gt; c.Path == <span class="string">&quot;FolderConnection&quot;</span>);</span><br><span class="line"><span class="comment">//We must specify the container because Folders comes second (after Toolboxes)</span></span><br><span class="line">projectWindow.SelectItemAsync(toolbox, <span class="literal">true</span>, <span class="literal">true</span>, foldersContainer);<span class="comment">//optionally await</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Find a map and select it</span></span><br><span class="line"><span class="keyword">var</span> mapItem = Project.Current.GetItems&lt;MapProjectItem&gt;().FirstOrDefault(m =&gt; m.Name == <span class="string">&quot;Map&quot;</span>);</span><br><span class="line"><span class="comment">//Map only occurs under &quot;Maps&quot; so the container need not be specified</span></span><br><span class="line">projectWindow.SelectItemAsync(mapItem, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="地理数据库内容"><a href="#地理数据库内容" class="headerlink" title="地理数据库内容"></a>地理数据库内容</h2><h3 id="浏览对话框中的地理数据库内容"><a href="#浏览对话框中的地理数据库内容" class="headerlink" title="浏览对话框中的地理数据库内容"></a>浏览对话框中的地理数据库内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> openDlg = <span class="keyword">new</span> OpenItemDialog</span><br><span class="line">&#123;</span><br><span class="line">  Title = <span class="string">&quot;Select a Feature Class&quot;</span>,</span><br><span class="line">  InitialLocation = <span class="string">@&quot;C:\Data&quot;</span>,</span><br><span class="line">  MultiSelect = <span class="literal">false</span>,</span><br><span class="line">  BrowseFilter = BrowseProjectFilter.GetFilter(ArcGIS.Desktop.Catalog.ItemFilters.GeodatabaseItems_All)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//show the browse dialog</span></span><br><span class="line"><span class="built_in">bool</span>? ok = openDlg.ShowDialog();</span><br><span class="line"><span class="keyword">if</span> (!ok.HasValue || openDlg.Items.Count() == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span>;   <span class="comment">//nothing selected</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the item</span></span><br><span class="line">  <span class="keyword">var</span> item = openDlg.Items.First();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// see if the item has a dataset</span></span><br><span class="line">  <span class="keyword">if</span> (ItemFactory.Instance.CanGetDataset(item))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get it</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> ds = ItemFactory.Instance.GetDataset(item))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// access some properties</span></span><br><span class="line">      <span class="keyword">var</span> name = ds.GetName();</span><br><span class="line">      <span class="keyword">var</span> path = ds.GetPath();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// if it&#x27;s a featureclass</span></span><br><span class="line">      <span class="keyword">if</span> (ds <span class="keyword">is</span> ArcGIS.Core.Data.FeatureClass fc)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// create a layer </span></span><br><span class="line">        <span class="keyword">var</span> featureLayerParams = <span class="keyword">new</span> FeatureLayerCreationParams(fc)</span><br><span class="line">        &#123;</span><br><span class="line">          MapMemberIndex = <span class="number">0</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> layer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(featureLayerParams, MapView.Active.Map);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// continue</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="目录中的地理数据库内容"><a href="#目录中的地理数据库内容" class="headerlink" title="目录中的地理数据库内容"></a>目录中的地理数据库内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subscribe to event</span></span><br><span class="line">ProjectWindowSelectedItemsChangedEvent.Subscribe(<span class="keyword">async</span> (ProjectWindowSelectedItemsChangedEventArgs args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args.IProjectWindow.SelectionCount &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the first selected item</span></span><br><span class="line">    <span class="keyword">var</span> selectedItem = args.IProjectWindow.SelectedItems.First();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// datasetType</span></span><br><span class="line">      <span class="keyword">var</span> dataType = ItemFactory.Instance.GetDatasetType(selectedItem);</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// get the dataset Defintion</span></span><br><span class="line">      <span class="keyword">if</span> (ItemFactory.Instance.CanGetDefinition(selectedItem))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> def = ItemFactory.Instance.GetDefinition(selectedItem))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (def <span class="keyword">is</span> ArcGIS.Core.Data.FeatureClassDefinition fcDef)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">var</span> oidField = fcDef.GetObjectIDField();</span><br><span class="line">            <span class="keyword">var</span> shapeField = fcDef.GetShapeField();</span><br><span class="line">            <span class="keyword">var</span> shapeType = fcDef.GetShapeType();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (def <span class="keyword">is</span> ArcGIS.Core.Data.Parcels.ParcelFabricDefinition pfDef)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">string</span> ver = pfDef.GetSchemaVersion();</span><br><span class="line">            <span class="built_in">bool</span> enabled = pfDef.GetTopologyEnabled();</span><br><span class="line">          &#125;</span><br><span class="line">    </span><br><span class="line">          <span class="comment">// etc</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// get the dataset</span></span><br><span class="line">      <span class="keyword">if</span> (ItemFactory.Instance.CanGetDataset(selectedItem))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> ds = ItemFactory.Instance.GetDataset(selectedItem))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (ds <span class="keyword">is</span> ArcGIS.Core.Data.FeatureDataset fds)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// open featureclasses within the feature dataset</span></span><br><span class="line">            <span class="comment">// var fcPoint = fds.OpenDataset&lt;FeatureClass&gt;(&quot;Point&quot;);</span></span><br><span class="line">            <span class="comment">// var fcPolyline = fds.OpenDataset&lt;FeatureClass&gt;(&quot;Polyline&quot;);</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (ds <span class="keyword">is</span> FeatureClass fc)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">var</span> name = fc.GetName() + <span class="string">&quot;_copy&quot;</span>;</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// create</span></span><br><span class="line">            <span class="keyword">var</span> featureLayerParams = <span class="keyword">new</span> FeatureLayerCreationParams(fc)</span><br><span class="line">            &#123;</span><br><span class="line">              Name = name,</span><br><span class="line">              MapMemberIndex = <span class="number">0</span></span><br><span class="line">            &#125;;</span><br><span class="line">            LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(featureLayerParams, MapView.Active.Map);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (ds <span class="keyword">is</span> Table table)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">var</span> name = table.GetName() + <span class="string">&quot;_copy&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> tableParams = <span class="keyword">new</span> StandaloneTableCreationParams(table)</span><br><span class="line">            &#123;</span><br><span class="line">              Name = name</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// create</span></span><br><span class="line">            StandaloneTableFactory.Instance.CreateStandaloneTable(tableParams, MapView.Active.Map);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="收藏-夹"><a href="#收藏-夹" class="headerlink" title="收藏 夹"></a>收藏 夹</h2><h3 id="添加收藏夹-文件夹"><a href="#添加收藏夹-文件夹" class="headerlink" title="添加收藏夹 - 文件夹"></a>添加收藏夹 - 文件夹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> itemFolder = ItemFactory.Instance.Create(<span class="string">@&quot;d:\data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// is the folder item already a favorite?</span></span><br><span class="line"><span class="keyword">var</span> fav = FavoritesManager.Current.GetFavorite(itemFolder);</span><br><span class="line"><span class="keyword">if</span> (fav == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (FavoritesManager.Current.CanAddAsFavorite(itemFolder))</span><br><span class="line">  &#123;</span><br><span class="line">    fav = FavoritesManager.Current.AddFavorite(itemFolder);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入收藏夹-地理数据库路径"><a href="#插入收藏夹-地理数据库路径" class="headerlink" title="插入收藏夹 - 地理数据库路径"></a>插入收藏夹 - 地理数据库路径</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> gdbPath = <span class="string">&quot;@C:\\myDataFolder\\myData.gdb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> itemGDB = ItemFactory.Instance.Create(gdbPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// is the item already a favorite?</span></span><br><span class="line"><span class="keyword">var</span> fav = FavoritesManager.Current.GetFavorite(itemGDB);</span><br><span class="line"><span class="comment">// no; add it with IsAddedToAllNewProjects set to true</span></span><br><span class="line"><span class="keyword">if</span> (fav != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (FavoritesManager.Current.CanAddAsFavorite(itemGDB))</span><br><span class="line">    FavoritesManager.Current.InsertFavorite(itemGDB, <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加收藏夹-设置项目项的样式"><a href="#添加收藏夹-设置项目项的样式" class="headerlink" title="添加收藏夹 - 设置项目项的样式"></a>添加收藏夹 - 设置项目项的样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StyleProjectItem styleItem = Project.Current.GetItems&lt;StyleProjectItem&gt;().</span><br><span class="line">                        FirstOrDefault(style =&gt; (style.Name == <span class="string">&quot;ArcGIS 3D&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (FavoritesManager.Current.CanAddAsFavorite(styleItem))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// add to favorites with IsAddedToAllNewProjects set to false</span></span><br><span class="line">  FavoritesManager.Current.AddFavorite(styleItem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="切换标志是添加到所有新项目为收藏夹"><a href="#切换标志是添加到所有新项目为收藏夹" class="headerlink" title="切换标志是添加到所有新项目为收藏夹"></a>切换标志是添加到所有新项目为收藏夹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> itemFolder = ItemFactory.Instance.Create(<span class="string">@&quot;d:\data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// is the folder item already a favorite?</span></span><br><span class="line"><span class="keyword">var</span> fav = FavoritesManager.Current.GetFavorite(itemFolder);</span><br><span class="line"><span class="keyword">if</span> (fav != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (fav.IsAddedToAllNewProjects)</span><br><span class="line">    FavoritesManager.Current.ClearIsAddedToAllNewProjects(fav.Item);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    FavoritesManager.Current.SetIsAddedToAllNewProjects(fav.Item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取收藏夹集并迭代"><a href="#获取收藏夹集并迭代" class="headerlink" title="获取收藏夹集并迭代"></a>获取收藏夹集并迭代</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> favorites = FavoritesManager.Current.GetFavorites();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> favorite <span class="keyword">in</span> favorites)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> isAddedToAllProjects = favorite.IsAddedToAllNewProjects;</span><br><span class="line">  <span class="comment">// retrieve the underlying item of the favorite</span></span><br><span class="line">  Item item = favorite.Item;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Item properties</span></span><br><span class="line">  <span class="keyword">var</span> itemType = item.TypeID;</span><br><span class="line">  <span class="keyword">var</span> path = item.Path;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if it&#x27;s a folder item</span></span><br><span class="line">  <span class="keyword">if</span> (item <span class="keyword">is</span> FolderConnectionProjectItem)</span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if it&#x27;s a goedatabase item</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (item <span class="keyword">is</span> GDBProjectItem)</span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// else </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除所有收藏夹"><a href="#删除所有收藏夹" class="headerlink" title="删除所有收藏夹"></a>删除所有收藏夹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> favorites = FavoritesManager.Current.GetFavorites();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> favorite <span class="keyword">in</span> favorites)</span><br><span class="line">  FavoritesManager.Current.RemoveFavorite(favorite.Item);</span><br></pre></td></tr></table></figure>

<h3 id="收藏夹更改事件"><a href="#收藏夹更改事件" class="headerlink" title="收藏夹更改事件"></a>收藏夹更改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Core.Events.FavoritesChangedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// favorites have changed</span></span><br><span class="line">  <span class="built_in">int</span> count = FavoritesManager.Current.GetFavorites().Count;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h2><h3 id="项目：获取其-IMetadata-接口"><a href="#项目：获取其-IMetadata-接口" class="headerlink" title="项目：获取其 IMetadata 接口"></a>项目：获取其 IMetadata 接口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Item gdbItem = ItemFactory.Instance.Create(<span class="string">@&quot;C:\projectAlpha\GDBs\regionFive.gdb&quot;</span>);</span><br><span class="line">IMetadata gdbMetadataItem = gdbItem <span class="keyword">as</span> IMetadata;</span><br></pre></td></tr></table></figure>

<h3 id="项目：获取项目的元数据：获取XML"><a href="#项目：获取项目的元数据：获取XML" class="headerlink" title="项目：获取项目的元数据：获取XML"></a>项目：获取项目的元数据：获取XML</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> gdbXMLMetadataXmlAsString = <span class="built_in">string</span>.Empty;</span><br><span class="line">gdbXMLMetadataXmlAsString = <span class="keyword">await</span> QueuedTask.Run(() =&gt; gdbMetadataItem.GetXml());</span><br><span class="line"><span class="comment">//check metadata was returned</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(gdbXMLMetadataXmlAsString))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//use the metadata</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="项目：设置项目的元数据：设置XML项"><a href="#项目：设置项目的元数据：设置XML项" class="headerlink" title="项目：设置项目的元数据：设置XML项"></a>项目：设置项目的元数据：设置XML项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> xml = System.IO.File.ReadAllText(<span class="string">@&quot;E:\Data\Metadata\MetadataForFeatClass.xml&quot;</span>);</span><br><span class="line">  <span class="comment">//Will throw InvalidOperationException if the metadata cannot be changed</span></span><br><span class="line">  <span class="comment">//so check &quot;CanEdit&quot; first</span></span><br><span class="line">  <span class="keyword">if</span> (featureClassMetadataItem.CanEdit())</span><br><span class="line">    featureClassMetadataItem.SetXml(xml);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="项目：检查元数据是否可以编辑：可以编辑"><a href="#项目：检查元数据是否可以编辑：可以编辑" class="headerlink" title="项目：检查元数据是否可以编辑：可以编辑"></a>项目：检查元数据是否可以编辑：可以编辑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> canEdit1;</span><br><span class="line"><span class="comment">//Call CanEdit before calling SetXml</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; canEdit1 = metadataItemToCheck.CanEdit());</span><br></pre></td></tr></table></figure>

<h3 id="项目：使用项目的当前属性更新元数据：同步"><a href="#项目：使用项目的当前属性更新元数据：同步" class="headerlink" title="项目：使用项目的当前属性更新元数据：同步"></a>项目：使用项目的当前属性更新元数据：同步</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> syncedMetadataXml = <span class="built_in">string</span>.Empty;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; syncedMetadataXml = metadataItemToSync.Synchronize());</span><br></pre></td></tr></table></figure>

<h3 id="项目：从源项目的元数据复制元数据：复制元数据从项目"><a href="#项目：从源项目的元数据复制元数据：复制元数据从项目" class="headerlink" title="项目：从源项目的元数据复制元数据：复制元数据从项目"></a>项目：从源项目的元数据复制元数据：复制元数据从项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Item featureClassItem = ItemFactory.Instance.Create(<span class="string">@&quot;C:\projectAlpha\GDBs\regionFive.gdb\SourceFeatureClass&quot;</span>);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemImport.CopyMetadataFromItem(featureClassItem));</span><br></pre></td></tr></table></figure>

<h3 id="项目：从当前项目的元数据中删除某些内容：删除元数据内容"><a href="#项目：从当前项目的元数据中删除某些内容：删除元数据内容" class="headerlink" title="项目：从当前项目的元数据中删除某些内容：删除元数据内容"></a>项目：从当前项目的元数据中删除某些内容：删除元数据内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Item featureClassWithMetadataItem = ItemFactory.Instance.Create(<span class="string">@&quot;C:\projectBeta\GDBs\regionFive.gdb\SourceFeatureClass&quot;</span>);</span><br><span class="line"><span class="comment">//Delete thumbnail content from item&#x27;s metadata</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; featureClassWithMetadataItem.DeleteMetadataContent(MDDeleteContentOption.esriMDDeleteThumbnail));</span><br></pre></td></tr></table></figure>

<h3 id="项目：使用导入的元数据更新元数据-输入路径可以是包含元数据的项目的路径，也可以是-XML-文件的-URI：导入元数据"><a href="#项目：使用导入的元数据更新元数据-输入路径可以是包含元数据的项目的路径，也可以是-XML-文件的-URI：导入元数据" class="headerlink" title="项目：使用导入的元数据更新元数据 - 输入路径可以是包含元数据的项目的路径，也可以是 XML 文件的 URI：导入元数据"></a>项目：使用导入的元数据更新元数据 - 输入路径可以是包含元数据的项目的路径，也可以是 XML 文件的 URI：导入元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the input path can be the path to an item with metadata, or a URI to an XML file</span></span><br><span class="line">IMetadata metadataItemImport1 = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemImport1.ImportMetadata(<span class="string">@&quot;E:\YellowStone.gdb\MyDataset\MyFeatureClass&quot;</span>, MDImportExportOption.esriCurrentMetadataStyle));</span><br></pre></td></tr></table></figure>

<h3 id="项目：使用导入的元数据更新元数据：导入元数据"><a href="#项目：使用导入的元数据更新元数据：导入元数据" class="headerlink" title="项目：使用导入的元数据更新元数据：导入元数据"></a>项目：使用导入的元数据更新元数据：导入元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the input path can be the path to an item with metadata, or a URI to an XML file</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemImport2.ImportMetadata(<span class="string">@&quot;E:\YellowStone.gdb\MyDataset\MyFeatureClass&quot;</span>, MDImportExportOption.esriCustomizedStyleSheet, <span class="string">@&quot;E:\StyleSheets\Import\MyImportStyleSheet.xslt&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="项目：导出当前选定项目的元数据：导出元数据"><a href="#项目：导出当前选定项目的元数据：导出元数据" class="headerlink" title="项目：导出当前选定项目的元数据：导出元数据"></a>项目：导出当前选定项目的元数据：导出元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemExport1.ExportMetadata(<span class="string">@&quot;E:\Temp\OutputXML.xml&quot;</span>, MDImportExportOption.esriCurrentMetadataStyle, MDExportRemovalOption.esriExportExactCopy));</span><br></pre></td></tr></table></figure>

<h3 id="项目：导出当前选定项目的元数据：导出元数据-1"><a href="#项目：导出当前选定项目的元数据：导出元数据-1" class="headerlink" title="项目：导出当前选定项目的元数据：导出元数据"></a>项目：导出当前选定项目的元数据：导出元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemExport2.ExportMetadata(<span class="string">@&quot;E:\Temp\OutputXML.xml&quot;</span>, MDImportExportOption.esriCustomizedStyleSheet, MDExportRemovalOption.esriExportExactCopy, <span class="string">@&quot;E:\StyleSheets\Export\MyExportStyleSheet.xslt&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="项目：将当前项目的元数据另存为-XML：将元数据另存为-XML"><a href="#项目：将当前项目的元数据另存为-XML：将元数据另存为-XML" class="headerlink" title="项目：将当前项目的元数据另存为 XML：将元数据另存为 XML"></a>项目：将当前项目的元数据另存为 XML：将元数据另存为 XML</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemToSaveAsXML.SaveMetadataAsXML(<span class="string">@&quot;E:\Temp\OutputXML.xml&quot;</span>, MDSaveAsXMLOption.esriExactCopy));</span><br></pre></td></tr></table></figure>

<h3 id="项目：将当前项目的元数据另存为-HTML：将元数据另存为HTML"><a href="#项目：将当前项目的元数据另存为-HTML：将元数据另存为HTML" class="headerlink" title="项目：将当前项目的元数据另存为 HTML：将元数据另存为HTML"></a>项目：将当前项目的元数据另存为 HTML：将元数据另存为HTML</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemToSaveAsHTML.SaveMetadataAsHTML(<span class="string">@&quot;E:\Temp\OutputHTML.htm&quot;</span>, MDSaveAsHTMLOption.esriCurrentMetadataStyle));</span><br></pre></td></tr></table></figure>

<h3 id="项目：使用自定义-XSLT-保存当前项目的元数据：保存元数据作为使用自定义-XSLT"><a href="#项目：使用自定义-XSLT-保存当前项目的元数据：保存元数据作为使用自定义-XSLT" class="headerlink" title="项目：使用自定义 XSLT 保存当前项目的元数据：保存元数据作为使用自定义 XSLT"></a>项目：使用自定义 XSLT 保存当前项目的元数据：保存元数据作为使用自定义 XSLT</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; metadataItemToSaveAsUsingCustomXSLT.SaveMetadataAsUsingCustomXSLT(<span class="string">@&quot;E:\Data\Metadata\CustomXSLT.xsl&quot;</span>, <span class="string">@&quot;E:\Temp\OutputXMLCustom.xml&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="项目：升级当前项目的元数据：升级元数据"><a href="#项目：升级当前项目的元数据：升级元数据" class="headerlink" title="项目：升级当前项目的元数据：升级元数据"></a>项目：升级当前项目的元数据：升级元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fgdcItem = ItemFactory.Instance.Create(<span class="string">@&quot;C:\projectAlpha\GDBs\testData.gdb&quot;</span>);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; fgdcItem.UpgradeMetadata(MDUpgradeOption.esriUpgradeFgdcCsdgm));</span><br></pre></td></tr></table></figure>

<h2 id="项目单位"><a href="#项目单位" class="headerlink" title="项目单位"></a>项目单位</h2><h3 id="获取所有可用单位格式的完整列表"><a href="#获取所有可用单位格式的完整列表" class="headerlink" title="获取所有可用单位格式的完整列表"></a>获取所有可用单位格式的完整列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unit_formats = Enum.GetValues(<span class="keyword">typeof</span>(UnitFormatType))</span><br><span class="line">                      .OfType&lt;UnitFormatType&gt;().ToList();</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">&quot;All available units\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> unit_format <span class="keyword">in</span> unit_formats)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> units = DisplayUnitFormats.Instance.GetPredefinedProjectUnitFormats(unit_format);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(unit_format.ToString());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> display_unit_format <span class="keyword">in</span> units)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;display_unit_format.DisplayName&#125;</span>, <span class="subst">&#123;display_unit_format.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(line);</span><br><span class="line">  &#125;</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目的单位格式列表"><a href="#获取当前项目的单位格式列表" class="headerlink" title="获取当前项目的单位格式列表"></a>获取当前项目的单位格式列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unit_formats = Enum.GetValues(<span class="keyword">typeof</span>(UnitFormatType))</span><br><span class="line">                      .OfType&lt;UnitFormatType&gt;().ToList();</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">&quot;Project units\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> unit_format <span class="keyword">in</span> unit_formats)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> units = DisplayUnitFormats.Instance.GetProjectUnitFormats(unit_format);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(unit_format.ToString());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> display_unit_format <span class="keyword">in</span> units)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;display_unit_format.DisplayName&#125;</span>, <span class="subst">&#123;display_unit_format.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(line);</span><br><span class="line">  &#125;</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目的特定单位格式列表"><a href="#获取当前项目的特定单位格式列表" class="headerlink" title="获取当前项目的特定单位格式列表"></a>获取当前项目的特定单位格式列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UnitFormatType.Angular, UnitFormatType.Area, UnitFormatType.Distance, </span></span><br><span class="line"><span class="comment">//UnitFormatType.Direction, UnitFormatType.Location, UnitFormatType.Page</span></span><br><span class="line"><span class="comment">//UnitFormatType.Symbol2D, UnitFormatType.Symbol3D</span></span><br><span class="line"><span class="keyword">var</span> units = DisplayUnitFormats.Instance.GetProjectUnitFormats(UnitFormatType.Distance);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目的默认格式列表"><a href="#获取当前项目的默认格式列表" class="headerlink" title="获取当前项目的默认格式列表"></a>获取当前项目的默认格式列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unit_formats = Enum.GetValues(<span class="keyword">typeof</span>(UnitFormatType))</span><br><span class="line">                      .OfType&lt;UnitFormatType&gt;().ToList();</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">&quot;Default project units\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> unit_format <span class="keyword">in</span> unit_formats)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> default_unit = DisplayUnitFormats.Instance.GetDefaultProjectUnitFormat(unit_format);</span><br><span class="line">  <span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;unit_format.ToString()&#125;</span>: <span class="subst">&#123;default_unit.DisplayName&#125;</span>, <span class="subst">&#123;default_unit.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(line);</span><br><span class="line">&#125;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前项目的特定默认单位格式"><a href="#获取当前项目的特定默认单位格式" class="headerlink" title="获取当前项目的特定默认单位格式"></a>获取当前项目的特定默认单位格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UnitFormatType.Angular, UnitFormatType.Area, UnitFormatType.Distance, </span></span><br><span class="line"><span class="comment">//UnitFormatType.Direction, UnitFormatType.Location, UnitFormatType.Page</span></span><br><span class="line"><span class="comment">//UnitFormatType.Symbol2D, UnitFormatType.Symbol3D</span></span><br><span class="line"><span class="keyword">var</span> default_unit = DisplayUnitFormats.Instance.GetDefaultProjectUnitFormat(</span><br><span class="line">                                                     UnitFormatType.Distance);</span><br></pre></td></tr></table></figure>

<h3 id="为当前项目设置特定的单位格式列表"><a href="#为当前项目设置特定的单位格式列表" class="headerlink" title="为当前项目设置特定的单位格式列表"></a>为当前项目设置特定的单位格式列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UnitFormatType.Angular, UnitFormatType.Area, UnitFormatType.Distance, </span></span><br><span class="line"><span class="comment">//UnitFormatType.Direction, UnitFormatType.Location</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the full list of all available location units</span></span><br><span class="line"><span class="keyword">var</span> all_units = DisplayUnitFormats.Instance.GetPredefinedProjectUnitFormats(</span><br><span class="line">                                                      UnitFormatType.Location);</span><br><span class="line"><span class="comment">//keep units with an even factory code</span></span><br><span class="line"><span class="keyword">var</span> list_units = all_units.Where(du =&gt; du.UnitCode % <span class="number">2</span> == <span class="number">0</span>).ToList();</span><br><span class="line"></span><br><span class="line"><span class="comment">//set them as the new location unit collection. A new default is not being specified...</span></span><br><span class="line">DisplayUnitFormats.Instance.SetProjectUnitFormats(list_units);</span><br><span class="line"></span><br><span class="line"><span class="comment">//set them as the new location unit collection along with a new default</span></span><br><span class="line">DisplayUnitFormats.Instance.SetProjectUnitFormats(</span><br><span class="line">                                        list_units, list_units.First());</span><br><span class="line"></span><br><span class="line"><span class="comment">//Note: UnitFormatType.Page, UnitFormatType.Symbol2D, UnitFormatType.Symbol3D</span></span><br><span class="line"><span class="comment">//cannot be set.</span></span><br></pre></td></tr></table></figure>

<h3 id="设置项目单位格式的默认值"><a href="#设置项目单位格式的默认值" class="headerlink" title="设置项目单位格式的默认值"></a>设置项目单位格式的默认值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unit_formats = Enum.GetValues(<span class="keyword">typeof</span>(UnitFormatType)).OfType&lt;UnitFormatType&gt;().ToList();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> unit_type <span class="keyword">in</span> unit_formats)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> current_default = DisplayUnitFormats.Instance.GetDefaultProjectUnitFormat(unit_type);</span><br><span class="line">  <span class="comment">//Arbitrarily pick the last unit in each unit format list</span></span><br><span class="line">  <span class="keyword">var</span> replacement = DisplayUnitFormats.Instance.GetProjectUnitFormats(unit_type).Last();</span><br><span class="line">  DisplayUnitFormats.Instance.SetDefaultProjectUnitFormat(replacement);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;current_default.DisplayName&#125;</span>, <span class="subst">&#123;current_default.UnitName&#125;</span>, <span class="subst">&#123;current_default.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> line2 = <span class="string">$&quot;<span class="subst">&#123;replacement.DisplayName&#125;</span>, <span class="subst">&#123;replacement.UnitName&#125;</span>, <span class="subst">&#123;replacement.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;Format: <span class="subst">&#123;unit_type.ToString()&#125;</span>&quot;</span>);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot; Current default: <span class="subst">&#123;line&#125;</span>&quot;</span>);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot; Replacement default: <span class="subst">&#123;line2&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新项目的单位格式"><a href="#更新项目的单位格式" class="headerlink" title="更新项目的单位格式"></a>更新项目的单位格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UnitFormatType.Angular, UnitFormatType.Area, UnitFormatType.Distance, </span></span><br><span class="line"><span class="comment">//UnitFormatType.Direction, UnitFormatType.Location</span></span><br><span class="line"><span class="keyword">var</span> angle_units = DisplayUnitFormats.Instance.GetProjectUnitFormats(UnitFormatType.Angular);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Edit the display name of each unit - append the abbreviation</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> unit <span class="keyword">in</span> angle_units)</span><br><span class="line">&#123;</span><br><span class="line">  unit.DisplayName = <span class="string">$&quot;<span class="subst">&#123;unit.DisplayName&#125;</span> (<span class="subst">&#123;unit.Abbreviation&#125;</span>)&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//apply the changes to the units and set the default to be the first entry</span></span><br><span class="line">DisplayUnitFormats.Instance.SetProjectUnitFormats(angle_units, angle_units.First());</span><br><span class="line"></span><br><span class="line"><span class="comment">//The project must be saved to persist the changes...</span></span><br></pre></td></tr></table></figure>

<h2 id="应用选项"><a href="#应用选项" class="headerlink" title="应用选项"></a>应用选项</h2><h3 id="获取常规选项"><a href="#获取常规选项" class="headerlink" title="获取常规选项"></a>获取常规选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> startMode = ApplicationOptions.GeneralOptions.StartupOption;</span><br><span class="line"><span class="keyword">var</span> aprx_path = ApplicationOptions.GeneralOptions.StartupProjectPath;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hf_option = ApplicationOptions.GeneralOptions.HomeFolderOption;</span><br><span class="line"><span class="keyword">var</span> folder = ApplicationOptions.GeneralOptions.CustomHomeFolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gdb_option = ApplicationOptions.GeneralOptions.DefaultGeodatabaseOption;</span><br><span class="line"><span class="keyword">var</span> def_gdb = ApplicationOptions.GeneralOptions.CustomDefaultGeodatabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tbx_option = ApplicationOptions.GeneralOptions.DefaultToolboxOption;</span><br><span class="line"><span class="keyword">var</span> def_tbx = ApplicationOptions.GeneralOptions.CustomDefaultToolbox;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> create_in_folder = ApplicationOptions.GeneralOptions.ProjectCreateInFolder;</span><br></pre></td></tr></table></figure>

<h3 id="将“常规选项”设置为使用自定义设置"><a href="#将“常规选项”设置为使用自定义设置" class="headerlink" title="将“常规选项”设置为使用自定义设置"></a>将“常规选项”设置为使用自定义设置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Set the application to use a custom project, home folder, gdb, and toolbox</span></span><br><span class="line"><span class="comment">//In each case, the custom _path_ must be set _first_ before </span></span><br><span class="line"><span class="comment">//setting the &quot;option&quot;. This ensures the application remains </span></span><br><span class="line"><span class="comment">//in a consistent state. This is the same behavior as on the Pro UI.</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.GeneralOptions.StartupProjectPath))</span><br><span class="line">  ApplicationOptions.GeneralOptions.StartupProjectPath = <span class="string">@&quot;D:\data\usa.aprx&quot;</span>;<span class="comment">//custom project path first</span></span><br><span class="line">ApplicationOptions.GeneralOptions.StartupOption = StartProjectMode.WithDefaultProject;<span class="comment">//option to use it second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.GeneralOptions.CustomHomeFolder))</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomHomeFolder = <span class="string">@&quot;D:\home_folder&quot;</span>;<span class="comment">//custom home folder first</span></span><br><span class="line">ApplicationOptions.GeneralOptions.HomeFolderOption = OptionSetting.UseCustom;<span class="comment">//option to use it second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.GeneralOptions.CustomDefaultGeodatabase))</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomDefaultGeodatabase = <span class="string">@&quot;D:\data\usa.gdb&quot;</span>;<span class="comment">//custom gdb path first</span></span><br><span class="line">ApplicationOptions.GeneralOptions.DefaultGeodatabaseOption = OptionSetting.UseCustom;<span class="comment">//option to use it second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.GeneralOptions.CustomDefaultToolbox))</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomDefaultToolbox = <span class="string">@&quot;D:\data\usa.tbx&quot;</span>;<span class="comment">//custom toolbox path first</span></span><br><span class="line">ApplicationOptions.GeneralOptions.DefaultToolboxOption = OptionSetting.UseCustom;<span class="comment">//option to use it second</span></span><br></pre></td></tr></table></figure>

<h3 id="设置常规选项以使用默认值"><a href="#设置常规选项以使用默认值" class="headerlink" title="设置常规选项以使用默认值"></a>设置常规选项以使用默认值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Default options can be set regardless of the value of the &quot;companion&quot;</span></span><br><span class="line"><span class="comment">//path (to a project, folder, gdb, toolbox, etc.). The path value is ignored if</span></span><br><span class="line"><span class="comment">//the option setting does not use it. This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.GeneralOptions.StartupOption = StartProjectMode.ShowStartPage;</span><br><span class="line">ApplicationOptions.GeneralOptions.HomeFolderOption = OptionSetting.UseDefault;</span><br><span class="line">ApplicationOptions.GeneralOptions.DefaultGeodatabaseOption = OptionSetting.UseDefault;</span><br><span class="line">ApplicationOptions.GeneralOptions.DefaultToolboxOption = OptionSetting.UseDefault;<span class="comment">//set default option first</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//path values can (optionally) be set (back) to null if their </span></span><br><span class="line"><span class="comment">//&quot;companion&quot; option setting is the default option.</span></span><br><span class="line"><span class="keyword">if</span> (ApplicationOptions.GeneralOptions.StartupOption != StartProjectMode.WithDefaultProject)</span><br><span class="line">  ApplicationOptions.GeneralOptions.StartupProjectPath = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (ApplicationOptions.GeneralOptions.HomeFolderOption == OptionSetting.UseDefault)</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomHomeFolder = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (ApplicationOptions.GeneralOptions.DefaultGeodatabaseOption == OptionSetting.UseDefault)</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomDefaultGeodatabase = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (ApplicationOptions.GeneralOptions.DefaultToolboxOption == OptionSetting.UseDefault)</span><br><span class="line">  ApplicationOptions.GeneralOptions.CustomDefaultToolbox = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<h3 id="获取下载选项"><a href="#获取下载选项" class="headerlink" title="获取下载选项"></a>获取下载选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> staging = ApplicationOptions.DownloadOptions.StagingLocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ppkx_loc = ApplicationOptions.DownloadOptions.UnpackPPKXLocation;</span><br><span class="line"><span class="keyword">var</span> ask_ppkx_loc = ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> other_loc = ApplicationOptions.DownloadOptions.UnpackOtherLocation;</span><br><span class="line"><span class="keyword">var</span> ask_other_loc = ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation;</span><br><span class="line"><span class="keyword">var</span> use_proj_folder = ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> offline_loc = ApplicationOptions.DownloadOptions.OfflineMapsLocation;</span><br><span class="line"><span class="keyword">var</span> ask_offline_loc = ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation;</span><br><span class="line"><span class="keyword">var</span> use_proj_folder_offline = ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation;</span><br></pre></td></tr></table></figure>

<h3 id="设置共享和发布的暂存位置"><a href="#设置共享和发布的暂存位置" class="headerlink" title="设置共享和发布的暂存位置"></a>设置共享和发布的暂存位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationOptions.DownloadOptions.StagingLocation = <span class="string">@&quot;D:\data\staging&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="设置-PPKX-的下载选项"><a href="#设置-PPKX-的下载选项" class="headerlink" title="设置 PPKX 的下载选项"></a>设置 PPKX 的下载选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Options are mutually exclusive.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation = true</span></span><br><span class="line"><span class="comment">//superseeds any value in ApplicationOptions.DownloadOptions.UnpackPPKXLocation</span></span><br><span class="line"><span class="comment">//and will prompt the user on an unpack. The value of </span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.UnpackPPKXLocation will be unaffected</span></span><br><span class="line"><span class="comment">//and is ignored. This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation = <span class="literal">true</span>;<span class="comment">//override location</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//The default location is typically &lt;My Documents&gt;\ArcGIS\Packages</span></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.UnpackPPKXLocation to any</span></span><br><span class="line"><span class="comment">//location overrides ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation</span></span><br><span class="line"><span class="comment">//and sets it to false. This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.UnpackPPKXLocation = <span class="string">@&quot;D:\data\for_ppkx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Or, if ApplicationOptions.DownloadOptions.UnpackPPKXLocation already</span></span><br><span class="line"><span class="comment">//contains a valid path, set ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation</span></span><br><span class="line"><span class="comment">//explicitly to false to use the UnpackPPKXLocation</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.DownloadOptions.UnpackPPKXLocation))</span><br><span class="line">  ApplicationOptions.DownloadOptions.AskForUnpackPPKXLocation = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="设置解压缩的下载选项其他"><a href="#设置解压缩的下载选项其他" class="headerlink" title="设置解压缩的下载选项其他"></a>设置解压缩的下载选项其他</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UnpackOther settings control unpacking of anything _other than_</span></span><br><span class="line"><span class="comment">//a ppkx or aptx. Options are mutually exclusive.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set ApplicationOptions.DownloadOptions.UnpackOtherLocation explicitly to</span></span><br><span class="line"><span class="comment">//toggle ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation and</span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation to false</span></span><br><span class="line"><span class="comment">//Note: default is typically &lt;My Documents&gt;\ArcGIS\Packages, _not_ null.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.UnpackOtherLocation = <span class="string">@&quot;D:\data\for_other&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//or...to use a location already stored in UnpackOtherLocation as the</span></span><br><span class="line"><span class="comment">//default without changing it, </span></span><br><span class="line"><span class="comment">//set ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation and</span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation to false</span></span><br><span class="line"><span class="comment">//explicitly. This is the same behavior as on the Pro UI.</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.DownloadOptions.UnpackOtherLocation))</span><br><span class="line">&#123;</span><br><span class="line">  ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation = <span class="literal">false</span>;</span><br><span class="line">  ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation to</span></span><br><span class="line"><span class="comment">//true overrides any UnpackOtherLocation value and sets </span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation to false.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation to</span></span><br><span class="line"><span class="comment">//true overrides any UnpackOtherLocation value and sets </span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.AskForUnpackOtherLocation to false.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.UnpackOtherToProjectLocation = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="设置离线地图的下载选项"><a href="#设置离线地图的下载选项" class="headerlink" title="设置离线地图的下载选项"></a>设置离线地图的下载选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OfflineMaps settings control where map content that is taken</span></span><br><span class="line"><span class="comment">//offline is copied to on the local machine. Options are mutually exclusive.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set ApplicationOptions.DownloadOptions.OfflineMapsLocation explicitly to</span></span><br><span class="line"><span class="comment">//toggle ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation and</span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation to false</span></span><br><span class="line"><span class="comment">//Note: default is typically &lt;My Documents&gt;\ArcGIS\OfflineMaps, _not_ null.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.OfflineMapsLocation = <span class="string">@&quot;D:\data\for_offline&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//or...to use a location already stored in OfflineMapsLocation as the</span></span><br><span class="line"><span class="comment">//default without changing it, </span></span><br><span class="line"><span class="comment">//set ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation and</span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation to false</span></span><br><span class="line"><span class="comment">//explicitly.</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(ApplicationOptions.DownloadOptions.OfflineMapsLocation))</span><br><span class="line">&#123;</span><br><span class="line">  ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation = <span class="literal">false</span>;</span><br><span class="line">  ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation to</span></span><br><span class="line"><span class="comment">//true overrides any OfflineMapsLocation value and sets </span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation to false.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Setting ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation to</span></span><br><span class="line"><span class="comment">//true overrides any OfflineMapsLocation value and sets </span></span><br><span class="line"><span class="comment">//ApplicationOptions.DownloadOptions.AskForOfflineMapsLocation to false.</span></span><br><span class="line"><span class="comment">//This is the same behavior as on the Pro UI.</span></span><br><span class="line">ApplicationOptions.DownloadOptions.OfflineMapsToProjectLocation = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h1 id="核心主机"><a href="#核心主机" class="headerlink" title="核心主机"></a>核心主机</h1><h3 id="初始化核心主机"><a href="#初始化核心主机" class="headerlink" title="初始化核心主机"></a>初始化核心主机</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ArcGIS.Core.Data;</span><br><span class="line"><span class="comment">//There must be a reference to ArcGIS.CoreHost.dll</span></span><br><span class="line"><span class="keyword">using</span> ArcGIS.Core.Hosting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="comment">//[STAThread] must be present on the Application entry point</span></span><br><span class="line">    [<span class="meta">STAThread</span>]</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Call Host.Initialize before constructing any objects from ArcGIS.Core</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Host.Initialize();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Error (missing installation, no license, 64 bit mismatch, etc.)</span></span><br><span class="line">            Console.WriteLine(<span class="built_in">string</span>.Format(<span class="string">&quot;Initialization failed: &#123;0&#125;&quot;</span>,e.Message));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//if we are here, ArcGIS.Core is successfully initialized</span></span><br><span class="line">        Geodatabase gdb = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\SDK\GDB\MySampleData.gdb&quot;</span>)));</span><br><span class="line">        IReadOnlyList&lt;TableDefinition&gt; definitions = gdb.GetDefinitions&lt;FeatureClassDefinition&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> fdsDef <span class="keyword">in</span> definitions) &#123;</span><br><span class="line">            Console.WriteLine(TableString(fdsDef <span class="keyword">as</span> TableDefinition));</span><br><span class="line">        &#125;</span><br><span class="line">        Console.Read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">TableString</span>(<span class="params">TableDefinition table</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">string</span> <span class="keyword">alias</span> = table.GetAliasName();</span><br><span class="line">        <span class="built_in">string</span> name = table.GetName();</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>.Format(<span class="string">&quot;&#123;0&#125; (&#123;1&#125;)&quot;</span>, <span class="keyword">alias</span>.Length &gt; <span class="number">0</span> ? <span class="keyword">alias</span> : name, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h1><h2 id="编辑操作方法"><a href="#编辑操作方法" class="headerlink" title="编辑操作方法"></a>编辑操作方法</h2><h3 id="编辑操作创建要素"><a href="#编辑操作创建要素" class="headerlink" title="编辑操作创建要素"></a>编辑操作创建要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">createFeatures.Name = <span class="string">&quot;Create Features&quot;</span>;</span><br><span class="line"><span class="comment">//Create a feature with a polygon</span></span><br><span class="line"><span class="keyword">var</span> token = createFeatures.Create(featureLayer, polygon);</span><br><span class="line"><span class="keyword">if</span> (createFeatures.IsSucceeded)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// token.ObjectID wll be populated with the objectID of the created feature after Execute has been successful</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Do a create features and set attributes</span></span><br><span class="line"><span class="keyword">var</span> attributes = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line">attributes.Add(<span class="string">&quot;SHAPE&quot;</span>, polygon);</span><br><span class="line">attributes.Add(<span class="string">&quot;NAME&quot;</span>, <span class="string">&quot;Corner Market&quot;</span>);</span><br><span class="line">attributes.Add(<span class="string">&quot;SIZE&quot;</span>, <span class="number">1200.5</span>);</span><br><span class="line">attributes.Add(<span class="string">&quot;DESCRIPTION&quot;</span>, <span class="string">&quot;Corner Market&quot;</span>);</span><br><span class="line"></span><br><span class="line">createFeatures.Create(featureLayer, attributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create features using the current template</span></span><br><span class="line"><span class="comment">//Must be within a MapTool</span></span><br><span class="line">createFeatures.Create(<span class="keyword">this</span>.CurrentTemplate, polygon);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">createFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await createFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="使用当前模板创建要素"><a href="#使用当前模板创建要素" class="headerlink" title="使用当前模板创建要素"></a>使用当前模板创建要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myTemplate = ArcGIS.Desktop.Editing.Templates.EditingTemplate.Current;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create edit operation and execute</span></span><br><span class="line"><span class="keyword">var</span> op = <span class="keyword">new</span> ArcGIS.Desktop.Editing.EditOperation();</span><br><span class="line">op.Name = <span class="string">&quot;Create my feature&quot;</span>;</span><br><span class="line">op.Create(myTemplate, geometry);</span><br><span class="line">op.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="从修改后的检查器创建要素"><a href="#从修改后的检查器创建要素" class="headerlink" title="从修改后的检查器创建要素"></a>从修改后的检查器创建要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> insp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line">insp.Load(layer, <span class="number">86</span>);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// modify attributes if necessary</span></span><br><span class="line">  <span class="comment">// insp[&quot;Field1&quot;] = newValue;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create new feature from an existing inspector (copying the feature)</span></span><br><span class="line">  <span class="keyword">var</span> createOp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.EditOperation();</span><br><span class="line">  createOp.Name = <span class="string">&quot;Create from insp&quot;</span>;</span><br><span class="line">  createOp.Create(insp.MapMember, insp.ToDictionary(a =&gt; a.FieldName, a =&gt; a.CurrentValue));</span><br><span class="line">  createOp.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从-CSV-文件创建要素"><a href="#从-CSV-文件创建要素" class="headerlink" title="从 CSV 文件创建要素"></a>从 CSV 文件创建要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Run on MCT</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create the edit operation</span></span><br><span class="line">  <span class="keyword">var</span> createOperation = <span class="keyword">new</span> ArcGIS.Desktop.Editing.EditOperation();</span><br><span class="line">  createOperation.Name = <span class="string">&quot;Generate points&quot;</span>;</span><br><span class="line">  createOperation.SelectNewFeatures = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// determine the shape field name - it may not be &#x27;Shape&#x27; </span></span><br><span class="line">  <span class="built_in">string</span> shapeField = layer.GetFeatureClass().GetDefinition().GetShapeField();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Loop through csv data</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> csvData)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Create the point geometry</span></span><br><span class="line">    ArcGIS.Core.Geometry.MapPoint newMapPoint =</span><br><span class="line">        ArcGIS.Core.Geometry.MapPointBuilderEx.CreateMapPoint(item.X, item.Y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// include the attributes via a dictionary</span></span><br><span class="line">    <span class="keyword">var</span> atts = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line">    atts.Add(<span class="string">&quot;StopOrder&quot;</span>, item.StopOrder);</span><br><span class="line">    atts.Add(<span class="string">&quot;FacilityID&quot;</span>, item.FacilityID);</span><br><span class="line">    atts.Add(shapeField, newMapPoint);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// queue feature creation</span></span><br><span class="line">    createOperation.Create(layer, atts);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// execute the edit (feature creation) operation</span></span><br><span class="line">  <span class="keyword">return</span> createOperation.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作-使用表模板在表中创建行"><a href="#编辑操作-使用表模板在表中创建行" class="headerlink" title="编辑操作 使用表模板在表中创建行"></a>编辑操作 使用表模板在表中创建行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tableTemplate = standaloneTable.GetTemplates().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> createRow = <span class="keyword">new</span> EditOperation();</span><br><span class="line">createRow.Name = <span class="string">&quot;Create a row in a table&quot;</span>;</span><br><span class="line"><span class="comment">//Creating a new row in a standalone table using the table template of your choice</span></span><br><span class="line">createRow.Create(tableTemplate);</span><br><span class="line">createRow.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作剪辑特征"><a href="#编辑操作剪辑特征" class="headerlink" title="编辑操作剪辑特征"></a>编辑操作剪辑特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clipFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">clipFeatures.Name = <span class="string">&quot;Clip Features&quot;</span>;</span><br><span class="line">clipFeatures.Clip(featureLayer, oid, clipPoly, ClipMode.PreserveArea);</span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">clipFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await clipFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作切割要素"><a href="#编辑操作切割要素" class="headerlink" title="编辑操作切割要素"></a>编辑操作切割要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">select</span> = MapView.Active.SelectFeatures(clipPoly);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cutFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">cutFeatures.Name = <span class="string">&quot;Cut Features&quot;</span>;</span><br><span class="line">cutFeatures.Split(featureLayer, oid, cutLine);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Cut all the selected features in the active view</span></span><br><span class="line"><span class="comment">//Select using a polygon (for example)</span></span><br><span class="line"><span class="comment">//at 2.x - var kvps = MapView.Active.SelectFeatures(polygon).Select(</span></span><br><span class="line"><span class="comment">//      k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//cutFeatures.Split(kvps, cutLine);</span></span><br><span class="line"><span class="keyword">var</span> sset = MapView.Active.SelectFeatures(polygon);</span><br><span class="line">cutFeatures.Split(sset, cutLine);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">cutFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await cutFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作删除要素"><a href="#编辑操作删除要素" class="headerlink" title="编辑操作删除要素"></a>编辑操作删除要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deleteFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">deleteFeatures.Name = <span class="string">&quot;Delete Features&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> table = MapView.Active.Map.StandaloneTables[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//Delete a row in a standalone table</span></span><br><span class="line">deleteFeatures.Delete(table, oid);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Delete all the selected features in the active view</span></span><br><span class="line"><span class="comment">//Select using a polygon (for example)</span></span><br><span class="line"><span class="comment">//at 2.x - var selection = MapView.Active.SelectFeatures(polygon).Select(</span></span><br><span class="line"><span class="comment">//      k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//deleteFeatures.Delete(selection);</span></span><br><span class="line"><span class="keyword">var</span> selection = MapView.Active.SelectFeatures(polygon);</span><br><span class="line">deleteFeatures.Delete(selection);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">deleteFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await deleteFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作重复要素"><a href="#编辑操作重复要素" class="headerlink" title="编辑操作重复要素"></a>编辑操作重复要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> duplicateFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  duplicateFeatures.Name = <span class="string">&quot;Duplicate Features&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Duplicate with an X and Y offset of 500 map units</span></span><br><span class="line">  <span class="comment">//At 2.x duplicateFeatures.Duplicate(featureLayer, oid, 500.0, 500.0, 0.0);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Execute to execute the operation</span></span><br><span class="line">  <span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">  <span class="keyword">var</span> insp2 = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp2.Load(featureLayer, oid);</span><br><span class="line">  <span class="keyword">var</span> geom = insp2[<span class="string">&quot;SHAPE&quot;</span>] <span class="keyword">as</span> Geometry;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rtoken = duplicateFeatures.Create(insp2.MapMember, insp2.ToDictionary(a =&gt; a.FieldName, a =&gt; a.CurrentValue));</span><br><span class="line">  <span class="keyword">if</span> (duplicateFeatures.Execute())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> modifyOp = duplicateFeatures.CreateChainedOperation();</span><br><span class="line">    modifyOp.Modify(featureLayer, (<span class="built_in">long</span>)rtoken.ObjectID, GeometryEngine.Instance.Move(geom, <span class="number">500.0</span>, <span class="number">500.0</span>));</span><br><span class="line">    modifyOp.Execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作分解特征"><a href="#编辑操作分解特征" class="headerlink" title="编辑操作分解特征"></a>编辑操作分解特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> explodeFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">explodeFeatures.Name = <span class="string">&quot;Explode Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Take a multipart and convert it into one feature per part</span></span><br><span class="line"><span class="comment">//Provide a list of ids to convert multiple</span></span><br><span class="line">explodeFeatures.Explode(featureLayer, <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; oid &#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">explodeFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await explodeFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作合并功能"><a href="#编辑操作合并功能" class="headerlink" title="编辑操作合并功能"></a>编辑操作合并功能</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mergeFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">mergeFeatures.Name = <span class="string">&quot;Merge Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Merge three features into a new feature using defaults</span></span><br><span class="line"><span class="comment">//defined in the current template</span></span><br><span class="line"><span class="comment">//At 2.x -</span></span><br><span class="line"><span class="comment">//mergeFeatures.Merge(this.CurrentTemplate as EditingFeatureTemplate, featureLayer, new List&lt;long&gt;() &#123; 10, 96, 12 &#125;);</span></span><br><span class="line">mergeFeatures.Merge(<span class="keyword">this</span>.CurrentTemplate <span class="keyword">as</span> EditingRowTemplate, featureLayer, <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; <span class="number">10</span>, <span class="number">96</span>, <span class="number">12</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Merge three features into a new feature in the destination layer</span></span><br><span class="line">mergeFeatures.Merge(destinationLayer, featureLayer, <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; <span class="number">10</span>, <span class="number">96</span>, <span class="number">12</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use an inspector to set the new attributes of the merged feature</span></span><br><span class="line"><span class="keyword">var</span> inspector = <span class="keyword">new</span> Inspector();</span><br><span class="line">inspector.Load(featureLayer, oid);<span class="comment">//base attributes on an existing feature</span></span><br><span class="line"><span class="comment">//change attributes for the new feature</span></span><br><span class="line">inspector[<span class="string">&quot;NAME&quot;</span>] = <span class="string">&quot;New name&quot;</span>;</span><br><span class="line">inspector[<span class="string">&quot;DESCRIPTION&quot;</span>] = <span class="string">&quot;New description&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Merge features into a new feature in the same layer using the</span></span><br><span class="line"><span class="comment">//defaults set in the inspector</span></span><br><span class="line">mergeFeatures.Merge(featureLayer, <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; <span class="number">10</span>, <span class="number">96</span>, <span class="number">12</span> &#125;, inspector);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">mergeFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await mergeFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作-修改单个特征"><a href="#编辑操作-修改单个特征" class="headerlink" title="编辑操作 修改单个特征"></a>编辑操作 修改单个特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> modifyFeature = <span class="keyword">new</span> EditOperation();</span><br><span class="line">modifyFeature.Name = <span class="string">&quot;Modify a feature&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//use an inspector</span></span><br><span class="line"><span class="keyword">var</span> modifyInspector = <span class="keyword">new</span> Inspector();</span><br><span class="line">modifyInspector.Load(featureLayer, oid);<span class="comment">//base attributes on an existing feature</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//change attributes for the new feature</span></span><br><span class="line">modifyInspector[<span class="string">&quot;SHAPE&quot;</span>] = polygon;<span class="comment">//Update the geometry</span></span><br><span class="line">modifyInspector[<span class="string">&quot;NAME&quot;</span>] = <span class="string">&quot;Updated name&quot;</span>;<span class="comment">//Update attribute(s)</span></span><br><span class="line"></span><br><span class="line">modifyFeature.Modify(modifyInspector);</span><br><span class="line"></span><br><span class="line"><span class="comment">//update geometry and attributes using overload</span></span><br><span class="line"><span class="keyword">var</span> featureAttributes = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line">featureAttributes[<span class="string">&quot;NAME&quot;</span>] = <span class="string">&quot;Updated name&quot;</span>;<span class="comment">//Update attribute(s)</span></span><br><span class="line">modifyFeature.Modify(featureLayer, oid, polygon, featureAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">modifyFeature.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await modifyFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作-修改多个要素"><a href="#编辑操作-修改多个要素" class="headerlink" title="编辑操作 修改多个要素"></a>编辑操作 修改多个要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Search by attribute</span></span><br><span class="line"><span class="keyword">var</span> queryFilter = <span class="keyword">new</span> QueryFilter();</span><br><span class="line">queryFilter.WhereClause = <span class="string">&quot;OBJECTID &lt; 1000000&quot;</span>;</span><br><span class="line"><span class="comment">//Create list of oids to update</span></span><br><span class="line"><span class="keyword">var</span> oidSet = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;();</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rc = featureLayer.Search(queryFilter))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> <span class="keyword">record</span> = rc.Current)</span><br><span class="line">    &#123;</span><br><span class="line">      oidSet.Add(<span class="keyword">record</span>.GetObjectID());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create and execute the edit operation</span></span><br><span class="line"><span class="keyword">var</span> modifyFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">modifyFeatures.Name = <span class="string">&quot;Modify features&quot;</span>;</span><br><span class="line">modifyFeatures.ShowProgressor = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> muultipleFeaturesInsp = <span class="keyword">new</span> Inspector();</span><br><span class="line">muultipleFeaturesInsp.Load(featureLayer, oidSet);</span><br><span class="line">muultipleFeaturesInsp[<span class="string">&quot;MOMC&quot;</span>] = <span class="number">24</span>;</span><br><span class="line">modifyFeatures.Modify(muultipleFeaturesInsp);</span><br><span class="line">modifyFeatures.ExecuteAsync();</span><br></pre></td></tr></table></figure>

<h3 id="搜索图层要素并更新字段"><a href="#搜索图层要素并更新字段" class="headerlink" title="搜索图层要素并更新字段"></a>搜索图层要素并更新字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//find layer</span></span><br><span class="line">  <span class="keyword">var</span> disLayer = ArcGIS.Desktop.Mapping.MapView.Active.Map.FindLayers(<span class="string">&quot;Distribution mains&quot;</span>).FirstOrDefault() <span class="keyword">as</span> BasicFeatureLayer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search by attribute</span></span><br><span class="line">  <span class="keyword">var</span> filter = <span class="keyword">new</span> ArcGIS.Core.Data.QueryFilter();</span><br><span class="line">  filter.WhereClause = <span class="string">&quot;CONTRACTOR = &#x27;KCGM&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> oids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;();</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rc = disLayer.Search(filter))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Create list of oids to update</span></span><br><span class="line">    <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> <span class="keyword">record</span> = rc.Current)</span><br><span class="line">      &#123;</span><br><span class="line">        oidSet.Add(<span class="keyword">record</span>.GetObjectID());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create edit operation </span></span><br><span class="line">  <span class="keyword">var</span> modifyOp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.EditOperation();</span><br><span class="line">  modifyOp.Name = <span class="string">&quot;Update date&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load features into inspector and update field</span></span><br><span class="line">  <span class="keyword">var</span> dateInsp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line">  dateInsp.Load(disLayer, oids);</span><br><span class="line">  dateInsp[<span class="string">&quot;InspDate&quot;</span>] = <span class="string">&quot;9/21/2013&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// modify and execute</span></span><br><span class="line">  modifyOp.Modify(insp);</span><br><span class="line">  modifyOp.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="移动要素"><a href="#移动要素" class="headerlink" title="移动要素"></a>移动要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get all of the selected ObjectIDs from the layer.</span></span><br><span class="line"><span class="keyword">var</span> firstLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> selectionfromMap = firstLayer.GetSelection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// set up a dictionary to store the layer and the object IDs of the selected features</span></span><br><span class="line"><span class="keyword">var</span> selectionDictionary = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">selectionDictionary.Add(firstLayer <span class="keyword">as</span> MapMember, selectionfromMap.GetObjectIDs().ToList());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moveFeature = <span class="keyword">new</span> EditOperation();</span><br><span class="line">moveFeature.Name = <span class="string">&quot;Move features&quot;</span>;</span><br><span class="line"><span class="comment">//at 2.x - moveFeature.Move(selectionDictionary, 10, 10);  //specify your units along axis to move the geometry</span></span><br><span class="line">moveFeature.Move(SelectionSet.FromDictionary(selectionDictionary), <span class="number">10</span>, <span class="number">10</span>);  <span class="comment">//specify your units along axis to move the geometry</span></span><br><span class="line"></span><br><span class="line">moveFeature.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="将要素移动到特定坐标"><a href="#将要素移动到特定坐标" class="headerlink" title="将要素移动到特定坐标"></a>将要素移动到特定坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get all of the selected ObjectIDs from the layer.</span></span><br><span class="line"><span class="keyword">var</span> abLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> mySelection = abLayer.GetSelection();</span><br><span class="line"><span class="keyword">var</span> selOid = mySelection.GetObjectIDs().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moveToPoint = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, MapView.Active.Map.SpatialReference); <span class="comment">//can pass in coordinates.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> modifyFeatureCoord = <span class="keyword">new</span> EditOperation();</span><br><span class="line">modifyFeatureCoord.Name = <span class="string">&quot;Move features&quot;</span>;</span><br><span class="line">modifyFeatureCoord.Modify(abLayer, selOid, moveToPoint.ToGeometry());  <span class="comment">//Modify the feature to the new geometry </span></span><br><span class="line">modifyFeatureCoord.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作平面化要素"><a href="#编辑操作平面化要素" class="headerlink" title="编辑操作平面化要素"></a>编辑操作平面化要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note - EditOperation.Planarize requires a standard license. </span></span><br><span class="line"><span class="comment">//  An exception will be thrown if Pro is running under a basic license. </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> planarizeFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">planarizeFeatures.Name = <span class="string">&quot;Planarize Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Planarize one or more features</span></span><br><span class="line">planarizeFeatures.Planarize(featureLayer, <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; oid &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">planarizeFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await planarizeFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作并行偏移"><a href="#编辑操作并行偏移" class="headerlink" title="编辑操作并行偏移"></a>编辑操作并行偏移</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create parrallel features from the selected features</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//find the roads layer</span></span><br><span class="line"><span class="keyword">var</span> roadsLayer = MapView.Active.Map.FindLayers(<span class="string">&quot;Roads&quot;</span>).FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//instatiate paralleloffset builder and set parameters</span></span><br><span class="line"><span class="keyword">var</span> parOffsetBuilder = <span class="keyword">new</span> ParallelOffset.Builder()</span><br><span class="line">&#123;</span><br><span class="line">  Selection = MapView.Active.Map.GetSelection(),</span><br><span class="line">  Template = roadsLayer.GetTemplate(<span class="string">&quot;Freeway&quot;</span>),</span><br><span class="line">  Distance = <span class="number">200</span>,</span><br><span class="line">  Side = ParallelOffset.SideType.Both,</span><br><span class="line">  Corner = ParallelOffset.CornerType.Mitered,</span><br><span class="line">  Iterations = <span class="number">1</span>,</span><br><span class="line">  AlignConnected = <span class="literal">false</span>,</span><br><span class="line">  CopyToSeparateFeatures = <span class="literal">false</span>,</span><br><span class="line">  RemoveSelfIntersectingLoops = <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create editoperation and execute</span></span><br><span class="line"><span class="keyword">var</span> parrallelOp = <span class="keyword">new</span> EditOperation();</span><br><span class="line">parrallelOp.Create(parOffsetBuilder);</span><br><span class="line">parrallelOp.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作重塑特征"><a href="#编辑操作重塑特征" class="headerlink" title="编辑操作重塑特征"></a>编辑操作重塑特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reshapeFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">reshapeFeatures.Name = <span class="string">&quot;Reshape Features&quot;</span>;</span><br><span class="line"></span><br><span class="line">reshapeFeatures.Reshape(featureLayer, oid, modifyLine);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reshape a set of features that intersect some geometry....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//at 2.x - var selFeatures = MapView.Active.GetFeatures(modifyLine).Select(</span></span><br><span class="line"><span class="comment">//    k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//reshapeFeatures.Reshape(selFeatures, modifyLine);</span></span><br><span class="line"></span><br><span class="line">reshapeFeatures.Reshape(MapView.Active.GetFeatures(modifyLine), modifyLine);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">reshapeFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await reshapeFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作旋转要素"><a href="#编辑操作旋转要素" class="headerlink" title="编辑操作旋转要素"></a>编辑操作旋转要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rotateFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">rotateFeatures.Name = <span class="string">&quot;Rotate Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Rotate works on a selected set of features</span></span><br><span class="line"><span class="comment">//Get all features that intersect a polygon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//at 2.x - var rotateSelection = MapView.Active.GetFeatures(polygon).Select(</span></span><br><span class="line"><span class="comment">//    k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//rotateFeatures.Rotate(rotateSelection, origin, Math.PI / 2);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Rotate selected features 90 deg about &quot;origin&quot;</span></span><br><span class="line">rotateFeatures.Rotate(MapView.Active.GetFeatures(polygon), origin, Math.PI / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">rotateFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await rotateFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作比例要素"><a href="#编辑操作比例要素" class="headerlink" title="编辑操作比例要素"></a>编辑操作比例要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scaleFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">scaleFeatures.Name = <span class="string">&quot;Scale Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Rotate works on a selected set of features</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var scaleSelection = MapView.Active.GetFeatures(polygon).Select(</span></span><br><span class="line"><span class="comment">//    k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//scaleFeatures.Scale(scaleSelection, origin, 2.0, 2.0, 0.0);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Scale the selected features by 2.0 in the X and Y direction</span></span><br><span class="line">scaleFeatures.Scale(MapView.Active.GetFeatures(polygon), origin, <span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">scaleFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await scaleFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作拆分要素"><a href="#编辑操作拆分要素" class="headerlink" title="编辑操作拆分要素"></a>编辑操作拆分要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> splitFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">splitFeatures.Name = <span class="string">&quot;Split Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> splitPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; mp1, mp2, mp3 &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Split the feature at 3 points</span></span><br><span class="line">splitFeatures.Split(featureLayer, oid, splitPoints);</span><br><span class="line"></span><br><span class="line"><span class="comment">// split using percentage</span></span><br><span class="line"><span class="keyword">var</span> splitByPercentage = <span class="keyword">new</span> SplitByPercentage() &#123; Percentage = <span class="number">33</span>, SplitFromStartPoint = <span class="literal">true</span> &#125;;</span><br><span class="line">splitFeatures.Split(featureLayer, oid, splitByPercentage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// split using equal parts</span></span><br><span class="line"><span class="keyword">var</span> splitByEqualParts = <span class="keyword">new</span> SplitByEqualParts() &#123; NumParts = <span class="number">3</span> &#125;;</span><br><span class="line">splitFeatures.Split(featureLayer, oid, splitByEqualParts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// split using single distance</span></span><br><span class="line"><span class="keyword">var</span> splitByDistance = <span class="keyword">new</span> SplitByDistance() &#123; Distance = <span class="number">27.3</span>, SplitFromStartPoint = <span class="literal">false</span> &#125;;</span><br><span class="line">splitFeatures.Split(featureLayer, oid, splitByDistance);</span><br><span class="line"></span><br><span class="line"><span class="comment">// split using varying distance</span></span><br><span class="line"><span class="keyword">var</span> distances = <span class="keyword">new</span> List&lt;<span class="built_in">double</span>&gt;() &#123; <span class="number">12.5</span>, <span class="number">38.2</span>, <span class="number">89.99</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> splitByVaryingDistance = <span class="keyword">new</span> SplitByVaryingDistance() &#123; Distances = distances, SplitFromStartPoint = <span class="literal">true</span>, ProportionRemainder = <span class="literal">true</span> &#125;;</span><br><span class="line">splitFeatures.Split(featureLayer, oid, splitByVaryingDistance);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">splitFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await splitAtPointsFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作变换特征"><a href="#编辑操作变换特征" class="headerlink" title="编辑操作变换特征"></a>编辑操作变换特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> transformFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">transformFeatures.Name = <span class="string">&quot;Transform Features&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Transform a selected set of features</span></span><br><span class="line"><span class="comment">//At 2.x - var transformSelection = MapView.Active.GetFeatures(polygon).Select(</span></span><br><span class="line"><span class="comment">//    k =&gt; new KeyValuePair&lt;MapMember, List&lt;long&gt;&gt;(k.Key as MapMember, k.Value));</span></span><br><span class="line"><span class="comment">//transformFeatures.Transform(transformSelection, linkLayer);</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span>/Transform just a layer</span></span><br><span class="line"><span class="comment">//transformFeatures.Transform(featureLayer, linkLayer);</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span>/Perform an affine transformation</span></span><br><span class="line"><span class="comment">//transformFeatures.TransformAffine(featureLayer, linkLayer);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> affine_transform = <span class="keyword">new</span> TransformByLinkLayer()</span><br><span class="line">&#123;</span><br><span class="line">  LinkLayer = linkLayer,</span><br><span class="line">  TransformType = TransformMethodType.Affine <span class="comment">//TransformMethodType.Similarity</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Transform a selected set of features</span></span><br><span class="line">transformFeatures.Transform(MapView.Active.GetFeatures(polygon), affine_transform);</span><br><span class="line"><span class="comment">//Perform an affine transformation</span></span><br><span class="line">transformFeatures.Transform(featureLayer, affine_transform);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Execute to execute the operation</span></span><br><span class="line"><span class="comment">//Must be called within QueuedTask.Run</span></span><br><span class="line">transformFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await transformFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作橡皮板功能"><a href="#编辑操作橡皮板功能" class="headerlink" title="编辑操作橡皮板功能"></a>编辑操作橡皮板功能</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Perform rubbersheet by geometries</span></span><br><span class="line"><span class="keyword">var</span> rubbersheetMethod = <span class="keyword">new</span> RubbersheetByGeometries()</span><br><span class="line">&#123;</span><br><span class="line">  RubbersheetType = RubbersheetMethodType.Linear, <span class="comment">//The RubbersheetType can be Linear of NearestNeighbor</span></span><br><span class="line">  LinkLines = linkLines, <span class="comment">//IEnumerable list of link lines (polylines)</span></span><br><span class="line">  AnchorPoints = anchorPoints, <span class="comment">//IEnumerable list of anchor points (map points)</span></span><br><span class="line">  LimitedAdjustmentAreas = limitedAdjustmentAreas <span class="comment">//IEnumerable list of limited adjustment areas (polygons)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rubbersheetOp = <span class="keyword">new</span> EditOperation();</span><br><span class="line"><span class="comment">//Performs linear rubbersheet transformation on the features belonging to &quot;layer&quot; that fall within the limited adjustment areas</span></span><br><span class="line">rubbersheetOp.Rubbersheet(layer, rubbersheetMethod);</span><br><span class="line"><span class="comment">//Execute the operation</span></span><br><span class="line">rubbersheetOp.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Alternatively, you can also perform rubbersheet by layer</span></span><br><span class="line"><span class="keyword">var</span> rubbersheetMethod2 = <span class="keyword">new</span> RubbersheetByLayers()</span><br><span class="line">&#123;</span><br><span class="line">  RubbersheetType = RubbersheetMethodType.NearestNeighbor, <span class="comment">//The RubbersheetType can be Linear of NearestNeighbor</span></span><br><span class="line">  LinkLayer = linkLayer,</span><br><span class="line">  AnchorPointLayer = anchorPointsLayer,</span><br><span class="line">  LimitedAdjustmentAreaLayer = limitedAdjustmentAreaLayer</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Performs nearest neighbor rubbersheet transformation on the features belonging to &quot;layer&quot; that fall within the limited adjustment areas</span></span><br><span class="line">rubbersheetOp.Rubbersheet(layer, rubbersheetMethod2);</span><br><span class="line"><span class="comment">//Execute the operation</span></span><br><span class="line">rubbersheetOp.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="编辑操作-执行剪辑、剪切和平坦化"><a href="#编辑操作-执行剪辑、剪切和平坦化" class="headerlink" title="编辑操作 执行剪辑、剪切和平坦化"></a>编辑操作 执行剪辑、剪切和平坦化</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Multiple operations can be performed by a single</span></span><br><span class="line"><span class="comment">//edit operation.</span></span><br><span class="line"><span class="keyword">var</span> clipCutPlanarizeFeatures = <span class="keyword">new</span> EditOperation();</span><br><span class="line">clipCutPlanarizeFeatures.Name = <span class="string">&quot;Clip, Cut, and Planarize Features&quot;</span>;</span><br><span class="line">clipCutPlanarizeFeatures.Clip(featureLayer, oid, clipPoly);</span><br><span class="line">clipCutPlanarizeFeatures.Split(featureLayer, oid, cutLine);</span><br><span class="line">clipCutPlanarizeFeatures.Planarize(featureLayer, oid);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Note: An edit operation is a single transaction. </span></span><br><span class="line"><span class="comment">//Execute the operations (in the order they were declared)</span></span><br><span class="line">clipCutPlanarizeFeatures.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await clipCutPlanarizeFeatures.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作链-编辑操作"><a href="#编辑操作链-编辑操作" class="headerlink" title="编辑操作链 编辑操作"></a>编辑操作链 编辑操作</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Chaining operations is a special case. Use &quot;Chained Operations&quot; when you require multiple transactions </span></span><br><span class="line"><span class="comment">//to be undo-able with a single &quot;Undo&quot;.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//The most common use case for operation chaining is creating a feature with an attachement. </span></span><br><span class="line"><span class="comment">//Adding an attachment requires the object id (of a new feature) has already been created. </span></span><br><span class="line"><span class="keyword">var</span> editOperation1 = <span class="keyword">new</span> EditOperation();</span><br><span class="line">editOperation1.Name = <span class="built_in">string</span>.Format(<span class="string">&quot;Create point in &#x27;&#123;0&#125;&#x27;&quot;</span>, CurrentTemplate.Layer.Name);</span><br><span class="line"></span><br><span class="line"><span class="built_in">long</span> newFeatureID = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">//The Create operation has to execute so we can get an object_id</span></span><br><span class="line"><span class="keyword">var</span> token2 = editOperation1.Create(<span class="keyword">this</span>.CurrentTemplate, polygon);</span><br><span class="line"><span class="keyword">if</span> (editOperation1.IsSucceeded)</span><br><span class="line">&#123;</span><br><span class="line">  newFeatureID = (<span class="built_in">long</span>)token2.ObjectID;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Must be within a QueuedTask</span></span><br><span class="line">editOperation1.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await editOperation1.ExecuteAsync();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Now, because we have the object id, we can add the attachment.  As we are chaining it, adding the attachment </span></span><br><span class="line"><span class="comment">//can be undone as part of the &quot;Undo Create&quot; operation. In other words, only one undo operation will show on the </span></span><br><span class="line"><span class="comment">//Pro UI and not two.</span></span><br><span class="line"><span class="keyword">var</span> editOperation2 = editOperation1.CreateChainedOperation();</span><br><span class="line"><span class="comment">//Add the attachement using the new feature id</span></span><br><span class="line">editOperation2.AddAttachment(<span class="keyword">this</span>.CurrentTemplate.Layer, newFeatureID, <span class="string">@&quot;C:\data\images\Hydrant.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//editOperation1 and editOperation2 show up as a single Undo operation on the UI even though</span></span><br><span class="line"><span class="comment">//we had two transactions</span></span><br><span class="line"><span class="comment">//Must be within a QueuedTask</span></span><br><span class="line">editOperation2.Execute();</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use async flavor</span></span><br><span class="line"><span class="comment">//await editOperation2.ExecuteAsync();</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑操作通过行令牌添加附件"><a href="#编辑操作通过行令牌添加附件" class="headerlink" title="编辑操作通过行令牌添加附件"></a>编辑操作通过行令牌添加附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ArcGIS Pro 2.5 extends the EditOperation.AddAttachment method to take a RowToken as a paramter.</span></span><br><span class="line"><span class="comment">//This allows you to create a feature, using EditOperation.CreateEx, and add an attachment in one transaction.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> editOpAttach = <span class="keyword">new</span> EditOperation();</span><br><span class="line">editOperation1.Name = <span class="built_in">string</span>.Format(<span class="string">&quot;Create point in &#x27;&#123;0&#125;&#x27;&quot;</span>, CurrentTemplate.Layer.Name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> attachRowToken = editOpAttach.Create(<span class="keyword">this</span>.CurrentTemplate, polygon);</span><br><span class="line">editOpAttach.AddAttachment(attachRowToken, <span class="string">@&quot;c:\temp\image.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Must be within a QueuedTask</span></span><br><span class="line">editOpAttach.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="SetOnUndone，-SetOnRedone，-SetOnComitted"><a href="#SetOnUndone，-SetOnRedone，-SetOnComitted" class="headerlink" title="SetOnUndone， SetOnRedone， SetOnComitted"></a>SetOnUndone， SetOnRedone， SetOnComitted</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetOnUndone, SetOnRedone and SetOnComittedManage can be used to manage </span></span><br><span class="line"><span class="comment">// external actions(such as writing to a log table) that are associated with </span></span><br><span class="line"><span class="comment">// each edit operation.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//get selected feature and update attribute</span></span><br><span class="line"><span class="keyword">var</span> selectedFeatures = MapView.Active.Map.GetSelection();</span><br><span class="line"><span class="keyword">var</span> testInspector = <span class="keyword">new</span> Inspector();</span><br><span class="line">testInspector.Load(selectedFeatures.ToDictionary().Keys.First(), selectedFeatures.ToDictionary().Values.First());</span><br><span class="line">testInspector[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create and execute the edit operation</span></span><br><span class="line"><span class="keyword">var</span> updateTestField = <span class="keyword">new</span> EditOperation();</span><br><span class="line">updateTestField.Name = <span class="string">&quot;Update test field&quot;</span>;</span><br><span class="line">updateTestField.Modify(insp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//actions for SetOn...</span></span><br><span class="line">updateTestField.SetOnUndone(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sets an action that will be called when this operation is undone.</span></span><br><span class="line">  Debug.WriteLine(<span class="string">&quot;Operation is undone&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">updateTestField.SetOnRedone(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sets an action that will be called when this editoperation is redone.</span></span><br><span class="line">  Debug.WriteLine(<span class="string">&quot;Operation is redone&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">updateTestField.SetOnComitted((<span class="built_in">bool</span> b) =&gt; <span class="comment">//called on edit session save(true)/discard(false).</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Sets an action that will be called when this editoperation is committed.</span></span><br><span class="line">  Debug.WriteLine(<span class="string">&quot;Operation is committed&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">updateTestField.Execute();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="启用编辑"><a href="#启用编辑" class="headerlink" title="启用编辑"></a>启用编辑</h2><h3 id="启用编辑-1"><a href="#启用编辑-1" class="headerlink" title="启用编辑"></a>启用编辑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if not editing</span></span><br><span class="line"><span class="keyword">if</span> (!Project.Current.IsEditingEnabled)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> res = MessageBox.Show(<span class="string">&quot;You must enable editing to use editing tools. Would you like to enable editing?&quot;</span>,</span><br><span class="line">                                                        <span class="string">&quot;Enable Editing?&quot;</span>, System.Windows.MessageBoxButton.YesNoCancel);</span><br><span class="line">  <span class="keyword">if</span> (res == System.Windows.MessageBoxResult.No ||</span><br><span class="line">                res == System.Windows.MessageBoxResult.Cancel)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Project.Current.SetIsEditingEnabledAsync(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="禁用编辑"><a href="#禁用编辑" class="headerlink" title="禁用编辑"></a>禁用编辑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if editing</span></span><br><span class="line"><span class="keyword">if</span> (Project.Current.IsEditingEnabled)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> res = MessageBox.Show(<span class="string">&quot;Do you want to disable editing? Editing tools will be disabled&quot;</span>,</span><br><span class="line">                                                         <span class="string">&quot;Disable Editing?&quot;</span>, System.Windows.MessageBoxButton.YesNoCancel);</span><br><span class="line">  <span class="keyword">if</span> (res == System.Windows.MessageBoxResult.No ||</span><br><span class="line">                res == System.Windows.MessageBoxResult.Cancel)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//we must check for edits</span></span><br><span class="line">  <span class="keyword">if</span> (Project.Current.HasEdits)</span><br><span class="line">  &#123;</span><br><span class="line">    res = MessageBox.Show(<span class="string">&quot;Save edits?&quot;</span>, <span class="string">&quot;Save Edits?&quot;</span>, System.Windows.MessageBoxButton.YesNoCancel);</span><br><span class="line">    <span class="keyword">if</span> (res == System.Windows.MessageBoxResult.Cancel)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (res == System.Windows.MessageBoxResult.No)</span><br><span class="line">      Project.Current.DiscardEditsAsync();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      Project.Current.SaveEditsAsync();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Project.Current.SetIsEditingEnabledAsync(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地图拓扑"><a href="#地图拓扑" class="headerlink" title="地图拓扑"></a>地图拓扑</h2><h3 id="构建地图拓扑"><a href="#构建地图拓扑" class="headerlink" title="构建地图拓扑"></a>构建地图拓扑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">BuildGraphWithActiveView</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Build the map topology graph</span></span><br><span class="line">    MapView.Active.BuildMapTopologyGraph&lt;TopologyDefinition&gt;(<span class="keyword">async</span> topologyGraph =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Getting the nodes and edges present in the graph</span></span><br><span class="line">      <span class="keyword">var</span> topologyGraphNodes = topologyGraph.GetNodes();</span><br><span class="line">      <span class="keyword">var</span> topologyGraphEdges = topologyGraph.GetEdges();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> node <span class="keyword">in</span> topologyGraphNodes)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// do something with the node</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> edge <span class="keyword">in</span> topologyGraphEdges)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// do something with the edge</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      MessageBox.Show(<span class="string">$&quot;Number of topo graph nodes are:  <span class="subst">&#123;topologyGraphNodes.Count&#125;</span>.\n Number of topo graph edges are <span class="subst">&#123;topologyGraphEdges.Count&#125;</span>.&quot;</span>, <span class="string">&quot;Map Topology Info&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="行事件"><a href="#行事件" class="headerlink" title="行事件"></a>行事件</h2><h3 id="订阅行事件"><a href="#订阅行事件" class="headerlink" title="订阅行事件"></a>订阅行事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SubscribeRowEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Listen for row events on a layer</span></span><br><span class="line">    <span class="keyword">var</span> featLayer = MapView.Active.GetSelectedLayers().First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">    <span class="keyword">var</span> layerTable = featLayer.GetTable();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//subscribe to row events</span></span><br><span class="line">    <span class="keyword">var</span> rowCreateToken = RowCreatedEvent.Subscribe(OnRowCreated, layerTable);</span><br><span class="line">    <span class="keyword">var</span> rowChangeToken = RowChangedEvent.Subscribe(OnRowChanged, layerTable);</span><br><span class="line">    <span class="keyword">var</span> rowDeleteToken = RowDeletedEvent.Subscribe(OnRowDeleted, layerTable);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnRowCreated</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnRowChanged</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnRowDeleted</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在行事件中的映射中的单独表中创建记录"><a href="#在行事件中的映射中的单独表中创建记录" class="headerlink" title="在行事件中的映射中的单独表中创建记录"></a>在行事件中的映射中的单独表中创建记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use the EditOperation in the RowChangedEventArgs to append actions to be executed. </span></span><br><span class="line"><span class="comment">//  Your actions will become part of the operation and combined into one item on the undo stack</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HookRowCreatedEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// subscribe to the RowCreatedEvent</span></span><br><span class="line">  Table table = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault().GetTable();</span><br><span class="line">  RowCreatedEvent.Subscribe(MyRowCreatedEvent, table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MyRowCreatedEvent</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the edit operation</span></span><br><span class="line">  <span class="keyword">var</span> parentEditOp = args.Operation;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set up some attributes</span></span><br><span class="line">  <span class="keyword">var</span> attribs = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt; &#123; &#125;;</span><br><span class="line">  attribs.Add(<span class="string">&quot;Layer&quot;</span>, <span class="string">&quot;Parcels&quot;</span>);</span><br><span class="line">  attribs.Add(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;OID: &quot;</span> + args.Row.GetObjectID().ToString() + <span class="string">&quot; &quot;</span> + DateTime.Now.ToShortTimeString());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//create a record in an audit table</span></span><br><span class="line">  <span class="keyword">var</span> sTable = MapView.Active.Map.FindStandaloneTables(<span class="string">&quot;EditHistory&quot;</span>).First();</span><br><span class="line">  <span class="keyword">var</span> table = sTable.GetTable();</span><br><span class="line">  parentEditOp.Create(table, attribs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在行事件中的单独表中创建记录"><a href="#在行事件中的单独表中创建记录" class="headerlink" title="在行事件中的单独表中创建记录"></a>在行事件中的单独表中创建记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use the EditOperation in the RowChangedEventArgs to append actions to be executed. </span></span><br><span class="line"><span class="comment">//  Your actions will become part of the operation and combined into one item on the undo stack</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HookCreatedEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// subscribe to the RowCreatedEvent</span></span><br><span class="line">  Table table = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault().GetTable();</span><br><span class="line">  RowCreatedEvent.Subscribe(OnRowCreatedEvent, table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnRowCreatedEvent</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// update a separate table not in the map when a row is created</span></span><br><span class="line">  <span class="comment">// You MUST use the ArcGIS.Core.Data API to edit the table. Do NOT</span></span><br><span class="line">  <span class="comment">// use a new edit operation in the RowEvent callbacks</span></span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the edit operation</span></span><br><span class="line">    <span class="keyword">var</span> parentEditOp = args.Operation;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set up some attributes</span></span><br><span class="line">    <span class="keyword">var</span> attribs = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt; &#123; &#125;;</span><br><span class="line">    attribs.Add(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;OID: &quot;</span> + args.Row.GetObjectID().ToString() + <span class="string">&quot; &quot;</span> + DateTime.Now.ToShortTimeString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update Notes table with information about the new feature</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> geoDatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(Project.Current.DefaultGeodatabasePath))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> table = geoDatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;Notes&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        parentEditOp.Create(table, attribs);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception e)</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBox.Show(<span class="string">$@&quot;Error in OnRowCreated for OID: <span class="subst">&#123;args.Row.GetObjectID()&#125;</span> : <span class="subst">&#123;e.ToString()&#125;</span>&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改行事件中的记录-使用-Row-Store"><a href="#修改行事件中的记录-使用-Row-Store" class="headerlink" title="修改行事件中的记录 - 使用 Row.Store"></a>修改行事件中的记录 - 使用 Row.Store</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HookRowChangedEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// subscribe to the RowChangedEvent</span></span><br><span class="line">  Table table = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault().GetTable();</span><br><span class="line">  RowChangedEvent.Subscribe(OnRowChangedEvent, table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Guid _currentRowChangedGuid = Guid.Empty;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnRowChangedEvent</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> row = args.Row;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check for re-entry  (only if row.Store is called)</span></span><br><span class="line">  <span class="keyword">if</span> (_currentRowChangedGuid == args.Guid)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fldIdx = row.FindField(<span class="string">&quot;POLICE_DISTRICT&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (fldIdx != <span class="number">-1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Validate any change to �police district�</span></span><br><span class="line">    <span class="comment">//   cancel the edit if validation on the field fails</span></span><br><span class="line">    <span class="keyword">if</span> (row.HasValueChanged(fldIdx))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// cancel edit with invalid district (5)</span></span><br><span class="line">      <span class="keyword">var</span> <span class="keyword">value</span> = row[<span class="string">&quot;POLICE_DISTRICT&quot;</span>].ToString();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">value</span> == <span class="string">&quot;5&quot;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Cancel edits with invalid �police district� values</span></span><br><span class="line">        args.CancelEdit(<span class="string">$&quot;Police district <span class="subst">&#123;row[<span class="string">&quot;POLICE_DISTRICT&quot;</span>]&#125;</span> is invalid&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update the description field</span></span><br><span class="line">    row[<span class="string">&quot;Description&quot;</span>] = <span class="string">&quot;Row Changed&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  this update with cause another OnRowChanged event to occur</span></span><br><span class="line">    <span class="comment">//  keep track of the row guid to avoid recursion</span></span><br><span class="line">    _currentRowChangedGuid = args.Guid;</span><br><span class="line">    row.Store();</span><br><span class="line">    _currentRowChangedGuid = Guid.Empty;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改行事件中的记录-使用-EditOperation-Modify"><a href="#修改行事件中的记录-使用-EditOperation-Modify" class="headerlink" title="修改行事件中的记录 - 使用 EditOperation.Modify"></a>修改行事件中的记录 - 使用 EditOperation.Modify</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HookChangedEvent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// subscribe to the RowChangedEvent</span></span><br><span class="line">  Table table = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault().GetTable();</span><br><span class="line">  RowChangedEvent.Subscribe(MyRowChangedEvent, table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MyRowChangedEvent</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//example of modifying a field on a row that has been created</span></span><br><span class="line">  <span class="keyword">var</span> parentEditOp = args.Operation;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// avoid recursion</span></span><br><span class="line">  <span class="keyword">if</span> (_lastEdit != args.Guid)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//update field on change</span></span><br><span class="line">    parentEditOp.Modify(args.Row, <span class="string">&quot;ZONING&quot;</span>, <span class="string">&quot;New&quot;</span>);</span><br><span class="line"></span><br><span class="line">    _lastEdit = args.Guid;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="确定编辑时几何图形是否更改"><a href="#确定编辑时几何图形是否更改" class="headerlink" title="确定编辑时几何图形是否更改"></a>确定编辑时几何图形是否更改</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> FeatureLayer featureLayer;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DetermineGeometryChange</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  featureLayer = MapView.Active?.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (featureLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Listen to the RowChangedEvent that occurs when a Row is changed.</span></span><br><span class="line">    ArcGIS.Desktop.Editing.Events.RowChangedEvent.Subscribe(OnRowChangedEvent2, featureLayer.GetTable());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnRowChangedEvent2</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">  <span class="keyword">var</span> lyrDefn = featureLayer.GetFeatureClass().GetDefinition();</span><br><span class="line">  <span class="comment">//Get the shape field of the feature class</span></span><br><span class="line">  <span class="built_in">string</span> shapeField = lyrDefn.GetShapeField();</span><br><span class="line">  <span class="comment">//Index of the shape field</span></span><br><span class="line">  <span class="keyword">var</span> shapeIndex = lyrDefn.FindField(shapeField);</span><br><span class="line">  <span class="comment">//Original geometry of the modified row</span></span><br><span class="line">  <span class="keyword">var</span> geomOrig = args.Row.GetOriginalValue(shapeIndex) <span class="keyword">as</span> Geometry;</span><br><span class="line">  <span class="comment">//New geometry of the modified row</span></span><br><span class="line">  <span class="keyword">var</span> geomNew = args.Row[shapeIndex] <span class="keyword">as</span> Geometry;</span><br><span class="line">  <span class="comment">//Compare the two</span></span><br><span class="line">  <span class="built_in">bool</span> shapeChanged = geomOrig.IsEqual(geomNew);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="取消删除"><a href="#取消删除" class="headerlink" title="取消删除"></a>取消删除</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StopADelete</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// subscribe to the RowDeletedEvent for the appropriate table</span></span><br><span class="line">  Table table = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault().GetTable();</span><br><span class="line">  RowDeletedEvent.Subscribe(OnRowDeletedEvent, table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnRowDeletedEvent</span>(<span class="params">RowChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// RowEvent callbacks are always called on the QueuedTask so there is no need </span></span><br><span class="line">  <span class="comment">// to wrap your code within a QueuedTask.Run lambda.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> row = args.Row;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cancel the delete if the feature is in Police District 5</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fldIdx = row.FindField(<span class="string">&quot;POLICE_DISTRICT&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (fldIdx != <span class="number">-1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">value</span> = row[fldIdx].ToString();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">value</span> == <span class="string">&quot;5&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//cancel with dialog</span></span><br><span class="line">      <span class="comment">// Note - feature edits on Hosted and Standard Feature Services cannot be cancelled.</span></span><br><span class="line">      args.CancelEdit(<span class="string">&quot;Delete Event\nAre you sure&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// or cancel without a dialog</span></span><br><span class="line">      <span class="comment">// args.CancelEdit();</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编辑已完成事件"><a href="#编辑已完成事件" class="headerlink" title="编辑已完成事件"></a>编辑已完成事件</h2><h3 id="订阅编辑已完成事件"><a href="#订阅编辑已完成事件" class="headerlink" title="订阅编辑已完成事件"></a>订阅编辑已完成事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subEditEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//subscribe to editcompleted</span></span><br><span class="line">  <span class="keyword">var</span> eceToken = EditCompletedEvent.Subscribe(onEce);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Task <span class="title">onEce</span>(<span class="params">EditCompletedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//show number of edits</span></span><br><span class="line">  Console.WriteLine(<span class="string">&quot;Creates: &quot;</span> + args.Creates.ToDictionary().Values.Sum(list =&gt; list.Count).ToString());</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;Modifies: &quot;</span> + args.Modifies.ToDictionary().Values.Sum(list =&gt; list.Count).ToString());</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;Deletes: &quot;</span> + args.Deletes.ToDictionary().Values.Sum(list =&gt; list.Count).ToString());</span><br><span class="line">  <span class="keyword">return</span> Task.FromResult(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查员"><a href="#检查员" class="headerlink" title="检查员"></a>检查员</h2><h3 id="将要素从图层加载到检查器中"><a href="#将要素从图层加载到检查器中" class="headerlink" title="将要素从图层加载到检查器中"></a>将要素从图层加载到检查器中</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the first feature layer in the map</span></span><br><span class="line"><span class="keyword">var</span> firstFeatureLayer = ArcGIS.Desktop.Mapping.MapView.Active.Map.GetLayersAsFlattenedList().</span><br><span class="line">    OfType&lt;ArcGIS.Desktop.Mapping.FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an instance of the inspector class</span></span><br><span class="line"><span class="keyword">var</span> inspector = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line"><span class="comment">// load the feature with ObjectID &#x27;oid&#x27; into the inspector</span></span><br><span class="line"><span class="keyword">await</span> inspector.LoadAsync(firstFeatureLayer, oid);</span><br></pre></td></tr></table></figure>

<h3 id="将地图选择加载到检查器中"><a href="#将地图选择加载到检查器中" class="headerlink" title="将地图选择加载到检查器中"></a>将地图选择加载到检查器中</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the currently selected features in the map</span></span><br><span class="line"><span class="keyword">var</span> selectedFeatures = ArcGIS.Desktop.Mapping.MapView.Active.Map.GetSelection();</span><br><span class="line"><span class="comment">// get the first layer and its corresponding selected feature OIDs</span></span><br><span class="line"><span class="keyword">var</span> firstSelectionSet = selectedFeatures.ToDictionary().First();</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an instance of the inspector class</span></span><br><span class="line"><span class="keyword">var</span> inspector = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line"><span class="comment">// load the selected features into the inspector using a list of object IDs</span></span><br><span class="line"><span class="keyword">await</span> inspector.LoadAsync(firstSelectionSet.Key, firstSelectionSet.Value);</span><br></pre></td></tr></table></figure>

<h3 id="获取所选要素的属性值"><a href="#获取所选要素的属性值" class="headerlink" title="获取所选要素的属性值"></a>获取所选要素的属性值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the currently selected features in the map</span></span><br><span class="line">  <span class="keyword">var</span> selectedFeatures = ArcGIS.Desktop.Mapping.MapView.Active.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the first layer and its corresponding selected feature OIDs</span></span><br><span class="line">  <span class="keyword">var</span> firstSelectionSet = selectedFeatures.ToDictionary().First();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create an instance of the inspector class</span></span><br><span class="line">  <span class="keyword">var</span> inspector = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load the selected features into the inspector using a list of object IDs</span></span><br><span class="line">  inspector.Load(firstSelectionSet.Key, firstSelectionSet.Value);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//get the value of</span></span><br><span class="line">  <span class="keyword">var</span> pscode = inspector[<span class="string">&quot;STATE_NAME&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> myGeometry = inspector.Shape;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将地图选择加载到检查器并更改属性"><a href="#将地图选择加载到检查器并更改属性" class="headerlink" title="将地图选择加载到检查器并更改属性"></a>将地图选择加载到检查器并更改属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the currently selected features in the map</span></span><br><span class="line"><span class="keyword">var</span> selectedFeatures = ArcGIS.Desktop.Mapping.MapView.Active.Map.GetSelection();</span><br><span class="line"><span class="comment">// get the first layer and its corresponding selected feature OIDs</span></span><br><span class="line"><span class="keyword">var</span> firstSelectionSet = selectedFeatures.ToDictionary().First();</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an instance of the inspector class</span></span><br><span class="line"><span class="keyword">var</span> inspector = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line"><span class="comment">// load the selected features into the inspector using a list of object IDs</span></span><br><span class="line"><span class="keyword">await</span> inspector.LoadAsync(firstSelectionSet.Key, firstSelectionSet.Value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign the new attribute value to the field &quot;Description&quot;</span></span><br><span class="line"><span class="comment">// if more than one features are loaded, the change applies to all features</span></span><br><span class="line">inspector[<span class="string">&quot;Description&quot;</span>] = <span class="string">&quot;The new value.&quot;</span>;</span><br><span class="line"><span class="comment">// apply the changes as an edit operation - but with no undo/redo</span></span><br><span class="line"><span class="keyword">await</span> inspector.ApplyAsync();</span><br></pre></td></tr></table></figure>

<h3 id="使用检查器获取图层方案"><a href="#使用检查器获取图层方案" class="headerlink" title="使用检查器获取图层方案"></a>使用检查器获取图层方案</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> firstFeatureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ArcGIS.Desktop.Mapping.FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create an instance of the inspector class</span></span><br><span class="line">  <span class="keyword">var</span> inspector = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load the layer</span></span><br><span class="line">  inspector.LoadSchema(firstFeatureLayer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// iterate through the attributes, looking at properties</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> attribute <span class="keyword">in</span> inspector)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fldName = attribute.FieldName;</span><br><span class="line">    <span class="keyword">var</span> fldAlias = attribute.FieldAlias;</span><br><span class="line">    <span class="keyword">var</span> fldType = attribute.FieldType;</span><br><span class="line">    <span class="built_in">int</span> idxFld = attribute.FieldIndex;</span><br><span class="line">    <span class="keyword">var</span> fld = attribute.GetField();</span><br><span class="line">    <span class="keyword">var</span> isNullable = attribute.IsNullable;</span><br><span class="line">    <span class="keyword">var</span> isEditable = attribute.IsEditable;</span><br><span class="line">    <span class="keyword">var</span> isVisible = attribute.IsVisible;</span><br><span class="line">    <span class="keyword">var</span> isSystemField = attribute.IsSystemField;</span><br><span class="line">    <span class="keyword">var</span> isGeometryField = attribute.IsGeometryField;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查器-添加验证"><a href="#检查器-添加验证" class="headerlink" title="检查器.添加验证"></a>检查器.添加验证</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">insp.LoadSchema(featLayer);</span><br><span class="line"><span class="keyword">var</span> attrib = insp.Where(a =&gt; a.FieldName == <span class="string">&quot;Mineral&quot;</span>).First();</span><br><span class="line"></span><br><span class="line">attrib.AddValidate(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (attrib.CurrentValue.ToString() == <span class="string">&quot;Salt&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> Enumerable.Empty&lt;ArcGIS.Desktop.Editing.Attributes.Attribute.ValidationError&gt;();</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">new</span>[] &#123; ArcGIS.Desktop.Editing.Attributes.Attribute.ValidationError.Create(<span class="string">&quot;Error&quot;</span>, ArcGIS.Desktop.Editing.Attributes.Severity.Low) &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="访问-Blob-字段"><a href="#访问-Blob-字段" class="headerlink" title="访问 Blob 字段"></a>访问 Blob 字段</h2><h3 id="使用属性检查器读取和写入-Blob-字段"><a href="#使用属性检查器读取和写入-Blob-字段" class="headerlink" title="使用属性检查器读取和写入 Blob 字段"></a>使用属性检查器读取和写入 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//get selected feature into inspector</span></span><br><span class="line">  <span class="keyword">var</span> selectedFeatures = MapView.Active.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.Load(selectedFeatures.ToDictionary().Keys.First(), selectedFeatures.ToDictionary().Values.First());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//read a blob field and save to a file</span></span><br><span class="line">  <span class="keyword">var</span> msw = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">  msw = insp[<span class="string">&quot;Blobfield&quot;</span>] <span class="keyword">as</span> MemoryStream;</span><br><span class="line">  <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(<span class="string">@&quot;d:\temp\blob.jpg&quot;</span>, FileMode.Create, FileAccess.Write))</span><br><span class="line">  &#123;</span><br><span class="line">    msw.WriteTo(file);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//read file into memory stream</span></span><br><span class="line">  <span class="keyword">var</span> msr = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">  <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(<span class="string">@&quot;d:\images\Hydrant.jpg&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">  &#123;</span><br><span class="line">    file.CopyTo(msr);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//put the memory stream in the blob field and save to feature</span></span><br><span class="line">  <span class="keyword">var</span> op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;Blob Inspector&quot;</span>;</span><br><span class="line">  insp[<span class="string">&quot;Blobfield&quot;</span>] = msr;</span><br><span class="line">  op.Modify(insp);</span><br><span class="line">  op.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在回调中使用行游标读取和写入-Blob-字段"><a href="#在回调中使用行游标读取和写入-Blob-字段" class="headerlink" title="在回调中使用行游标读取和写入 Blob 字段"></a>在回调中使用行游标读取和写入 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> editOp = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  editOp.Name = <span class="string">&quot;Blob Cursor&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> featLayer = MapView.Active.Map.FindLayers(<span class="string">&quot;Hydrant&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line"></span><br><span class="line">  editOp.Callback((context) =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = featLayer.GetTable().Search(<span class="literal">null</span>, <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> <span class="keyword">record</span> = rc.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//read the blob field and save to a file</span></span><br><span class="line">          <span class="keyword">var</span> msw = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">          msw = <span class="keyword">record</span>[&quot;<span class="title">BlobField</span>&quot;] <span class="title">as</span> <span class="title">MemoryStream</span>;</span><br><span class="line">          <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(<span class="string">@&quot;d:\temp\blob.jpg&quot;</span>, FileMode.Create, FileAccess.Write))</span><br><span class="line">          &#123;</span><br><span class="line">            msw.WriteTo(file);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//read file into memory stream</span></span><br><span class="line">          <span class="keyword">var</span> msr = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">          <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(<span class="string">@&quot;d:\images\Hydrant.jpg&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">          &#123;</span><br><span class="line">            file.CopyTo(msr);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//put the memory stream in the blob field and save to feature</span></span><br><span class="line">          <span class="keyword">record</span>[&quot;<span class="title">BlobField</span>&quot;] = msr;</span><br><span class="line">          <span class="keyword">record</span>.Store();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, featLayer.GetTable());</span><br><span class="line">  editOp.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="访问栅格字段"><a href="#访问栅格字段" class="headerlink" title="访问栅格字段"></a>访问栅格字段</h2><h3 id="从栅格字段读取"><a href="#从栅格字段读取" class="headerlink" title="从栅格字段读取"></a>从栅格字段读取</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> sel = MapView.Active.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Read a raster from a raster field as an InteropBitmap</span></span><br><span class="line">  <span class="comment">//the bitmap can then be used as an imagesource or written to disk</span></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line">  insp.Load(sel.ToDictionary().Keys.First(), sel.ToDictionary().Values.First());</span><br><span class="line">  <span class="keyword">var</span> ibmp = insp[<span class="string">&quot;Photo&quot;</span>] <span class="keyword">as</span> System.Windows.Interop.InteropBitmap;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将图像写入栅格字段"><a href="#将图像写入栅格字段" class="headerlink" title="将图像写入栅格字段"></a>将图像写入栅格字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> sel = MapView.Active.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Insert an image into a raster field</span></span><br><span class="line">  <span class="comment">//Image will be written with no compression</span></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line">  insp.Load(sel.ToDictionary().Keys.First(), sel.ToDictionary().Values.First());</span><br><span class="line">  insp[<span class="string">&quot;Photo&quot;</span>] = <span class="string">@&quot;e:\temp\Hydrant.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;Raster Inspector&quot;</span>;</span><br><span class="line">  op.Modify(insp);</span><br><span class="line">  op.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将压缩图像写入栅格字段"><a href="#将压缩图像写入栅格字段" class="headerlink" title="将压缩图像写入栅格字段"></a>将压缩图像写入栅格字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Open the raster dataset on disk and create a compressed raster value dataset object</span></span><br><span class="line">  <span class="keyword">var</span> dataStore = <span class="keyword">new</span> ArcGIS.Core.Data.FileSystemDatastore(<span class="keyword">new</span> ArcGIS.Core.Data.FileSystemConnectionPath(<span class="keyword">new</span> System.Uri(<span class="string">@&quot;e:\temp&quot;</span>), ArcGIS.Core.Data.FileSystemDatastoreType.Raster));</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> fileRasterDataset = dataStore.OpenDataset&lt;ArcGIS.Core.Data.Raster.RasterDataset&gt;(<span class="string">&quot;Hydrant.jpg&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> storageDef = <span class="keyword">new</span> ArcGIS.Core.Data.Raster.RasterStorageDef();</span><br><span class="line">    storageDef.SetCompressionType(ArcGIS.Core.Data.Raster.RasterCompressionType.JPEG);</span><br><span class="line">    storageDef.SetCompressionQuality(<span class="number">90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rv = <span class="keyword">new</span> ArcGIS.Core.Data.Raster.RasterValue();</span><br><span class="line">    rv.SetRasterDataset(fileRasterDataset);</span><br><span class="line">    rv.SetRasterStorageDef(storageDef);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sel = MapView.Active.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//insert a raster value object into the raster field</span></span><br><span class="line">    <span class="keyword">var</span> insp = <span class="keyword">new</span> ArcGIS.Desktop.Editing.Attributes.Inspector();</span><br><span class="line">    insp.Load(sel.ToDictionary().Keys.First(), sel.ToDictionary().Values.First());</span><br><span class="line">    insp[<span class="string">&quot;Photo&quot;</span>] = rv;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">    op.Name = <span class="string">&quot;Raster Inspector&quot;</span>;</span><br><span class="line">    op.Modify(insp);</span><br><span class="line">    op.Execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用草图"><a href="#使用草图" class="headerlink" title="使用草图"></a>使用草图</h2><h3 id="切换草图选择模式"><a href="#切换草图选择模式" class="headerlink" title="切换草图选择模式"></a>切换草图选择模式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UseSelection = true; (UseSelection must be set to true in the tool constructor or tool activate)</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span> _inSelMode = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsShiftKey</span>(<span class="params">MapViewKeyEventArgs k</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (k.Key == System.Windows.Input.Key.LeftShift ||</span><br><span class="line">         k.Key == System.Windows.Input.Key.RightShift);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnToolKeyDown</span>(<span class="params">MapViewKeyEventArgs k</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//toggle sketch selection mode with a custom key</span></span><br><span class="line">  <span class="keyword">if</span> (k.Key == System.Windows.Input.Key.W)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_inSelMode)</span><br><span class="line">    &#123;</span><br><span class="line">      k.Handled = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Toggle the tool to select mode.</span></span><br><span class="line">      <span class="comment">//  The sketch is saved if UseSelection = true;</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> ActivateSelectAsync(<span class="literal">true</span>))</span><br><span class="line">        _inSelMode = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (!_inSelMode)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//disable effect of Shift in the base class.</span></span><br><span class="line">    <span class="comment">//Mark the key event as handled to prevent further processing</span></span><br><span class="line">    k.Handled = IsShiftKey(k);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolKeyUp</span>(<span class="params">MapViewKeyEventArgs k</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (k.Key == System.Windows.Input.Key.W)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (_inSelMode)</span><br><span class="line">    &#123;</span><br><span class="line">      _inSelMode = <span class="literal">false</span>;</span><br><span class="line">      k.Handled = <span class="literal">true</span>;<span class="comment">//process this one</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Toggle back to sketch mode. If UseSelection = true</span></span><br><span class="line">      <span class="comment">//   the sketch will be restored</span></span><br><span class="line">      ActivateSelectAsync(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (_inSelMode)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//disable effect of Shift in the base class.</span></span><br><span class="line">    <span class="comment">//Mark the key event as handled to prevent further processing</span></span><br><span class="line">    k.Handled = IsShiftKey(k);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="聆听草图修改事件"><a href="#聆听草图修改事件" class="headerlink" title="聆听草图修改事件"></a>聆听草图修改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SketchModified event is fired by </span></span><br><span class="line"><span class="comment">//  - COTS construction tools (except annotation, dimension geometry types), </span></span><br><span class="line"><span class="comment">//  - Edit Vertices, Reshape, Align Features</span></span><br><span class="line"><span class="comment">//  - 3rd party tools with FireSketchEvents = true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Subscribe the sketch modified event</span></span><br><span class="line"><span class="comment">//ArcGIS.Desktop.Mapping.Events.SketchModifiedEvent.Subscribe(OnSketchModified);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSketchModified</span>(<span class="params">ArcGIS.Desktop.Mapping.Events.SketchModifiedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// if not an undo operation</span></span><br><span class="line">  <span class="keyword">if</span> (!args.IsUndo)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// what was the sketch before the change?</span></span><br><span class="line">    <span class="keyword">var</span> prevSketch = args.PreviousSketch;</span><br><span class="line">    <span class="comment">// what is the current sketch?</span></span><br><span class="line">    <span class="keyword">var</span> currentSketch = args.CurrentSketch;</span><br><span class="line">    <span class="keyword">if</span> (currentSketch <span class="keyword">is</span> Polyline polyline)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Examine the current (last) vertex in the line sketch</span></span><br><span class="line">      <span class="keyword">var</span> lastSketchPoint = polyline.Points.Last();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// do something with the last point</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收听草图完成前事件并修改草图"><a href="#收听草图完成前事件并修改草图" class="headerlink" title="收听草图完成前事件并修改草图"></a>收听草图完成前事件并修改草图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BeforeSketchCompleted event is fired by </span></span><br><span class="line"><span class="comment">//  - COTS construction tools (except annotation, dimension geometry types), </span></span><br><span class="line"><span class="comment">//  - Edit Vertices, Reshape, Align Features</span></span><br><span class="line"><span class="comment">//  - 3rd party tools with FireSketchEvents = true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Subscribe to the before sketch completed event</span></span><br><span class="line"><span class="comment">//ArcGIS.Desktop.Mapping.Events.BeforeSketchCompletedEvent.Subscribe(OnBeforeSketchCompleted);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Task <span class="title">OnBeforeSketchCompleted</span>(<span class="params">BeforeSketchCompletedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//assign sketch Z values from default surface and set the sketch geometry</span></span><br><span class="line">  <span class="keyword">var</span> modifiedSketch = args.MapView.Map.GetZsFromSurfaceAsync(args.Sketch).Result;</span><br><span class="line">  args.SetSketchGeometry(modifiedSketch.Geometry);</span><br><span class="line">  <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收听草图完成事件"><a href="#收听草图完成事件" class="headerlink" title="收听草图完成事件"></a>收听草图完成事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SketchCompleted event is fired by </span></span><br><span class="line"><span class="comment">//  - COTS construction tools (except annotation, dimension geometry types), </span></span><br><span class="line"><span class="comment">//  - Edit Vertices, Reshape, Align Features</span></span><br><span class="line"><span class="comment">//  - 3rd party tools with FireSketchEvents = true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Subscribe to the sketch completed event</span></span><br><span class="line"><span class="comment">//ArcGIS.Desktop.Mapping.Events.SketchCompletedEvent.Subscribe(OnSketchCompleted);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSketchCompleted</span>(<span class="params">SketchCompletedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the sketch</span></span><br><span class="line">  <span class="keyword">var</span> finalSketch = args.Sketch;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// do something with the sketch - audit trail perhaps</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="触发草图事件的自定义构造工具"><a href="#触发草图事件的自定义构造工具" class="headerlink" title="触发草图事件的自定义构造工具"></a>触发草图事件的自定义构造工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">ConstructionTool1</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConstructionTool1</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    IsSketchTool = <span class="literal">true</span>;</span><br><span class="line">    UseSnapping = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// Select the type of construction tool you wish to implement.  </span></span><br><span class="line">    <span class="comment">// Make sure that the tool is correctly registered with the correct component category type in the daml </span></span><br><span class="line">    SketchType = SketchGeometryType.Line;</span><br><span class="line">    <span class="comment">//Gets or sets whether the sketch is for creating a feature and should use the CurrentTemplate.</span></span><br><span class="line">    UsesCurrentTemplate = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set FireSketchEvents property to true</span></span><br><span class="line">    FireSketchEvents = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义自定义草图工具的草图符号"><a href="#自定义自定义草图工具的草图符号" class="headerlink" title="自定义自定义草图工具的草图符号"></a>自定义自定义草图工具的草图符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Custom tools have the ability to change the symbology used when sketching a new feature. </span></span><br><span class="line"><span class="comment">//Both the Sketch Segment Symbol and the Vertex Symbol can be modified using the correct set method. </span></span><br><span class="line"><span class="comment">//This is set in the activate method for the tool.</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">OnToolActivateAsync</span>(<span class="params"><span class="built_in">bool</span> active</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Getting the current symbology options of the segment</span></span><br><span class="line">    <span class="keyword">var</span> segmentOptions = GetSketchSegmentSymbolOptions();</span><br><span class="line">    <span class="comment">//Modifying the primary and secondary color and the width of the segment symbology options</span></span><br><span class="line">    <span class="keyword">var</span> deepPurple = <span class="keyword">new</span> CIMRGBColor();</span><br><span class="line">    deepPurple.R = <span class="number">75</span>;</span><br><span class="line">    deepPurple.G = <span class="number">0</span>;</span><br><span class="line">    deepPurple.B = <span class="number">110</span>;</span><br><span class="line">    segmentOptions.PrimaryColor = deepPurple;</span><br><span class="line">    segmentOptions.Width = <span class="number">4</span>;</span><br><span class="line">    segmentOptions.HasSecondaryColor = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> pink = <span class="keyword">new</span> CIMRGBColor();</span><br><span class="line">    pink.R = <span class="number">219</span>;</span><br><span class="line">    pink.G = <span class="number">48</span>;</span><br><span class="line">    pink.B = <span class="number">130</span>;</span><br><span class="line">    segmentOptions.SecondaryColor = pink;</span><br><span class="line">    <span class="comment">//Creating a new vertex symbol options instance with the values you want</span></span><br><span class="line">    <span class="keyword">var</span> vertexOptions = <span class="keyword">new</span> VertexSymbolOptions(VertexSymbolType.RegularUnselected);</span><br><span class="line">    <span class="keyword">var</span> yellow = <span class="keyword">new</span> CIMRGBColor();</span><br><span class="line">    yellow.R = <span class="number">255</span>;</span><br><span class="line">    yellow.G = <span class="number">215</span>;</span><br><span class="line">    yellow.B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> purple = <span class="keyword">new</span> CIMRGBColor();</span><br><span class="line">    purple.R = <span class="number">148</span>;</span><br><span class="line">    purple.G = <span class="number">0</span>;</span><br><span class="line">    purple.B = <span class="number">211</span>;</span><br><span class="line">    vertexOptions.AngleRotation = <span class="number">45</span>;</span><br><span class="line">    vertexOptions.Color = yellow;</span><br><span class="line">    vertexOptions.MarkerType = VertexMarkerType.Star;</span><br><span class="line">    vertexOptions.OutlineColor = purple;</span><br><span class="line">    vertexOptions.OutlineWidth = <span class="number">3</span>;</span><br><span class="line">    vertexOptions.Size = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Setting the value of the segment symbol options</span></span><br><span class="line">    SetSketchSegmentSymbolOptions(segmentOptions);</span><br><span class="line">    <span class="comment">//Setting the value of the vertex symbol options of the regular unselected vertices using the vertexOptions instance created above.</span></span><br><span class="line">    SetSketchVertexSymbolOptions(VertexSymbolType.RegularUnselected, vertexOptions);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">base</span>.OnToolActivateAsync(active);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="捕捉"><a href="#捕捉" class="headerlink" title="捕捉"></a>捕捉</h2><h3 id="配置捕捉-打开或关闭捕捉"><a href="#配置捕捉-打开或关闭捕捉" class="headerlink" title="配置捕捉 - 打开或关闭捕捉"></a>配置捕捉 - 打开或关闭捕捉</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//enable snapping</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.IsEnabled = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// disable snapping</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.IsEnabled = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="配置捕捉-应用程序捕捉模式"><a href="#配置捕捉-应用程序捕捉模式" class="headerlink" title="配置捕捉 - 应用程序捕捉模式"></a>配置捕捉 - 应用程序捕捉模式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set only Point and Edge snapping modes, clear everything else</span></span><br><span class="line"><span class="comment">//At 2.x - ArcGIS.Desktop.Mapping.Snapping.SetSnapModes(SnapMode.Point, SnapMode.Edge);</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapModes(</span><br><span class="line">  <span class="keyword">new</span> List&lt;SnapMode&gt;() &#123; SnapMode.Point, SnapMode.Edge &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// clear all snap modes</span></span><br><span class="line"><span class="comment">//At 2.x - ArcGIS.Desktop.Mapping.Snapping.SetSnapModes();</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapModes(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// set snap modes one at a time</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapMode(SnapMode.Edge, <span class="literal">true</span>);</span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapMode(SnapMode.End, <span class="literal">true</span>);</span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapMode(SnapMode.Intersection, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get current snap modes</span></span><br><span class="line"><span class="keyword">var</span> snapModes = ArcGIS.Desktop.Mapping.Snapping.SnapModes;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get state of a specific snap mode</span></span><br><span class="line"><span class="built_in">bool</span> isOn = ArcGIS.Desktop.Mapping.Snapping.GetSnapMode(SnapMode.Vertex);</span><br></pre></td></tr></table></figure>

<h3 id="配置捕捉-图层捕捉可捕捉性"><a href="#配置捕捉-图层捕捉可捕捉性" class="headerlink" title="配置捕捉 - 图层捕捉可捕捉性"></a>配置捕捉 - 图层捕捉可捕捉性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// is the layer snappable?</span></span><br><span class="line"><span class="built_in">bool</span> isSnappable = fLayer.IsSnappable;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set snappability for a specific layer - needs to run on the MCT</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// use an extension method</span></span><br><span class="line">  fLayer.SetSnappable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// or use the CIM directly</span></span><br><span class="line">  <span class="comment">//var layerDef = fLayer.GetDefinition() as ArcGIS.Core.CIM.CIMGeoFeatureLayerBase;</span></span><br><span class="line">  <span class="comment">//layerDef.Snappable = true;</span></span><br><span class="line">  <span class="comment">//fLayer.SetDefinition(layerDef);</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// turn all layers snappability off</span></span><br><span class="line">layerList = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;();</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> layer <span class="keyword">in</span> layerList)</span><br><span class="line">  &#123;</span><br><span class="line">    layer.SetSnappable(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="配置捕捉-图层捕捉模式"><a href="#配置捕捉-图层捕捉模式" class="headerlink" title="配置捕捉 - 图层捕捉模式"></a>配置捕捉 - 图层捕捉模式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">layerList = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// configure by layer</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> layer <span class="keyword">in</span> layerList)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// find the state of the snapModes for the layer</span></span><br><span class="line">  <span class="keyword">var</span> lsm = ArcGIS.Desktop.Mapping.Snapping.GetLayerSnapModes(layer);</span><br><span class="line">  <span class="built_in">bool</span> vertexOn = lsm.Vertex;</span><br><span class="line">  <span class="comment">// or use </span></span><br><span class="line">  vertexOn = lsm.GetSnapMode(SnapMode.Vertex);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> edgeOn = lsm.Edge;</span><br><span class="line">  <span class="comment">// or use </span></span><br><span class="line">  edgeOn = lsm.GetSnapMode(SnapMode.Edge);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> endOn = lsm.End;</span><br><span class="line">  <span class="comment">// or use </span></span><br><span class="line">  endOn = lsm.GetSnapMode(SnapMode.End);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update a few snapModes </span></span><br><span class="line">  <span class="comment">//   turn Vertex off</span></span><br><span class="line">  lsm.SetSnapMode(SnapMode.Vertex, <span class="literal">false</span>);</span><br><span class="line">  <span class="comment">// intersections on</span></span><br><span class="line">  lsm.SetSnapMode(SnapMode.Intersection, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// and set back to the layer</span></span><br><span class="line">  ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layer, lsm);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// assign a single snap mode at once</span></span><br><span class="line">  ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layer, SnapMode.Vertex, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// turn ALL snapModes on</span></span><br><span class="line">  ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layer, <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// turn ALL snapModes off</span></span><br><span class="line">  ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layer, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// configure for a set of layers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set Vertex, edge, end on for a set of layers, other snapModes false</span></span><br><span class="line"><span class="keyword">var</span> vee = <span class="keyword">new</span> LayerSnapModes(<span class="literal">false</span>);</span><br><span class="line">vee.Vertex = <span class="literal">true</span>;</span><br><span class="line">vee.Edge = <span class="literal">true</span>;</span><br><span class="line">vee.End = <span class="literal">true</span>;</span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layerList, vee);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ensure intersection is on for a set of layers without changing any other snapModes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get the layer snapModes for the set of layers</span></span><br><span class="line"><span class="keyword">var</span> dictLSM = ArcGIS.Desktop.Mapping.Snapping.GetLayerSnapModes(layerList);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> layer <span class="keyword">in</span> dictLSM.Keys)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> lsm = dictLSM[layer];</span><br><span class="line">  lsm.Intersection = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(dictLSM);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// set all snapModes off for a list of layers</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(layerList, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="配置捕捉-组合示例"><a href="#配置捕捉-组合示例" class="headerlink" title="配置捕捉 - 组合示例"></a>配置捕捉 - 组合示例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// interested in only snapping to the vertices of a specific layer of interest and not the vertices of other layers</span></span><br><span class="line"><span class="comment">//  all other snapModes should be off.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// snapping must be on</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.IsEnabled = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// turn all application snapModes off</span></span><br><span class="line"><span class="comment">//At 2.x - ArcGIS.Desktop.Mapping.Snapping.SetSnapModes();</span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapModes(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// set application snapMode vertex on </span></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetSnapMode(SnapMode.Vertex, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ensure layer snapping is on</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  fLayer.SetSnappable(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// set vertex snapping only</span></span><br><span class="line"><span class="keyword">var</span> vertexOnly = <span class="keyword">new</span> LayerSnapModes(<span class="literal">false</span>);</span><br><span class="line">vertexOnly.Vertex = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set vertex only for the specific layer, clearing all others</span></span><br><span class="line"><span class="keyword">var</span> dict = <span class="keyword">new</span> Dictionary&lt;Layer, LayerSnapModes&gt;();</span><br><span class="line">dict.Add(fLayer, vertexOnly);</span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetLayerSnapModes(dict, <span class="literal">true</span>);  <span class="comment">// true = reset other layers</span></span><br></pre></td></tr></table></figure>

<h3 id="捕捉选项"><a href="#捕捉选项" class="headerlink" title="捕捉选项"></a>捕捉选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Set snapping options via get/set options</span></span><br><span class="line"><span class="keyword">var</span> snapOptions = ArcGIS.Desktop.Mapping.Snapping.GetOptions(myMap);</span><br><span class="line"><span class="comment">//At 2.x - snapOptions.SnapToSketchEnabled = true;</span></span><br><span class="line">snapOptions.IsSnapToSketchEnabled = <span class="literal">true</span>;</span><br><span class="line">snapOptions.XYTolerance = <span class="number">100</span>;</span><br><span class="line"><span class="comment">//At 2.x - snapOptions.ZToleranceEnabled = true;</span></span><br><span class="line">snapOptions.IsZToleranceEnabled = <span class="literal">true</span>;</span><br><span class="line">snapOptions.ZTolerance = <span class="number">0.6</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//turn on snap tip display parts</span></span><br><span class="line">snapOptions.SnapTipDisplayParts = (<span class="built_in">int</span>)SnapTipDisplayPart.SnapTipDisplayLayer + (<span class="built_in">int</span>)SnapTipDisplayPart.SnapTipDisplayType;</span><br><span class="line"></span><br><span class="line"><span class="comment">//turn off all snaptips</span></span><br><span class="line"><span class="comment">//snapOptions.SnapTipDisplayParts = (int)SnapTipDisplayPart.SnapTipDisplayNone;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//turn on layer display only</span></span><br><span class="line"><span class="comment">//snapOptions.SnapTipDisplayParts = (int)SnapTipDisplayPart.SnapTipDisplayLayer;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - snapOptions.GeometricFeedbackColor = ColorFactory.Instance.RedRGB;</span></span><br><span class="line">snapOptions.SnapTipColor = ColorFactory.Instance.RedRGB;</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Mapping.Snapping.SetOptions(myMap, snapOptions);</span><br></pre></td></tr></table></figure>

<h2 id="撤消-x2F-重做"><a href="#撤消-x2F-重做" class="headerlink" title="撤消&#x2F;重做"></a>撤消&#x2F;重做</h2><h3 id="撤消-x2F-重做最近的操作"><a href="#撤消-x2F-重做最近的操作" class="headerlink" title="撤消&#x2F;重做最近的操作"></a>撤消&#x2F;重做最近的操作</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//undo</span></span><br><span class="line"><span class="keyword">if</span> (MapView.Active.Map.OperationManager.CanUndo)</span><br><span class="line">  MapView.Active.Map.OperationManager.UndoAsync();<span class="comment">//await as needed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//redo</span></span><br><span class="line"><span class="keyword">if</span> (MapView.Active.Map.OperationManager.CanRedo)</span><br><span class="line">  MapView.Active.Map.OperationManager.RedoAsync();<span class="comment">//await as needed</span></span><br></pre></td></tr></table></figure>

<h2 id="编辑模板"><a href="#编辑模板" class="headerlink" title="编辑模板"></a>编辑模板</h2><h3 id="在图层上按名称查找编辑模板"><a href="#在图层上按名称查找编辑模板" class="headerlink" title="在图层上按名称查找编辑模板"></a>在图层上按名称查找编辑模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//get the templates</span></span><br><span class="line">  <span class="keyword">var</span> map = ArcGIS.Desktop.Mapping.MapView.Active.Map;</span><br><span class="line">  <span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> mainTemplate = map.FindLayers(<span class="string">&quot;main&quot;</span>).FirstOrDefault()?.GetTemplate(<span class="string">&quot;Distribution&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> mhTemplate = map.FindLayers(<span class="string">&quot;Manhole&quot;</span>).FirstOrDefault()?.GetTemplate(<span class="string">&quot;Active&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查找属于独立表的表模板"><a href="#查找属于独立表的表模板" class="headerlink" title="查找属于独立表的表模板"></a>查找属于独立表的表模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> map = ArcGIS.Desktop.Mapping.MapView.Active.Map;</span><br><span class="line">  <span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//Get a particular table template</span></span><br><span class="line">  <span class="keyword">var</span> tableTemplate = map.FindStandaloneTables(<span class="string">&quot;Address Points&quot;</span>).FirstOrDefault()?.GetTemplate(<span class="string">&quot;Residences&quot;</span>);</span><br><span class="line">  <span class="comment">//Get all the templates of a standalone table</span></span><br><span class="line">  <span class="keyword">var</span> ownersTableTemplates = map.FindStandaloneTables(<span class="string">&quot;Owners&quot;</span>).FirstOrDefault()?.GetTemplates();</span><br><span class="line">  <span class="keyword">var</span> statisticsTableTemplates = MapView.Active.Map.GetStandaloneTablesAsFlattenedList().First(l =&gt; l.Name.Equals(<span class="string">&quot;Trading Statistics&quot;</span>)).GetTemplates();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="当前模板"><a href="#当前模板" class="headerlink" title="当前模板"></a>当前模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EditingTemplate template = EditingTemplate.Current;</span><br></pre></td></tr></table></figure>

<h3 id="更改模板的默认编辑工具"><a href="#更改模板的默认编辑工具" class="headerlink" title="更改模板的默认编辑工具"></a>更改模板的默认编辑工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">ChangeTemplateDefaultToolAsync</span>(<span class="params">ArcGIS.Desktop.Mapping.FeatureLayer flayer,</span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="built_in">string</span> toolContentGUID, <span class="built_in">string</span> templateName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// retrieve the edit template form the layer by name</span></span><br><span class="line">    <span class="keyword">var</span> template = flayer?.GetTemplate(templateName) <span class="keyword">as</span> ArcGIS.Desktop.Editing.Templates.EditingTemplate;</span><br><span class="line">    <span class="comment">// get the definition of the layer</span></span><br><span class="line">    <span class="keyword">var</span> layerDef = flayer?.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMFeatureLayer;</span><br><span class="line">    <span class="keyword">if</span> ((template == <span class="literal">null</span>) || (layerDef == <span class="literal">null</span>))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (template.DefaultToolID != <span class="keyword">this</span>.ID)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">bool</span> updateLayerDef = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (layerDef.AutoGenerateFeatureTemplates)</span><br><span class="line">      &#123;</span><br><span class="line">        layerDef.AutoGenerateFeatureTemplates = <span class="literal">false</span>;</span><br><span class="line">        updateLayerDef = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// retrieve the CIM edit template definition</span></span><br><span class="line">      <span class="keyword">var</span> templateDef = template.GetDefinition();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// assign the GUID from the tool DAML definition, for example</span></span><br><span class="line">      <span class="comment">// &lt;tool id=&quot;TestConstructionTool_SampleSDKTool&quot; categoryRefID=&quot;esri_editing_construction_polyline&quot; ….&gt;</span></span><br><span class="line">      <span class="comment">//   &lt;tooltip heading=&quot;&quot;&gt;Tooltip text&lt;disabledText /&gt;&lt;/tooltip&gt;</span></span><br><span class="line">      <span class="comment">//   &lt;content guid=&quot;e58239b3-9c69-49e5-ad4d-bb2ba29ff3ea&quot; /&gt;</span></span><br><span class="line">      <span class="comment">// &lt;/tool&gt;</span></span><br><span class="line">      <span class="comment">// then the toolContentGUID would be &quot;e58239b3-9c69-49e5-ad4d-bb2ba29ff3ea&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//At 2.x -</span></span><br><span class="line">      <span class="comment">//templateDef.ToolProgID = toolContentGUID;</span></span><br><span class="line">      templateDef.DefaultToolGUID = toolContentGUID;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// set the definition back to </span></span><br><span class="line">      template.SetDefinition(templateDef);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// update the layer definition too</span></span><br><span class="line">      <span class="keyword">if</span> (updateLayerDef)</span><br><span class="line">        flayer.SetDefinition(layerDef);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="隐藏或显示模板上的编辑工具"><a href="#隐藏或显示模板上的编辑工具" class="headerlink" title="隐藏或显示模板上的编辑工具"></a>隐藏或显示模板上的编辑工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//hide all tools except line tool on layer</span></span><br><span class="line">  <span class="keyword">var</span> featLayer = MapView.Active.Map.FindLayers(<span class="string">&quot;Roads&quot;</span>).First();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> editTemplates = featLayer.GetTemplates();</span><br><span class="line">  <span class="keyword">var</span> newCIMEditingTemplates = <span class="keyword">new</span> List&lt;CIMEditingTemplate&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> et <span class="keyword">in</span> editTemplates)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//initialize template by activating default tool</span></span><br><span class="line">    et.ActivateDefaultToolAsync();</span><br><span class="line">    <span class="keyword">var</span> cimEditTemplate = et.GetDefinition();</span><br><span class="line">    <span class="comment">//get the visible tools on this template</span></span><br><span class="line">    <span class="keyword">var</span> allTools = et.ToolIDs.ToList();</span><br><span class="line">    <span class="comment">//add the hidden tools on this template</span></span><br><span class="line">    allTools.AddRange(cimEditTemplate.GetExcludedToolIDs().ToList());</span><br><span class="line">    <span class="comment">//hide all the tools then allow the line tool</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//allTools.AddRange(cimEditTemplate.GetExcludedToolDamlIds().ToList());</span></span><br><span class="line">    allTools.AddRange(cimEditTemplate.GetExcludedToolIDs().ToList());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//At 2.x - </span></span><br><span class="line">    <span class="comment">//cimEditTemplate.SetExcludedToolDamlIds(allTools.ToArray());</span></span><br><span class="line">    <span class="comment">//cimEditTemplate.AllowToolDamlID(&quot;esri_editing_SketchLineTool&quot;);</span></span><br><span class="line">    </span><br><span class="line">    cimEditTemplate.SetExcludedToolIDs(allTools.ToArray());</span><br><span class="line">    cimEditTemplate.AllowToolID(<span class="string">&quot;esri_editing_SketchLineTool&quot;</span>);</span><br><span class="line">    newCIMEditingTemplates.Add(cimEditTemplate);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//update the layer templates</span></span><br><span class="line">  <span class="keyword">var</span> layerDef = featLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line">  <span class="comment">// Set AutoGenerateFeatureTemplates to false for template changes to stick</span></span><br><span class="line">  layerDef.AutoGenerateFeatureTemplates = <span class="literal">false</span>;</span><br><span class="line">  layerDef.FeatureTemplates = newCIMEditingTemplates.ToArray();</span><br><span class="line">  featLayer.SetDefinition(layerDef);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用图层创建新模板。创建模板"><a href="#使用图层创建新模板。创建模板" class="headerlink" title="使用图层创建新模板。创建模板"></a>使用图层创建新模板。创建模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (layer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.LoadSchema(layer);</span><br><span class="line"></span><br><span class="line">  insp[<span class="string">&quot;Field1&quot;</span>] = value1;</span><br><span class="line">  insp[<span class="string">&quot;Field2&quot;</span>] = value2;</span><br><span class="line">  insp[<span class="string">&quot;Field3&quot;</span>] = value3;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> tags = <span class="keyword">new</span>[] &#123; <span class="string">&quot;Polygon&quot;</span>, <span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;tag2&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set defaultTool using a daml-id </span></span><br><span class="line">  <span class="built_in">string</span> defaultTool = <span class="string">&quot;esri_editing_SketchCirclePolygonTool&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tool filter is the tools to filter OUT</span></span><br><span class="line">  <span class="keyword">var</span> toolFilter = <span class="keyword">new</span>[] &#123; <span class="string">&quot;esri_editing_SketchTracePolygonTool&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create a new template  </span></span><br><span class="line">  <span class="keyword">var</span> newTemplate = layer.CreateTemplate(<span class="string">&quot;My new template&quot;</span>, <span class="string">&quot;description&quot;</span>, insp, defaultTool, tags, toolFilter);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用表创建新表模板。创建模板"><a href="#使用表创建新表模板。创建模板" class="headerlink" title="使用表创建新表模板。创建模板"></a>使用表创建新表模板。创建模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> table = MapView.Active.Map.GetStandaloneTablesAsFlattenedList().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (table == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> tableTemplate = table.GetTemplate(<span class="string">&quot;Template1&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> definition = tableTemplate.GetDefinition();</span><br><span class="line">  definition.Description = <span class="string">&quot;New definition&quot;</span>;</span><br><span class="line">  definition.Name = <span class="string">&quot;New name&quot;</span>;</span><br><span class="line">  <span class="comment">//Create new table template using this definition</span></span><br><span class="line">  table.CreateTemplate(definition);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//You can also create a new table template using this extension method. You can use this method the same way you use the layer.CreateTemplate method.</span></span><br><span class="line">  table.CreateTemplate(<span class="string">&quot;New template name&quot;</span>, <span class="string">&quot;Template description&quot;</span>, tags: <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;tag 1&quot;</span>, <span class="string">&quot;tag 2&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新表模板"><a href="#更新表模板" class="headerlink" title="更新表模板"></a>更新表模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> tableTemplate = table.GetTemplate(<span class="string">&quot;Template1&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> definition = tableTemplate.GetDefinition();</span><br><span class="line">  definition.Description = <span class="string">&quot;New definition&quot;</span>;</span><br><span class="line">  definition.Name = <span class="string">&quot;New name&quot;</span>;</span><br><span class="line">  <span class="comment">// update the definition</span></span><br><span class="line">  tableTemplate.SetDefinition(definition);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建注释模板"><a href="#创建注释模板" class="headerlink" title="创建注释模板"></a>创建注释模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get an anno layer</span></span><br><span class="line">AnnotationLayer annoLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;AnnotationLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (annoLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Inspector insp = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// get the anno feature class</span></span><br><span class="line">  <span class="keyword">var</span> fc = annoLayer.GetFeatureClass() <span class="keyword">as</span> ArcGIS.Core.Data.Mapping.AnnotationFeatureClass;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the featureclass CIM definition which contains the labels, symbols</span></span><br><span class="line">  <span class="keyword">var</span> cimDefinition = fc.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.Data.Mapping.AnnotationFeatureClassDefinition;</span><br><span class="line">  <span class="keyword">var</span> labels = cimDefinition.GetLabelClassCollection();</span><br><span class="line">  <span class="keyword">var</span> symbols = cimDefinition.GetSymbolCollection();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure there are labels, symbols</span></span><br><span class="line">  <span class="keyword">if</span> ((labels.Count == <span class="number">0</span>) || (symbols.Count == <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// find the label class required</span></span><br><span class="line">  <span class="comment">//   typically you would use a subtype name or some other characteristic</span></span><br><span class="line">  <span class="comment">// in this case lets just use the first one</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> label = labels[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// each label has a textSymbol</span></span><br><span class="line">  <span class="comment">// the symbolName *should* be the symbolID to be used</span></span><br><span class="line">  <span class="keyword">var</span> symbolName = label.TextSymbol.SymbolName;</span><br><span class="line">  <span class="built_in">int</span> symbolID = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">int</span>.TryParse(symbolName, <span class="keyword">out</span> symbolID))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// int.TryParse fails - attempt to find the symbolName in the symbol collection</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> symbol <span class="keyword">in</span> symbols)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (symbol.Name == symbolName)</span><br><span class="line">      &#123;</span><br><span class="line">        symbolID = symbol.ID;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// no symbol?</span></span><br><span class="line">  <span class="keyword">if</span> (symbolID == <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load the schema</span></span><br><span class="line">  insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.LoadSchema(annoLayer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ok to assign these fields using the inspector[fieldName] methodology</span></span><br><span class="line">  <span class="comment">//   these fields are guaranteed to exist in the annotation schema</span></span><br><span class="line">  insp[<span class="string">&quot;AnnotationClassID&quot;</span>] = label.ID;</span><br><span class="line">  insp[<span class="string">&quot;SymbolID&quot;</span>] = symbolID;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set up some additional annotation properties</span></span><br><span class="line">  AnnotationProperties annoProperties = insp.GetAnnotationProperties();</span><br><span class="line">  annoProperties.FontSize = <span class="number">36</span>;</span><br><span class="line">  annoProperties.TextString = <span class="string">&quot;My Annotation feature&quot;</span>;</span><br><span class="line">  annoProperties.VerticalAlignment = VerticalAlignment.Top;</span><br><span class="line">  annoProperties.HorizontalAlignment = HorizontalAlignment.Justify;</span><br><span class="line"></span><br><span class="line">  insp.SetAnnotationProperties(annoProperties);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> tags = <span class="keyword">new</span>[] &#123; <span class="string">&quot;Annotation&quot;</span>, <span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;tag2&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use daml-id rather than guid</span></span><br><span class="line">  <span class="built_in">string</span> defaultTool = <span class="string">&quot;esri_editing_SketchStraightAnnoTool&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tool filter is the tools to filter OUT</span></span><br><span class="line">  <span class="keyword">var</span> toolFilter = <span class="keyword">new</span>[] &#123; <span class="string">&quot;esri_editing_SketchCurvedAnnoTool&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create a new template </span></span><br><span class="line">  <span class="keyword">var</span> newTemplate = annoLayer.CreateTemplate(<span class="string">&quot;new anno template&quot;</span>, <span class="string">&quot;description&quot;</span>, insp, defaultTool, tags, toolFilter);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除表模板"><a href="#删除表模板" class="headerlink" title="删除表模板"></a>删除表模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> table = MapView.Active.Map.GetStandaloneTablesAsFlattenedList().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (table == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> tableTemplate = table.GetTemplate(<span class="string">&quot;Template1&quot;</span>);</span><br><span class="line">  <span class="comment">//Removing a table template</span></span><br><span class="line">  table.RemoveTemplate(tableTemplate);</span><br><span class="line">  <span class="comment">//Removing a template by name</span></span><br><span class="line">  table.RemoveTemplate(<span class="string">&quot;Template2&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="活动模板已更改"><a href="#活动模板已更改" class="headerlink" title="活动模板已更改"></a>活动模板已更改</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Editing.Events.ActiveTemplateChangedEvent.Subscribe(OnActiveTemplateChanged);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnActiveTemplateChanged</span>(<span class="params">ArcGIS.Desktop.Editing.Events.ActiveTemplateChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// return if incoming template is null</span></span><br><span class="line">  <span class="keyword">if</span> (args.IncomingTemplate == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Activate two-point line tool for Freeway template in the Layers map</span></span><br><span class="line">  <span class="keyword">if</span> (args.IncomingTemplate.Name == <span class="string">&quot;Freeway&quot;</span> &amp;&amp; args.IncomingMapView.Map.Name == <span class="string">&quot;Layers&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> args.IncomingTemplate.ActivateToolAsync(<span class="string">&quot;esri_editing_SketchTwoPointLineTool&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="注释构建工具"><a href="#注释构建工具" class="headerlink" title="注释构建工具"></a>注释构建工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//In your config.daml...set the categoryRefID</span></span><br><span class="line"><span class="comment">//&lt;tool id=&quot;...&quot; categoryRefID=&quot;esri_editing_construction_annotation&quot; caption=&quot;Create Anno&quot; ...&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Sketch type Point or Line or BezierLine in the constructor...</span></span><br><span class="line"><span class="comment">//internal class AnnoConstructionTool : MapTool  &#123;</span></span><br><span class="line"><span class="comment">//  public AnnoConstructionTool()  &#123;</span></span><br><span class="line"><span class="comment">//    IsSketchTool = true;</span></span><br><span class="line"><span class="comment">//    UseSnapping = true;</span></span><br><span class="line"><span class="comment">//    SketchType = SketchGeometryType.Point;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="keyword">override</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (CurrentTemplate == <span class="literal">null</span> || geometry == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create an edit operation</span></span><br><span class="line">  <span class="keyword">var</span> createOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  createOperation.Name = <span class="built_in">string</span>.Format(<span class="string">&quot;Create &#123;0&#125;&quot;</span>, CurrentTemplate.Layer.Name);</span><br><span class="line">  createOperation.SelectNewFeatures = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> insp = CurrentTemplate.Inspector;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the annotation properties class</span></span><br><span class="line">    AnnotationProperties annoProperties = insp.GetAnnotationProperties();</span><br><span class="line">    <span class="comment">// set custom annotation properties</span></span><br><span class="line">    annoProperties.TextString = <span class="string">&quot;my custom text&quot;</span>;</span><br><span class="line">    annoProperties.Color = ColorFactory.Instance.RedRGB;</span><br><span class="line">    annoProperties.FontSize = <span class="number">24</span>;</span><br><span class="line">    annoProperties.FontName = <span class="string">&quot;Arial&quot;</span>;</span><br><span class="line">    annoProperties.HorizontalAlignment = ArcGIS.Core.CIM.HorizontalAlignment.Right;</span><br><span class="line">    annoProperties.Shape = geometry;</span><br><span class="line">    <span class="comment">// assign annotation properties back to the inspector</span></span><br><span class="line">    insp.SetAnnotationProperties(annoProperties);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Queue feature creation</span></span><br><span class="line">    createOperation.Create(CurrentTemplate.Layer, insp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute the operation</span></span><br><span class="line">    <span class="keyword">return</span> createOperation.Execute();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="以编程方式启动编辑批注"><a href="#以编程方式启动编辑批注" class="headerlink" title="以编程方式启动编辑批注"></a>以编程方式启动编辑批注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> plugin = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;esri_editing_EditVerticesText&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (plugin.Enabled)</span><br><span class="line">  ((ICommand)plugin).Execute(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="更新批注文本"><a href="#更新批注文本" class="headerlink" title="更新批注文本"></a>更新批注文本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//annoLayer is ~your~ Annotation layer...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// use the inspector methodology</span></span><br><span class="line">  <span class="comment">//at 2.x - var insp = new Inspector(true);</span></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.Load(annoLayer, oid);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the annotation properties</span></span><br><span class="line">  AnnotationProperties annoProperties = insp.GetAnnotationProperties();</span><br><span class="line">  <span class="comment">// set the attribute</span></span><br><span class="line">  annoProperties.TextString = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">  <span class="comment">// assign the annotation proeprties back to the inspector</span></span><br><span class="line">  insp.SetAnnotationProperties(annoProperties);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//create and execute the edit operation</span></span><br><span class="line">  EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;Update annotation&quot;</span>;</span><br><span class="line">  op.Modify(insp);</span><br><span class="line">  op.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="修改批注形状"><a href="#修改批注形状" class="headerlink" title="修改批注形状"></a>修改批注形状</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Don&#x27;t use &#x27;Shape&#x27;....Shape is the bounding box of the annotation text. This is NOT what you want...</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//var insp = new Inspector();</span></span><br><span class="line">  <span class="comment">//insp.Load(annoLayer, oid);</span></span><br><span class="line">  <span class="comment">//var shape = insp[&quot;SHAPE&quot;] as Polygon;</span></span><br><span class="line">  <span class="comment">//...wrong shape...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Instead, we must use the AnnotationProperties</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//annoLayer is ~your~ Annotation layer</span></span><br><span class="line">  <span class="comment">//at 2.x - var insp = new Inspector(true);</span></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.Load(annoLayer, oid);</span><br><span class="line"></span><br><span class="line">  AnnotationProperties annoProperties = insp.GetAnnotationProperties();</span><br><span class="line">  <span class="keyword">var</span> shape = annoProperties.Shape;</span><br><span class="line">  <span class="keyword">if</span> (shape.GeometryType != GeometryType.GeometryBag)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> newGeometry = GeometryEngine.Instance.Move(shape, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    annoProperties.Shape = newGeometry;</span><br><span class="line">    insp.SetAnnotationProperties(annoProperties);</span><br><span class="line"></span><br><span class="line">    EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">    op.Name = <span class="string">&quot;Change annotation angle&quot;</span>;</span><br><span class="line">    op.Modify(insp);</span><br><span class="line">    op.Execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="修改批注文本图形"><a href="#修改批注文本图形" class="headerlink" title="修改批注文本图形"></a>修改批注文本图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> selection = annoLayer.GetSelection();</span><br><span class="line">  <span class="keyword">if</span> (selection.GetCount() == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use the first selelcted feature </span></span><br><span class="line">  <span class="comment">//at 2.x - var insp = new Inspector(true);</span></span><br><span class="line">  <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">  insp.Load(annoLayer, selection.GetObjectIDs().FirstOrDefault());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getAnnoProperties should return null if not an annotation feature</span></span><br><span class="line">  AnnotationProperties annoProperties = insp.GetAnnotationProperties();</span><br><span class="line">  <span class="comment">// get the textGraphic</span></span><br><span class="line">  CIMTextGraphic textGraphic = annoProperties.TextGraphic;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// change text</span></span><br><span class="line">  textGraphic.Text = <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set x,y offset via the symbol</span></span><br><span class="line">  <span class="keyword">var</span> symbol = textGraphic.Symbol.Symbol;</span><br><span class="line">  <span class="keyword">var</span> textSymbol = symbol <span class="keyword">as</span> CIMTextSymbol;</span><br><span class="line">  textSymbol.OffsetX = <span class="number">2</span>;</span><br><span class="line">  textSymbol.OffsetY = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  textSymbol.HorizontalAlignment = HorizontalAlignment.Center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load the updated textGraphic</span></span><br><span class="line">  annoProperties.LoadFromTextGraphic(textGraphic);</span><br><span class="line">  <span class="comment">// assign the annotation properties back </span></span><br><span class="line">  insp.SetAnnotationProperties(annoProperties);</span><br><span class="line"></span><br><span class="line">  EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;modify symbol&quot;</span>;</span><br><span class="line">  op.Modify(insp);</span><br><span class="line">  <span class="built_in">bool</span> result = op.Execute();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ProSnippet-组-：-接地到网格"><a href="#ProSnippet-组-：-接地到网格" class="headerlink" title="ProSnippet 组 ： 接地到网格"></a>ProSnippet 组 ： 接地到网格</h3><h3 id="G2G-设置"><a href="#G2G-设置" class="headerlink" title="G2G 设置"></a>G2G 设置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CIMGroundToGridCorrection correction = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">bool</span> isCorecting = correction.IsCorrecting();   <span class="comment">// equivalent to correction != null &amp;&amp; correction.Enabled;</span></span><br><span class="line"><span class="built_in">bool</span> UsingOffset = correction.UsingDirectionOffset();   <span class="comment">// equivalent to correction.IsCorrecting() &amp;&amp; correction.UseDirection;</span></span><br><span class="line"><span class="built_in">double</span> dOffset = correction.GetDirectionOffset(); <span class="comment">// equivalent to correction.UsingDirectionOffset() ? correction.Direction : DefaultDirectionOffset;</span></span><br><span class="line"><span class="built_in">bool</span> usingDistanceFactor = correction.UsingDistanceFactor();  <span class="comment">// equivalent to correction.IsCorrecting() &amp;&amp; correction.UseScale;</span></span><br><span class="line"><span class="built_in">bool</span> usingElevation = correction.UsingElevationMode(); <span class="comment">// equivalent to correction.UsingDistanceFactor() &amp;&amp; c.ScaleType == GroundToGridScaleType.ComputeUsingElevation;</span></span><br><span class="line"><span class="built_in">bool</span> usingSFactor = correction.UsingConstantScaleFactor();  <span class="comment">//; equivalent to correction.UsingDistanceFactor() &amp;&amp; correction.ScaleType == GroundToGridScaleType.ConstantFactor;</span></span><br><span class="line"><span class="built_in">double</span> dSFactor = correction.GetConstantScaleFactor(); <span class="comment">// equivalent to correctionc.UsingDistanceFactor() ? correction.ConstantScaleFactor : DefaultConstantScaleFactor;</span></span><br></pre></td></tr></table></figure>

<h2 id="编辑选项"><a href="#编辑选项" class="headerlink" title="编辑选项"></a>编辑选项</h2><h3 id="获取-x2F-设置编辑选项"><a href="#获取-x2F-设置编辑选项" class="headerlink" title="获取&#x2F;设置编辑选项"></a>获取&#x2F;设置编辑选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//toggle, switch option values</span></span><br><span class="line"><span class="keyword">var</span> options = ApplicationOptions.EditingOptions;</span><br><span class="line"></span><br><span class="line">options.EnforceAttributeValidation = !options.EnforceAttributeValidation;</span><br><span class="line">options.WarnOnSubtypeChange = !options.WarnOnSubtypeChange;</span><br><span class="line">options.InitializeDefaultValuesOnSubtypeChange = !options.InitializeDefaultValuesOnSubtypeChange;</span><br><span class="line">options.UncommitedAttributeEdits = (options.UncommitedAttributeEdits == </span><br><span class="line">  UncommitedEditMode.AlwaysPrompt) ? UncommitedEditMode.Apply : UncommitedEditMode.AlwaysPrompt;</span><br><span class="line"></span><br><span class="line">options.StretchGeometry = !options.StretchGeometry;</span><br><span class="line">options.StretchTopology = !options.StretchTopology;</span><br><span class="line">options.UncommitedGeometryEdits = (options.UncommitedGeometryEdits == </span><br><span class="line">  UncommitedEditMode.AlwaysPrompt) ? UncommitedEditMode.Apply : UncommitedEditMode.AlwaysPrompt;</span><br><span class="line"></span><br><span class="line">options.ActivateMoveAfterPaste = !options.ActivateMoveAfterPaste;</span><br><span class="line">options.ShowFeatureSketchSymbology = !options.ShowFeatureSketchSymbology;</span><br><span class="line">options.FinishSketchOnDoubleClick = !options.FinishSketchOnDoubleClick;</span><br><span class="line">options.AllowVertexEditingWhileSketching = !options.AllowVertexEditingWhileSketching;</span><br><span class="line">options.ShowDeleteDialog = !options.ShowDeleteDialog;</span><br><span class="line">options.EnableStereoEscape = !options.EnableStereoEscape;</span><br><span class="line">options.DragSketch = !options.DragSketch;</span><br><span class="line">options.ShowDynamicConstraints = !options.ShowDynamicConstraints;</span><br><span class="line">options.IsDeflectionDefaultDirectionConstraint = </span><br><span class="line">  !options.IsDeflectionDefaultDirectionConstraint;</span><br><span class="line">options.IsDirectionDefaultInputConstraint = !options.IsDirectionDefaultInputConstraint;</span><br><span class="line">options.ShowEditingToolbar = !options.ShowEditingToolbar;</span><br><span class="line">options.ToolbarPosition = (options.ToolbarPosition == ToolbarPosition.Bottom) ? </span><br><span class="line">          ToolbarPosition.Right : ToolbarPosition.Bottom;</span><br><span class="line">options.ToolbarSize = (options.ToolbarSize == ToolbarSize.Medium) ? </span><br><span class="line">          ToolbarSize.Small : ToolbarSize.Medium;</span><br><span class="line">options.MagnifyToolbar = !options.MagnifyToolbar;</span><br><span class="line"></span><br><span class="line">options.EnableEditingFromEditTab = !options.EnableEditingFromEditTab;</span><br><span class="line">options.AutomaticallySaveEdits = !options.AutomaticallySaveEdits;</span><br><span class="line">options.AutoSaveByTime = !options.AutoSaveByTime;</span><br><span class="line">options.SaveEditsInterval = (options.AutomaticallySaveEdits) ? <span class="number">20</span> : <span class="number">10</span>;</span><br><span class="line">options.SaveEditsOperations = (options.AutomaticallySaveEdits) ? <span class="number">60</span> : <span class="number">30</span>;</span><br><span class="line">options.SaveEditsOnProjectSave = !options.SaveEditsOnProjectSave;</span><br><span class="line">options.ShowSaveEditsDialog = !options.ShowSaveEditsDialog;</span><br><span class="line">options.ShowDiscardEditsDialog = !options.ShowDiscardEditsDialog;</span><br><span class="line">options.DeactivateToolOnSaveOrDiscard = !options.DeactivateToolOnSaveOrDiscard;</span><br><span class="line">options.NewLayersEditable = !options.NewLayersEditable;</span><br></pre></td></tr></table></figure>

<h3 id="获取草图折点符号系统选项"><a href="#获取草图折点符号系统选项" class="headerlink" title="获取草图折点符号系统选项"></a>获取草图折点符号系统选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = ApplicationOptions.EditingOptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Must use QueuedTask</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//There are 4 vertex symbol settings - selected, unselected and the</span></span><br><span class="line">  <span class="comment">//current vertex selected and unselected.</span></span><br><span class="line">  <span class="keyword">var</span> reg_select = options.GetVertexSymbolOptions(VertexSymbolType.RegularSelected);</span><br><span class="line">  <span class="keyword">var</span> reg_unsel = options.GetVertexSymbolOptions(VertexSymbolType.RegularUnselected);</span><br><span class="line">  <span class="keyword">var</span> curr_sel = options.GetVertexSymbolOptions(VertexSymbolType.CurrentSelected);</span><br><span class="line">  <span class="keyword">var</span> curr_unsel = options.GetVertexSymbolOptions(VertexSymbolType.CurrentUnselected);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//to convert the options to a symbol use</span></span><br><span class="line">  <span class="comment">//GetPointSymbol</span></span><br><span class="line">  <span class="keyword">var</span> reg_sel_pt_symbol = reg_select.GetPointSymbol();</span><br><span class="line">  <span class="comment">//ditto for reg_unsel, curr_sel, curr_unsel</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取草图线段符号系统选项"><a href="#获取草图线段符号系统选项" class="headerlink" title="获取草图线段符号系统选项"></a>获取草图线段符号系统选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var options = ApplicationOptions.EditingOptions;</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> seg_options = options.GetSegmentSymbolOptions();</span><br><span class="line">  <span class="comment">//to convert the options to a symbol use</span></span><br><span class="line">  <span class="comment">//SymbolFactory. Note: this is approximate....sketch isn&#x27;t using the</span></span><br><span class="line">  <span class="comment">//CIM directly for segments</span></span><br><span class="line">  <span class="keyword">var</span> layers = <span class="keyword">new</span> List&lt;CIMSymbolLayer&gt;();</span><br><span class="line">  <span class="keyword">var</span> stroke0 = SymbolFactory.Instance.ConstructStroke(seg_options.PrimaryColor, </span><br><span class="line">    seg_options.Width, SimpleLineStyle.Dash);</span><br><span class="line">  layers.Add(stroke0);</span><br><span class="line">  <span class="keyword">if</span> (seg_options.HasSecondaryColor) &#123;</span><br><span class="line">    <span class="keyword">var</span> stroke1 = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">      seg_options.SecondaryColor, seg_options.Width, SimpleLineStyle.Solid);</span><br><span class="line">    layers.Add(stroke1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//segment symbology only</span></span><br><span class="line">  <span class="keyword">var</span> sketch_line = <span class="keyword">new</span> CIMLineSymbol() &#123;</span><br><span class="line">    SymbolLayers = layers.ToArray()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置草图顶点符号选项"><a href="#设置草图顶点符号选项" class="headerlink" title="设置草图顶点符号选项"></a>设置草图顶点符号选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var options = ApplicationOptions.EditingOptions;</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//change the regular unselected vertex symbol</span></span><br><span class="line">  <span class="comment">//default is a green, hollow, square, 5pts. Change to</span></span><br><span class="line">  <span class="comment">//Blue outline diamond, 10 pts</span></span><br><span class="line">  <span class="keyword">var</span> vertexSymbol = <span class="keyword">new</span> VertexSymbolOptions(VertexSymbolType.RegularUnselected);</span><br><span class="line">  vertexSymbol.OutlineColor = ColorFactory.Instance.BlueRGB;</span><br><span class="line">  vertexSymbol.MarkerType = VertexMarkerType.Diamond;</span><br><span class="line">  vertexSymbol.Size = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Are these valid?</span></span><br><span class="line">  <span class="keyword">if</span> (options.CanSetVertexSymbolOptions(</span><br><span class="line">       VertexSymbolType.RegularUnselected, vertexSymbol)) &#123;</span><br><span class="line">    <span class="comment">//apply them</span></span><br><span class="line">    options.SetVertexSymbolOptions(VertexSymbolType.RegularUnselected, vertexSymbol);</span><br><span class="line">          &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置草图线段符号选项"><a href="#设置草图线段符号选项" class="headerlink" title="设置草图线段符号选项"></a>设置草图线段符号选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var options = ApplicationOptions.EditingOptions;</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//change the segment symbol primary color to green and</span></span><br><span class="line">  <span class="comment">//width to 1 pt</span></span><br><span class="line">  <span class="keyword">var</span> segSymbol = options.GetSegmentSymbolOptions();</span><br><span class="line">  segSymbol.PrimaryColor = ColorFactory.Instance.GreenRGB;</span><br><span class="line">  segSymbol.Width = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Are these valid?</span></span><br><span class="line">  <span class="keyword">if</span> (options.CanSetSegmentSymbolOptions(segSymbol)) &#123;</span><br><span class="line">    <span class="comment">//apply them</span></span><br><span class="line">    options.SetSegmentSymbolOptions(segSymbol);</span><br><span class="line">          &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将草图顶点符号设置回默认值"><a href="#将草图顶点符号设置回默认值" class="headerlink" title="将草图顶点符号设置回默认值"></a>将草图顶点符号设置回默认值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var options = ApplicationOptions.EditingOptions;</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//ditto for reg selected and current selected, unselected</span></span><br><span class="line">  <span class="keyword">var</span> def_reg_unsel = </span><br><span class="line">    options.GetDefaultVertexSymbolOptions(VertexSymbolType.RegularUnselected);</span><br><span class="line">  <span class="comment">//apply default</span></span><br><span class="line">  options.SetVertexSymbolOptions(</span><br><span class="line">    VertexSymbolType.RegularUnselected, def_reg_unsel);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将草图线段符号设置回默认值"><a href="#将草图线段符号设置回默认值" class="headerlink" title="将草图线段符号设置回默认值"></a>将草图线段符号设置回默认值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var options = ApplicationOptions.EditingOptions;</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> def_seg = options.GetDefaultSegmentSymbolOptions();</span><br><span class="line">  options.SetSegmentSymbolOptions(def_seg);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="版本控制选项"><a href="#版本控制选项" class="headerlink" title="版本控制选项"></a>版本控制选项</h2><h3 id="获取和设置版本控制选项"><a href="#获取和设置版本控制选项" class="headerlink" title="获取和设置版本控制选项"></a>获取和设置版本控制选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vOptions = ApplicationOptions.VersioningOptions;</span><br><span class="line"></span><br><span class="line">vOptions.DefineConflicts = (vOptions.DefineConflicts == ConflictDetectionType.ByRow) ? </span><br><span class="line">  ConflictDetectionType.ByColumn : ConflictDetectionType.ByRow;</span><br><span class="line">vOptions.ConflictResolution = (</span><br><span class="line">  vOptions.ConflictResolution == ConflictResolutionType.FavorEditVersion) ? </span><br><span class="line">    ConflictResolutionType.FavorTargetVersion : ConflictResolutionType.FavorEditVersion;</span><br><span class="line">vOptions.ShowConflictsDialog = !vOptions.ShowConflictsDialog;</span><br><span class="line">vOptions.ShowReconcileDialog = !vOptions.ShowReconcileDialog;</span><br></pre></td></tr></table></figure>

<h4 id="创建注记构造工具"><a href="#创建注记构造工具" class="headerlink" title="创建注记构造工具"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-Annotation#create-annotation-construction-tool">创建注记构造工具</a></h4><h4 id="通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在"><a href="#通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在" class="headerlink" title="通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-Annotation#update-annotation-text-via-attribute-caveat-the-textstring-anno-attribute-must-exist">通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</a></h4><h4 id="旋转或移动批注"><a href="#旋转或移动批注" class="headerlink" title="旋转或移动批注"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-Annotation#rotate-or-move-the-annotation">旋转或移动批注</a></h4><h4 id="更改批注文本图形"><a href="#更改批注文本图形" class="headerlink" title="更改批注文本图形"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-Annotation#change-annotation-text-graphic">更改批注文本图形</a></h4><h2 id="公共设施网络"><a href="#公共设施网络" class="headerlink" title="公共设施网络"></a>公共设施网络</h2><h4 id="创建公共设施网络关联"><a href="#创建公共设施网络关联" class="headerlink" title="创建公共设施网络关联"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-UtilityNetwork#create-a-utility-network-association">创建公共设施网络关联</a></h4><h4 id="在单个编辑操作中创建公共设施网络要素和关联"><a href="#在单个编辑操作中创建公共设施网络要素和关联" class="headerlink" title="在单个编辑操作中创建公共设施网络要素和关联"></a><a target="_blank" rel="noopener" href="https://github.com/Esri/arcgis-pro-sdk/wiki/ProSnippets-UtilityNetwork#create-utility-network-features-and-associations-in-a-single-edit-operation">在单个编辑操作中创建公共设施网络要素和关联</a></h4><h1 id="地理数据库"><a href="#地理数据库" class="headerlink" title="地理数据库"></a>地理数据库</h1><h2 id="地理数据库和数据存储"><a href="#地理数据库和数据存储" class="headerlink" title="地理数据库和数据存储"></a>地理数据库和数据存储</h2><h3 id="打开给定路径的文件地理数据库"><a href="#打开给定路径的文件地理数据库" class="headerlink" title="打开给定路径的文件地理数据库"></a>打开给定路径的文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenFileGDB</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Opens a file geodatabase. This will open the geodatabase if the folder exists and contains a valid geodatabase.</span></span><br><span class="line">      <span class="keyword">using</span> (</span><br><span class="line">        Geodatabase geodatabase =</span><br><span class="line">          <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the geodatabase.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (GeodatabaseNotFoundOrOpenedException exception)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Handle Exception.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用连接属性打开企业级地理数据库"><a href="#使用连接属性打开企业级地理数据库" class="headerlink" title="使用连接属性打开企业级地理数据库"></a>使用连接属性打开企业级地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenEnterpriseGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Opening a Non-Versioned SQL Server instance.</span></span><br><span class="line">    DatabaseConnectionProperties connectionProperties = <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Where testMachine is the machine where the instance is running and testInstance is the name of the SqlServer instance.</span></span><br><span class="line">      Instance = <span class="string">@&quot;testMachine\testInstance&quot;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Provided that a database called LocalGovernment has been created on the testInstance and geodatabase has been enabled on the database.</span></span><br><span class="line">      Database = <span class="string">&quot;LocalGovernment&quot;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Provided that a login called gdb has been created and corresponding schema has been created with the required permissions.</span></span><br><span class="line">      User = <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;dbo.DEFAULT&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(connectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Use the geodatabase</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-sde-文件路径打开企业级地理数据库"><a href="#使用-sde-文件路径打开企业级地理数据库" class="headerlink" title="使用 sde 文件路径打开企业级地理数据库"></a>使用 sde 文件路径打开企业级地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenEnterpriseGeodatabaseUsingSDEFilePath</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Use the geodatabase.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从工程项获取地理数据库"><a href="#从工程项获取地理数据库" class="headerlink" title="从工程项获取地理数据库"></a>从工程项获取地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingGeodatabaseFromProjectItem</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  IEnumerable&lt;GDBProjectItem&gt; gdbProjectItems = Project.Current.GetItems&lt;GDBProjectItem&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (GDBProjectItem gdbProjectItem <span class="keyword">in</span> gdbProjectItems)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Datastore datastore = gdbProjectItem.GetDatastore())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Unsupported datastores (non File GDB and non Enterprise GDB) will be of type UnknownDatastore</span></span><br><span class="line">        <span class="keyword">if</span> (datastore <span class="keyword">is</span> UnknownDatastore)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        Geodatabase geodatabase = datastore <span class="keyword">as</span> Geodatabase;</span><br><span class="line">        <span class="comment">// Use the geodatabase.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从连接文件获取数据库连接属性"><a href="#从连接文件获取数据库连接属性" class="headerlink" title="从连接文件获取数据库连接属性"></a>从连接文件获取数据库连接属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DatabaseConnectionFile connectionFile = <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>));</span><br><span class="line">DatabaseConnectionProperties connectionProperties = DatabaseClient.GetDatabaseConnectionProperties(connectionFile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now you could, for example, change the user name and password in the connection properties prior to use them to open a geodatabase</span></span><br></pre></td></tr></table></figure>

<h3 id="从要素图层获取地理数据库"><a href="#从要素图层获取地理数据库" class="headerlink" title="从要素图层获取地理数据库"></a>从要素图层获取地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingGeodatabaseFromFeatureLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  IEnumerable&lt;Layer&gt; layers = MapView.Active.Map.Layers.Where(layer =&gt; layer <span class="keyword">is</span> FeatureLayer);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (FeatureLayer featureLayer <span class="keyword">in</span> layers)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Table table = featureLayer.GetTable())</span><br><span class="line">      <span class="keyword">using</span> (Datastore datastore = table.GetDatastore())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (datastore <span class="keyword">is</span> UnknownDatastore)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        Geodatabase geodatabase = datastore <span class="keyword">as</span> Geodatabase;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行-SQL-语句"><a href="#执行-SQL-语句" class="headerlink" title="执行 SQL 语句"></a>执行 SQL 语句</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Executes raw SQL on the underlying database management system.</span></span><br><span class="line"><span class="comment">//  Any SQL is permitted (DDL or DML), but no results can be returned</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExecuteSQLOnGeodatabase</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> statement</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseClient.ExecuteStatement(geodatabase, statement);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="从地理数据库获取定义"><a href="#从地理数据库获取定义" class="headerlink" title="从地理数据库获取定义"></a>从地理数据库获取定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingDefinitionFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Remember that for Enterprise databases you have to qualify your dataset names with the DatabaseName and UserName.</span></span><br><span class="line">      TableDefinition enterpriseTableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.CitizenContactInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// It does not matter if the dataset is within a FeatureDataset or not.</span></span><br><span class="line">      FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.FireStation&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// GetDefinition For a RelationshipClass.</span></span><br><span class="line">      RelationshipClassDefinition relationshipClassDefinition = geodatabase.GetDefinition&lt;RelationshipClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// GetDefinition For a FeatureDataset.</span></span><br><span class="line">      FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地理数据库获取定义列表"><a href="#从地理数据库获取定义列表" class="headerlink" title="从地理数据库获取定义列表"></a>从地理数据库获取定义列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingDefinitionsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> enterpriseDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;FeatureClassDefinition&gt;();</span><br><span class="line">      IEnumerable&lt;Definition&gt; featureClassesHavingGlobalID = </span><br><span class="line">        enterpriseDefinitions.Where(definition =&gt; definition.HasGlobalID());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> featureDatasetDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;FeatureDatasetDefinition&gt;();</span><br><span class="line">      <span class="built_in">bool</span> electionRelatedFeatureDatasets = </span><br><span class="line">        featureDatasetDefinitions.Any(</span><br><span class="line">          definition =&gt; definition.GetName().Contains(<span class="string">&quot;Election&quot;</span>));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> attributedRelationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;AttributedRelationshipClassDefinition&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> relationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;RelationshipClassDefinition&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地理数据库获取相关定义"><a href="#从地理数据库获取相关定义" class="headerlink" title="从地理数据库获取相关定义"></a>从地理数据库获取相关定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ObtainingRelatedDefinitionsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Remember the qualification of DatabaseName. for the RelationshipClass.</span></span><br><span class="line"></span><br><span class="line">      RelationshipClassDefinition enterpriseDefinition = </span><br><span class="line">      geodatabase.GetDefinition&lt;RelationshipClassDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>);</span><br><span class="line">      IReadOnlyList&lt;Definition&gt; enterpriseDefinitions = </span><br><span class="line">      geodatabase.GetRelatedDefinitions(enterpriseDefinition, DefinitionRelationshipType.DatasetsRelatedThrough);</span><br><span class="line">      FeatureClassDefinition enterpriseAddressPointDefinition = </span><br><span class="line">      enterpriseDefinitions.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>)) <span class="keyword">as</span> FeatureClassDefinition;</span><br><span class="line"></span><br><span class="line">      FeatureDatasetDefinition featureDatasetDefinition = </span><br><span class="line">        geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>);</span><br><span class="line">      IReadOnlyList&lt;Definition&gt; datasetsInAddressDataset = </span><br><span class="line">        geodatabase.GetRelatedDefinitions(featureDatasetDefinition, DefinitionRelationshipType.DatasetInFeatureDataset);</span><br><span class="line">      FeatureClassDefinition addressPointInAddressDataset = </span><br><span class="line">        datasetsInAddressDataset.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>)) <span class="keyword">as</span> FeatureClassDefinition;</span><br><span class="line"></span><br><span class="line">      RelationshipClassDefinition addressPointHasSiteAddressInAddressDataset = datasetsInAddressDataset.First(</span><br><span class="line">              defn =&gt; defn.GetName().Equals(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>)) <span class="keyword">as</span> RelationshipClassDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从层获取表定义"><a href="#从层获取表定义" class="headerlink" title="从层获取表定义"></a>从层获取表定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetDefinitionFromLayer - This code works even if the layer has a join to another table</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> TableDefinition <span class="title">GetDefinitionFromLayer</span>(<span class="params">FeatureLayer featureLayer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get feature class from the layer</span></span><br><span class="line">  FeatureClass featureClass = featureLayer.GetFeatureClass();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Determine if feature class is a join</span></span><br><span class="line">  <span class="keyword">if</span> (featureClass.IsJoinedTable())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get join from feature class</span></span><br><span class="line">    Join <span class="keyword">join</span> = featureClass.GetJoin();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get origin table from join</span></span><br><span class="line">    Table originTable = <span class="keyword">join</span>.GetOriginTable();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return feature class definition from the join&#x27;s origin table</span></span><br><span class="line">    <span class="keyword">return</span> originTable.GetDefinition();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> featureClass.GetDefinition();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h2><h3 id="从地理数据库打开数据集"><a href="#从地理数据库打开数据集" class="headerlink" title="从地理数据库打开数据集"></a>从地理数据库打开数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpeningDatasetsFromGeodatabase</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Table table = </span><br><span class="line">      geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.EmployeeInfo&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a featureClass (within a feature dataset or outside a feature dataset).</span></span><br><span class="line">      <span class="keyword">using</span> (FeatureClass featureClass = </span><br><span class="line">      geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// You can open a FeatureClass as a Table which will give you a Table Reference.</span></span><br><span class="line">      <span class="keyword">using</span> (Table featureClassAsTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPoint&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// But it is really a FeatureClass object.</span></span><br><span class="line">        FeatureClass featureClassOpenedAsTable = featureClassAsTable <span class="keyword">as</span> FeatureClass;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a FeatureDataset.</span></span><br><span class="line">      <span class="keyword">using</span> (FeatureDataset featureDataset = geodatabase.OpenDataset&lt;FeatureDataset&gt;(<span class="string">&quot;LocalGovernment.GDB.Address&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a RelationsipClass.  Just as you can open a FeatureClass as a Table, you can also open an AttributedRelationshipClass as a RelationshipClass.</span></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.AddressPointHasSiteAddresses&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查表是否存在"><a href="#检查表是否存在" class="headerlink" title="检查表是否存在"></a>检查表是否存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run9)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">TableExists</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> tableName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableName);</span><br><span class="line">    tableDefinition.Dispose();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// GetDefinition throws an exception if the definition doesn&#x27;t exist</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查要素类是否存在"><a href="#检查要素类是否存在" class="headerlink" title="检查要素类是否存在"></a>检查要素类是否存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">FeatureClassExists</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> featureClassName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">    featureClassDefinition.Dispose();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// GetDefinition throws an exception if the definition doesn&#x27;t exist</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开关系两个表之间的类"><a href="#打开关系两个表之间的类" class="headerlink" title="打开关系两个表之间的类"></a>打开关系两个表之间的类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Must be called within QueuedTask.Run().  </span></span><br><span class="line"><span class="comment">// When used with file or enterprise geodatabases, this routine takes two table names.</span></span><br><span class="line"><span class="comment">// When used with feature services, this routine takes layer IDs, or the names of the tables as they are exposed through the service (e.g., &quot;L0States&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IReadOnlyList&lt;RelationshipClass&gt; <span class="title">OpenRelationshipClassFeatureServices</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> originClass, <span class="built_in">string</span> destinationClass</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> geodatabase.OpenRelationshipClasses(originClass, destinationClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从关系类获取相关要素类"><a href="#从关系类获取相关要素类" class="headerlink" title="从关系类获取相关要素类"></a>从关系类获取相关要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">GetFeatureClassesInRelationshipClassAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      IReadOnlyList&lt;RelationshipClassDefinition&gt; relationshipClassDefinitions = </span><br><span class="line">        geodatabase.GetDefinitions&lt;RelationshipClassDefinition&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> relationshipClassDefinition <span class="keyword">in</span> relationshipClassDefinitions)</span><br><span class="line">      &#123;</span><br><span class="line">        IReadOnlyList&lt;Definition&gt; definitions = </span><br><span class="line">          geodatabase.GetRelatedDefinitions(relationshipClassDefinition,</span><br><span class="line">            DefinitionRelationshipType.DatasetsRelatedThrough);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> definition <span class="keyword">in</span> definitions)</span><br><span class="line">        &#123;</span><br><span class="line">          System.Diagnostics.Debug.WriteLine(</span><br><span class="line">            <span class="string">$&quot;Feature class in the RelationshipClass is:<span class="subst">&#123;definition.GetName()&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从-shapefile-数据存储打开要素类"><a href="#从-shapefile-数据存储打开要素类" class="headerlink" title="从 shapefile 数据存储打开要素类"></a>从 shapefile 数据存储打开要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenShapefileFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fileConnection = <span class="keyword">new</span> FileSystemConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\folder\\containing\\shapefiles&quot;</span>), FileSystemDatastoreType.Shapefile);</span><br><span class="line">    <span class="keyword">using</span> (FileSystemDatastore shapefile = <span class="keyword">new</span> FileSystemDatastore(fileConnection))</span><br><span class="line">    &#123;</span><br><span class="line">      FeatureClass taxLotsFeatureClass = shapefile.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;TaxLots&quot;</span>);</span><br><span class="line">      FeatureClass manHolesFeatureClass = shapefile.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;ManHoles.shp&quot;</span>); <span class="comment">// Can use the .shp extension, but its not needed.</span></span><br><span class="line">      Table taxDetailsTableWithoutExtension = shapefile.OpenDataset&lt;Table&gt;(<span class="string">&quot;TaxDetails&quot;</span>);</span><br><span class="line">      Table taxDetailsTable = shapefile.OpenDataset&lt;Table&gt;(<span class="string">&quot;TaxDetails.dbf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开-CAD-数据存储"><a href="#打开-CAD-数据存储" class="headerlink" title="打开 CAD 数据存储"></a>打开 CAD 数据存储</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">OpenCADFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fileConnection = <span class="keyword">new</span> FileSystemConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\folder\\containing\\CAD&quot;</span>), FileSystemDatastoreType.Cad);</span><br><span class="line">    <span class="keyword">using</span> (FileSystemDatastore cadDatastore = <span class="keyword">new</span> FileSystemDatastore(fileConnection))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// note - extension is required</span></span><br><span class="line">      <span class="keyword">var</span> cadDataset = cadDatastore.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;hatchplayboundaries.dwg&quot;</span>);</span><br><span class="line">      <span class="comment">// take note of the pattern for referencing a feature class. </span></span><br><span class="line">      <span class="keyword">var</span> cadfeatureClass = cadDatastore.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;hatchplayboundaries.dwg:Polyline&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">int</span> numRows = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> cursor = cadfeatureClass.Search())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">          numRows++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="使用查询筛选器搜索表"><a href="#使用查询筛选器搜索表" class="headerlink" title="使用查询筛选器搜索表"></a>使用查询筛选器搜索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SearchingATable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">      <span class="keyword">using</span> (Table table = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;EmployeeInfo&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line"></span><br><span class="line">        QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter</span><br><span class="line">        &#123;</span><br><span class="line">          WhereClause = <span class="string">&quot;COSTCTRN = &#x27;Information Technology&#x27;&quot;</span>,</span><br><span class="line">          SubFields = <span class="string">&quot;KNOWNAS, OFFICE, LOCATION&quot;</span>,</span><br><span class="line">          PostfixClause = <span class="string">&quot;ORDER BY OFFICE&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = table.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">string</span> location = Convert.ToString(row[<span class="string">&quot;LOCATION&quot;</span>]);</span><br><span class="line">              <span class="built_in">string</span> knownAs = Convert.ToString(row[<span class="string">&quot;KNOWNAS&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (GeodatabaseFieldException fieldException)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// One of the fields in the where clause might not exist. There are multiple ways this can be handled:</span></span><br><span class="line">    <span class="comment">// Handle error appropriately</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// logger.Error(exception.Message);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在表中搜索非拉丁字符"><a href="#在表中搜索非拉丁字符" class="headerlink" title="在表中搜索非拉丁字符"></a>在表中搜索非拉丁字符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line"><span class="keyword">using</span> (Table table = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;TableWithChineseCharacters&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// This will fail with many database systems that expect Latin characters by default</span></span><br><span class="line">  <span class="built_in">string</span> incorrectWhereClause = <span class="string">&quot;颜色 = &#x27;绿&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Correct solution is to prepend the &#x27;National String Prefix&#x27; to the attribute value</span></span><br><span class="line">  <span class="comment">// For example, with SQL Server this value is &#x27;N&#x27;</span></span><br><span class="line">  <span class="comment">// This value is obtained using the SQLSyntax class</span></span><br><span class="line">  <span class="built_in">string</span> nationalStringPrefix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  SQLSyntax sqlSyntax = geodatabase.GetSQLSyntax();</span><br><span class="line">  nationalStringPrefix = sqlSyntax.GetSupportedStrings(SQLStringType.NationalStringPrefix).First();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This Where clause will work</span></span><br><span class="line">  QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    WhereClause = <span class="string">&quot;颜色 = &quot;</span> + nationalStringPrefix + <span class="string">&quot;&#x27;绿&#x27;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用一组对象-ID-搜索表"><a href="#使用一组对象-ID-搜索表" class="headerlink" title="使用一组对象 ID 搜索表"></a>使用一组对象 ID 搜索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RowCursor <span class="title">SearchingATable</span>(<span class="params">Table table, IReadOnlyList&lt;<span class="built_in">long</span>&gt; objectIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    ObjectIDs = objectIDs</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> table.Search(queryFilter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用空间查询过滤器搜索要素类"><a href="#使用空间查询过滤器搜索要素类" class="headerlink" title="使用空间查询过滤器搜索要素类"></a>使用空间查询过滤器搜索要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SearchingAFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass schoolBoundaryFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.SchoolBoundary&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Using a spatial query filter to find all features which have a certain district name and lying within a given Polygon.</span></span><br><span class="line">      SpatialQueryFilter spatialQueryFilter = <span class="keyword">new</span> SpatialQueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;DISTRCTNAME = &#x27;Indian Prairie School District 204&#x27;&quot;</span>,</span><br><span class="line">        FilterGeometry = <span class="keyword">new</span> PolygonBuilderEx(<span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1021880</span>, <span class="number">1867396</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1028223</span>, <span class="number">1870705</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1031165</span>, <span class="number">1866844</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1025373</span>, <span class="number">1860501</span>),</span><br><span class="line">          <span class="keyword">new</span> Coordinate2D(<span class="number">1021788</span>, <span class="number">1863810</span>)</span><br><span class="line">        &#125;).ToGeometry(),</span><br><span class="line"></span><br><span class="line">        SpatialRelationship = SpatialRelationship.Within</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor indianPrairieCursor = schoolBoundaryFeatureClass.Search(spatialQueryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (indianPrairieCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Feature feature = (Feature)indianPrairieCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Process the feature. For example...</span></span><br><span class="line">            Console.WriteLine(feature.GetObjectID());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从表中选择行"><a href="#从表中选择行" class="headerlink" title="从表中选择行"></a>从表中选择行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SelectingRowsFromATable</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter anotherQueryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;FLOOR = 1 AND WING = &#x27;E&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// For Selecting all matching entries.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection anotherSelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to get one record which matches the criteria. No assumptions can be made about which record satisfying the criteria is selected.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection onlyOneSelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.OnlyOne))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to obtain a empty selction which can be used as a container to combine results from different selections.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection emptySelection = enterpriseTable.Select(anotherQueryFilter, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If you want to select all the records in a table.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection allRecordSelection = enterpriseTable.Select(<span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从要素类中选择要素"><a href="#从要素类中选择要素" class="headerlink" title="从要素类中选择要素"></a>从要素类中选择要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SelectingFeaturesFromAFeatureClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">        <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      SpatialQueryFilter spatialFilter = <span class="keyword">new</span> SpatialQueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;FCODE = &#x27;Park&#x27;&quot;</span>,</span><br><span class="line">        FilterGeometry = <span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry(),</span><br><span class="line">        SpatialRelationship = SpatialRelationship.Crosses</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// For Selecting all matching entries.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection anotherSelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to get one record which matches the criteria. No assumptions can be made about which record satisfying the </span></span><br><span class="line">      <span class="comment">// criteria is selected.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection onlyOneSelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.OnlyOne))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// This can be used to obtain a empty selction which can be used as a container to combine results from different selections.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection emptySelection = enterpriseFeatureClass.Select(spatialFilter, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If you want to select all the records in a table.</span></span><br><span class="line">      <span class="keyword">using</span> (Selection allRecordSelection = enterpriseFeatureClass.Select(<span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取表中当前有多少行的计数"><a href="#获取表中当前有多少行的计数" class="headerlink" title="获取表中当前有多少行的计数"></a>获取表中当前有多少行的计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> table = featureLayer.GetTable();</span><br><span class="line"><span class="keyword">var</span> count = table.GetCount();</span><br></pre></td></tr></table></figure>

<h3 id="获取图层的特征计数"><a href="#获取图层的特征计数" class="headerlink" title="获取图层的特征计数"></a>获取图层的特征计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  FeatureClass featureClass = lyr.GetFeatureClass();</span><br><span class="line">  <span class="built_in">long</span> nCount = featureClass.GetCount();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="对表进行排序"><a href="#对表进行排序" class="headerlink" title="对表进行排序"></a>对表进行排序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RowCursor <span class="title">SortWorldCities</span>(<span class="params">FeatureClass worldCitiesTable</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = worldCitiesTable.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    Field countryField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;COUNTRY_NAME&quot;</span>));</span><br><span class="line">    Field cityNameField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;CITY_NAME&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create SortDescription for Country field</span></span><br><span class="line">    SortDescription countrySortDescription = <span class="keyword">new</span> SortDescription(countryField);</span><br><span class="line">    countrySortDescription.CaseSensitivity = CaseSensitivity.Insensitive;</span><br><span class="line">    countrySortDescription.SortOrder = SortOrder.Ascending;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create SortDescription for City field</span></span><br><span class="line">    SortDescription citySortDescription = <span class="keyword">new</span> SortDescription(cityNameField);</span><br><span class="line">    citySortDescription.CaseSensitivity = CaseSensitivity.Insensitive;</span><br><span class="line">    citySortDescription.SortOrder = SortOrder.Ascending;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create our TableSortDescription</span></span><br><span class="line">    TableSortDescription tableSortDescription = <span class="keyword">new</span> TableSortDescription(</span><br><span class="line">      <span class="keyword">new</span> List&lt;SortDescription&gt;() &#123; countrySortDescription, citySortDescription &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> worldCitiesTable.Sort(tableSortDescription);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="计算表的统计信息"><a href="#计算表的统计信息" class="headerlink" title="计算表的统计信息"></a>计算表的统计信息</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calculate the Sum and Average of the Population_1990 and Population_2000 fields, grouped and ordered by Region</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CalculateStatistics</span>(<span class="params">FeatureClass countryFeatureClass</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = </span><br><span class="line">    countryFeatureClass.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get fields</span></span><br><span class="line">    Field regionField = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Region&quot;</span>));</span><br><span class="line">    Field pop1990Field = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Population_1990&quot;</span>));</span><br><span class="line">    Field pop2000Field = featureClassDefinition.GetFields()</span><br><span class="line">      .First(x =&gt; x.Name.Equals(<span class="string">&quot;Population_2000&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create StatisticsDescriptions</span></span><br><span class="line">    StatisticsDescription pop1990StatisticsDescription = </span><br><span class="line">      <span class="keyword">new</span> StatisticsDescription(pop1990Field, </span><br><span class="line">              <span class="keyword">new</span> List&lt;StatisticsFunction&gt;() &#123; StatisticsFunction.Sum, </span><br><span class="line">                                                StatisticsFunction.Average &#125;);</span><br><span class="line">    StatisticsDescription pop2000StatisticsDescription = </span><br><span class="line">      <span class="keyword">new</span> StatisticsDescription(pop2000Field, </span><br><span class="line">              <span class="keyword">new</span> List&lt;StatisticsFunction&gt;() &#123; StatisticsFunction.Sum, </span><br><span class="line">                                                StatisticsFunction.Average &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create TableStatisticsDescription</span></span><br><span class="line">    TableStatisticsDescription tableStatisticsDescription = </span><br><span class="line">        <span class="keyword">new</span> TableStatisticsDescription(<span class="keyword">new</span> List&lt;StatisticsDescription&gt;() &#123; </span><br><span class="line">                  pop1990StatisticsDescription, pop2000StatisticsDescription &#125;);</span><br><span class="line">    tableStatisticsDescription.GroupBy = <span class="keyword">new</span> List&lt;Field&gt;() &#123; regionField &#125;;</span><br><span class="line">    tableStatisticsDescription.OrderBy = </span><br><span class="line">      <span class="keyword">new</span> List&lt;SortDescription&gt;() &#123; <span class="keyword">new</span> SortDescription(regionField) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calculate Statistics</span></span><br><span class="line">    IReadOnlyList&lt;TableStatisticsResult&gt; tableStatisticsResults = </span><br><span class="line">      countryFeatureClass.CalculateStatistics(tableStatisticsDescription);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (TableStatisticsResult tableStatisticsResult <span class="keyword">in</span> tableStatisticsResults)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Get the Region name</span></span><br><span class="line">      <span class="comment">// If multiple fields had been passed into TableStatisticsDescription.GroupBy, there would be multiple values in TableStatisticsResult.GroupBy</span></span><br><span class="line">      <span class="built_in">string</span> regionName = tableStatisticsResult.GroupBy.First().Value.ToString();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the statistics results for the Population_1990 field</span></span><br><span class="line">      StatisticsResult pop1990Statistics = tableStatisticsResult.StatisticsResults[<span class="number">0</span>];</span><br><span class="line">      <span class="built_in">double</span> population1990Sum = pop1990Statistics.Sum;</span><br><span class="line">      <span class="built_in">double</span> population1990Average = pop1990Statistics.Average;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the statistics results for the Population_2000 field</span></span><br><span class="line">      StatisticsResult pop2000Statistics = tableStatisticsResult.StatisticsResults[<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">double</span> population2000Sum = pop2000Statistics.Sum;</span><br><span class="line">      <span class="built_in">double</span> population2000Average = pop2000Statistics.Average;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Do something with the results here...</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在单个表上评估-QueryDef"><a href="#在单个表上评估-QueryDef" class="headerlink" title="在单个表上评估 QueryDef"></a>在单个表上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SimpleQueryDef</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef adaCompilantParksQueryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;Park&quot;</span>,</span><br><span class="line">        WhereClause = <span class="string">&quot;ADACOMPLY = &#x27;Yes&#x27;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(adaCompilantParksQueryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            String type = Convert.ToString(row[<span class="string">&quot;ADACOMPLY&quot;</span>]); <span class="comment">// will be &quot;Yes&quot; for each row.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">              Table table = row.GetTable(); <span class="comment">// Will always throw exception.</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (NotSupportedException exception)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// Handle not supported exception.</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-WHERE-子句计算连接上的-QueryDef"><a href="#使用-WHERE-子句计算连接上的-QueryDef" class="headerlink" title="使用 WHERE 子句计算连接上的 QueryDef"></a>使用 WHERE 子句计算连接上的 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoiningWithWhereQueryDef</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef municipalEmergencyFacilitiesQueryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        SubFields = <span class="string">&quot;EmergencyFacility.OBJECTID, EmergencyFacility.Shape, EmergencyFacility.FACILITYID, FacilitySite.FACILITYID, FacilitySite.FCODE&quot;</span>,</span><br><span class="line">        Tables = <span class="string">&quot;EmergencyFacility, FacilitySite&quot;</span>,</span><br><span class="line">        WhereClause = <span class="string">&quot;EmergencyFacility.FACNAME = FacilitySite.NAME AND EmergencyFacility.JURISDICT = &#x27;Municipal&#x27;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(municipalEmergencyFacilitiesQueryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">long</span> objectID = Convert.ToInt64(row[<span class="string">&quot;EmergencyFacility.OBJECTID&quot;</span>]);</span><br><span class="line">            String featureCode = Convert.ToString(row[<span class="string">&quot;FacilitySite.FCODE&quot;</span>]);</span><br><span class="line"></span><br><span class="line">            IReadOnlyList&lt;Field&gt; fields = feature.GetFields(); <span class="comment">//Contains one ArcGIS.Core.Data.Field objects for every subfield</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在外部连接上计算-QueryDef"><a href="#在外部连接上计算-QueryDef" class="headerlink" title="在外部连接上计算 QueryDef"></a>在外部连接上计算 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithOuterJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDefWithLeftOuterJoin = <span class="keyword">new</span> QueryDef</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;CommunityAddress LEFT OUTER JOIN MunicipalBoundary on CommunityAddress.Municipality = MunicipalBoundary.Name&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;CommunityAddress.OBJECTID, CommunityAddress.Shape, CommunityAddress.SITEADDID, CommunityAddress.ADDRNUM, CommunityAddress.FULLNAME, CommunityAddress.FULLADDR, CommunityAddress.MUNICIPALITY, MunicipalBoundary.Name, MunicipalBoundary.MUNITYP, MunicipalBoundary.LOCALFIPS&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = geodatabase.Evaluate(queryDefWithLeftOuterJoin, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            Feature feature = row <span class="keyword">as</span> Feature;</span><br><span class="line">            Geometry shape = feature.GetShape();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> siteAddressId = Convert.ToInt32(row[<span class="string">&quot;CommunityAddress.SITEADDID&quot;</span>]);</span><br><span class="line">            String stateName = Convert.ToString(row[<span class="string">&quot;MunicipalBoundary.name&quot;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在内部连接上评估-QueryDef"><a href="#在内部连接上评估-QueryDef" class="headerlink" title="在内部连接上评估 QueryDef"></a>在内部连接上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithInnerJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDef = <span class="keyword">new</span> QueryDef()</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;People INNER JOIN States ON People.FK_STATE_ID = States.OBJECTID&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;People.OBJECTID, People.First_Name, People.Last_Name, People.City, States.State_Name&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = geodatabase.Evaluate(queryDef))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Handle row</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在嵌套-INNER-和-OUTER-连接上评估-QueryDef"><a href="#在嵌套-INNER-和-OUTER-连接上评估-QueryDef" class="headerlink" title="在嵌套 - INNER 和 OUTER 连接上评估 QueryDef"></a>在嵌套 - INNER 和 OUTER 连接上评估 QueryDef</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">EvaluatingQueryDefWithNestedJoin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDef queryDef = <span class="keyword">new</span> QueryDef()</span><br><span class="line">      &#123;</span><br><span class="line">        Tables = <span class="string">&quot;((People INNER JOIN States ON People.FK_STATE_ID = States.OBJECTID) LEFT OUTER JOIN Homes ON People.OBJECTID = Homes.FK_People_ID)&quot;</span>,</span><br><span class="line">        SubFields = <span class="string">&quot;People.OBJECTID, People.First_Name, People.Last_Name, States.State_Name, Homes.Address&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = geodatabase.Evaluate(queryDef, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Handle row</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为数据库表创建默认查询描述并获取查询描述的-ArcGIS-Core-Data-Table"><a href="#为数据库表创建默认查询描述并获取查询描述的-ArcGIS-Core-Data-Table" class="headerlink" title="为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table"></a>为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DefaultQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;CUSTOMERS&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use table</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从数据库表的自定义查询创建查询说明"><a href="#从数据库表的自定义查询创建查询说明" class="headerlink" title="从数据库表的自定义查询创建查询说明"></a>从数据库表的自定义查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CustomQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;SELECT OBJECTID, Shape, FACILITYID FROM EmergencyFacility WHERE JURISDICT = &#x27;Municipal&#x27;&quot;</span>, <span class="string">&quot;MunicipalEmergencyFacilities&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the table.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从没有不可为空的唯一-id-列的联接查询创建查询说明"><a href="#从没有不可为空的唯一-id-列的联接查询创建查询说明" class="headerlink" title="从没有不可为空的唯一 id 列的联接查询创建查询说明"></a>从没有不可为空的唯一 id 列的联接查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoinQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = </span><br><span class="line">    <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription queryDescription = database.GetQueryDescription(<span class="string">&quot;SELECT BUSLINES.ID as BUSLINESID, BUSSTOPS.ID as BUSSTOPSID, BUSLINES.RTE_DESC, BUSLINES.DIR, BUSSTOPS.JURISDIC, BUSSTOPS.LOCATION, BUSSTOPS.ROUTE,BUSSTOPS.SHAPE from demosql.dbo.BUSSTOPS JOIN demosql.dbo.BUSLINES ON BUSSTOPS.ROUTE = BUSLINES.ROUTE&quot;</span>, <span class="string">&quot;BusInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      queryDescription.SetObjectIDFields(<span class="string">&quot;BUSLINESID,BUSSTOPSID&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table table = database.OpenTable(queryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use the table.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从具有多个形状类型的数据库表的查询创建查询说明"><a href="#从具有多个形状类型的数据库表的查询创建查询说明" class="headerlink" title="从具有多个形状类型的数据库表的查询创建查询说明"></a>从具有多个形状类型的数据库表的查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">MultiGeometryQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    DatabaseConnectionProperties databaseConnectionProperties = <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.SQLServer)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(databaseConnectionProperties))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription pointQueryDescription = database.GetQueryDescription(<span class="string">&quot;select Description, SHAPE, UniqueID from MULTIGEOMETRYTEST&quot;</span>, <span class="string">&quot;MultiGeometryPoint&quot;</span>);</span><br><span class="line">      pointQueryDescription.SetShapeType(GeometryType.Point);</span><br><span class="line">      <span class="keyword">using</span> (Table pointTable = database.OpenTable(pointQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use pointTable</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      QueryDescription polygonQueryDescription = database.GetQueryDescription(<span class="string">&quot;select Description, SHAPE, UniqueID from MULTIGEOMETRYTEST&quot;</span>, <span class="string">&quot;MultiGeometryPolygon&quot;</span>);</span><br><span class="line">      polygonQueryDescription.SetShapeType(GeometryType.Polygon);</span><br><span class="line">      <span class="keyword">using</span> (Table polygonTable = database.OpenTable(polygonQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//use polygonTable</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从-SQLite-数据库表的查询创建查询说明"><a href="#从-SQLite-数据库表的查询创建查询说明" class="headerlink" title="从 SQLite 数据库表的查询创建查询说明"></a>从 SQLite 数据库表的查询创建查询说明</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SqliteQueryDescription</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(<span class="keyword">new</span> SQLiteConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path\\To\\Sqlite\\Database\\USA.sqlite&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryDescription washingtonCitiesQueryDescription = database.GetQueryDescription(<span class="string">&quot;select OBJECTID, Shape, CITY_FIPS, CITY_NAME, STATE_FIPS, STATE_CITY, TYPE, CAPITAL from main.cities where STATE_NAME=&#x27;Washington&#x27;&quot;</span>, <span class="string">&quot;WashingtonCities&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Table washingtonTable = database.OpenTable(washingtonCitiesQueryDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use washingtonTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-SQLSyntax-形成与平台无关的查询"><a href="#使用-SQLSyntax-形成与平台无关的查询" class="headerlink" title="使用 SQLSyntax 形成与平台无关的查询"></a>使用 SQLSyntax 形成与平台无关的查询</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UsingSqlSyntaxToFormPlatformAgnosticQueries</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;C:\\Data\\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      SQLSyntax sqlSyntax = geodatabase.GetSQLSyntax();</span><br><span class="line">      <span class="built_in">string</span> substringFunctionName = sqlSyntax.GetFunctionName(SQLFunction.Substring);</span><br><span class="line">      <span class="built_in">string</span> upperFunctionName = sqlSyntax.GetFunctionName(SQLFunction.Upper);</span><br><span class="line">      <span class="built_in">string</span> substringfunction = <span class="built_in">string</span>.Format(<span class="string">&quot;&#123;0&#125;(&#123;1&#125;(FCODE, 1, 6)) = &#x27;SCHOOL&#x27;&quot;</span>, upperFunctionName, substringFunctionName);</span><br><span class="line"></span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter</span><br><span class="line">      &#123;</span><br><span class="line">        WhereClause = substringfunction</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">using</span> (Selection selection = featureClass.Select(queryFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// work with the selection.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将文件地理数据库要素类连接到具有虚拟关系类的-Oracle-数据库查询图层要素类"><a href="#将文件地理数据库要素类连接到具有虚拟关系类的-Oracle-数据库查询图层要素类" class="headerlink" title="将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类"></a>将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoiningFileGeodatabaseFeatureClassToOracleQueryLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;C:\\Data\\LocalGovernment.gdb&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Database database = <span class="keyword">new</span> Database(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (FeatureClass leftFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;Hospital&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table rightTable = database.OpenTable(database.GetQueryDescription(<span class="string">&quot;FacilitySite&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">      Field originPrimaryKey = leftFeatureClass.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;facilityId&quot;</span>));</span><br><span class="line">      Field destinationForeignKey = rightTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;hospitalID&quot;</span>));</span><br><span class="line"></span><br><span class="line">      VirtualRelationshipClassDescription description = </span><br><span class="line">      <span class="keyword">new</span> VirtualRelationshipClassDescription(</span><br><span class="line">        originPrimaryKey, destinationForeignKey, RelationshipCardinality.OneToOne);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = leftFeatureClass.RelateTo(rightTable, description))</span><br><span class="line">      &#123;</span><br><span class="line">        JoinDescription joinDescription = <span class="keyword">new</span> JoinDescription(relationshipClass)</span><br><span class="line">        &#123;</span><br><span class="line">          JoinDirection = JoinDirection.Forward,</span><br><span class="line">          JoinType = JoinType.LeftOuterJoin</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Join <span class="keyword">join</span> = <span class="keyword">new</span> Join(joinDescription);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Table joinedTable = <span class="keyword">join</span>.GetJoinedTable())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Perform operation on joined table.</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="连接来自不同地理数据库的两个表"><a href="#连接来自不同地理数据库的两个表" class="headerlink" title="连接来自不同地理数据库的两个表"></a>连接来自不同地理数据库的两个表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoinTablesFromDifferentGeodatabases</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase sourceGeodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path \\ to \\Geodatabase \\ one&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase destinationGeodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">&quot;Path \\ to \\Geodatabase \\ two&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table sourceTable = sourceGeodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;State&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table destinationTable = destinationGeodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;Cities&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      Field primaryKeyField = sourceTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;State.State_Abbreviation&quot;</span>));</span><br><span class="line">      Field foreignKeyField = destinationTable.GetDefinition().GetFields().FirstOrDefault(field =&gt; field.Name.Equals(<span class="string">&quot;Cities.State&quot;</span>));</span><br><span class="line"></span><br><span class="line">      VirtualRelationshipClassDescription virtualRelationshipClassDescription = <span class="keyword">new</span> VirtualRelationshipClassDescription(primaryKeyField, foreignKeyField, RelationshipCardinality.OneToMany);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RelationshipClass relationshipClass = sourceTable.RelateTo(destinationTable, virtualRelationshipClassDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        JoinDescription joinDescription = <span class="keyword">new</span> JoinDescription(relationshipClass)</span><br><span class="line">        &#123;</span><br><span class="line">          JoinDirection = JoinDirection.Forward,</span><br><span class="line">          JoinType = JoinType.InnerJoin,</span><br><span class="line">          TargetFields = sourceTable.GetDefinition().GetFields()</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Join <span class="keyword">join</span> = <span class="keyword">new</span> Join(joinDescription))</span><br><span class="line">        &#123;</span><br><span class="line">          Table joinedTable = <span class="keyword">join</span>.GetJoinedTable();</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Process the joined table. For example ..</span></span><br><span class="line">          <span class="keyword">using</span> (RowCursor cursor = joinedTable.Search())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">using</span> (Row row = cursor.Current)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Use Row</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用在地理数据库中连接两个版本化表的查询创建查询表"><a href="#使用在地理数据库中连接两个版本化表的查询创建查询表" class="headerlink" title="使用在地理数据库中连接两个版本化表的查询创建查询表"></a>使用在地理数据库中连接两个版本化表的查询创建查询表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">QueryTableJoinWithVersionedData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    QueryDef queryDef = <span class="keyword">new</span> QueryDef</span><br><span class="line">    &#123;</span><br><span class="line">      Tables = <span class="string">&quot;CommunityAddress JOIN MunicipalBoundary on CommunityAddress.Municipality = MunicipalBoundary.Name&quot;</span>,</span><br><span class="line">      SubFields = <span class="string">&quot;CommunityAddress.OBJECTID, CommunityAddress.Shape, CommunityAddress.SITEADDID, CommunityAddress.ADDRNUM, CommunityAddress.FULLNAME, CommunityAddress.FULLADDR, CommunityAddress.MUNICIPALITY, MunicipalBoundary.Name, MunicipalBoundary.MUNITYP, MunicipalBoundary.LOCALFIPS&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase testVersion1Geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;user.testVersion1&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryTableDescription queryTableDescription = <span class="keyword">new</span> QueryTableDescription(queryDef)</span><br><span class="line">      &#123;</span><br><span class="line">        Name = <span class="string">&quot;CommunityAddrJounMunicipalBoundr&quot;</span>,</span><br><span class="line">        PrimaryKeys = testVersion1Geodatabase.GetSQLSyntax().QualifyColumnName(<span class="string">&quot;CommunityAddress&quot;</span>, <span class="string">&quot;OBJECTID&quot;</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Will be based on testVersion1.</span></span><br><span class="line">      <span class="keyword">using</span> (Table queryTable = testVersion1Geodatabase.OpenQueryTable(queryTableDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use queryTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase testVersion2Geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionProperties(EnterpriseDatabaseType.Oracle)</span><br><span class="line">    &#123;</span><br><span class="line">      AuthenticationMode = AuthenticationMode.DBMS,</span><br><span class="line">      Instance = <span class="string">&quot;instance&quot;</span>,</span><br><span class="line">      User = <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      Password = <span class="string">&quot;password&quot;</span>,</span><br><span class="line">      Database = <span class="string">&quot;database&quot;</span>,</span><br><span class="line">      Version = <span class="string">&quot;user.testVersion2&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryTableDescription queryTableDescription = <span class="keyword">new</span> QueryTableDescription(queryDef)</span><br><span class="line">      &#123;</span><br><span class="line">        Name = <span class="string">&quot;CommunityAddrJounMunicipalBoundr&quot;</span>,</span><br><span class="line">        PrimaryKeys = testVersion2Geodatabase.GetSQLSyntax().QualifyColumnName(<span class="string">&quot;CommunityAddress&quot;</span>, <span class="string">&quot;OBJECTID&quot;</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Will be based on testVersion2.</span></span><br><span class="line">      <span class="keyword">using</span> (Table queryTable = testVersion2Geodatabase.OpenQueryTable(queryTableDescription))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Use queryTable.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查字段值是否为空"><a href="#检查字段值是否为空" class="headerlink" title="检查字段值是否为空"></a>检查字段值是否为空</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = row[field.Name];</span><br><span class="line"><span class="keyword">if</span> (val <span class="keyword">is</span> DBNull || val == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// field value is null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// field value is not null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从字段中获取域字符串"><a href="#从字段中获取域字符串" class="headerlink" title="从字段中获取域字符串"></a>从字段中获取域字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetDomainStringFromField</span>(<span class="params">Row row, Field field</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the table and table definition from the Row</span></span><br><span class="line">  <span class="keyword">using</span> (Table table = row.GetTable())</span><br><span class="line">  <span class="keyword">using</span> (TableDefinition tableDefinition = table.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get name of subtype field</span></span><br><span class="line">    <span class="built_in">string</span> subtypeFieldName = tableDefinition.GetSubtypeField();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get subtype, if any</span></span><br><span class="line">    Subtype subtype = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (subtypeFieldName.Length != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Get value of subtype field for this row</span></span><br><span class="line">      <span class="keyword">var</span> varSubtypeCode = row[subtypeFieldName];</span><br><span class="line">      <span class="built_in">long</span> subtypeCode = (<span class="built_in">long</span>)varSubtypeCode;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get subtype for this row</span></span><br><span class="line">      subtype = tableDefinition.GetSubtypes().First(x =&gt; x.GetCode() == subtypeCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the coded value domain for this field</span></span><br><span class="line">    CodedValueDomain domain = field.GetDomain(subtype) <span class="keyword">as</span> CodedValueDomain;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the text string for this field</span></span><br><span class="line">    <span class="keyword">if</span> (domain != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> domain.GetName(row[field.Name]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> row[field.Name].ToString();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编辑-1"><a href="#编辑-1" class="headerlink" title="编辑"></a>编辑</h2><h3 id="创建行"><a href="#创建行" class="headerlink" title="创建行"></a>创建行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingARow</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> creationResult = <span class="literal">false</span>;</span><br><span class="line">  EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">      <span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//declare the callback here. We are not executing it ~yet~</span></span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        TableDefinition tableDefinition = enterpriseTable.GetDefinition();</span><br><span class="line">        <span class="built_in">int</span> assetNameIndex = tableDefinition.FindField(<span class="string">&quot;ASSETNA&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = enterpriseTable.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Either the field index or the field name can be used in the indexer.</span></span><br><span class="line">          rowBuffer[assetNameIndex] = <span class="string">&quot;wMain&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;COST&quot;</span>] = <span class="number">700</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;ACTION&quot;</span>] = <span class="string">&quot;Open Cut&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// subtype value for &quot;Abandon&quot;.</span></span><br><span class="line">          rowBuffer[tableDefinition.GetSubtypeField()] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Row row = enterpriseTable.CreateRow(rowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// To Indicate that the attribute table has to be updated.</span></span><br><span class="line">            context.Invalidate(row);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        creationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!creationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建特征"><a href="#创建特征" class="headerlink" title="创建特征"></a>创建特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingAFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> creationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//declare the callback here. We are not executing it ~yet~</span></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        FeatureClassDefinition facilitySiteDefinition = enterpriseFeatureClass.GetDefinition();</span><br><span class="line">        <span class="built_in">int</span> facilityIdIndex = facilitySiteDefinition.FindField(<span class="string">&quot;FACILITYID&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = enterpriseFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Either the field index or the field name can be used in the indexer.</span></span><br><span class="line">          rowBuffer[facilityIdIndex] = <span class="string">&quot;wMain&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;NAME&quot;</span>] = <span class="string">&quot;Griffith Park&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;OWNTYPE&quot;</span>] = <span class="string">&quot;Municipal&quot;</span>;</span><br><span class="line">          rowBuffer[<span class="string">&quot;FCODE&quot;</span>] = <span class="string">&quot;Park&quot;</span>;</span><br><span class="line">          <span class="comment">// Add it to Public Attractions Subtype.</span></span><br><span class="line">          rowBuffer[facilitySiteDefinition.GetSubtypeField()] = <span class="number">820</span>;</span><br><span class="line"></span><br><span class="line">          List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">              <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          rowBuffer[facilitySiteDefinition.GetShapeField()] = <span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Feature feature = enterpriseFeatureClass.CreateRow(rowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">//To Indicate that the attribute table has to be updated</span></span><br><span class="line">            context.Invalidate(feature);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;, enterpriseFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        creationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!creationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改行"><a href="#修改行" class="headerlink" title="修改行"></a>修改行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ModifyingARow</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> modificationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter openCutFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;Open Cut&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseTable.Search(openCutFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          TableDefinition tableDefinition = enterpriseTable.GetDefinition();</span><br><span class="line">          <span class="built_in">int</span> subtypeFieldIndex = tableDefinition.FindField(tableDefinition.GetSubtypeField());</span><br><span class="line"></span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table.</span></span><br><span class="line">              <span class="comment">// Has to be called before any changes are made to the row.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line"></span><br><span class="line">              row[<span class="string">&quot;ASSETNA&quot;</span>] = <span class="string">&quot;wMainOpenCut&quot;</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (Convert.ToDouble(row[<span class="string">&quot;COST&quot;</span>]) &gt; <span class="number">700</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Abandon asset if cost is higher than 700 (if that is what you want to do).</span></span><br><span class="line">                row[<span class="string">&quot;ACTION&quot;</span>] = <span class="string">&quot;Open Cut Abandon&quot;</span>;</span><br><span class="line">                row[subtypeFieldIndex] = <span class="number">3</span>; <span class="comment">//subtype value for &quot;Abandon&quot;   </span></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="comment">//After all the changes are done, persist it.</span></span><br><span class="line">              row.Store();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Has to be called after the store too.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        modificationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!modificationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改特征"><a href="#修改特征" class="headerlink" title="修改特征"></a>修改特征</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ModifyingAFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> modificationResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass enterpriseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.FacilitySite&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      FeatureClassDefinition facilitySiteDefinition = enterpriseFeatureClass.GetDefinition();</span><br><span class="line"></span><br><span class="line">      <span class="built_in">int</span> ownTypeIndex = facilitySiteDefinition.FindField(<span class="string">&quot;OWNTYPE&quot;</span>);</span><br><span class="line">      <span class="built_in">int</span> areaIndex = facilitySiteDefinition.FindField(facilitySiteDefinition.GetAreaField());</span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;FCODE = &#x27;Hazardous Materials Facility&#x27; AND OWNTYPE = &#x27;Private&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Feature feature = (Feature)rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table.</span></span><br><span class="line">              <span class="comment">// Has to be called before any changes are made to the row</span></span><br><span class="line">              context.Invalidate(feature);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Transfer all Hazardous Material Facilities to the City.</span></span><br><span class="line">              feature[ownTypeIndex] = <span class="string">&quot;Municipal&quot;</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (Convert.ToDouble(feature[areaIndex]) &gt; <span class="number">50000</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// Set the Shape of the feature to whatever you need.</span></span><br><span class="line">                List&lt;Coordinate2D&gt; newCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1021570</span>, <span class="number">1880583</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1028730</span>, <span class="number">1880994</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1029718</span>, <span class="number">1875644</span>),</span><br><span class="line">                  <span class="keyword">new</span> Coordinate2D(<span class="number">1021405</span>, <span class="number">1875397</span>)</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                feature.SetShape(<span class="keyword">new</span> PolygonBuilderEx(newCoordinates).ToGeometry());</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              feature.Store();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Has to be called after the store too</span></span><br><span class="line">              context.Invalidate(feature);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        modificationResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!modificationResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将值写入-Guid-列"><a href="#将值写入-Guid-列" class="headerlink" title="将值写入 Guid 列"></a>将值写入 Guid 列</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">row[field.Name] = <span class="string">&quot;&#123;&quot;</span> + guid.ToString() + <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="删除行-x2F-要素"><a href="#删除行-x2F-要素" class="headerlink" title="删除行&#x2F;要素"></a>删除行&#x2F;要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingARowOrFeature</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> message = String.Empty;</span><br><span class="line">  <span class="built_in">bool</span> deletionResult = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table enterpriseTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.piCIPCost&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//var geodatabase = new Geodatabase(new FileGeodatabaseConnectionPath(uri)) for a File GDB</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//var shapeFileConnPath = new FileSystemConnectionPath(uri, FileSystemDatastoreType.Shapefile);</span></span><br><span class="line">      <span class="comment">//var shapefile = new FileSystemDatastore(shapeFileConnPath);</span></span><br><span class="line">      <span class="comment">//var table = shapefile.OpenDataset&lt;Table&gt;(strShapeFileName); for a Shape file</span></span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter openCutFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;Open Cut&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (RowCursor rowCursor = enterpriseTable.Search(openCutFilter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// In order to update the Map and/or the attribute table. Has to be called before the delete.</span></span><br><span class="line">              context.Invalidate(row);</span><br><span class="line"></span><br><span class="line">              row.Delete();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, enterpriseTable);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        deletionResult = editOperation.Execute();</span><br><span class="line">        <span class="keyword">if</span> (!deletionResult) message = editOperation.ErrorMessage;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (GeodatabaseException exObj)</span><br><span class="line">      &#123;</span><br><span class="line">        message = exObj.Message;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">    MessageBox.Show(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加附件"><a href="#添加附件" class="headerlink" title="添加附件"></a>添加附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">AddingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass parkFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.Park&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;NUMPARKING &gt; 0&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor parkingCursor = parkFeatureClass.Search(filter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (parkingCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (MemoryStream stream = CreateMemoryStreamFromContentsOf(<span class="string">&quot;Sample.xml&quot;</span>))</span><br><span class="line">          &#123;</span><br><span class="line">            Attachment attachment = <span class="keyword">new</span> Attachment(<span class="string">&quot;Sample.xml&quot;</span>, <span class="string">&quot;text/xml&quot;</span>, stream);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (Row row = parkingCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">long</span> attachmentId = row.AddAttachment(attachment);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> MemoryStream <span class="title">CreateMemoryStreamFromContentsOf</span>(<span class="params">String fileNameWithPath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (FileStream file = <span class="keyword">new</span> FileStream(fileNameWithPath, FileMode.Open, FileAccess.Read))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[file.Length];</span><br><span class="line">    file.Read(bytes, <span class="number">0</span>, (<span class="built_in">int</span>)file.Length);</span><br><span class="line">    memoryStream.Write(bytes, <span class="number">0</span>, (<span class="built_in">int</span>)file.Length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> memoryStream;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新附件"><a href="#更新附件" class="headerlink" title="更新附件"></a>更新附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UpdatingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass landUseCaseFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.LandUseCase&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;CASETYPE = &#x27;Rezoning&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor landUseCursor = landUseCaseFeatureClass.Search(filter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (landUseCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Feature rezoningUseCase = (Feature)landUseCursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            IReadOnlyList&lt;Attachment&gt; rezoningAttachments = rezoningUseCase.GetAttachments();</span><br><span class="line">            IEnumerable&lt;Attachment&gt; filteredAttachments = rezoningAttachments.Where(attachment =&gt; !attachment.GetName().Contains(<span class="string">&quot;rezoning&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (Attachment attachmentToUpdate <span class="keyword">in</span> filteredAttachments)</span><br><span class="line">            &#123;</span><br><span class="line">              attachmentToUpdate.SetName(attachmentToUpdate.GetName().Replace(<span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;Rezoning.pdf&quot;</span>));</span><br><span class="line">              rezoningUseCase.UpdateAttachment(attachmentToUpdate);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除附件"><a href="#删除附件" class="headerlink" title="删除附件"></a>删除附件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingAttachments</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file\\sdefile.sde&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (Table inspectionTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;luCodeInspection&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;1st Notice&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor cursor = inspectionTable.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (Row currentRow = cursor.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            IReadOnlyList&lt;Attachment&gt; rowAttachments = currentRow.GetAttachments(<span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">            IEnumerable&lt;Attachment&gt; attachments = rowAttachments.Where(attachment =&gt; attachment.GetContentType().Equals(<span class="string">&quot;application/pdf&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> attachmentIDs = attachments.Select(attachment =&gt; attachment.GetAttachmentID()) <span class="keyword">as</span> IReadOnlyList&lt;<span class="built_in">long</span>&gt;;</span><br><span class="line">            IReadOnlyDictionary&lt;<span class="built_in">long</span>, Exception&gt; failures = currentRow.DeleteAttachments(attachmentIDs);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (failures.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">//process errors</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="写入-Blob-字段"><a href="#写入-Blob-字段" class="headerlink" title="写入 Blob 字段"></a>写入 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">WriteBlobField</span>(<span class="params">Table table, <span class="built_in">string</span> blobFieldName, <span class="built_in">string</span> imageFileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Read the image file into a MemoryStream</span></span><br><span class="line">    MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream(); ;</span><br><span class="line">    <span class="keyword">using</span> (FileStream imageFile = <span class="keyword">new</span> FileStream(imageFileName, FileMode.Open, FileAccess.Read))</span><br><span class="line">    &#123;</span><br><span class="line">      imageFile.CopyTo(memoryStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new row in the table, and write the Memory Stream into a blob fiele</span></span><br><span class="line">    <span class="keyword">using</span> (RowBuffer rowBuffer = table.CreateRowBuffer())</span><br><span class="line">    &#123;</span><br><span class="line">      rowBuffer[blobFieldName] = memoryStream;</span><br><span class="line">      table.CreateRow(rowBuffer).Dispose();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读取-Blob-字段"><a href="#读取-Blob-字段" class="headerlink" title="读取 Blob 字段"></a>读取 Blob 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ReadBlobField</span>(<span class="params">Table table, QueryFilter queryFilter, <span class="built_in">string</span> blobFieldName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> imageFileBaseName = <span class="string">&quot;C:\\path\\to\\image\\directory\\Image&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for each row that satisfies the search criteria, write the blob field out to an image file</span></span><br><span class="line">    <span class="keyword">using</span> (RowCursor rowCursor = table.Search(queryFilter))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">int</span> fileCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (Row row = rowCursor.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Read the blob field into a MemoryStream</span></span><br><span class="line">          MemoryStream memoryStream = row[blobFieldName] <span class="keyword">as</span> MemoryStream;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Create a file</span></span><br><span class="line">          <span class="keyword">using</span> (FileStream outputFile = <span class="keyword">new</span> FileStream(imageFileBaseName + fileCount.ToString(), FileMode.Create, FileAccess.Write))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// Write the MemoryStream into the file</span></span><br><span class="line">            memoryStream.WriteTo(outputFile);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取按关系类关联的行"><a href="#获取按关系类关联的行" class="headerlink" title="获取按关系类关联的行"></a>获取按关系类关联的行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">GettingRowsRelatedByRelationshipClass</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolationHasInspections&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass violationsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolation&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (Table inspectionTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeInspection&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      List&lt;Row&gt; jeffersonAveViolations = <span class="keyword">new</span> List&lt;Row&gt;();</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;LOCDESC LIKE &#x27;///%Jefferson///%&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = violationsFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          jeffersonAveViolations.Add(rowCursor.Current);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      IReadOnlyList&lt;Row&gt; relatedOriginRows = <span class="literal">null</span>;</span><br><span class="line">      IReadOnlyList&lt;Row&gt; relatedDestinationRows = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        QueryFilter filter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;ACTION = &#x27;1st Notice&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Selection selection = inspectionTable.Select(filter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">        &#123;</span><br><span class="line">          relatedOriginRows = relationshipClass.GetRowsRelatedToDestinationRows(selection.GetObjectIDs());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">bool</span> containsJeffersonAve = relatedOriginRows.Any(row =&gt; Convert.ToString(row[<span class="string">&quot;LOCDESC&quot;</span>]).Contains(<span class="string">&quot;Jefferson&quot;</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;<span class="built_in">long</span>&gt; jeffersonAveViolationObjectIds = jeffersonAveViolations.Select(row =&gt; row.GetObjectID()).ToList();</span><br><span class="line"></span><br><span class="line">        relatedDestinationRows = relationshipClass.GetRowsRelatedToOriginRows(jeffersonAveViolationObjectIds);</span><br><span class="line">        <span class="built_in">bool</span> hasFirstNoticeInspections = relatedDestinationRows.Any(row =&gt; Convert.ToString(row[<span class="string">&quot;ACTION&quot;</span>]).Contains(<span class="string">&quot;1st Notice&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span></span><br><span class="line">      &#123;</span><br><span class="line">        Dispose(jeffersonAveViolations);</span><br><span class="line">        Dispose(relatedOriginRows);</span><br><span class="line">        Dispose(relatedDestinationRows);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params">IEnumerable&lt;Row&gt; rows</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">foreach</span> (Row row <span class="keyword">in</span> rows)</span><br><span class="line">    row.Dispose();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建关系"><a href="#创建关系" class="headerlink" title="创建关系"></a>创建关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingARelationship</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.OverviewToProject&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass projectsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.CIPProjects&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass overviewFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.CIPProjectsOverview&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// This will be PROJNAME. This can be used to get the field index or used directly as the field name.</span></span><br><span class="line">      <span class="built_in">string</span> originKeyField = relationshipClass.GetDefinition().GetOriginKeyField();</span><br><span class="line"></span><br><span class="line">      EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">      editOperation.Callback(context =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// The rows are being added to illustrate adding relationships. If one has existing rows, those can be used to add a relationship.</span></span><br><span class="line">        <span class="keyword">using</span> (RowBuffer projectsRowBuffer = projectsFeatureClass.CreateRowBuffer())</span><br><span class="line">        <span class="keyword">using</span> (RowBuffer overviewRowBuffer = overviewFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          projectsRowBuffer[<span class="string">&quot;TOTCOST&quot;</span>] = <span class="number">500000</span>;</span><br><span class="line"></span><br><span class="line">          overviewRowBuffer[originKeyField] = <span class="string">&quot;LibraryConstruction&quot;</span>;</span><br><span class="line">          overviewRowBuffer[<span class="string">&quot;PROJECTMAN&quot;</span>] = <span class="string">&quot;John Doe&quot;</span>;</span><br><span class="line">          overviewRowBuffer[<span class="string">&quot;FUNDSOUR&quot;</span>] = <span class="string">&quot;Public&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">using</span> (Row projectsRow = projectsFeatureClass.CreateRow(projectsRowBuffer))</span><br><span class="line">          <span class="keyword">using</span> (Row overviewRow = overviewFeatureClass.CreateRow(overviewRowBuffer))</span><br><span class="line">          &#123;</span><br><span class="line">            Relationship relationship = relationshipClass.CreateRelationship(overviewRow, projectsRow);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//To Indicate that the Map has to draw this feature/row and/or the attribute table has to be updated</span></span><br><span class="line">            context.Invalidate(projectsRow);</span><br><span class="line">            context.Invalidate(overviewRow);</span><br><span class="line">            context.Invalidate(relationshipClass);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, projectsFeatureClass, overviewFeatureClass);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">bool</span> editResult = editOperation.Execute();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除关系"><a href="#删除关系" class="headerlink" title="删除关系"></a>删除关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeletingARelationship</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (RelationshipClass relationshipClass = geodatabase.OpenDataset&lt;RelationshipClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolationHasInspections&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass violationsFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;LocalGovernment.GDB.luCodeViolation&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter &#123; WhereClause = <span class="string">&quot;LOCDESC LIKE &#x27;///%Jefferson///%&#x27;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (RowCursor rowCursor = violationsFeatureClass.Search(queryFilter, <span class="literal">false</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (!rowCursor.MoveNext())</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (Row jeffersonAveViolation = rowCursor.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          IReadOnlyList&lt;Row&gt; relatedDestinationRows = relationshipClass.GetRowsRelatedToOriginRows(<span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt; &#123; jeffersonAveViolation.GetObjectID() &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span></span><br><span class="line">          &#123;</span><br><span class="line">            EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">            editOperation.Callback(context =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">foreach</span> (Row relatedDestinationRow <span class="keyword">in</span> relatedDestinationRows)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                  relationshipClass.DeleteRelationship(jeffersonAveViolation, relatedDestinationRow);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (GeodatabaseRelationshipClassException exception)</span><br><span class="line">                &#123;</span><br><span class="line">                  Console.WriteLine(exception);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, relationshipClass);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">bool</span> editResult = editOperation.Execute();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">finally</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (Row row <span class="keyword">in</span> relatedDestinationRows)</span><br><span class="line">              row.Dispose();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用插入游标"><a href="#使用插入游标" class="headerlink" title="使用插入游标"></a>使用插入游标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insert Cursors are intended for use in CoreHost applications, not Pro Add-ins</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UsingInsertCursor</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Table citiesTable = geodatabase.OpenDataset&lt;Table&gt;(<span class="string">&quot;name\\of\\cities_table&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (InsertCursor insertCursor = citiesTable.CreateInsertCursor())</span><br><span class="line">      <span class="keyword">using</span> (RowBuffer rowBuffer = citiesTable.CreateRowBuffer())</span><br><span class="line">      &#123;</span><br><span class="line">        rowBuffer[<span class="string">&quot;State&quot;</span>] = <span class="string">&quot;Colorado&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rowBuffer[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;Fort Collins&quot;</span>;</span><br><span class="line">        rowBuffer[<span class="string">&quot;Population&quot;</span>] = <span class="number">167830</span>;</span><br><span class="line">        insertCursor.Insert(rowBuffer);</span><br><span class="line"></span><br><span class="line">        rowBuffer[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;Denver&quot;</span>;</span><br><span class="line">        rowBuffer[<span class="string">&quot;Population&quot;</span>] = <span class="number">727211</span>;</span><br><span class="line">        insertCursor.Insert(rowBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Insert more rows here</span></span><br><span class="line">        <span class="comment">// A more realistic example would be reading source data from a file</span></span><br><span class="line"></span><br><span class="line">        insertCursor.Flush();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-RowBuffer-在注记要素类中创建新的注记要素"><a href="#使用-RowBuffer-在注记要素类中创建新的注记要素" class="headerlink" title="使用 RowBuffer 在注记要素类中创建新的注记要素"></a>使用 RowBuffer 在注记要素类中创建新的注记要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">CreatingAnAnnotationFeature</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeatureClass annotationFeatureClass = geodatabase.OpenDataset&lt;AnnotationFeatureClass&gt;(<span class="string">&quot;Annotation // feature // class // name&quot;</span>))</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeatureClassDefinition annotationFeatureClassDefinition = annotationFeatureClass.GetDefinition())</span><br><span class="line">    <span class="keyword">using</span> (RowBuffer rowBuffer = annotationFeatureClass.CreateRowBuffer())</span><br><span class="line">    <span class="keyword">using</span> (AnnotationFeature annotationFeature = annotationFeatureClass.CreateRow(rowBuffer))</span><br><span class="line">    &#123;</span><br><span class="line">      annotationFeature.SetAnnotationClassID(<span class="number">0</span>);</span><br><span class="line">      annotationFeature.SetStatus(AnnotationStatus.Placed);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Get the annotation labels from the label collection</span></span><br><span class="line">      IReadOnlyList&lt;CIMLabelClass&gt; labelClasses = </span><br><span class="line">        annotationFeatureClassDefinition.GetLabelClassCollection();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Setup the symbol reference with the symbol id and the text symbol</span></span><br><span class="line">      CIMSymbolReference cimSymbolReference = <span class="keyword">new</span> CIMSymbolReference();</span><br><span class="line">      cimSymbolReference.Symbol = labelClasses[<span class="number">0</span>].TextSymbol.Symbol;</span><br><span class="line">      cimSymbolReference.SymbolName = labelClasses[<span class="number">0</span>].TextSymbol.SymbolName;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Setup the text graphic</span></span><br><span class="line">      CIMTextGraphic cimTextGraphic = <span class="keyword">new</span> CIMTextGraphic();</span><br><span class="line">      cimTextGraphic.Text = <span class="string">&quot;Charlotte, North Carolina&quot;</span>;</span><br><span class="line">      cimTextGraphic.Shape = <span class="keyword">new</span> MapPointBuilderEx(<span class="keyword">new</span> Coordinate2D(<span class="number">-80.843</span>, <span class="number">35.234</span>), SpatialReferences.WGS84).ToGeometry();</span><br><span class="line">      cimTextGraphic.Symbol = cimSymbolReference;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the symbol reference on the graphic and store</span></span><br><span class="line">      annotationFeature.SetGraphic(cimTextGraphic);</span><br><span class="line">      annotationFeature.Store();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h2><h3 id="连接到版本"><a href="#连接到版本" class="headerlink" title="连接到版本"></a>连接到版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Geodatabase <span class="title">ConnectToVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Geodatabase connectedVersion = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version version = versionManager.GetVersion(versionName))</span><br><span class="line">    &#123;</span><br><span class="line">      connectedVersion = version.Connect();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> connectedVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在单独的编辑会话中协调版本并将其与其父级进行核对和提交"><a href="#在单独的编辑会话中协调版本并将其与其父级进行核对和提交" class="headerlink" title="在单独的编辑会话中协调版本并将其与其父级进行核对和提交"></a>在单独的编辑会话中协调版本并将其与其父级进行核对和提交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReconcileAndPost</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get a reference to our version and our parent</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">    <span class="keyword">using</span> (Version parentVersion = currentVersion.GetParent())</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Create a ReconcileDescription object</span></span><br><span class="line">      <span class="comment">//At 2.x - </span></span><br><span class="line">      <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription(parentVersion);</span></span><br><span class="line">      <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue; // continue if conflicts are found</span></span><br><span class="line">      <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Reconcile and post</span></span><br><span class="line">      <span class="comment">//ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ReconcileResult.HasConflicts can be checked as-needed</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create a ReconcileOptions object</span></span><br><span class="line">      <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions(parentVersion);</span><br><span class="line">      reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue; <span class="comment">// continue if conflicts are found</span></span><br><span class="line">      reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByRow; <span class="comment">//Default</span></span><br><span class="line">      reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorTargetVersion;<span class="comment">//or FavorEditVersion</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Reconcile</span></span><br><span class="line">      ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileOptions);</span><br><span class="line">      <span class="keyword">if</span> (!reconcileResult.HasConflicts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//No conflicts, perform the post</span></span><br><span class="line">        <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions(parentVersion);</span><br><span class="line">        <span class="comment">//var postOptions = new PostOptions(); for default version</span></span><br><span class="line">        postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;<span class="comment">//Default</span></span><br><span class="line">        currentVersion.Post(postOptions);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在同一编辑会话中协调版本并将其与其父级提交"><a href="#在同一编辑会话中协调版本并将其与其父级提交" class="headerlink" title="在同一编辑会话中协调版本并将其与其父级提交"></a>在同一编辑会话中协调版本并将其与其父级提交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReconcileAndPost2</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get a reference to our version and our parent</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase.IsVersioningSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">    <span class="keyword">using</span> (Version parentVersion = currentVersion.GetParent())</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Create a ReconcileDescription object</span></span><br><span class="line">      <span class="comment">//At 2.x - </span></span><br><span class="line">      <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription(parentVersion);</span></span><br><span class="line">      <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue; // continue if conflicts are found</span></span><br><span class="line">      <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span>/ Reconcile and post</span></span><br><span class="line">      <span class="comment">//ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ReconcileResult.HasConflicts can be checked as-needed</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create a ReconcileOptions object</span></span><br><span class="line">      <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions(parentVersion);</span><br><span class="line">      reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue; <span class="comment">// continue if conflicts are found</span></span><br><span class="line">      reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByRow; <span class="comment">//Default</span></span><br><span class="line">      reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorTargetVersion;<span class="comment">//or FavorEditVersion</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions(parentVersion);</span><br><span class="line">      <span class="comment">//var postOptions = new PostOptions(); for default version</span></span><br><span class="line">      postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;<span class="comment">//Default</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Reconcile</span></span><br><span class="line">      ReconcileResult reconcileResult = currentVersion.Reconcile(reconcileOptions, postOptions);</span><br><span class="line">      <span class="keyword">if</span> (reconcileResult.HasConflicts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//TODO resolve conflicts</span></span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用版本"><a href="#使用版本" class="headerlink" title="使用版本"></a>使用版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">WorkingWithVersions</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">&quot;path\\to\\sde\\file&quot;</span>))))</span><br><span class="line">    <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">    &#123;</span><br><span class="line">      IReadOnlyList&lt;Version&gt; versionList = versionManager.GetVersions();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//The default version will have a null Parent</span></span><br><span class="line">      Version defaultVersion = versionList.First(version =&gt; version.GetParent() == <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">      IEnumerable&lt;Version&gt; publicVersions = versionList.Where(</span><br><span class="line">        version =&gt; version.GetAccessType() == VersionAccessType.Public);</span><br><span class="line">      Version qaVersion = defaultVersion.GetChildren().First(</span><br><span class="line">        version =&gt; version.GetName().Contains(<span class="string">&quot;QA&quot;</span>));</span><br><span class="line"></span><br><span class="line">      Geodatabase qaVersionGeodatabase = qaVersion.Connect();</span><br><span class="line"></span><br><span class="line">      FeatureClass currentFeatureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;featureClassName&quot;</span>);</span><br><span class="line">      FeatureClass qaFeatureClass = qaVersionGeodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;featureClassName&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用默认版本"><a href="#使用默认版本" class="headerlink" title="使用默认版本"></a>使用默认版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check to see if the current version is default.</span></span><br><span class="line"><span class="comment">// Works with both branch and traditional versioning.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsDefaultVersion</span>(<span class="params">Version version</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Version parentVersion = version.GetParent();</span><br><span class="line">  <span class="keyword">if</span> (parentVersion == <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  parentVersion.Dispose();</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsDefaultVersion</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  <span class="keyword">using</span> (Version currentVersion = versionManager.GetCurrentVersion())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> IsDefaultVersion(currentVersion);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets the default version.</span></span><br><span class="line"><span class="comment">// Works with both branch and traditional versioning.</span></span><br><span class="line"><span class="comment">// Note that this routine depends on IsDefaultVersion(), above.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">GetDefaultVersion</span>(<span class="params">Version version</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (IsDefaultVersion(version))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    Version parent = version.GetParent();</span><br><span class="line">    Version ancestor = GetDefaultVersion(parent);</span><br><span class="line">    <span class="keyword">if</span> (parent != ancestor)</span><br><span class="line">    &#123;</span><br><span class="line">      parent.Dispose(); <span class="comment">//If the versioning tree is more than 2 deep, we want to dispose any intermediary versions</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ancestor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">GetDefaultVersion</span>(<span class="params">Geodatabase geodatabase</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    Version currentVersion = versionManager.GetCurrentVersion();</span><br><span class="line">    Version defaultVersion = GetDefaultVersion(currentVersion);</span><br><span class="line">    <span class="keyword">if</span> (currentVersion != defaultVersion)</span><br><span class="line">    &#123;</span><br><span class="line">      currentVersion.Dispose(); <span class="comment">// If we are not pointing to default, we want to dispose this Version object</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultVersion;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建版本"><a href="#创建版本" class="headerlink" title="创建版本"></a>创建版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Version <span class="title">CreateVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName, <span class="built_in">string</span> description, VersionAccessType versionAccessType</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!geodatabase.IsVersioningSupported()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    VersionDescription versionDescription = <span class="keyword">new</span> VersionDescription(versionName, description, versionAccessType);</span><br><span class="line">    <span class="keyword">return</span> versionManager.CreateVersion(versionDescription);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建历史版本"><a href="#创建历史版本" class="headerlink" title="创建历史版本"></a>创建历史版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> HistoricalVersion <span class="title">CreateHistoricalVersion</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> versionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">    HistoricalVersionDescription historicalVersionDescription = <span class="keyword">new</span> HistoricalVersionDescription(versionName, DateTime.Now);</span><br><span class="line">    HistoricalVersion historicalVersion = versionManager.CreateHistoricalVersion(historicalVersionDescription);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> historicalVersion;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在版本之间切换"><a href="#在版本之间切换" class="headerlink" title="在版本之间切换"></a>在版本之间切换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeVersions</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> toVersionName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (VersionManager versionManager = geodatabase.GetVersionManager())</span><br><span class="line">  &#123;</span><br><span class="line">   VersionBaseType versionBaseType = versionManager.GetCurrentVersionBaseType();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (versionBaseType == VersionBaseType.Version)</span><br><span class="line">   &#123;</span><br><span class="line">     Version fromVersion = versionManager.GetCurrentVersion();</span><br><span class="line">     Version toVersion = versionManager.GetVersion(toVersionName);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Switch between versions</span></span><br><span class="line">     MapView.Active.Map.ChangeVersion(fromVersion,toVersion);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (versionBaseType == VersionBaseType.HistoricalVersion)</span><br><span class="line">   &#123;</span><br><span class="line">     HistoricalVersion fromHistoricalVersion = versionManager.GetCurrentHistoricalVersion();</span><br><span class="line">     HistoricalVersion toHistoricalVersion = versionManager.GetHistoricalVersion(toVersionName);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Switch between historical versions</span></span><br><span class="line">     MapView.Active.Map.ChangeVersion(fromHistoricalVersion, toHistoricalVersion);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Switch from HistoricalVersion to Version and vice-versa </span></span><br><span class="line">   <span class="comment">// MapView.Active.Map.ChangeVersion(fromHistoricalVersion, toVersion);</span></span><br><span class="line">   <span class="comment">// MapView.Active.Map.ChangeVersion(fromVersion, toHistoricalVersion);</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="部分过账"><a href="#部分过账" class="headerlink" title="部分过账"></a>部分过账</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Partial posting allows developers to post a subset of changes made in a version.</span></span><br><span class="line"><span class="comment">// One sample use case is an electric utility that uses a version to design the facilities in</span></span><br><span class="line"><span class="comment">// a new housing subdivision. At some point in the process, one block of new houses have been</span></span><br><span class="line"><span class="comment">// completed, while the rest of the subdivision remains unbuilt.  Partial posting allows the user</span></span><br><span class="line"><span class="comment">// to post the completed work, while leaving not yet constructed features in the version to be</span></span><br><span class="line"><span class="comment">// posted later. Partial posting requires a branch-versioned feature service using ArcGIS</span></span><br><span class="line"><span class="comment">// Enterprise 10.9 and higher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Specify a set of features that were constructed</span></span><br><span class="line">QueryFilter constructedFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">&#123;</span><br><span class="line">  WhereClause = <span class="string">&quot;ConstructedStatus = &#x27;True&#x27;&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// This selection represents the inserts and updates to the support</span></span><br><span class="line"><span class="comment">// structure feature class that we wish to post</span></span><br><span class="line"><span class="keyword">using</span> (Selection constructedSupportStructures = </span><br><span class="line">    supportStructureFeatureClass.Select(</span><br><span class="line">      constructedFilter, SelectionType.ObjectID, SelectionOption.Normal))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Specifying which feature deletions you wish to post is slightly trickier, since you cannot issue</span></span><br><span class="line">  <span class="comment">// a query to fetch a set of deleted features Instead, a list of ObjectIDs must be used</span></span><br><span class="line">  <span class="keyword">using</span> (Selection deletedSupportStructures = supportStructureFeatureClass.Select(</span><br><span class="line">                                      <span class="literal">null</span>, SelectionType.ObjectID, SelectionOption.Empty))</span><br><span class="line">  &#123;</span><br><span class="line">    deletedSupportStructures.Add(deletedSupportStructureObjectIDs);  <span class="comment">//deletedSupportStructureObjectIDs is</span></span><br><span class="line">                                                                     <span class="comment">//defined as List&lt;long&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Perform the reconcile with partial post</span></span><br><span class="line">    <span class="comment">//At 2.x - </span></span><br><span class="line">    <span class="comment">//ReconcileDescription reconcileDescription = new ReconcileDescription();</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictDetectionType = ConflictDetectionType.ByColumn;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictResolutionMethod = ConflictResolutionMethod.Continue;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.ConflictResolutionType = ConflictResolutionType.FavorEditVersion;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.PartialPostSelections = new List&lt;Selection&gt;() &#123; constructedSupportStructures, deletedSupportStructures &#125;;</span></span><br><span class="line">    <span class="comment">//reconcileDescription.WithPost = true;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ReconcileResult reconcileResult = designVersion.Reconcile(reconcileDescription);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> reconcileOptions = <span class="keyword">new</span> ReconcileOptions();<span class="comment">//reconcile against Default</span></span><br><span class="line">    reconcileOptions.ConflictDetectionType = ConflictDetectionType.ByColumn;</span><br><span class="line">    reconcileOptions.ConflictResolutionMethod = ConflictResolutionMethod.Continue;</span><br><span class="line">    reconcileOptions.ConflictResolutionType = ConflictResolutionType.FavorEditVersion;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> postOptions = <span class="keyword">new</span> PostOptions();<span class="comment">//post against Default</span></span><br><span class="line">    postOptions.PartialPostSelections = <span class="keyword">new</span> List&lt;Selection&gt;() &#123; </span><br><span class="line">                    constructedSupportStructures, deletedSupportStructures &#125;;</span><br><span class="line">    postOptions.ServiceSynchronizationType = ServiceSynchronizationType.Synchronous;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> reconcileResult = designVersion.Reconcile(reconcileOptions, postOptions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO process result(s)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a PoleInspection table with the following fields</span></span><br><span class="line"><span class="comment">//  GlobalID</span></span><br><span class="line"><span class="comment">//  ObjectID</span></span><br><span class="line"><span class="comment">//  InspectionDate (date)</span></span><br><span class="line"><span class="comment">//  InspectionResults (pre-existing InspectionResults coded value domain)</span></span><br><span class="line"><span class="comment">//  InspectionNotes (string)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a GlobalID field with default values</span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an ObjectID field with default values</span></span><br><span class="line">FieldDescription objectIDFieldDescription = FieldDescription.CreateObjectIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FieldDescription for the InspectionDate field</span></span><br><span class="line">FieldDescription inspectionDateFieldDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;InspectionDate&quot;</span>, FieldType.Date)</span><br><span class="line">&#123;</span><br><span class="line">  AliasName = <span class="string">&quot;Inspection Date&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a Domain field (from a pre-existing domain)</span></span><br><span class="line">FieldDescription inspectionResultsFieldDescription = FieldDescription.CreateDomainField(<span class="string">&quot;InspectionResults&quot;</span>, <span class="keyword">new</span> CodedValueDomainDescription(inspectionResultsDomain));</span><br><span class="line">inspectionResultsFieldDescription.AliasName = <span class="string">&quot;Inspection Results&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a string field</span></span><br><span class="line">FieldDescription inspectionNotesFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;InspectionNotes&quot;</span>, <span class="number">512</span>);</span><br><span class="line">inspectionNotesFieldDescription.AliasName = <span class="string">&quot;Inspection Notes&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assemble a list of all of our field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123; globalIDFieldDescription, objectIDFieldDescription, inspectionDateFieldDescription, inspectionResultsFieldDescription, inspectionNotesFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a TableDescription object to describe the table to create</span></span><br><span class="line">TableDescription tableDescription = <span class="keyword">new</span> TableDescription(<span class="string">&quot;PoleInspection&quot;</span>, fieldDescriptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of PoleInspection to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(tableDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建要素类"><a href="#创建要素类" class="headerlink" title="创建要素类"></a>创建要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a Cities feature class with the following fields</span></span><br><span class="line"><span class="comment">//  GlobalID</span></span><br><span class="line"><span class="comment">//  ObjectID</span></span><br><span class="line"><span class="comment">//  Name (string)</span></span><br><span class="line"><span class="comment">//  Population (integer)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a GlobalID field with default values</span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an ObjectID field with default values</span></span><br><span class="line">FieldDescription objectIDFieldDescription = FieldDescription.CreateObjectIDField();</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for a string field</span></span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This static helper routine creates a FieldDescription for an integer field</span></span><br><span class="line">FieldDescription populationFieldDescription = FieldDescription.CreateIntegerField(<span class="string">&quot;Population&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assemble a list of all of our field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123; globalIDFieldDescription, objectIDFieldDescription, nameFieldDescription, populationFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Point, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively, ShapeDescriptions can be created from another feature class.  In this case, the new feature class will inherit the same shape properties of the existing class</span></span><br><span class="line">ShapeDescription alternativeShapeDescription = <span class="keyword">new</span> ShapeDescription(existingFeatureClass.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClassDescription object to describe the feature class to create</span></span><br><span class="line">FeatureClassDescription featureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(<span class="string">&quot;Cities&quot;</span>, fieldDescriptions, shapeDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the Cities feature class to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a TableDescription object</span></span><br><span class="line">TableDescription tableDescription = <span class="keyword">new</span> TableDescription(table.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the deletion of the table to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Delete(tableDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="删除要素类"><a href="#删除要素类" class="headerlink" title="删除要素类"></a>删除要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FeatureClassDescription object</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClass.GetDefinition());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the deletion fo the feature class to our list of DDL tasks</span></span><br><span class="line">schemaBuilder.Delete(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="打开内存地理数据库"><a href="#打开内存地理数据库" class="headerlink" title="打开内存地理数据库"></a>打开内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Connects to the default memory geodatabase, if exists otherwise throws exception</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively, connects to memory geodatabase named as &#x27;InterimMemoryGeodatabase&#x27;</span></span><br><span class="line"><span class="comment">// MemoryConnectionProperties memoryConnectionProperties = new MemoryConnectionProperties(&quot;InterimMemoryGeodatabase&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Opens the memory geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(memoryConnectionProperties))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Use memory geodatabase</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建内存地理数据库"><a href="#创建内存地理数据库" class="headerlink" title="创建内存地理数据库"></a>创建内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the memory connection properties to connect to  default memory geodatabase</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alternatively create the memory connection properties to connect to memory geodatabase named as &#x27;InterimMemoryGeodatabase&#x27;</span></span><br><span class="line"><span class="comment">// MemoryConnectionProperties memoryConnectionProperties = new MemoryConnectionProperties(&quot;InterimMemoryGeodatabase&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the memory geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = SchemaBuilder.CreateGeodatabase(memoryConnectionProperties))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除内存地理数据库"><a href="#删除内存地理数据库" class="headerlink" title="删除内存地理数据库"></a>删除内存地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the memory connection properties to connect to default memory geodatabase</span></span><br><span class="line">MemoryConnectionProperties memoryConnectionProperties = <span class="keyword">new</span> MemoryConnectionProperties();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the memory geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(memoryConnectionProperties);</span><br></pre></td></tr></table></figure>

<h3 id="创建文件地理数据库"><a href="#创建文件地理数据库" class="headerlink" title="创建文件地理数据库"></a>创建文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileGeodatabaseConnectionPath with the name of the file geodatabase you wish to create</span></span><br><span class="line">FileGeodatabaseConnectionPath fileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-File-Geodatabase\YourName.gdb&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the file geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = </span><br><span class="line">  SchemaBuilder.CreateGeodatabase(fileGeodatabaseConnectionPath))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除文件地理数据库"><a href="#删除文件地理数据库" class="headerlink" title="删除文件地理数据库"></a>删除文件地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileGeodatabaseConnectionPath with the name of the file geodatabase you wish to delete</span></span><br><span class="line">FileGeodatabaseConnectionPath fileGeodatabaseConnectionPath = <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-File-Geodatabase\YourName.gdb&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the file geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(fileGeodatabaseConnectionPath);</span><br></pre></td></tr></table></figure>

<h3 id="创建移动地理数据库"><a href="#创建移动地理数据库" class="headerlink" title="创建移动地理数据库"></a>创建移动地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a MobileGeodatabaseConnectionPath with the name of the mobile geodatabase you wish to create</span></span><br><span class="line">MobileGeodatabaseConnectionPath mobileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> MobileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-Mobile-Geodatabase\YourName.geodatabase&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and use the mobile geodatabase</span></span><br><span class="line"><span class="keyword">using</span> (Geodatabase geodatabase = SchemaBuilder.CreateGeodatabase(mobileGeodatabaseConnectionPath))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create additional schema here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除移动地理数据库"><a href="#删除移动地理数据库" class="headerlink" title="删除移动地理数据库"></a>删除移动地理数据库</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a MobileGeodatabaseConnectionPath with the name of the mobile geodatabase you wish to delete</span></span><br><span class="line">MobileGeodatabaseConnectionPath mobileGeodatabaseConnectionPath = </span><br><span class="line">  <span class="keyword">new</span> MobileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Path-To-Mobile-Geodatabase\YourName.geodatabase&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the mobile geodatabase</span></span><br><span class="line">SchemaBuilder.DeleteGeodatabase(mobileGeodatabaseConnectionPath);</span><br></pre></td></tr></table></figure>

<h3 id="创建范围域"><a href="#创建范围域" class="headerlink" title="创建范围域"></a>创建范围域</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a range description with minimum value = 0 and maximum value = 1000</span></span><br><span class="line">RangeDomainDescription rangeDomainDescriptionMinMax = <span class="keyword">new</span> RangeDomainDescription(<span class="string">&quot;RangeDomain_0_1000&quot;</span>,</span><br><span class="line">  FieldType.Integer, <span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">&#123; Description = <span class="string">&quot;Domain value ranges from 0 to 1000&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create  a range domain </span></span><br><span class="line">schemaBuilder.Create(rangeDomainDescriptionMinMax);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建编码值域"><a href="#创建编码值域" class="headerlink" title="创建编码值域"></a>创建编码值域</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a CodedValueDomain description for water pipes</span></span><br><span class="line">CodedValueDomainDescription codedValueDomainDescription = <span class="keyword">new</span> CodedValueDomainDescription(<span class="string">&quot;WaterPipeTypes&quot;</span>, FieldType.String,</span><br><span class="line">  <span class="keyword">new</span> SortedList&lt;<span class="built_in">object</span>, <span class="built_in">string</span>&gt; &#123; &#123; <span class="string">&quot;Copper&quot;</span>, <span class="string">&quot;C_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;Steel&quot;</span>, <span class="string">&quot;S_2&quot;</span> &#125; &#125;)</span><br><span class="line">&#123;</span><br><span class="line">  SplitPolicy = SplitPolicy.Duplicate,</span><br><span class="line">  MergePolicy = MergePolicy.DefaultValue</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a coded value domain </span></span><br><span class="line">CodedValueDomainToken codedValueDomainToken = schemaBuilder.Create(codedValueDomainDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建要素数据集"><a href="#创建要素数据集" class="headerlink" title="创建要素数据集"></a>创建要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureDataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureDataset named as &#x27;Parcel Information&#x27;</span></span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(<span class="string">&quot;Parcel_Information&quot;</span>, SpatialReferences.WGS84);</span><br><span class="line">schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除要素数据集"><a href="#删除要素数据集" class="headerlink" title="删除要素数据集"></a>删除要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Deleting a FeatureDataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(<span class="string">&quot;Parcel_Information&quot;</span>);</span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete an existing feature dataset named as &#x27;Parcel_Information&#x27;</span></span><br><span class="line">schemaBuilder.Delete(featureDatasetDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="重命名要素数据集"><a href="#重命名要素数据集" class="headerlink" title="重命名要素数据集"></a>重命名要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Renaming a FeatureDataset from &#x27;Parcel_Information&#x27; to &#x27;Parcel_Information_With_Tax_Jurisdiction&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> originalDatasetName = <span class="string">&quot;Parcel_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> datasetRenameAs = <span class="string">&quot;Parcel_Information_With_Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition originalDatasetDefinition = </span><br><span class="line">  geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(originalDatasetName);</span><br><span class="line">FeatureDatasetDescription originalFeatureDatasetDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureDatasetDescription(originalDatasetDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rename the existing FeatureDataset, &#x27;Parcel_Information&#x27; to &#x27;Parcel_Information_With_Tax_Jurisdiction&#x27;</span></span><br><span class="line">schemaBuilder.Rename(originalFeatureDatasetDescription, datasetRenameAs);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="在一次操作中创建具有要素类的要素数据集"><a href="#在一次操作中创建具有要素类的要素数据集" class="headerlink" title="在一次操作中创建具有要素类的要素数据集"></a>在一次操作中创建具有要素类的要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureDataset named as &#x27;Parcel_Information&#x27; and a FeatureClass with name &#x27;Parcels&#x27; in one operation</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcel_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureDataset token</span></span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetName, SpatialReferences.WGS84);</span><br><span class="line">FeatureDatasetToken featureDatasetToken = schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass description</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassName,</span><br><span class="line">  <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Id&quot;</span>, FieldType.Integer),</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Address&quot;</span>, FieldType.String)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Point, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass inside a FeatureDataset</span></span><br><span class="line">FeatureClassToken featureClassToken = schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetToken), featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在现有要素数据集中创建要素类"><a href="#在现有要素数据集中创建要素类" class="headerlink" title="在现有要素数据集中创建要素类"></a>在现有要素数据集中创建要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a FeatureClass named as &#x27;Tax_Jurisdiction&#x27; in existing FeatureDataset with name &#x27;Parcels_Information&#x27;</span></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcels_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass description</span></span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassName,</span><br><span class="line">  <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Tax_Id&quot;</span>, FieldType.Integer),</span><br><span class="line">    <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Address&quot;</span>, FieldType.String)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Point, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(featureDatasetName);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a FeatureClass inside a FeatureDataset using a FeatureDatasetDefinition</span></span><br><span class="line">schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition), featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将要素类添加到要素数据集"><a href="#将要素类添加到要素数据集" class="headerlink" title="将要素类添加到要素数据集"></a>将要素类添加到要素数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding a FeatureClass with name &#x27;Tax_Jurisdiction&#x27; into a FeatureDataset named as &#x27;Parcels_Information&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Parcels_Information&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> featureClassNameToAdd = <span class="string">&quot;Tax_Jurisdiction&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureDatasetDefinition featureDatasetDefinition = geodatabase.GetDefinition&lt;FeatureDatasetDefinition&gt;(featureDatasetName);</span><br><span class="line">FeatureDatasetDescription featureDatasetDescription = <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetDefinition);</span><br><span class="line"></span><br><span class="line">FeatureClassDefinition featureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassNameToAdd);</span><br><span class="line">FeatureClassDescription featureClassDescription = <span class="keyword">new</span> FeatureClassDescription(featureClassDefinition);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the &#x27;Tax_Jurisdiction&#x27; FeatureClass to the &#x27;Parcels_Information&#x27; FeatureDataset </span></span><br><span class="line">schemaBuilder.AddFeatureClass(featureDatasetDescription, featureClassDescription);</span><br><span class="line"><span class="built_in">bool</span> addStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!addStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Renaming a table from &#x27;Original_Table&#x27; to &#x27;Renamed_Table&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> tableToBeRenamed = <span class="string">&quot;Original_Table&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> tableRenameAs = <span class="string">&quot;Renamed_Table&quot;</span>;</span><br><span class="line"></span><br><span class="line">TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableToBeRenamed);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Table rename </span></span><br><span class="line">schemaBuilder.Rename(<span class="keyword">new</span> TableDescription(tableDefinition), tableRenameAs);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="向要素类添加字段"><a href="#向要素类添加字段" class="headerlink" title="向要素类添加字段"></a>向要素类添加字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding following fields to the &#x27;Parcels&#x27; FeatureClass</span></span><br><span class="line"><span class="comment">// Global ID</span></span><br><span class="line"><span class="comment">// Parcel_ID</span></span><br><span class="line"><span class="comment">// Tax_Code</span></span><br><span class="line"><span class="comment">// Parcel_Address</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The FeatureClass to add fields</span></span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">FeatureClassDefinition originalFeatureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">FeatureClassDescription originalFeatureClassDescription = <span class="keyword">new</span> </span><br><span class="line">   FeatureClassDescription(originalFeatureClassDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The four new fields to add on the &#x27;Parcels&#x27; FeatureClass</span></span><br><span class="line">FieldDescription globalIdField = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription parcelIdDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;Parcel_ID&quot;</span>, FieldType.GUID);</span><br><span class="line">FieldDescription taxCodeDescription = FieldDescription.CreateIntegerField(<span class="string">&quot;Tax_Code&quot;</span>);</span><br><span class="line">FieldDescription addressDescription = FieldDescription.CreateStringField(<span class="string">&quot;Parcel_Address&quot;</span>, <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">List&lt;FieldDescription&gt; fieldsToAdd = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; globalIdField, parcelIdDescription,</span><br><span class="line">  taxCodeDescription, addressDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add new fields on the new FieldDescription list</span></span><br><span class="line">List&lt;FieldDescription&gt; modifiedFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;(originalFeatureClassDescription.FieldDescriptions);</span><br><span class="line">modifiedFieldDescriptions.AddRange(fieldsToAdd);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The new FeatureClassDescription with additional fields</span></span><br><span class="line">FeatureClassDescription modifiedFeatureClassDescription = <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDescription.Name,</span><br><span class="line">  modifiedFieldDescriptions, originalFeatureClassDescription.ShapeDescription);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the &#x27;Parcels&#x27; FeatureClass with newly added fields</span></span><br><span class="line">schemaBuilder.Modify(modifiedFeatureClassDescription);</span><br><span class="line"><span class="built_in">bool</span> modifyStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!modifyStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加使用域的字段"><a href="#添加使用域的字段" class="headerlink" title="添加使用域的字段"></a>添加使用域的字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Adding a field,&#x27;PipeType&#x27;, which uses the coded value domain to the &#x27;Pipes&#x27; FeatureClass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//The FeatureClass to add field</span></span><br><span class="line"><span class="built_in">string</span> featureClassName = <span class="string">&quot;Pipes&quot;</span>;</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a CodedValueDomain description for water pipes</span></span><br><span class="line">CodedValueDomainDescription pipeDomainDescription = </span><br><span class="line">  <span class="keyword">new</span> CodedValueDomainDescription(<span class="string">&quot;WaterPipeTypes&quot;</span>, FieldType.String,</span><br><span class="line">  <span class="keyword">new</span> SortedList&lt;<span class="built_in">object</span>, <span class="built_in">string</span>&gt; &#123; &#123; <span class="string">&quot;Copper&quot;</span>, <span class="string">&quot;C_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;Steel&quot;</span>, <span class="string">&quot;S_2&quot;</span> &#125; &#125;)</span><br><span class="line">&#123;</span><br><span class="line">  SplitPolicy = SplitPolicy.Duplicate,</span><br><span class="line">  MergePolicy = MergePolicy.DefaultValue</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a coded value domain token</span></span><br><span class="line">CodedValueDomainToken codedValueDomainToken = schemaBuilder.Create(pipeDomainDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a new description from domain token</span></span><br><span class="line">CodedValueDomainDescription codedValueDomainDescription = <span class="keyword">new</span> CodedValueDomainDescription(codedValueDomainToken);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a field named as &#x27;PipeType&#x27; using a domain description</span></span><br><span class="line">FieldDescription domainFieldDescription = <span class="keyword">new</span> FieldDescription(<span class="string">&quot;PipeType&quot;</span>, FieldType.String)</span><br><span class="line">&#123; DomainDescription = codedValueDomainDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Retrieve existing information for &#x27;Pipes&#x27; FeatureClass</span></span><br><span class="line">FeatureClassDefinition originalFeatureClassDefinition = geodatabase.GetDefinition&lt;FeatureClassDefinition&gt;(featureClassName);</span><br><span class="line">FeatureClassDescription originalFeatureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add domain field on existing fields</span></span><br><span class="line">List&lt;FieldDescription&gt; modifiedFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt;(originalFeatureClassDescription.FieldDescriptions) &#123; domainFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a new description with updated fields for &#x27;Pipes&#x27; FeatureClass </span></span><br><span class="line">FeatureClassDescription featureClassDescription = </span><br><span class="line">  <span class="keyword">new</span> FeatureClassDescription(originalFeatureClassDescription.Name, modifiedFieldDescriptions,</span><br><span class="line">                                 originalFeatureClassDescription.ShapeDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the &#x27;Pipes&#x27; FeatureClass with domain field</span></span><br><span class="line">schemaBuilder.Modify(featureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build status</span></span><br><span class="line"><span class="built_in">bool</span> buildStatus = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build errors</span></span><br><span class="line"><span class="keyword">if</span> (!buildStatus)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errors = schemaBuilder.ErrorMessages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从表中删除字段"><a href="#从表中删除字段" class="headerlink" title="从表中删除字段"></a>从表中删除字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Removing all fields from &#x27;Parcels&#x27; table except following </span></span><br><span class="line"><span class="comment">// Tax_Code</span></span><br><span class="line"><span class="comment">// Parcel_Address</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The table to remove fields</span></span><br><span class="line"><span class="built_in">string</span> tableName = <span class="string">&quot;Parcels&quot;</span>;</span><br><span class="line"></span><br><span class="line">TableDefinition tableDefinition = geodatabase.GetDefinition&lt;TableDefinition&gt;(tableName);</span><br><span class="line">IReadOnlyList&lt;Field&gt; fields = tableDefinition.GetFields();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Existing fields from &#x27;Parcels&#x27; table</span></span><br><span class="line">Field taxCodeField = fields.First(f =&gt; f.Name.Equals(<span class="string">&quot;Tax_Code&quot;</span>));</span><br><span class="line">Field parcelAddressField = fields.First(f =&gt; f.Name.Equals(<span class="string">&quot;Parcel_Address&quot;</span>));</span><br><span class="line"></span><br><span class="line">FieldDescription taxFieldDescription = <span class="keyword">new</span> FieldDescription(taxCodeField);</span><br><span class="line">FieldDescription parcelAddressFieldDescription = <span class="keyword">new</span> FieldDescription(parcelAddressField);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fields to retain in modified table</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldsToBeRetained = <span class="keyword">new</span> List&lt;FieldDescription&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  taxFieldDescription, parcelAddressFieldDescription</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New description of the &#x27;Parcels&#x27; table with the &#x27;Tax_Code&#x27; and &#x27;Parcel_Address&#x27; fields</span></span><br><span class="line">TableDescription modifiedTableDescription = <span class="keyword">new</span> TableDescription(tableName, fieldsToBeRetained);</span><br><span class="line"></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove all fields except the &#x27;Tax_Code&#x27; and &#x27;Parcel_Address&#x27; fields</span></span><br><span class="line">schemaBuilder.Modify(modifiedTableDescription);</span><br><span class="line">schemaBuilder.Build();</span><br></pre></td></tr></table></figure>

<h3 id="创建注记要素类"><a href="#创建注记要素类" class="headerlink" title="创建注记要素类"></a>创建注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a Cities annotation feature class</span></span><br><span class="line"><span class="comment">// with following user defined fields</span></span><br><span class="line"><span class="comment">// Name </span></span><br><span class="line"><span class="comment">// GlobalID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;CitiesAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create user defined attribute fields for annotation feature class </span></span><br><span class="line">FieldDescription globalIDFieldDescription = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of all field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; globalIDFieldDescription, nameFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Polygon, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Maplex engine </span></span><br><span class="line">CIMMaplexGeneralPlacementProperties generalPlacementProperties =</span><br><span class="line">  <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowBorderOverlap = <span class="literal">true</span>,</span><br><span class="line">    PlacementQuality = MaplexQualityType.High,</span><br><span class="line">    DrawUnplacedLabels = <span class="literal">true</span>,</span><br><span class="line">    InvertedLabelTolerance = <span class="number">1.0</span>,</span><br><span class="line">    RotateLabelWithDisplay = <span class="literal">true</span>,</span><br><span class="line">    UnplacedLabelColor = <span class="keyword">new</span> CIMRGBColor</span><br><span class="line">    &#123;</span><br><span class="line">      R = <span class="number">0</span>,</span><br><span class="line">      G = <span class="number">255</span>,</span><br><span class="line">      B = <span class="number">0</span>,</span><br><span class="line">      Alpha = <span class="number">0.5f</span> <span class="comment">// Green</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Standard engine</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//CIMStandardGeneralPlacementProperties generalPlacementProperties =</span></span><br><span class="line"><span class="comment">//  new CIMStandardGeneralPlacementProperties</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//    DrawUnplacedLabels = true,</span></span><br><span class="line"><span class="comment">//    InvertedLabelTolerance = 3.0,</span></span><br><span class="line"><span class="comment">//    RotateLabelWithDisplay = true,</span></span><br><span class="line"><span class="comment">//    UnplacedLabelColor = new CIMRGBColor</span></span><br><span class="line"><span class="comment">//    &#123;</span></span><br><span class="line"><span class="comment">//      R = 255, G = 0, B = 0, Alpha = 0.5f // Red</span></span><br><span class="line"><span class="comment">//    &#125; </span></span><br><span class="line"><span class="comment">//   &#125;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create annotation  label classes</span></span><br><span class="line"><span class="comment">// Green label</span></span><br><span class="line">CIMLabelClass greenLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Green&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Green&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">1</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Tahoma&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Green&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blue label</span></span><br><span class="line">CIMLabelClass blueLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Blue&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Blue&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">2</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Blue&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of labels</span></span><br><span class="line">List&lt;CIMLabelClass&gt; labelClasses = <span class="keyword">new</span> List&lt;CIMLabelClass&gt; &#123; greenLabelClass, blueLabelClass &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an annotation feature class description object to describe the feature class to create</span></span><br><span class="line">AnnotationFeatureClassDescription annotationFeatureClassDescription =</span><br><span class="line">  <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, fieldDescriptions, shapeDescription,</span><br><span class="line">    generalPlacementProperties, labelClasses)</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the Cities annotation feature class to the list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建关联要素的注记要素类"><a href="#创建关联要素的注记要素类" class="headerlink" title="创建关联要素的注记要素类"></a>创建关联要素的注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a feature-linked annotation feature class between water pipe and valve in water distribution network</span></span><br><span class="line"><span class="comment">// with following user defined fields</span></span><br><span class="line"><span class="comment">// PipeName </span></span><br><span class="line"><span class="comment">// GlobalID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;WaterPipeAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create user defined attribute fields for annotation feature class</span></span><br><span class="line">FieldDescription pipeGlobalID = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription nameFieldDescription = FieldDescription.CreateStringField(<span class="string">&quot;Name&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of all field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; fieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; pipeGlobalID, nameFieldDescription &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a ShapeDescription object</span></span><br><span class="line">ShapeDescription shapeDescription = <span class="keyword">new</span> ShapeDescription(GeometryType.Polygon, spatialReference);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create general placement properties for Maplex engine </span></span><br><span class="line">CIMMaplexGeneralPlacementProperties generalPlacementProperties = <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties</span><br><span class="line">&#123;</span><br><span class="line">  AllowBorderOverlap = <span class="literal">true</span>,</span><br><span class="line">  PlacementQuality = MaplexQualityType.High,</span><br><span class="line">  DrawUnplacedLabels = <span class="literal">true</span>,</span><br><span class="line">  InvertedLabelTolerance = <span class="number">1.0</span>,</span><br><span class="line">  RotateLabelWithDisplay = <span class="literal">true</span>,</span><br><span class="line">  UnplacedLabelColor = <span class="keyword">new</span> CIMRGBColor</span><br><span class="line">  &#123;</span><br><span class="line">    R = <span class="number">255</span>,</span><br><span class="line">    G = <span class="number">0</span>,</span><br><span class="line">    B = <span class="number">0</span>,</span><br><span class="line">    Alpha = <span class="number">0.5f</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create annotation  label classes</span></span><br><span class="line"><span class="comment">// Green label</span></span><br><span class="line">CIMLabelClass greenLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Green&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Green&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">1</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Tahoma&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Green&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blue label</span></span><br><span class="line">CIMLabelClass blueLabelClass = <span class="keyword">new</span> CIMLabelClass</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Blue&quot;</span>,</span><br><span class="line">  ExpressionTitle = <span class="string">&quot;Expression-Blue&quot;</span>,</span><br><span class="line">  ExpressionEngine = LabelExpressionEngine.Arcade,</span><br><span class="line">  Expression = <span class="string">&quot;$feature.OBJECTID&quot;</span>,</span><br><span class="line">  ID = <span class="number">2</span>,</span><br><span class="line">  Priority = <span class="number">0</span>,</span><br><span class="line">  Visibility = <span class="literal">true</span>,</span><br><span class="line">  TextSymbol = <span class="keyword">new</span> CIMSymbolReference</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = <span class="keyword">new</span> CIMTextSymbol()</span><br><span class="line">    &#123;</span><br><span class="line">      Angle = <span class="number">45</span>,</span><br><span class="line">      FontType = FontType.Type1,</span><br><span class="line">      FontFamilyName = <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">      FontEffects = FontEffects.Normal,</span><br><span class="line">      HaloSize = <span class="number">2.0</span>,</span><br><span class="line"></span><br><span class="line">      Symbol = <span class="keyword">new</span> CIMPolygonSymbol</span><br><span class="line">      &#123;</span><br><span class="line">        SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[]</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">new</span> CIMSolidFill</span><br><span class="line">          &#123;</span><br><span class="line">            Color = CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        UseRealWorldSymbolSizes = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MaxScale = <span class="number">0</span>,</span><br><span class="line">    MinScale = <span class="number">0</span>,</span><br><span class="line">    SymbolName = <span class="string">&quot;TextSymbol-Blue&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  StandardLabelPlacementProperties = <span class="keyword">new</span> CIMStandardLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AllowOverlappingLabels = <span class="literal">true</span>,</span><br><span class="line">    LineOffset = <span class="number">1.0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  MaplexLabelPlacementProperties = <span class="keyword">new</span> CIMMaplexLabelPlacementProperties</span><br><span class="line">  &#123;</span><br><span class="line">    AlignLabelToLineDirection = <span class="literal">true</span>,</span><br><span class="line">    AvoidPolygonHoles = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of labels</span></span><br><span class="line">List&lt;CIMLabelClass&gt; labelClasses = <span class="keyword">new</span> List&lt;CIMLabelClass&gt; &#123; greenLabelClass, blueLabelClass &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create linked feature description</span></span><br><span class="line"><span class="comment">// Linked feature class name</span></span><br><span class="line"><span class="built_in">string</span> linkedFeatureClassName = <span class="string">&quot;WaterPipe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create fields for water pipe</span></span><br><span class="line">FieldDescription waterPipeGlobalID = FieldDescription.CreateGlobalIDField();</span><br><span class="line">FieldDescription pipeName = FieldDescription.CreateStringField(<span class="string">&quot;PipeName&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a list of water pipe field descriptions</span></span><br><span class="line">List&lt;FieldDescription&gt; pipeFieldDescriptions = <span class="keyword">new</span> List&lt;FieldDescription&gt; &#123; waterPipeGlobalID, pipeName &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a linked feature class description</span></span><br><span class="line">FeatureClassDescription linkedFeatureClassDescription = <span class="keyword">new</span> FeatureClassDescription(linkedFeatureClassName, pipeFieldDescriptions,</span><br><span class="line">  <span class="keyword">new</span> ShapeDescription(GeometryType.Polyline, spatialReference));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the linked feature class to the list of DDL tasks</span></span><br><span class="line">FeatureClassToken linkedFeatureClassToken = schemaBuilder.Create(linkedFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an annotation feature class description object to describe the feature class to create</span></span><br><span class="line">AnnotationFeatureClassDescription annotationFeatureClassDescription =</span><br><span class="line">  <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, fieldDescriptions, shapeDescription,</span><br><span class="line">    generalPlacementProperties, labelClasses, <span class="keyword">new</span> FeatureClassDescription(linkedFeatureClassToken))</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the creation of the annotation feature class to the list of DDL tasks</span></span><br><span class="line">schemaBuilder.Create(annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the DDL</span></span><br><span class="line"><span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inspect error messages</span></span><br><span class="line"><span class="keyword">if</span> (!success)</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">  <span class="comment">//etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在要素数据集内创建注记要素类"><a href="#在要素数据集内创建注记要素类" class="headerlink" title="在要素数据集内创建注记要素类"></a>在要素数据集内创建注记要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a Cities annotation feature class inside Places feature dataset using existing annotation feature class </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Feature dataset name</span></span><br><span class="line"><span class="built_in">string</span> featureDatasetName = <span class="string">&quot;Places&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotation feature class name</span></span><br><span class="line"><span class="built_in">string</span> annotationFeatureClassName = <span class="string">&quot;CitiesAnnotation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a SchemaBuilder object</span></span><br><span class="line">SchemaBuilder schemaBuilder = <span class="keyword">new</span> SchemaBuilder(geodatabase);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open existing annotation feature class name</span></span><br><span class="line"><span class="keyword">using</span> (AnnotationFeatureClass existingAnnotationFeatureClass = geodatabase.OpenDataset&lt;AnnotationFeatureClass&gt;(<span class="string">&quot;ExistingAnnotationFeatureClass&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create Feature dataset description</span></span><br><span class="line">  FeatureDatasetDescription featureDatasetDescription = </span><br><span class="line">    <span class="keyword">new</span> FeatureDatasetDescription(featureDatasetName, existingAnnotationFeatureClass.GetDefinition().GetSpatialReference());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the creation of the Places dataset to DDL task</span></span><br><span class="line">  FeatureDatasetToken featureDatasetToken = schemaBuilder.Create(featureDatasetDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create an annotation feature class description using existing annotation feature class</span></span><br><span class="line">  AnnotationFeatureClassDescription annotationFeatureClassDescription = <span class="keyword">new</span> AnnotationFeatureClassDescription(annotationFeatureClassName, existingAnnotationFeatureClass.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    IsAutoCreate = <span class="literal">true</span>,</span><br><span class="line">    IsSymbolIDRequired = <span class="literal">false</span>,</span><br><span class="line">    IsUpdatedOnShapeChange = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the creation of the Cities annotation feature class inside Places feature dataset</span></span><br><span class="line">  schemaBuilder.Create(<span class="keyword">new</span> FeatureDatasetDescription(featureDatasetToken), annotationFeatureClassDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Execute the DDL</span></span><br><span class="line">  <span class="built_in">bool</span> success = schemaBuilder.Build();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inspect error messages</span></span><br><span class="line">  <span class="keyword">if</span> (!success)</span><br><span class="line">  &#123;</span><br><span class="line">    IReadOnlyList&lt;<span class="built_in">string</span>&gt; errorMessages = schemaBuilder.ErrorMessages;</span><br><span class="line">    <span class="comment">//etc.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地理数据库拓扑代码段"><a href="#地理数据库拓扑代码段" class="headerlink" title="地理数据库拓扑代码段"></a>地理数据库拓扑代码段</h2><h3 id="开放拓扑和进程定义"><a href="#开放拓扑和进程定义" class="headerlink" title="开放拓扑和进程定义"></a>开放拓扑和进程定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OpenTopologyAndProcessDefinition</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Open a geodatabase topology from a file geodatabase and process the topology definition.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    ProcessDefinition(geodatabase, topology);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Open a feature service topology and process the topology definition.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">string</span> TOPOLOGY_LAYER_ID = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> ServiceConnectionProperties(<span class="keyword">new</span> Uri(<span class="string">&quot;https://sdkexamples.esri.com/server/rest/services/GrandTeton/FeatureServer&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(TOPOLOGY_LAYER_ID))</span><br><span class="line">  &#123;</span><br><span class="line">    ProcessDefinition(geodatabase, topology);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ProcessDefinition</span>(<span class="params">Geodatabase geodatabase, Topology topology</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Similar to the rest of the Definition objects in the Core.Data API, there are two ways to open a dataset&#x27;s </span></span><br><span class="line">  <span class="comment">// definition -- via the Topology dataset itself or via the Geodatabase.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (TopologyDefinition definitionViaTopology = topology.GetDefinition())</span><br><span class="line">  &#123;</span><br><span class="line">    OutputDefinition(geodatabase, definitionViaTopology);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (TopologyDefinition definitionViaGeodatabase = </span><br><span class="line">    geodatabase.GetDefinition&lt;TopologyDefinition&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    OutputDefinition(geodatabase, definitionViaGeodatabase);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OutputDefinition</span>(<span class="params">Geodatabase geodatabase, TopologyDefinition topologyDefinition</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Topology cluster tolerance =&gt; <span class="subst">&#123;topologyDefinition.GetClusterTolerance()&#125;</span>&quot;</span>);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Topology Z cluster tolerance =&gt; <span class="subst">&#123;topologyDefinition.GetZClusterTolerance()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;<span class="built_in">string</span>&gt; featureClassNames = topologyDefinition.GetFeatureClassNames();</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;featureClassNames.Count&#125;</span> feature classes that are participating in the topology:&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="built_in">string</span> name <span class="keyword">in</span> featureClassNames)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Open each feature class that participates in the topology.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(name))</span><br><span class="line">    <span class="keyword">using</span> (FeatureClassDefinition featureClassDefinition = featureClass.GetDefinition())</span><br><span class="line">    &#123;</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;\t<span class="subst">&#123;featureClass.GetName()&#125;</span> (<span class="subst">&#123;featureClassDefinition.GetShapeType()&#125;</span>)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取拓扑规则"><a href="#获取拓扑规则" class="headerlink" title="获取拓扑规则"></a>获取拓扑规则</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (TopologyDefinition topologyDefinition = topology.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;TopologyRule&gt; rules = topologyDefinition.GetRules();</span><br><span class="line"></span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;rules.Count&#125;</span> topology rules defined for the topology:&quot;</span>);</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;ID \t Origin Class \t Origin Subtype \t Destination Class \t Destination Subtype \t Rule Type&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyRule rule <span class="keyword">in</span> rules)</span><br><span class="line">  &#123;</span><br><span class="line">    Console.Write(<span class="string">$&quot;<span class="subst">&#123;rule.ID&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(!String.IsNullOrEmpty(rule.OriginClass) ? <span class="string">$&quot;\t<span class="subst">&#123;rule.OriginClass&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(rule.OriginSubtype != <span class="literal">null</span> ? <span class="string">$&quot;\t<span class="subst">&#123;rule.OriginSubtype.GetName()&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(!String.IsNullOrEmpty(rule.DestinationClass) ? <span class="string">$&quot;\t<span class="subst">&#123;rule.DestinationClass&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(rule.DestinationSubtype != <span class="literal">null</span> ? <span class="string">$&quot;\t<span class="subst">&#123;rule.DestinationSubtype.GetName()&#125;</span>&quot;</span> : <span class="string">&quot;\t\&quot;\&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.Write(<span class="string">$&quot;\t<span class="subst">&#123;rule.RuleType&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证拓扑"><a href="#验证拓扑" class="headerlink" title="验证拓扑"></a>验证拓扑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ValidateTopology</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// If the topology currently does not have dirty areas, calling Validate() returns an empty envelope.</span></span><br><span class="line"></span><br><span class="line">    ValidationResult result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has not been edited =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now create a feature that purposely violates the &quot;PointProperlyInsideArea&quot; topology rule.  This action will</span></span><br><span class="line">    <span class="comment">// create dirty areas.</span></span><br><span class="line"></span><br><span class="line">    Feature newFeature = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Fetch the feature in the Campsites feature class whose objectID is 2.  Then create a new geometry slightly</span></span><br><span class="line">      <span class="comment">// altered from this and use it to create a new feature.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Feature featureViaCampsites2 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">2</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        Geometry currentGeometry = featureViaCampsites2.GetShape();</span><br><span class="line">        Geometry newGeometry = GeometryEngine.Instance.Move(currentGeometry, (currentGeometry.Extent.XMax / <span class="number">8</span>),</span><br><span class="line">          (currentGeometry.Extent.YMax / <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (FeatureClass campsitesFeatureClass = featureViaCampsites2.GetTable())</span><br><span class="line">        <span class="keyword">using</span> (FeatureClassDefinition definition = campsitesFeatureClass.GetDefinition())</span><br><span class="line">        <span class="keyword">using</span> (RowBuffer rowBuffer = campsitesFeatureClass.CreateRowBuffer())</span><br><span class="line">        &#123;</span><br><span class="line">          rowBuffer[definition.GetShapeField()] = newGeometry;</span><br><span class="line"></span><br><span class="line">          geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            newFeature = campsitesFeatureClass.CreateRow(rowBuffer);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// After creating a new feature in the &#x27;Campsites&#x27; participating feature class, the topology&#x27;s state should be </span></span><br><span class="line">      <span class="comment">// &quot;Unanalyzed&quot; because it has not been validated.</span></span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;The topology state after an edit has been applied =&gt; <span class="subst">&#123;topology.GetState()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Now validate the topology.  The result envelope corresponds to the dirty areas.</span></span><br><span class="line"></span><br><span class="line">      result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has just been edited =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// After Validate(), the topology&#x27;s state should be &quot;AnalyzedWithErrors&quot; because the topology currently has errors.</span></span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;The topology state after validate topology =&gt; <span class="subst">&#123;topology.GetState()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If there are no dirty areas, the result envelope should be empty.</span></span><br><span class="line"></span><br><span class="line">      result = topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">      Console.WriteLine(<span class="string">$&quot;&#x27;AffectedArea&#x27; after validating a topology that has just been validated =&gt; <span class="subst">&#123;result.AffectedArea.ToJson()&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (newFeature != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        geodatabase.ApplyEdits(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          newFeature.Delete();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        newFeature.Dispose();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Validate again after deleting the newly-created feature.</span></span><br><span class="line"></span><br><span class="line">    topology.Validate(<span class="keyword">new</span> ValidationDescription(topology.GetExtent()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Feature <span class="title">GetFeature</span>(<span class="params">Geodatabase geodatabase, <span class="built_in">string</span> featureClassName, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(featureClassName))</span><br><span class="line">  &#123;</span><br><span class="line">    QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">    &#123;</span><br><span class="line">      ObjectIDs = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; objectID &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (RowCursor cursor = featureClass.Search(queryFilter))</span><br><span class="line">    &#123;</span><br><span class="line">      System.Diagnostics.Debug.Assert(cursor.MoveNext());</span><br><span class="line">      <span class="keyword">return</span> (Feature)cursor.Current;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取拓扑错误"><a href="#获取拓扑错误" class="headerlink" title="获取拓扑错误"></a>获取拓扑错误</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get all the errors and exceptions currently associated with the topology.</span></span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;TopologyError&gt; allErrorsAndExceptions = topology.GetErrors(<span class="keyword">new</span> ErrorDescription(topology.GetExtent()));</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;errors and exceptions count =&gt; <span class="subst">&#123;allErrorsAndExceptions.Count&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;OriginClassName \t OriginObjectID \t DestinationClassName \t DestinationObjectID \t RuleType \t IsException \t Shape type \t Shape width &amp; height \t  Rule ID \t&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> allErrorsAndExceptions)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;&#x27;<span class="subst">&#123;error.OriginClassName&#125;</span>&#x27; \t <span class="subst">&#123;error.OriginObjectID&#125;</span> \t &#x27;<span class="subst">&#123;error.DestinationClassName&#125;</span>&#x27; \t &quot;</span> +</span><br><span class="line">                    <span class="string">$&quot;<span class="subst">&#123;error.DestinationObjectID&#125;</span> \t <span class="subst">&#123;error.RuleType&#125;</span> \t <span class="subst">&#123;error.IsException&#125;</span> \t <span class="subst">&#123;error.Shape.GeometryType&#125;</span> \t &quot;</span> +</span><br><span class="line">                    <span class="string">$&quot;<span class="subst">&#123;error.Shape.Extent.Width&#125;</span>,<span class="subst">&#123;error.Shape.Extent.Height&#125;</span> \t <span class="subst">&#123;error.RuleID&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MarkAndUnmarkAsErrors"><a href="#MarkAndUnmarkAsErrors" class="headerlink" title="MarkAndUnmarkAsErrors"></a>MarkAndUnmarkAsErrors</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get all the errors due to features violating the &quot;PointProperlyInsideArea&quot; topology rule.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> (TopologyDefinition topologyDefinition = topology.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  TopologyRule pointProperlyInsideAreaRule = topologyDefinition.GetRules().First(rule =&gt; rule.RuleType == TopologyRuleType.PointProperlyInsideArea);</span><br><span class="line"></span><br><span class="line">  ErrorDescription errorDescription = <span class="keyword">new</span> ErrorDescription(topology.GetExtent())</span><br><span class="line">  &#123;</span><br><span class="line">    TopologyRule = pointProperlyInsideAreaRule</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsDueToViolatingPointProperlyInsideAreaRule = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsDueToViolatingPointProperlyInsideAreaRule.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Mark all errors from features violating the &#x27;PointProperlyInsideArea&#x27; topology rule as exceptions.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> errorsDueToViolatingPointProperlyInsideAreaRule)</span><br><span class="line">  &#123;</span><br><span class="line">    topology.MarkAsException(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now verify all the errors from features violating the &#x27;PointProperlyInsideArea&#x27; topology rule have indeed been</span></span><br><span class="line">  <span class="comment">// marked as exceptions.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// By default, ErrorDescription is initialized to ErrorType.ErrorAndException.  Here we want ErrorType.ErrorOnly.</span></span><br><span class="line"></span><br><span class="line">  errorDescription = <span class="keyword">new</span> ErrorDescription(topology.GetExtent())</span><br><span class="line">  &#123;</span><br><span class="line">    ErrorType = ErrorType.ErrorOnly,</span><br><span class="line">    TopologyRule = pointProperlyInsideAreaRule</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsAfterMarkedAsExceptions = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsAfterMarkedAsExceptions.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule after all the errors have been marked as exceptions.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Finally, reset all the exceptions as errors by unmarking them as exceptions.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (TopologyError error <span class="keyword">in</span> errorsDueToViolatingPointProperlyInsideAreaRule)</span><br><span class="line">  &#123;</span><br><span class="line">    topology.UnmarkAsException(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;TopologyError&gt; errorsAfterUnmarkedAsExceptions = topology.GetErrors(errorDescription);</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;There are <span class="subst">&#123;errorsAfterUnmarkedAsExceptions.Count&#125;</span> feature violating the &#x27;PointProperlyInsideArea&#x27; topology rule after all the exceptions have been reset as errors.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="探索拓扑图"><a href="#探索拓扑图" class="headerlink" title="探索拓扑图"></a>探索拓扑图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExploreTopologyGraph</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Build a topology graph using the extent of the topology dataset.</span></span><br><span class="line"></span><br><span class="line">    topology.BuildGraph(topology.GetExtent(), (topologyGraph) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (Feature campsites12 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">12</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        IReadOnlyList&lt;TopologyNode&gt; topologyNodesViaCampsites12 = topologyGraph.GetNodes(campsites12);</span><br><span class="line"></span><br><span class="line">        TopologyNode topologyNodeViaCampsites12 = topologyNodesViaCampsites12[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        IReadOnlyList&lt;TopologyEdge&gt; allEdgesConnectedToNodeViaCampsites12 = topologyNodeViaCampsites12.GetEdges();</span><br><span class="line">        IReadOnlyList&lt;TopologyEdge&gt; allEdgesConnectedToNodeViaCampsites12CounterClockwise = topologyNodeViaCampsites12.GetEdges(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        System.Diagnostics.Debug.Assert(allEdgesConnectedToNodeViaCampsites12.Count == allEdgesConnectedToNodeViaCampsites12CounterClockwise.Count);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (TopologyEdge edgeConnectedToNodeViaCampsites12 <span class="keyword">in</span> allEdgesConnectedToNodeViaCampsites12)</span><br><span class="line">        &#123;</span><br><span class="line">          TopologyNode fromNode = edgeConnectedToNodeViaCampsites12.GetFromNode();</span><br><span class="line">          TopologyNode toNode = edgeConnectedToNodeViaCampsites12.GetToNode();</span><br><span class="line"></span><br><span class="line">          <span class="built_in">bool</span> fromNodeIsTheSameAsTopologyNodeViaCampsites12 = (fromNode == topologyNodeViaCampsites12);</span><br><span class="line">          <span class="built_in">bool</span> toNodeIsTheSameAsTopologyNodeViaCampsites12 = (toNode == topologyNodeViaCampsites12);</span><br><span class="line"></span><br><span class="line">          System.Diagnostics.Debug.Assert(fromNodeIsTheSameAsTopologyNodeViaCampsites12 || toNodeIsTheSameAsTopologyNodeViaCampsites12,</span><br><span class="line">            <span class="string">&quot;The FromNode *or* ToNode of each edge connected to &#x27;topologyNodeViaCampsites12&#x27; should be the same as &#x27;topologyNodeViaCampsites12&#x27; itself.&quot;</span>);</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; leftParentFeaturesBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetLeftParentFeatures();</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> leftParentFeaturesBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; leftParentFeaturesNotBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetLeftParentFeatures(<span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> leftParentFeaturesNotBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; rightParentFeaturesBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetRightParentFeatures();</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> rightParentFeaturesBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          IReadOnlyList&lt;FeatureInfo&gt; rightParentFeaturesNotBoundedByEdge = edgeConnectedToNodeViaCampsites12.GetRightParentFeatures(<span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">foreach</span> (FeatureInfo featureInfo <span class="keyword">in</span> rightParentFeaturesNotBoundedByEdge)</span><br><span class="line">          &#123;</span><br><span class="line">            System.Diagnostics.Debug.Assert(!String.IsNullOrEmpty(featureInfo.FeatureClassName));</span><br><span class="line">            System.Diagnostics.Debug.Assert(featureInfo.ObjectID &gt; <span class="number">0</span>);</span><br><span class="line">            EnsureShapeIsNotEmpty(featureInfo);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EnsureShapeIsNotEmpty</span>(<span class="params">FeatureInfo featureInfo</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Feature feature = featureInfo.GetFeature())</span><br><span class="line">  &#123;</span><br><span class="line">    System.Diagnostics.Debug.Assert(!feature.GetShape().IsEmpty, <span class="string">&quot;The feature&#x27;s shape should not be empty.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FindClosestElement"><a href="#FindClosestElement" class="headerlink" title="FindClosestElement"></a>FindClosestElement</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FindClosestElement</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\TestData\GrandTeton.gdb&quot;</span>))))</span><br><span class="line">  <span class="keyword">using</span> (Topology topology = geodatabase.OpenDataset&lt;Topology&gt;(<span class="string">&quot;Backcountry_Topology&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Build a topology graph using the extent of the topology dataset.</span></span><br><span class="line"></span><br><span class="line">    topology.BuildGraph(topology.GetExtent(), (topologyGraph) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      MapPoint queryPointViaCampsites12 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">using</span> (Feature campsites12 = GetFeature(geodatabase, <span class="string">&quot;Campsites&quot;</span>, <span class="number">12</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        queryPointViaCampsites12 = campsites12.GetShape() <span class="keyword">as</span> MapPoint;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">double</span> searchRadius = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">      TopologyElement topologyElementViaCampsites12 = </span><br><span class="line">          topologyGraph.FindClosestElement&lt;TopologyElement&gt;(</span><br><span class="line">                    queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      System.Diagnostics.Debug.Assert(</span><br><span class="line">        topologyElementViaCampsites12 != <span class="literal">null</span>, <span class="string">&quot;There should be a topology element corresponding to &#x27;queryPointViaCampsites12&#x27; within the &#x27;searchRadius&#x27; units.&quot;</span>);</span><br><span class="line"></span><br><span class="line">      IReadOnlyList&lt;FeatureInfo&gt; parentFeatures = topologyElementViaCampsites12.GetParentFeatures();</span><br><span class="line"></span><br><span class="line">      Console.WriteLine(<span class="string">&quot;The parent features that spawn &#x27;topologyElementViaCampsites12&#x27; are:&quot;</span>);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureInfo parentFeature <span class="keyword">in</span> parentFeatures)</span><br><span class="line">      &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;\t<span class="subst">&#123;parentFeature.FeatureClassName&#125;</span>; OID: <span class="subst">&#123;parentFeature.ObjectID&#125;</span>&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      TopologyNode topologyNodeViaCampsites12 = topologyGraph.FindClosestElement&lt;TopologyNode&gt;(queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (topologyNodeViaCampsites12 != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// There exists a TopologyNode nearest to the query point within searchRadius units.</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      TopologyEdge topologyEdgeViaCampsites12 = topologyGraph.FindClosestElement&lt;TopologyEdge&gt;(queryPointViaCampsites12, searchRadius);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (topologyEdgeViaCampsites12 != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// There exists a TopologyEdge nearest to the query point within searchRadius units.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="几何"><a href="#几何" class="headerlink" title="几何"></a>几何</h1><h2 id="空间参考"><a href="#空间参考" class="headerlink" title="空间参考"></a>空间参考</h2><h3 id="构造空间参考-从已知-ID"><a href="#构造空间参考-从已知-ID" class="headerlink" title="构造空间参考 - 从已知 ID"></a>构造空间参考 - 从已知 ID</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">SpatialReference sr3857 = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">3857</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder srBuilder = <span class="keyword">new</span> SpatialReferenceBuilder(<span class="number">3857</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">    sr3857 = srBuilder.ToSpatialReference();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="构造空间引用-从字符串"><a href="#构造空间引用-从字符串" class="headerlink" title="构造空间引用 - 从字符串"></a>构造空间引用 - 从字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> wkt = <span class="string">&quot;GEOGCS[\&quot;MyGCS84\&quot;,DATUM[\&quot;D_WGS_1984\&quot;,SPHEROID[\&quot;WGS_1984\&quot;,6378137.0,298.257223563]],PRIMEM[\&quot;Greenwich\&quot;,0.0],UNIT[\&quot;Radian\&quot;,1.0]]&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">SpatialReference sr = SpatialReferenceBuilder.CreateSpatialReference(wkt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder builder = <span class="keyword">new</span> SpatialReferenceBuilder(wkt))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">    SpatialReference anotherSR = builder.ToSpatialReference();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用-WGS84-空间参考"><a href="#使用-WGS84-空间参考" class="headerlink" title="使用 WGS84 空间参考"></a>使用 WGS84 空间参考</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference wgs84 = SpatialReferences.WGS84;</span><br><span class="line"><span class="built_in">bool</span> isProjected = wgs84.IsProjected;     <span class="comment">// false</span></span><br><span class="line"><span class="built_in">bool</span> isGeographic = wgs84.IsGeographic;   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="使用垂直坐标系构造空间参考-从已知-ID"><a href="#使用垂直坐标系构造空间参考-从已知-ID" class="headerlink" title="使用垂直坐标系构造空间参考 - 从已知 ID"></a>使用垂直坐标系构造空间参考 - 从已知 ID</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// see a list of vertical coordinate systems at http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/Vertical_coordinate_systems/02r3000000rn000000/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line"><span class="comment">// 4326 = GCS_WGS_1984</span></span><br><span class="line"><span class="comment">// 115700 = vertical WGS_1984</span></span><br><span class="line">SpatialReference sr4326_115700 = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>, <span class="number">115700</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder sb = <span class="keyword">new</span> SpatialReferenceBuilder(<span class="number">4326</span>, <span class="number">115700</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// SpatialReferenceBuilder properties</span></span><br><span class="line">    <span class="comment">//   sb.wkid == 4326</span></span><br><span class="line">    <span class="comment">//   sb.Wkt == &quot;GEOGCS[&quot;MyGCS84&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],PRIMEM[&quot;Greenwich&quot;,0.0],UNIT[\&quot;Radian\&quot;,1.0]]&quot;</span></span><br><span class="line">    <span class="comment">//   sb.name == GCS_WGS_1984</span></span><br><span class="line">    <span class="comment">//   sb.vcsWkid == 115700</span></span><br><span class="line">    <span class="comment">//   sb.VcsWkt == &quot;VERTCS[&quot;WGS_1984&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],PARAMETER[&quot;Vertical_Shift&quot;,0.0],PARAMETER[&quot;Direction&quot;,1.0],UNIT[&quot;Meter&quot;,1.0]]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">    sr4326_115700 = sb.ToSpatialReference();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用垂直坐标系构造空间参考-从字符串"><a href="#使用垂直坐标系构造空间参考-从字符串" class="headerlink" title="使用垂直坐标系构造空间参考 - 从字符串"></a>使用垂直坐标系构造空间参考 - 从字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// custom VCS - use vertical shift of -1.23 instead of 0</span></span><br><span class="line"><span class="built_in">string</span> custom_vWkt = <span class="string">@&quot;VERTCS[&quot;&quot;SHD_height&quot;&quot;,VDATUM[&quot;&quot;Singapore_Height_Datum&quot;&quot;],PARAMETER[&quot;&quot;Vertical_Shift&quot;&quot;,-1.23],PARAMETER[&quot;&quot;Direction&quot;&quot;,-1.0],UNIT[&quot;&quot;Meter&quot;&quot;,1.0]]&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">SpatialReference sr4326_customVertical = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>, custom_vWkt);</span><br><span class="line"><span class="comment">// SpatialReferenceBuilder properties</span></span><br><span class="line"><span class="comment">//   sr4326_customVertical.wkid == 4326</span></span><br><span class="line"><span class="comment">//   sr4326_customVertical.vert_wkid == 0</span></span><br><span class="line"><span class="comment">//   sr4326_customVertical.vert_wkt == custom_vWkt</span></span><br><span class="line"><span class="comment">//   sr4326_customVertical.hasVcs == true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder sb = <span class="keyword">new</span> SpatialReferenceBuilder(<span class="number">4326</span>, custom_vWkt))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">    sr4326_customVertical = sb.ToSpatialReference();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用自定义-PCS-构造空间参考-从字符串"><a href="#使用自定义-PCS-构造空间参考-从字符串" class="headerlink" title="使用自定义 PCS 构造空间参考 - 从字符串"></a>使用自定义 PCS 构造空间参考 - 从字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom PCS, Predefined GCS</span></span><br><span class="line"><span class="built_in">string</span> customWkt = <span class="string">&quot;PROJCS[\&quot;WebMercatorMile\&quot;,GEOGCS[\&quot;GCS_WGS_1984\&quot;,DATUM[\&quot;D_WGS_1984\&quot;,SPHEROID[\&quot;WGS_1984\&quot;,6378137.0,298.257223563]],PRIMEM[\&quot;Greenwich\&quot;,0.0],UNIT[\&quot;Degree\&quot;,0.0174532925199433]],PROJECTION[\&quot;Mercator_Auxiliary_Sphere\&quot;],PARAMETER[\&quot;False_Easting\&quot;,0.0],PARAMETER[\&quot;False_Northing\&quot;,0.0],PARAMETER[\&quot;Central_Meridian\&quot;,0.0],PARAMETER[\&quot;Standard_Parallel_1\&quot;,0.0],PARAMETER[\&quot;Auxiliary_Sphere_Type\&quot;,0.0],UNIT[\&quot;Mile\&quot;,1609.344000614692]]&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">SpatialReference spatialReference = SpatialReferenceBuilder.CreateSpatialReference(customWkt);</span><br><span class="line"><span class="comment">// SpatialReferenceBuilder properties</span></span><br><span class="line"><span class="comment">//   spatialReference.Wkt == customWkt</span></span><br><span class="line"><span class="comment">//   spatialReference.Wkid == 0</span></span><br><span class="line"><span class="comment">//   spatialReference.VcsWkid == 0</span></span><br><span class="line"><span class="comment">//   spatialReference.GcsWkid == 4326</span></span><br><span class="line"></span><br><span class="line">SpatialReference gcs = spatialReference.Gcs;</span><br><span class="line"><span class="comment">// gcs.Wkid == 4326</span></span><br><span class="line"><span class="comment">// gcs.IsGeographic == true</span></span><br><span class="line"><span class="comment">// spatialReference.GcsWkt == gcs.Wkt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder sb = <span class="keyword">new</span> SpatialReferenceBuilder(customWkt))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">    spatialReference = sb.ToSpatialReference();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="空间参考属性"><a href="#空间参考属性" class="headerlink" title="空间参考属性"></a>空间参考属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Builder constructors need to run on the MCT.</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// use the builder constructor</span></span><br><span class="line">  <span class="keyword">using</span> (SpatialReferenceBuilder srBuilder = <span class="keyword">new</span> SpatialReferenceBuilder(<span class="number">3857</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// spatial reference builder properties</span></span><br><span class="line">    <span class="built_in">int</span> builderWkid = srBuilder.Wkid;</span><br><span class="line">    <span class="built_in">string</span> builderWkt = srBuilder.Wkt;</span><br><span class="line">    <span class="built_in">string</span> builderName = srBuilder.Name;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">double</span> xyScale = srBuilder.XYScale;</span><br><span class="line">    <span class="built_in">double</span> xyTolerance = srBuilder.XYTolerance;</span><br><span class="line">    <span class="built_in">double</span> xyResolution = srBuilder.XYResolution;</span><br><span class="line">    Unit unit = srBuilder.Unit;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">double</span> zScale = srBuilder.ZScale;</span><br><span class="line">    <span class="built_in">double</span> zTolerance = srBuilder.ZTolerance;</span><br><span class="line">    Unit zUnit = srBuilder.ZUnit;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">double</span> mScale = srBuilder.MScale;</span><br><span class="line">    <span class="built_in">double</span> mTolerance = srBuilder.MTolerance;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">double</span> falseX = srBuilder.FalseX;</span><br><span class="line">    <span class="built_in">double</span> falseY = srBuilder.FalseY;</span><br><span class="line">    <span class="built_in">double</span> falseZ = srBuilder.FalseZ;</span><br><span class="line">    <span class="built_in">double</span> falseM = srBuilder.FalseM;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get the spatial reference</span></span><br><span class="line">    SpatialReference sr3857 = srBuilder.ToSpatialReference();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// spatial reference properties</span></span><br><span class="line">    <span class="built_in">int</span> srWkid = sr3857.Wkid;</span><br><span class="line">    <span class="built_in">string</span> srWkt = sr3857.Wkt;</span><br><span class="line">    <span class="built_in">string</span> srName = sr3857.Name;</span><br><span class="line"></span><br><span class="line">    xyScale = sr3857.XYScale;</span><br><span class="line">    xyTolerance = sr3857.XYTolerance;</span><br><span class="line">    xyResolution = sr3857.XYResolution;</span><br><span class="line">    unit = sr3857.Unit;</span><br><span class="line"></span><br><span class="line">    zScale = sr3857.ZScale;</span><br><span class="line">    zTolerance = sr3857.ZTolerance;</span><br><span class="line">    zUnit = sr3857.ZUnit;</span><br><span class="line"></span><br><span class="line">    mScale = sr3857.MScale;</span><br><span class="line">    mTolerance = sr3857.MTolerance;</span><br><span class="line"></span><br><span class="line">    falseX = sr3857.FalseX;</span><br><span class="line">    falseY = sr3857.FalseY;</span><br><span class="line">    falseZ = sr3857.FalseZ;</span><br><span class="line">    falseM = sr3857.FalseM;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> hasVcs = sr3857.HasVcs;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="导入和导出空间参考"><a href="#导入和导出空间参考" class="headerlink" title="导入和导出空间参考"></a>导入和导出空间参考</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference srWithVertical = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>, <span class="number">6916</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> xml = srWithVertical.ToXml();</span><br><span class="line">SpatialReference importedSR = SpatialReferenceBuilder.FromXml(xml);</span><br><span class="line"><span class="comment">// importedSR.Wkid = 4326</span></span><br><span class="line"><span class="comment">// importedSR.VcsWkid = 6916</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> json = srWithVertical.ToJson();</span><br><span class="line">importedSR = SpatialReferenceBuilder.FromJson(json);</span><br><span class="line"><span class="comment">// importedSR.Wkid = 4326</span></span><br><span class="line"><span class="comment">// importedSR.VcsWkid = 6916</span></span><br></pre></td></tr></table></figure>

<h3 id="确定给定点处空间参考的格网收敛"><a href="#确定给定点处空间参考的格网收敛" class="headerlink" title="确定给定点处空间参考的格网收敛"></a>确定给定点处空间参考的格网收敛</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Coordinate2D coordinate = <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line"><span class="built_in">double</span> angle = SpatialReferences.WGS84.GetConvergenceAngle(coordinate);</span><br><span class="line"><span class="comment">// angle = 0</span></span><br><span class="line"></span><br><span class="line">SpatialReference srUTM30N = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">32630</span>);</span><br><span class="line">coordinate.X = <span class="number">500000</span>;</span><br><span class="line">coordinate.Y = <span class="number">550000</span>;</span><br><span class="line">angle = srUTM30N.GetConvergenceAngle(coordinate);</span><br><span class="line"><span class="comment">// angle = 0</span></span><br><span class="line"></span><br><span class="line">MapPoint pointWGS84 = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">50</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint pointUTM30N = GeometryEngine.Instance.Project(</span><br><span class="line">  pointWGS84, srUTM30N) <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">coordinate = (Coordinate2D)pointUTM30N;</span><br><span class="line"><span class="comment">// get convergence angle and convert to degrees</span></span><br><span class="line">angle = srUTM30N.GetConvergenceAngle(coordinate) * <span class="number">180</span> / Math.PI;</span><br><span class="line"><span class="comment">// angle = 10.03</span></span><br></pre></td></tr></table></figure>

<h3 id="基准"><a href="#基准" class="headerlink" title="基准"></a>基准</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cimMapDefinition = MapView.Active.Map.GetDefinition();</span><br><span class="line"><span class="comment">// use if map&#x27;s sr does not have a vertical coordinate system</span></span><br><span class="line"><span class="keyword">var</span> datumTransformations = cimMapDefinition.DatumTransforms;</span><br><span class="line"><span class="comment">// use if map&#x27;s sr has a vertical coordinate system</span></span><br><span class="line"><span class="keyword">var</span> hvDatumTransformations = cimMapDefinition.HVDatumTransforms;</span><br></pre></td></tr></table></figure>

<h3 id="空间参照基准和基准属性"><a href="#空间参照基准和基准属性" class="headerlink" title="空间参照基准和基准属性"></a>空间参照基准和基准属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get datum of a spatial reference</span></span><br><span class="line">SpatialReference srWgs84 = SpatialReferences.WGS84;</span><br><span class="line">Datum datum = srWgs84.Datum;</span><br><span class="line"><span class="comment">// datum.Name = &quot;D_WGS_1984&quot;</span></span><br><span class="line"><span class="comment">// datum.Wkid = 6326</span></span><br><span class="line"><span class="comment">// datum.SpheroidName = &quot;WGS_1984&quot;</span></span><br><span class="line"><span class="comment">// datum.SpheroidWkid = 7030</span></span><br><span class="line"><span class="comment">// datum.SpheroidFlattening = 0.0033528106647474805</span></span><br><span class="line"><span class="comment">// datum.SpheroidSemiMajorAxis = 6378137.0</span></span><br><span class="line"><span class="comment">// datum.SpheroidSemiMinorAxis = 6356752.3142451793</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom WKT</span></span><br><span class="line"><span class="built_in">string</span> wyomingWkt = <span class="string">&quot;PROJCS[\&quot;Wyoming_State_Pl_NAD_1927\&quot;,GEOGCS[\&quot;GCS_North_American_1927\&quot;,DATUM[\&quot;D_North_American_1927_Perry\&quot;,SPHEROID[\&quot;Clarke_1866_Chase\&quot;,6378210.0,250.0]],PRIMEM[\&quot;Greenwich\&quot;,0.0],UNIT[\&quot;Degree\&quot;,0.0174532925199433]],PROJECTION[\&quot;Transverse_Mercator\&quot;],PARAMETER[\&quot;false_easting\&quot;,500000.0],PARAMETER[\&quot;false_northing\&quot;,0.0],PARAMETER[\&quot;central_meridian\&quot;,-107.3333333],PARAMETER[\&quot;scale_factor\&quot;,0.9999412],PARAMETER[\&quot;latitude_of_origin\&quot;,40.66666667],UNIT[\&quot;Foot_US\&quot;,0.3048006096012192]]&quot;</span>;</span><br><span class="line">SpatialReference srFromWkt = SpatialReferenceBuilder.CreateSpatialReference(wyomingWkt);</span><br><span class="line">datum = srWgs84.Datum;</span><br><span class="line"><span class="comment">// datum.Name = &quot;D_North_American_1927_Perry&quot;</span></span><br><span class="line"><span class="comment">// datum.Wkid = 0</span></span><br><span class="line"><span class="comment">// datum.SpheroidName = &quot;Clarke_1866_Chase&quot;</span></span><br><span class="line"><span class="comment">// datum.SpheroidWkid = 0</span></span><br><span class="line"><span class="comment">// datum.SpheroidFlattening = 0.004</span></span><br><span class="line"><span class="comment">// datum.SpheroidSemiMajorAxis = 6378210.0</span></span><br><span class="line"><span class="comment">// datum.SpheroidSemiMinorAxis = 6352697.16</span></span><br></pre></td></tr></table></figure>

<h2 id="坐标3D"><a href="#坐标3D" class="headerlink" title="坐标3D"></a>坐标3D</h2><h3 id="矢量极坐标"><a href="#矢量极坐标" class="headerlink" title="矢量极坐标"></a>矢量极坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Coordinate3D polarVector = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>);</span><br><span class="line">Tuple&lt;<span class="built_in">double</span>, <span class="built_in">double</span>, <span class="built_in">double</span>&gt; polarComponents = polarVector.QueryPolarComponents();</span><br><span class="line"><span class="comment">// polarComponents.Item1 = 0  (azimuth)</span></span><br><span class="line"><span class="comment">// polarComponents.Item2 = 0 (inclination)</span></span><br><span class="line"><span class="comment">// polarComponents.Item3 = 7 (magnitude)</span></span><br><span class="line"></span><br><span class="line">polarVector.SetPolarComponents(Math.PI / <span class="number">4</span>, Math.PI / <span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line">polarComponents = polarVector.QueryComponents();</span><br><span class="line"><span class="comment">// polarComponents.Item1 = 0 (x)</span></span><br><span class="line"><span class="comment">// polarComponents.Item2 = 0 (y)</span></span><br><span class="line"><span class="comment">// polarComponents.Item3 = 7 (z)</span></span><br></pre></td></tr></table></figure>

<h3 id="获取矢量倾角"><a href="#获取矢量倾角" class="headerlink" title="获取矢量倾角"></a>获取矢量倾角</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Coordinate3D v = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line"><span class="built_in">double</span> inclination = v.Inclination;         <span class="comment">// inclination = PI/2</span></span><br><span class="line"></span><br><span class="line">v.SetComponents(<span class="number">-2</span>, <span class="number">-3</span>, <span class="number">0</span>);</span><br><span class="line">inclination = v.Inclination;                <span class="comment">// inclination = 0</span></span><br><span class="line"></span><br><span class="line">v.SetComponents(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>);</span><br><span class="line">inclination = v.Inclination;                <span class="comment">// inclination = -PI/2</span></span><br></pre></td></tr></table></figure>

<h3 id="获取矢量方位角"><a href="#获取矢量方位角" class="headerlink" title="获取矢量方位角"></a>获取矢量方位角</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Coordinate3D vector = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">double</span> azimuth = vector.Azimuth;      <span class="comment">// azimuth = 0</span></span><br><span class="line"></span><br><span class="line">vector.SetComponents(<span class="number">1</span>, <span class="number">1</span>, <span class="number">42</span>);</span><br><span class="line">azimuth = vector.Azimuth;</span><br><span class="line"><span class="built_in">double</span> degrees = AngularUnit.Degrees.ConvertFromRadians(azimuth);       <span class="comment">// degrees = 45</span></span><br><span class="line"></span><br><span class="line">vector.SetComponents(<span class="number">-8</span>, <span class="number">8</span>, <span class="number">2</span>);</span><br><span class="line">azimuth = vector.Azimuth;</span><br><span class="line">degrees = AngularUnit.Degrees.ConvertFromRadians(azimuth);              <span class="comment">// degrees = 315</span></span><br></pre></td></tr></table></figure>

<h3 id="向量运算"><a href="#向量运算" class="headerlink" title="向量运算"></a>向量运算</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Easy 3D vectors</span></span><br><span class="line">Coordinate3D v = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// v.Magnitude = 1</span></span><br><span class="line"></span><br><span class="line">Coordinate3D other = <span class="keyword">new</span> Coordinate3D(<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// other.Magnitude = -1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> dotProduct = v.DotProduct(other);      <span class="comment">// dotProduct = 0</span></span><br><span class="line"></span><br><span class="line">Coordinate3D crossProduct = v.CrossProduct(other);</span><br><span class="line"><span class="comment">// crossProduct.X = 0</span></span><br><span class="line"><span class="comment">// crossProduct.Y = 0</span></span><br><span class="line"><span class="comment">// crossProduct.Z = 1</span></span><br><span class="line"></span><br><span class="line">Coordinate3D addVector = v.AddCoordinate3D(other);</span><br><span class="line"><span class="comment">// addVector.X = -1</span></span><br><span class="line"><span class="comment">// addVector.Y = 1</span></span><br><span class="line"><span class="comment">// addVector.Z = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rotate around x-axis</span></span><br><span class="line">Coordinate3D w = v;</span><br><span class="line">w.Rotate(Math.PI, other);</span><br><span class="line"><span class="comment">// w.X = 0</span></span><br><span class="line"><span class="comment">// w.Y = -1</span></span><br><span class="line"><span class="comment">// w.Z = 0</span></span><br><span class="line"></span><br><span class="line">w.Scale(<span class="number">0.5</span>);</span><br><span class="line"><span class="comment">// w.X = 0</span></span><br><span class="line"><span class="comment">// w.Y = -0.5</span></span><br><span class="line"><span class="comment">// w.Z = 0</span></span><br><span class="line"></span><br><span class="line">w.Scale(<span class="number">-4</span>);</span><br><span class="line"><span class="comment">// w.X = 0</span></span><br><span class="line"><span class="comment">// ww.Y = 2</span></span><br><span class="line"><span class="comment">// w.Z = 0</span></span><br><span class="line"><span class="comment">// w.Magnitude = 2</span></span><br><span class="line"></span><br><span class="line">w.Move(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// w.X = 3</span></span><br><span class="line"><span class="comment">// w.Y = 4</span></span><br><span class="line"><span class="comment">// w.Z = 0</span></span><br><span class="line"><span class="comment">// w.Magnitude = 5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Coordinate3D emptyVector = <span class="keyword">new</span> Coordinate3D();</span><br><span class="line"><span class="comment">// emptyVector = (0, 0, 0)</span></span><br><span class="line">emptyVector.SetEmpty();</span><br><span class="line"><span class="comment">// emptyVector = (Nan, Nan, Nan)</span></span><br><span class="line"></span><br><span class="line">Coordinate3D c1 = <span class="keyword">new</span> Coordinate3D(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">Coordinate3D c2 = <span class="keyword">new</span> Coordinate3D(<span class="number">9</span>, <span class="number">-1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result_add = c1 + c2;</span><br><span class="line"><span class="comment">// result_add = (11, 2, 7)</span></span><br><span class="line"><span class="keyword">var</span> result_sub = c1 - c2;</span><br><span class="line"><span class="comment">// result_sub = (-7, 4, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = result_sub != result_add;</span><br><span class="line"><span class="comment">// b = true</span></span><br><span class="line"></span><br><span class="line">result_add = emptyVector + c1;</span><br><span class="line"><span class="comment">// result_add = (Nan, Nan, Nan)</span></span><br><span class="line"></span><br><span class="line">b = result_add == emptyVector;</span><br><span class="line"><span class="comment">// b = true</span></span><br></pre></td></tr></table></figure>

<h3 id="2D-矢量操作"><a href="#2D-矢量操作" class="headerlink" title="2D 矢量操作"></a>2D 矢量操作</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Coordinate2D v = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// v.Magnitude = 1</span></span><br><span class="line"></span><br><span class="line">Coordinate2D other = <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">double</span> dotProduct = v.DotProduct(other);</span><br><span class="line"><span class="comment">// dotProduct = 0</span></span><br><span class="line"></span><br><span class="line">Coordinate2D w = v + other;</span><br><span class="line"><span class="comment">// w = (-1, 1)</span></span><br><span class="line"></span><br><span class="line">w += other;</span><br><span class="line"><span class="comment">// w = (-2, 1)</span></span><br><span class="line"></span><br><span class="line">w -= other;</span><br><span class="line"><span class="comment">// w = (-1, 1)</span></span><br><span class="line"></span><br><span class="line">w = v;</span><br><span class="line">w.Rotate(Math.PI, other);</span><br><span class="line"><span class="comment">// w = (-2, -1)</span></span><br><span class="line"></span><br><span class="line">w = other;</span><br><span class="line"></span><br><span class="line">w.Scale(<span class="number">-4</span>);</span><br><span class="line"><span class="comment">// w = (4, 0)</span></span><br><span class="line"><span class="comment">// w.Magnitude = 4</span></span><br><span class="line"></span><br><span class="line">w.Move(<span class="number">-1</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// w = (3, 4)</span></span><br><span class="line"><span class="comment">// w.Magnitude = 5</span></span><br><span class="line"></span><br><span class="line">w.Move(<span class="number">-6</span>, <span class="number">-1</span>);</span><br><span class="line">Tuple&lt;<span class="built_in">double</span>, <span class="built_in">double</span>&gt; components = w.QueryComponents();</span><br><span class="line"><span class="comment">// components = (-3, 3)</span></span><br><span class="line"><span class="comment">// w.Magnitude = 3 * Math.Sqrt(2)</span></span><br><span class="line"></span><br><span class="line">Coordinate2D unitVector = w.GetUnitVector();</span><br><span class="line"><span class="comment">// w = (-Math.Sqrt(2) / 2, Math.Sqrt(2) / 2)</span></span><br><span class="line"><span class="comment">// w.Magnitude = 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w.SetComponents(<span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<h2 id="生成器属性"><a href="#生成器属性" class="headerlink" title="生成器属性"></a>生成器属性</h2><h3 id="生成器属性-1"><a href="#生成器属性-1" class="headerlink" title="生成器属性"></a>生成器属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list of points</span></span><br><span class="line">List&lt;MapPoint&gt; points = <span class="keyword">new</span> List&lt;MapPoint&gt;</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// will have attributes because it is created with convenience method</span></span><br><span class="line">Polyline polylineWithAttrs = PolylineBuilderEx.CreatePolyline(points);</span><br><span class="line"><span class="built_in">bool</span> hasZ = polylineWithAttrs.HasZ;          <span class="comment">// hasZ = true</span></span><br><span class="line"><span class="built_in">bool</span> hasM = polylineWithAttrs.HasM;          <span class="comment">// hasM = true</span></span><br><span class="line"><span class="built_in">bool</span> hasID = polylineWithAttrs.HasID;        <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is specified as a parameter</span></span><br><span class="line">Polyline polylineWithoutAttrs = </span><br><span class="line">  PolylineBuilderEx.CreatePolyline(points, AttributeFlags.None);</span><br><span class="line">hasZ = polylineWithoutAttrs.HasZ;          <span class="comment">// hasZ = false</span></span><br><span class="line">hasM = polylineWithoutAttrs.HasM;          <span class="comment">// hasM = false</span></span><br><span class="line">hasID = polylineWithoutAttrs.HasID;        <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will have attributes because it is created with convenience method</span></span><br><span class="line">Polygon polygonWithAttrs = PolygonBuilderEx.CreatePolygon(points);</span><br><span class="line">hasZ = polygonWithAttrs.HasZ;               <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = polygonWithAttrs.HasM;               <span class="comment">// hasM = true</span></span><br><span class="line">hasID = polygonWithAttrs.HasID;             <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is specified as a parameter</span></span><br><span class="line">Polygon polygonWithoutAttrs = </span><br><span class="line">      PolygonBuilderEx.CreatePolygon(points, AttributeFlags.None);</span><br><span class="line">hasZ = polygonWithoutAttrs.HasZ;               <span class="comment">// hasZ = false</span></span><br><span class="line">hasM = polygonWithoutAttrs.HasM;               <span class="comment">// hasM = false</span></span><br><span class="line">hasID = polygonWithoutAttrs.HasID;             <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is specified as a parameter</span></span><br><span class="line">PolylineBuilderEx polylineB = </span><br><span class="line">           <span class="keyword">new</span> PolylineBuilderEx(points, AttributeFlags.None);</span><br><span class="line">hasZ = polylineB.HasZ;                      <span class="comment">// hasZ = false</span></span><br><span class="line">hasM = polylineB.HasM;                      <span class="comment">// hasM = false</span></span><br><span class="line">hasID = polylineB.HasID;                    <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will have attributes because it is passed an attributed polyline</span></span><br><span class="line">polylineB = <span class="keyword">new</span> PolylineBuilderEx(polylineWithAttrs);</span><br><span class="line">hasZ = polylineB.HasZ;                      <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = polylineB.HasM;                      <span class="comment">// hasM = true</span></span><br><span class="line">hasID = polylineB.HasID;                    <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is passed a non-attributed polyline</span></span><br><span class="line">polylineB = <span class="keyword">new</span> PolylineBuilderEx(polylineWithoutAttrs);</span><br><span class="line">hasZ = polylineB.HasZ;                      <span class="comment">// hasZ = false</span></span><br><span class="line">hasM = polylineB.HasM;                      <span class="comment">// hasM = false</span></span><br><span class="line">hasID = polylineB.HasID;                    <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is specified as a parameter</span></span><br><span class="line">PolygonBuilderEx polygonB = <span class="keyword">new</span> PolygonBuilderEx(points, AttributeFlags.None);</span><br><span class="line">hasZ = polygonB.HasZ;                       <span class="comment">// hasZ = false</span></span><br><span class="line">hasM = polygonB.HasM;                       <span class="comment">// hasM = false</span></span><br><span class="line">hasID = polygonB.HasID;                     <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will have attributes because it is passed an attributed polygon</span></span><br><span class="line">polygonB = <span class="keyword">new</span> PolygonBuilderEx(polygonWithAttrs);</span><br><span class="line">hasZ = polygonB.HasZ;                       <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = polygonB.HasM;                       <span class="comment">// hasM = true</span></span><br><span class="line">hasID = polygonB.HasID;                     <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// will not have attributes because it is passed a non-attributed polygon</span></span><br><span class="line">polygonB = <span class="keyword">new</span> PolygonBuilderEx(polygonWithoutAttrs);</span><br><span class="line">hasZ = polygonB.HasZ;                       <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = polygonB.HasM;                       <span class="comment">// hasM = true</span></span><br><span class="line">hasID = polygonB.HasID;                     <span class="comment">// hasID = true</span></span><br></pre></td></tr></table></figure>

<h2 id="地图点"><a href="#地图点" class="headerlink" title="地图点"></a>地图点</h2><h3 id="构造地图点"><a href="#构造地图点" class="headerlink" title="构造地图点"></a>构造地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// create a 3d point with M</span></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors don&#x27;t need to run on the MCT.</span></span><br><span class="line">MapPointBuilderEx mb = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>);</span><br><span class="line"><span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">MapPoint ptWithM = mb.ToGeometry();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MapPoint clone = ptWithM.Clone() <span class="keyword">as</span> MapPoint;</span><br><span class="line">MapPoint anotherM = MapPointBuilderEx.CreateMapPoint(ptWithM);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MapPointBuilderEx builderEx = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>);</span><br><span class="line">builderEx.HasM = <span class="literal">true</span>;</span><br><span class="line">builderEx.M = <span class="number">4.0</span>;</span><br><span class="line"></span><br><span class="line">pt = builderEx.ToGeometry() <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// or another alternative with builderEx constructor</span></span><br><span class="line">builderEx = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="literal">true</span>, <span class="number">3.0</span>, <span class="literal">true</span>, <span class="number">4.0</span>, <span class="literal">false</span>, <span class="number">0</span>);</span><br><span class="line">pt = builderEx.ToGeometry() <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use a builderEx convenience method</span></span><br><span class="line">pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="地图点生成器属性"><a href="#地图点生成器属性" class="headerlink" title="地图点生成器属性"></a>地图点生成器属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or a builderEx constructor.</span></span><br><span class="line"><span class="comment">//  neither need to run on the MCT.</span></span><br><span class="line"></span><br><span class="line">MapPoint point1 = <span class="literal">null</span>;</span><br><span class="line">MapPoint point2 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">MapPointBuilderEx mb = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>);</span><br><span class="line"><span class="built_in">bool</span> bhasZ = mb.HasZ;          <span class="comment">// hasZ = true</span></span><br><span class="line"><span class="built_in">bool</span> bhasM = mb.HasM;          <span class="comment">// hasM = false</span></span><br><span class="line"><span class="built_in">bool</span> bhasID = mb.HasID;        <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">point1 = mb.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">// change some of the builder properties</span></span><br><span class="line">mb.X = <span class="number">11</span>;</span><br><span class="line">mb.Y = <span class="number">22</span>;</span><br><span class="line">mb.HasZ = <span class="literal">false</span>;</span><br><span class="line">mb.HasM = <span class="literal">true</span>;</span><br><span class="line">mb.M = <span class="number">44</span>;</span><br><span class="line"><span class="comment">// create another point</span></span><br><span class="line">point2 = mb.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> x = point1.X;                  <span class="comment">// x = 1.0</span></span><br><span class="line"><span class="built_in">double</span> y = point1.Y;                  <span class="comment">// y = 2.0</span></span><br><span class="line"><span class="built_in">double</span> z = point1.Z;                  <span class="comment">// z = 3.0</span></span><br><span class="line"><span class="built_in">double</span> m = point1.M;                  <span class="comment">// m = Nan</span></span><br><span class="line"><span class="built_in">int</span> ID = point1.ID;                   <span class="comment">// ID = 0</span></span><br><span class="line"><span class="built_in">bool</span> hasZ = point1.HasZ;              <span class="comment">// hasZ = true</span></span><br><span class="line"><span class="built_in">bool</span> hasM = point1.HasM;              <span class="comment">// hasM = false</span></span><br><span class="line"><span class="built_in">bool</span> hasID = point1.HasID;            <span class="comment">// hasID = false</span></span><br><span class="line"><span class="built_in">bool</span> isEmpty = point1.IsEmpty;        <span class="comment">// isEmpty = false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isEqual = point1.IsEqual(point2);    <span class="comment">// isEqual = false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods </span></span><br><span class="line">MapPoint point3 = MapPointBuilderEx.CreateMapPoint(point1);</span><br><span class="line">x = point3.X;                   <span class="comment">// x = 1.0</span></span><br><span class="line">y = point3.Y;                   <span class="comment">// y = 2.0</span></span><br><span class="line">z = point3.Z;                   <span class="comment">// z = 3.0</span></span><br><span class="line">m = point3.M;                   <span class="comment">// m = Nan</span></span><br><span class="line">ID = point3.ID;                 <span class="comment">// ID = 0</span></span><br><span class="line">hasZ = point3.HasZ;             <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = point3.HasM;             <span class="comment">// hasM = false</span></span><br><span class="line">hasID = point3.HasID;           <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MapPointBuilderEx builderEx = <span class="keyword">new</span> MapPointBuilderEx(point1);</span><br><span class="line">x = builderEx.X;              <span class="comment">// x = 1.0</span></span><br><span class="line">y = builderEx.Y;              <span class="comment">// y = 2.0</span></span><br><span class="line">z = builderEx.Z;              <span class="comment">// z = 3.0</span></span><br><span class="line">m = builderEx.M;              <span class="comment">// m = Nan</span></span><br><span class="line">ID = builderEx.ID;            <span class="comment">// ID = 0</span></span><br><span class="line">hasZ = builderEx.HasZ;        <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = builderEx.HasM;        <span class="comment">// hasM = false</span></span><br><span class="line">hasID = builderEx.HasID;      <span class="comment">// hasID = false</span></span><br><span class="line">isEmpty = builderEx.IsEmpty;     <span class="comment">// isEmpty = false</span></span><br><span class="line"></span><br><span class="line">MapPoint point4 = builderEx.ToGeometry() <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MapPoint point5 = MapPointBuilderEx.CreateMapPoint(point1);</span><br><span class="line">x = point5.X;              <span class="comment">// x = 1.0</span></span><br><span class="line">y = point5.Y;              <span class="comment">// y = 2.0</span></span><br><span class="line">z = point5.Z;              <span class="comment">// z = 3.0</span></span><br><span class="line">m = point5.M;              <span class="comment">// m = Nan</span></span><br><span class="line">ID = point5.ID;            <span class="comment">// ID = 0</span></span><br><span class="line">hasZ = point5.HasZ;        <span class="comment">// hasZ = true</span></span><br><span class="line">hasM = point5.HasM;        <span class="comment">// hasM = false</span></span><br><span class="line">hasID = point5.HasID;      <span class="comment">// hasID = false</span></span><br><span class="line">isEmpty = point5.IsEmpty;     <span class="comment">// isEmpty = false</span></span><br></pre></td></tr></table></figure>

<h3 id="地图点是平等的"><a href="#地图点是平等的" class="headerlink" title="地图点是平等的"></a>地图点是平等的</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="built_in">int</span> ID = pt1.ID;           <span class="comment">// ID = 5</span></span><br><span class="line"><span class="built_in">bool</span> hasID = pt1.HasID;     <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">ID = pt2.ID;        <span class="comment">// ID = 0</span></span><br><span class="line">hasID = pt2.HasID;  <span class="comment">// hasID = true</span></span><br><span class="line"></span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">ID = pt3.ID;          <span class="comment">// ID = 0</span></span><br><span class="line">hasID = pt3.HasID;    <span class="comment">// hasID = false</span></span><br><span class="line"></span><br><span class="line">MapPoint pt4 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">44</span>);</span><br><span class="line">ID = pt4.ID;          <span class="comment">// ID = 0</span></span><br><span class="line">hasID = pt4.HasID;    <span class="comment">// hasID = false</span></span><br><span class="line"><span class="built_in">bool</span> hasM = pt4.HasM; <span class="comment">// hasM = true</span></span><br><span class="line"></span><br><span class="line">MapPoint pt5 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">ID = pt5.ID;          <span class="comment">// ID = 0</span></span><br><span class="line">hasID = pt5.HasID;    <span class="comment">// hasID = false</span></span><br><span class="line">hasM = pt5.HasM;      <span class="comment">// hasM = false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isEqual = pt1.IsEqual(pt2);   <span class="comment">// isEqual = false, different IDs</span></span><br><span class="line">isEqual = pt2.IsEqual(pt3);        <span class="comment">// isEqual = false, HasId is different</span></span><br><span class="line">isEqual = pt4.IsEqual(pt3);        <span class="comment">// isEqual = false, different Ms</span></span><br><span class="line">isEqual = pt1.IsEqual(pt5);        <span class="comment">// isEqual = false, pt has M, id but pt5 does not.  </span></span><br></pre></td></tr></table></figure>

<h3 id="缩放至指定点"><a href="#缩放至指定点" class="headerlink" title="缩放至指定点"></a>缩放至指定点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a point</span></span><br><span class="line"><span class="keyword">var</span> pt = MapPointBuilderEx.CreateMapPoint(x, y, </span><br><span class="line">               SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>));</span><br><span class="line"><span class="comment">//Buffer it - for purpose of zoom</span></span><br><span class="line"><span class="keyword">var</span> poly = GeometryEngine.Instance.Buffer(pt, buffer_size);</span><br><span class="line"></span><br><span class="line"><span class="comment">//do we need to project the buffer polygon?</span></span><br><span class="line"><span class="keyword">if</span> (!MapView.Active.Map.SpatialReference.IsEqual(poly.SpatialReference))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//project the polygon</span></span><br><span class="line">  poly = GeometryEngine.Instance.Project(poly, MapView.Active.Map.SpatialReference);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Must run on MCT.</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Zoom - add in a delay for animation effect</span></span><br><span class="line">  MapView.Active.ZoomTo(poly, <span class="keyword">new</span> TimeSpan(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="折线"><a href="#折线" class="headerlink" title="折线"></a>折线</h2><h3 id="构造折线-从映射点的枚举"><a href="#构造折线-从映射点的枚举" class="headerlink" title="构造折线 - 从映射点的枚举"></a>构造折线 - 从映射点的枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or a builderEx constructor.</span></span><br><span class="line"><span class="comment">// neither need to run on the MCT</span></span><br><span class="line"></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(startPt);</span><br><span class="line">list.Add(endPt);</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(list, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use AttributeFlags.None since we only have 2D points in the list</span></span><br><span class="line">PolylineBuilderEx pb = <span class="keyword">new</span> PolylineBuilderEx(list, AttributeFlags.None);</span><br><span class="line">pb.SpatialReference = SpatialReferences.WGS84;</span><br><span class="line">Polyline polyline2 = pb.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">//     use AttributeFlags.NoAttributes because we only have 2d points in the list</span></span><br><span class="line">Polyline polyline4 = PolylineBuilderEx.CreatePolyline(list, AttributeFlags.None);</span><br></pre></td></tr></table></figure>

<h3 id="获取折线的点"><a href="#获取折线的点" class="headerlink" title="获取折线的点"></a>获取折线的点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the points as a readonly Collection</span></span><br><span class="line">ReadOnlyPointCollection pts = polyline.Points;</span><br><span class="line"><span class="built_in">int</span> numPts = polyline.PointCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get an enumeration of the points</span></span><br><span class="line">IEnumerator&lt;MapPoint&gt; enumPts = polyline.Points.GetEnumerator();</span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get the point coordinates as a readonly list of Coordinate2D</span></span><br><span class="line">IReadOnlyList&lt;Coordinate2D&gt; coordinates = polyline.Copy2DCoordinatesToList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get the point coordinates as a readonly list of Coordinate3D</span></span><br><span class="line">IReadOnlyList&lt;Coordinate3D&gt; coordinates3D = polyline.Copy3DCoordinatesToList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get a subset of the collection as Coordinate2D using preallocated memory</span></span><br><span class="line"></span><br><span class="line">IList&lt;Coordinate2D&gt; coordinate2Ds = <span class="keyword">new</span> List&lt;Coordinate2D&gt;(<span class="number">10</span>);   <span class="comment">// allocate some space</span></span><br><span class="line">ICollection&lt;Coordinate2D&gt; subsetCoordinates2D = coordinate2Ds;    <span class="comment">// assign</span></span><br><span class="line">pts.Copy2DCoordinatesToList(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">ref</span> subsetCoordinates2D);       <span class="comment">// copy 2 elements from index 1 into the allocated list</span></span><br><span class="line">                                                                  <span class="comment">// coordinate2Ds.Count = 2</span></span><br><span class="line">                                                                  <span class="comment">// do something with the coordinate2Ds</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// without allocating more space, obtain a different set of coordinates</span></span><br><span class="line">pts.Copy2DCoordinatesToList(<span class="number">5</span>, <span class="number">9</span>, <span class="keyword">ref</span> subsetCoordinates2D);       <span class="comment">// copy 9 elements from index 5 into the allocated list</span></span><br><span class="line">                                                                  <span class="comment">// coordinate2Ds.Count = 9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get a subset of the collection as Coordinate3D using preallocated memory</span></span><br><span class="line"></span><br><span class="line">IList&lt;Coordinate3D&gt; coordinate3Ds = <span class="keyword">new</span> List&lt;Coordinate3D&gt;(<span class="number">15</span>);   <span class="comment">// allocate some space</span></span><br><span class="line">ICollection&lt;Coordinate3D&gt; subsetCoordinates3D = coordinate3Ds;    <span class="comment">// assign</span></span><br><span class="line">pts.Copy3DCoordinatesToList(<span class="number">3</span>, <span class="number">5</span>, <span class="keyword">ref</span> subsetCoordinates3D);       <span class="comment">// copy 5 elements from index 3 into the allocated list</span></span><br><span class="line">                                                                  <span class="comment">// coordinate3Ds.Count = 5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// OR   get a subset of the collection as MapPoint using preallocated memory</span></span><br><span class="line"></span><br><span class="line">IList&lt;MapPoint&gt; mapPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;(<span class="number">7</span>);   <span class="comment">// allocate some space</span></span><br><span class="line">ICollection&lt;MapPoint&gt; subsetMapPoint = mapPoints;    <span class="comment">// assign</span></span><br><span class="line">pts.CopyPointsToList(<span class="number">1</span>, <span class="number">4</span>, <span class="keyword">ref</span> subsetMapPoint);      <span class="comment">// copy 4 elements from index 1 into the allocated list</span></span><br><span class="line">                                                     <span class="comment">// mapPoints.Count = 4</span></span><br></pre></td></tr></table></figure>

<h3 id="获取折线的各个部分"><a href="#获取折线的各个部分" class="headerlink" title="获取折线的各个部分"></a>获取折线的各个部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> numParts = polyline.PartCount;</span><br><span class="line"><span class="comment">// get the parts as a readonly collection</span></span><br><span class="line">ReadOnlyPartCollection parts = polyline.Parts;</span><br></pre></td></tr></table></figure>

<h3 id="枚举折线的各个部分"><a href="#枚举折线的各个部分" class="headerlink" title="枚举折线的各个部分"></a>枚举折线的各个部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">ReadOnlyPartCollection polylineParts = polyline.Parts;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enumerate the segments to get the length</span></span><br><span class="line"><span class="built_in">double</span> len = <span class="number">0</span>;</span><br><span class="line">IEnumerator&lt;ReadOnlySegmentCollection&gt; segments = polylineParts.GetEnumerator();</span><br><span class="line"><span class="keyword">while</span> (segments.MoveNext())</span><br><span class="line">&#123;</span><br><span class="line">  ReadOnlySegmentCollection seg = segments.Current;</span><br><span class="line">  <span class="keyword">foreach</span> (Segment s <span class="keyword">in</span> seg)</span><br><span class="line">  &#123;</span><br><span class="line">    len += s.Length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// perhaps do something specific per segment type</span></span><br><span class="line">    <span class="keyword">switch</span> (s.SegmentType)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.Line:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.Bezier:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.EllipticArc:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use foreach pattern</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> part <span class="keyword">in</span> polyline.Parts)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> segment <span class="keyword">in</span> part)</span><br><span class="line">  &#123;</span><br><span class="line">    len += segment.Length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// perhaps do something specific per segment type</span></span><br><span class="line">    <span class="keyword">switch</span> (segment.SegmentType)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.Line:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.Bezier:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> SegmentType.EllipticArc:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反转折线中点的顺序"><a href="#反转折线中点的顺序" class="headerlink" title="反转折线中点的顺序"></a>反转折线中点的顺序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> polylineBuilder = <span class="keyword">new</span> PolylineBuilderEx(polyline);</span><br><span class="line">polylineBuilder.ReverseOrientation();</span><br><span class="line">Polyline reversedPolyline = polylineBuilder.ToGeometry();</span><br></pre></td></tr></table></figure>

<h3 id="获取折线的段"><a href="#获取折线的段" class="headerlink" title="获取折线的段"></a>获取折线的段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ICollection&lt;Segment&gt; collection = <span class="keyword">new</span> List&lt;Segment&gt;();</span><br><span class="line">polyline.GetAllSegments(<span class="keyword">ref</span> collection);</span><br><span class="line"><span class="built_in">int</span> numSegments = collection.Count;    <span class="comment">// = 10</span></span><br><span class="line"></span><br><span class="line">IList&lt;Segment&gt; iList = collection <span class="keyword">as</span> IList&lt;Segment&gt;;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numSegments; i++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// do something with iList[i]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use the segments to build another polyline</span></span><br><span class="line">Polyline polylineFromSegments = PolylineBuilderEx.CreatePolyline(collection);</span><br></pre></td></tr></table></figure>

<h3 id="构建多部分折线"><a href="#构建多部分折线" class="headerlink" title="构建多部分折线"></a>构建多部分折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; firstPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">firstPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">firstPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">firstPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">firstPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; nextPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">nextPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">11.0</span>, <span class="number">1.0</span>));</span><br><span class="line">nextPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">11.0</span>, <span class="number">2.0</span>));</span><br><span class="line">nextPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">12.0</span>, <span class="number">2.0</span>));</span><br><span class="line">nextPoints.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">12.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// use AttributeFlags.None since we have 2D points in the list</span></span><br><span class="line">PolylineBuilderEx pBuilder = <span class="keyword">new</span> PolylineBuilderEx(firstPoints, AttributeFlags.None);</span><br><span class="line">pBuilder.AddPart(nextPoints);</span><br><span class="line"></span><br><span class="line">Polyline polyline = pBuilder.ToGeometry();</span><br><span class="line"><span class="comment">// polyline has 2 parts</span></span><br><span class="line"></span><br><span class="line">pBuilder.RemovePart(<span class="number">0</span>);</span><br><span class="line">polyline = pBuilder.ToGeometry();</span><br><span class="line"><span class="comment">// polyline has 1 part</span></span><br></pre></td></tr></table></figure>

<h3 id="折线的起点"><a href="#折线的起点" class="headerlink" title="折线的起点"></a>折线的起点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Method 1: Get the start point of the polyline by converting the polyline </span></span><br><span class="line"><span class="comment">//    into a collection of points and getting the first point</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sketchGeometry is a Polyline</span></span><br><span class="line"><span class="comment">// get the sketch as a point collection</span></span><br><span class="line"><span class="keyword">var</span> pointCol = ((Multipart)sketchGeometry).Points;</span><br><span class="line"><span class="comment">// Get the start point of the line</span></span><br><span class="line"><span class="keyword">var</span> firstPoint = pointCol[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Method 2: Convert polyline into a collection of line segments </span></span><br><span class="line"><span class="comment">//   and get the &quot;StartPoint&quot; of the first line segment.</span></span><br><span class="line"><span class="keyword">var</span> polylineGeom = sketchGeometry <span class="keyword">as</span> ArcGIS.Core.Geometry.Polyline;</span><br><span class="line"><span class="keyword">var</span> polyLineParts = polylineGeom.Parts;</span><br><span class="line"></span><br><span class="line">ReadOnlySegmentCollection polylineSegments = polyLineParts.First();</span><br><span class="line"></span><br><span class="line"><span class="comment">//get the first segment as a LineSegment</span></span><br><span class="line"><span class="keyword">var</span> firsLineSegment = polylineSegments.First() <span class="keyword">as</span> LineSegment;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Now get the start Point</span></span><br><span class="line"><span class="keyword">var</span> startPoint = firsLineSegment.StartPoint;</span><br></pre></td></tr></table></figure>

<h3 id="按角度构造布料"><a href="#按角度构造布料" class="headerlink" title="按角度构造布料"></a>按角度构造布料</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MapPoint startPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">double</span> tangentDirection = Math.PI / <span class="number">6</span>;</span><br><span class="line">ArcOrientation orientation = ArcOrientation.ArcCounterClockwise;</span><br><span class="line"><span class="built_in">double</span> startRadius = <span class="built_in">double</span>.PositiveInfinity;</span><br><span class="line"><span class="built_in">double</span> endRadius = <span class="number">0.2</span>;</span><br><span class="line">ClothoidCreateMethod createMethod = ClothoidCreateMethod.ByAngle;</span><br><span class="line"><span class="built_in">double</span> angle = Math.PI / <span class="number">2</span>;</span><br><span class="line">CurveDensifyMethod densifyMethod = CurveDensifyMethod.ByLength;</span><br><span class="line"><span class="built_in">double</span> densifyParameter = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(startPoint, tangentDirection, startRadius, endRadius, orientation, createMethod, angle, densifyMethod, densifyParameter, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> numPoints = polyline.PointCount;</span><br><span class="line">MapPoint queryPoint = polyline.Points[numPoints - <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">MapPoint pointOnPath;</span><br><span class="line"><span class="built_in">double</span> radiusCalculated, tangentDirectionCalculated, lengthCalculated, angleCalculated;</span><br><span class="line"></span><br><span class="line">PolylineBuilderEx.QueryClothoidParameters(queryPoint, startPoint, tangentDirection, startRadius, endRadius, orientation, createMethod, angle, <span class="keyword">out</span> pointOnPath, <span class="keyword">out</span> radiusCalculated, <span class="keyword">out</span> tangentDirectionCalculated, <span class="keyword">out</span> lengthCalculated, <span class="keyword">out</span> angleCalculated, SpatialReferences.WGS84);</span><br></pre></td></tr></table></figure>

<h3 id="按长度构造布料"><a href="#按长度构造布料" class="headerlink" title="按长度构造布料"></a>按长度构造布料</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">MapPoint startPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">MapPoint queryPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">3.8</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">double</span> tangentDirection = <span class="number">0</span>;</span><br><span class="line">ArcOrientation orientation = ArcOrientation.ArcCounterClockwise;</span><br><span class="line"><span class="built_in">double</span> startRadius = <span class="built_in">double</span>.PositiveInfinity;</span><br><span class="line"><span class="built_in">double</span> endRadius = <span class="number">1</span>;</span><br><span class="line">ClothoidCreateMethod createMethod = ClothoidCreateMethod.ByLength;</span><br><span class="line"><span class="built_in">double</span> curveLength = <span class="number">10</span>;</span><br><span class="line">MapPoint pointOnPath;</span><br><span class="line"><span class="built_in">double</span> radiusCalculated, tangentDirectionCalculated, lengthCalculated, angleCalculated;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PolylineBuilderEx.QueryClothoidParameters(queryPoint, startPoint, tangentDirection, startRadius, endRadius, orientation, createMethod, curveLength, <span class="keyword">out</span> pointOnPath, <span class="keyword">out</span> radiusCalculated, <span class="keyword">out</span> tangentDirectionCalculated, <span class="keyword">out</span> lengthCalculated, <span class="keyword">out</span> angleCalculated, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">pointOnPath = MapPointBuilderEx.CreateMapPoint(<span class="number">3.7652656620171379</span>, <span class="number">1.0332006103128575</span>);</span><br><span class="line">radiusCalculated = <span class="number">2.4876382887687227</span>;</span><br><span class="line">tangentDirectionCalculated = <span class="number">0.80797056423543978</span>;</span><br><span class="line">lengthCalculated = <span class="number">4.0198770235802987</span>;</span><br><span class="line">angleCalculated = <span class="number">0.80797056423544011</span>;</span><br><span class="line"></span><br><span class="line">queryPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">1.85</span>, <span class="number">2.6</span>);</span><br><span class="line"></span><br><span class="line">PolylineBuilderEx.QueryClothoidParameters(queryPoint, startPoint, tangentDirection, startRadius, endRadius, orientation, createMethod, curveLength, <span class="keyword">out</span> pointOnPath, <span class="keyword">out</span> radiusCalculated, <span class="keyword">out</span> tangentDirectionCalculated, <span class="keyword">out</span> lengthCalculated, <span class="keyword">out</span> angleCalculated, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">pointOnPath = MapPointBuilderEx.CreateMapPoint(<span class="number">1.8409964973501549</span>, <span class="number">2.6115979967308132</span>);</span><br><span class="line">radiusCalculated = <span class="number">1</span>;</span><br><span class="line">tangentDirectionCalculated = <span class="number">-1.2831853071795867</span>;</span><br><span class="line">lengthCalculated = <span class="number">10</span>;</span><br><span class="line">angleCalculated = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">tangentDirection = Math.PI / <span class="number">4</span>;</span><br><span class="line">orientation = ArcOrientation.ArcClockwise;</span><br><span class="line">startRadius = <span class="built_in">double</span>.PositiveInfinity;</span><br><span class="line">endRadius = <span class="number">0.8</span>;</span><br><span class="line">createMethod = ClothoidCreateMethod.ByLength;</span><br><span class="line">curveLength = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(startPoint, tangentDirection, startRadius, endRadius, orientation, createMethod, curveLength, CurveDensifyMethod.ByLength, <span class="number">0.5</span>, SpatialReferences.WGS84);</span><br></pre></td></tr></table></figure>

<h3 id="远距离分割折线"><a href="#远距离分割折线" class="headerlink" title="远距离分割折线"></a>远距离分割折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create list of points</span></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(startPt);</span><br><span class="line">list.Add(endPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors don&#x27;t need to run on the MCT.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the PolylineBuilder as we wish to manipulate the geometry</span></span><br><span class="line"><span class="comment">// use AttributeFlags.None as we have 2D points</span></span><br><span class="line">PolylineBuilderEx polylineBuilder = <span class="keyword">new</span> PolylineBuilderEx(list, AttributeFlags.None);</span><br><span class="line"><span class="comment">// split at a distance 0.75</span></span><br><span class="line">polylineBuilder.SplitAtDistance(<span class="number">0.75</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// get the polyline</span></span><br><span class="line">Polyline p = polylineBuilder.ToGeometry();</span><br><span class="line"><span class="comment">// polyline p should have 3 points  (1,1), (1.75, 1), (2,1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add another path</span></span><br><span class="line">MapPoint p1 = MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint p2 = MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint p3 = MapPointBuilderEx.CreateMapPoint(<span class="number">7.0</span>, <span class="number">1.0</span>);</span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(p1);</span><br><span class="line">pts.Add(p2);</span><br><span class="line">pts.Add(p3);</span><br><span class="line"></span><br><span class="line">polylineBuilder.AddPart(pts);</span><br><span class="line">p = polylineBuilder.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline p has 2 parts.  Each part has 3 points</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// split the 2nd path half way - dont create a new path</span></span><br><span class="line">polylineBuilder.SplitPartAtDistance(<span class="number">1</span>, <span class="number">0.5</span>, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">p = polylineBuilder.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline p still has 2 parts; but now has 7 points </span></span><br></pre></td></tr></table></figure>

<h2 id="多边形"><a href="#多边形" class="headerlink" title="多边形"></a>多边形</h2><h3 id="构造多边形-从映射点的枚举"><a href="#构造多边形-从映射点的枚举" class="headerlink" title="构造多边形 - 从映射点的枚举"></a>构造多边形 - 从映射点的枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>);</span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line">MapPoint pt4 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt1, pt2, pt3, pt4 &#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">// polygon.HasZ will be false - it is determined by the HasZ flag of the points in the list</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or specifically use AttributeFlags.NoAttributes</span></span><br><span class="line">polygon = PolygonBuilderEx.CreatePolygon(list, AttributeFlags.None);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use AttributeFlags.None as we have 2D points</span></span><br><span class="line">PolygonBuilderEx polygonBuilder = <span class="keyword">new</span> PolygonBuilderEx(list, AttributeFlags.None);</span><br><span class="line">polygonBuilder.SpatialReference = SpatialReferences.WGS84;</span><br><span class="line">polygon = polygonBuilder.ToGeometry();</span><br></pre></td></tr></table></figure>

<h3 id="构造多边形-从信封"><a href="#构造多边形-从信封" class="headerlink" title="构造多边形 - 从信封"></a>构造多边形 - 从信封</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint minPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint maxPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an envelope</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(minPt, maxPt);</span><br><span class="line"></span><br><span class="line">Polygon polygonFromEnv = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line"></span><br><span class="line">PolygonBuilderEx polygonBuilderEx = <span class="keyword">new</span> PolygonBuilderEx(env);</span><br><span class="line">polygonBuilderEx.SpatialReference = SpatialReferences.WGS84;</span><br><span class="line">polygonFromEnv = polygonBuilderEx.ToGeometry() <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="获取多边形的点"><a href="#获取多边形的点" class="headerlink" title="获取多边形的点"></a>获取多边形的点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the points as a readonly Collection</span></span><br><span class="line">ReadOnlyPointCollection pts = polygon.Points;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get an enumeration of the points</span></span><br><span class="line">IEnumerator&lt;MapPoint&gt; enumPts = polygon.Points.GetEnumerator();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the point coordinates as a readonly list of Coordinate2D</span></span><br><span class="line">IReadOnlyList&lt;Coordinate2D&gt; coordinates = polygon.Copy2DCoordinatesToList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the point coordinates as a readonly list of Coordinate3D</span></span><br><span class="line">IReadOnlyList&lt;Coordinate3D&gt; coordinates3D = polygon.Copy3DCoordinatesToList();</span><br></pre></td></tr></table></figure>

<h3 id="获取多边形的各个部分"><a href="#获取多边形的各个部分" class="headerlink" title="获取多边形的各个部分"></a>获取多边形的各个部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the parts as a readonly collection</span></span><br><span class="line">ReadOnlyPartCollection parts = polygon.Parts;</span><br></pre></td></tr></table></figure>

<h3 id="枚举多边形的各个部分"><a href="#枚举多边形的各个部分" class="headerlink" title="枚举多边形的各个部分"></a>枚举多边形的各个部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> numSegments = <span class="number">0</span>;</span><br><span class="line">IEnumerator&lt;ReadOnlySegmentCollection&gt; segments = polygon.Parts.GetEnumerator();</span><br><span class="line"><span class="keyword">while</span> (segments.MoveNext())</span><br><span class="line">&#123;</span><br><span class="line">  ReadOnlySegmentCollection seg = segments.Current;</span><br><span class="line">  numSegments += seg.Count;</span><br><span class="line">  <span class="keyword">foreach</span> (Segment s <span class="keyword">in</span> seg)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something with the segment</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多边形的线段"><a href="#获取多边形的线段" class="headerlink" title="获取多边形的线段"></a>获取多边形的线段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Segment&gt; segmentList = <span class="keyword">new</span> List&lt;Segment&gt;(<span class="number">30</span>);</span><br><span class="line">ICollection&lt;Segment&gt; collection = segmentList;</span><br><span class="line">polygon.GetAllSegments(<span class="keyword">ref</span> collection);</span><br><span class="line"><span class="comment">// segmentList.Count = 4</span></span><br><span class="line"><span class="comment">// segmentList.Capacity = 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the segments to build another polygon</span></span><br><span class="line">Polygon polygonFromSegments = PolygonBuilderEx.CreatePolygon(collection);</span><br></pre></td></tr></table></figure>

<h3 id="构建圆环多边形"><a href="#构建圆环多边形" class="headerlink" title="构建圆环多边形"></a>构建圆环多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; outerCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">outerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">10.0</span>, <span class="number">10.0</span>));</span><br><span class="line">outerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">10.0</span>, <span class="number">20.0</span>));</span><br><span class="line">outerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">20.0</span>, <span class="number">20.0</span>));</span><br><span class="line">outerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">20.0</span>, <span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// define the inner polygon as anti-clockwise</span></span><br><span class="line">List&lt;Coordinate2D&gt; innerCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">innerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">13.0</span>, <span class="number">13.0</span>));</span><br><span class="line">innerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">17.0</span>, <span class="number">13.0</span>));</span><br><span class="line">innerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">17.0</span>, <span class="number">17.0</span>));</span><br><span class="line">innerCoordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">13.0</span>, <span class="number">17.0</span>));</span><br><span class="line"></span><br><span class="line">PolygonBuilderEx pbEx = <span class="keyword">new</span> PolygonBuilderEx(outerCoordinates);</span><br><span class="line">Polygon donutEx = pbEx.ToGeometry() <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="built_in">double</span> areaEx = donutEx.Area;       <span class="comment">// area = 100</span></span><br><span class="line"></span><br><span class="line">pbEx.AddPart(innerCoordinates);</span><br><span class="line">donutEx = pbEx.ToGeometry() <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">areaEx = donutEx.Area;    <span class="comment">// area = 84.0</span></span><br><span class="line"></span><br><span class="line">areaEx = GeometryEngine.Instance.Area(donutEx);    <span class="comment">// area = 84.0</span></span><br></pre></td></tr></table></figure>

<h3 id="创建-N-侧正多边形"><a href="#创建-N-侧正多边形" class="headerlink" title="创建 N 侧正多边形"></a>创建 N 侧正多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">// Create an N-sided regular polygon.  A regular sided polygon is a polygon that is equiangular (all angles are equal in measure) </span></span><br><span class="line"><span class="comment">// and equilateral (all sides are equal in length).  See https://en.wikipedia.org/wiki/Regular_polygon</span></span><br><span class="line"><span class="comment">// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;numSides&quot;&gt;The number of sides in the polygon.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;center&quot;&gt;The center of the polygon.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;radius&quot;&gt;The distance from the center of the polygon to a vertex.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;rotation&quot;&gt;The rotation angle in radians of the start point of the polygon. The start point will be</span></span><br><span class="line"><span class="comment">// rotated counterclockwise from the positive x-axis.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;returns&gt;N-sided regular polygon.&lt;/returns&gt;</span></span><br><span class="line"><span class="comment">// &lt;exception cref=&quot;ArgumentException&quot;&gt;Number of sides is less than 3.&lt;/exception&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Polygon <span class="title">CreateRegularPolygon</span>(<span class="params"><span class="built_in">int</span> numSides, Coordinate2D center, <span class="built_in">double</span> radius, <span class="built_in">double</span> rotation</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (numSides &lt; <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException();</span><br><span class="line"></span><br><span class="line">  Coordinate2D[] coords = <span class="keyword">new</span> Coordinate2D[numSides + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">double</span> centerX = center.X;</span><br><span class="line">  <span class="built_in">double</span> centerY = center.Y;</span><br><span class="line">  <span class="built_in">double</span> x = radius * Math.Cos(rotation) + centerX;</span><br><span class="line">  <span class="built_in">double</span> y = radius * Math.Sin(rotation) + centerY;</span><br><span class="line">  Coordinate2D start = <span class="keyword">new</span> Coordinate2D(x, y);</span><br><span class="line">  coords[<span class="number">0</span>] = start;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">double</span> da = <span class="number">2</span> * Math.PI / numSides;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt; numSides; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    x = radius * Math.Cos(i * da + rotation) + centerX;</span><br><span class="line">    y = radius * Math.Sin(i * da + rotation) + centerY;</span><br><span class="line"></span><br><span class="line">    coords[i] = <span class="keyword">new</span> Coordinate2D(x, y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  coords[numSides] = start;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> PolygonBuilderEx.CreatePolygon(coords);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多边形的外环-多边形。获取外部环"><a href="#获取多边形的外环-多边形。获取外部环" class="headerlink" title="获取多边形的外环 - 多边形。获取外部环"></a>获取多边形的外环 - 多边形。获取外部环</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetExteriorRings</span>(<span class="params">Polygon inputPolygon</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (inputPolygon == <span class="literal">null</span> || inputPolygon.IsEmpty)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// polygon part count</span></span><br><span class="line">  <span class="built_in">int</span> partCount = inputPolygon.PartCount;</span><br><span class="line">  <span class="comment">// polygon exterior ring count</span></span><br><span class="line">  <span class="built_in">int</span> numExtRings = inputPolygon.ExteriorRingCount;</span><br><span class="line">  <span class="comment">// get set of exterior rings for the polygon</span></span><br><span class="line">  IList&lt;Polygon&gt; extRings = inputPolygon.GetExteriorRings();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// test each part for &quot;exterior ring&quot;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> idx = <span class="number">0</span>; idx &lt; partCount; idx++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bool</span> isExteriorRing = inputPolygon.IsExteriorRing(idx);</span><br><span class="line">    <span class="keyword">var</span> ring = inputPolygon.GetExteriorRing(idx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="信封"><a href="#信封" class="headerlink" title="信封"></a>信封</h2><h3 id="构造封套"><a href="#构造封套" class="headerlink" title="构造封套"></a>构造封套</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint minPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint maxPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line">Envelope envelope = EnvelopeBuilderEx.CreateEnvelope(minPt, maxPt);</span><br><span class="line"></span><br><span class="line">EnvelopeBuilderEx builderEx = <span class="keyword">new</span> EnvelopeBuilderEx(minPt, maxPt);</span><br><span class="line">envelope = builderEx.ToGeometry() <span class="keyword">as</span> Envelope;</span><br></pre></td></tr></table></figure>

<h3 id="构造信封-从-JSON-字符串"><a href="#构造信封-从-JSON-字符串" class="headerlink" title="构造信封 - 从 JSON 字符串"></a>构造信封 - 从 JSON 字符串</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> jsonString = <span class="string">&quot;&#123; \&quot;xmin\&quot; : 1, \&quot;ymin\&quot; : 2,\&quot;xmax\&quot;:3,\&quot;ymax\&quot;:4,\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">Envelope envFromJson = EnvelopeBuilderEx.FromJson(jsonString);</span><br></pre></td></tr></table></figure>

<h3 id="合并两个信封"><a href="#合并两个信封" class="headerlink" title="合并两个信封"></a>合并两个信封</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use the convenience builders</span></span><br><span class="line">Envelope env1 = EnvelopeBuilderEx.CreateEnvelope(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">Envelope env2 = EnvelopeBuilderEx.CreateEnvelope(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1.5</span>, <span class="number">1.5</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">Envelope env3 = env1.Union(env2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> area = env3.Area;</span><br><span class="line"><span class="built_in">double</span> depth = env3.Depth;</span><br><span class="line"><span class="built_in">double</span> height = env3.Height;</span><br><span class="line"><span class="built_in">double</span> width = env3.Width;</span><br><span class="line"><span class="built_in">double</span> len = env3.Length;</span><br><span class="line"></span><br><span class="line">MapPoint centerPt = env3.Center;</span><br><span class="line">Coordinate2D coord = env3.CenterCoordinate;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isEmpty = env3.IsEmpty;</span><br><span class="line"><span class="built_in">int</span> pointCount = env3.PointCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinates</span></span><br><span class="line"><span class="comment">//env3.XMin, env3.XMax, env3.YMin, env3.YMax</span></span><br><span class="line"><span class="comment">//env3.ZMin, env3.ZMax, env3.MMin, env3.MMax</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isEqual = env1.IsEqual(env2);    <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use the builderEx constructors = don&#x27;t need to run on the MCT.</span></span><br><span class="line">EnvelopeBuilderEx builderEx = <span class="keyword">new</span> EnvelopeBuilderEx(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">builderEx.Union(env2);      <span class="comment">// builder is updated to the result</span></span><br><span class="line"></span><br><span class="line">depth = builderEx.Depth;</span><br><span class="line">height = builderEx.Height;</span><br><span class="line">width = builderEx.Width;</span><br><span class="line"></span><br><span class="line">centerPt = builderEx.Center;</span><br><span class="line">coord = builderEx.CenterCoordinate;</span><br><span class="line"></span><br><span class="line">isEmpty = builderEx.IsEmpty;</span><br><span class="line"></span><br><span class="line">env3 = builderEx.ToGeometry() <span class="keyword">as</span> Envelope;</span><br></pre></td></tr></table></figure>

<h3 id="与两个信封相交"><a href="#与两个信封相交" class="headerlink" title="与两个信封相交"></a>与两个信封相交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use the convenience builders</span></span><br><span class="line">Envelope env1 = EnvelopeBuilderEx.CreateEnvelope(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">Envelope env2 = EnvelopeBuilderEx.CreateEnvelope(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1.5</span>, <span class="number">1.5</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> intersects = env1.Intersects(env2); <span class="comment">// true</span></span><br><span class="line">Envelope env3 = env1.Intersection(env2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use the builderEx constructors = don&#x27;t need to run on the MCT.</span></span><br><span class="line">EnvelopeBuilderEx builderEx = <span class="keyword">new</span> EnvelopeBuilderEx(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">intersects = builderEx.Intersects(env2);</span><br><span class="line">builderEx.Intersection(env2);   <span class="comment">// note this sets the builder to the intersection</span></span><br><span class="line">env3 = builderEx.ToGeometry() <span class="keyword">as</span> Envelope;</span><br></pre></td></tr></table></figure>

<h3 id="展开信封"><a href="#展开信封" class="headerlink" title="展开信封"></a>展开信封</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">Envelope envelope = EnvelopeBuilderEx.CreateEnvelope(<span class="number">100.0</span>, <span class="number">100.0</span>, <span class="number">500.0</span>, <span class="number">500.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// shrink the envelope by 50%</span></span><br><span class="line">Envelope result = envelope.Expand(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors don&#x27;t need to run on the MCT.</span></span><br><span class="line">EnvelopeBuilderEx builderEx = <span class="keyword">new</span> EnvelopeBuilderEx(<span class="number">100.0</span>, <span class="number">100.0</span>, <span class="number">500.0</span>, <span class="number">500.0</span>);</span><br><span class="line">builderEx.Expand(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line">envelope = builderEx.ToGeometry() <span class="keyword">as</span> Envelope;</span><br></pre></td></tr></table></figure>

<h3 id="更新封套的坐标"><a href="#更新封套的坐标" class="headerlink" title="更新封套的坐标"></a>更新封套的坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Coordinate2D minCoord = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">Coordinate2D maxCoord = <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">Coordinate2D c1 = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">Coordinate2D c2 = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the EnvelopeBuilderEx.  This constructor doesn&#x27;t need to run on the MCT.</span></span><br><span class="line"></span><br><span class="line">EnvelopeBuilderEx builderEx = <span class="keyword">new</span> EnvelopeBuilderEx(minCoord, maxCoord);</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, Zmin, MMin  = 1, 3, 0, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 2, 4, 0, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set XMin.  if XMin &gt; XMax; both XMin and XMax change</span></span><br><span class="line">builderEx.XMin = <span class="number">6</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 6, 3, 0, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 6, 4, 0, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set XMax</span></span><br><span class="line">builderEx.XMax = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 6, 3, 0, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 8, 4, 0, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set XMax.  if XMax &lt; XMin, both XMin and XMax change</span></span><br><span class="line">builderEx.XMax = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 3, 3, 0, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 3, 4, 0, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set YMin</span></span><br><span class="line">builderEx.YMin = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 3, 2, 0, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 3, 4, 0, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set ZMin.  if ZMin &gt; ZMax, both ZMin and ZMax change</span></span><br><span class="line">builderEx.ZMin = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 3, 2, 3, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 3, 4, 3, double.Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set ZMax.  if ZMax &lt; ZMin. both ZMin and ZMax change</span></span><br><span class="line">builderEx.ZMax = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 3, 2, -1, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 3, 4, -1, double.Nan</span></span><br><span class="line"></span><br><span class="line">builderEx.SetZCoords(<span class="number">8</span>, <span class="number">-5</span>);</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 3, 2, -5, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 3, 4, 8, double.Nan</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builderEx.SetXYCoords(c1, c2);</span><br><span class="line"><span class="comment">// builderEx.XMin, YMin, ZMin, MMin  = 0, 3, -5, double.Nan</span></span><br><span class="line"><span class="comment">// builderEx.XMax, YMax, ZMax, MMax = 1, 5, 8, double.Nan</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builderEx.HasM = <span class="literal">true</span>;</span><br><span class="line">builderEx.SetMCoords(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> geomEx = builderEx.ToGeometry();</span><br></pre></td></tr></table></figure>

<h2 id="多点"><a href="#多点" class="headerlink" title="多点"></a>多点</h2><h3 id="构造多点-从映射点的枚举"><a href="#构造多点-从映射点的枚举" class="headerlink" title="构造多点 - 从映射点的枚举"></a>构造多点 - 从映射点的枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// use the builderEx constructors - don&#x27;t need to run on the MCT.</span></span><br><span class="line"><span class="comment">//  use AttributeFlags.NoAttributes - we have 2d points in the list</span></span><br><span class="line">MultipointBuilderEx builderEx = <span class="keyword">new</span> MultipointBuilderEx(list, AttributeFlags.None);</span><br><span class="line">Multipoint multiPoint = builderEx.ToGeometry() <span class="keyword">as</span> Multipoint;</span><br><span class="line"><span class="built_in">int</span> ptCount = builderEx.PointCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx convenience methods dont need to run on the MCT</span></span><br><span class="line">multiPoint = MultipointBuilderEx.CreateMultipoint(list);</span><br><span class="line"><span class="comment">// multiPoint.HasZ, HasM, HasID will be false - the attributes are determined </span></span><br><span class="line"><span class="comment">//    based on the attribute state of the points in the list</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or specifically set the state</span></span><br><span class="line">multiPoint = MultipointBuilderEx.CreateMultipoint(list, AttributeFlags.None);</span><br><span class="line"><span class="comment">// multiPoint.HasM = false</span></span><br><span class="line"></span><br><span class="line">multiPoint = MultipointBuilderEx.CreateMultipoint(list, AttributeFlags.HasM);</span><br><span class="line"><span class="comment">// multiPoint.HasM = true</span></span><br><span class="line"></span><br><span class="line">ptCount = multiPoint.PointCount;</span><br></pre></td></tr></table></figure>

<h3 id="构造多点-使用-MultipointBuilderEx"><a href="#构造多点-使用-MultipointBuilderEx" class="headerlink" title="构造多点 - 使用 MultipointBuilderEx"></a>构造多点 - 使用 MultipointBuilderEx</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">Coordinate2D[] coordinate2Ds = <span class="keyword">new</span> Coordinate2D[] &#123; <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">-2</span>) &#125;;</span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">MultipointBuilderEx builder = <span class="keyword">new</span> MultipointBuilderEx(coordinate2Ds, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// builder.PointCount = 2</span></span><br><span class="line"></span><br><span class="line">builder.HasZ = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// builder.Zs.Count = 2</span></span><br><span class="line"><span class="comment">// builder.Zs[0] = 0</span></span><br><span class="line"><span class="comment">// builder.Zs[1] = 0</span></span><br><span class="line"></span><br><span class="line">builder.HasM = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// builder.Ms.Count = 2</span></span><br><span class="line"><span class="comment">// builder.Ms[0] = NaN</span></span><br><span class="line"><span class="comment">// builder.Ms[1] = NaN</span></span><br><span class="line"></span><br><span class="line">builder.HasID = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// builder.IDs.Count = 2</span></span><br><span class="line"><span class="comment">// builder.IDs[0] = 0</span></span><br><span class="line"><span class="comment">// builder.IDs[1] = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set it empty</span></span><br><span class="line">builder.SetEmpty();</span><br><span class="line"><span class="comment">// builder.Coords.Count = 0</span></span><br><span class="line"><span class="comment">// builder.Zs.Count = 0</span></span><br><span class="line"><span class="comment">// builder.Ms.Count = 0</span></span><br><span class="line"><span class="comment">// builder.IDs.Count = 0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// reset coordinates</span></span><br><span class="line">List&lt;Coordinate2D&gt; inCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;() &#123; <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">4</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">6</span>) &#125;;</span><br><span class="line">builder.Coordinate2Ds = inCoords;</span><br><span class="line"><span class="comment">// builder.Coords.Count = 3</span></span><br><span class="line"><span class="comment">// builder.HasZ = true</span></span><br><span class="line"><span class="comment">// builder.HasM = true</span></span><br><span class="line"><span class="comment">// builder.HasID = true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span>[] zs = <span class="keyword">new</span> <span class="built_in">double</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">builder.Zs = zs;   </span><br><span class="line"><span class="comment">// builder.Zs.Count = 6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span>[] ms = <span class="keyword">new</span> <span class="built_in">double</span>[] &#123; <span class="number">0</span>, <span class="number">1</span> &#125;;</span><br><span class="line">builder.Ms = ms;   </span><br><span class="line"><span class="comment">// builder.Ms.Count = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinates are now   (x, y, z, m, id)</span></span><br><span class="line"><span class="comment">//  (1, 2, 1, 0, 0), (3, 4, 2, 1, 0) (5, 6, 1, NaN, 0)</span></span><br><span class="line"></span><br><span class="line">MapPoint mapPoint = builder.GetPoint(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// mapPoint.HasZ = true</span></span><br><span class="line"><span class="comment">// mapPoint.HasM = true</span></span><br><span class="line"><span class="comment">// mapPoint.HasID = true</span></span><br><span class="line"><span class="comment">// mapPoint.Z  = 1</span></span><br><span class="line"><span class="comment">// mapPoint.M = NaN</span></span><br><span class="line"><span class="comment">// mapPoint.ID = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add an M to the list</span></span><br><span class="line">builder.Ms.Add(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// builder.Ms.count = 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinates are now   (x, y, z, m, id)</span></span><br><span class="line"><span class="comment">//  (1, 2, 1, 0, 0), (3, 4, 2, 1, 0) (5, 6, 1, 2, 0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// now get the 2nd point again; it will now have an M value</span></span><br><span class="line">mapPoint = builder.GetPoint(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// mapPoint.M = 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span>[] ids = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span> &#125;;</span><br><span class="line"><span class="comment">// assign ID values</span></span><br><span class="line">builder.IDs = ids;</span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinates are now   (x, y, z, m, id)</span></span><br><span class="line"><span class="comment">//  (1, 2, 1, 0, -1), (3, 4, 2, 1, -2) (5, 6, 1, 2, -3)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// create a new point</span></span><br><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(<span class="number">-300</span>, <span class="number">400</span>, <span class="number">4</span>);</span><br><span class="line">builder.SetPoint(<span class="number">2</span>, point);</span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinates are now   (x, y, z, m, id)</span></span><br><span class="line"><span class="comment">//  (1, 2, 1, 0, -1), (3, 4, 2, 1, -2) (-300, 400, 4, NaN, 0)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder.RemovePoints(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// builder.PointCount = 1</span></span><br></pre></td></tr></table></figure>

<h3 id="修改多点的点"><a href="#修改多点的点" class="headerlink" title="修改多点的点"></a>修改多点的点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume a multiPoint has been built from 4 points</span></span><br><span class="line"><span class="comment">// the modified multiPoint will have the first point removed and the last point moved</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the builderEx constructors = don&#x27;t need to run on the MCT.</span></span><br><span class="line">MultipointBuilderEx builderEx = <span class="keyword">new</span> MultipointBuilderEx(multipoint);</span><br><span class="line"><span class="comment">// remove the first point</span></span><br><span class="line">builderEx.RemovePoint(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// modify the coordinates of the last point</span></span><br><span class="line"><span class="keyword">var</span> ptEx = builderEx.GetPoint(builderEx.PointCount - <span class="number">1</span>);</span><br><span class="line">builderEx.RemovePoint(builderEx.PointCount - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newPtEx = MapPointBuilderEx.CreateMapPoint(ptEx.X + <span class="number">1.0</span>, ptEx.Y + <span class="number">2.0</span>);</span><br><span class="line">builderEx.AddPoint(newPtEx);</span><br><span class="line">Multipoint modifiedMultiPointEx = builderEx.ToGeometry() <span class="keyword">as</span> Multipoint;</span><br></pre></td></tr></table></figure>

<h3 id="从多点检索点、2D-坐标、3D-坐标"><a href="#从多点检索点、2D-坐标、3D-坐标" class="headerlink" title="从多点检索点、2D 坐标、3D 坐标"></a>从多点检索点、2D 坐标、3D 坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReadOnlyPointCollection points = multipoint.Points;</span><br><span class="line">IReadOnlyList&lt;Coordinate2D&gt; coords2d = multipoint.Copy2DCoordinatesToList();</span><br><span class="line">IReadOnlyList&lt;Coordinate3D&gt; coords3d = multipoint.Copy3DCoordinatesToList();</span><br></pre></td></tr></table></figure>

<h2 id="线段"><a href="#线段" class="headerlink" title="线段"></a>线段</h2><h3 id="使用两个地图点构造线段"><a href="#使用两个地图点构造线段" class="headerlink" title="使用两个地图点构造线段"></a>使用两个地图点构造线段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">LineSegment lineFromMapPoint = LineBuilderEx.CreateLineSegment(startPt, endPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinate2D</span></span><br><span class="line">Coordinate2D start2d = (Coordinate2D)startPt;</span><br><span class="line">Coordinate2D end2d = (Coordinate2D)endPt;</span><br><span class="line"></span><br><span class="line">LineSegment lineFromCoordinate2D = LineBuilderEx.CreateLineSegment(start2d, end2d);</span><br><span class="line"></span><br><span class="line"><span class="comment">// coordinate3D</span></span><br><span class="line">Coordinate3D start3d = (Coordinate3D)startPt;</span><br><span class="line">Coordinate3D end3d = (Coordinate3D)endPt;</span><br><span class="line"></span><br><span class="line">LineSegment lineFromCoordinate3D = LineBuilderEx.CreateLineSegment(start3d, end3d);</span><br><span class="line"></span><br><span class="line"><span class="comment">// lineSegment</span></span><br><span class="line">LineSegment anotherLineFromLineSegment = LineBuilderEx.CreateLineSegment(lineFromCoordinate3D);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors don&#x27;t need to run on the MCT</span></span><br><span class="line">LineBuilderEx lbEx = <span class="keyword">new</span> LineBuilderEx(startPt, endPt);</span><br><span class="line">lineFromMapPoint = lbEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br><span class="line"></span><br><span class="line">lbEx = <span class="keyword">new</span> LineBuilderEx(start2d, end2d);</span><br><span class="line">lineFromCoordinate2D = lbEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br><span class="line"></span><br><span class="line">lbEx = <span class="keyword">new</span> LineBuilderEx(start3d, end3d);</span><br><span class="line">lineFromCoordinate3D = lbEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br><span class="line"></span><br><span class="line">lbEx = <span class="keyword">new</span> LineBuilderEx(startPt, endPt);</span><br><span class="line">lineFromMapPoint = lbEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br><span class="line"></span><br><span class="line">lbEx = <span class="keyword">new</span> LineBuilderEx(lineFromCoordinate3D);</span><br><span class="line">anotherLineFromLineSegment = lbEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br></pre></td></tr></table></figure>

<h3 id="更改线段坐标"><a href="#更改线段坐标" class="headerlink" title="更改线段坐标"></a>更改线段坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// builderEx constructors don&#x27;t need to run on the MCT</span></span><br><span class="line">LineBuilderEx lbuilderEx = <span class="keyword">new</span> LineBuilderEx(lineSegment);</span><br><span class="line"><span class="comment">// find the existing coordinates</span></span><br><span class="line">lbuilderEx.QueryCoords(<span class="keyword">out</span> startPt, <span class="keyword">out</span> endPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use </span></span><br><span class="line"><span class="comment">//startPt = lbuilderEx.StartPoint;</span></span><br><span class="line"><span class="comment">//endPt = lbuilderEx.EndPoint;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// update the coordinates</span></span><br><span class="line">lbuilderEx.SetCoords(GeometryEngine.Instance.Move(startPt, <span class="number">10</span>, <span class="number">10</span>) <span class="keyword">as</span> MapPoint, GeometryEngine.Instance.Move(endPt, <span class="number">-10</span>, <span class="number">-10</span>) <span class="keyword">as</span> MapPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use </span></span><br><span class="line"><span class="comment">//lbuilderEx.StartPoint = GeometryEngine.Instance.Move(startPt, 10, 10) as MapPoint;</span></span><br><span class="line"><span class="comment">//lbuilderEx.EndPoint = GeometryEngine.Instance.Move(endPt, -10, -10) as MapPoint;</span></span><br><span class="line"></span><br><span class="line">LineSegment segment2 = lbuilderEx.ToSegment() <span class="keyword">as</span> LineSegment;</span><br></pre></td></tr></table></figure>

<h2 id="立方贝塞尔"><a href="#立方贝塞尔" class="headerlink" title="立方贝塞尔"></a>立方贝塞尔</h2><h3 id="构建三次方贝塞尔-从坐标"><a href="#构建三次方贝塞尔-从坐标" class="headerlink" title="构建三次方贝塞尔 - 从坐标"></a>构建三次方贝塞尔 - 从坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">Coordinate2D ctrl1Pt = <span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">2.0</span>);</span><br><span class="line">Coordinate2D ctrl2Pt = <span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT</span></span><br><span class="line">CubicBezierSegment bezier = CubicBezierBuilderEx.CreateCubicBezierSegment(startPt, ctrl1Pt, ctrl2Pt, endPt, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// without a SR</span></span><br><span class="line">bezier = CubicBezierBuilderEx.CreateCubicBezierSegment(startPt, ctrl1Pt, ctrl2Pt, endPt);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors dont need to run on the MCT</span></span><br><span class="line">CubicBezierBuilderEx cbbEx = <span class="keyword">new</span> CubicBezierBuilderEx(startPt, ctrl1Pt, ctrl2Pt, endPt);</span><br><span class="line">bezier = cbbEx.ToSegment() <span class="keyword">as</span> CubicBezierSegment;</span><br><span class="line"></span><br><span class="line"><span class="comment">// another alternative</span></span><br><span class="line">cbbEx = <span class="keyword">new</span> CubicBezierBuilderEx(startPt, ctrl1Pt.ToMapPoint(), ctrl2Pt.ToMapPoint(), endPt);</span><br><span class="line">bezier = cbbEx.ToSegment() <span class="keyword">as</span> CubicBezierSegment;</span><br></pre></td></tr></table></figure>

<h3 id="构建立方贝塞尔-从地图点"><a href="#构建立方贝塞尔-从地图点" class="headerlink" title="构建立方贝塞尔 - 从地图点"></a>构建立方贝塞尔 - 从地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builderEx convenience method or a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">MapPoint ctrl1Pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint ctrl2Pt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT</span></span><br><span class="line">CubicBezierSegment bezier = CubicBezierBuilderEx.CreateCubicBezierSegment(startPt, ctrl1Pt, ctrl2Pt, endPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors dont need to run on the MCT</span></span><br><span class="line">CubicBezierBuilderEx cbbEx = <span class="keyword">new</span> CubicBezierBuilderEx(startPt, ctrl1Pt, ctrl2Pt, endPt);</span><br><span class="line">bezier = cbbEx.ToSegment() <span class="keyword">as</span> CubicBezierSegment;</span><br></pre></td></tr></table></figure>

<h3 id="构造三次贝塞尔-从映射点的枚举"><a href="#构造三次贝塞尔-从映射点的枚举" class="headerlink" title="构造三次贝塞尔 - 从映射点的枚举"></a>构造三次贝塞尔 - 从映射点的枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a buildeExr convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">MapPoint ctrl1Pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint ctrl2Pt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; listMapPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">listMapPoints.Add(startPt);</span><br><span class="line">listMapPoints.Add(ctrl1Pt);</span><br><span class="line">listMapPoints.Add(ctrl2Pt);</span><br><span class="line">listMapPoints.Add(endPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT</span></span><br><span class="line">CubicBezierSegment bezier = CubicBezierBuilderEx.CreateCubicBezierSegment(listMapPoints);</span><br><span class="line"></span><br><span class="line"><span class="comment">// builderEx constructors dont need to run on the MCT</span></span><br><span class="line">CubicBezierBuilderEx cbbEx = <span class="keyword">new</span> CubicBezierBuilderEx(listMapPoints);</span><br><span class="line">bezier = cbbEx.ToSegment() <span class="keyword">as</span> CubicBezierSegment;</span><br></pre></td></tr></table></figure>

<h3 id="立方贝塞尔生成器属性"><a href="#立方贝塞尔生成器属性" class="headerlink" title="立方贝塞尔生成器属性"></a>立方贝塞尔生成器属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the bezier curve&#x27;s control points</span></span><br><span class="line"></span><br><span class="line">CubicBezierBuilderEx cbbEx = <span class="keyword">new</span> CubicBezierBuilderEx(bezierSegment);</span><br><span class="line">MapPoint startPtEx = cbbEx.StartPoint;</span><br><span class="line">Coordinate2D ctrlPt1Ex = cbbEx.ControlPoint1;</span><br><span class="line">Coordinate2D ctrlPt2Ex = cbbEx.ControlPoint2;</span><br><span class="line">MapPoint endPtEx = cbbEx.EndPoint;</span><br><span class="line">     </span><br><span class="line"><span class="comment">// or use the QueryCoords method</span></span><br><span class="line">cbbEx.QueryCoords(<span class="keyword">out</span> startPtEx, <span class="keyword">out</span> ctrlPt1Ex, <span class="keyword">out</span> ctrlPt2Ex, <span class="keyword">out</span> endPtEx);</span><br></pre></td></tr></table></figure>

<h3 id="立方贝塞尔属性"><a href="#立方贝塞尔属性" class="headerlink" title="立方贝塞尔属性"></a>立方贝塞尔属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the bezier curve&#x27;s control points</span></span><br><span class="line">CubicBezierSegment cb = CubicBezierBuilderEx.CreateCubicBezierSegment(bezierSegment);</span><br><span class="line">MapPoint startPt = cb.StartPoint;</span><br><span class="line">Coordinate2D ctrlPt1 = cb.ControlPoint1;</span><br><span class="line">Coordinate2D ctrlPt2 = cb.ControlPoint2;</span><br><span class="line">MapPoint endPt = cb.EndPoint;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isCurve = cb.IsCurve;</span><br><span class="line"><span class="built_in">double</span> len = cb.Length;</span><br></pre></td></tr></table></figure>

<h3 id="构造折线-从三次贝塞尔"><a href="#构造折线-从三次贝塞尔" class="headerlink" title="构造折线 - 从三次贝塞尔"></a>构造折线 - 从三次贝塞尔</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(bezierSegment);</span><br></pre></td></tr></table></figure>

<h2 id="弧"><a href="#弧" class="headerlink" title="弧"></a>弧</h2><h3 id="构造圆弧-使用内部点"><a href="#构造圆弧-使用内部点" class="headerlink" title="构造圆弧 - 使用内部点"></a>构造圆弧 - 使用内部点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a circular arc from (2, 1) to (1, 2) with interior pt (1 + sqrt(2)/2, 1 + sqrt(2)/2).</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint fromPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint toPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Coordinate2D interiorPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>, <span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromPt, toPt, interiorPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors dont need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx eab = <span class="keyword">new</span> EllipticArcBuilderEx(fromPt, toPt, interiorPt);</span><br><span class="line"><span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">EllipticArcSegment anotherCircularArc = eab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造圆弧-使用弦长度和方位"><a href="#构造圆弧-使用弦长度和方位" class="headerlink" title="构造圆弧 - 使用弦长度和方位"></a>构造圆弧 - 使用弦长度和方位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a circular arc counterclockwise from (2, 1) to (1, 2) such that the embedded </span></span><br><span class="line"><span class="comment">// circle has center point at (1, 1) and radius = 1.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint fromPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line"><span class="built_in">double</span> chordLength = Math.Sqrt(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">double</span> chordBearing = <span class="number">3</span> * Math.PI / <span class="number">4</span>;</span><br><span class="line"><span class="built_in">double</span> radius = <span class="number">1</span>;</span><br><span class="line">ArcOrientation orientation = ArcOrientation.ArcCounterClockwise;</span><br><span class="line">MinorOrMajor minorOrMajor = MinorOrMajor.Minor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuildeExr convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromPt, chordLength, chordBearing, radius, orientation, minorOrMajor);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(fromPt, chordLength, chordBearing, radius, orientation, minorOrMajor);</span><br><span class="line"><span class="comment">// do something with the builder</span></span><br><span class="line"></span><br><span class="line">EllipticArcSegment anotherCircularArc = cab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构建圆弧-使用中心点、角度和半径"><a href="#构建圆弧-使用中心点、角度和半径" class="headerlink" title="构建圆弧 - 使用中心点、角度和半径"></a>构建圆弧 - 使用中心点、角度和半径</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a circular arc with center point at (0, 0), from angle = 0, </span></span><br><span class="line"><span class="comment">// central angle = pi/2, radius = 1.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">SpatialReference sr4326 = SpatialReferences.WGS84;</span><br><span class="line">Coordinate2D centerPt = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">double</span> fromAngle = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">double</span> centralAngle = Math.PI / <span class="number">2</span>;</span><br><span class="line"><span class="built_in">double</span> radius = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromAngle, centralAngle, centerPt, radius, sr4326);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors dont need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(fromAngle, centralAngle, centerPt, radius, sr4326);</span><br><span class="line">EllipticArcSegment otherCircularArc = cab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造椭圆弧-使用中心点和旋转角度"><a href="#构造椭圆弧-使用中心点和旋转角度" class="headerlink" title="构造椭圆弧 - 使用中心点和旋转角度"></a>构造椭圆弧 - 使用中心点和旋转角度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct an elliptic arc centered at (1,1), startAngle = 0, centralAngle = PI/2, </span></span><br><span class="line"><span class="comment">// rotationAngle = 0, semiMajorAxis = 1, minorMajorRatio = 0.5.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">Coordinate2D centerPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateEllipticArcSegment(centerPt, <span class="number">0</span>, Math.PI / <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> semiMajor;</span><br><span class="line"><span class="built_in">double</span> semiMinor;</span><br><span class="line">circularArc.GetAxes(<span class="keyword">out</span> semiMajor, <span class="keyword">out</span> semiMinor);</span><br><span class="line"><span class="comment">// semiMajor = 1, semiMinor = 0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors dont need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(centerPt, <span class="number">0</span>, Math.PI / <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.5</span>);</span><br><span class="line">cab.GetAxes(<span class="keyword">out</span> semiMajor, <span class="keyword">out</span> semiMinor);</span><br><span class="line">EllipticArcSegment otherCircularArc = cab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造圆弧-使用中心点和方向"><a href="#构造圆弧-使用中心点和方向" class="headerlink" title="构造圆弧 - 使用中心点和方向"></a>构造圆弧 - 使用中心点和方向</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a circular arc from (2, 1) to (1, 2) </span></span><br><span class="line"><span class="comment">// with center point at (1, 1) and orientation counterclockwise.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint toPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">MapPoint fromPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D centerPtCoord = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromPt, toPt, centerPtCoord, ArcOrientation.ArcCounterClockwise);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(fromPt, toPt, centerPtCoord, ArcOrientation.ArcCounterClockwise);</span><br><span class="line">EllipticArcSegment otherCircularArc = cab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造圆弧-使用两个线段和半径"><a href="#构造圆弧-使用两个线段和半径" class="headerlink" title="构造圆弧 - 使用两个线段和半径"></a>构造圆弧 - 使用两个线段和半径</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a segment from (100, 100) to (50, 50) and another segment from (100, 100) to (150, 50).</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">LineSegment segment1 = LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">100</span>, <span class="number">100</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">50</span>, <span class="number">50</span>));</span><br><span class="line">LineSegment segment2 = LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">100</span>, <span class="number">100</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">150</span>, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Construct the hint point to determine where the arc will be constructed.</span></span><br><span class="line">Coordinate2D hintPoint = <span class="keyword">new</span> Coordinate2D(<span class="number">100</span>, <span class="number">75</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call QueryFilletRadius to get the minimum and maximum radii that can be used with these segments.</span></span><br><span class="line"><span class="keyword">var</span> minMaxRadii = EllipticArcBuilderEx.QueryFilletRadiusRange(segment1, segment2, hintPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use the maximum radius to create the arc.</span></span><br><span class="line"><span class="built_in">double</span> maxRadius = minMaxRadii.Item2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line"><span class="comment">//At 2.x - EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateEllipticArcSegment(segment1, segment2, maxRadius, hintPoint);</span></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(</span><br><span class="line">                    segment1, segment2, maxRadius, hintPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(segment1, segment2, maxRadius, hintPoint);</span><br><span class="line">EllipticArcSegment otherCircularArc = cab.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造一个圆"><a href="#构造一个圆" class="headerlink" title="构造一个圆"></a>构造一个圆</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a circle with center at (-1,-1), radius = 2, and oriented clockwise.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">Coordinate2D centerPtCoord = <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment circle = EllipticArcBuilderEx.CreateCircle(centerPtCoord, <span class="number">2</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="comment">// circle.IsCircular = true</span></span><br><span class="line"><span class="comment">// circle.IsCounterClockwise = false</span></span><br><span class="line"><span class="comment">// circle.IsMinor = false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> startAngle, rotationAngle, centralAngle, semiMajor, semiMinor;</span><br><span class="line">Coordinate2D actualCenterPt;</span><br><span class="line">circle.QueryCoords(<span class="keyword">out</span> actualCenterPt, <span class="keyword">out</span> startAngle, <span class="keyword">out</span> centralAngle, <span class="keyword">out</span> rotationAngle, <span class="keyword">out</span> semiMajor, <span class="keyword">out</span> semiMinor);</span><br><span class="line"></span><br><span class="line"><span class="comment">// semiMajor = 2.0</span></span><br><span class="line"><span class="comment">// semiMinor = 2.0</span></span><br><span class="line"><span class="comment">// startAngle = PI/2</span></span><br><span class="line"><span class="comment">// centralAngle = -2*PI</span></span><br><span class="line"><span class="comment">// rotationAngle = 0</span></span><br><span class="line"><span class="comment">// endAngle = PI/2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx builder = <span class="keyword">new</span> EllipticArcBuilderEx(centerPtCoord, <span class="number">2</span>, ArcOrientation.ArcClockwise);</span><br><span class="line">EllipticArcSegment otherCircle = builder.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="构造椭圆"><a href="#构造椭圆" class="headerlink" title="构造椭圆"></a>构造椭圆</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct an ellipse centered at (1, 2) with rotationAngle = -pi/6,  </span></span><br><span class="line"><span class="comment">// semiMajorAxis = 5, minorMajorRatio = 0.2, oriented clockwise.</span></span><br><span class="line"><span class="comment">// Use a builderEx convenience method or use a builderEx constructor.</span></span><br><span class="line"></span><br><span class="line">Coordinate2D centerPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line">EllipticArcSegment ellipse = EllipticArcBuilderEx.CreateEllipse(centerPt, <span class="number">-1</span> * Math.PI / <span class="number">6</span>, <span class="number">5</span>, <span class="number">0.2</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BuilderEx constructors need to run on the MCT.</span></span><br><span class="line">EllipticArcBuilderEx builder = <span class="keyword">new</span> EllipticArcBuilderEx(centerPt, <span class="number">-1</span> * Math.PI / <span class="number">6</span>, <span class="number">5</span>, <span class="number">0.2</span>, ArcOrientation.ArcClockwise);</span><br><span class="line">EllipticArcSegment anotherEllipse = builder.ToSegment();</span><br></pre></td></tr></table></figure>

<h3 id="Elliptic-Arc-Builder-Properties"><a href="#Elliptic-Arc-Builder-Properties" class="headerlink" title="Elliptic Arc Builder Properties"></a>Elliptic Arc Builder Properties</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the curve&#x27;s properties</span></span><br><span class="line">EllipticArcBuilderEx builder = <span class="keyword">new</span> EllipticArcBuilderEx(arcSegment);</span><br><span class="line">MapPoint startPt = builder.StartPoint;</span><br><span class="line">MapPoint endPt = builder.EndPoint;</span><br><span class="line">Coordinate2D centerPt = builder.CenterPoint;</span><br><span class="line"><span class="built_in">bool</span> isCircular = builder.IsCircular;</span><br><span class="line"><span class="built_in">bool</span> isMinor = builder.IsMinor;</span><br><span class="line"><span class="built_in">double</span> startAngle = builder.StartAngle;</span><br><span class="line"><span class="built_in">double</span> endAngle = builder.EndAngle;</span><br><span class="line"><span class="built_in">double</span> centralAngle = builder.CentralAngle;</span><br><span class="line"><span class="built_in">double</span> rotationAngle = builder.RotationAngle;</span><br><span class="line">ArcOrientation orientation = builder.Orientation;</span><br></pre></td></tr></table></figure>

<h3 id="椭圆弧属性"><a href="#椭圆弧属性" class="headerlink" title="椭圆弧属性"></a>椭圆弧属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the curve&#x27;s control points</span></span><br><span class="line">EllipticArcSegment arc = EllipticArcBuilderEx.CreateEllipticArcSegment(arcSegment);</span><br><span class="line">MapPoint startPt = arc.StartPoint;</span><br><span class="line">MapPoint endPt = arc.EndPoint;</span><br><span class="line">Coordinate2D centerPt = arc.CenterPoint;</span><br><span class="line"><span class="built_in">bool</span> isCircular = arc.IsCircular;</span><br><span class="line"><span class="built_in">bool</span> isMinor = arc.IsMinor;</span><br><span class="line"><span class="built_in">bool</span> isCounterClockwise = arc.IsCounterClockwise;</span><br><span class="line"><span class="built_in">bool</span> isCurve = arc.IsCurve;</span><br><span class="line"><span class="built_in">double</span> len = arc.Length;</span><br><span class="line"><span class="built_in">double</span> ratio = arc.MinorMajorRatio;</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> semiMajorAxis, semiMinorAxis;</span><br><span class="line"><span class="comment">// get the axes</span></span><br><span class="line">arc.GetAxes(<span class="keyword">out</span> semiMajorAxis, <span class="keyword">out</span> semiMinorAxis);</span><br><span class="line"><span class="comment">// or use the properties</span></span><br><span class="line"><span class="comment">// semiMajorAxis = arc.SemiMajorAxis;</span></span><br><span class="line"><span class="comment">// semiMinorAxis = arc.SemiMinorAxis;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> startAngle, centralAngle, rotationAngle;</span><br><span class="line"><span class="comment">// or use QueryCoords to get complete information</span></span><br><span class="line">arc.QueryCoords(<span class="keyword">out</span> centerPt, <span class="keyword">out</span> startAngle, <span class="keyword">out</span> centralAngle, <span class="keyword">out</span> rotationAngle, <span class="keyword">out</span> semiMajorAxis, <span class="keyword">out</span> semiMinorAxis);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use properties to get angle information</span></span><br><span class="line"><span class="comment">//double endAngle = arc.EndAngle;</span></span><br><span class="line"><span class="comment">//centralAngle = arc.CentralAngle;</span></span><br><span class="line"><span class="comment">//rotationAngle = arc.RotationAngle;</span></span><br><span class="line"><span class="comment">//startAngle = arc.StartAngle;</span></span><br></pre></td></tr></table></figure>

<h2 id="几何袋"><a href="#几何袋" class="headerlink" title="几何袋"></a>几何袋</h2><h3 id="构造几何包"><a href="#构造几何包" class="headerlink" title="构造几何包"></a>构造几何包</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; coords2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(coords2D, SpatialReferences.WGS84);</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords2D, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line">GeometryBagBuilderEx builder = <span class="keyword">new</span> GeometryBagBuilderEx(SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">GeometryBag emptyBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// emptyBag.IsEmpty = true</span></span><br><span class="line"></span><br><span class="line">builder.AddGeometry(point);</span><br><span class="line"><span class="comment">// builder.GeometryCount = 1</span></span><br><span class="line"></span><br><span class="line">GeometryBag geometryBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// geometryBag.PartCount = 1</span></span><br><span class="line"><span class="comment">// geometryBag.PointCount = 1</span></span><br><span class="line"><span class="comment">// geometryBag.IsEmpty = false</span></span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;Geometry&gt; geometries = geometryBag.Geometries;</span><br><span class="line"><span class="comment">// geometries.Count = 1</span></span><br><span class="line"><span class="comment">// geometries[0] is MapPoint with a sr of WGS84</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> isEqual = geometryBag.IsEqual(emptyBag);   <span class="comment">// isEqual = false</span></span><br><span class="line"></span><br><span class="line">builder.InsertGeometry(<span class="number">0</span>, multipoint);</span><br><span class="line">geometryBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// geometryBag.PartCount = 2</span></span><br><span class="line"></span><br><span class="line">geometries = geometryBag.Geometries;</span><br><span class="line"><span class="comment">// geometries.Count = 2</span></span><br><span class="line"><span class="comment">// geometries[0] is Multipoint</span></span><br><span class="line"><span class="comment">// geometries[1] is MapPoint</span></span><br><span class="line"></span><br><span class="line">builder.AddGeometry(polyline);</span><br><span class="line">builder.RemoveGeometry(<span class="number">1</span>);</span><br><span class="line">geometryBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// geometryBag.PartCount = 2</span></span><br><span class="line"></span><br><span class="line">geometries = geometryBag.Geometries;</span><br><span class="line"><span class="comment">// geometries.Count = 2</span></span><br><span class="line"><span class="comment">// geometries[0] is Multipoint</span></span><br><span class="line"><span class="comment">// geometries[1] is Polyline          </span></span><br></pre></td></tr></table></figure>

<h3 id="构造几何包-从几何枚举"><a href="#构造几何包-从几何枚举" class="headerlink" title="构造几何包 - 从几何枚举"></a>构造几何包 - 从几何枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a builder convenience method or use a builder constructor.</span></span><br><span class="line"></span><br><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;() &#123; <span class="keyword">new</span> Coordinate2D(<span class="number">50</span>, <span class="number">60</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">-120</span>, <span class="number">-70</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">40</span>, <span class="number">60</span>) &#125;;</span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(coords, SpatialReferences.WebMercator);</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;rings\&quot;:[[[0,0],[0,1],[1,1],[1,0],[0,0]],[[3,0],[3,1],[4,1],[4,0],[3,0]]]&#125;&quot;</span>;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> geometries = <span class="keyword">new</span> List&lt;Geometry&gt;() &#123; point, multipoint, polyline, polygon &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder convenience methods don&#x27;t need to run on the MCT.</span></span><br><span class="line"><span class="comment">//At 2.x - GeometryBag bag = GeometryBagBuilder.CreateGeometryBag(geometries, SpatialReferences.WGS84);</span></span><br><span class="line"><span class="keyword">var</span> bag = GeometryBagBuilderEx.CreateGeometryBag(geometries, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - using (var builder = new GeometryBagBuilder(geometries, SpatialReferences.WGS84)) </span></span><br><span class="line"><span class="keyword">var</span> builder = <span class="keyword">new</span> GeometryBagBuilderEx(geometries, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">// do something with the builder</span></span><br><span class="line">bag = builder.ToGeometry();</span><br></pre></td></tr></table></figure>

<h3 id="ConstructingGeometryBag-来自-JSON、Xml"><a href="#ConstructingGeometryBag-来自-JSON、Xml" class="headerlink" title="ConstructingGeometryBag - 来自 JSON、Xml"></a>ConstructingGeometryBag - 来自 JSON、Xml</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> jsonString = <span class="string">&quot;&#123;\&quot;geometries\&quot;:[&#123;\&quot;x\&quot;:1,\&quot;y\&quot;:2&#125;,&#123;\&quot;rings\&quot;:[[[0,0],[0,4],[3,4],[3,0],[0,0]]]&#125;],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326,\&quot;latestWkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//At 2.x - GeometryBag geometryBag = GeometryBagBuilder.FromJson(jsonString);</span></span><br><span class="line"><span class="keyword">var</span> geometryBag = GeometryBagBuilderEx.FromJson(jsonString);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> xml = geometryBag.ToXml();</span><br><span class="line"><span class="comment">//At 2.x - GeometryBag xmlString = GeometryBagBuilder.FromXML(xml);</span></span><br><span class="line"><span class="keyword">var</span> xmlString = GeometryBagBuilderEx.FromXml(xml);</span><br></pre></td></tr></table></figure>

<h3 id="构造几何包-添加或插入几何枚举"><a href="#构造几何包-添加或插入几何枚举" class="headerlink" title="构造几何包 - 添加或插入几何枚举"></a>构造几何包 - 添加或插入几何枚举</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;() &#123; <span class="keyword">new</span> Coordinate2D(<span class="number">50</span>, <span class="number">60</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">-120</span>, <span class="number">-70</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">40</span>, <span class="number">60</span>) &#125;;</span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(coords, SpatialReferences.WebMercator);</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;rings\&quot;:[[[0,0],[0,1],[1,1],[1,0],[0,0]],[[3,0],[3,1],[4,1],[4,0],[3,0]]]&#125;&quot;</span>;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> geometries = <span class="keyword">new</span> List&lt;Geometry&gt;() &#123; point, multipoint, polyline, polygon &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - using (var builder = new GeometryBagBuilder(SpatialReferences.WGS84))</span></span><br><span class="line"><span class="keyword">var</span> builder = <span class="keyword">new</span> GeometryBagBuilderEx(SpatialReferences.WGS84);</span><br><span class="line">builder.AddGeometries(geometries);</span><br><span class="line"></span><br><span class="line">GeometryBag geomBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// geomBag.PartCount == 4    (point, multipoint, polyline, polygon)</span></span><br><span class="line"></span><br><span class="line">geometries = <span class="keyword">new</span> List&lt;Geometry&gt;() &#123; point, polyline &#125;;</span><br><span class="line">builder.InsertGeometries(<span class="number">1</span>, geometries);</span><br><span class="line"><span class="comment">// builder.GeometryCount == 6</span></span><br><span class="line">geomBag = builder.ToGeometry();</span><br><span class="line"><span class="comment">// geomBag.PartCount == 6    (point, point, polyline, multipoint, polyline, polygon)</span></span><br></pre></td></tr></table></figure>

<h2 id="多面体"><a href="#多面体" class="headerlink" title="多面体"></a>多面体</h2><h3 id="通过拉伸多边形或折线构建多面体"><a href="#通过拉伸多边形或折线构建多面体" class="headerlink" title="通过拉伸多边形或折线构建多面体"></a>通过拉伸多边形或折线构建多面体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build a polygon</span></span><br><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasZ\&quot;:true,\&quot;rings\&quot;:[[[0,0,0],[0,1,0],[1,1,0],[1,0,0],[0,0,0]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extrude the polygon by an offset to create a multipatch</span></span><br><span class="line">Multipatch multipatch = GeometryEngine.Instance.ConstructMultipatchExtrude(polygon, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// a different polygon</span></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasZ\&quot;:true,\&quot;rings\&quot;:[[[0,0,1],[0,1,2],[1,1,3],[1,0,4],[0,0,1]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extrude between z values to create a multipatch</span></span><br><span class="line">multipatch = GeometryEngine.Instance.ConstructMultipatchExtrudeFromToZ(polygon, <span class="number">-10</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extrude along the axis defined by the coordinate to create a multipatch</span></span><br><span class="line">Coordinate3D coord = <span class="keyword">new</span> Coordinate3D(<span class="number">10</span>, <span class="number">18</span>, <span class="number">-10</span>);</span><br><span class="line">multipatch = GeometryEngine.Instance.ConstructMultipatchExtrudeAlongVector3D(polygon, coord);</span><br><span class="line"></span><br><span class="line"><span class="comment">// build a polyline</span></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasZ\&quot;:true,\&quot;paths\&quot;:[[[400,800,1000],[800,1400,1500],[1200,800,2000],[1800,1800,2500],[2200,800,3000]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extrude to a specific z value to create a multipatch</span></span><br><span class="line">multipatch = GeometryEngine.Instance.ConstructMultipatchExtrudeToZ(polyline, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">Coordinate3D fromCoord = <span class="keyword">new</span> Coordinate3D(<span class="number">50</span>, <span class="number">50</span>, <span class="number">-500</span>);</span><br><span class="line">Coordinate3D toCoord = <span class="keyword">new</span> Coordinate3D(<span class="number">200</span>, <span class="number">50</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extrude between two coordinates to create a multipatch</span></span><br><span class="line">multipatch = GeometryEngine.Instance.ConstructMultipatchExtrudeAlongLine(polyline, fromCoord, toCoord);</span><br></pre></td></tr></table></figure>

<h3 id="多面体属性"><a href="#多面体属性" class="headerlink" title="多面体属性"></a>多面体属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// standard geometry properties</span></span><br><span class="line"><span class="built_in">bool</span> hasZ = multipatch.HasZ;</span><br><span class="line"><span class="built_in">bool</span> hasM = multipatch.HasM;</span><br><span class="line"><span class="built_in">bool</span> hasID = multipatch.HasID;</span><br><span class="line"><span class="built_in">bool</span> isEmpty = multipatch.IsEmpty;</span><br><span class="line"><span class="keyword">var</span> sr = multipatch.SpatialReference;</span><br><span class="line"></span><br><span class="line"><span class="comment">// number of patches (parts)</span></span><br><span class="line"><span class="built_in">int</span> patchCount = multiPatch.PartCount;</span><br><span class="line"><span class="comment">// number of points</span></span><br><span class="line"><span class="built_in">int</span> pointCount = multiPatch.PointCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve the points as MapPoints</span></span><br><span class="line">ReadOnlyPointCollection points = multipatch.Points;</span><br><span class="line"><span class="comment">// or as 3D Coordinates</span></span><br><span class="line">IReadOnlyList&lt;Coordinate3D&gt; coordinates = multipatch.Copy3DCoordinatesToList();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// multipatch materials</span></span><br><span class="line"><span class="built_in">bool</span> hasMaterials = multiPatch.HasMaterials;</span><br><span class="line"><span class="built_in">int</span> materialCount = multiPatch.MaterialCount;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// multipatch textures</span></span><br><span class="line"><span class="built_in">bool</span> hasTextures = multiPatch.HasTextures;</span><br><span class="line"><span class="built_in">int</span> textureVertexCount = multiPatch.TextureVertexCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// normals</span></span><br><span class="line"><span class="built_in">bool</span> hasNormals = multiPatch.HasNormals;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// properties for an individual patch (if multipatch.PartCount &gt; 0)</span></span><br><span class="line"><span class="built_in">int</span> patchPriority = multiPatch.GetPatchPriority(patchIndex);</span><br><span class="line">PatchType patchType = multiPatch.GetPatchType(patchIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// patch points</span></span><br><span class="line"><span class="built_in">int</span> patchPointCount = multiPatch.GetPatchPointCount(patchIndex);</span><br><span class="line"><span class="built_in">int</span> pointStartIndex = multiPatch.GetPatchStartPointIndex(patchIndex);</span><br><span class="line"><span class="comment">// the patch Points are then the points in multipatch.Points from pointStartIndex to pointStartIndex + patchPointCount </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// if the multipatch has materials </span></span><br><span class="line"><span class="keyword">if</span> (hasMaterials)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// does the patch have a material?  </span></span><br><span class="line">  <span class="comment">//   materialIndex = -1 if the patch does not have a material; </span></span><br><span class="line">  <span class="comment">//   0 &lt;= materialIndex &lt; materialCount if the patch does have materials</span></span><br><span class="line">  <span class="built_in">int</span> materialIndex = multipatch.GetPatchMaterialIndex(patchIndex);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// properties for an individual material (if multipatch.MaterialCount &gt; 0)</span></span><br><span class="line">  <span class="keyword">var</span> color = multipatch.GetMaterialColor(materialIndex);</span><br><span class="line">  <span class="keyword">var</span> edgeColor = multipatch.GetMaterialEdgeColor(materialIndex);</span><br><span class="line">  <span class="keyword">var</span> edgeWidth = multipatch.GetMaterialEdgeWidth(materialIndex);</span><br><span class="line">  <span class="keyword">var</span> shiness = multipatch.GetMaterialShininess(materialIndex);</span><br><span class="line">  <span class="keyword">var</span> percent = multipatch.GetMaterialTransparencyPercent(materialIndex);</span><br><span class="line">  <span class="keyword">var</span> cullBackFace = multipatch.IsMaterialCullBackFace(materialIndex);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// texture properties</span></span><br><span class="line">  <span class="built_in">bool</span> isTextured = multipatch.IsMaterialTextured(materialIndex);</span><br><span class="line">  <span class="keyword">if</span> (isTextured)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">int</span> columnCount = multipatch.GetMaterialTextureColumnCount(materialIndex);</span><br><span class="line">    <span class="built_in">int</span> rowCount = multipatch.GetMaterialTextureRowCount(materialIndex);</span><br><span class="line">    <span class="built_in">int</span> bpp = multipatch.GetMaterialTextureBytesPerPixel(materialIndex);</span><br><span class="line">    TextureCompressionType compressionType = multipatch.GetMaterialTextureCompressionType(materialIndex);</span><br><span class="line">    <span class="keyword">var</span> texture = multipatch.GetMaterialTexture(materialIndex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// texture coordinates (if multipatch.HasTextures = true)</span></span><br><span class="line"><span class="keyword">if</span> (hasTextures)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> numPatchTexturePoints = multiPatch.GetPatchTextureVertexCount(patchIndex);</span><br><span class="line">  <span class="keyword">var</span> coordinate2D = multiPatch.GetPatchTextureCoordinate(patchIndex, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  ICollection&lt;Coordinate2D&gt; textureCoordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;(numPatchTexturePoints);</span><br><span class="line">  multiPatch.GetPatchTextureCoordinates(patchIndex, <span class="keyword">ref</span> textureCoordinates);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// patch normals (if multipatch.HasNormals = true)</span></span><br><span class="line"><span class="keyword">if</span> (hasNormals)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//  number of normal coordinates = multipatch.GetPatchPointCount(patchIndex)</span></span><br><span class="line">  Coordinate3D patchNormal = multipatch.GetPatchNormal(patchIndex, <span class="number">0</span>);</span><br><span class="line">  ICollection&lt;Coordinate3D&gt; normalCoordinates = <span class="keyword">new</span> List&lt;Coordinate3D&gt;(patchPointCount);</span><br><span class="line">  multipatch.GetPatchNormals(patchIndex, <span class="keyword">ref</span> normalCoordinates);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构建多面体"><a href="#构建多面体" class="headerlink" title="构建多面体"></a>构建多面体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// export to binary xml</span></span><br><span class="line"><span class="built_in">string</span> binaryXml = multiPatch.ToBinaryXml();</span><br><span class="line"></span><br><span class="line"><span class="comment">// import from binaryXML - methods need to run on the MCT</span></span><br><span class="line">Multipatch binaryMultipatch = MultipatchBuilderEx.FromBinaryXml(binaryXml);</span><br><span class="line"></span><br><span class="line"><span class="comment">// xml export / import</span></span><br><span class="line"><span class="built_in">string</span> xml = multiPatch.ToXml();</span><br><span class="line">Multipatch xmlMultipatch = MultipatchBuilderEx.FromXml(xml);</span><br><span class="line"></span><br><span class="line"><span class="comment">// esriShape export/import</span></span><br><span class="line"><span class="built_in">byte</span>[] buffer = multiPatch.ToEsriShape();</span><br><span class="line">Multipatch esriPatch = MultipatchBuilderEx.FromEsriShape(buffer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use GeometryEngine</span></span><br><span class="line">Multipatch patchImport = GeometryEngine.Instance.ImportFromEsriShape(EsriShapeImportFlags.EsriShapeImportDefaults, buffer, multiPatch.SpatialReference) <span class="keyword">as</span> Multipatch;</span><br></pre></td></tr></table></figure>

<h3 id="通过MultipatchBuilderEx构建多面体"><a href="#通过MultipatchBuilderEx构建多面体" class="headerlink" title="通过MultipatchBuilderEx构建多面体"></a>通过MultipatchBuilderEx构建多面体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> coords_face1 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902603910000039</span>,<span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902603910000039</span>,<span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902576344000067</span>,<span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902603910000039</span>,<span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902576344000067</span>,<span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>,<span class="number">41.902576344000067</span>,<span class="number">62.552700000000186</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coords_face2 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coords_face3 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coords_face4 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coords_face5 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">59.504700000004959</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coords_face6 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902603910000039</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495461061000071</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">12.495488442000067</span>, <span class="number">41.902576344000067</span>, <span class="number">62.552700000000186</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// materials</span></span><br><span class="line"><span class="keyword">var</span> materialRed = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">materialRed.Color = System.Windows.Media.Colors.Red;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> materialTransparent = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">materialTransparent.Color = System.Windows.Media.Colors.White;</span><br><span class="line">materialTransparent.TransparencyPercent = <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blueTransparent = <span class="keyword">new</span> BasicMaterial(materialTransparent);</span><br><span class="line">blueTransparent.Color = System.Windows.Media.Colors.SkyBlue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a list of patch objects</span></span><br><span class="line"><span class="keyword">var</span> patches = <span class="keyword">new</span> List&lt;Patch&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the multipatchBuilderEx object</span></span><br><span class="line"><span class="keyword">var</span> mpb = <span class="keyword">new</span> ArcGIS.Core.Geometry.MultipatchBuilderEx();</span><br><span class="line"></span><br><span class="line"><span class="comment">// make each patch using the appropriate coordinates and add to the patch list</span></span><br><span class="line"><span class="keyword">var</span> patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face1;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face2;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face3;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face4;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face5;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patch = mpb.MakePatch(PatchType.Triangles);</span><br><span class="line">patch.Coords = coords_face6;</span><br><span class="line">patches.Add(patch);</span><br><span class="line"></span><br><span class="line">patches[<span class="number">0</span>].Material = materialRed;</span><br><span class="line">patches[<span class="number">1</span>].Material = materialTransparent;</span><br><span class="line">patches[<span class="number">2</span>].Material = materialRed;</span><br><span class="line">patches[<span class="number">3</span>].Material = materialRed;</span><br><span class="line">patches[<span class="number">4</span>].Material = materialRed;</span><br><span class="line">patches[<span class="number">5</span>].Material = blueTransparent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign the patches to the multipatchBuilder</span></span><br><span class="line">mpb.Patches = patches;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check which patches currently contain the material</span></span><br><span class="line"><span class="keyword">var</span> red = mpb.QueryPatchIndicesWithMaterial(materialRed);</span><br><span class="line"><span class="comment">//   red should be [0, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// call ToGeometry to get the multipatch</span></span><br><span class="line">multipatch = mpb.ToGeometry() <span class="keyword">as</span> Multipatch;</span><br></pre></td></tr></table></figure>

<h3 id="从另一个多面体构建多面体"><a href="#从另一个多面体构建多面体" class="headerlink" title="从另一个多面体构建多面体"></a>从另一个多面体构建多面体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create the multipatchBuilderEx object</span></span><br><span class="line"><span class="keyword">var</span> builder = <span class="keyword">new</span> ArcGIS.Core.Geometry.MultipatchBuilderEx(multipatch);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check some properties</span></span><br><span class="line"><span class="built_in">bool</span> hasM = builder.HasM;</span><br><span class="line"><span class="built_in">bool</span> hasZ = builder.HasZ;</span><br><span class="line"><span class="built_in">bool</span> hasID = builder.HasID;</span><br><span class="line"><span class="built_in">bool</span> isEmpty = builder.IsEmpty;</span><br><span class="line"><span class="built_in">bool</span> hasNormals = builder.HasNormals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> patches = builder.Patches;</span><br><span class="line"><span class="built_in">int</span> patchCount = patches.Count;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if there&#x27;s some patches</span></span><br><span class="line"><span class="keyword">if</span> (patchCount &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> pointCount = builder.GetPatchPointCount(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// replace the first point in the first patch</span></span><br><span class="line">  <span class="keyword">if</span> (pointCount &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the first point</span></span><br><span class="line">    <span class="keyword">var</span> pt = builder.GetPoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    builder.SetPoint(<span class="number">0</span>, <span class="number">0</span>, newPoint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check which patches currently contain the texture</span></span><br><span class="line">  <span class="keyword">var</span> texture = builder.QueryPatchIndicesWithTexture(brickTextureResource);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assign a texture material</span></span><br><span class="line">  patches[<span class="number">0</span>].Material = brickMaterialTexture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// update the builder for M awareness</span></span><br><span class="line">builder.HasM = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// synchronize the patch attributes to match the builder attributes</span></span><br><span class="line"><span class="comment">//   in this instance because we just set HasM to true on the builder, each patch will now get a default M value for it&#x27;s set of coordinates</span></span><br><span class="line">builder.SynchronizeAttributeAwareness();</span><br><span class="line"></span><br><span class="line"><span class="comment">// call ToGeometry to get the multipatch</span></span><br><span class="line">multipatch = builder.ToGeometry() <span class="keyword">as</span> Multipatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// multipatch.HasM will be true</span></span><br></pre></td></tr></table></figure>

<h3 id="从-3D-模型文件构建多面体"><a href="#从-3D-模型文件构建多面体" class="headerlink" title="从 3D 模型文件构建多面体"></a>从 3D 模型文件构建多面体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> model = ArcGIS.Core.Geometry.MultipatchBuilderEx.From3DModelFile(<span class="string">@&quot;c:\Temp\My3dModelFile.dae&quot;</span>);</span><br><span class="line">  <span class="built_in">bool</span> modelIsEmpty = model.IsEmpty;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (FileNotFoundException)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// file not found</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ArgumentException)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// File extension is unsupported or cannot read the file</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构建-3D-特殊多面体形状"><a href="#构建-3D-特殊多面体形状" class="headerlink" title="构建 3D 特殊多面体形状"></a>构建 3D 特殊多面体形状</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sr = MapView.Active.Map.SpatialReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> center = extent.Center;</span><br><span class="line"><span class="keyword">var</span> centerZ = MapPointBuilderEx.CreateMapPoint(center.X, center.Y, <span class="number">500</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cube</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Cube, centerZ, <span class="number">200</span>, sr);</span><br><span class="line"><span class="comment">// tetrahedron</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Tetrahedron, centerZ, <span class="number">200</span>, sr);</span><br><span class="line"><span class="comment">// diamond</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Diamond, centerZ, <span class="number">200</span>, sr);</span><br><span class="line"><span class="comment">// hexagon</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Hexagon, centerZ, <span class="number">200</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sphere frame</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.SphereFrame, centerZ, <span class="number">200</span>, <span class="number">0.8</span>, sr);</span><br><span class="line"><span class="comment">// sphere</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Sphere, centerZ, <span class="number">200</span>, <span class="number">0.8</span>, sr);</span><br><span class="line"><span class="comment">// cylinder</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Cylinder, centerZ, <span class="number">200</span>, <span class="number">0.8</span>, sr);</span><br><span class="line"><span class="comment">// cone</span></span><br><span class="line">multipatch = ArcGIS.Core.Geometry.MultipatchBuilderEx.CreateMultipatch(MultipatchConstructType.Cone, centerZ, <span class="number">200</span>, <span class="number">0.8</span>, sr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the builder to add materials or textures</span></span><br><span class="line"><span class="comment">//   - create a cone with a material</span></span><br><span class="line">builder = <span class="keyword">new</span> MultipatchBuilderEx(MultipatchConstructType.Cone, centerZ, <span class="number">200</span>, <span class="number">0.8</span>, sr);</span><br><span class="line"></span><br><span class="line">BasicMaterial faceMaterial = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">faceMaterial.Color = System.Windows.Media.Color.FromRgb(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">faceMaterial.Shininess = <span class="number">150</span>;</span><br><span class="line">faceMaterial.TransparencyPercent = <span class="number">50</span>;</span><br><span class="line">faceMaterial.EdgeWidth = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> patch <span class="keyword">in</span> builder.Patches)</span><br><span class="line">  patch.Material = faceMaterial;</span><br><span class="line"></span><br><span class="line">multipatch = builder.ToGeometry() <span class="keyword">as</span> Multipatch;</span><br></pre></td></tr></table></figure>

<h3 id="创建基本材料"><a href="#创建基本材料" class="headerlink" title="创建基本材料"></a>创建基本材料</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create BasicMaterial with default values</span></span><br><span class="line">BasicMaterial material = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">System.Windows.Media.Color color = material.Color;         <span class="comment">// color = Colors.Black</span></span><br><span class="line">System.Windows.Media.Color edgeColor = material.EdgeColor; <span class="comment">// edgeColor = Colors.Black</span></span><br><span class="line"><span class="built_in">int</span> edgeWidth = material.EdgeWidth;                        <span class="comment">// edgeWidth = 0</span></span><br><span class="line"><span class="built_in">int</span> transparency = material.TransparencyPercent;           <span class="comment">// transparency = 0</span></span><br><span class="line"><span class="built_in">int</span> shininess = material.Shininess;                        <span class="comment">// shininess = 0</span></span><br><span class="line"><span class="built_in">bool</span> cullBackFace = material.IsCullBackFace;               <span class="comment">// cullBackFace = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Modify the properties</span></span><br><span class="line">material.Color = System.Windows.Media.Colors.Red;</span><br><span class="line">material.EdgeColor = System.Windows.Media.Colors.Blue;</span><br><span class="line">material.EdgeWidth = <span class="number">10</span>;</span><br><span class="line">material.TransparencyPercent = <span class="number">50</span>;</span><br><span class="line">material.Shininess = <span class="number">25</span>;</span><br><span class="line">material.IsCullBackFace = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用-JPEG-纹理创建基本材质"><a href="#使用-JPEG-纹理创建基本材质" class="headerlink" title="使用 JPEG 纹理创建基本材质"></a>使用 JPEG 纹理创建基本材质</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// read the jpeg into a buffer</span></span><br><span class="line"><span class="comment">//At 3.0 you need https://www.nuget.org/packages/Microsoft.Windows.Compatibility</span></span><br><span class="line"><span class="comment">//System.Drawing</span></span><br><span class="line">System.Drawing.Image image = System.Drawing.Image.FromFile(<span class="string">@&quot;C:\temp\myImageFile.jpg&quot;</span>);</span><br><span class="line">MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"></span><br><span class="line">System.Drawing.Imaging.ImageFormat format = System.Drawing.Imaging.ImageFormat.Jpeg;</span><br><span class="line">image.Save(memoryStream, format);</span><br><span class="line"><span class="built_in">byte</span>[] imageBuffer = memoryStream.ToArray();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jpgTexture = <span class="keyword">new</span> JPEGTexture(imageBuffer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// texture properties</span></span><br><span class="line"><span class="built_in">int</span> bpp = jpgTexture.BytesPerPixel;</span><br><span class="line"><span class="built_in">int</span> columnCount = jpgTexture.ColumnCount;</span><br><span class="line"><span class="built_in">int</span> rowCount = jpgTexture.RowCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// build the textureResource and the material</span></span><br><span class="line">BasicMaterial material = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">material.TextureResource = <span class="keyword">new</span> TextureResource(jpgTexture);</span><br></pre></td></tr></table></figure>

<h3 id="使用未压缩纹理创建基本材质"><a href="#使用未压缩纹理创建基本材质" class="headerlink" title="使用未压缩纹理创建基本材质"></a>使用未压缩纹理创建基本材质</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">UncompressedTexture uncompressedTexture1 = <span class="keyword">new</span> UncompressedTexture(<span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">10</span> * <span class="number">12</span> * <span class="number">3</span>], <span class="number">10</span>, <span class="number">12</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// texture properties</span></span><br><span class="line"><span class="built_in">int</span> bpp = uncompressedTexture1.BytesPerPixel;</span><br><span class="line"><span class="built_in">int</span> columnCount = uncompressedTexture1.ColumnCount;</span><br><span class="line"><span class="built_in">int</span> rowCount = uncompressedTexture1.RowCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// build the textureResource and the material</span></span><br><span class="line">TextureResource tr = <span class="keyword">new</span> TextureResource(uncompressedTexture1);</span><br><span class="line">BasicMaterial material = <span class="keyword">new</span> BasicMaterial();</span><br><span class="line">material.TextureResource = tr;</span><br></pre></td></tr></table></figure>

<h3 id="获取多面体的纹理图像"><a href="#获取多面体的纹理图像" class="headerlink" title="获取多面体的纹理图像"></a>获取多面体的纹理图像</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">// This method gets the material texture image of a multipatch.</span></span><br><span class="line"><span class="comment">// This method must be called on the MCT. Use QueuedTask.Run.</span></span><br><span class="line"><span class="comment">// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;multipatch&quot;&gt;The input multipatch.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;patchIndex&quot;&gt;The index of the patch (part) for which to get the material texture.&lt;/param&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetMultipatchTextureImage</span>(<span class="params">Multipatch multipatch, <span class="built_in">int</span> patchIndex</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> materialIndex = multipatch.GetPatchMaterialIndex(patchIndex);</span><br><span class="line">  <span class="keyword">if</span> (!multipatch.IsMaterialTextured(materialIndex))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  TextureCompressionType compressionType = </span><br><span class="line">    multipatch.GetMaterialTextureCompressionType(materialIndex);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> ext = compressionType == TextureCompressionType.CompressionJPEG ? <span class="string">&quot;.jpg&quot;</span> : <span class="string">&quot;.dat&quot;</span>;</span><br><span class="line">  <span class="built_in">byte</span>[] textureBuffer = multipatch.GetMaterialTexture(materialIndex);</span><br><span class="line"></span><br><span class="line">  Stream imageStream = <span class="keyword">new</span> MemoryStream(textureBuffer);</span><br><span class="line">  System.Drawing.Image image = System.Drawing.Image.FromStream(imageStream);</span><br><span class="line">  image.Save(<span class="string">@&quot;C:\temp\myImage&quot;</span> + ext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多面体的法线坐标"><a href="#获取多面体的法线坐标" class="headerlink" title="获取多面体的法线坐标"></a>获取多面体的法线坐标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">// This method gets the normal coordinate of a multipatch and does something with it.</span></span><br><span class="line"><span class="comment">// This method must be called on the MCT. Use QueuedTask.Run.</span></span><br><span class="line"><span class="comment">// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;multipatch&quot;&gt;The input multipatch.&lt;/param&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;patchIndex&quot;&gt;The index of the patch (part) for which to get the normal.&lt;/param&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomethingWithNormalCoordinate</span>(<span class="params">Multipatch multipatch, <span class="built_in">int</span> patchIndex</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (multipatch.HasNormals)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// If the multipatch has normals, then the number of normals is equal to the number of points.</span></span><br><span class="line">    <span class="built_in">int</span> numNormals = multipatch.GetPatchPointCount(patchIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> pointIndex = <span class="number">0</span>; pointIndex &lt; numNormals; pointIndex++)</span><br><span class="line">    &#123;</span><br><span class="line">      Coordinate3D normal = multipatch.GetPatchNormal(patchIndex, pointIndex);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Do something with the normal coordinate.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多面体的法线"><a href="#获取多面体的法线" class="headerlink" title="获取多面体的法线"></a>获取多面体的法线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">// This method gets the normal coordinate of a multipatch and does something with it.</span></span><br><span class="line"><span class="comment">// This method must be called on the MCT. Use QueuedTask.Run.</span></span><br><span class="line"><span class="comment">// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">// &lt;param name=&quot;multipatch&quot;&gt;The input multipatch.&lt;/param&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomethingWithNormalCoordinates</span>(<span class="params">Multipatch multipatch</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (multipatch.HasNormals)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Allocate the list only once</span></span><br><span class="line">    <span class="built_in">int</span> numPoints = multipatch.PointCount;</span><br><span class="line">    ICollection&lt;Coordinate3D&gt; normals = <span class="keyword">new</span> List&lt;Coordinate3D&gt;(numPoints);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The parts of a multipatch are also called patches</span></span><br><span class="line">    <span class="built_in">int</span> numPatches = multipatch.PartCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> patchIndex = <span class="number">0</span>; patchIndex &lt; numPatches; patchIndex++)</span><br><span class="line">    &#123;</span><br><span class="line">      multipatch.GetPatchNormals(patchIndex, <span class="keyword">ref</span> normals);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Do something with the normals for this patch.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多面体的材质属性"><a href="#获取多面体的材质属性" class="headerlink" title="获取多面体的材质属性"></a>获取多面体的材质属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetMaterialProperties</span>(<span class="params">Multipatch multipatch, <span class="built_in">int</span> patchIndex</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (multipatch.HasMaterials)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get the material index for the specified patch.</span></span><br><span class="line">    <span class="built_in">int</span> materialIndex = multipatch.GetPatchMaterialIndex(patchIndex);</span><br><span class="line"></span><br><span class="line">    System.Windows.Media.Color color = multipatch.GetMaterialColor(materialIndex);</span><br><span class="line">    <span class="built_in">int</span> tranparencyPercent = multipatch.GetMaterialTransparencyPercent(materialIndex);</span><br><span class="line">    <span class="built_in">bool</span> isBackCulled = multipatch.IsMaterialCullBackFace(materialIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (multipatch.IsMaterialTextured(materialIndex))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">int</span> bpp = multipatch.GetMaterialTextureBytesPerPixel(materialIndex);</span><br><span class="line">      <span class="built_in">int</span> columnCount = multipatch.GetMaterialTextureColumnCount(materialIndex);</span><br><span class="line">      <span class="built_in">int</span> rowCount = multipatch.GetMaterialTextureRowCount(materialIndex);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多部件"><a href="#多部件" class="headerlink" title="多部件"></a>多部件</h2><h3 id="获取多部分要素的各个部分"><a href="#获取多部分要素的各个部分" class="headerlink" title="获取多部分要素的各个部分"></a>获取多部分要素的各个部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IEnumerable&lt;Geometry&gt; <span class="title">MultipartToSinglePart</span>(<span class="params">Geometry inputGeometry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// list holding the part(s) of the input geometry</span></span><br><span class="line">  List&lt;Geometry&gt; singleParts = <span class="keyword">new</span> List&lt;Geometry&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check if the input is a null pointer or if the geometry is empty</span></span><br><span class="line">  <span class="keyword">if</span> (inputGeometry == <span class="literal">null</span> || inputGeometry.IsEmpty)</span><br><span class="line">    <span class="keyword">return</span> singleParts;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// based on the type of geometry, take the parts/points and add them individually into a list</span></span><br><span class="line">  <span class="keyword">switch</span> (inputGeometry.GeometryType)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Envelope:</span><br><span class="line">      singleParts.Add(inputGeometry.Clone() <span class="keyword">as</span> Envelope);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Multipatch:</span><br><span class="line">      singleParts.Add(inputGeometry.Clone() <span class="keyword">as</span> Multipatch);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Multipoint:</span><br><span class="line">      <span class="keyword">var</span> multiPoint = inputGeometry <span class="keyword">as</span> Multipoint;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> multiPoint.Points)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// add each point of collection as a standalone point into the list</span></span><br><span class="line">        singleParts.Add(point);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Point:</span><br><span class="line">      singleParts.Add(inputGeometry.Clone() <span class="keyword">as</span> MapPoint);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Polygon:</span><br><span class="line">      <span class="keyword">var</span> polygon = inputGeometry <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> polygonPart <span class="keyword">in</span> polygon.Parts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// use the PolygonBuilderEx turning the segments into a standalone </span></span><br><span class="line">        <span class="comment">// polygon instance</span></span><br><span class="line">        singleParts.Add(PolygonBuilderEx.CreatePolygon(polygonPart));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Polyline:</span><br><span class="line">      <span class="keyword">var</span> polyline = inputGeometry <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> polylinePart <span class="keyword">in</span> polyline.Parts)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// use the PolylineBuilderEx turning the segments into a standalone</span></span><br><span class="line">        <span class="comment">// polyline instance</span></span><br><span class="line">        singleParts.Add(PolylineBuilderEx.CreatePolyline(polylinePart));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GeometryType.Unknown:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="literal">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> singleParts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取多边形的最外层环"><a href="#获取多边形的最外层环" class="headerlink" title="获取多边形的最外层环"></a>获取多边形的最外层环</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Polygon <span class="title">GetOutermostRings</span>(<span class="params">Polygon inputPolygon</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (inputPolygon == <span class="literal">null</span> || inputPolygon.IsEmpty)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  List&lt;Polygon&gt; internalRings = <span class="keyword">new</span> List&lt;Polygon&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// explode the parts of the polygon into a list of individual geometries</span></span><br><span class="line">  <span class="comment">// see the &quot;Get the individual parts of a multipart feature&quot;</span></span><br><span class="line">  <span class="comment">// snippet for MultipartToSinglePart</span></span><br><span class="line">  <span class="keyword">var</span> parts = MultipartToSinglePart(inputPolygon);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get an enumeration of clockwise geometries (area &gt; 0) ordered by the area</span></span><br><span class="line">  <span class="keyword">var</span> clockwiseParts = parts.Where(geom =&gt; ((Polygon)geom).Area &gt; <span class="number">0</span>)</span><br><span class="line">                        .OrderByDescending(geom =&gt; ((Polygon)geom).Area);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for each of the exterior rings</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> part <span class="keyword">in</span> clockwiseParts)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// add the first (the largest) ring into the internal collection</span></span><br><span class="line">    <span class="keyword">if</span> (internalRings.Count == <span class="number">0</span>)</span><br><span class="line">      internalRings.Add(part <span class="keyword">as</span> Polygon);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use flag to indicate if current part is within the already selection polygons</span></span><br><span class="line">    <span class="built_in">bool</span> isWithin = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> internalRings)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (GeometryEngine.Instance.Within(part, item))</span><br><span class="line">        isWithin = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the current polygon is not within any polygon of the internal collection</span></span><br><span class="line">    <span class="comment">// then it is disjoint and needs to be added to </span></span><br><span class="line">    <span class="keyword">if</span> (isWithin == <span class="literal">false</span>)</span><br><span class="line">      internalRings.Add(part <span class="keyword">as</span> Polygon);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  PolygonBuilderEx outerRings = <span class="keyword">new</span> PolygonBuilderEx();</span><br><span class="line">  <span class="comment">// now assemble a new polygon geometry based on the internal polygon collection</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> ring <span class="keyword">in</span> internalRings)</span><br><span class="line">  &#123;</span><br><span class="line">    outerRings.AddParts(ring.Parts);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return the final geometry of the outer rings</span></span><br><span class="line">  <span class="keyword">return</span> outerRings.ToGeometry();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="从地理数据库检索几何"><a href="#从地理数据库检索几何" class="headerlink" title="从地理数据库检索几何"></a>从地理数据库检索几何</h2><h3 id="从地理数据库检索几何-1"><a href="#从地理数据库检索几何-1" class="headerlink" title="从地理数据库检索几何"></a>从地理数据库检索几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// methods need to run on the MCT</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// open a gdb</span></span><br><span class="line">    <span class="keyword">using</span> (ArcGIS.Core.Data.Geodatabase gdb = </span><br><span class="line">              <span class="keyword">new</span> ArcGIS.Core.Data.Geodatabase(</span><br><span class="line">                  <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\Temp\MyDatabase.gdb&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Open a featureClass </span></span><br><span class="line">      <span class="keyword">using</span> (ArcGIS.Core.Data.FeatureClass featureClass = </span><br><span class="line">                     gdb.OpenDataset&lt;ArcGIS.Core.Data.FeatureClass&gt;(<span class="string">&quot;Polygon&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        </span><br><span class="line">        ArcGIS.Core.Data.QueryFilter filter = </span><br><span class="line">                   <span class="keyword">new</span> ArcGIS.Core.Data.QueryFilter()</span><br><span class="line">                    &#123;</span><br><span class="line">                      WhereClause = <span class="string">&quot;OBJECTID = 6&quot;</span></span><br><span class="line">                    &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get the row</span></span><br><span class="line">        <span class="keyword">using</span> (ArcGIS.Core.Data.RowCursor rowCursor = </span><br><span class="line">                               featureClass.Search(filter, <span class="literal">false</span>))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> row = rowCursor.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">long</span> oid = row.GetObjectID();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// get the shape from the row</span></span><br><span class="line">              ArcGIS.Core.Data.Feature feature = row <span class="keyword">as</span> ArcGIS.Core.Data.Feature;</span><br><span class="line">              Polygon polygon = feature.GetShape() <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">              <span class="comment">// do something here</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// error - handle appropriately</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="导入、导出几何图形"><a href="#导入、导出几何图形" class="headerlink" title="导入、导出几何图形"></a>导入、导出几何图形</h2><h3 id="将几何图形导入和导出为已知文本"><a href="#将几何图形导入和导出为已知文本" class="headerlink" title="将几何图形导入和导出为已知文本"></a>将几何图形导入和导出为已知文本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a point with z, m</span></span><br><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(</span><br><span class="line">         <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line"><span class="comment">// set the flags</span></span><br><span class="line">WktExportFlags wktExportFlags = WktExportFlags.WktExportDefaults;</span><br><span class="line">WktImportFlags wktImportFlags = WktImportFlags.WktImportDefaults;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export and import</span></span><br><span class="line"><span class="built_in">string</span> wktString = GeometryEngine.Instance.ExportToWKT(wktExportFlags, point);</span><br><span class="line">MapPoint importPoint = GeometryEngine.Instance.ImportFromWKT(</span><br><span class="line">      wktImportFlags, wktString, SpatialReferences.WebMercator) <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> x = importPoint.X;       <span class="comment">// x = 100</span></span><br><span class="line"><span class="built_in">double</span> y = importPoint.Y;       <span class="comment">// y = 200</span></span><br><span class="line"><span class="built_in">bool</span> hasZ = importPoint.HasZ;   <span class="comment">// hasZ = true</span></span><br><span class="line"><span class="built_in">double</span> z = importPoint.Z;       <span class="comment">// z = 300</span></span><br><span class="line"><span class="built_in">bool</span> hasM = importPoint.HasM;   <span class="comment">// hasM = true</span></span><br><span class="line"><span class="built_in">double</span> m = importPoint.M;       <span class="comment">// m = 400</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export without z</span></span><br><span class="line">WktExportFlags exportFlagsNoZ = WktExportFlags.WktExportStripZs;</span><br><span class="line">wktString = GeometryEngine.Instance.ExportToWKT(exportFlagsNoZ, point);</span><br><span class="line">importPoint = GeometryEngine.Instance.ImportFromWKT(</span><br><span class="line">  wktImportFlags, wktString, SpatialReferences.WebMercator) <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">x = importPoint.X;        <span class="comment">// x = 100</span></span><br><span class="line">y = importPoint.Y;        <span class="comment">// y = 200</span></span><br><span class="line">hasZ = importPoint.HasZ;  <span class="comment">// hasZ = false</span></span><br><span class="line">z = importPoint.Z;        <span class="comment">// z = 0</span></span><br><span class="line">hasM = importPoint.HasM;  <span class="comment">// hasM = true</span></span><br><span class="line">m = importPoint.M;        <span class="comment">// m = 400</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export without m</span></span><br><span class="line">WktExportFlags exportFlagsNoM = WktExportFlags.WktExportStripMs;</span><br><span class="line">wktString = GeometryEngine.Instance.ExportToWKT(exportFlagsNoM, point);</span><br><span class="line">importPoint = GeometryEngine.Instance.ImportFromWKT(</span><br><span class="line">  wktImportFlags, wktString, SpatialReferences.WebMercator) <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">x = importPoint.X;        <span class="comment">// x = 100</span></span><br><span class="line">y = importPoint.Y;        <span class="comment">// y = 200</span></span><br><span class="line">hasZ = importPoint.HasZ;  <span class="comment">// hasZ = true</span></span><br><span class="line">z = importPoint.Z;        <span class="comment">// z = 300</span></span><br><span class="line">hasM = importPoint.HasM;  <span class="comment">// hasM = false</span></span><br><span class="line">m = importPoint.M;        <span class="comment">// m = Nan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export without z, m</span></span><br><span class="line">wktString = GeometryEngine.Instance.ExportToWKT(</span><br><span class="line">  exportFlagsNoZ | exportFlagsNoM, point);</span><br><span class="line">importPoint = GeometryEngine.Instance.ImportFromWKT(</span><br><span class="line">  wktImportFlags, wktString, SpatialReferences.WebMercator) <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">x = importPoint.X;        <span class="comment">// x = 100</span></span><br><span class="line">y = importPoint.Y;        <span class="comment">// y = 200</span></span><br><span class="line">hasZ = importPoint.HasZ;  <span class="comment">// hasZ = false</span></span><br><span class="line">z = importPoint.Z;        <span class="comment">// z = 0</span></span><br><span class="line">hasM = importPoint.HasM;  <span class="comment">// hasM = false</span></span><br><span class="line">m = importPoint.M;        <span class="comment">// m = Nan</span></span><br></pre></td></tr></table></figure>

<h3 id="将几何图形导入和导出到众所周知的二进制"><a href="#将几何图形导入和导出到众所周知的二进制" class="headerlink" title="将几何图形导入和导出到众所周知的二进制"></a>将几何图形导入和导出到众所周知的二进制</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a polyline</span></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(</span><br><span class="line">            coords, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">WkbExportFlags wkbExportFlags = WkbExportFlags.WkbExportDefaults;</span><br><span class="line">WkbImportFlags wkbImportFlags = WkbImportFlags.WkbImportDefaults;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export and import</span></span><br><span class="line"><span class="built_in">byte</span>[] buffer = GeometryEngine.Instance.ExportToWKB(wkbExportFlags, polyline);</span><br><span class="line">Geometry geometry = GeometryEngine.Instance.ImportFromWKB(</span><br><span class="line">               wkbImportFlags, buffer, SpatialReferences.WGS84);</span><br><span class="line">Polyline importPolyline = geometry <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// alternatively, determine the size for the buffer</span></span><br><span class="line"><span class="built_in">int</span> bufferSize = GeometryEngine.Instance.GetWKBSize(wkbExportFlags, polyline);</span><br><span class="line">buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[bufferSize];</span><br><span class="line"><span class="comment">// export</span></span><br><span class="line">bufferSize = GeometryEngine.Instance.ExportToWKB(</span><br><span class="line">                wkbExportFlags, polyline, <span class="keyword">ref</span> buffer);</span><br><span class="line"><span class="comment">// import</span></span><br><span class="line">importPolyline = GeometryEngine.Instance.ImportFromWKB(</span><br><span class="line">         wkbImportFlags, buffer, SpatialReferences.WGS84) <span class="keyword">as</span> Polyline;</span><br></pre></td></tr></table></figure>

<h3 id="将几何导入和导出到-EsriShape"><a href="#将几何导入和导出到-EsriShape" class="headerlink" title="将几何导入和导出到 EsriShape"></a>将几何导入和导出到 EsriShape</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create an envelope</span></span><br><span class="line">List&lt;MapPoint&gt; coordsZM = <span class="keyword">new</span> List&lt;MapPoint&gt;</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1001</span>, <span class="number">1002</span>, <span class="number">1003</span>, <span class="number">1004</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">2001</span>, <span class="number">2002</span>, Double.NaN, <span class="number">2004</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">3001</span>, <span class="number">-3002</span>, <span class="number">3003</span>, <span class="number">3004</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1001</span>, <span class="number">-4002</span>, <span class="number">4003</span>, <span class="number">4004</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Envelope envelope = EnvelopeBuilderEx.CreateEnvelope(</span><br><span class="line">           coordsZM[<span class="number">0</span>], coordsZM[<span class="number">2</span>], SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// export and import</span></span><br><span class="line">EsriShapeExportFlags exportFlags = EsriShapeExportFlags.EsriShapeExportDefaults;</span><br><span class="line">EsriShapeImportFlags importFlags = EsriShapeImportFlags.EsriShapeImportDefaults;</span><br><span class="line"><span class="built_in">byte</span>[] buffer = GeometryEngine.Instance.ExportToEsriShape(exportFlags, envelope);</span><br><span class="line">Polygon importedPolygon = GeometryEngine.Instance.ImportFromEsriShape(</span><br><span class="line">               importFlags, buffer, envelope.SpatialReference) <span class="keyword">as</span> Polygon;</span><br><span class="line">Envelope importedEnvelope = importedPolygon.Extent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export without z,m</span></span><br><span class="line">buffer = GeometryEngine.Instance.ExportToEsriShape(</span><br><span class="line">        EsriShapeExportFlags.EsriShapeExportStripZs | </span><br><span class="line">        EsriShapeExportFlags.EsriShapeExportStripMs, envelope);</span><br><span class="line">importedPolygon = GeometryEngine.Instance.ImportFromEsriShape(</span><br><span class="line">        importFlags, buffer, SpatialReferences.WGS84) <span class="keyword">as</span> Polygon;</span><br><span class="line">importedEnvelope = importedPolygon.Extent;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> hasZ = importedEnvelope.HasZ;      <span class="comment">// hasZ = false</span></span><br><span class="line"><span class="built_in">bool</span> hasM = importedEnvelope.HasM;      <span class="comment">// hasM = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export with shapeSize</span></span><br><span class="line"><span class="built_in">int</span> bufferSize = GeometryEngine.Instance.GetEsriShapeSize(</span><br><span class="line">                                       exportFlags, envelope);</span><br><span class="line">buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[bufferSize];</span><br><span class="line"></span><br><span class="line">bufferSize = GeometryEngine.Instance.ExportToEsriShape(</span><br><span class="line">                             exportFlags, envelope, <span class="keyword">ref</span> buffer);</span><br><span class="line">importedPolygon = GeometryEngine.Instance.ImportFromEsriShape(</span><br><span class="line">                    importFlags, buffer, envelope.SpatialReference) <span class="keyword">as</span> Polygon;</span><br><span class="line">importedEnvelope = importedPolygon.Extent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use the envelope and envelopeBuilderEx classes</span></span><br><span class="line">buffer = envelope.ToEsriShape();</span><br><span class="line"><span class="comment">// buffer represents a polygon as there is not an envelope Esri shape buffer</span></span><br><span class="line"><span class="comment">// EnvelopeBuilderEx.FromEsriShape takes a polygon Esri shape buffer and returns the extent of the polygon.</span></span><br><span class="line">importedEnvelope = EnvelopeBuilderEx.FromEsriShape(buffer);</span><br></pre></td></tr></table></figure>

<h3 id="将几何图形导入和导出为-JSON"><a href="#将几何图形导入和导出为-JSON" class="headerlink" title="将几何图形导入和导出为 JSON"></a>将几何图形导入和导出为 JSON</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapPoint</span></span><br><span class="line"><span class="built_in">string</span> inputString = </span><br><span class="line">  <span class="string">&quot;&#123;\&quot;x\&quot;:1,\&quot;y\&quot;:2,\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326,\&quot;latestWkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">Geometry geometry = GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">  JsonImportFlags.JsonImportDefaults, inputString);</span><br><span class="line"></span><br><span class="line">MapPoint importPoint = geometry <span class="keyword">as</span> MapPoint;</span><br><span class="line"><span class="comment">// importPoint = 1, 2</span></span><br><span class="line"><span class="comment">// importPoint.SpatialReference.WKid = 4326</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the MapPointBuilderEx convenience method</span></span><br><span class="line">MapPoint importPoint2 = MapPointBuilderEx.FromJson(inputString);</span><br><span class="line"><span class="comment">// importPoint2 = 1, 2</span></span><br><span class="line"><span class="comment">// impointPoint2.SpatialReference.Wkid = 4326</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">  JsonExportFlags.JsonExportDefaults, importPoint);</span><br><span class="line"><span class="comment">// outputString =</span></span><br><span class="line"><span class="comment">//   &quot;&#123;\&quot;x\&quot;:1,\&quot;y\&quot;:2,\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326,\&quot;latestWkid\&quot;:4326&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> outputString2 = importPoint.ToJson();</span><br><span class="line"></span><br><span class="line">inputString = </span><br><span class="line">  <span class="string">&quot;&#123;\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;,\&quot;z\&quot;:3,\&quot;m\&quot;:4,\&quot;x\&quot;:1,\&quot;y\&quot;:2&#125;&quot;</span>;</span><br><span class="line">importPoint = GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">  JsonImportFlags.JsonImportDefaults, inputString) <span class="keyword">as</span> MapPoint;</span><br><span class="line"><span class="comment">// importPoint.HasM = true</span></span><br><span class="line"><span class="comment">// importPoint.HasZ = true</span></span><br><span class="line"><span class="comment">// importPoint.X = 1</span></span><br><span class="line"><span class="comment">// importPoint.Y = 2</span></span><br><span class="line"><span class="comment">// importPoint.M = 4</span></span><br><span class="line"><span class="comment">// importPoint.Z = 3</span></span><br><span class="line"></span><br><span class="line">importPoint2 = MapPointBuilderEx.FromJson(inputString);</span><br><span class="line"></span><br><span class="line"><span class="comment">// export to json - skip spatial reference</span></span><br><span class="line">outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">              JsonExportFlags.JsonExportSkipCRS, importPoint);</span><br><span class="line"><span class="comment">// outputString = &quot;&#123;\&quot;x\&quot;:1,\&quot;y\&quot;:2,\&quot;z\&quot;:3,\&quot;m\&quot;:4&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export from mappoint, skipping the sr - same as GeometryEngine.Instance.ExportToJson w JsonExportFlags.JsonExportSkipCRS</span></span><br><span class="line">outputString2 = importPoint.ToJson(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Multipoint</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">100</span>, <span class="number">200</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">201</span>, <span class="number">300</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">301</span>, <span class="number">400</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">401</span>, <span class="number">500</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(</span><br><span class="line">  coords, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line">inputString = </span><br><span class="line">  <span class="string">&quot;&#123;\&quot;points\&quot;:[[100,200],[201,300],[301,400],[401,500]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Multipoint importMultipoint = </span><br><span class="line">  GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">         JsonImportFlags.JsonImportDefaults, inputString) <span class="keyword">as</span> Multipoint;</span><br><span class="line"><span class="comment">// importMultipoint.IsEqual(multipoint) = true</span></span><br><span class="line"></span><br><span class="line">ReadOnlyPointCollection points = importMultipoint.Points;</span><br><span class="line"><span class="comment">// points.Count = 4</span></span><br><span class="line"><span class="comment">// points[0] = 100, 200</span></span><br><span class="line"><span class="comment">// points[1] = 201, 300</span></span><br><span class="line"><span class="comment">// points[2] = 301, 400</span></span><br><span class="line"><span class="comment">// points[3] = 401, 500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the MultipointbuilderEx convenience method</span></span><br><span class="line">Multipoint importMultipoint2 = MultipointBuilderEx.FromJson(inputString);</span><br><span class="line"><span class="comment">// importMultipoint2.IsEqual(multipoint) = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export to json</span></span><br><span class="line">outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">                JsonExportFlags.JsonExportDefaults, multipoint);</span><br><span class="line"><span class="comment">// outputString = inputString</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use the multipoint itself</span></span><br><span class="line">outputString2 = multipoint.ToJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Polyline</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(</span><br><span class="line">                         coords, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line"><span class="comment">// export without the spatial reference</span></span><br><span class="line">outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">                        JsonExportFlags.JsonExportSkipCRS, polyline);</span><br><span class="line"><span class="comment">// import</span></span><br><span class="line">geometry = GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">             JsonImportFlags.JsonImportDefaults, outputString);</span><br><span class="line">Polyline importPolyline = geometry <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// importPolyline.SpatialReference = null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">points = importPolyline.Points;</span><br><span class="line"><span class="comment">// points.Count = 4</span></span><br><span class="line"><span class="comment">// points[0] = 100, 200</span></span><br><span class="line"><span class="comment">// points[1] = 201, 300</span></span><br><span class="line"><span class="comment">// points[2] = 301, 400</span></span><br><span class="line"><span class="comment">// points[3] = 401, 500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the polylineBuilderEx convenience method </span></span><br><span class="line">Polyline importPolyline2 = PolylineBuilderEx.FromJson(outputString);</span><br><span class="line"><span class="comment">// importPolyline2 = importPolyline</span></span><br><span class="line"></span><br><span class="line">outputString2 = importPolyline2.ToJson();</span><br><span class="line"><span class="comment">// outputString2 = outputString</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">                              coords, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line"><span class="comment">// export without the spatial reference</span></span><br><span class="line">outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">                          JsonExportFlags.JsonExportSkipCRS, polygon);</span><br><span class="line"><span class="comment">// import</span></span><br><span class="line">geometry = GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">                     JsonImportFlags.JsonImportDefaults, outputString);</span><br><span class="line"></span><br><span class="line">Polygon importPolygon = geometry <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// importPolygon.SpatialReference = null</span></span><br><span class="line">points = importPolygon.Points;</span><br><span class="line"><span class="comment">// points.Count = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polygonBuilderEx convenience method</span></span><br><span class="line">Polygon importPolyon2 = PolygonBuilderEx.FromJson(outputString);</span><br><span class="line"><span class="comment">// importPolygon2 = importPolygon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export from the polygon</span></span><br><span class="line">outputString2 = importPolyon2.ToJson(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Empty polygon</span></span><br><span class="line">polygon = PolygonBuilderEx.CreatePolygon(SpatialReferences.WebMercator);</span><br><span class="line">outputString = GeometryEngine.Instance.ExportToJson(</span><br><span class="line">                               JsonExportFlags.JsonExportDefaults, polygon);</span><br><span class="line">importPolygon = GeometryEngine.Instance.ImportFromJson(</span><br><span class="line">                    JsonImportFlags.JsonImportDefaults, outputString) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// importPolygon.IsEmpty = true</span></span><br><span class="line"><span class="comment">// importPolygon.SpatialReference.Wkid = 3857</span></span><br></pre></td></tr></table></figure>

<h3 id="将几何图形导入和导出为-XML"><a href="#将几何图形导入和导出为-XML" class="headerlink" title="将几何图形导入和导出为 XML"></a>将几何图形导入和导出为 XML</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">MapPoint minPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">MapPoint maxPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//  MapPoint</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="built_in">string</span> xml = minPoint.ToXml();</span><br><span class="line">MapPoint minPointImport = MapPointBuilderEx.FromXml(xml);</span><br><span class="line"><span class="comment">// minPointImport = minPoint</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Envelope</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Envelope envelopeWithID = EnvelopeBuilderEx.CreateEnvelope(minPoint, maxPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Envelopes don&#x27;t have IDs</span></span><br><span class="line"><span class="comment">// envelopeWithID.HasID = false</span></span><br><span class="line"><span class="comment">// envelopeWithID.HasM = true</span></span><br><span class="line"><span class="comment">// envelopeWithID.HasZ = true</span></span><br><span class="line"></span><br><span class="line">xml = envelopeWithID.ToXml();</span><br><span class="line">Envelope envelopeImport = EnvelopeBuilderEx.FromXml(xml);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Multipoint</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(minPoint);</span><br><span class="line">list.Add(maxPoint);</span><br><span class="line"></span><br><span class="line">Multipoint multiPoint = MultipointBuilderEx.CreateMultipoint(list);</span><br><span class="line"></span><br><span class="line">xml = multiPoint.ToXml();</span><br><span class="line">Multipoint multipointImport = MultipointBuilderEx.FromXml(xml);</span><br><span class="line"><span class="comment">// multipointImport.PointCount == 2</span></span><br><span class="line"><span class="comment">// multipointImport.HasID = true</span></span><br><span class="line"><span class="comment">// multipointImport.HasM = true</span></span><br><span class="line"><span class="comment">// multipointImport.HasZ= true</span></span><br></pre></td></tr></table></figure>

<h2 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h2><h3 id="创建地理转换"><a href="#创建地理转换" class="headerlink" title="创建地理转换"></a>创建地理转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create from wkid</span></span><br><span class="line">GeographicTransformation gt1478 = </span><br><span class="line">  ArcGIS.Core.Geometry.GeographicTransformation.Create(<span class="number">1478</span>);</span><br><span class="line"><span class="built_in">string</span> name = gt1478.Name;</span><br><span class="line"><span class="built_in">string</span> wkt = gt1478.Wkt;</span><br><span class="line"><span class="built_in">int</span> wkid = gt1478.Wkid;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create from wkt</span></span><br><span class="line">GeographicTransformation another_gt1478 = </span><br><span class="line">     ArcGIS.Core.Geometry.GeographicTransformation.Create(wkt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// inverse</span></span><br><span class="line">GeographicTransformation inverse_gt148 = </span><br><span class="line">               another_gt1478.GetInverse() <span class="keyword">as</span> GeographicTransformation;</span><br><span class="line"><span class="built_in">bool</span> isForward = inverse_gt148.IsForward;</span><br></pre></td></tr></table></figure>

<h3 id="创建复合地理变换"><a href="#创建复合地理变换" class="headerlink" title="创建复合地理变换"></a>创建复合地理变换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create singleton from wkid</span></span><br><span class="line">CompositeGeographicTransformation cgt = </span><br><span class="line">    ArcGIS.Core.Geometry.CompositeGeographicTransformation.Create(<span class="number">108272</span>);</span><br><span class="line"><span class="built_in">int</span> count = cgt.Count;    <span class="comment">// count = 1</span></span><br><span class="line"></span><br><span class="line">IList&lt;GeographicTransformation&gt; gts = cgt.Transformations </span><br><span class="line">                                <span class="keyword">as</span> IList&lt;GeographicTransformation&gt;;</span><br><span class="line">gts.Add(ArcGIS.Core.Geometry.GeographicTransformation.Create(<span class="number">1437</span>, <span class="literal">false</span>));</span><br><span class="line">count = cgt.Count;        <span class="comment">// count = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// create from an enumeration</span></span><br><span class="line">CompositeGeographicTransformation another_cgt = </span><br><span class="line">              ArcGIS.Core.Geometry.CompositeGeographicTransformation.Create(gts);</span><br><span class="line">GeographicTransformation gt0 = another_cgt[<span class="number">0</span>];</span><br><span class="line">GeographicTransformation gt1 = another_cgt[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the inverse</span></span><br><span class="line">CompositeGeographicTransformation inversed_cgt = another_cgt.GetInverse() <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line"><span class="comment">// inversed_cgt[0] is same as gt1</span></span><br><span class="line"><span class="comment">// inversed_cgt[1] is same as gt0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wkt = gt0.Wkt;</span><br><span class="line"><span class="comment">// create from string </span></span><br><span class="line">CompositeGeographicTransformation third_cgt = </span><br><span class="line">   ArcGIS.Core.Geometry.CompositeGeographicTransformation.Create(wkt, gt0.IsForward);</span><br><span class="line">count = third_cgt.Count;        <span class="comment">// count = 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// create from josn</span></span><br><span class="line"><span class="built_in">string</span> json = cgt.ToJson();</span><br><span class="line">CompositeGeographicTransformation joson_cgt = </span><br><span class="line">  DatumTransformation.CreateFromJson(json) <span class="keyword">as</span> CompositeGeographicTransformation;</span><br></pre></td></tr></table></figure>

<h3 id="创建投影转换"><a href="#创建投影转换" class="headerlink" title="创建投影转换"></a>创建投影转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// methods need to be on the MCT</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  SpatialReference sr4267 = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4267</span>);</span><br><span class="line">  SpatialReference sr4326 = SpatialReferences.WGS84;</span><br><span class="line">  SpatialReference sr3857 = SpatialReferences.WebMercator;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create transformation from  4267 -&gt; 3857</span></span><br><span class="line">  ProjectionTransformation projTransFromSRs = </span><br><span class="line">       ArcGIS.Core.Geometry.ProjectionTransformation.Create(sr4267, sr3857);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create an envelope</span></span><br><span class="line">  Envelope env = EnvelopeBuilderEx.CreateEnvelope(</span><br><span class="line">             <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">3</span>), sr4267);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Project with one geo transform 4267 -&gt; 3857</span></span><br><span class="line">  Envelope projectedEnvEx = GeometryEngine.Instance.ProjectEx(</span><br><span class="line">                                 env, projTransFromSRs) <span class="keyword">as</span> Envelope;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create inverse transformation, 3857 -&gt; 4267</span></span><br><span class="line">  ProjectionTransformation projTransFromSRsInverse = </span><br><span class="line">      ArcGIS.Core.Geometry.ProjectionTransformation.Create(sr3857, sr4267);</span><br><span class="line">  <span class="comment">// Project the projected envelope back using the inverse transformation</span></span><br><span class="line">  Envelope projectedEnvBack = </span><br><span class="line">         GeometryEngine.Instance.ProjectEx(</span><br><span class="line">           projectedEnvEx, projTransFromSRsInverse) <span class="keyword">as</span> Envelope;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> isEqual = env.IsEqual(projectedEnvBack);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建高压基准变换"><a href="#创建高压基准变换" class="headerlink" title="创建高压基准变换"></a>创建高压基准变换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create from wkid</span></span><br><span class="line">HVDatumTransformation hv110018 = HVDatumTransformation.Create(<span class="number">110018</span>);</span><br><span class="line"><span class="built_in">int</span> wkid = hv110018.Wkid;</span><br><span class="line"><span class="built_in">bool</span> isForward = hv110018.IsForward;    <span class="comment">// isForward = true</span></span><br><span class="line"><span class="built_in">string</span> name = hv110018.Name;            <span class="comment">// Name = WGS_1984_To_WGS_1984_EGM2008_1x1_Height</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create from wkt</span></span><br><span class="line"><span class="built_in">string</span> wkt = hv110018.Wkt;</span><br><span class="line">HVDatumTransformation hv110018FromWkt = HVDatumTransformation.Create(wkt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the inverse</span></span><br><span class="line">HVDatumTransformation hv110018Inverse = </span><br><span class="line">   hv110018.GetInverse() <span class="keyword">as</span> HVDatumTransformation;</span><br><span class="line"><span class="comment">// hv110018Inverse.IsForward = false</span></span><br></pre></td></tr></table></figure>

<h3 id="创建复合高压基准变换"><a href="#创建复合高压基准变换" class="headerlink" title="创建复合高压基准变换"></a>创建复合高压基准变换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HVDatumTransformation hv1 = HVDatumTransformation.Create(<span class="number">108034</span>);</span><br><span class="line">HVDatumTransformation hv2 = HVDatumTransformation.Create(<span class="number">108033</span>, <span class="literal">false</span>);</span><br><span class="line">List&lt;HVDatumTransformation&gt; hvs = <span class="keyword">new</span> List&lt;HVDatumTransformation&gt;() &#123; hv1, hv2 &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create from enumeration</span></span><br><span class="line">CompositeHVDatumTransformation compositehv = </span><br><span class="line">                CompositeHVDatumTransformation.Create(hvs);</span><br><span class="line"><span class="built_in">int</span> count = compositehv.Count;      <span class="comment">// count = 2</span></span><br><span class="line"></span><br><span class="line">List&lt;HVDatumTransformation&gt; transforms = </span><br><span class="line">               compositehv.Transformations <span class="keyword">as</span> List&lt;HVDatumTransformation&gt;;</span><br><span class="line">HVDatumTransformation tranform = transforms[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// transform.Wkid = 108034</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get inverse</span></span><br><span class="line">CompositeHVDatumTransformation inverse_compositehv = </span><br><span class="line">       compositehv.GetInverse() <span class="keyword">as</span> CompositeHVDatumTransformation;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create from xml</span></span><br><span class="line"><span class="built_in">string</span> xml = compositehv.ToXml();</span><br><span class="line"><span class="comment">//At 2.x - CompositeHVDatumTransformation xml_compositehv =</span></span><br><span class="line"><span class="comment">//      CompositeHVDatumTransformation.CreateFromXML(xml);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xml_compositehv = CompositeHVDatumTransformation.CreateFromXml(xml);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create from json</span></span><br><span class="line"><span class="built_in">string</span> json = compositehv.ToJson();</span><br><span class="line">CompositeHVDatumTransformation json_compositehv = </span><br><span class="line">    DatumTransformation.CreateFromJson(json) <span class="keyword">as</span> CompositeHVDatumTransformation;</span><br></pre></td></tr></table></figure>

<h3 id="确定转换"><a href="#确定转换" class="headerlink" title="确定转换"></a>确定转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// methods need to run on the MCT</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// find the first transformation used between spatial references 4267 and 4326</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  SpatialReference sr4267 = </span><br><span class="line">       SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4267</span>);</span><br><span class="line">  SpatialReference sr4326 = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">  List&lt;ProjectionTransformation&gt; transformations = </span><br><span class="line">         ProjectionTransformation.FindTransformations(sr4267, sr4326);</span><br><span class="line">  <span class="comment">// transformations.Count = 1</span></span><br><span class="line">  ProjectionTransformation projTrans = transformations[<span class="number">0</span>];</span><br><span class="line">  CompositeGeographicTransformation compositeGT = </span><br><span class="line">       projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  GeographicTransformation gt = compositeGT[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// gt.Wkid = 15851</span></span><br><span class="line">  <span class="comment">// gt.Name = &quot;NAD_1927_To_WGS_1984_79_CONUS&quot;</span></span><br><span class="line">  <span class="comment">// gt.IsForward = true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// find the first five transformation used between spatial references 4267 and 4326</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  transformations = ProjectionTransformation.FindTransformations(</span><br><span class="line">                                     sr4267, sr4326, numResults: <span class="number">5</span>);</span><br><span class="line">  <span class="comment">// transformations.Count = 5</span></span><br><span class="line">  projTrans = transformations[<span class="number">0</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 1</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 15851</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_WGS_1984_79_CONUS&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  projTrans = transformations[<span class="number">1</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 1</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 1173</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_WGS_1984_4&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  projTrans = transformations[<span class="number">2</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 1</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 1172</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_WGS_1984_3&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  projTrans = transformations[<span class="number">3</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 2</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 1241</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_NAD_1983_NADCON&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// compositeGT[1].Wkid = 108190</span></span><br><span class="line">  <span class="comment">// compositeGT[1].Name = &quot;WGS_1984_(ITRF00)_To_NAD_1983&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[1].IsForward = false</span></span><br><span class="line"></span><br><span class="line">  projTrans = transformations[<span class="number">4</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 2</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 1241</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_NAD_1983_NADCON&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// compositeGT[1].Wkid = 1515</span></span><br><span class="line">  <span class="comment">// compositeGT[1].Name = &quot;NAD_1983_To_WGS_1984_5&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[1].IsForward = true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// find the first transformation used between spatial</span></span><br><span class="line">  <span class="comment">// references 4267 and 4326 within Alaska</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Alaska</span></span><br><span class="line">  Envelope envelope = EnvelopeBuilderEx.CreateEnvelope(<span class="number">-161</span>, <span class="number">61</span>, <span class="number">-145</span>, <span class="number">69</span>);</span><br><span class="line">  transformations = ProjectionTransformation.FindTransformations(</span><br><span class="line">                                              sr4267, sr4326, envelope);</span><br><span class="line">  <span class="comment">// transformations.Count = 1</span></span><br><span class="line">  projTrans = transformations[<span class="number">0</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 2</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 1243</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;NAD_1927_To_NAD_1983_Alaska&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// compositeGT[1].Wkid = 108190</span></span><br><span class="line">  <span class="comment">// compositeGT[1].Name = &quot;WGS_1984_(ITRF00)_To_NAD_1983&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[1].IsForward = false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// find the first geographic transformation used between two spatial references with VCS  (use vertical = false)</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  SpatialReference inSR = </span><br><span class="line">                  SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4269</span>, <span class="number">115702</span>);</span><br><span class="line">  SpatialReference outSR = </span><br><span class="line">                  SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>, <span class="number">3855</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Even though each spatial reference has a VCS,</span></span><br><span class="line">  <span class="comment">// vertical = false should return geographic transformations.</span></span><br><span class="line">  transformations = ProjectionTransformation.FindTransformations(inSR, outSR);</span><br><span class="line">  <span class="comment">// transformations.Count = 1</span></span><br><span class="line">  projTrans = transformations[<span class="number">0</span>];</span><br><span class="line">  compositeGT = projTrans.Transformation <span class="keyword">as</span> CompositeGeographicTransformation;</span><br><span class="line">  <span class="comment">// compositeGT.Count = 1</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Wkid = 108190</span></span><br><span class="line">  <span class="comment">// compositeGT[0].Name = &quot;&quot;WGS_1984_(ITRF00)_To_NAD_1983&quot;</span></span><br><span class="line">  <span class="comment">// compositeGT[0].IsForward = false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// find the first vertical transformation used between two spatial references with VCS  (use vertical = true)</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  transformations = </span><br><span class="line">            ProjectionTransformation.FindTransformations(</span><br><span class="line">                                    inSR, outSR, vertical: <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// transformations.Count = 1</span></span><br><span class="line">  projTrans = transformations[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  CompositeHVDatumTransformation compositeHV = </span><br><span class="line">          projTrans.Transformation <span class="keyword">as</span> CompositeHVDatumTransformation;</span><br><span class="line">  <span class="comment">// compositeHV.Count = 2</span></span><br><span class="line">  <span class="comment">// compositeHV[0].Wkid = 1188</span></span><br><span class="line">  <span class="comment">// compositeHV[0].Name = &quot;NAD_1983_To_WGS_1984_1&quot;</span></span><br><span class="line">  <span class="comment">// compositeHV[0].IsForward = true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// compositeHV[1].Wkid = 110019</span></span><br><span class="line">  <span class="comment">// compositeHV[1].Name = &quot;WGS_1984_To_WGS_1984_EGM2008_2.5x2.5_Height&quot;</span></span><br><span class="line">  <span class="comment">// compositeHV[1].IsForward = true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="地图点地理坐标字符串"><a href="#地图点地理坐标字符串" class="headerlink" title="地图点地理坐标字符串"></a>地图点地理坐标字符串</h2><h3 id="地图点-地理坐标字符串转换"><a href="#地图点-地理坐标字符串转换" class="headerlink" title="地图点 - 地理坐标字符串转换"></a>地图点 - 地理坐标字符串转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line">SpatialReference sr2 = SpatialReferences.WebMercator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create some points</span></span><br><span class="line">MapPoint point0 = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, sr);</span><br><span class="line">MapPoint point1 = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">20</span>, sr);</span><br><span class="line">MapPoint point2 = GeometryEngine.Instance.Project(point1, sr2) <span class="keyword">as</span> MapPoint;</span><br><span class="line">MapPoint pointEmpty = MapPointBuilderEx.CreateMapPoint(sr);</span><br><span class="line">MapPoint pointwithNoSR = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint pointZM = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to MGRS</span></span><br><span class="line">ToGeoCoordinateParameter mgrsParam = </span><br><span class="line">         <span class="keyword">new</span> ToGeoCoordinateParameter(GeoCoordinateType.MGRS);</span><br><span class="line"><span class="comment">// 31NAA6602100000</span></span><br><span class="line"><span class="built_in">string</span> geoCoordString = point0.ToGeoCoordinateString(mgrsParam);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use the builder to create a new point from the string.</span></span><br><span class="line"><span class="comment">// Coordinates are the same </span></span><br><span class="line"><span class="comment">// outPoint.x = 0; outPoint.Y = 0</span></span><br><span class="line">MapPoint outPoint = </span><br><span class="line">      MapPointBuilderEx.FromGeoCoordinateString(</span><br><span class="line">                geoCoordString, sr, GeoCoordinateType.MGRS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 32QPH0460911794</span></span><br><span class="line"><span class="comment">// outPoint.X = 10; outPoint.Y = 20</span></span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(mgrsParam);             </span><br><span class="line">outPoint = MapPointBuilderEx.FromGeoCoordinateString(</span><br><span class="line">           geoCoordString, sr, GeoCoordinateType.MGRS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// z, m are not transformed</span></span><br><span class="line"><span class="comment">// outPoint.X = 1; outPoint.Y = 2; outPoint.Z = Nan; outPoint.M = Nan;</span></span><br><span class="line">geoCoordString = pointZM.ToGeoCoordinateString(mgrsParam);</span><br><span class="line">outPoint = MapPointBuilderEx.FromGeoCoordinateString(</span><br><span class="line">  geoCoordString, sr, GeoCoordinateType.MGRS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// set the number of digits to 2 and convert</span></span><br><span class="line"><span class="comment">// 32QPH0512</span></span><br><span class="line"><span class="comment">// outPoint.X = 10; outPoint.Y = 20</span></span><br><span class="line">mgrsParam.NumDigits = <span class="number">2</span>;</span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(mgrsParam);             </span><br><span class="line">outPoint = MapPointBuilderEx.FromGeoCoordinateString(</span><br><span class="line">  geoCoordString, sr, GeoCoordinateType.MGRS);     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to UTM</span></span><br><span class="line">ToGeoCoordinateParameter utmParam = </span><br><span class="line">     <span class="keyword">new</span> ToGeoCoordinateParameter(GeoCoordinateType.UTM);</span><br><span class="line"><span class="comment">// 31N 166021 0000000</span></span><br><span class="line">geoCoordString = point0.ToGeoCoordinateString(utmParam);</span><br><span class="line"><span class="comment">// 32Q 604609 2211793</span></span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(utmParam);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to DMS</span></span><br><span class="line">ToGeoCoordinateParameter dmsParam = </span><br><span class="line">  <span class="keyword">new</span> ToGeoCoordinateParameter(GeoCoordinateType.DMS);</span><br><span class="line"><span class="comment">// 00 00 00.00N 000 00 00.00E</span></span><br><span class="line">geoCoordString = point0.ToGeoCoordinateString(dmsParam);</span><br><span class="line"><span class="comment">// 20 00 00.00N 010 00 00.00E</span></span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(dmsParam);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to DDM</span></span><br><span class="line">ToGeoCoordinateParameter ddmParam = </span><br><span class="line">  <span class="keyword">new</span> ToGeoCoordinateParameter(GeoCoordinateType.DDM);</span><br><span class="line"><span class="comment">// 00 00.0000N 000 00.0000E</span></span><br><span class="line">geoCoordString = point0.ToGeoCoordinateString(ddmParam);</span><br><span class="line"><span class="comment">// 20 00.0000N 010 00.0000E</span></span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(ddmParam);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to DD</span></span><br><span class="line">ToGeoCoordinateParameter ddParam = </span><br><span class="line">  <span class="keyword">new</span> ToGeoCoordinateParameter(GeoCoordinateType.DD);</span><br><span class="line"><span class="comment">// 00.000000N 000.000000E</span></span><br><span class="line">geoCoordString = point0.ToGeoCoordinateString(ddParam);</span><br><span class="line"><span class="comment">// 20.000000N 010.000000E</span></span><br><span class="line">geoCoordString = point1.ToGeoCoordinateString(ddParam);       </span><br></pre></td></tr></table></figure>

<h2 id="角度单元"><a href="#角度单元" class="headerlink" title="角度单元"></a>角度单元</h2><h3 id="角度单位-在度和弧度之间转换"><a href="#角度单位-在度和弧度之间转换" class="headerlink" title="角度单位 - 在度和弧度之间转换"></a>角度单位 - 在度和弧度之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 45 degrees to radians</span></span><br><span class="line"><span class="built_in">double</span> radians = AngularUnit.Degrees.ConvertToRadians(<span class="number">45</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert PI to degrees</span></span><br><span class="line"><span class="built_in">double</span> degrees = AngularUnit.Degrees.ConvertFromRadians(Math.PI);</span><br></pre></td></tr></table></figure>

<h3 id="角度单位-使用工厂代码创建角度单位"><a href="#角度单位-使用工厂代码创建角度单位" class="headerlink" title="角度单位 - 使用工厂代码创建角度单位"></a>角度单位 - 使用工厂代码创建角度单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// create a Grad unit</span></span><br><span class="line">  <span class="keyword">var</span> grad = AngularUnit.CreateAngularUnit(<span class="number">9105</span>);</span><br><span class="line">  <span class="built_in">string</span> unitName = grad.Name;                        <span class="comment">// Grad</span></span><br><span class="line">  <span class="built_in">double</span> conversionFactor = grad.ConversionFactor;    <span class="comment">// 0.015708</span></span><br><span class="line">  <span class="built_in">double</span> radiansPerUnit = grad.RadiansPerUnit;</span><br><span class="line">  <span class="built_in">int</span> factoryCode = grad.FactoryCode;                 <span class="comment">// 9105</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert 10 grads to degrees</span></span><br><span class="line">  <span class="built_in">double</span> val = grad.ConvertTo(<span class="number">10</span>, AngularUnit.Degrees);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert 10 radians to grads</span></span><br><span class="line">  val = grad.ConvertFromRadians(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ArgumentException)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ArgumentException will be thrown by CreateAngularUnit in</span></span><br><span class="line">  <span class="comment">// the following scenarios:</span></span><br><span class="line">  <span class="comment">// - if the factory code used is a non-angular factory code</span></span><br><span class="line">  <span class="comment">//   (i.e. it corresponds to square meters which is an area unit code)</span></span><br><span class="line">  <span class="comment">// - if the factory code used is invalid</span></span><br><span class="line">  <span class="comment">//   (i.e. it is negative or doesn&#x27;t correspond to any factory code)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="角度单位-创建自定义角度单位"><a href="#角度单位-创建自定义角度单位" class="headerlink" title="角度单位 - 创建自定义角度单位"></a>角度单位 - 创建自定义角度单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// custom unit - 3 radians per unit</span></span><br><span class="line"><span class="keyword">var</span> myAngularUnit = AngularUnit.CreateAngularUnit(<span class="string">&quot;myCustomAngularUnit&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">string</span> Name = myAngularUnit.Name;                   <span class="comment">// myCustomAngularUnit</span></span><br><span class="line"><span class="built_in">double</span> Factor = myAngularUnit.ConversionFactor;     <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">int</span> Code = myAngularUnit.FactoryCode;               <span class="comment">// 0 because it is a custom angular unit</span></span><br><span class="line"><span class="built_in">double</span> radiansUnit = myAngularUnit.RadiansPerUnit;  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// convert 10 degrees to my unit</span></span><br><span class="line"><span class="built_in">double</span> converted = AngularUnit.Degrees.ConvertTo(<span class="number">10</span>, myAngularUnit);</span><br><span class="line"><span class="comment">// convert it back to degrees</span></span><br><span class="line">converted = myAngularUnit.ConvertTo(converted, AngularUnit.Degrees);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert 1 radian into my angular units</span></span><br><span class="line">converted = myAngularUnit.ConvertFromRadians(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the wkt</span></span><br><span class="line"><span class="built_in">string</span> wkt = myAngularUnit.Wkt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an angular unit from this wkt</span></span><br><span class="line"><span class="keyword">var</span> anotherAngularUnit = AngularUnit.CreateAngularUnit(wkt);</span><br><span class="line"><span class="comment">// anotherAngularUnit.ConversionFactor = 3</span></span><br><span class="line"><span class="comment">// anotherAngularUnit.FactoryCode = 0    </span></span><br><span class="line"><span class="comment">// anotherAngularUnit.RadiansPerUnit = 3</span></span><br></pre></td></tr></table></figure>

<h2 id="线性单位"><a href="#线性单位" class="headerlink" title="线性单位"></a>线性单位</h2><h3 id="线性单位-在英尺和米之间转换"><a href="#线性单位-在英尺和米之间转换" class="headerlink" title="线性单位 - 在英尺和米之间转换"></a>线性单位 - 在英尺和米之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 10 feet to meters</span></span><br><span class="line"><span class="built_in">double</span> metres = LinearUnit.Feet.ConvertToMeters(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert 20 meters to feet</span></span><br><span class="line"><span class="built_in">double</span> feet = LinearUnit.Feet.ConvertFromMeters(<span class="number">20.0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="线性单位-在厘米和毫米之间转换"><a href="#线性单位-在厘米和毫米之间转换" class="headerlink" title="线性单位 - 在厘米和毫米之间转换"></a>线性单位 - 在厘米和毫米之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 11 centimeters to millimeters</span></span><br><span class="line"><span class="built_in">double</span> mm = LinearUnit.Centimeters.ConvertTo(<span class="number">11</span>, LinearUnit.Millimeters);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert the result back to centimeters</span></span><br><span class="line"><span class="built_in">double</span> cm = LinearUnit.Millimeters.ConvertTo(mm, LinearUnit.Centimeters);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert the millimeter result back to meters</span></span><br><span class="line"><span class="built_in">double</span> meters = LinearUnit.Millimeters.ConvertToMeters(mm);</span><br></pre></td></tr></table></figure>

<h3 id="线性单位-使用工厂代码创建线性单位"><a href="#线性单位-使用工厂代码创建线性单位" class="headerlink" title="线性单位 - 使用工厂代码创建线性单位"></a>线性单位 - 使用工厂代码创建线性单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// create a british 1936 foot</span></span><br><span class="line">  <span class="keyword">var</span> britFoot = LinearUnit.CreateLinearUnit(<span class="number">9095</span>);</span><br><span class="line">  <span class="built_in">string</span> unitName = britFoot.Name;                        <span class="comment">//  &quot;Foot_British_1936&quot;</span></span><br><span class="line">  <span class="built_in">double</span> conversionFactor = britFoot.ConversionFactor;    <span class="comment">// 0.3048007491</span></span><br><span class="line">  <span class="built_in">double</span> metersPerUnit = britFoot.MetersPerUnit;</span><br><span class="line">  <span class="built_in">int</span> factoryCode = britFoot.FactoryCode;                 <span class="comment">// 9095</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert 10 british 1936 feet to centimeters</span></span><br><span class="line">  <span class="built_in">double</span> val = britFoot.ConvertTo(<span class="number">10</span>, LinearUnit.Centimeters);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// convert 10 m to british 1936 feet</span></span><br><span class="line">  val = britFoot.ConvertFromMeters(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ArgumentException)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ArgumentException will be thrown by CreateLinearUnit</span></span><br><span class="line">  <span class="comment">// in the following scenarios:</span></span><br><span class="line">  <span class="comment">// - if the factory code used is a non-linear factory code</span></span><br><span class="line">  <span class="comment">//   (i.e. it corresponds to square meters which is an area unit code)</span></span><br><span class="line">  <span class="comment">// - if the factory code used is invalid</span></span><br><span class="line">  <span class="comment">//   (i.e. it is negative or doesn&#x27;t correspond to any factory code)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线性单位-创建自定义线性单位"><a href="#线性单位-创建自定义线性单位" class="headerlink" title="线性单位 - 创建自定义线性单位"></a>线性单位 - 创建自定义线性单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a custom linear unit - there are 0.33 meters per myLinearUnit</span></span><br><span class="line"><span class="keyword">var</span> myLinearUnit = LinearUnit.CreateLinearUnit(<span class="string">&quot;myCustomLinearUnit&quot;</span>, <span class="number">0.33</span>);</span><br><span class="line"><span class="built_in">string</span> name = myLinearUnit.Name;                          <span class="comment">// myCustomLinearUnit</span></span><br><span class="line"><span class="built_in">double</span> convFactor = myLinearUnit.ConversionFactor;        <span class="comment">// 0.33</span></span><br><span class="line"><span class="built_in">int</span> code = myLinearUnit.FactoryCode;                      <span class="comment">// 0 for custom units</span></span><br><span class="line"><span class="built_in">double</span> metersUnit = myLinearUnit.MetersPerUnit;           <span class="comment">// 0.33</span></span><br><span class="line"><span class="built_in">string</span> toString = myLinearUnit.ToString();                <span class="comment">// same as Name - myCustomLinearUnit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// convert 10 centimeters to myLinearUnit </span></span><br><span class="line"><span class="built_in">double</span> convertedVal = LinearUnit.Centimeters.ConvertTo(<span class="number">10</span>, myLinearUnit);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// get the wkt</span></span><br><span class="line"><span class="built_in">string</span> lu_wkt = myLinearUnit.Wkt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an angular unit from this wkt</span></span><br><span class="line"><span class="keyword">var</span> anotherLinearUnit = LinearUnit.CreateLinearUnit(lu_wkt);</span><br><span class="line"><span class="comment">// anotherLinearUnit.ConversionFactor = 0.33</span></span><br><span class="line"><span class="comment">// anotherLinearUnit.FactoryCode = 0    </span></span><br><span class="line"><span class="comment">// anotherLinearUnit.MetersPerUnit = 0.33</span></span><br></pre></td></tr></table></figure>

<h2 id="面积单位"><a href="#面积单位" class="headerlink" title="面积单位"></a>面积单位</h2><h3 id="面积单位-在平方英尺和平方米之间转换"><a href="#面积单位-在平方英尺和平方米之间转换" class="headerlink" title="面积单位 - 在平方英尺和平方米之间转换"></a>面积单位 - 在平方英尺和平方米之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 700 square meters to square feet</span></span><br><span class="line"><span class="built_in">double</span> sqFeet = AreaUnit.SquareFeet.ConvertFromSquareMeters(<span class="number">700</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert 1100 square feet to square meters</span></span><br><span class="line"><span class="built_in">double</span> sqMeters = AreaUnit.SquareFeet.ConvertToSquareMeters(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="面积单位-在公顷和英亩之间转换"><a href="#面积单位-在公顷和英亩之间转换" class="headerlink" title="面积单位 - 在公顷和英亩之间转换"></a>面积单位 - 在公顷和英亩之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 2 hectares to acres</span></span><br><span class="line"><span class="built_in">double</span> acres = AreaUnit.Hectares.ConvertTo(<span class="number">2</span>, AreaUnit.Acres);</span><br></pre></td></tr></table></figure>

<h3 id="面积单位-在公顷和平方英里之间转换"><a href="#面积单位-在公顷和平方英里之间转换" class="headerlink" title="面积单位 - 在公顷和平方英里之间转换"></a>面积单位 - 在公顷和平方英里之间转换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// convert 300 hectares to square miles</span></span><br><span class="line"><span class="built_in">double</span> sqMiles = AreaUnit.Hectares.ConvertTo(<span class="number">300</span>, AreaUnit.SquareMiles);</span><br></pre></td></tr></table></figure>

<h3 id="面积单位-各种单位的平方米数"><a href="#面积单位-各种单位的平方米数" class="headerlink" title="面积单位 - 各种单位的平方米数"></a>面积单位 - 各种单位的平方米数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">double</span> sqMetersPerUnit = AreaUnit.Acres.SquareMetersPerUnit;</span><br><span class="line">sqMetersPerUnit = AreaUnit.Ares.SquareMetersPerUnit;</span><br><span class="line">sqMetersPerUnit = AreaUnit.Hectares.SquareMetersPerUnit;</span><br><span class="line">sqMetersPerUnit = AreaUnit.SquareKilometers.SquareMetersPerUnit;</span><br><span class="line">sqMetersPerUnit = AreaUnit.SquareMiles.SquareMetersPerUnit;</span><br><span class="line">sqMetersPerUnit = AreaUnit.SquareYards.SquareMetersPerUnit;</span><br></pre></td></tr></table></figure>

<h3 id="面积单位-创建面积单位"><a href="#面积单位-创建面积单位" class="headerlink" title="面积单位 - 创建面积单位"></a>面积单位 - 创建面积单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> myFactoryCodeInit = AreaUnit.CreateAreaUnit(<span class="number">109439</span>);     <span class="comment">// 109439 is the factory code for square miles</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> myWktUnit = AreaUnit.CreateAreaUnit(<span class="string">&quot;HECTARE_AREAUNIT[\&quot;H\&quot;,10000.0]&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> myCustomUnit = AreaUnit.CreateAreaUnit(<span class="string">&quot;myAreaUnit&quot;</span>, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ArgumentException)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ArgumentException will be thrown by CreateAreaUnit in the following scenarios</span></span><br><span class="line">  <span class="comment">// - if the factory code used is a non-areal factory code  (i.e. it corresponds to degrees which is an angular unit code)</span></span><br><span class="line">  <span class="comment">// - if the factory code used is invalid (i.e. it is negative or doesn&#x27;t correspond to any factory code)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="几何引擎函数"><a href="#几何引擎函数" class="headerlink" title="几何引擎函数"></a>几何引擎函数</h2><h3 id="加速几何图形"><a href="#加速几何图形" class="headerlink" title="加速几何图形"></a>加速几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use acceleration to speed up relational operations.  Accelerate your source geometry only if you are going to test many other geometries against it. </span></span><br><span class="line"><span class="comment">// Acceleration is applicable for polylines and polygons only. Note that accelerated geometries take more memory so if you aren&#x27;t going to get any</span></span><br><span class="line"><span class="comment">// benefit from accelerating it, don&#x27;t do it. </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The performance of the following GeometryEngine functions are the only ones which can be improved with an accelerated geometry.</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Contains</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Crosses</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Disjoint</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Disjoint3D</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Equals</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Intersects</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Relate</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Touches</span></span><br><span class="line"><span class="comment">//    GeometryEngine.Instance.Within</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// methods need to run on the MCT</span></span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// accelerate the geometry to test</span></span><br><span class="line">  <span class="keyword">var</span> acceleratedPoly = GeometryEngine.Instance.AccelerateForRelationalOperations(polygon);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// loop through all the geometries to test against</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> testPolygon <span class="keyword">in</span> testPolygons)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bool</span> contains = GeometryEngine.Instance.Contains(acceleratedPoly, testPolygon);</span><br><span class="line">    <span class="built_in">bool</span> within = GeometryEngine.Instance.Within(acceleratedPoly, testPolygon);</span><br><span class="line">    <span class="built_in">bool</span> crosses = GeometryEngine.Instance.Crosses(acceleratedPoly, testPolygon);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="确定面的面积"><a href="#确定面的面积" class="headerlink" title="确定面的面积"></a>确定面的面积</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g1 = PolygonBuilderEx.FromJson(<span class="string">&quot;&#123;\&quot;rings\&quot;: [ [ [0, 0], [10, 0], [10, 10], [0, 10] ] ] &#125;&quot;</span>);</span><br><span class="line"><span class="built_in">double</span> d = GeometryEngine.Instance.Area(g1);</span><br><span class="line"><span class="comment">// d = -100.0         //negative due to wrong ring orientation</span></span><br><span class="line">d = GeometryEngine.Instance.Area(GeometryEngine.Instance.SimplifyAsFeature(g1));</span><br><span class="line"><span class="comment">// d = 100.0        // feature has been simplifed; ring orientation is correct</span></span><br></pre></td></tr></table></figure>

<h3 id="确定多部分多边形的边界"><a href="#确定多部分多边形的边界" class="headerlink" title="确定多部分多边形的边界"></a>确定多部分多边形的边界</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a donut polygon.  Must use the PolygonBuilderEx object</span></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; outerPts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">outerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">10.0</span>, <span class="number">10.0</span>));</span><br><span class="line">outerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">10.0</span>, <span class="number">20.0</span>));</span><br><span class="line">outerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">20.0</span>, <span class="number">20.0</span>));</span><br><span class="line">outerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">20.0</span>, <span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; innerPts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">innerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">13.0</span>, <span class="number">13.0</span>));</span><br><span class="line">innerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">17.0</span>, <span class="number">13.0</span>));</span><br><span class="line">innerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">17.0</span>, <span class="number">17.0</span>));</span><br><span class="line">innerPts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">13.0</span>, <span class="number">17.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon donut = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the outer points</span></span><br><span class="line">PolygonBuilderEx pb = <span class="keyword">new</span> PolygonBuilderEx(outerPts);</span><br><span class="line"><span class="comment">// add the inner points (note they are defined anticlockwise)</span></span><br><span class="line">pb.AddPart(innerPts);</span><br><span class="line"><span class="comment">// get the polygon</span></span><br><span class="line">donut = pb.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the boundary </span></span><br><span class="line">Geometry g = GeometryEngine.Instance.Boundary(donut);</span><br><span class="line">Polyline boundary = g <span class="keyword">as</span> Polyline;</span><br></pre></td></tr></table></figure>

<h3 id="缓冲地图点"><a href="#缓冲地图点" class="headerlink" title="缓冲地图点"></a>缓冲地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buffer a point</span></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line">Geometry ptBuffer = GeometryEngine.Instance.Buffer(pt, <span class="number">5.0</span>);</span><br><span class="line">Polygon buffer = ptBuffer <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="缓冲圆弧"><a href="#缓冲圆弧" class="headerlink" title="缓冲圆弧"></a>缓冲圆弧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create the circular arc</span></span><br><span class="line">MapPoint fromPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint toPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Coordinate2D interiorPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>, <span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromPt, toPt, interiorPt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// buffer the arc</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(circularArc);</span><br><span class="line">Geometry lineBuffer = GeometryEngine.Instance.Buffer(polyline, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h3 id="缓冲多个地图点"><a href="#缓冲多个地图点" class="headerlink" title="缓冲多个地图点"></a>缓冲多个地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// creates a buffer around each MapPoint</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Geometry ptsBuffer = GeometryEngine.Instance.Buffer(pts, <span class="number">0.25</span>);</span><br><span class="line">Polygon bufferResult = ptsBuffer <span class="keyword">as</span> Polygon;      <span class="comment">// bufferResult will have 4 parts</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲多种不同的几何类型"><a href="#缓冲多种不同的几何类型" class="headerlink" title="缓冲多种不同的几何类型"></a>缓冲多种不同的几何类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">4</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">4</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">6</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">7</span>, <span class="number">8</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">10</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">11</span>, <span class="number">12</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">12</span>, <span class="number">8</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">8</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">12</span>, <span class="number">12</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">14</span>, <span class="number">10</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">List&lt;Geometry&gt; manyGeometries = <span class="keyword">new</span> List&lt;Geometry&gt;</span><br><span class="line">&#123;</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint(coords[<span class="number">9</span>]),</span><br><span class="line">    PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">0</span>], coords[<span class="number">1</span>], coords[<span class="number">2</span>]&#125;, SpatialReferences.WGS84),</span><br><span class="line">    PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">3</span>], coords[<span class="number">4</span>], coords[<span class="number">5</span>]&#125;),</span><br><span class="line">    PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">6</span>], coords[<span class="number">7</span>], coords[<span class="number">8</span>]&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Geometry manyGeomBuffer = GeometryEngine.Instance.Buffer(manyGeometries, <span class="number">0.25</span>);</span><br></pre></td></tr></table></figure>

<h3 id="在折线上插值-Z-值"><a href="#在折线上插值-Z-值" class="headerlink" title="在折线上插值 Z 值"></a>在折线上插值 Z 值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate3D&gt; coords2 = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">1000</span>, <span class="built_in">double</span>.NaN),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1000</span>, <span class="number">1000</span>, <span class="number">50</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1000</span>, <span class="number">1000</span>, <span class="number">76</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">1000</span>, <span class="built_in">double</span>.NaN),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WebMercator;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords2, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"><span class="comment">// polyline.Points[1].HasZ = true</span></span><br><span class="line"><span class="comment">// polyline.Points[1].Z  = NaN   </span></span><br><span class="line"><span class="comment">// polyline.Points[4].HasZ = true</span></span><br><span class="line"><span class="comment">// polyline.Points[4].Z  = NaN   </span></span><br><span class="line"></span><br><span class="line">Polyline polylineNoNaNZs = GeometryEngine.Instance.CalculateNonSimpleZs(polyline, <span class="number">0</span>) <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"><span class="comment">// polylineNoNaNZs.Points[1].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineNoNaNZs.Points[1].Z = 25  (halfway between 0 and 50)</span></span><br><span class="line"><span class="comment">// polylineNoNaNZs.Points[4].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineNoNaNZs.Points[4].Z = 38  (halfway between 76 and 0)</span></span><br></pre></td></tr></table></figure>

<h3 id="在多边形上插值-M-值"><a href="#在多边形上插值-M-值" class="headerlink" title="在多边形上插值 M 值"></a>在多边形上插值 M 值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; coords = <span class="keyword">new</span> List&lt;MapPoint&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">1000</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1000</span>, <span class="number">1000</span>, <span class="number">10</span>, <span class="number">50</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WebMercator;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon.HasM = true</span></span><br><span class="line"><span class="comment">// polygon.Points[1].HasM = true</span></span><br><span class="line"><span class="comment">// polygon.Points[1].M = NaN</span></span><br><span class="line"></span><br><span class="line">Polygon polygonNoNaNMs = GeometryEngine.Instance.CalculateNonSimpleMs(polygon, <span class="number">0</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygonNoNaNMs.Points[1].HasM = true</span></span><br><span class="line"><span class="comment">// polygonNoNaNMs.Points[1].M = 25  (halfway between 0 and 50)</span></span><br></pre></td></tr></table></figure>

<h3 id="将封套在-X，Y-周围居中"><a href="#将封套在-X，Y-周围居中" class="headerlink" title="将封套在 X，Y 周围居中"></a>将封套在 X，Y 周围居中</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">5.0</span>, <span class="number">5.0</span>);</span><br><span class="line">Envelope centered = GeometryEngine.Instance.CenterAt(env, <span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// centered.Center.X = 2.0</span></span><br><span class="line"><span class="comment">// centered.Center.Y = 2.0</span></span><br><span class="line"><span class="comment">// centered.XMin = 0</span></span><br><span class="line"><span class="comment">// centered.YMin = 0</span></span><br><span class="line"><span class="comment">// centered.XMax = 4</span></span><br><span class="line"><span class="comment">// centered.YMax = 4</span></span><br><span class="line"></span><br><span class="line">centered = env.CenterAt(<span class="number">4.0</span>, <span class="number">3.0</span>);</span><br><span class="line"><span class="comment">// centered.Center.X == 4.0</span></span><br><span class="line"><span class="comment">// centered.Center.Y == 3.0</span></span><br><span class="line"><span class="comment">// centered.XMin == 2.0</span></span><br><span class="line"><span class="comment">// centered.YMin == 1.0</span></span><br><span class="line"><span class="comment">// centered.XMax == 6.0</span></span><br><span class="line"><span class="comment">// centered.YMax == 5.0</span></span><br></pre></td></tr></table></figure>

<h3 id="查找几何体的质心"><a href="#查找几何体的质心" class="headerlink" title="查找几何体的质心"></a>查找几何体的质心</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// simple polygon</span></span><br><span class="line">List&lt;Coordinate2D&gt; list2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">2</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list2D, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// verify it is simple</span></span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polygon);</span><br><span class="line"><span class="comment">// find the centroid</span></span><br><span class="line">MapPoint centroid = GeometryEngine.Instance.Centroid(polygon);</span><br><span class="line"><span class="comment">// centroid.X = 1</span></span><br><span class="line"><span class="comment">// centroid.Y = 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// map Point</span></span><br><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">2</span>, <span class="built_in">double</span>.NaN, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// pt1.HasZ = true</span></span><br><span class="line"><span class="comment">// pt1.HasM = true</span></span><br><span class="line">centroid = GeometryEngine.Instance.Centroid(pt1);</span><br><span class="line"><span class="comment">// centroid.HasZ = true</span></span><br><span class="line"><span class="comment">// centroid.HasM = true</span></span><br><span class="line"><span class="comment">// pt1.IsEqual(centroid) = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// multipoint</span></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt1, pt2 &#125;;</span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(list);</span><br><span class="line"><span class="comment">// multipoint.HasZ = true</span></span><br><span class="line"><span class="comment">// multipoint.HasM = true</span></span><br><span class="line"></span><br><span class="line">centroid = GeometryEngine.Instance.Centroid(multipoint);</span><br><span class="line"><span class="comment">// centroid.X = 3</span></span><br><span class="line"><span class="comment">// centroid.Y = 2</span></span><br><span class="line"><span class="comment">// centroid.HasZ = false</span></span><br><span class="line"><span class="comment">// centroid.HasM = false</span></span><br></pre></td></tr></table></figure>

<h3 id="剪裁折线"><a href="#剪裁折线" class="headerlink" title="剪裁折线"></a>剪裁折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// clip a polyline by an envelope</span></span><br><span class="line"></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">4.0</span>, <span class="number">4.0</span>);</span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">3</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"></span><br><span class="line">Geometry clipGeom = GeometryEngine.Instance.Clip(polyline, env);</span><br></pre></td></tr></table></figure>

<h3 id="按多边形裁剪折线"><a href="#按多边形裁剪折线" class="headerlink" title="按多边形裁剪折线"></a>按多边形裁剪折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// clip a polyline by a polygon</span></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; list = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">list.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">4.0</span>));</span><br><span class="line">list.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">4.0</span>));</span><br><span class="line">list.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">LineSegment crossingLine = LineBuilderEx.CreateLineSegment(MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">3</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line">Polyline p = PolylineBuilderEx.CreatePolyline(crossingLine);</span><br><span class="line">Geometry geometry = GeometryEngine.Instance.Clip(p, polygon.Extent);</span><br></pre></td></tr></table></figure>

<h3 id="构建具有指定距离和方位角的大地测量线"><a href="#构建具有指定距离和方位角的大地测量线" class="headerlink" title="构建具有指定距离和方位角的大地测量线"></a>构建具有指定距离和方位角的大地测量线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sr = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>);</span><br><span class="line"><span class="keyword">var</span> mapPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">15</span>, <span class="number">60</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// calculate</span></span><br><span class="line"><span class="keyword">var</span> polylineGeodetic = GeometryEngine.Instance.ConstructGeodeticLineFromDistance(GeodeticCurveType.Loxodrome, mapPoint, <span class="number">5000000</span>, <span class="number">45</span>, <span class="literal">null</span>, CurveDensifyMethod.ByLength, <span class="number">300000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="构建连接点的大地测量线"><a href="#构建连接点的大地测量线" class="headerlink" title="构建连接点的大地测量线"></a>构建连接点的大地测量线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sr = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">4326</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">60</span>, <span class="number">180</span>, sr);</span><br><span class="line"><span class="keyword">var</span> pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">60</span>, <span class="number">0</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// densify by length</span></span><br><span class="line"><span class="keyword">var</span> gl = GeometryEngine.Instance.ConstructGeodeticLineFromPoints(GeodeticCurveType.Geodesic, pt1, pt2, <span class="literal">null</span>, CurveDensifyMethod.ByLength, <span class="number">-3.356</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// densify by deviation</span></span><br><span class="line">gl = GeometryEngine.Instance.ConstructGeodeticLineFromPoints(GeodeticCurveType.Geodesic, pt1, pt2, <span class="literal">null</span>, CurveDensifyMethod.ByDeviation, <span class="number">-0.0026</span>);</span><br></pre></td></tr></table></figure>

<h3 id="在距现有点一定距离和一定角度处构造点"><a href="#在距现有点一定距离和一定角度处构造点" class="headerlink" title="在距现有点一定距离和一定角度处构造点"></a>在距现有点一定距离和一定角度处构造点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MapPoint inPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">double</span> angle = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">double</span> distance = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">MapPoint outPoint = GeometryEngine.Instance.ConstructPointFromAngleDistance(inPoint, angle, distance);</span><br><span class="line"><span class="comment">// outPoint.X = 13</span></span><br><span class="line"><span class="comment">// outPoint.Y = 4</span></span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line">inPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, sr);</span><br><span class="line">angle = Math.PI;</span><br><span class="line">distance = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">outPoint = GeometryEngine.Instance.ConstructPointFromAngleDistance(inPoint, angle, distance, sr);</span><br><span class="line"><span class="comment">// outPoint.X = -1</span></span><br><span class="line"><span class="comment">// outPoint.Y = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="从一组折线构造多边形"><a href="#从一组折线构造多边形" class="headerlink" title="从一组折线构造多边形"></a>从一组折线构造多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; firstLinePts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">firstLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">firstLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">4.0</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; secondLinePts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">secondLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">4.0</span>));</span><br><span class="line">secondLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; thirdLinePts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">thirdLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.0</span>, <span class="number">2.0</span>));</span><br><span class="line">thirdLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; fourthLinePts = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">fourthLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.0</span>, <span class="number">3.0</span>));</span><br><span class="line">fourthLinePts.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// build the polylines</span></span><br><span class="line">List&lt;Polyline&gt; polylines = <span class="keyword">new</span> List&lt;Polyline&gt;();</span><br><span class="line">polylines.Add(PolylineBuilderEx.CreatePolyline(firstLinePts));</span><br><span class="line">polylines.Add(PolylineBuilderEx.CreatePolyline(secondLinePts));</span><br><span class="line">polylines.Add(PolylineBuilderEx.CreatePolyline(thirdLinePts));</span><br><span class="line">polylines.Add(PolylineBuilderEx.CreatePolyline(fourthLinePts));</span><br><span class="line"></span><br><span class="line"><span class="comment">// construct polygons from the polylines</span></span><br><span class="line"><span class="keyword">var</span> polygons = GeometryEngine.Instance.ConstructPolygonsFromPolylines(polylines);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygons.Count = 1</span></span><br><span class="line"><span class="comment">// polygon coordinates are (1.0, 2.0), (1.0, 3.0), (4.0, 3.0), (4.0, 2.0)</span></span><br></pre></td></tr></table></figure>

<h3 id="多边形包含地图点、折线、多边形"><a href="#多边形包含地图点、折线、多边形" class="headerlink" title="多边形包含地图点、折线、多边形"></a>多边形包含地图点、折线、多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build a polygon      </span></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(pts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// test if an inner point is contained</span></span><br><span class="line">MapPoint innerPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line"><span class="built_in">bool</span> contains = GeometryEngine.Instance.Contains(poly, innerPt);   <span class="comment">// contains = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test a point on a boundary</span></span><br><span class="line">contains = GeometryEngine.Instance.Contains(poly, poly.Points[<span class="number">0</span>]);     <span class="comment">// contains = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test an interior line</span></span><br><span class="line">MapPoint innerPt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.25</span>, <span class="number">1.75</span>);</span><br><span class="line">List&lt;MapPoint&gt; innerLinePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">innerLinePts.Add(innerPt);</span><br><span class="line">innerLinePts.Add(innerPt2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// test an inner polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(innerLinePts);</span><br><span class="line">contains = GeometryEngine.Instance.Contains(poly, polyline);   <span class="comment">// contains = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test a line that crosses the boundary</span></span><br><span class="line">MapPoint outerPt = MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">1.5</span>);</span><br><span class="line">List&lt;MapPoint&gt; crossingLinePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">crossingLinePts.Add(innerPt);</span><br><span class="line">crossingLinePts.Add(outerPt);</span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(crossingLinePts);</span><br><span class="line">contains = GeometryEngine.Instance.Contains(poly, polyline);     <span class="comment">// contains = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test a polygon in polygon</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(innerPt, innerPt2);</span><br><span class="line">contains = GeometryEngine.Instance.Contains(poly, env);      <span class="comment">// contains = true</span></span><br></pre></td></tr></table></figure>

<h3 id="确定凸包"><a href="#确定凸包" class="headerlink" title="确定凸包"></a>确定凸包</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// convex hull around a point - returns a point</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line">Geometry hull = GeometryEngine.Instance.ConvexHull(pt);</span><br><span class="line">MapPoint hullPt = hull <span class="keyword">as</span> MapPoint;</span><br><span class="line"><span class="comment">// nullPt.X = 2</span></span><br><span class="line"><span class="comment">// hullPt.Y = 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// convex hull around a multipoint - returns a polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// build a multiPoint</span></span><br><span class="line">Multipoint multiPoint = MultipointBuilderEx.CreateMultipoint(list);</span><br><span class="line"></span><br><span class="line">hull = GeometryEngine.Instance.ConvexHull(multiPoint);</span><br><span class="line">Polygon hullPoly = hull <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// hullPoly.Area = 1</span></span><br><span class="line"><span class="comment">// hullPoly.PointCount = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// convex hull around a line - returns a polyline or polygon</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; polylineList = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polylineList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">polylineList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 point straight line</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(polylineList);</span><br><span class="line">hull = GeometryEngine.Instance.ConvexHull(polyline);</span><br><span class="line">Polyline hullPolyline = hull <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// hullPolyline.Length = Math.Sqrt(2)</span></span><br><span class="line"><span class="comment">// hullPolyline.PointCount = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3 point angular line</span></span><br><span class="line">polylineList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(polylineList);</span><br><span class="line">hull = GeometryEngine.Instance.ConvexHull(polyline);</span><br><span class="line">hullPoly = hull <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// hullPoly.Length = 2 + Math.Sqrt(2)</span></span><br><span class="line"><span class="comment">// hullPoly.Area = 0.5</span></span><br><span class="line"><span class="comment">// hullPoly.PointCount = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// convex hull around a polygon - returns a polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// simple polygon</span></span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(list);</span><br><span class="line">hull = GeometryEngine.Instance.ConvexHull(poly);</span><br><span class="line">hullPoly = hull <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hullPoly.Length = 4.0</span></span><br><span class="line"><span class="comment">// hullPoly.Area = 1.0</span></span><br><span class="line"><span class="comment">// hullPoly.PointCount = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon with concave angles</span></span><br><span class="line">List&lt;MapPoint&gt; funkyList = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line">funkyList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon funkyPoly = PolygonBuilderEx.CreatePolygon(funkyList);</span><br><span class="line">hull = GeometryEngine.Instance.ConvexHull(funkyPoly);</span><br><span class="line">hullPoly = hull <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// hullPoly.Length = 4.0</span></span><br><span class="line"><span class="comment">// hullPoly.Area = 1.0</span></span><br><span class="line"><span class="comment">// hullPoly.PointCount = 5</span></span><br><span class="line"><span class="comment">// hullPoly.Points[0] = 1.0, 1.0</span></span><br><span class="line"><span class="comment">// hullPoly.Points[1] = 1.0, 2.0</span></span><br><span class="line"><span class="comment">// hullPoly.Points[2] = 2.0, 2.0</span></span><br><span class="line"><span class="comment">// hullPoly.Points[3] = 2.0, 1.0</span></span><br><span class="line"><span class="comment">// hullPoly.Points[4] = 1.0, 1.0</span></span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何图形是否相交"><a href="#确定两个几何图形是否相交" class="headerlink" title="确定两个几何图形是否相交"></a>确定两个几何图形是否相交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt on pt</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> crosses = GeometryEngine.Instance.Crosses(pt, pt2);         <span class="comment">// crosses = false</span></span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(pt, pt);               <span class="comment">// crosses = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// pt and line</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line1 = PolylineBuilderEx.CreatePolyline(list);</span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(line1, pt2);           <span class="comment">// crosses = false</span></span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(pt2, line1);           <span class="comment">// crosses = false</span></span><br><span class="line">                                                                 <span class="comment">// end pt of line</span></span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(line1, pt);            <span class="comment">// crosses = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; polyPts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">2.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(polyPts);</span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(poly1, pt);              <span class="comment">// crosses = false</span></span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(pt, poly1);              <span class="comment">// crosses = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// line and line</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; list2 = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line2 = PolylineBuilderEx.CreatePolyline(list2);</span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(line1, line2);           <span class="comment">// crosses = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// line and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(poly1, line1);           <span class="comment">// crosses = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// polygon and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">4</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line">crosses = GeometryEngine.Instance.Crosses(poly1, poly2);           <span class="comment">// crosses = false</span></span><br></pre></td></tr></table></figure>

<h3 id="使用折线切割几何图形"><a href="#使用折线切割几何图形" class="headerlink" title="使用折线切割几何图形"></a>使用折线切割几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, sr));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">4.0</span>, sr));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">4.0</span>, sr));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">1.0</span>, sr));</span><br><span class="line"></span><br><span class="line">List&lt;Geometry&gt; cutGeometries;</span><br><span class="line"></span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, sr), MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">6</span>, sr));</span><br><span class="line">Polyline cutter = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(list);</span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polyline);</span><br><span class="line">cutGeometries = GeometryEngine.Instance.Cut(polyline, cutter) <span class="keyword">as</span> List&lt;Geometry&gt;;</span><br><span class="line"></span><br><span class="line">Polyline leftPolyline = cutGeometries[<span class="number">0</span>] <span class="keyword">as</span> Polyline;</span><br><span class="line">Polyline rightPolyline = cutGeometries[<span class="number">1</span>] <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"><span class="comment">// leftPolyline.Points[0] = 1, 2</span></span><br><span class="line"><span class="comment">// leftPolyline.Points[1] = 1, 4</span></span><br><span class="line"><span class="comment">// leftPolyline.Points[2] = 2, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rightPolyline.Points.Count = 5</span></span><br><span class="line"><span class="comment">// rightPolyline.Parts.Count = 2</span></span><br><span class="line"></span><br><span class="line">ReadOnlySegmentCollection segments0 = rightPolyline.Parts[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// segments0[0].StartCoordinate = 1, 1</span></span><br><span class="line"><span class="comment">// segments0[0].EndCoordinate = 1, 2</span></span><br><span class="line"></span><br><span class="line">ReadOnlySegmentCollection segments1 = rightPolyline.Parts[<span class="number">1</span>];</span><br><span class="line"><span class="comment">// segments1.Count = 2</span></span><br><span class="line"><span class="comment">// segments1[0].StartCoordinate = 2, 4</span></span><br><span class="line"><span class="comment">// segments1[0].EndCoordinate = 4, 4</span></span><br><span class="line"><span class="comment">// segments1[1].StartCoordinate = 4, 4</span></span><br><span class="line"><span class="comment">// segments1[1].EndCoordinate = 4, 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon </span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list);</span><br><span class="line">isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polygon);</span><br><span class="line">cutGeometries = GeometryEngine.Instance.Cut(polygon, cutter) <span class="keyword">as</span> List&lt;Geometry&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="按长度致密"><a href="#按长度致密" class="headerlink" title="按长度致密"></a>按长度致密</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// densify a line segment</span></span><br><span class="line">MapPoint startPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint endPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">21</span>);</span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(startPt, endPt);</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"></span><br><span class="line">Geometry geom = GeometryEngine.Instance.DensifyByLength(polyline, <span class="number">2</span>);</span><br><span class="line">Polyline result = geom <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// densify a circular arc</span></span><br><span class="line">MapPoint fromPt = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint toPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Coordinate2D interiorPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>, <span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">EllipticArcBuilderEx cab = <span class="keyword">new</span> EllipticArcBuilderEx(fromPt, toPt, interiorPt);</span><br><span class="line">EllipticArcSegment circularArc = cab.ToSegment();</span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(circularArc);</span><br><span class="line">geom = GeometryEngine.Instance.DensifyByLength(polyline, <span class="number">2</span>);</span><br><span class="line">result = geom <span class="keyword">as</span> Polyline;</span><br></pre></td></tr></table></figure>

<h3 id="两个多边形之间的差异"><a href="#两个多边形之间的差异" class="headerlink" title="两个多边形之间的差异"></a>两个多边形之间的差异</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; polyPts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">2.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(polyPts);</span><br><span class="line"></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">4</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line"></span><br><span class="line">Geometry result = GeometryEngine.Instance.Difference(poly1, poly2);</span><br><span class="line">Polygon polyResult = result <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// polyResult.Area = 10.0</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.Difference(poly2, poly1);</span><br><span class="line">polyResult = result <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// polyResult.Area = 7.0</span></span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何是否不相交"><a href="#确定两个几何是否不相交" class="headerlink" title="确定两个几何是否不相交"></a>确定两个几何是否不相交</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt on pt</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> disjoint = GeometryEngine.Instance.Disjoint(pt, pt2);       <span class="comment">// result is true</span></span><br><span class="line"></span><br><span class="line">MultipointBuilderEx mpb = <span class="keyword">new</span> MultipointBuilderEx();</span><br><span class="line">mpb.AddPoint(pt);</span><br><span class="line">mpb.AddPoint(pt2);</span><br><span class="line">Multipoint multiPoint = mpb.ToGeometry();</span><br><span class="line"></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(multiPoint, pt);     <span class="comment">// result is false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// pt and line</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line1 = PolylineBuilderEx.CreatePolyline(list);</span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(line1, pt2);       <span class="comment">// result is true</span></span><br><span class="line"></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(pt2, line1);       <span class="comment">// result is true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// end pt of line</span></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(line1, pt);        <span class="comment">// result is false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; polyPts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">2.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(polyPts);</span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(poly1, pt);          <span class="comment">// result is true</span></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(pt, poly1);          <span class="comment">// result is true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// line and line</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list2 = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line2 = PolylineBuilderEx.CreatePolyline(list2);</span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(line1, line2);         <span class="comment">// result is false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// line and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(poly1, line1);         <span class="comment">// result is false</span></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(line1, poly1);         <span class="comment">// result is false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// polygon and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">4</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line"></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint(poly1, poly2);         <span class="comment">// result is false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// disjoint3D</span></span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">MapPoint pt3D_1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, sr);</span><br><span class="line">MapPoint pt3D_2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, sr);</span><br><span class="line">MapPoint pt3D_3 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, sr);</span><br><span class="line"></span><br><span class="line">MultipointBuilderEx mpbEx = <span class="keyword">new</span> MultipointBuilderEx();</span><br><span class="line">mpbEx.AddPoint(pt3D_1);</span><br><span class="line">mpbEx.AddPoint(pt3D_2);</span><br><span class="line">mpbEx.HasZ = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">multiPoint = mpbEx.ToGeometry();</span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint3D(multiPoint, pt3D_2);     <span class="comment">// disjoint = false</span></span><br><span class="line">disjoint = GeometryEngine.Instance.Disjoint3D(multiPoint, pt3D_3);     <span class="comment">// disjoint = true</span></span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何之间的距离"><a href="#确定两个几何之间的距离" class="headerlink" title="确定两个几何之间的距离"></a>确定两个几何之间的距离</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>);</span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and pt </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">double</span> d = GeometryEngine.Instance.Distance(pt1, pt2);         <span class="comment">// d = Math.Sqrt(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and multipoint</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; multiPts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">multiPts.Add(pt2);</span><br><span class="line">multiPts.Add(pt3);</span><br><span class="line">Multipoint multiPoint = MultipointBuilderEx.CreateMultipoint(multiPts);</span><br><span class="line">d = GeometryEngine.Instance.Distance(pt1, multiPoint);         <span class="comment">// d = Math.Sqrt(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and envelope</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(pt1, pt2);</span><br><span class="line">d = GeometryEngine.Instance.Distance(pt1, env);                <span class="comment">// d = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and polyline</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; polylinePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polylinePts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line">polylinePts.Add(pt2);</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(polylinePts);</span><br><span class="line"></span><br><span class="line">d = GeometryEngine.Instance.Distance(pt1, polyline);             <span class="comment">// d = 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Envelope env2 = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">5.0</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(env2);</span><br><span class="line">d = GeometryEngine.Instance.Distance(pt1, poly);                 <span class="comment">// d = Math.Sqrt(8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// envelope and polyline</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">d = GeometryEngine.Instance.Distance(env, polyline);             <span class="comment">// d = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// polyline and polyline</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; polylineList = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polylineList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">3</span>));</span><br><span class="line">polylineList.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">4</span>));</span><br><span class="line">Polyline polyline2 = PolylineBuilderEx.CreatePolyline(polylineList);</span><br><span class="line"></span><br><span class="line">d = GeometryEngine.Instance.Distance(polyline, polyline2);           <span class="comment">// d = Math.Sqrt(5)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// polygon and polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line">d = GeometryEngine.Instance.Distance(poly, poly2);                 <span class="comment">// d = Math.Sqrt(2)</span></span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何体之间的-3D-距离"><a href="#确定两个几何体之间的-3D-距离" class="headerlink" title="确定两个几何体之间的 3D 距离"></a>确定两个几何体之间的 3D 距离</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// between points </span></span><br><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// pt1 to pt2</span></span><br><span class="line"><span class="built_in">double</span> d = GeometryEngine.Instance.Distance3D(pt1, pt2);        <span class="comment">// d = Math.Sqrt(3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pt1 to pt3</span></span><br><span class="line">d = GeometryEngine.Instance.Distance3D(pt1, pt3);        <span class="comment">// d = Math.Sqrt(82)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pt2 to pt3</span></span><br><span class="line">d = GeometryEngine.Instance.Distance3D(pt2, pt3);        <span class="comment">// d = Math.Sqrt(65)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// intersecting lines</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line1 = PolylineBuilderEx.CreatePolyline(list);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; list2 = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line2 = PolylineBuilderEx.CreatePolyline(list2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> intersects = GeometryEngine.Instance.Intersects(line1, line2);    <span class="comment">// intersects = true</span></span><br><span class="line">d = GeometryEngine.Instance.Distance3D(line1, line2);                  <span class="comment">// d = 0   (distance is 0 when geomtries intersect)</span></span><br></pre></td></tr></table></figure>

<h3 id="展开信封-1"><a href="#展开信封-1" class="headerlink" title="展开信封"></a>展开信封</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(<span class="number">100.0</span>, <span class="number">100.0</span>, <span class="number">500.0</span>, <span class="number">500.0</span>);</span><br><span class="line"><span class="comment">// env.HasZ = false</span></span><br><span class="line"></span><br><span class="line">Envelope result = GeometryEngine.Instance.Expand(env, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// result.Center = 300, 300</span></span><br><span class="line"><span class="comment">// result.XMin = 200</span></span><br><span class="line"><span class="comment">// result.YMin = 200</span></span><br><span class="line"><span class="comment">// result.XMax = 400</span></span><br><span class="line"><span class="comment">// result.YMax = 400</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.Expand(env, <span class="number">100</span>, <span class="number">200</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// result.Center = 300, 300</span></span><br><span class="line"><span class="comment">// result.XMin = 0</span></span><br><span class="line"><span class="comment">// result.YMin = -100</span></span><br><span class="line"><span class="comment">// result.XMax = 600</span></span><br><span class="line"><span class="comment">// result.YMax = 700</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// expand in 3 dimensions</span></span><br><span class="line">  result = GeometryEngine.Instance.Expand(env, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (InvalidOperationException e)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// the geometry is not Z-Aware</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// expand a 3d envelope</span></span><br><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">200</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">env = EnvelopeBuilderEx.CreateEnvelope(pt1, pt2);</span><br><span class="line"><span class="comment">// env.HasZ = true</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.Expand(env, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// result.Center = 150, 150, 150</span></span><br><span class="line"><span class="comment">// result.XMin = 125</span></span><br><span class="line"><span class="comment">// result.YMin = 125</span></span><br><span class="line"><span class="comment">// result.ZMin = 125</span></span><br><span class="line"><span class="comment">// result.XMax = 175</span></span><br><span class="line"><span class="comment">// result.YMax = 175</span></span><br><span class="line"><span class="comment">// result.ZMax = 175</span></span><br></pre></td></tr></table></figure>

<h3 id="扩展折线"><a href="#扩展折线" class="headerlink" title="扩展折线"></a>扩展折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build a polyline</span></span><br><span class="line"><span class="keyword">var</span> polyline = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// build the extender line</span></span><br><span class="line"><span class="keyword">var</span> extender = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">-2</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extend</span></span><br><span class="line"><span class="keyword">var</span> result = GeometryEngine.Instance.Extend(polyline, extender, ExtendFlags.KeepEndAttributes);</span><br><span class="line">Polyline extendedLine = result <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// result.Parts[0].Points[0] = 2, 2, 10, 20</span></span><br><span class="line"><span class="comment">// result.parts[0].Points[1] = 1, 1, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[2] = 0, 0, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[3] = 1, -1, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[4] = 2, -2, 10, 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// change the flags</span></span><br><span class="line">result = GeometryEngine.Instance.Extend(polyline, extender, ExtendFlags.NoEndAttributes);</span><br><span class="line">extendedLine = result <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// result.Parts[0].Points[0] = 2, 2, 0</span></span><br><span class="line"><span class="comment">// result.parts[0].Points[1] = 1, 1, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[2] = 0, 0, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[3] = 1, -1, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[4] = 2, -2, 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// extend</span></span><br><span class="line">result = GeometryEngine.Instance.Extend(polyline, extender, ExtendFlags.KeepEndAttributes | ExtendFlags.NoExtendAtTo);</span><br><span class="line">extendedLine = result <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// result.Parts[0].Points[0] = 2, 2, 10, 20</span></span><br><span class="line"><span class="comment">// result.parts[0].Points[1] = 1, 1, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[2] = 0, 0, 10, 20</span></span><br><span class="line"><span class="comment">// result.Parts[0].Points[3] = 1, -1, 10, 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// extend with no intersection </span></span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">extender = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.Extend(polyline, extender, ExtendFlags.Default);</span><br><span class="line"><span class="comment">// result = null</span></span><br></pre></td></tr></table></figure>

<h3 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Polyline generalizedPolyline = GeometryEngine.Instance.Generalize(polylineWithZ, <span class="number">200</span>) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// generalizedPolyline.HasZ = true</span></span><br><span class="line"></span><br><span class="line">Polygon generalized3DPolyline = GeometryEngine.Instance.Generalize3D(polylineWithZ, <span class="number">200</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// generalized3DPolyline.HasZ = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// note that generalized3DPolyline and generalizedPolyline will have different definitions</span></span><br><span class="line"><span class="comment">//  ie generalizedPolyline.IsEqual(generalized3DPolyline) = false</span></span><br></pre></td></tr></table></figure>

<h3 id="计算面的测地线面积"><a href="#计算面的测地线面积" class="headerlink" title="计算面的测地线面积"></a>计算面的测地线面积</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> polygon = PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-10018754.1713946</span>, <span class="number">10018754.1713946</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">10018754.1713946</span>, <span class="number">10018754.1713946</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">10018754.1713946</span>, <span class="number">-10018754.1713946</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-10018754.1713946</span>, <span class="number">-10018754.1713946</span>)</span><br><span class="line">&#125;, SpatialReferences.WebMercator);</span><br><span class="line"><span class="keyword">var</span> area = GeometryEngine.Instance.GeodesicArea(polygon);</span><br><span class="line"></span><br><span class="line"><span class="comment">// area is close to 255032810857732.31</span></span><br><span class="line"></span><br><span class="line">area = GeometryEngine.Instance.GeodesicArea(polygon, AreaUnit.SquareKilometers);</span><br><span class="line"><span class="comment">// area is close to 255032810.85953, </span></span><br></pre></td></tr></table></figure>

<h3 id="在指定的测地线距离处创建缓冲区面"><a href="#在指定的测地线距离处创建缓冲区面" class="headerlink" title="在指定的测地线距离处创建缓冲区面"></a>在指定的测地线距离处创建缓冲区面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buffer a point</span></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84);</span><br><span class="line">Polygon outPolygon = GeometryEngine.Instance.GeodesicBuffer(pt, <span class="number">5</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> delta = SpatialReferences.WGS84.XYTolerance * <span class="number">2</span> * Math.Sqrt(<span class="number">2</span>);</span><br><span class="line">ReadOnlyPointCollection points = outPolygon.Points;</span><br><span class="line"><span class="keyword">foreach</span> (MapPoint p <span class="keyword">in</span> points)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">double</span> d = GeometryEngine.Instance.GeodesicDistance(pt, p);</span><br><span class="line">  <span class="comment">// d = 5 (+- delta)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// specify a unit for the distance</span></span><br><span class="line">outPolygon = GeometryEngine.Instance.GeodesicBuffer(pt, <span class="number">5000</span>, LinearUnit.Millimeters) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buffer of 0 distance produces an empty geometry</span></span><br><span class="line">Geometry g = GeometryEngine.Instance.GeodesicBuffer(pt, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// g.IsEmpty = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// buffer many points</span></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">10.0</span>, <span class="number">20.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">40.0</span>, <span class="number">40.0</span>));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">60.0</span>, <span class="number">60.0</span>));</span><br><span class="line"></span><br><span class="line">outPolygon = GeometryEngine.Instance.GeodesicBuffer(list, <span class="number">10000</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// outPolygon.PartCount = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// buffer different geometry types</span></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">20</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">20</span>, <span class="number">30</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">50</span>, <span class="number">60</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">70</span>, <span class="number">80</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">80</span>, <span class="number">40</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">90</span>, <span class="number">10</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">110</span>, <span class="number">15</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">120</span>, <span class="number">30</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">40</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">40</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">50</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">List&lt;Geometry&gt; manyGeometries = <span class="keyword">new</span> List&lt;Geometry&gt;</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84),</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">0</span>], coords[<span class="number">1</span>], coords[<span class="number">2</span>]&#125;, SpatialReferences.WGS84),</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">3</span>], coords[<span class="number">4</span>], coords[<span class="number">5</span>]&#125;),</span><br><span class="line">  PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">9</span>], coords[<span class="number">10</span>], coords[<span class="number">11</span>]&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">outPolygon = GeometryEngine.Instance.GeodesicBuffer(manyGeometries, <span class="number">20000</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// specify unit types</span></span><br><span class="line">outPolygon = GeometryEngine.Instance.GeodesicBuffer(manyGeometries, <span class="number">20</span>, LinearUnit.Miles) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何之间的测地线距离"><a href="#确定两个几何之间的测地线距离" class="headerlink" title="确定两个几何之间的测地线距离"></a>确定两个几何之间的测地线距离</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> point1 = MapPointBuilderEx.CreateMapPoint(<span class="number">-170</span>, <span class="number">45</span>, SpatialReferences.WGS84);</span><br><span class="line"><span class="keyword">var</span> point2 = MapPointBuilderEx.CreateMapPoint(<span class="number">170</span>, <span class="number">45</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> distances_meters = GeometryEngine.Instance.GeodesicDistance(point1, point2);</span><br><span class="line"><span class="comment">// distance is approximately 1572912.2066940258 in meters</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> distance_feet = GeometryEngine.Instance.GeodesicDistance(point1, point2, LinearUnit.Feet);</span><br><span class="line"><span class="comment">// distance is approximately  5160473.11904786 in feet</span></span><br></pre></td></tr></table></figure>

<h3 id="测地线椭圆"><a href="#测地线椭圆" class="headerlink" title="测地线椭圆"></a>测地线椭圆</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GeodesicEllipseParameter param = <span class="keyword">new</span> GeodesicEllipseParameter();</span><br><span class="line">param.AxisDirection = <span class="number">4</span> * Math.PI / <span class="number">3</span>;</span><br><span class="line">param.Center = <span class="keyword">new</span> Coordinate2D(<span class="number">-120</span>, <span class="number">60</span>);</span><br><span class="line">param.LinearUnit = LinearUnit.Meters;</span><br><span class="line">param.OutGeometryType = GeometryType.Polyline;</span><br><span class="line">param.SemiAxis1Length = <span class="number">6500000</span>;</span><br><span class="line">param.SemiAxis2Length = <span class="number">1500000</span>;</span><br><span class="line">param.VertexCount = <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line">Geometry geometry = GeometryEngine.Instance.GeodesicEllipse(param, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">// geometry.IsEmpty = false</span></span><br><span class="line"></span><br><span class="line">Polyline polyline = geometry <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// polyline.PointCount = 801</span></span><br><span class="line"><span class="comment">// polyline.PartCount = 1</span></span><br></pre></td></tr></table></figure>

<h3 id="确定线的测地线长度"><a href="#确定线的测地线长度" class="headerlink" title="确定线的测地线长度"></a>确定线的测地线长度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> polyline = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint(<span class="number">-10018754.1713946</span>, <span class="number">10018754.1713946</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint(<span class="number">10018754.1713946</span>, <span class="number">10018754.1713946</span>)</span><br><span class="line">&#125;, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> length = GeometryEngine.Instance.GeodesicLength(polyline);</span><br><span class="line"><span class="comment">// length is approx 5243784.5551844323 in meters</span></span><br><span class="line"></span><br><span class="line">length = GeometryEngine.Instance.GeodesicLength(polyline, LinearUnit.Miles);</span><br><span class="line"><span class="comment">// length is approx 3258.33666089067 in miles</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> polyline2 = GeometryEngine.Instance.Project(polyline, SpatialReferences.WGS84);</span><br><span class="line">length = GeometryEngine.Instance.GeodesicLength(polyline2);</span><br><span class="line"><span class="comment">// length is approx 5243784.55518443 in meters after projecting</span></span><br></pre></td></tr></table></figure>

<h3 id="测地线扇区"><a href="#测地线扇区" class="headerlink" title="测地线扇区"></a>测地线扇区</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GeodesicSectorParameter param = <span class="keyword">new</span> GeodesicSectorParameter();</span><br><span class="line">param.ArcVertexCount = <span class="number">50</span>;</span><br><span class="line">param.AxisDirection = Math.PI / <span class="number">4</span>;</span><br><span class="line">param.Center = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">param.LinearUnit = LinearUnit.Meters;</span><br><span class="line">param.OutGeometryType = GeometryType.Polygon;</span><br><span class="line">param.RadiusVertexCount = <span class="number">10</span>;</span><br><span class="line">param.SectorAngle = <span class="number">5</span> * Math.PI / <span class="number">3</span>;</span><br><span class="line">param.SemiAxis1Length = <span class="number">100000</span>;</span><br><span class="line">param.SemiAxis2Length = <span class="number">20000</span>;</span><br><span class="line">param.StartDirection = <span class="number">11</span> * Math.PI / <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">Geometry geometry = GeometryEngine.Instance.GeodesicSector(param, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">// geometry.IsEmpty = false</span></span><br><span class="line"></span><br><span class="line">Polygon polygon = geometry <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// polygon.PointCount = 68</span></span><br><span class="line"><span class="comment">// polygon.PartCount = 1</span></span><br></pre></td></tr></table></figure>

<h3 id="大地测量致密化偏差-折线"><a href="#大地测量致密化偏差-折线" class="headerlink" title="大地测量致密化偏差 - 折线"></a>大地测量致密化偏差 - 折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-80</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-20</span>, <span class="number">60</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">40</span>, <span class="number">20</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-20</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-80</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// densify in km</span></span><br><span class="line">Polyline geodesicPolyline = GeometryEngine.Instance.GeodeticDensifyByDeviation(polyline, <span class="number">200</span>, LinearUnit.Kilometers, GeodeticCurveType.Geodesic) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// densify in m</span></span><br><span class="line">geodesicPolyline = GeometryEngine.Instance.GeodeticDensifyByDeviation(polyline, <span class="number">200</span>, LinearUnit.Meters, GeodeticCurveType.Geodesic) <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Change curve type to Loxodrome</span></span><br><span class="line">Polyline loxodromePolyline = GeometryEngine.Instance.GeodeticDensifyByDeviation(polyline, <span class="number">200</span>, LinearUnit.Meters, GeodeticCurveType.Loxodrome) <span class="keyword">as</span> Polyline;</span><br></pre></td></tr></table></figure>

<h3 id="大地测量致密按长度-多边形"><a href="#大地测量致密按长度-多边形" class="headerlink" title="大地测量致密按长度 - 多边形"></a>大地测量致密按长度 - 多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-80</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-20</span>, <span class="number">60</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">40</span>, <span class="number">20</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-20</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-80</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a polygon</span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the geodesic lengths of the polygon segments</span></span><br><span class="line">ReadOnlySegmentCollection segments = polygon.Parts[<span class="number">0</span>];</span><br><span class="line">List&lt;Double&gt; geoLengths = <span class="keyword">new</span> List&lt;Double&gt;(segments.Count);</span><br><span class="line"><span class="keyword">foreach</span> (Segment s <span class="keyword">in</span> segments)</span><br><span class="line">&#123;</span><br><span class="line">  Polyline line = PolylineBuilderEx.CreatePolyline(s, sr);</span><br><span class="line">  <span class="built_in">double</span> geoLen = GeometryEngine.Instance.GeodesicLength(line);</span><br><span class="line">  geoLengths.Add(geoLen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// find the max length</span></span><br><span class="line">geoLengths.Sort();</span><br><span class="line"><span class="built_in">double</span> maxLen = geoLengths[geoLengths.Count - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// densify the polygon (in meters)</span></span><br><span class="line">Polygon densifiedPoly = GeometryEngine.Instance.GeodeticDensifyByLength(polygon, maxLen, LinearUnit.Meters, GeodeticCurveType.Geodesic) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// densify the polygon (in km)</span></span><br><span class="line"><span class="built_in">double</span> maxSegmentLength = maxLen / <span class="number">10000</span>;</span><br><span class="line">densifiedPoly = GeometryEngine.Instance.GeodeticDensifyByLength(polygon, maxSegmentLength, LinearUnit.Kilometers, GeodeticCurveType.Geodesic) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="计算大地测量距离，两点之间的方位角"><a href="#计算大地测量距离，两点之间的方位角" class="headerlink" title="计算大地测量距离，两点之间的方位角"></a>计算大地测量距离，两点之间的方位角</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">MapPoint p1 = MapPointBuilderEx.CreateMapPoint(<span class="number">111</span>, <span class="number">55</span>, sr);</span><br><span class="line">MapPoint p2 = MapPointBuilderEx.CreateMapPoint(<span class="number">95.5845</span>, <span class="number">64.2285</span>, sr);</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> distance, az12, az21;</span><br><span class="line"></span><br><span class="line">distance = GeometryEngine.Instance.GeodeticDistanceAndAzimuth(p1, p2, GeodeticCurveType.Geodesic, <span class="keyword">out</span> az12, <span class="keyword">out</span> az21);</span><br><span class="line"><span class="comment">// distance - 1339728.0303777338</span></span><br><span class="line"><span class="comment">// az12 - 326.235780421405</span></span><br><span class="line"><span class="comment">// az21 - 132.87425637913955</span></span><br><span class="line"></span><br><span class="line">distance = GeometryEngine.Instance.GeodeticDistanceAndAzimuth(p1, p2, GeodeticCurveType.Loxodrome, <span class="keyword">out</span> az12, <span class="keyword">out</span> az21);</span><br><span class="line"><span class="comment">// distance - 1342745.9687172563</span></span><br><span class="line"><span class="comment">// az12 - 319.966400332104</span></span><br><span class="line"><span class="comment">// az21- 139.96640033210397</span></span><br><span class="line"></span><br><span class="line">distance = GeometryEngine.Instance.GeodeticDistanceAndAzimuth(p1, p2, GeodeticCurveType.GreatElliptic, <span class="keyword">out</span> az12, <span class="keyword">out</span> az21);</span><br><span class="line"><span class="comment">// distance - 1339728.038837946</span></span><br><span class="line"><span class="comment">// az12 - 326.22479262335418</span></span><br><span class="line"><span class="comment">// az21 - 132.88558894347742</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MapPoint p3 = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, sr);</span><br><span class="line">MapPoint p4 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">0</span>, sr);</span><br><span class="line"></span><br><span class="line">distance = GeometryEngine.Instance.GeodeticDistanceAndAzimuth(p3, p4, GeodeticCurveType.Geodesic, <span class="keyword">out</span> az12, <span class="keyword">out</span> az21);</span><br><span class="line"><span class="comment">// distance - 111319.49079327342</span></span><br><span class="line"><span class="comment">// az12 - 90</span></span><br><span class="line"><span class="comment">// az21 - 270</span></span><br><span class="line"></span><br><span class="line">distance = GeometryEngine.Instance.GeodeticDistanceAndAzimuth(p3, p4, GeodeticCurveType.Geodesic, LinearUnit.Miles, <span class="keyword">out</span> az12, <span class="keyword">out</span> az21);</span><br><span class="line"><span class="comment">// distance - 69.1707247134693</span></span><br><span class="line"><span class="comment">// az12 - 90</span></span><br><span class="line"><span class="comment">// az21 - 270</span></span><br></pre></td></tr></table></figure>

<h3 id="对一组地图点执行大地测量移动"><a href="#对一组地图点执行大地测量移动" class="headerlink" title="对一组地图点执行大地测量移动"></a>对一组地图点执行大地测量移动</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WebMercator;</span><br><span class="line"><span class="keyword">var</span> points = <span class="keyword">new</span>[] &#123; MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, sr) &#125;;</span><br><span class="line"><span class="built_in">double</span> distance = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">double</span> azimuth = Math.PI / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> resultPoints = GeometryEngine.Instance.GeodeticMove(points, sr, distance, LinearUnit.Meters, azimuth, GeodeticCurveType.Geodesic);</span><br><span class="line"></span><br><span class="line"><span class="comment">// resultPoints.First().X = 10</span></span><br><span class="line"><span class="comment">// resultPoints.First().Y = 0</span></span><br><span class="line"><span class="comment">// resultPoints.First().SpatialReference.Wkid = sr.Wkid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Change LinearUnit to Miles</span></span><br><span class="line">resultPoints = GeometryEngine.Instance.GeodeticMove(points, sr, distance, LinearUnit.Miles, azimuth, GeodeticCurveType.Geodesic);</span><br><span class="line"><span class="comment">// resultPoints.First().X = 16093.44</span></span><br><span class="line"><span class="comment">// resultPoints.First().Y = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Change curve type</span></span><br><span class="line">resultPoints = GeometryEngine.Instance.GeodeticMove(points, sr, distance, LinearUnit.Miles, azimuth, GeodeticCurveType.Loxodrome);</span><br><span class="line"><span class="comment">// resultPoints.First().X = 16093.44</span></span><br><span class="line"><span class="comment">// resultPoints.First().Y = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="检索坐标系"><a href="#检索坐标系" class="headerlink" title="检索坐标系"></a>检索坐标系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get all the geographic coordinate systems</span></span><br><span class="line">IReadOnlyList&lt;CoordinateSystemListEntry&gt; gcs_list = GeometryEngine.Instance.GetPredefinedCoordinateSystemList(CoordinateSystemFilter.GeographicCoordinateSystem);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the projected coordinate systems</span></span><br><span class="line">IReadOnlyList&lt;CoordinateSystemListEntry&gt; proj_list = GeometryEngine.Instance.GetPredefinedCoordinateSystemList(CoordinateSystemFilter.ProjectedCoordinateSystem);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the vertical coordinate systems</span></span><br><span class="line">IReadOnlyList&lt;CoordinateSystemListEntry&gt; vert_list = GeometryEngine.Instance.GetPredefinedCoordinateSystemList(CoordinateSystemFilter.VerticalCoordinateSystem);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get geographic and projected coordinate systems</span></span><br><span class="line">IReadOnlyList&lt;CoordinateSystemListEntry&gt; combined_list = GeometryEngine.Instance.GetPredefinedCoordinateSystemList(CoordinateSystemFilter.GeographicCoordinateSystem | CoordinateSystemFilter.ProjectedCoordinateSystem);</span><br><span class="line"></span><br><span class="line"><span class="comment">// investigate one of the entries</span></span><br><span class="line">CoordinateSystemListEntry entry = gcs_list[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">int</span> wkid = entry.Wkid;</span><br><span class="line"><span class="built_in">string</span> category = entry.Category;</span><br><span class="line"><span class="built_in">string</span> name = entry.Name;</span><br></pre></td></tr></table></figure>

<h3 id="检索系统地理变换"><a href="#检索系统地理变换" class="headerlink" title="检索系统地理变换"></a>检索系统地理变换</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a geographic transformation is the definition of how to project from one spatial reference to another</span></span><br><span class="line">IReadOnlyList&lt;GeographicTransformationListEntry&gt; list = GeometryEngine.Instance.GetPredefinedGeographicTransformationList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// a GeographicTransformationListEntry consists of Name, Wkid, the From SpatialReference Wkid, the To SpatialReference Wkid</span></span><br><span class="line">GeographicTransformationListEntry entry = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> fromWkid = entry.FromSRWkid;</span><br><span class="line"><span class="built_in">int</span> toWkid = entry.ToSRWkid;</span><br><span class="line"><span class="built_in">int</span> wkid = entry.Wkid;</span><br><span class="line"><span class="built_in">string</span> name = entry.Name;</span><br></pre></td></tr></table></figure>

<h3 id="获取折线或多边形的子曲线"><a href="#获取折线或多边形的子曲线" class="headerlink" title="获取折线或多边形的子曲线"></a>获取折线或多边形的子曲线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-111</span>, <span class="number">72</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-108</span>, <span class="number">68</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-114</span>, <span class="number">68</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords, sr);</span><br><span class="line"></span><br><span class="line">Polyline subCurve = GeometryEngine.Instance.GetSubCurve(polyline, <span class="number">0</span>, <span class="number">5</span>, AsRatioOrLength.AsLength);</span><br><span class="line"><span class="comment">// subCurve.PartCount = 1</span></span><br><span class="line"><span class="comment">// subCurve.PointCount = 2</span></span><br><span class="line"></span><br><span class="line">ReadOnlyPointCollection points = subCurve.Points;</span><br><span class="line"><span class="comment">// points[0] = -111, 72</span></span><br><span class="line"><span class="comment">// points[1] = -108, 68</span></span><br><span class="line"></span><br><span class="line">subCurve = GeometryEngine.Instance.GetSubCurve(polyline, <span class="number">0</span>, <span class="number">0.5</span>, AsRatioOrLength.AsRatio);</span><br><span class="line"><span class="comment">// subCurve.PointCount = 3</span></span><br><span class="line"></span><br><span class="line">points = subCurve.Points;</span><br><span class="line"><span class="comment">// points[0] = -111, 72</span></span><br><span class="line"><span class="comment">// points[1] = -108, 68</span></span><br><span class="line"><span class="comment">// points[2] = -108.5, 68</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate3D&gt; coords3D = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords3D, sr);</span><br><span class="line"></span><br><span class="line">subCurve = GeometryEngine.Instance.GetSubCurve3D(polygon, <span class="number">0</span>, <span class="number">1</span>, AsRatioOrLength.AsLength);</span><br><span class="line"><span class="comment">// subCurve.HasZ = true</span></span><br><span class="line"></span><br><span class="line">points = subCurve.Points;</span><br><span class="line"><span class="comment">// points.Count = 2</span></span><br><span class="line"><span class="comment">// points[0] = 0, 0, 0</span></span><br><span class="line"><span class="comment">// points[1] = 0, 0.70710678118654746, 0.70710678118654746</span></span><br></pre></td></tr></table></figure>

<h3 id="图形缓冲区"><a href="#图形缓冲区" class="headerlink" title="图形缓冲区"></a>图形缓冲区</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mitered join and butt caps</span></span><br><span class="line">SpatialReference sr = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">102010</span>);</span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>,<span class="number">6200</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">1600</span>,<span class="number">6300</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">1800</span>,<span class="number">6200</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords, sr);</span><br><span class="line"></span><br><span class="line">Polygon polygon = GeometryEngine.Instance.GraphicBuffer(polyline, <span class="number">50</span>, LineJoinType.Miter, LineCapType.Butt, <span class="number">10</span>, <span class="number">0</span>, <span class="number">-1</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bevelled join and round caps</span></span><br><span class="line">Envelope envelope = EnvelopeBuilderEx.CreateEnvelope(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10000</span>, <span class="number">10000</span>, SpatialReferences.WebMercator);</span><br><span class="line"></span><br><span class="line">Polygon outPolygon = GeometryEngine.Instance.GraphicBuffer(envelope, <span class="number">1000</span>, LineJoinType.Bevel, LineCapType.Round, <span class="number">4</span>, <span class="number">0</span>, <span class="number">96</span>) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="图形缓冲器很多"><a href="#图形缓冲器很多" class="headerlink" title="图形缓冲器很多"></a>图形缓冲器很多</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// round join and round caps</span></span><br><span class="line">MapPoint point1 = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">MapPoint point2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint point3 = MapPointBuilderEx.CreateMapPoint(<span class="number">1000000</span>, <span class="number">1200000</span>, SpatialReferences.WebMercator);</span><br><span class="line">List&lt;MapPoint&gt; points = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; point1, point2, point3 &#125;;</span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;Geometry&gt; geometries = GeometryEngine.Instance.GraphicBuffer(points, <span class="number">5</span>, LineJoinType.Round, LineCapType.Round, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="两条折线之间的交点"><a href="#两条折线之间的交点" class="headerlink" title="两条折线之间的交点"></a>两条折线之间的交点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// determine intersection between two polylines</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line1 = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts2 = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts2.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline line2 = PolylineBuilderEx.CreatePolyline(pts2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> intersects = GeometryEngine.Instance.Intersects(line1, line2);    <span class="comment">// intersects = true</span></span><br><span class="line">Geometry g = GeometryEngine.Instance.Intersection(line1, line2, GeometryDimensionType.EsriGeometry0Dimension);</span><br><span class="line">Multipoint resultMultipoint = g <span class="keyword">as</span> Multipoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">// result is a multiPoint that intersects at (2,2) and (4,2)</span></span><br></pre></td></tr></table></figure>

<h3 id="两个多边形之间的交点"><a href="#两个多边形之间的交点" class="headerlink" title="两个多边形之间的交点"></a>两个多边形之间的交点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// determine intersection between two polygons</span></span><br><span class="line"></span><br><span class="line">Envelope env1 = EnvelopeBuilderEx.CreateEnvelope(<span class="keyword">new</span> Coordinate2D(<span class="number">3.0</span>, <span class="number">2.0</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">6.0</span>, <span class="number">6.0</span>));</span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(env1);</span><br><span class="line"></span><br><span class="line">Envelope env2 = EnvelopeBuilderEx.CreateEnvelope(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">4.0</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env2);</span><br><span class="line"></span><br><span class="line">Polygon polyResult = GeometryEngine.Instance.Intersection(poly1, poly2) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="确定多边形的标注点"><a href="#确定多边形的标注点" class="headerlink" title="确定多边形的标注点"></a>确定多边形的标注点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a polygon</span></span><br><span class="line">List&lt;Coordinate2D&gt; list2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list2D);</span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polygon);</span><br><span class="line">MapPoint pt = GeometryEngine.Instance.LabelPoint(polygon);</span><br></pre></td></tr></table></figure>

<h3 id="确定线的长度，长度3D"><a href="#确定线的长度，长度3D" class="headerlink" title="确定线的长度，长度3D"></a>确定线的长度，长度3D</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MapPoint c1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">MapPoint c2 = MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// line segment</span></span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(c1, c2);</span><br><span class="line"><span class="built_in">double</span> len = line.Length;     <span class="comment">// = 3</span></span><br><span class="line"><span class="built_in">double</span> len3D = line.Length3D;   <span class="comment">// = Math.Sqrt(10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline</span></span><br><span class="line">Polyline p = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"><span class="built_in">double</span> p_len = p.Length;        <span class="comment">// = len = 3</span></span><br><span class="line"><span class="built_in">double</span> p_len3D = p.Length3D;    <span class="comment">// = len3D = Math.Sqrt(10)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> ge_len = GeometryEngine.Instance.Length(p);      <span class="comment">// = p_len = len = 3</span></span><br><span class="line"><span class="built_in">double</span> ge_len3d = GeometryEngine.Instance.Length3D(p);    <span class="comment">// = p_len3D = len3D = Math.Sqrt(10)</span></span><br></pre></td></tr></table></figure>

<h3 id="获取最小和最大-M-值-GetMinMaxM"><a href="#获取最小和最大-M-值-GetMinMaxM" class="headerlink" title="获取最小和最大 M 值 - GetMinMaxM"></a>获取最小和最大 M 值 - GetMinMaxM</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;rings\&quot;:[[[-3000,-2000,10],[-2000,-2000,15],[-1000,-2000,20],[0,-2000,0],[1000,-2000,-20],[2000,-2000,-30],[3000,-2000,10],[4000,-2000,5]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> minM, maxM;</span><br><span class="line">GeometryEngine.Instance.GetMinMaxM(polygon, <span class="keyword">out</span> minM, <span class="keyword">out</span> maxM);</span><br><span class="line"><span class="comment">// minM = -30 </span></span><br><span class="line"><span class="comment">// maxM = 20</span></span><br><span class="line"></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,10],[-2000,-2000,null],[-1000,-2000,null]]]&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">GeometryEngine.Instance.GetMinMaxM(polyline, <span class="keyword">out</span> minM, <span class="keyword">out</span> maxM);</span><br><span class="line"><span class="comment">// minM = 10</span></span><br><span class="line"><span class="comment">// maxM = 10</span></span><br><span class="line"></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,null],[-2000,-2000,null],[-1000,-2000,null]]]&#125;&quot;</span>;</span><br><span class="line">polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">GeometryEngine.Instance.GetMinMaxM(polyline, <span class="keyword">out</span> minM, <span class="keyword">out</span> maxM);</span><br><span class="line"><span class="comment">// minM = double.Nan</span></span><br><span class="line"><span class="comment">// maxM = double.Nan</span></span><br></pre></td></tr></table></figure>

<h3 id="确定-M-是单调的，是升序还是降序-GetMMonotonic"><a href="#确定-M-是单调的，是升序还是降序-GetMMonotonic" class="headerlink" title="确定 M 是单调的，是升序还是降序 - GetMMonotonic"></a>确定 M 是单调的，是升序还是降序 - GetMMonotonic</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,10],[-2000,-2000,15],[-1000,-2000,20]]]&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">MonotonicType monotonic = GeometryEngine.Instance.GetMMonotonic(polyline);</span><br><span class="line"><span class="comment">// monotonic = Monotonic.Ascending</span></span><br><span class="line"></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,10],[-2000,-2000,5],[-1000,-2000,0]]]&#125;&quot;</span>;</span><br><span class="line">polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">monotonic = GeometryEngine.Instance.GetMMonotonic(polyline);</span><br><span class="line"><span class="comment">// monotonic = Monotonic.Descending</span></span><br><span class="line"></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,10],[-2000,-2000,15],[-1000,-2000,0]]]&#125;&quot;</span>;</span><br><span class="line">polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">monotonic = GeometryEngine.Instance.GetMMonotonic(polyline);</span><br><span class="line"><span class="comment">// monotonic = Monotonic.NotMonotonic</span></span><br></pre></td></tr></table></figure>

<h3 id="获取与几何图形中指定-M-值出现的位置相对应的多点-GetPointsAtM"><a href="#获取与几何图形中指定-M-值出现的位置相对应的多点-GetPointsAtM" class="headerlink" title="获取与几何图形中指定 M 值出现的位置相对应的多点 - GetPointsAtM"></a>获取与几何图形中指定 M 值出现的位置相对应的多点 - GetPointsAtM</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,10],[-2000,-2000,15],[-1000,-2000,20],[0,-2000,0],[1000,-2000,20],[2000,-2000,30],[3000,-2000,10],[4000,-2000,5]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">Multipoint multipoint = GeometryEngine.Instance.GetPointsAtM(polyline, <span class="number">10</span>, <span class="number">500</span>);</span><br><span class="line"><span class="comment">// multiPoint.PointCount = 4</span></span><br><span class="line"><span class="comment">// multipoint.Points[0]  X= -3000, Y= -2500  M= 10</span></span><br><span class="line"><span class="comment">// multipoint.Points[1]  X= -500, Y= -2500  M= 10</span></span><br><span class="line"><span class="comment">// multipoint.Points[2]  X= 500, Y= -2500  M= 10</span></span><br><span class="line"><span class="comment">// multipoint.Points[3]  X= 3000, Y= -2500  M= 10</span></span><br></pre></td></tr></table></figure>

<h3 id="获取与指定-M-值之间的子曲线对应的折线-GetSubCurveBetweenMs"><a href="#获取与指定-M-值之间的子曲线对应的折线-GetSubCurveBetweenMs" class="headerlink" title="获取与指定 M 值之间的子曲线对应的折线 - GetSubCurveBetweenMs"></a>获取与指定 M 值之间的子曲线对应的折线 - GetSubCurveBetweenMs</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-2000,0,1],[-1000,1000,2],[-1000,0,3],[1000,1000,4],[2000,1000,5],[2000,2000,6],[3000,2000,7],[4000,0,8]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">Polyline subCurve = GeometryEngine.Instance.GetSubCurveBetweenMs(polyline, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line"><span class="comment">// subCurve.PointCount = 5</span></span><br><span class="line"><span class="comment">// subCurve.Points[0]  X= --1000, Y= 1000 M= 2</span></span><br><span class="line"><span class="comment">// subCurve.Points[1]  X= --1000, Y= 0  M= 3</span></span><br><span class="line"><span class="comment">// subCurve.Points[2]  X= 1000, Y= 1000  M= 4</span></span><br><span class="line"><span class="comment">// subCurve.Points[3]  X= 2000, Y= -1000  M= 5</span></span><br><span class="line"><span class="comment">// subCurve.Points[4]  X= 2000, Y= -2000  M= 6</span></span><br><span class="line"></span><br><span class="line">subCurve = GeometryEngine.Instance.GetSubCurveBetweenMs(polyline, <span class="built_in">double</span>.NaN, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// subCurve.PointCount = 0</span></span><br><span class="line"><span class="comment">// subCurve.IsEmpty = true</span></span><br></pre></td></tr></table></figure>

<h3 id="获取与沿几何图形中出现指定-M-值的位置处的法线对应的线段-GetNormalsAtM"><a href="#获取与沿几何图形中出现指定-M-值的位置处的法线对应的线段-GetNormalsAtM" class="headerlink" title="获取与沿几何图形中出现指定 M 值的位置处的法线对应的线段 - GetNormalsAtM"></a>获取与沿几何图形中出现指定 M 值的位置处的法线对应的线段 - GetNormalsAtM</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">IList&lt;MapPoint&gt; inPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-3000</span>, <span class="number">-2000</span>, <span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-3000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-1000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-1000</span>, <span class="number">2000</span>, <span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">3000</span>, <span class="number">2000</span>, <span class="number">0</span>, <span class="number">200</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">3000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">1000</span>, <span class="number">-2000</span>, <span class="number">0</span>, <span class="number">200</span>),</span><br><span class="line">  MapPointBuilderEx.CreateMapPoint(<span class="number">-3000</span>, <span class="number">-2000</span>, <span class="number">0</span>, <span class="number">300</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(inPoints);</span><br><span class="line"><span class="comment">// polygon.HasM = true</span></span><br><span class="line"></span><br><span class="line">Polyline polyline = GeometryEngine.Instance.GetNormalsAtM(polygon, <span class="number">150</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">// polyline.PartCount = 5</span></span><br><span class="line"><span class="comment">// polyline.PointCount = 10</span></span><br><span class="line"><span class="comment">// polyline.HasM = false</span></span><br><span class="line"></span><br><span class="line">ReadOnlyPartCollection parts = polyline.Parts;</span><br><span class="line">ReadOnlySegmentCollection segments = parts[<span class="number">0</span>];</span><br><span class="line">LineSegment line = segments[<span class="number">0</span>] <span class="keyword">as</span> LineSegment;</span><br><span class="line"><span class="comment">// line.StartCoordinate = (-3000, -1000)</span></span><br><span class="line"><span class="comment">// line.EndCoordinate = (-2900, -1000)</span></span><br><span class="line"></span><br><span class="line">segments = parts[<span class="number">1</span>];</span><br><span class="line">line = segments[<span class="number">0</span>] <span class="keyword">as</span> LineSegment;</span><br><span class="line"><span class="comment">// line.StartCoordinate = (-1000, 1500)</span></span><br><span class="line"><span class="comment">// line.EndCoordinate = (-900, 1500)</span></span><br><span class="line"></span><br><span class="line">segments = parts[<span class="number">2</span>];</span><br><span class="line">line = segments[<span class="number">0</span>] <span class="keyword">as</span> LineSegment;</span><br><span class="line"><span class="comment">// line.StartCoordinate = (1000, 2000)</span></span><br><span class="line"><span class="comment">// line.EndCoordinate = (1000, 1900)</span></span><br><span class="line"></span><br><span class="line">segments = parts[<span class="number">3</span>];</span><br><span class="line">line = segments[<span class="number">0</span>] <span class="keyword">as</span> LineSegment;</span><br><span class="line"><span class="comment">// line.StartCoordinate = (1500, 0)</span></span><br><span class="line"><span class="comment">// line.EndCoordinate = (1500, 100)</span></span><br><span class="line"></span><br><span class="line">segments = parts[<span class="number">4</span>];</span><br><span class="line">line = segments[<span class="number">0</span>] <span class="keyword">as</span> LineSegment;</span><br><span class="line"><span class="comment">// line.StartCoordinate = (1000, -1000)</span></span><br><span class="line"><span class="comment">// line.EndCoordinate = (900, -1000)</span></span><br></pre></td></tr></table></figure>

<h3 id="获取沿多部分的指定距离处的-M-值"><a href="#获取沿多部分的指定距离处的-M-值" class="headerlink" title="获取沿多部分的指定距离处的 M 值"></a>获取沿多部分的指定距离处的 M 值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,-3],[-2000,-2000,-2]],[[-2000,-2000,1],[-2000,1000,2]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline has 2 parts</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> m1, m2;</span><br><span class="line">GeometryEngine.Instance.GetMsAtDistance(polyline, <span class="number">0</span>, AsRatioOrLength.AsLength, <span class="keyword">out</span> m1, <span class="keyword">out</span> m2);</span><br><span class="line"><span class="comment">// m1 = -3</span></span><br><span class="line"><span class="comment">// m2 = NaN</span></span><br><span class="line"></span><br><span class="line">GeometryEngine.Instance.GetMsAtDistance(polyline, <span class="number">500</span>, AsRatioOrLength.AsLength, <span class="keyword">out</span> m1, <span class="keyword">out</span> m2);</span><br><span class="line"><span class="comment">// m1 = -2.5</span></span><br><span class="line"><span class="comment">// m2 = NaN</span></span><br><span class="line"></span><br><span class="line">GeometryEngine.Instance.GetMsAtDistance(polyline, <span class="number">1000</span>, AsRatioOrLength.AsLength, <span class="keyword">out</span> m1, <span class="keyword">out</span> m2);</span><br><span class="line"><span class="comment">// m1 = -2</span></span><br><span class="line"><span class="comment">// m2 = 1     // m2 has a value because distance 1000 is at the end of the first part, beginning of the second part</span></span><br></pre></td></tr></table></figure>

<h3 id="将-M-值设置为从多部分开始的累积长度-SetMsAsDistance"><a href="#将-M-值设置为从多部分开始的累积长度-SetMsAsDistance" class="headerlink" title="将 M 值设置为从多部分开始的累积长度 - SetMsAsDistance"></a>将 M 值设置为从多部分开始的累积长度 - SetMsAsDistance</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;rings\&quot;:[[[0,0],[0,3000],[4000,3000],[4000,0],[0,0]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">Polygon outPolygon = GeometryEngine.Instance.SetMsAsDistance(polygon, AsRatioOrLength.AsLength) <span class="keyword">as</span> Polygon;</span><br><span class="line">ReadOnlyPointCollection outPoints = outPolygon.Points;</span><br><span class="line"><span class="comment">// outPoints M values are &#123; 0, 3000, 7000, 10000, 14000 &#125;;</span></span><br></pre></td></tr></table></figure>

<h3 id="在给定距离处插入-M-值-插入距离"><a href="#在给定距离处插入-M-值-插入距离" class="headerlink" title="在给定距离处插入 M 值 - 插入距离"></a>在给定距离处插入 M 值 - 插入距离</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,-3],[-2000,-2000,-2],[-1000,-2000,null]]]&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"><span class="built_in">bool</span> splitHappened;</span><br><span class="line"><span class="built_in">int</span> partIndex, segmentIndex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A point already exists at the given distance</span></span><br><span class="line"><span class="built_in">double</span> m = <span class="number">-1</span>;</span><br><span class="line"><span class="built_in">double</span> distance = <span class="number">2000</span>;</span><br><span class="line"><span class="built_in">bool</span> createNewPart = <span class="literal">false</span>;</span><br><span class="line">Polyline outputPolyline = GeometryEngine.Instance.InsertMAtDistance(polyline, m, distance, AsRatioOrLength.AsLength, createNewPart, <span class="keyword">out</span> splitHappened, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex) <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitHappened = false, partIndex = 0, segmentIndex = 2</span></span><br><span class="line"><span class="comment">// outputPolyline.Points[2].M = -1</span></span><br><span class="line"></span><br><span class="line">json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000,-3],[-2000,-2000,-2],[-1000,-2000,-1]],[[0,0,0],[0,1000,0],[0,2000,2]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A point already exists at the given distance, but createNewPart = true</span></span><br><span class="line">m = <span class="number">1</span>;</span><br><span class="line">distance = <span class="number">3000</span>;</span><br><span class="line">createNewPart = <span class="literal">true</span>;</span><br><span class="line">outputPolyline = GeometryEngine.Instance.InsertMAtDistance(polyline, m, distance, AsRatioOrLength.AsLength, createNewPart, <span class="keyword">out</span> splitHappened, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="built_in">string</span> outputJson = outputPolyline.ToJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitHappened = true, partIndex = 2, segmentIndex = 0</span></span><br><span class="line"><span class="comment">// outputJson = &#123;&quot;hasM&quot;:true,&quot;paths&quot;:[[[-3000,-2000,-3],[-2000,-2000,-2],[-1000,-2000,-1]],[[0,0,0],[0,1000,1]],[[0,1000,1],[0,2000,2]]]&#125;&#125;</span></span><br><span class="line"><span class="comment">// A new part has been created and the M values for outputPolyline.Points[4] and outputPolyline.Points[5] have been modified</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A point does not exist at the given distance</span></span><br><span class="line">m = <span class="number">1</span>;</span><br><span class="line">distance = <span class="number">3500</span>;</span><br><span class="line">createNewPart = <span class="literal">false</span>;</span><br><span class="line">outputPolyline = GeometryEngine.Instance.InsertMAtDistance(polyline, m, distance, AsRatioOrLength.AsLength, createNewPart, <span class="keyword">out</span> splitHappened, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex) <span class="keyword">as</span> Polyline;</span><br><span class="line">outputJson = outputPolyline.ToJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitHappened = true even though createNewPart = false because a new point was created</span></span><br><span class="line"><span class="comment">// partIndex = 1, segmentIndex = 2</span></span><br><span class="line"><span class="comment">// outputJson = &#123;&quot;hasM&quot;:true,&quot;paths&quot;:[[[-3000,-2000,-3],[-2000,-2000,-2],[-1000,-2000,-1]],[[0,0,0],[0,1000,0],[0,1500,1],[0,2000,2]]]&#125;</span></span><br><span class="line"><span class="comment">// A new point has been inserted (0, 1500, 1) by interpolating the X and Y coordinates and M value set to the input M value.</span></span><br></pre></td></tr></table></figure>

<h3 id="使用输入点的-M-值校准-M-值-CalibrateByMs"><a href="#使用输入点的-M-值校准-M-值-CalibrateByMs" class="headerlink" title="使用输入点的 M 值校准 M 值 - CalibrateByMs"></a>使用输入点的 M 值校准 M 值 - CalibrateByMs</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[0,0,-1],[1,0,0],[1,1,1],[1,2,2],[3,1,3],[5,3,4],[9,5,5],[7,6,6]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpolate using points (0, 0, 17), (1, 0, 42), (7, 6, 18) </span></span><br><span class="line">List&lt;MapPoint&gt; updatePoints = <span class="keyword">new</span> List&lt;MapPoint&gt;(<span class="number">3</span>);</span><br><span class="line">MapPointBuilderEx builder = <span class="keyword">new</span> MapPointBuilderEx(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">builder.M = <span class="number">17</span>;</span><br><span class="line">updatePoints.Add(builder.ToGeometry() <span class="keyword">as</span> MapPoint);</span><br><span class="line"></span><br><span class="line">builder.X = <span class="number">1</span>;</span><br><span class="line">builder.M = <span class="number">42</span>;</span><br><span class="line">updatePoints.Add(builder.ToGeometry() <span class="keyword">as</span> MapPoint);</span><br><span class="line"></span><br><span class="line">builder.X = <span class="number">7</span>;</span><br><span class="line">builder.Y = <span class="number">6</span>;</span><br><span class="line">builder.M = <span class="number">18</span>;</span><br><span class="line">updatePoints.Add(builder.ToGeometry() <span class="keyword">as</span> MapPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calibrate all the points in the polyline</span></span><br><span class="line"><span class="built_in">double</span> cutOffDistance = polyline.Length;</span><br><span class="line"></span><br><span class="line">Polyline updatedPolyline = GeometryEngine.Instance.CalibrateByMs(polyline, updatePoints, UpdateMMethod.Interpolate, cutOffDistance) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// The points in the updated polyline are</span></span><br><span class="line"><span class="comment">// (0, 0, 17 ), ( 1, 0, 42 ), ( 1, 1, 38 ), ( 1, 2, 34 ), ( 3, 1, 30 ), ( 5, 3, 26 ), ( 9, 5, 22 ), ( 7, 6, 18 )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ExtrapolateBefore using points (1, 2, 42), (9, 5, 18)</span></span><br><span class="line">builder.X = <span class="number">1</span>;</span><br><span class="line">builder.Y = <span class="number">2</span>;</span><br><span class="line">builder.M = <span class="number">42</span>;</span><br><span class="line">updatePoints[<span class="number">0</span>] = builder.ToGeometry() <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">builder.X = <span class="number">9</span>;</span><br><span class="line">builder.Y = <span class="number">5</span>;</span><br><span class="line">builder.M = <span class="number">18</span>;</span><br><span class="line">updatePoints[<span class="number">1</span>] = builder.ToGeometry() <span class="keyword">as</span> MapPoint;</span><br><span class="line"></span><br><span class="line">updatePoints.RemoveAt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">updatedPolyline = GeometryEngine.Instance.CalibrateByMs(polyline, updatePoints, UpdateMMethod.ExtrapolateBefore, cutOffDistance) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// The points in the updated polyline are</span></span><br><span class="line"><span class="comment">// ( 0, 0, 66 ), ( 1, 0, 58 ), ( 1, 1, 50 ), ( 1, 2, 42 ), ( 3, 1, 3 ), ( 5, 3, 4 ), ( 9, 5, 18 ), ( 7, 6, 6 )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ExtrapolateAfter using points (0, 0, 17), (1, 2, 42)</span></span><br><span class="line">builder.X = <span class="number">0</span>;</span><br><span class="line">builder.Y = <span class="number">0</span>;</span><br><span class="line">builder.M = <span class="number">17</span>;</span><br><span class="line">updatePoints.Insert(<span class="number">0</span>, builder.ToGeometry() <span class="keyword">as</span> MapPoint);</span><br><span class="line"></span><br><span class="line">updatePoints.RemoveAt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">updatedPolyline = GeometryEngine.Instance.CalibrateByMs(polyline, updatePoints, UpdateMMethod.ExtrapolateAfter, cutOffDistance) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// The points in the updated polyline are</span></span><br><span class="line"><span class="comment">// ( 0, 0, 17 ), ( 1, 0, 0 ), ( 1, 1, 1 ), ( 1, 2, 42 ), ( 3, 1, 50.333333333333333 ), ( 5, 3, 58.666666666666671 ), ( 9, 5, 67 ), ( 7, 6, 75.333333333333343 )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ExtrapolateAfter and Interpolate using points (0, 0, 17), (1, 2, 42)</span></span><br><span class="line">updatedPolyline = GeometryEngine.Instance.CalibrateByMs(polyline, updatePoints, UpdateMMethod.ExtrapolateAfter | UpdateMMethod.Interpolate, cutOffDistance) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// The points in the updated polyline are</span></span><br><span class="line"><span class="comment">// (0,0,17),(1,0,25.333333333333336),(1,1,33.666666666666671),(1,2,42),(3,1,50.333333333333336),(5,3,58.666666666666671),(9,5,67),(7,6,75.333333333333343)</span></span><br></pre></td></tr></table></figure>

<h3 id="通过对一系列点进行线性插值生成-M-值-插值MsBetween"><a href="#通过对一系列点进行线性插值生成-M-值-插值MsBetween" class="headerlink" title="通过对一系列点进行线性插值生成 M 值 - 插值MsBetween"></a>通过对一系列点进行线性插值生成 M 值 - 插值MsBetween</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[0,0,-1],[1,0,0],[1,1,1],[1,2,2],[3,1,3],[5,3,4],[9,5,5],[7,6,6]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:4326&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpolate between points 2 and 6</span></span><br><span class="line">Polyline outPolyline = GeometryEngine.Instance.InterpolateMsBetween(polyline, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// The points of the output polyline are</span></span><br><span class="line"><span class="comment">// (0, 0, -1), (1, 0, 0), (1, 1, 1), (1, 2, 1.3796279833912741), (3, 1, 2.2285019604153242), (5, 3, 3.3022520459518998), (9, 5, 5), (7, 6, 6)</span></span><br></pre></td></tr></table></figure>

<h3 id="在几何图形的开头和结尾设置-Ms，并在两个值之间插值-M-值-SetAndIntervalateMsBetween"><a href="#在几何图形的开头和结尾设置-Ms，并在两个值之间插值-M-值-SetAndIntervalateMsBetween" class="headerlink" title="在几何图形的开头和结尾设置 Ms，并在两个值之间插值 M 值 - SetAndIntervalateMsBetween"></a>在几何图形的开头和结尾设置 Ms，并在两个值之间插值 M 值 - SetAndIntervalateMsBetween</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;hasM\&quot;:true,\&quot;paths\&quot;:[[[-3000,-2000],[-2000,-2000],[-1000,-2000],[0,-2000],[1000,-2000],[2000,-2000],[3000,-2000],[4000,-2000]]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">Polyline outPolyline = GeometryEngine.Instance.SetAndInterpolateMsBetween(polyline, <span class="number">100</span>, <span class="number">800</span>) <span class="keyword">as</span> Polyline;</span><br><span class="line">ReadOnlyPointCollection outPoints = outPolyline.Points;</span><br><span class="line"><span class="comment">// outPoints M values are &#123; 100, 200, 300, 400, 500, 600, 700, 800 &#125;;</span></span><br></pre></td></tr></table></figure>

<h3 id="移动地图点"><a href="#移动地图点" class="headerlink" title="移动地图点"></a>移动地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>);</span><br><span class="line">MapPoint ptResult = GeometryEngine.Instance.Move(pt, <span class="number">-3.5</span>, <span class="number">2.5</span>) <span class="keyword">as</span> MapPoint;</span><br><span class="line"><span class="comment">// ptResult is (-2.5, 5.5)</span></span><br></pre></td></tr></table></figure>

<h3 id="移动-z-感知地图点"><a href="#移动-z-感知地图点" class="headerlink" title="移动 z 感知地图点"></a>移动 z 感知地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MapPoint zPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">2.0</span>);</span><br><span class="line">MapPoint zPtResult = GeometryEngine.Instance.Move(zPt, <span class="number">4</span>, <span class="number">0.25</span>, <span class="number">0.5</span>) <span class="keyword">as</span> MapPoint;</span><br><span class="line"><span class="comment">// zPtResult is (5.0, 3.25, 2.5);</span></span><br></pre></td></tr></table></figure>

<h3 id="移动折线"><a href="#移动折线" class="headerlink" title="移动折线"></a>移动折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">2</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"></span><br><span class="line">Geometry geometry = GeometryEngine.Instance.Move(polyline, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">Polyline polylineResult = geometry <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// polylineResult.Points[0] = 4.0, 3.0, 3.0</span></span><br><span class="line"><span class="comment">// polylineResult.Points[1] = 6.0, 5.0, 3.0</span></span><br><span class="line"><span class="comment">// polylineResult.Points[2] = 6.0, 4.0, 3.0</span></span><br><span class="line"><span class="comment">// polylineResult.Points[3] = 7.0, 4.0, 3.0</span></span><br></pre></td></tr></table></figure>

<h3 id="移动点沿线"><a href="#移动点沿线" class="headerlink" title="移动点沿线"></a>移动点沿线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">3</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">3.0</span>));</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"><span class="built_in">bool</span> simple = GeometryEngine.Instance.IsSimpleAsFeature(polyline);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = false</span></span><br><span class="line">MapPoint pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">1.0</span>, <span class="literal">false</span>, <span class="number">0.0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 1.0, 3.0</span></span><br><span class="line"></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">1.0</span>, <span class="literal">false</span>, <span class="number">-1.0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 1.0, 4.0</span></span><br><span class="line"></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">1.0</span>, <span class="literal">false</span>, <span class="number">2.0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 1.0, 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">0.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 2.5, 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// move past the line</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">7</span>, <span class="literal">false</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 5.0, 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// move past the line with extension at &quot;to&quot; point</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">7</span>, <span class="literal">false</span>, <span class="number">0</span>, SegmentExtensionType.ExtendEmbeddedAtTo);</span><br><span class="line"><span class="comment">// pt = 7.0, 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// negative distance with extension at &quot;from&quot; point</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">-2</span>, <span class="literal">false</span>, <span class="number">0</span>, SegmentExtensionType.ExtendEmbeddedAtFrom);</span><br><span class="line"><span class="comment">// pt = -2.0, 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">0.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt = 2.5, 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// line with Z</span></span><br><span class="line">List&lt;Coordinate3D&gt; coords3D = <span class="keyword">new</span> List&lt;Coordinate3D&gt; &#123; <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">1113195</span>, <span class="number">1118890</span>, <span class="number">5000</span>) &#125;;</span><br><span class="line">Polyline polylineZ = PolylineBuilderEx.CreatePolyline(coords3D, SpatialReferences.WebMercator);</span><br><span class="line"><span class="comment">// polylineZ.HasZ = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true, no offset</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polylineZ, <span class="number">0.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt.X = 556597.5</span></span><br><span class="line"><span class="comment">// pt.Y = 559445</span></span><br><span class="line"><span class="comment">// pt.Z = 2500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true, past the line with &quot;to&quot; extension, no offset</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polylineZ, <span class="number">1.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.ExtendEmbeddedAtTo);</span><br><span class="line"><span class="comment">// pt.X = 1669792.5</span></span><br><span class="line"><span class="comment">// pt.Y = 1678335</span></span><br><span class="line"><span class="comment">// pt.Z = 7500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true, negative distance past the line with no extension, no offset</span></span><br><span class="line">pt = GeometryEngine.Instance.MovePointAlongLine(polylineZ, <span class="number">-1.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pt.X = 0</span></span><br><span class="line"><span class="comment">// pt.Y = 0</span></span><br><span class="line"><span class="comment">// pt.Z = -7500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline with Z but 2d distance = 0</span></span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">MapPoint pt4 = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt3, pt4 &#125;;</span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"><span class="comment">// polyline.Length3D = 10</span></span><br><span class="line"><span class="comment">// polyline.Length = 0</span></span><br><span class="line"></span><br><span class="line">MapPoint result = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">2</span>, <span class="literal">false</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// result = 5, 5, 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline with length2d = 0 and length3d = 0</span></span><br><span class="line">MapPoint pt5 = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">MapPoint pt6 = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">pts.Clear();</span><br><span class="line">pts.Add(pt5);</span><br><span class="line">pts.Add(pt6);</span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"><span class="comment">// polyline.Length3D = 0</span></span><br><span class="line"><span class="comment">// polyline.Length = 0</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">3</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// result = 5, 5, 10</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.MovePointAlongLine(polyline, <span class="number">3</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.ExtendEmbeddedAtFrom);</span><br><span class="line"><span class="comment">// result = 5, 5, 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline with Z and M</span></span><br><span class="line">List&lt;MapPoint&gt; inputPoints = <span class="keyword">new</span> List&lt;MapPoint&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">44</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polylineZM = PolylineBuilderEx.CreatePolyline(inputPoints, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">// polylineZM.HasZ = true</span></span><br><span class="line"><span class="comment">// polylineZM.HasM = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true, no offset</span></span><br><span class="line">MapPoint pointAlong = GeometryEngine.Instance.MovePointAlongLine(polylineZM, <span class="number">0.5</span>, <span class="literal">true</span>, <span class="number">0</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pointAlong = 1, 2, 18, 24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ratio = true with offset</span></span><br><span class="line">pointAlong = GeometryEngine.Instance.MovePointAlongLine(polylineZM, <span class="number">0.2</span>, <span class="literal">true</span>, <span class="number">2.23606797749979</span>, SegmentExtensionType.NoExtension);</span><br><span class="line"><span class="comment">// pointAlong = 1, 2, 9, 12</span></span><br></pre></td></tr></table></figure>

<h3 id="将几何体的组件分离为单个组件几何图形"><a href="#将几何体的组件分离为单个组件几何图形" class="headerlink" title="将几何体的组件分离为单个组件几何图形"></a>将几何体的组件分离为单个组件几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; coords2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">7</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">3</span>)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(coords2D, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;Geometry&gt; result = GeometryEngine.Instance.MultipartToSinglePart(multipoint);</span><br><span class="line"><span class="comment">// result.Count = 4, </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x27;explode&#x27; a multipart polygon</span></span><br><span class="line">result = GeometryEngine.Instance.MultipartToSinglePart(multipartPolygon);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// create a bag of geometries</span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords2D, SpatialReferences.WGS84);</span><br><span class="line"><span class="comment">//At 2.x - GeometryBag bag = GeometryBagBuilder.CreateGeometryBag(new List&lt;Geometry&gt;() &#123; multipoint, polygon &#125;);</span></span><br><span class="line"><span class="keyword">var</span> bag = GeometryBagBuilderEx.CreateGeometryBag(<span class="keyword">new</span> List&lt;Geometry&gt;() &#123; multipoint, polygon &#125;);</span><br><span class="line"><span class="comment">// bag.PartCount = =2</span></span><br><span class="line"></span><br><span class="line">result = GeometryEngine.Instance.MultipartToSinglePart(bag);</span><br><span class="line"><span class="comment">// result.Count == 2</span></span><br><span class="line"><span class="comment">// result[0] is MultiPoint</span></span><br><span class="line"><span class="comment">// result[1] is Polygon</span></span><br></pre></td></tr></table></figure>

<h3 id="最近点与最近顶点"><a href="#最近点与最近顶点" class="headerlink" title="最近点与最近顶点"></a>最近点与最近顶点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>, sr);</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">-4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords);</span><br><span class="line"></span><br><span class="line"><span class="comment">// find the nearest point in the polygon geomtry to the pt</span></span><br><span class="line">ProximityResult result = GeometryEngine.Instance.NearestPoint(polygon, pt);</span><br><span class="line"><span class="comment">// result.Point = 5, 1</span></span><br><span class="line"><span class="comment">// result.SegmentIndex = 3</span></span><br><span class="line"><span class="comment">// result.PartIndex = 0</span></span><br><span class="line"><span class="comment">// result.PointIndex = null</span></span><br><span class="line"><span class="comment">//result.Distance = 4</span></span><br><span class="line"><span class="comment">//result.RightSide = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// find the nearest vertex in the polgyon geometry to the pt</span></span><br><span class="line">result = GeometryEngine.Instance.NearestVertex(polygon, pt);</span><br><span class="line"><span class="comment">// result.Point = 10, 1</span></span><br><span class="line"><span class="comment">// result.PointIndex = 0</span></span><br><span class="line"><span class="comment">// result.SegmentIndex = null</span></span><br><span class="line"><span class="comment">// result.PartIndex = 0</span></span><br><span class="line"><span class="comment">// result.Distance = Math.Sqrt(41)</span></span><br><span class="line"><span class="comment">// result.RightSide = false</span></span><br></pre></td></tr></table></figure>

<h3 id="确定-3D-中的最近点"><a href="#确定-3D-中的最近点" class="headerlink" title="确定 3D 中的最近点"></a>确定 3D 中的最近点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// test pt1 to pt2</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">ProximityResult result = GeometryEngine.Instance.NearestPoint3D(pt1, pt2);</span><br><span class="line"><span class="comment">// result.Point = 1,1,1</span></span><br><span class="line"><span class="comment">// result.Distance = Math.Sqrt(3)</span></span><br><span class="line"><span class="comment">// result.SegmentIndex = null</span></span><br><span class="line"><span class="comment">// result.PartIndex = 0</span></span><br><span class="line"><span class="comment">// result.PointIndex = 0</span></span><br><span class="line"><span class="comment">// result.RightSide = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// multipoint built from pt1, pt2.   should be closer to pt2</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(<span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt1, pt2 &#125;);</span><br><span class="line">result = GeometryEngine.Instance.NearestPoint3D(multipoint, pt3);</span><br><span class="line"><span class="comment">// result.Point = 2, 2, 2</span></span><br><span class="line"><span class="comment">// result.Distance = Math.Sqrt(65)</span></span><br><span class="line"><span class="comment">// result.SegmentIndex = null</span></span><br><span class="line"><span class="comment">// result.PartIndex = 1</span></span><br><span class="line"><span class="comment">// result.PointIndex = 1</span></span><br><span class="line"><span class="comment">// result.RightSide = false</span></span><br></pre></td></tr></table></figure>

<h3 id="计算与源的几何偏移"><a href="#计算与源的几何偏移" class="headerlink" title="计算与源的几何偏移"></a>计算与源的几何偏移</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; linePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">linePts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line">linePts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">10.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(linePts);</span><br><span class="line"></span><br><span class="line">Geometry g = GeometryEngine.Instance.Offset(polyline, <span class="number">10</span>, OffsetType.Square, <span class="number">0</span>);</span><br><span class="line">Polyline gResult = g <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// gResult.PointCount = 2</span></span><br><span class="line"><span class="comment">// gResult.Points[0] = (1, -9)</span></span><br><span class="line"><span class="comment">// gResult.Points[1] = (10, -9)</span></span><br><span class="line"></span><br><span class="line">g = GeometryEngine.Instance.Offset(polyline, <span class="number">-10</span>, OffsetType.Round, <span class="number">0.5</span>);</span><br><span class="line">gResult = g <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// gResult.PointCount = 2</span></span><br><span class="line"><span class="comment">// gResult.Points[0] = (1, -11</span></span><br><span class="line"><span class="comment">// gResult.Points[1] = (10, 11)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// elliptic arc curve</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Coordinate2D fromPt = <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D toPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Coordinate2D interiorPt = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>, <span class="number">1</span> + Math.Sqrt(<span class="number">2</span>) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">EllipticArcSegment circularArc = EllipticArcBuilderEx.CreateCircularArc(fromPt.ToMapPoint(), toPt.ToMapPoint(), interiorPt);</span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(circularArc);</span><br><span class="line">g = GeometryEngine.Instance.Offset(polyline, <span class="number">-0.25</span>, OffsetType.Miter, <span class="number">0.5</span>);</span><br><span class="line">gResult = g <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line">g = GeometryEngine.Instance.Offset(polyline, <span class="number">0.25</span>, OffsetType.Bevel, <span class="number">0.5</span>);</span><br><span class="line">gResult = g <span class="keyword">as</span> Polyline;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  offset for a polygon</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">List&lt;MapPoint&gt; list = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">10.0</span>, <span class="number">10.0</span>, SpatialReferences.WGS84));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">10.0</span>, <span class="number">20.0</span>, SpatialReferences.WGS84));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">20.0</span>, <span class="number">20.0</span>, SpatialReferences.WGS84));</span><br><span class="line">list.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">20.0</span>, <span class="number">10.0</span>, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list);</span><br><span class="line"></span><br><span class="line">g = GeometryEngine.Instance.Offset(polygon, <span class="number">2</span>, OffsetType.Square, <span class="number">0</span>);</span><br><span class="line">Polygon gPolygon = g <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">g = GeometryEngine.Instance.Offset(polygon, <span class="number">-2</span>, OffsetType.Round, <span class="number">0.3</span>);</span><br><span class="line">gPolygon = g <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">g = GeometryEngine.Instance.Offset(polygon, <span class="number">-0.5</span>, OffsetType.Miter, <span class="number">0.6</span>);</span><br><span class="line">gPolygon = g <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="确定几何图形是否重叠"><a href="#确定几何图形是否重叠" class="headerlink" title="确定几何图形是否重叠"></a>确定几何图形是否重叠</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.25</span>, <span class="number">1.75</span>);</span><br><span class="line">MapPoint pt3 = MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">1.5</span>);</span><br><span class="line">MapPoint pt4 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// point and point overlap</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">bool</span> overlaps = GeometryEngine.Instance.Overlaps(pt1, pt2);        <span class="comment">// overlaps = false</span></span><br><span class="line">overlaps = GeometryEngine.Instance.Overlaps(pt1, pt1);             <span class="comment">// overlaps = false</span></span><br><span class="line">                                                                   <span class="comment">// Two geometries overlap if the region of their intersection is of the same dimension as the geometries involved and </span></span><br><span class="line">                                                                   <span class="comment">// is not equivalent to either of the geometries.  </span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(pt1);</span><br><span class="line">pts.Add(pt2);</span><br><span class="line">pts.Add(pt3);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts2 = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts2.Add(pt2);</span><br><span class="line">pts2.Add(pt3);</span><br><span class="line">pts2.Add(pt4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// pt and line overlap</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polyline);         <span class="comment">// isSimple = true</span></span><br><span class="line">overlaps = GeometryEngine.Instance.Overlaps(polyline, pt1);                  <span class="comment">// overlaps = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// line and line</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Polyline polyline2 = PolylineBuilderEx.CreatePolyline(pts2);</span><br><span class="line">isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polyline2);             <span class="comment">// isSimple = true</span></span><br><span class="line">overlaps = GeometryEngine.Instance.Overlaps(polyline, polyline2);            <span class="comment">// overlaps = true</span></span><br></pre></td></tr></table></figure>

<h3 id="从-WGS84-到-Web墨卡托的项目"><a href="#从-WGS84-到-Web墨卡托的项目" class="headerlink" title="从 WGS84 到 Web墨卡托的项目"></a>从 WGS84 到 Web墨卡托的项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, SpatialReferences.WGS84);</span><br><span class="line">Geometry result = GeometryEngine.Instance.Project(pt, SpatialReferences.WebMercator);</span><br><span class="line">MapPoint projectedPt = result <span class="keyword">as</span> MapPoint;</span><br></pre></td></tr></table></figure>

<h3 id="WGS84的项目"><a href="#WGS84的项目" class="headerlink" title="WGS84的项目"></a>WGS84的项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create the polygon</span></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>, SpatialReferences.WGS84));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(pts);</span><br><span class="line"><span class="comment">// ensure it is simple</span></span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polygon);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the spatial reference to project to</span></span><br><span class="line">SpatialReference northPole = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">102018</span>);   <span class="comment">// north pole stereographic </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// project</span></span><br><span class="line">Geometry geometry = GeometryEngine.Instance.Project(polygon, northPole);</span><br></pre></td></tr></table></figure>

<h3 id="查询正常"><a href="#查询正常" class="headerlink" title="查询正常"></a>查询正常</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&#123;\&quot;curvePaths\&quot;:[[[-13046586.8335,4036570.6796000004],&quot;</span> +</span><br><span class="line">              <span class="string">&quot;&#123;\&quot;c\&quot;:[[-13046645.107099999,4037152.5873000026],&quot;</span> +</span><br><span class="line">              <span class="string">&quot;[-13046132.776277589,4036932.1325614937]]&#125;]],\&quot;spatialReference\&quot;:&#123;\&quot;wkid\&quot;:3857&#125;&#125;&quot;</span>;</span><br><span class="line">Polyline polyline = PolylineBuilderEx.FromJson(json);</span><br><span class="line"></span><br><span class="line">EllipticArcSegment arc = polyline.Parts[<span class="number">0</span>][<span class="number">0</span>] <span class="keyword">as</span> EllipticArcSegment;</span><br><span class="line"></span><br><span class="line"><span class="comment">// No extension, distanceAlongCurve = 0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use the polyline</span></span><br><span class="line">Polyline poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.NoExtension, <span class="number">0.5</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// or a segment</span></span><br><span class="line">LineSegment seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.NoExtension, <span class="number">0.5</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TangentAtFrom, distanceAlongCurve = -1.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">-1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">-1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TangentAtTo (ignored because distanceAlongCurve &lt; 0), distanceAlongCurve = -1.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendTangentAtTo, <span class="number">-1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendTangentAtTo, <span class="number">-1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TangentAtTo, distanceAlongCurve = 1.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendTangentAtTo, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendTangentAtTo, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TangentAtFrom (ignored because distanceAlongCurve &gt; 0), distanceAlongCurve = 1.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// EmbeddedAtTo, distanceAlongCurve = 1.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendEmbeddedAtTo, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendEmbeddedAtTo, <span class="number">1.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// EmbeddedAtFrom, distanceAlongCurve = -0.2</span></span><br><span class="line">poly_normal = GeometryEngine.Instance.QueryNormal(polyline, SegmentExtensionType.ExtendEmbeddedAtFrom, <span class="number">-0.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br><span class="line">seg_normal = GeometryEngine.Instance.QueryNormal(arc, SegmentExtensionType.ExtendEmbeddedAtFrom, <span class="number">-0.2</span>, AsRatioOrLength.AsRatio, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查询点"><a href="#查询点" class="headerlink" title="查询点"></a>查询点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Horizontal line segment</span></span><br><span class="line">Coordinate2D start = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D end = <span class="keyword">new</span> Coordinate2D(<span class="number">11</span>, <span class="number">1</span>);</span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(start, end, sr);</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(line);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don&#x27;t extend the segment</span></span><br><span class="line"></span><br><span class="line">MapPoint outPoint = GeometryEngine.Instance.QueryPoint(polyline, SegmentExtensionType.NoExtension, <span class="number">1.0</span>, AsRatioOrLength.AsLength);</span><br><span class="line"><span class="comment">// outPoint = (2, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or the segment</span></span><br><span class="line">MapPoint outPoint_seg = GeometryEngine.Instance.QueryPoint(line, SegmentExtensionType.NoExtension, <span class="number">1.0</span>, AsRatioOrLength.AsLength);</span><br><span class="line"><span class="comment">// outPoint_seg = (2, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Extend infinitely in both directions</span></span><br><span class="line">outPoint = GeometryEngine.Instance.QueryPoint(polyline, SegmentExtensionType.ExtendTangents, <span class="number">1.5</span>, AsRatioOrLength.AsRatio);</span><br><span class="line"><span class="comment">// outPoint = (16, 1)</span></span><br><span class="line">outPoint_seg = GeometryEngine.Instance.QueryPoint(line, SegmentExtensionType.ExtendTangents, <span class="number">1.5</span>, AsRatioOrLength.AsRatio);</span><br><span class="line"><span class="comment">// outPoint_seg = (16, 1)</span></span><br></pre></td></tr></table></figure>

<h3 id="查询点和距离"><a href="#查询点和距离" class="headerlink" title="查询点和距离"></a>查询点和距离</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Horizontal line segment</span></span><br><span class="line">List&lt;MapPoint&gt; linePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">linePts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line">linePts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">11.0</span>, <span class="number">1.0</span>, SpatialReferences.WGS84));</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(linePts);</span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polyline);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don&#x27;t extent the segment</span></span><br><span class="line">SegmentExtensionType extension = SegmentExtensionType.NoExtension;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A point on the line segment</span></span><br><span class="line">MapPoint inPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">2</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> distanceAlongCurve, distanceFromCurve;</span><br><span class="line">LeftOrRightSide whichSide;</span><br><span class="line">AsRatioOrLength asRatioOrLength = AsRatioOrLength.AsLength;</span><br><span class="line"></span><br><span class="line">MapPoint outPoint = GeometryEngine.Instance.QueryPointAndDistance(polyline, extension, inPoint, asRatioOrLength, <span class="keyword">out</span> distanceAlongCurve, <span class="keyword">out</span> distanceFromCurve, <span class="keyword">out</span> whichSide);</span><br><span class="line"><span class="comment">// outPoint = 2, 1</span></span><br><span class="line"><span class="comment">// distanceAlongCurve = 1</span></span><br><span class="line"><span class="comment">// distanceFromCurve = 0</span></span><br><span class="line"><span class="comment">// whichSide = GeometryEngine.Instance.LeftOrRightSide.LeftSide</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Extend infinitely in both directions</span></span><br><span class="line">extension = SegmentExtensionType.ExtendTangents;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A point on the left side</span></span><br><span class="line">inPoint = MapPointBuilderEx.CreateMapPoint(<span class="number">16</span>, <span class="number">6</span>, SpatialReferences.WGS84);</span><br><span class="line">asRatioOrLength = AsRatioOrLength.AsRatio;</span><br><span class="line"></span><br><span class="line">outPoint = GeometryEngine.Instance.QueryPointAndDistance(polyline, extension, inPoint, asRatioOrLength, <span class="keyword">out</span> distanceAlongCurve, <span class="keyword">out</span> distanceFromCurve, <span class="keyword">out</span> whichSide);</span><br><span class="line"><span class="comment">// outPoint = 16, 1</span></span><br><span class="line"><span class="comment">// distanceAlongCurve = 1.5</span></span><br><span class="line"><span class="comment">// distanceFromCurve = 5</span></span><br><span class="line"><span class="comment">// whichSide = GeometryEngine.Instance.LeftOrRightSide.LeftSide</span></span><br></pre></td></tr></table></figure>

<h3 id="查询切线"><a href="#查询切线" class="headerlink" title="查询切线"></a>查询切线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// No extension, distanceAlongCurve = 0.5</span></span><br><span class="line">LineSegment tangent = GeometryEngine.Instance.QueryTangent(line, SegmentExtensionType.NoExtension, <span class="number">0.5</span>, AsRatioOrLength.AsRatio, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// tangent.StartCoordinate = (0.5, 0.0)</span></span><br><span class="line"><span class="comment">// tangent.EndCoordinate = (1.5, 0.0)</span></span><br><span class="line"></span><br><span class="line">tangent = GeometryEngine.Instance.QueryTangent(line, SegmentExtensionType.NoExtension, <span class="number">1.5</span>, AsRatioOrLength.AsLength, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// tangent.StartCoordinate = (1.0, 0.0)</span></span><br><span class="line"><span class="comment">// tangent.EndCoordinate = (2.0, 0.0)</span></span><br><span class="line"></span><br><span class="line">tangent = GeometryEngine.Instance.QueryTangent(line, SegmentExtensionType.ExtendTangentAtTo, <span class="number">1.5</span>, AsRatioOrLength.AsLength, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// tangent.StartCoordinate = (1.5, 0.0)</span></span><br><span class="line"><span class="comment">// tangent.EndCoordinate = (2.5, 0.0)</span></span><br><span class="line"></span><br><span class="line">tangent = GeometryEngine.Instance.QueryTangent(line, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">-1.5</span>, AsRatioOrLength.AsLength, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// tangent.StartCoordinate = (-1.5, 0.0)</span></span><br><span class="line"><span class="comment">// tangent.EndCoordinate = (-0.5, 0.0)</span></span><br><span class="line"></span><br><span class="line">tangent = GeometryEngine.Instance.QueryTangent(line, SegmentExtensionType.ExtendTangentAtFrom, <span class="number">-0.5</span>, AsRatioOrLength.AsRatio, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// tangent.StartCoordinate = (-0.5, 0.0)</span></span><br><span class="line"><span class="comment">// tangent.EndCoordinate = (0.5, 0.0)</span></span><br></pre></td></tr></table></figure>

<h3 id="围绕线反射多边形"><a href="#围绕线反射多边形" class="headerlink" title="围绕线反射多边形"></a>围绕线反射多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line">Coordinate2D start = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">Coordinate2D end = <span class="keyword">new</span> Coordinate2D(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">LineSegment line = LineBuilderEx.CreateLineSegment(start, end, sr);</span><br><span class="line"></span><br><span class="line">Coordinate2D[] coords = <span class="keyword">new</span> Coordinate2D[]</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">2</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coords, sr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reflect a polygon about the line</span></span><br><span class="line">Polygon reflectedPolygon = GeometryEngine.Instance.ReflectAboutLine(polygon, line) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reflectedPolygon points are </span></span><br><span class="line"><span class="comment">//    (2, -1), (4, -1), (4, 1), (2, -1)</span></span><br></pre></td></tr></table></figure>

<h3 id="确定两个几何图形之间的关系"><a href="#确定两个几何图形之间的关系" class="headerlink" title="确定两个几何图形之间的关系"></a>确定两个几何图形之间的关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set up some geometries</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// points</span></span><br><span class="line">MapPoint point0 = MapPointBuilderEx.CreateMapPoint(<span class="number">0</span>, <span class="number">0</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint point1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, SpatialReferences.WGS84);</span><br><span class="line">MapPoint point2 = MapPointBuilderEx.CreateMapPoint(<span class="number">-5</span>, <span class="number">5</span>, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// multipoint</span></span><br><span class="line">List&lt;MapPoint&gt; points = <span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; point0, point1, point2 &#125;;</span><br><span class="line">Multipoint multipoint = MultipointBuilderEx.CreateMultipoint(points, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon </span></span><br><span class="line">List&lt;Coordinate2D&gt; polygonCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(polygonCoords, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polylines</span></span><br><span class="line">Polyline polyline1 = PolylineBuilderEx.CreatePolyline(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">-9.1</span>, <span class="number">0.1</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">9</span>)), SpatialReferences.WGS84);</span><br><span class="line">Polyline polyline2 = PolylineBuilderEx.CreatePolyline(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">-5</span>, <span class="number">5</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">5</span>)), SpatialReferences.WGS84);</span><br><span class="line">Polyline polyline3 = PolylineBuilderEx.CreatePolyline(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">2.09</span>, <span class="number">-2.04</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">10</span>)), SpatialReferences.WGS84);</span><br><span class="line">Polyline polyline4 = PolylineBuilderEx.CreatePolyline(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">-5</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">5</span>)), SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">List&lt;Segment&gt; segments = <span class="keyword">new</span> List&lt;Segment&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">5.05</span>, <span class="number">-2.87</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">6.35</span>, <span class="number">1.57</span>)),</span><br><span class="line">    LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">6.35</span>, <span class="number">1.57</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">4.13</span>, <span class="number">2.59</span>)),</span><br><span class="line">    LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">4.13</span>, <span class="number">2.59</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">&#125;;</span><br><span class="line">Polyline polyline5 = PolylineBuilderEx.CreatePolyline(segments, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">segments.Add(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">5</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">10</span>)));</span><br><span class="line"></span><br><span class="line">Polyline polyline6 = PolylineBuilderEx.CreatePolyline(segments, SpatialReferences.WGS84);</span><br><span class="line">Polyline polyline7 = PolylineBuilderEx.CreatePolyline(polyline5);</span><br><span class="line">Polyline polyline8 = PolylineBuilderEx.CreatePolyline(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">5</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">10</span>)), SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line">segments.Clear();</span><br><span class="line">segments.Add(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">0.6</span>, <span class="number">3.5</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">0.7</span>, <span class="number">7</span>)));</span><br><span class="line">segments.Add(LineBuilderEx.CreateLineSegment(<span class="keyword">new</span> Coordinate2D(<span class="number">0.7</span>, <span class="number">7</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">9</span>)));</span><br><span class="line"></span><br><span class="line">Polyline polyline9 = PolylineBuilderEx.CreatePolyline(segments, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now do the Related tests</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Interior/Interior Intersects</span></span><br><span class="line"><span class="built_in">string</span> scl = <span class="string">&quot;T********&quot;</span>;</span><br><span class="line"><span class="built_in">bool</span> related = GeometryEngine.Instance.Relate(polygon, polyline1, scl);     <span class="comment">// related = true</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(point0, point1, scl);              <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(point0, multipoint, scl);          <span class="comment">// related = true</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(multipoint, polygon, scl);         <span class="comment">// related = true</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(multipoint, polyline1, scl);       <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(polyline2, point2, scl);           <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(point1, polygon, scl);             <span class="comment">// related = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Interior/Boundary Intersects</span></span><br><span class="line">scl = <span class="string">&quot;*T*******&quot;</span>;</span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline2, scl);          <span class="comment">// related = true</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline3, scl);          <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(point1, polygon, scl);             <span class="comment">// related = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Boundary/Boundary Interior intersects</span></span><br><span class="line">scl = <span class="string">&quot;***T*****&quot;</span>;</span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline4, scl);          <span class="comment">// related = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Overlaps Dim1</span></span><br><span class="line">scl = <span class="string">&quot;1*T***T**&quot;</span>;</span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline5, scl);          <span class="comment">// related = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Crosses Area/Line (LineB crosses PolygonA)</span></span><br><span class="line">scl = <span class="string">&quot;1020F1102&quot;</span>;</span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline6, scl);          <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline9, scl);          <span class="comment">// related = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Boundary/Boundary Touches</span></span><br><span class="line">scl = <span class="string">&quot;F***T****&quot;</span>;</span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline7, scl);          <span class="comment">// related = false</span></span><br><span class="line">related = GeometryEngine.Instance.Relate(polygon, polyline8, scl);          <span class="comment">// related = true</span></span><br></pre></td></tr></table></figure>

<h3 id="替换多边形中的-NaN-Z"><a href="#替换多边形中的-NaN-Z" class="headerlink" title="替换多边形中的 NaN Z"></a>替换多边形中的 NaN Z</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate3D&gt; coordsZ = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">2</span>, <span class="built_in">double</span>.NaN),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">7</span>, <span class="number">8</span>, <span class="built_in">double</span>.NaN)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(coordsZ);</span><br><span class="line"><span class="comment">// polygon.HasZ = true</span></span><br><span class="line"></span><br><span class="line">Polygon polygonZReplaced = GeometryEngine.Instance.ReplaceNaNZs(polygon, <span class="number">-1</span>) <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygonZReplaced.Points[0].Z = -1</span></span><br><span class="line"><span class="comment">// polygonZReplaced.Points[1].Z = 3</span></span><br><span class="line"><span class="comment">// polygonZReplaced.Points[2].Z = -1</span></span><br></pre></td></tr></table></figure>

<h3 id="改变多边形的形状"><a href="#改变多边形的形状" class="headerlink" title="改变多边形的形状"></a>改变多边形的形状</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; polygon1Coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-11000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1000</span>, <span class="number">-11000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1000</span>, <span class="number">-12000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-12000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">-11000</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reshaper coordinates intersect the polygon</span></span><br><span class="line">List&lt;Coordinate2D&gt; reshaperCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1500</span>, <span class="number">-11800</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-2600</span>, <span class="number">-11800</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">102010</span>);</span><br><span class="line">Polygon polygon1 = PolygonBuilderEx.CreatePolygon(polygon1Coords, sr);</span><br><span class="line">Polyline reshaper = PolylineBuilderEx.CreatePolyline(reshaperCoords, sr);</span><br><span class="line"></span><br><span class="line">Polygon outPolygon = GeometryEngine.Instance.Reshape(polygon1, reshaper) <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// outPolygon.PartCount = 1</span></span><br><span class="line"></span><br><span class="line">ReadOnlySegmentCollection segments = outPolygon.Parts[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// segments.Count = 4</span></span><br><span class="line"><span class="comment">// outPolygon.PointCount = 5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> json = GeometryEngine.Instance.ExportToJson(JsonExportFlags.JsonExportSkipCRS, outPolygon);</span><br><span class="line"><span class="comment">// json = &quot;&#123;\&quot;rings\&quot;:[[[0,-11800],[0,-11000],[1000,-11000],[1000,-11800],[0,-11800]]]&#125;&quot;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// example where the Reshaper polyline doesn&#x27;t intersect the input</span></span><br><span class="line"></span><br><span class="line">reshaperCoords.Clear();</span><br><span class="line">reshaperCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1000</span>, <span class="number">1000</span>));</span><br><span class="line">reshaperCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2000</span>, <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">reshaper = PolylineBuilderEx.CreatePolyline(reshaperCoords, sr);</span><br><span class="line"></span><br><span class="line">outPolygon = GeometryEngine.Instance.Reshape(polygon1, reshaper) <span class="keyword">as</span> Polygon;</span><br><span class="line"><span class="comment">// outPolygon = null</span></span><br></pre></td></tr></table></figure>

<h3 id="反转多边形中点的顺序"><a href="#反转多边形中点的顺序" class="headerlink" title="反转多边形中点的顺序"></a>反转多边形中点的顺序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; list2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(list2D);</span><br><span class="line"></span><br><span class="line">Geometry g = GeometryEngine.Instance.ReverseOrientation(polygon);</span><br><span class="line">Polygon gPolygon = g <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// gPolygon.Points[0] = 1.0, 1.0</span></span><br><span class="line"><span class="comment">// gPolygon.Points[1] = 2.0, 1.0</span></span><br><span class="line"><span class="comment">// gPolygon.Points[2] = 2.0, 2.0</span></span><br><span class="line"><span class="comment">// gPolygon.Points[3] = 1.0, 2.0</span></span><br><span class="line"><span class="comment">// gPolygon.Points[4] = 1.0, 1.0</span></span><br><span class="line"><span class="comment">// gPolygon.Area = -1 * polygon.Area</span></span><br></pre></td></tr></table></figure>

<h3 id="旋转地图点"><a href="#旋转地图点" class="headerlink" title="旋转地图点"></a>旋转地图点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>);</span><br><span class="line">MapPoint rotatePt = MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">Geometry result = GeometryEngine.Instance.Rotate(pt, rotatePt, Math.PI / <span class="number">2</span>);</span><br><span class="line"><span class="comment">// result point is (3, 1)</span></span><br></pre></td></tr></table></figure>

<h3 id="旋转折线"><a href="#旋转折线" class="headerlink" title="旋转折线"></a>旋转折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rotate a polyline</span></span><br><span class="line"></span><br><span class="line">MapPoint fixedPt = MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">5.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">5.0</span>, <span class="number">1.0</span>));</span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"></span><br><span class="line">Polyline rotated = GeometryEngine.Instance.Rotate(polyline, fixedPt, Math.PI / <span class="number">4</span>) <span class="keyword">as</span> Polyline;  <span class="comment">// rotate 45 deg</span></span><br></pre></td></tr></table></figure>

<h3 id="缩放几何图形"><a href="#缩放几何图形" class="headerlink" title="缩放几何图形"></a>缩放几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">MapPoint midPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line"><span class="comment">// polyline.Length = 6</span></span><br><span class="line"><span class="comment">// polyline.Length3D = 0</span></span><br><span class="line">Geometry g = GeometryEngine.Instance.Scale(polyline, midPt, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">Polyline resultPolyline = g <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// resultPolyline.length  = 3</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[0] = 1.25, 1.25, 3</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[1] = 1.25, 2.25, 3</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[2] = 2.25, 2.25, 3</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[3] = 2.25, 1.25, 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3D point - scale in 3d</span></span><br><span class="line">MapPoint midPtZ = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>, <span class="number">1</span>);</span><br><span class="line">g = GeometryEngine.Instance.Scale(polyline, midPtZ, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.25</span>);</span><br><span class="line">resultPolyline = g <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// resultPolyline.Points[0] = 1.25, 1.25, 1.5</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[1] = 1.25, 2.25, 1.5</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[2] = 2.25, 2.25, 1.5</span></span><br><span class="line"><span class="comment">// resultPolyline.Points[3] = 2.25, 1.25, 1.5</span></span><br></pre></td></tr></table></figure>

<h3 id="设置折线中的所有-Z"><a href="#设置折线中的所有-Z" class="headerlink" title="设置折线中的所有 Z"></a>设置折线中的所有 Z</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate3D&gt; coordsZ = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">7</span>, <span class="number">8</span>, <span class="built_in">double</span>.NaN)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coordsZ);</span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"></span><br><span class="line">Polyline polylineSetZ = GeometryEngine.Instance.SetConstantZ(polyline, <span class="number">-1</span>) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// polylineSetZ.Points[0].Z = -1</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[1].Z = -1</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[2].Z = -1</span></span><br><span class="line"></span><br><span class="line">polylineSetZ = GeometryEngine.Instance.SetConstantZ(polyline, <span class="built_in">double</span>.NaN) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[0].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[0].Z = NaN</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[1].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[1].Z = NaN</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[2].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[2].Z = NaN</span></span><br><span class="line"></span><br><span class="line">polylineSetZ = GeometryEngine.Instance.SetConstantZ(polyline, <span class="built_in">double</span>.PositiveInfinity) <span class="keyword">as</span> Polyline;</span><br><span class="line"><span class="comment">// polyline.HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[0].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[0].Z = double.PositiveInfinity</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[1].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[1].Z = double.PositiveInfinity</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[2].HasZ = true</span></span><br><span class="line"><span class="comment">// polylineSetZ.Points[2].Z = double.PositiveInfinity</span></span><br></pre></td></tr></table></figure>

<h3 id="计算地球椭球体表面上的几何面积-形状保存面积"><a href="#计算地球椭球体表面上的几何面积-形状保存面积" class="headerlink" title="计算地球椭球体表面上的几何面积 - 形状保存面积"></a>计算地球椭球体表面上的几何面积 - 形状保存面积</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pt</span></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, SpatialReferences.WebMercator);</span><br><span class="line"><span class="built_in">double</span> area = GeometryEngine.Instance.ShapePreservingArea(pt);         <span class="comment">// area = 0</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// multipoint</span></span><br><span class="line">Multipoint mPt = MultipointBuilderEx.CreateMultipoint(pts);</span><br><span class="line">area = GeometryEngine.Instance.ShapePreservingArea(mPt);               <span class="comment">// area = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts);</span><br><span class="line">area = GeometryEngine.Instance.ShapePreservingArea(polyline);          <span class="comment">// area = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon</span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(pts, SpatialReferences.WGS84);</span><br><span class="line">area = GeometryEngine.Instance.ShapePreservingArea(polygon);</span><br><span class="line"></span><br><span class="line">polygon = PolygonBuilderEx.CreatePolygon(pts, SpatialReferences.WebMercator);</span><br><span class="line">area = GeometryEngine.Instance.ShapePreservingArea(polygon);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">polygon = PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">-170</span>, <span class="number">45</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">170</span>, <span class="number">45</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">170</span>, <span class="number">-45</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">-170</span>, <span class="number">-54</span>)</span><br><span class="line">&#125;, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> area_meters = GeometryEngine.Instance.ShapePreservingArea(polygon);<span class="comment">// , AreaUnits.SquareMeters);</span></span><br><span class="line"><span class="keyword">var</span> area_miles = GeometryEngine.Instance.ShapePreservingArea(polygon, AreaUnit.SquareMiles);</span><br><span class="line"></span><br><span class="line"><span class="comment">// area_meters - 352556425383104.37</span></span><br><span class="line"><span class="comment">// area_miles - 136122796.848425</span></span><br></pre></td></tr></table></figure>

<h3 id="计算地球椭球体表面几何形状的长度-形状保存长度"><a href="#计算地球椭球体表面几何形状的长度-形状保存长度" class="headerlink" title="计算地球椭球体表面几何形状的长度 - 形状保存长度"></a>计算地球椭球体表面几何形状的长度 - 形状保存长度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pt</span></span><br><span class="line">MapPoint pt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, SpatialReferences.WebMercator);</span><br><span class="line"><span class="built_in">double</span> len = GeometryEngine.Instance.ShapePreservingLength(pt);          <span class="comment">// len = 0</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">1.0</span>, <span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// multipoint</span></span><br><span class="line">Multipoint mPt = MultipointBuilderEx.CreateMultipoint(pts);</span><br><span class="line">len = GeometryEngine.Instance.ShapePreservingLength(mPt);                <span class="comment">// len = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// polyline</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(pts, SpatialReferences.WGS84);</span><br><span class="line">len = GeometryEngine.Instance.ShapePreservingLength(polyline);</span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon</span></span><br><span class="line">Polygon polygon = PolygonBuilderEx.CreatePolygon(pts, SpatialReferences.WGS84);</span><br><span class="line">len = GeometryEngine.Instance.ShapePreservingLength(polygon);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">-170</span>, <span class="number">0</span>),</span><br><span class="line">    MapPointBuilderEx.CreateMapPoint( <span class="number">170</span>, <span class="number">0</span>)</span><br><span class="line">&#125;, SpatialReferences.WGS84);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> length_meters = GeometryEngine.Instance.ShapePreservingLength(polyline); <span class="comment">// , LinearUnits.Meters);</span></span><br><span class="line"><span class="keyword">var</span> length_miles = GeometryEngine.Instance.ShapePreservingLength(polyline, LinearUnit.Miles);</span><br><span class="line"></span><br><span class="line"><span class="comment">// length_meters - 37848626.869713023</span></span><br><span class="line"><span class="comment">// length_miles - 23518.046402579574</span></span><br></pre></td></tr></table></figure>

<h3 id="侧缓冲器"><a href="#侧缓冲器" class="headerlink" title="侧缓冲器"></a>侧缓冲器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// right side, round caps</span></span><br><span class="line">SpatialReference sr = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">102010</span>);</span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1200</span>, <span class="number">5800</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>, <span class="number">5800</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>, <span class="number">6000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1300</span>, <span class="number">6000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1300</span>, <span class="number">5700</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords, sr);</span><br><span class="line">Polygon output = GeometryEngine.Instance.SideBuffer(polyline, <span class="number">20</span>, LeftOrRightSide.RightSide, LineCapType.Round) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="侧缓冲器很多"><a href="#侧缓冲器很多" class="headerlink" title="侧缓冲器很多"></a>侧缓冲器很多</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SpatialReference spatialReference = SpatialReferenceBuilder.CreateSpatialReference(<span class="number">102010</span>);</span><br><span class="line">List&lt;Coordinate2D&gt; coordinates = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1200</span>, <span class="number">5800</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>, <span class="number">5800</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>, <span class="number">6000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1300</span>, <span class="number">6000</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1300</span>, <span class="number">5700</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline1 = PolylineBuilderEx.CreatePolyline(coordinates, spatialReference);</span><br><span class="line"></span><br><span class="line">coordinates.Clear();</span><br><span class="line">coordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1400</span>, <span class="number">6050</span>));</span><br><span class="line">coordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1600</span>, <span class="number">6150</span>));</span><br><span class="line">coordinates.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1800</span>, <span class="number">6050</span>));</span><br><span class="line"></span><br><span class="line">Polyline polyline2 = PolylineBuilderEx.CreatePolyline(coordinates, spatialReference);</span><br><span class="line">List&lt;Polyline&gt; polylines = <span class="keyword">new</span> List&lt;Polyline&gt;() &#123; polyline1, polyline2 &#125;;</span><br><span class="line">IReadOnlyList&lt;Geometry&gt; outGeometries = GeometryEngine.Instance.SideBuffer(polylines, <span class="number">10</span>, LeftOrRightSide.RightSide, LineCapType.Round);</span><br></pre></td></tr></table></figure>

<h3 id="简化多边形"><a href="#简化多边形" class="headerlink" title="简化多边形"></a>简化多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g1 = PolygonBuilderEx.FromJson(<span class="string">&quot;&#123;\&quot;rings\&quot;: [ [ [0, 0], [10, 0], [10, 10], [0, 10] ] ] &#125;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> result = GeometryEngine.Instance.Area(g1);      <span class="comment">// result = -100.0   - negative due to wrong ring orientation</span></span><br><span class="line">                                                    <span class="comment">// simplify it</span></span><br><span class="line"><span class="keyword">var</span> result2 = GeometryEngine.Instance.Area(GeometryEngine.Instance.SimplifyAsFeature(g1, <span class="literal">true</span>));</span><br><span class="line"><span class="comment">// result2 = 100.0  - positive due to correct ring orientation (clockwise)</span></span><br></pre></td></tr></table></figure>

<h3 id="简化具有相交、重叠的折线"><a href="#简化具有相交、重叠的折线" class="headerlink" title="简化具有相交、重叠的折线"></a>简化具有相交、重叠的折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SpatialReference sr = SpatialReferences.WGS84;</span><br><span class="line"></span><br><span class="line"><span class="comment">// build a line that has segments that cross over each other</span></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(coords, sr);</span><br><span class="line"><span class="comment">// polyline.PartCount = 1</span></span><br><span class="line">ReadOnlyPartCollection parts = polyline.Parts;</span><br><span class="line">ReadOnlySegmentCollection segments = parts[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// segments.Count = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  note there is a difference between SimpleAsFeature (doesn&#x27;t detect intersections and overlaps, determines if it&#x27;s simple enough for gdb storage)</span></span><br><span class="line"><span class="comment">//  and SimplifyPolyline  (does detect intersections etc)</span></span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(polyline, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// isSimple = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// simplify it (with force = false)</span></span><br><span class="line"><span class="comment">// because it has already been deemed &#x27;simple&#x27; (previous IsSimpleAsFeature call) no detection of intersections, overlaps occur</span></span><br><span class="line">Polyline simplePolyline = GeometryEngine.Instance.SimplifyPolyline(polyline, SimplifyType.Planar, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// simplePolyline.PartCount = 1</span></span><br><span class="line">ReadOnlyPartCollection simpleParts = simplePolyline.Parts;</span><br><span class="line">ReadOnlySegmentCollection simpleSegments = simpleParts[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// simpleSegments.Count = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// simplify it (with force = true)</span></span><br><span class="line"><span class="comment">// detection of intersections, overlaps occur </span></span><br><span class="line">simplePolyline = GeometryEngine.Instance.SimplifyPolyline(polyline, SimplifyType.Planar, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// simplePolyline.PartCount = 3</span></span><br><span class="line">simpleParts = simplePolyline.Parts;</span><br><span class="line">simpleSegments = simpleParts[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// simpleSegments.Count = 1</span></span><br></pre></td></tr></table></figure>

<h3 id="将多边形切成相等的部分"><a href="#将多边形切成相等的部分" class="headerlink" title="将多边形切成相等的部分"></a>将多边形切成相等的部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slices = GeometryEngine.Instance.SlicePolygonIntoEqualParts(polygon, <span class="number">3</span>, <span class="number">0</span>, SliceType.Blocks);</span><br><span class="line"><span class="comment">// slices.Count = 3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// simple polygon</span></span><br><span class="line">List&lt;Coordinate2D&gt; list2D = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">list2D.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon p = PolygonBuilderEx.CreatePolygon(list2D);</span><br><span class="line">slices = GeometryEngine.Instance.SlicePolygonIntoEqualParts(p, <span class="number">2</span>, <span class="number">0</span>, SliceType.Strips);</span><br><span class="line"></span><br><span class="line"><span class="comment">// slice[0] coordinates - (1.0, 1.0), (1.0, 1.5), (2.0, 1.5), (2.0, 1.0), (1.0, 1.0) </span></span><br><span class="line"><span class="comment">// slice[1] coordinates - (1.0, 1.5), (1.0, 2.0), (2.0, 2.0), (2.0, 1.5), (1.0, 1.5)</span></span><br><span class="line"></span><br><span class="line">slices = GeometryEngine.Instance.SlicePolygonIntoEqualParts(p, <span class="number">2</span>, Math.PI / <span class="number">4</span>, SliceType.Strips);</span><br><span class="line"></span><br><span class="line"><span class="comment">// slice[0] coordinates - (1.0, 1.0), (1.0, 2.0), (2.0, 1.0), (1.0, 1.0)</span></span><br><span class="line"><span class="comment">// slice[1] coordinates - (1.0, 2.0), (2.0, 2.0), (2.0, 1.0), (1.0, 2.0)</span></span><br></pre></td></tr></table></figure>

<h3 id="在点拆分多部分"><a href="#在点拆分多部分" class="headerlink" title="在点拆分多部分"></a>在点拆分多部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define a polyline</span></span><br><span class="line">MapPoint startPointZ = MapPointBuilderEx.CreateMapPoint(<span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">MapPoint endPointZ = MapPointBuilderEx.CreateMapPoint(<span class="number">20</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">Polyline polylineZ = PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; startPointZ, endPointZ &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// define a split point</span></span><br><span class="line">MapPoint splitPointAboveLine = MapPointBuilderEx.CreateMapPoint(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> splitOccurred;</span><br><span class="line"><span class="built_in">int</span> partIndex;</span><br><span class="line"><span class="built_in">int</span> segmentIndex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// split the polyline at the point.  dont project the split point onto the line, don&#x27;t create a new part</span></span><br><span class="line"><span class="keyword">var</span> splitPolyline = GeometryEngine.Instance.SplitAtPoint(polylineZ, splitPointAboveLine, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = true</span></span><br><span class="line"><span class="comment">// partIndex = 0</span></span><br><span class="line"><span class="comment">// segmentIndex = 1</span></span><br><span class="line"><span class="comment">// splitPolyline.PointCount = 3</span></span><br><span class="line"><span class="comment">// splitPolyline.PartCount = 1</span></span><br><span class="line"><span class="comment">// splitPolyline coordinates are (1, 1, 5), (10, 10, 10), (20, 1, 5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// split the polyline at the point.  dont project the split point onto the line, do create a new part</span></span><br><span class="line">splitPolyline = GeometryEngine.Instance.SplitAtPoint(polylineZ, splitPointAboveLine, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = true</span></span><br><span class="line"><span class="comment">// partIndex = 1</span></span><br><span class="line"><span class="comment">// segmentIndex = 0</span></span><br><span class="line"><span class="comment">// splitPolyline.PointCount = 4</span></span><br><span class="line"><span class="comment">// splitPolyline.PartCount = 2</span></span><br><span class="line"><span class="comment">// splitPolyline first part coordinates are (1, 1, 5), (10, 10, 10)</span></span><br><span class="line"><span class="comment">// splitPolyline second part coordinates are (10, 10, 10), (20, 1, 5)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// split the polyline at the point.  do project the split point onto the line, don&#x27;t create a new part</span></span><br><span class="line">splitPolyline = GeometryEngine.Instance.SplitAtPoint(polylineZ, splitPointAboveLine, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = true</span></span><br><span class="line"><span class="comment">// partIndex = 0</span></span><br><span class="line"><span class="comment">// segmentIndex = 1</span></span><br><span class="line"><span class="comment">// splitPolyline.PointCount = 3</span></span><br><span class="line"><span class="comment">// splitPolyline.PartCount = 1</span></span><br><span class="line"><span class="comment">// splitPolyline coordinates are (1, 1, 5), (10, 10, 5), (20, 1, 5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// split the polyline at the point.  do project the split point onto the line, do create a new part</span></span><br><span class="line">splitPolyline = GeometryEngine.Instance.SplitAtPoint(polylineZ, splitPointAboveLine, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = true</span></span><br><span class="line"><span class="comment">// partIndex = 1</span></span><br><span class="line"><span class="comment">// segmentIndex = 0</span></span><br><span class="line"><span class="comment">// splitPolyline.PointCount = 4</span></span><br><span class="line"><span class="comment">// splitPolyline.PartCount = 2</span></span><br><span class="line"><span class="comment">// splitPolyline first part coordinates are (1, 1, 5), (10, 10, 5)</span></span><br><span class="line"><span class="comment">// splitPolyline second part coordinates are (10, 10, 5), (20, 1, 5)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// try to split with a point that won&#x27;t split the line  - pt extends beyond the line</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pointAfterLine = MapPointBuilderEx.CreateMapPoint(<span class="number">50</span>, <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">splitPolyline = GeometryEngine.Instance.SplitAtPoint(polylineZ, pointAfterLine, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = false</span></span><br><span class="line"><span class="comment">// ignore partIndex, sgementIndex</span></span><br><span class="line"><span class="comment">// splitPolyline is the same as polylineZ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span>  multipart polygon</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span></span></span><br><span class="line">List&lt;Coordinate3D&gt; coordsZ = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">10</span>,<span class="number">10</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">10</span>,<span class="number">20</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">20</span>,<span class="number">20</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">20</span>,<span class="number">10</span>,<span class="number">5</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">List&lt;Coordinate3D&gt; coordsZ_2ndPart = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">30</span>,<span class="number">20</span>,<span class="number">10</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">30</span>,<span class="number">30</span>,<span class="number">10</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">35</span>,<span class="number">28</span>,<span class="number">10</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">40</span>,<span class="number">30</span>,<span class="number">10</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">40</span>,<span class="number">20</span>,<span class="number">10</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = <span class="keyword">new</span> PolygonBuilderEx();</span><br><span class="line">builder.HasZ = <span class="literal">true</span>;</span><br><span class="line">builder.AddPart(coordsZ);</span><br><span class="line">builder.AddPart(coordsZ_2ndPart);</span><br><span class="line"></span><br><span class="line">Polygon multipart = builder.ToGeometry();</span><br><span class="line"></span><br><span class="line"><span class="comment">// pointA is closer to the first part of the multipart - the split occurs in the first part</span></span><br><span class="line"><span class="keyword">var</span> pointA = MapPointBuilderEx.CreateMapPoint(<span class="number">22</span>, <span class="number">18</span>, <span class="number">7</span>);</span><br><span class="line"><span class="keyword">var</span> splitPolygon = GeometryEngine.Instance.SplitAtPoint(multipart, pointA, <span class="literal">false</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitPolygon.PointCount = 12</span></span><br><span class="line"><span class="comment">// splitPolygon.PartCount = 2</span></span><br><span class="line"><span class="comment">// splitPolygon first part coordinates  (10, 10, 5), (10, 20, 5), (20, 20, 5), (22, 18, 7), (20, 10, 5), (10, 10, 5)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// pointB is midPoint between the 2 parts - no split will occur</span></span><br><span class="line"><span class="keyword">var</span> pointB = MapPointBuilderEx.CreateMapPoint(<span class="number">25</span>, <span class="number">20</span>, <span class="number">7</span>);</span><br><span class="line">splitPolygon = GeometryEngine.Instance.SplitAtPoint(multipart, pointB, <span class="literal">true</span>, <span class="literal">false</span>, <span class="keyword">out</span> splitOccurred, <span class="keyword">out</span> partIndex, <span class="keyword">out</span> segmentIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitOccurred = false</span></span><br><span class="line"><span class="comment">// ignore partIndex, sgementIndex</span></span><br><span class="line"><span class="comment">// splitPolyline is the same as polylineZ</span></span><br></pre></td></tr></table></figure>

<h3 id="多边形接触另一个多边形"><a href="#多边形接触另一个多边形" class="headerlink" title="多边形接触另一个多边形"></a>多边形接触另一个多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// two disjoint polygons</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">4.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">8</span>, <span class="number">8</span>));</span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line"></span><br><span class="line">Envelope env2 = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">5</span>, <span class="number">5</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> touches = GeometryEngine.Instance.Touches(poly1, poly2);    <span class="comment">// touches = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// another polygon that touches the first</span></span><br><span class="line">Envelope env3 = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">4</span>, <span class="number">4</span>));</span><br><span class="line">Polygon poly3 = PolygonBuilderEx.CreatePolygon(env3);</span><br><span class="line"></span><br><span class="line">touches = GeometryEngine.Instance.Touches(poly1, poly3);         <span class="comment">// touches = true</span></span><br></pre></td></tr></table></figure>

<h3 id="转换2D"><a href="#转换2D" class="headerlink" title="转换2D"></a>转换2D</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Not all of the input points are transformed as some of them are outside of the GCS horizon.</span></span><br><span class="line">Coordinate2D[] inCoords2D = <span class="keyword">new</span> Coordinate2D[]</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-1</span>, <span class="number">-1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-2</span>, <span class="number">-5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-5</span>, <span class="number">-11</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-10</span>, <span class="number">-19</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-17</span>, <span class="number">-29</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-26</span>, <span class="number">-41</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-37</span>, <span class="number">-5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-50</span>, <span class="number">-21</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-65</span>, <span class="number">-39</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">-82</span>, <span class="number">-9</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> arraySize = inCoords2D.Length;</span><br><span class="line"></span><br><span class="line">ProjectionTransformation projTrans = ProjectionTransformation.Create(SpatialReferences.WGS84, SpatialReferenceBuilder.CreateSpatialReference(<span class="number">24891</span>));</span><br><span class="line"></span><br><span class="line">Coordinate2D[] outCoords2D = <span class="keyword">new</span> Coordinate2D[arraySize];</span><br><span class="line"></span><br><span class="line"><span class="comment">// transform and choose to remove the clipped coordinates</span></span><br><span class="line"><span class="built_in">int</span> numPointsTransformed = GeometryEngine.Instance.Transform2D(inCoords2D, projTrans, <span class="keyword">ref</span> outCoords2D, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// numPointsTransformed = 4</span></span><br><span class="line"><span class="comment">// outCoords2D.Length = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// outCoords2D[0] = &#123;5580417.6876455201, 1328841.2376554986&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[1] = &#123;3508774.290814558, -568027.23444226268&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[2] = &#123;1568096.0886155984, -2343435.4394415971&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[3] = &#123;57325.827391741652, 1095146.8917508761&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// transform and don&#x27;t remove the clipped coordinates</span></span><br><span class="line">numPointsTransformed = GeometryEngine.Instance.Transform2D(inCoords2D, projTrans, <span class="keyword">ref</span> outCoords2D, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// numPointsTransformed = 4</span></span><br><span class="line"><span class="comment">// outCoords2D.Length = 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// outCoords2D[0] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[1] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[2] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[3] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[4] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[5] = &#123;double.Nan, double.Nan&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[6] = &#123;5580417.6876455201, 1328841.2376554986&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[7] = &#123;3508774.290814558, -568027.23444226268&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[8] = &#123;1568096.0886155984, -2343435.4394415971&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[9] = &#123;57325.827391741652, 1095146.8917508761&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="转换3D"><a href="#转换3D" class="headerlink" title="转换3D"></a>转换3D</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Not all of the input points are transformed as some of them are outside of the GCS horizon.</span></span><br><span class="line">Coordinate3D[] inCoords3D = <span class="keyword">new</span> Coordinate3D[]</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-2</span>, <span class="number">-5</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-5</span>, <span class="number">-11</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-10</span>, <span class="number">-19</span>, <span class="number">3</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-17</span>, <span class="number">-29</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-26</span>, <span class="number">-41</span>, <span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-37</span>, <span class="number">-5</span>, <span class="number">6</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-50</span>, <span class="number">-21</span>, <span class="number">7</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-65</span>, <span class="number">-39</span>, <span class="number">8</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">-82</span>, <span class="number">-9</span>, <span class="number">9</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> arraySize = inCoords3D.Length;</span><br><span class="line"></span><br><span class="line">ProjectionTransformation projTrans = ProjectionTransformation.Create(SpatialReferences.WGS84, SpatialReferenceBuilder.CreateSpatialReference(<span class="number">24891</span>));</span><br><span class="line"></span><br><span class="line">Coordinate3D[] outCoords3D = <span class="keyword">new</span> Coordinate3D[arraySize];</span><br><span class="line"></span><br><span class="line"><span class="comment">// transform and choose to remove the clipped coordinates</span></span><br><span class="line"><span class="built_in">int</span> numPointsTransformed = GeometryEngine.Instance.Transform3D(inCoords3D, projTrans, <span class="keyword">ref</span> outCoords3D);</span><br><span class="line"></span><br><span class="line"><span class="comment">// numPointsTransformed = 4</span></span><br><span class="line"><span class="comment">// outCoords2D.Length = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// outCoords2D[0] = &#123;5580417.6876455201, 1328841.2376554986, 7&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[1] = &#123;3508774.290814558, -568027.23444226268, 8&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[2] = &#123;1568096.0886155984, -2343435.4394415971, 9&#125;</span></span><br><span class="line"><span class="comment">// outCoords2D[3] = &#123;57325.827391741652, 1095146.8917508761, 10&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="合并两个地图点-创建一个多点"><a href="#合并两个地图点-创建一个多点" class="headerlink" title="合并两个地图点 - 创建一个多点"></a>合并两个地图点 - 创建一个多点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MapPoint pt1 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line">Geometry geometry = GeometryEngine.Instance.Union(pt1, pt2);</span><br><span class="line">Multipoint multipoint = geometry <span class="keyword">as</span> Multipoint;   <span class="comment">// multipoint has point count of 2</span></span><br></pre></td></tr></table></figure>

<h3 id="并集两个多边形"><a href="#并集两个多边形" class="headerlink" title="并集两个多边形"></a>并集两个多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// union two polygons</span></span><br><span class="line"></span><br><span class="line">List&lt;MapPoint&gt; polyPts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">2.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">3.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">6.0</span>));</span><br><span class="line">polyPts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">6.0</span>, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly1 = PolygonBuilderEx.CreatePolygon(polyPts);</span><br><span class="line"><span class="built_in">bool</span> isSimple = GeometryEngine.Instance.IsSimpleAsFeature(poly1);</span><br><span class="line"></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(MapPointBuilderEx.CreateMapPoint(<span class="number">4.0</span>, <span class="number">4.0</span>), MapPointBuilderEx.CreateMapPoint(<span class="number">8</span>, <span class="number">8</span>));</span><br><span class="line">Polygon poly2 = PolygonBuilderEx.CreatePolygon(env);</span><br><span class="line">isSimple = GeometryEngine.Instance.IsSimpleAsFeature(poly2);</span><br><span class="line"></span><br><span class="line">Geometry g = GeometryEngine.Instance.Union(poly1, poly2);</span><br><span class="line">Polygon polyResult = g <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="联合许多折线"><a href="#联合许多折线" class="headerlink" title="联合许多折线"></a>联合许多折线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// union many polylines</span></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; coords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">4</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">4</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">5</span>, <span class="number">6</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">7</span>, <span class="number">8</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">10</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">11</span>, <span class="number">12</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">12</span>, <span class="number">8</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">10</span>, <span class="number">8</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">12</span>, <span class="number">12</span>), <span class="keyword">new</span> Coordinate2D(<span class="number">14</span>, <span class="number">10</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create Disjoint lines</span></span><br><span class="line">List&lt;Polyline&gt; manyLines = <span class="keyword">new</span> List&lt;Polyline&gt;</span><br><span class="line">&#123;</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">0</span>], coords[<span class="number">1</span>], coords[<span class="number">2</span>]&#125;, SpatialReferences.WGS84),</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">3</span>], coords[<span class="number">4</span>], coords[<span class="number">5</span>]&#125;),</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;Coordinate2D&gt;()&#123;coords[<span class="number">6</span>], coords[<span class="number">7</span>], coords[<span class="number">8</span>]&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polyline polyline = GeometryEngine.Instance.Union(manyLines) <span class="keyword">as</span> Polyline;</span><br></pre></td></tr></table></figure>

<h3 id="联合多个多边形"><a href="#联合多个多边形" class="headerlink" title="联合多个多边形"></a>联合多个多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// union many polygons</span></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate3D&gt; coordsZ = <span class="keyword">new</span> List&lt;Coordinate3D&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">7</span>, <span class="number">8</span>, <span class="number">4</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">8</span>, <span class="number">4</span>, <span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">9</span>, <span class="number">10</span>, <span class="number">6</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">12</span>, <span class="number">8</span>, <span class="number">8</span>),</span><br><span class="line">  <span class="keyword">new</span> Coordinate3D(<span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">12</span>, <span class="number">12</span>, <span class="number">10</span>), <span class="keyword">new</span> Coordinate3D(<span class="number">14</span>, <span class="number">10</span>, <span class="number">11</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create polygons</span></span><br><span class="line">List&lt;Polygon&gt; manyPolygonsZ = <span class="keyword">new</span> List&lt;Polygon&gt;</span><br><span class="line">&#123;</span><br><span class="line">  PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span> List&lt;Coordinate3D&gt;()&#123;coordsZ[<span class="number">0</span>], coordsZ[<span class="number">1</span>], coordsZ[<span class="number">2</span>]&#125;, SpatialReferences.WGS84),</span><br><span class="line">  PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span> List&lt;Coordinate3D&gt;()&#123;coordsZ[<span class="number">3</span>], coordsZ[<span class="number">4</span>], coordsZ[<span class="number">5</span>]&#125;),</span><br><span class="line">  PolygonBuilderEx.CreatePolygon(<span class="keyword">new</span> List&lt;Coordinate3D&gt;()&#123;coordsZ[<span class="number">6</span>], coordsZ[<span class="number">7</span>], coordsZ[<span class="number">8</span>]&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Polygon polygon = GeometryEngine.Instance.Union(manyPolygonsZ) <span class="keyword">as</span> Polygon;</span><br></pre></td></tr></table></figure>

<h3 id="地图点、折线、多边形内的多边形"><a href="#地图点、折线、多边形内的多边形" class="headerlink" title="地图点、折线、多边形内的多边形"></a>地图点、折线、多边形内的多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build a polygon      </span></span><br><span class="line">List&lt;MapPoint&gt; pts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">1.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">1.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">2.0</span>));</span><br><span class="line">pts.Add(MapPointBuilderEx.CreateMapPoint(<span class="number">2.0</span>, <span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(pts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// an inner point</span></span><br><span class="line">MapPoint innerPt = MapPointBuilderEx.CreateMapPoint(<span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line"><span class="built_in">bool</span> within = GeometryEngine.Instance.Within(innerPt, poly);   <span class="comment">// within = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// point on a boundary</span></span><br><span class="line">within = GeometryEngine.Instance.Within(pts[<span class="number">0</span>], poly);     <span class="comment">// within = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// an interior line</span></span><br><span class="line">MapPoint innerPt2 = MapPointBuilderEx.CreateMapPoint(<span class="number">1.25</span>, <span class="number">1.75</span>);</span><br><span class="line">List&lt;MapPoint&gt; innerLinePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">innerLinePts.Add(innerPt);</span><br><span class="line">innerLinePts.Add(innerPt2);</span><br><span class="line"></span><br><span class="line">Polyline polyline = PolylineBuilderEx.CreatePolyline(innerLinePts);</span><br><span class="line">within = GeometryEngine.Instance.Within(polyline, poly);   <span class="comment">// within = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a line that crosses the boundary</span></span><br><span class="line">MapPoint outerPt = MapPointBuilderEx.CreateMapPoint(<span class="number">3</span>, <span class="number">1.5</span>);</span><br><span class="line">List&lt;MapPoint&gt; crossingLinePts = <span class="keyword">new</span> List&lt;MapPoint&gt;();</span><br><span class="line">crossingLinePts.Add(innerPt);</span><br><span class="line">crossingLinePts.Add(outerPt);</span><br><span class="line"></span><br><span class="line">polyline = PolylineBuilderEx.CreatePolyline(crossingLinePts);</span><br><span class="line">within = GeometryEngine.Instance.Within(polyline, poly);     <span class="comment">// within = false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// polygon in polygon</span></span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(innerPt, innerPt2);</span><br><span class="line">within = GeometryEngine.Instance.Within(env, poly);      <span class="comment">// within = true</span></span><br></pre></td></tr></table></figure>

<h1 id="地理处理"><a href="#地理处理" class="headerlink" title="地理处理"></a>地理处理</h1><h2 id="常规"><a href="#常规" class="headerlink" title="常规"></a>常规</h2><h3 id="如何执行模型工具"><a href="#如何执行模型工具" class="headerlink" title="如何执行模型工具"></a>如何执行模型工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the model tool&#x27;s parameter syntax from the model&#x27;s help</span></span><br><span class="line"><span class="built_in">string</span> input_roads = <span class="string">@&quot;C:\data\Input.gdb\PlanA_Roads&quot;</span>;</span><br><span class="line">      <span class="built_in">string</span> buff_dist_field = <span class="string">&quot;Distance&quot;</span>;   <span class="comment">// use values from a field</span></span><br><span class="line">      <span class="built_in">string</span> input_vegetation = <span class="string">@&quot;C:\data\Input.gdb\vegetation&quot;</span>;</span><br><span class="line">      <span class="built_in">string</span> output_data = <span class="string">@&quot;C:\data\Output.gdb\ClippedFC2&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// the model name is ExtractVegetation</span></span><br><span class="line">      <span class="built_in">string</span> tool_path = <span class="string">@&quot;C:\data\MB\Models.tbx\ExtractVegetation&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> args = Geoprocessing.MakeValueArray(input_roads, buff_dist_field, input_vegetation, output_data);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> result = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(tool_path, args);</span><br></pre></td></tr></table></figure>

<h3 id="设置地理处理范围环境"><a href="#设置地理处理范围环境" class="headerlink" title="设置地理处理范围环境"></a>设置地理处理范围环境</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parameters = Geoprocessing.MakeValueArray(<span class="string">@&quot;C:\data\data.gdb\HighwaysUTM11&quot;</span>, <span class="string">@&quot;C:\data\data.gdb\Highways_extent&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> ext = Geoprocessing.MakeEnvironmentArray(extent: <span class="string">&quot;460532 3773964 525111 3827494&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> gp_result = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(<span class="string">&quot;management.CopyFeatures&quot;</span>, parameters, ext);</span><br></pre></td></tr></table></figure>

<h3 id="在地理处理窗格中打开脚本工具对话框"><a href="#在地理处理窗格中打开脚本工具对话框" class="headerlink" title="在地理处理窗格中打开脚本工具对话框"></a>在地理处理窗格中打开脚本工具对话框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> input_data = <span class="string">@&quot;C:\data\data.gdb\Population&quot;</span>;</span><br><span class="line">      <span class="built_in">string</span> out_pdf = <span class="string">@&quot;C:\temp\Reports.pdf&quot;</span>;</span><br><span class="line">      <span class="built_in">string</span> field_name = <span class="string">&quot;INCOME&quot;</span>;</span><br><span class="line">      <span class="comment">// use defaults for other parameters - no need to pass any value</span></span><br><span class="line">      <span class="keyword">var</span> arguments = Geoprocessing.MakeValueArray(input_data, out_pdf, field_name);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">string</span> toolpath = <span class="string">@&quot;C:\data\WorkflowTools.tbx\MakeHistogram&quot;</span>;</span><br><span class="line"></span><br><span class="line">      Geoprocessing.OpenToolDialog(toolpath, arguments);</span><br></pre></td></tr></table></figure>

<h3 id="获取地理处理工程项目"><a href="#获取地理处理工程项目" class="headerlink" title="获取地理处理工程项目"></a>获取地理处理工程项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gpItems = CoreModule.CurrentProject.Items.OfType&lt;GeoprocessingProjectItem&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// go through all the available toolboxes</span></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> gpItem <span class="keyword">in</span> gpItems)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">var</span> itemsInsideToolBox = gpItem.GetItems();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// then for each toolbox list the tools inside</span></span><br><span class="line">          <span class="keyword">foreach</span> (<span class="keyword">var</span> toolItem <span class="keyword">in</span> itemsInsideToolBox)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="built_in">string</span> newTool = String.Join(<span class="string">&quot;;&quot;</span>, <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; toolItem.Path, toolItem.Name &#125;);</span><br><span class="line">              <span class="comment">// do something with the newTool</span></span><br><span class="line">              <span class="comment">// for example, add to a list to track or use them later</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="阻止使用-GP-创建的要素类自动添加到地图"><a href="#阻止使用-GP-创建的要素类自动添加到地图" class="headerlink" title="阻止使用 GP 创建的要素类自动添加到地图"></a>阻止使用 GP 创建的要素类自动添加到地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// However, settings in Pro App&#x27;s Geoprocessing Options will override option set in code</span></span><br><span class="line"><span class="comment">// for example, in Pro App&#x27;s Options &gt; Geoprocessing dialog, if you check &#x27;Add output datasets to an open map&#x27;</span></span><br><span class="line"><span class="comment">// then the output WILL BE added to history overriding settings in code</span></span><br><span class="line"><span class="keyword">var</span> CopyfeaturesParams = Geoprocessing.MakeValueArray(<span class="string">&quot;C:\\data\\Input.gdb\\PlanA_Roads&quot;</span>, <span class="string">&quot;C:\\data\\Input.gdb\\Roads_copy&quot;</span>);</span><br><span class="line">      IGPResult gpResult = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(<span class="string">&quot;management.CopyFeatures&quot;</span>, CopyfeaturesParams, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, GPExecuteToolFlags.None);</span><br></pre></td></tr></table></figure>

<h3 id="GPExecuteToolFlags-AddToHistory-会将执行消息添加到-Hisotry"><a href="#GPExecuteToolFlags-AddToHistory-会将执行消息添加到-Hisotry" class="headerlink" title="GPExecuteToolFlags.AddToHistory 会将执行消息添加到 Hisotry"></a>GPExecuteToolFlags.AddToHistory 会将执行消息添加到 Hisotry</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// However, settings in Pro App&#x27;s Geoprocessing Options will override option set in code</span></span><br><span class="line"><span class="comment">// for example, if in Options &gt; Geoprocessing dialog, if you uncheck &#x27;Write geoprocessing operations to Geoprocessing History&#x27;</span></span><br><span class="line"><span class="comment">// then the output will not be added to history.</span></span><br><span class="line"><span class="keyword">var</span> args2 = Geoprocessing.MakeValueArray(<span class="string">&quot;C:\\data\\Vegetation.shp&quot;</span>, <span class="string">&quot;NewField&quot;</span>, <span class="string">&quot;TEXT&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> result2 = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(<span class="string">&quot;management.AddField&quot;</span>, args2, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, GPExecuteToolFlags.AddToHistory);</span><br></pre></td></tr></table></figure>

<h3 id="多环缓冲器"><a href="#多环缓冲器" class="headerlink" title="多环缓冲器"></a>多环缓冲器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The data referenced in this snippet can be downloaded from the arcgis-pro-sdk-community-samples repo</span></span><br><span class="line"><span class="comment">//https://github.com/Esri/arcgis-pro-sdk-community-samples</span></span><br><span class="line"><span class="function"><span class="keyword">async</span> Task&lt;IGPResult&gt; <span class="title">CreateRings</span>(<span class="params">EditingTemplate currentTemplate</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">var</span> paramsArray = Geoprocessing.MakeValueArray(currentTemplate.MapMember.Name,</span><br><span class="line">                      <span class="string">@&quot;C:\Data\FeatureTest\FeatureTest.gdb\Points_MultipleRingBuffer&quot;</span>,</span><br><span class="line">                      <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;1000&quot;</span>, <span class="string">&quot;2000&quot;</span> &#125;, <span class="string">&quot;Meters&quot;</span>, <span class="string">&quot;Distance&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;ALL&quot;</span>, <span class="string">&quot;FULL&quot;</span>);</span><br><span class="line"></span><br><span class="line">          IGPResult ringsResult = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(<span class="string">&quot;Analysis.MultipleRingBuffer&quot;</span>, paramsArray);</span><br><span class="line">          <span class="keyword">var</span> messages = <span class="built_in">string</span>.IsNullOrEmpty(gpResult.ReturnValue)</span><br><span class="line">                  ? <span class="string">$@&quot;Error in gp tool: <span class="subst">&#123;gpResult.ErrorMessages&#125;</span>&quot;</span></span><br><span class="line">                  : <span class="string">$@&quot;Ok: <span class="subst">&#123;gpResult.ReturnValue&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ringsResult;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="地理处理工具的非阻塞执行"><a href="#地理处理工具的非阻塞执行" class="headerlink" title="地理处理工具的非阻塞执行"></a>地理处理工具的非阻塞执行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The data referenced in this snippet can be downloaded from the arcgis-pro-sdk-community-samples repo</span></span><br><span class="line"><span class="comment">//https://github.com/Esri/arcgis-pro-sdk-community-samples</span></span><br><span class="line"><span class="built_in">string</span> in_data = <span class="string">@&quot;C:\tools\data.gdb\cities&quot;</span>;</span><br><span class="line">      <span class="built_in">string</span> cities_buff = <span class="string">@&quot;E:\data\data.gdb\cities_2km&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> valueArray = Geoprocessing.MakeValueArray(in_data, cities_buff, <span class="string">&quot;2000 Meters&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// to let the GP tool run asynchronously without blocking the main thread</span></span><br><span class="line">      <span class="comment">// use the GPThread option of GPExecuteToolFlasgs</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      GPExecuteToolFlags flags = GPExecuteToolFlags.GPThread;  <span class="comment">// instruct the tool run non-blocking GPThread</span></span><br><span class="line">      IGPResult bufferResult = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(<span class="string">&quot;Analysis.Buffer&quot;</span>, valueArray, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, flags);</span><br></pre></td></tr></table></figure>

<h3 id="如何传递具有多个或复杂输入值的参数"><a href="#如何传递具有多个或复杂输入值的参数" class="headerlink" title="如何传递具有多个或复杂输入值的参数"></a>如何传递具有多个或复杂输入值的参数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> environments = Geoprocessing.MakeEnvironmentArray(overwriteoutput: <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">string</span> toolName = <span class="string">&quot;Snap_edit&quot;</span>;  <span class="comment">// or use edit.Snap</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Snap tool takes multiple inputs each of which has</span></span><br><span class="line">      <span class="comment">// Three (3) parts: a feature class or layer, a string value and a distance</span></span><br><span class="line">      <span class="comment">// Each part is separated by a semicolon - you can get example of sytax from the tool documentation page</span></span><br><span class="line">      <span class="keyword">var</span> snapEnv = <span class="string">@&quot;&#x27;C:/SnapProject/fgdb.gdb/line_1&#x27; END &#x27;2 Meters&#x27;;&#x27;C:/SnapProject/fgdb.gdb/points_1&#x27; VERTEX &#x27;1 Meters&#x27;;&#x27;C:/SnapProject/fgdb.gdb/otherline_1&#x27; END &#x27;20 Meters&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> infc = <span class="string">@&quot;C:/SnapProject/fgdb.gdb/poly_1&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> snapParams = Geoprocessing.MakeValueArray(infc, snapEnv);</span><br><span class="line"></span><br><span class="line">      GPExecuteToolFlags tokens = GPExecuteToolFlags.RefreshProjectItems | GPExecuteToolFlags.GPThread | GPExecuteToolFlags.AddToHistory;</span><br><span class="line"></span><br><span class="line">      IGPResult snapResult = <span class="keyword">await</span> Geoprocessing.ExecuteToolAsync(toolName, parameters, environments, <span class="literal">null</span>, <span class="literal">null</span>, tokens);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//return gpResult;</span></span><br></pre></td></tr></table></figure>

<h2 id="地理处理选项"><a href="#地理处理选项" class="headerlink" title="地理处理选项"></a>地理处理选项</h2><h3 id="获取地理处理选项"><a href="#获取地理处理选项" class="headerlink" title="获取地理处理选项"></a>获取地理处理选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//These options are for behavior of interactive GP tools _only_.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> overwrite_gp = ApplicationOptions.GeoprocessingOptions.OverwriteExistingDatasets;</span><br><span class="line"><span class="keyword">var</span> remove_gp = ApplicationOptions.GeoprocessingOptions.RemoveOverwrittenLayers;</span><br><span class="line"><span class="keyword">var</span> addoutput_gp = ApplicationOptions.GeoprocessingOptions.AddOutputDatasetsToOpenMap;</span><br><span class="line"><span class="keyword">var</span> history_gp = ApplicationOptions.GeoprocessingOptions.WriteGPOperationsToHistory;</span><br></pre></td></tr></table></figure>

<h3 id="设置地理处理选项"><a href="#设置地理处理选项" class="headerlink" title="设置地理处理选项"></a>设置地理处理选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: changing these options modifies behavior of interactive GP tools _only_.</span></span><br><span class="line"><span class="comment">//Use the ArcGIS.Desktop.Core.Geoprocessing.GPExecuteToolFlags enum parameter</span></span><br><span class="line"><span class="comment">//to modify the behavior of Geoprocessing.ExecuteToolAsync(...)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Note: setting GeoprocessingOptions requires the QueuedTask</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  ApplicationOptions.GeoprocessingOptions.SetOverwriteExistingDatasets(<span class="literal">true</span>);</span><br><span class="line">  ApplicationOptions.GeoprocessingOptions.SetRemoveOverwrittenLayers(<span class="literal">false</span>);</span><br><span class="line">  ApplicationOptions.GeoprocessingOptions.SetAddOutputDatasetsToOpenMap(<span class="literal">true</span>);</span><br><span class="line">  ApplicationOptions.GeoprocessingOptions.SetWriteGPOperationsToHistory(<span class="literal">false</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="图形图层"><a href="#图形图层" class="headerlink" title="图形图层"></a>图形图层</h1><h2 id="常规-1"><a href="#常规-1" class="headerlink" title="常规"></a>常规</h2><h3 id="创建图形图层"><a href="#创建图形图层" class="headerlink" title="创建图形图层"></a>创建图形图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map.MapType != MapType.Map)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">// not 2D</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gl_param = <span class="keyword">new</span> GraphicsLayerCreationParams &#123; Name = <span class="string">&quot;Graphics Layer&quot;</span> &#125;;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//By default will be added to the top of the TOC</span></span><br><span class="line">  <span class="keyword">var</span> graphicsLayer = LayerFactory.Instance.CreateLayer&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;(gl_param, map);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Add to the bottom of the TOC</span></span><br><span class="line">  gl_param.MapMemberIndex = <span class="number">-1</span>; <span class="comment">//bottom</span></span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;(gl_param, map);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Add a graphics layer to a group layer...</span></span><br><span class="line">  <span class="keyword">var</span> group_layer = map.GetLayersAsFlattenedList().OfType&lt;GroupLayer&gt;().First();</span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;(gl_param, group_layer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//TODO...use the graphics layer</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// or use the specific CreateGroupLayer method</span></span><br><span class="line">  LayerFactory.Instance.CreateGroupLayer(map, <span class="number">-1</span>, <span class="string">&quot;Graphics Layer&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="访问图形层"><a href="#访问图形层" class="headerlink" title="访问图形层"></a>访问图形层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the first graphics layer in the map&#x27;s collection of graphics layers</span></span><br><span class="line"><span class="keyword">var</span> graphicsLayer = map.GetLayersAsFlattenedList().OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//TODO...use the graphics layer      </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复制图形元素"><a href="#复制图形元素" class="headerlink" title="复制图形元素"></a>复制图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> elems = sourceGraphicsLayer.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> copiedElements = targetGraphicsLayer.CopyElements(elems);</span><br></pre></td></tr></table></figure>

<h3 id="删除图形元素"><a href="#删除图形元素" class="headerlink" title="删除图形元素"></a>删除图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask      </span></span><br><span class="line">graphicsLayer.RemoveElements(graphicsLayer.GetSelectedElements());</span><br></pre></td></tr></table></figure>

<h2 id="创建图形元素"><a href="#创建图形元素" class="headerlink" title="创建图形元素"></a>创建图形元素</h2><h3 id="使用-CIMG-图形元素的点图形元素"><a href="#使用-CIMG-图形元素的点图形元素" class="headerlink" title="使用 CIMG 图形元素的点图形元素"></a>使用 CIMG 图形元素的点图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Place symbol in the center of the map</span></span><br><span class="line">  <span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line">  <span class="keyword">var</span> location = extent.Center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//specify a symbol</span></span><br><span class="line">  <span class="keyword">var</span> pt_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                        ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//create a CIMGraphic </span></span><br><span class="line">  <span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMPointGraphic()</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = pt_symbol.MakeSymbolReference(),</span><br><span class="line">    Location = location <span class="comment">//center of map</span></span><br><span class="line">  &#125;;</span><br><span class="line">  graphicsLayer.AddElement(graphic);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMG-的线条图形元素"><a href="#使用-CIMG-的线条图形元素" class="headerlink" title="使用 CIMG 的线条图形元素"></a>使用 CIMG 的线条图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//Place a line symbol using the extent&#x27;s lower left and upper right corner.</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="comment">//get the lower left corner of the extent</span></span><br><span class="line"><span class="keyword">var</span> pointFromCoordinates = <span class="keyword">new</span> Coordinate2D(extent.XMin, extent.YMin);</span><br><span class="line"><span class="comment">//get the upper right corner of the extent</span></span><br><span class="line"><span class="keyword">var</span> pointToCoordinates = <span class="keyword">new</span> Coordinate2D(extent.XMax, extent.YMax);</span><br><span class="line">List&lt;Coordinate2D&gt; points = <span class="keyword">new</span> List&lt;Coordinate2D&gt; &#123; pointFromCoordinates, pointToCoordinates &#125;;</span><br><span class="line"><span class="comment">//create the polyline</span></span><br><span class="line"><span class="keyword">var</span> lineSegment = PolylineBuilderEx.CreatePolyline(points);</span><br><span class="line"></span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> line_symbol = SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a CIMGraphic </span></span><br><span class="line"><span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMLineGraphic()</span><br><span class="line">&#123;</span><br><span class="line">  Symbol = line_symbol.MakeSymbolReference(),</span><br><span class="line">  Line = lineSegment,</span><br><span class="line">&#125;;</span><br><span class="line">graphicsLayer.AddElement(graphic);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMG-的多边形图形元素"><a href="#使用-CIMG-的多边形图形元素" class="headerlink" title="使用 CIMG 的多边形图形元素"></a>使用 CIMG 的多边形图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//Place a polygon symbol using the mapview extent geometry</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="comment">//Contract the extent</span></span><br><span class="line"><span class="keyword">var</span> polygonEnv = extent.Expand(<span class="number">-100000</span>, <span class="number">-90000</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">//create a polygon using the envelope</span></span><br><span class="line"><span class="keyword">var</span> polygon = PolygonBuilderEx.CreatePolygon(polygonEnv);</span><br><span class="line"></span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> poly_symbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a CIMGraphic </span></span><br><span class="line"><span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMPolygonGraphic()</span><br><span class="line">&#123;</span><br><span class="line">  Symbol = poly_symbol.MakeSymbolReference(),</span><br><span class="line">  Polygon = polygon,</span><br><span class="line">&#125;;</span><br><span class="line">graphicsLayer.AddElement(graphic);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMG-的多点图形元素"><a href="#使用-CIMG-的多点图形元素" class="headerlink" title="使用 CIMG 的多点图形元素"></a>使用 CIMG 的多点图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//Place a multipoint graphic using the mapview extent geometry</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="comment">//Contract the extent</span></span><br><span class="line"><span class="keyword">var</span> polygonEnv = extent.Expand(<span class="number">-100000</span>, <span class="number">-90000</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">//create a polygon using the envelope</span></span><br><span class="line"><span class="keyword">var</span> polygon = PolygonBuilderEx.CreatePolygon(polygonEnv);</span><br><span class="line"><span class="comment">//Create MultipPoints from the polygon</span></span><br><span class="line"><span class="keyword">var</span> multiPoints = MultipointBuilderEx.CreateMultipoint(polygon);</span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> point_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a CIMGraphic </span></span><br><span class="line"><span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMMultipointGraphic</span><br><span class="line">&#123;</span><br><span class="line">  Symbol = point_symbol.MakeSymbolReference(),</span><br><span class="line">  Multipoint = multiPoints</span><br><span class="line">&#125;;</span><br><span class="line">graphicsLayer.AddElement(graphic);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMSymbol-的图形元素"><a href="#使用-CIMSymbol-的图形元素" class="headerlink" title="使用 CIMSymbol 的图形元素"></a>使用 CIMSymbol 的图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Place symbol in the center of the map</span></span><br><span class="line">  <span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line">  <span class="keyword">var</span> location = extent.Center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//specify a symbol</span></span><br><span class="line">  <span class="keyword">var</span> pt_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                        ColorFactory.Instance.GreenRGB);        </span><br><span class="line">  graphicsLayer.AddElement(location, pt_symbol);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="文本图形元素"><a href="#文本图形元素" class="headerlink" title="文本图形元素"></a>文本图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                    .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Place symbol in the center of the map</span></span><br><span class="line">  <span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line">  <span class="keyword">var</span> location = extent.Center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//specify a text symbol</span></span><br><span class="line">  <span class="keyword">var</span> text_symbol = SymbolFactory.Instance.ConstructTextSymbol</span><br><span class="line">  (ColorFactory.Instance.BlackRGB, <span class="number">8.5</span>, <span class="string">&quot;Corbel&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"></span><br><span class="line">  graphicsLayer.AddElement(location, text_symbol, <span class="string">&quot;Text Example&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="批量图形创建"><a href="#批量图形创建" class="headerlink" title="批量图形创建"></a>批量图形创建</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Point Feature layer to convert into graphics</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active?.Map?.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="comment">//Graphics layer to store the graphics to</span></span><br><span class="line"><span class="keyword">var</span> gl = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (lyr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Point symbol for graphics</span></span><br><span class="line">  <span class="keyword">var</span> pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(CIMColor.CreateRGBColor(<span class="number">100</span>, <span class="number">255</span>, <span class="number">40</span>), <span class="number">10</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  <span class="comment">//Collection to hold the point graphics</span></span><br><span class="line">  <span class="keyword">var</span> listGraphicElements = <span class="keyword">new</span> List&lt;CIMGraphic&gt;();</span><br><span class="line">  <span class="comment">//Iterate through each point feature in the feature layer</span></span><br><span class="line">  <span class="keyword">using</span> (RowCursor rows = lyr.Search()) <span class="comment">//execute</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (rows.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> feature = rows.Current <span class="keyword">as</span> Feature)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Create a point graphic for the feature</span></span><br><span class="line">        <span class="keyword">var</span> crimePt = feature.GetShape() <span class="keyword">as</span> MapPoint;</span><br><span class="line">        <span class="keyword">if</span> (crimePt != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">var</span> cimGraphicElement = <span class="keyword">new</span> CIMPointGraphic</span><br><span class="line">          &#123;</span><br><span class="line">            Location = crimePt, <span class="comment">//MapPoint</span></span><br><span class="line">            Symbol = pointSymbol.MakeSymbolReference()</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="comment">//Add the point feature to the collection</span></span><br><span class="line">          listGraphicElements.Add(cimGraphicElement);</span><br><span class="line">          i++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//Magic happens...Add all the features to the Graphics layer </span></span><br><span class="line">  gl.AddElements(listGraphicElements);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="图形元素选择"><a href="#图形元素选择" class="headerlink" title="图形元素选择"></a>图形元素选择</h2><h3 id="选择图形元素"><a href="#选择图形元素" class="headerlink" title="选择图形元素"></a>选择图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                    .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> elements = graphicsLayer.GetElementsAsFlattenedList()</span><br><span class="line">                    .Where(e =&gt; e.Name.StartsWith(<span class="string">&quot;Text&quot;</span>));</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  graphicsLayer.SelectElements(elements);</span><br><span class="line">  <span class="comment">//or select one element</span></span><br><span class="line">  graphicsLayer.SelectElement(elements.FirstOrDefault());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查找图形元素"><a href="#查找图形元素" class="headerlink" title="查找图形元素"></a>查找图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="comment">//Find elements by name</span></span><br><span class="line"><span class="keyword">var</span> elems = graphicsLayer.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line"><span class="comment">//Find elements by type</span></span><br><span class="line"><span class="comment">//Find all point graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> pointGraphics = graphicsLayer.GetElementsAsFlattenedList().Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPointGraphic);</span><br><span class="line"><span class="comment">//Find all line graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> lineGraphics = graphicsLayer.GetElementsAsFlattenedList().Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMLineGraphic);</span><br><span class="line"><span class="comment">//Find all polygon graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> polygonGraphics = graphicsLayer.GetElementsAsFlattenedList().Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPolygonGraphic);</span><br><span class="line"><span class="comment">//Find all text graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> textGraphics = graphicsLayer.GetElementsAsFlattenedList().Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMTextGraphic);</span><br><span class="line"><span class="comment">//Find all picture graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> pictureGraphic = graphicsLayer.GetElementsAsFlattenedList().Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPictureGraphic);</span><br></pre></td></tr></table></figure>

<h3 id="所有图形图层中元素的空间选择"><a href="#所有图形图层中元素的空间选择" class="headerlink" title="所有图形图层中元素的空间选择"></a>所有图形图层中元素的空间选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map Tool is used to perform Spatial selection.</span></span><br><span class="line"><span class="comment">//Graphic selection uses the selection geometry </span></span><br><span class="line"><span class="comment">//to intersect the geometries of those elements (graphic or group) </span></span><br><span class="line"><span class="comment">//that will be selected and then highlights them. </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> selPoly = geometry <span class="keyword">as</span> Polygon;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;     </span><br><span class="line">    <span class="comment">//note: the selected elements may belong to more than one layer...</span></span><br><span class="line">    <span class="keyword">var</span> elems = MapView.Active.SelectElements(selPoly, SelectionCombinationMethod.New);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在一个图形图层中对元素进行空间选择"><a href="#在一个图形图层中对元素进行空间选择" class="headerlink" title="在一个图形图层中对元素进行空间选择"></a>在一个图形图层中对元素进行空间选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="comment">//Create an extent to use for the spatial selection</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> selectionExtent = extent.Expand(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//Select elements in specified graphics layer using the selection extent.</span></span><br><span class="line"><span class="keyword">var</span> selectedElements = MapView.Active.SelectElements(graphicsLayer, selectionExtent, SelectionCombinationMethod.Add);</span><br></pre></td></tr></table></figure>

<h3 id="选择文本图形元素"><a href="#选择文本图形元素" class="headerlink" title="选择文本图形元素"></a>选择文本图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                    .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> all_text = graphicsLayer.GetElementsAsFlattenedList()</span><br><span class="line">              .Where(e =&gt; e.GetGraphic() <span class="keyword">is</span> CIMTextGraphic);</span><br></pre></td></tr></table></figure>

<h3 id="取消选择图形元素"><a href="#取消选择图形元素" class="headerlink" title="取消选择图形元素"></a>取消选择图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                    .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//unselect the first element in the currently selected elements</span></span><br><span class="line"><span class="keyword">var</span> elem = graphicsLayer.GetSelectedElements().FirstOrDefault();</span><br><span class="line">QueuedTask.Run( () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (elem != <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">//Unselect one element</span></span><br><span class="line">    graphicsLayer.UnSelectElement(elem);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//unselect all elements</span></span><br><span class="line">  graphicsLayer.UnSelectElements();</span><br><span class="line">  <span class="comment">//equivalent to</span></span><br><span class="line">  graphicsLayer.ClearSelection();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="图形元素事件"><a href="#图形元素事件" class="headerlink" title="图形元素事件"></a>图形元素事件</h2><h3 id="订阅元素选择更改事件"><a href="#订阅元素选择更改事件" class="headerlink" title="订阅元素选择更改事件"></a>订阅元素选择更改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Layouts.Events.ElementEvent.Subscribe((args) =&gt; &#123;</span><br><span class="line">  <span class="comment">//check if the container is a graphics layer - could be a Layout (or even map view)</span></span><br><span class="line">  <span class="keyword">if</span> (args.Container <span class="keyword">is</span> ArcGIS.Desktop.Mapping.GraphicsLayer graphicsLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//get the total selection count for the container</span></span><br><span class="line">    <span class="keyword">var</span> count = args.Elements.Count();</span><br><span class="line">    <span class="comment">//Check count - could have been an unselect or clearselect</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//this is a selection or add to selection</span></span><br><span class="line">      <span class="keyword">var</span> elems = graphicsLayer.GetSelectedElements();</span><br><span class="line">      <span class="comment">//TODO process the selection...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//This is an unselect or clear selection</span></span><br><span class="line">      <span class="comment">//TODO process the unselect or clear select</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="对图形元素进行分组和排序"><a href="#对图形元素进行分组和排序" class="headerlink" title="对图形元素进行分组和排序"></a>对图形元素进行分组和排序</h2><h3 id="组图形元素"><a href="#组图形元素" class="headerlink" title="组图形元素"></a>组图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graphicsLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                    .OfType&lt;ArcGIS.Desktop.Mapping.GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (graphicsLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elemsToGroup = graphicsLayer.GetSelectedElements();</span><br><span class="line"><span class="comment">//Note: run within the QueuedTask</span></span><br><span class="line"><span class="comment">//group  elements</span></span><br><span class="line"><span class="keyword">var</span> groupElement = graphicsLayer.GroupElements(elemsToGroup);</span><br></pre></td></tr></table></figure>

<h3 id="取消组合图形元素"><a href="#取消组合图形元素" class="headerlink" title="取消组合图形元素"></a>取消组合图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectedElements = graphicsLayer.GetSelectedElements().ToList(); ;</span><br><span class="line"><span class="keyword">if</span> (selectedElements?.Any() == <span class="literal">false</span>)<span class="comment">//must be at least 1.</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> elementsToUnGroup = <span class="keyword">new</span> List&lt;GroupElement&gt;();</span><br><span class="line"><span class="comment">//All selected elements should be grouped.</span></span><br><span class="line"><span class="keyword">if</span> (selectedElements.Count() == selectedElements.OfType&lt;GroupElement&gt;().Count())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Convert to a GroupElement list.</span></span><br><span class="line">  elementsToUnGroup = selectedElements.ConvertAll(x =&gt; (GroupElement)x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (elementsToUnGroup.Count() == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//UnGroup</span></span><br><span class="line">graphicsLayer.UnGroupElements(elementsToUnGroup);</span><br></pre></td></tr></table></figure>

<h3 id="组元素的父级"><a href="#组元素的父级" class="headerlink" title="组元素的父级"></a>组元素的父级</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//check the parent</span></span><br><span class="line"><span class="keyword">var</span> parent = groupElement.Elements.First().GetParent();<span class="comment">//will be the group element</span></span><br><span class="line"><span class="comment">//top-most parent</span></span><br><span class="line"><span class="keyword">var</span> top_most = groupElement.Elements.First().GetParent(<span class="literal">true</span>);<span class="comment">//will be the GraphicsLayer</span></span><br></pre></td></tr></table></figure>

<h3 id="排序：向后发送和向前发送"><a href="#排序：向后发送和向前发送" class="headerlink" title="排序：向后发送和向前发送"></a>排序：向后发送和向前发送</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//get the current selection set</span></span><br><span class="line"><span class="keyword">var</span> sel_elems = graphicsLayer.GetSelectedElements();</span><br><span class="line"><span class="comment">//can they be brought forward? This will also check that all elements have the same parent</span></span><br><span class="line"><span class="keyword">if</span> (graphicsLayer.CanBringForward(sel_elems))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//bring forward</span></span><br><span class="line">  graphicsLayer.BringForward(sel_elems);</span><br><span class="line">  <span class="comment">//bring to front (of parent)</span></span><br><span class="line">  <span class="comment">//graphicsLayer.BringToFront(sel_elems);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (graphicsLayer.CanSendBackward(sel_elems))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//send back</span></span><br><span class="line">  graphicsLayer.SendBackward(sel_elems);</span><br><span class="line">  <span class="comment">//send to the back (of parent)</span></span><br><span class="line">  <span class="comment">//graphicsLayer.SendToBack(sel_elems);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取-Z-顺序"><a href="#获取-Z-顺序" class="headerlink" title="获取 Z 顺序"></a>获取 Z 顺序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selElementsZOrder = graphicsLayer.GetSelectedElements();</span><br><span class="line"><span class="comment">//list out the z order</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> elem <span class="keyword">in</span> selElementsZOrder)</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;elem.Name&#125;</span>: z-order <span class="subst">&#123;elem.ZOrder&#125;</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="修改图形元素"><a href="#修改图形元素" class="headerlink" title="修改图形元素"></a>修改图形元素</h2><h3 id="移动图形元素"><a href="#移动图形元素" class="headerlink" title="移动图形元素"></a>移动图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Each selected element will move to a set distance to the upper right.</span></span><br><span class="line"><span class="keyword">var</span> selElements = graphicsLayer.GetSelectedElements();</span><br><span class="line"><span class="keyword">if</span> (selElements.Count == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Move the element up</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> selElement <span class="keyword">in</span> selElements)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the element&#x27;s bounds</span></span><br><span class="line">  <span class="keyword">var</span> elementPoly = PolygonBuilderEx.CreatePolygon(selElement.GetBounds());</span><br><span class="line">  <span class="comment">//get the coordinates of the element bounding envelope.</span></span><br><span class="line">  <span class="keyword">var</span> pointsList = elementPoly.Copy2DCoordinatesToList();</span><br><span class="line">  <span class="comment">//Move the element&#x27;s Anchor point to the upper right.</span></span><br><span class="line">  selElement.SetAnchorPoint(pointsList[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改图形元素的符号系统"><a href="#修改图形元素的符号系统" class="headerlink" title="修改图形元素的符号系统"></a>修改图形元素的符号系统</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//within a queued Task</span></span><br><span class="line"><span class="comment">//get the first line element in the layer</span></span><br><span class="line"><span class="keyword">var</span> ge = graphicsLayer.FindElement(<span class="string">&quot;Line 10&quot;</span>) <span class="keyword">as</span> GraphicElement;</span><br><span class="line"><span class="keyword">var</span> graphic = ge.GetGraphic();</span><br><span class="line"><span class="keyword">if</span> (graphic <span class="keyword">is</span> CIMLineGraphic lineGraphic)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//change its symbol</span></span><br><span class="line">  lineGraphic.Symbol =</span><br><span class="line">   SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">     SymbolFactory.Instance.ConstructStroke(</span><br><span class="line"> ColorFactory.Instance.BlueRGB, <span class="number">2</span>, SimpleLineStyle.DashDot)).MakeSymbolReference();</span><br><span class="line">  <span class="comment">//apply the change</span></span><br><span class="line">  ge.SetGraphic(lineGraphic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><h2 id="布局项目项"><a href="#布局项目项" class="headerlink" title="布局项目项"></a>布局项目项</h2><h3 id="参考布局项目项及其关联布局"><a href="#参考布局项目项及其关联布局" class="headerlink" title="参考布局项目项及其关联布局"></a>参考布局项目项及其关联布局</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Reference layout project items and their associated layout.</span></span><br><span class="line"><span class="comment">//A layout project item is an item that appears in the Layouts</span></span><br><span class="line"><span class="comment">//folder in the Catalog pane.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference all the layout project items</span></span><br><span class="line">IEnumerable&lt;LayoutProjectItem&gt; layouts = </span><br><span class="line">                     Project.Current.GetItems&lt;LayoutProjectItem&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Or reference a specific layout project item by name</span></span><br><span class="line">LayoutProjectItem layoutItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;()</span><br><span class="line">                           .FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyLayout&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="在新视图中打开布局项目项"><a href="#在新视图中打开布局项目项" class="headerlink" title="在新视图中打开布局项目项"></a>在新视图中打开布局项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Open a layout project item in a new view.</span></span><br><span class="line"><span class="comment">//A layout project item may exist but it may not be open in a view. </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a layout project item by name</span></span><br><span class="line">LayoutProjectItem someLytItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;()</span><br><span class="line">                          .FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyLayout&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layout associated with the layout project item</span></span><br><span class="line">Layout layout = <span class="keyword">await</span> QueuedTask.Run(() =&gt; someLytItem.GetLayout());  <span class="comment">//Worker thread</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the new pane - call on UI</span></span><br><span class="line">ILayoutPane iNewLayoutPane = <span class="keyword">await</span> ProApp.Panes.CreateLayoutPaneAsync(layout); <span class="comment">//GUI thread</span></span><br></pre></td></tr></table></figure>

<h3 id="激活已打开的布局视图"><a href="#激活已打开的布局视图" class="headerlink" title="激活已打开的布局视图"></a>激活已打开的布局视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Activate an already open layout view.</span></span><br><span class="line"><span class="comment">//A layout view may be open but it may not be active.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Find the pane that references the layout and activate it. </span></span><br><span class="line"><span class="comment">//Note - there can be multiple panes referencing the same layout.</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> pane <span class="keyword">in</span> ProApp.Panes)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> layoutPane = pane <span class="keyword">as</span> ILayoutPane;</span><br><span class="line">  <span class="keyword">if</span> (layoutPane == <span class="literal">null</span>)  <span class="comment">//if not a layout view, continue to the next pane</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  <span class="keyword">if</span> (layoutPane.LayoutView.Layout == layout) <span class="comment">//activate the view</span></span><br><span class="line">  &#123;</span><br><span class="line">    (layoutPane <span class="keyword">as</span> Pane).Activate();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="引用活动布局视图"><a href="#引用活动布局视图" class="headerlink" title="引用活动布局视图"></a>引用活动布局视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Reference the active layout view.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Confirm if the current, active view is a layout view.</span></span><br><span class="line"><span class="comment">//If it is, do something.</span></span><br><span class="line">LayoutView activeLayoutView = LayoutView.Active;</span><br><span class="line"><span class="keyword">if</span> (activeLayoutView != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将-pagx-导入到项目中"><a href="#将-pagx-导入到项目中" class="headerlink" title="将 pagx 导入到项目中"></a>将 pagx 导入到项目中</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Import a pagx into a project.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a layout project item from importing a pagx file</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  IProjectItem pagx = ItemFactory.Instance.Create(</span><br><span class="line">                            <span class="string">@&quot;C:\Temp\Layout.pagx&quot;</span>) <span class="keyword">as</span> IProjectItem;</span><br><span class="line">  Project.Current.AddItem(pagx);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除布局项目项"><a href="#删除布局项目项" class="headerlink" title="删除布局项目项"></a>删除布局项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Remove a layout project item.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Remove the layout fro the project</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; Project.Current.RemoveItem(layoutItem));</span><br></pre></td></tr></table></figure>

<h3 id="创建新的基本布局并将其打开"><a href="#创建新的基本布局并将其打开" class="headerlink" title="创建新的基本布局并将其打开"></a>创建新的基本布局并将其打开</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a new, basic layout and open it.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create layout with minimum set of parameters on the worker thread</span></span><br><span class="line">Layout lyt = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> newLayout = LayoutFactory.Instance.CreateLayout(<span class="number">8.5</span>, <span class="number">11</span>, LinearUnit.Inches);</span><br><span class="line">  newLayout.SetName(<span class="string">&quot;New 8.5x11 Layout&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> newLayout;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Open new layout on the GUI thread</span></span><br><span class="line"><span class="keyword">await</span> ProApp.Panes.CreateLayoutPaneAsync(lyt);</span><br></pre></td></tr></table></figure>

<h3 id="使用修改后的-CIM-创建新布局并将其打开"><a href="#使用修改后的-CIM-创建新布局并将其打开" class="headerlink" title="使用修改后的 CIM 创建新布局并将其打开"></a>使用修改后的 CIM 创建新布局并将其打开</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a new layout using a modified CIM and open it.</span></span><br><span class="line"><span class="comment">//The CIM exposes additional members that may not be</span></span><br><span class="line"><span class="comment">//available through the managed API.  </span></span><br><span class="line"><span class="comment">//In this example, optional guides are added.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a new CIMLayout on the worker thread</span></span><br><span class="line">Layout newCIMLayout = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set up a CIM page</span></span><br><span class="line">  CIMPage newPage = <span class="keyword">new</span> CIMPage</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//required parameters</span></span><br><span class="line">    Width = <span class="number">8.5</span>,</span><br><span class="line">    Height = <span class="number">11</span>,</span><br><span class="line">    Units = LinearUnit.Inches,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//optional rulers</span></span><br><span class="line">    ShowRulers = <span class="literal">true</span>,</span><br><span class="line">    SmallestRulerDivision = <span class="number">0.5</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//optional guides</span></span><br><span class="line">    ShowGuides = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  CIMGuide guide1 = <span class="keyword">new</span> CIMGuide</span><br><span class="line">  &#123;</span><br><span class="line">    Position = <span class="number">1</span>,</span><br><span class="line">    Orientation = Orientation.Vertical</span><br><span class="line">  &#125;;</span><br><span class="line">  CIMGuide guide2 = <span class="keyword">new</span> CIMGuide</span><br><span class="line">  &#123;</span><br><span class="line">    Position = <span class="number">6.5</span>,</span><br><span class="line">    Orientation = Orientation.Vertical</span><br><span class="line">  &#125;;</span><br><span class="line">  CIMGuide guide3 = <span class="keyword">new</span> CIMGuide</span><br><span class="line">  &#123;</span><br><span class="line">    Position = <span class="number">1</span>,</span><br><span class="line">    Orientation = Orientation.Horizontal</span><br><span class="line">  &#125;;</span><br><span class="line">  CIMGuide guide4 = <span class="keyword">new</span> CIMGuide</span><br><span class="line">  &#123;</span><br><span class="line">    Position = <span class="number">10</span>,</span><br><span class="line">    Orientation = Orientation.Horizontal</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  List&lt;CIMGuide&gt; guideList = <span class="keyword">new</span> List&lt;CIMGuide&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    guide1,</span><br><span class="line">    guide2,</span><br><span class="line">    guide3,</span><br><span class="line">    guide4</span><br><span class="line">  &#125;;</span><br><span class="line">  newPage.Guides = guideList.ToArray();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Construct the new layout using the customized cim definitions</span></span><br><span class="line">  <span class="keyword">var</span> layout_local = LayoutFactory.Instance.CreateLayout(newPage);</span><br><span class="line">  layout_local.SetName(<span class="string">&quot;New 8.5x11 Layout&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> layout_local;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Open new layout on the GUI thread</span></span><br><span class="line"><span class="keyword">await</span> ProApp.Panes.CreateLayoutPaneAsync(newCIMLayout);</span><br></pre></td></tr></table></figure>

<h3 id="更改布局页面大小"><a href="#更改布局页面大小" class="headerlink" title="更改布局页面大小"></a>更改布局页面大小</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Change the layout page size.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the layout project item</span></span><br><span class="line">LayoutProjectItem lytItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;()</span><br><span class="line">                         .FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyLayout&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (layoutItem != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the layout</span></span><br><span class="line">    Layout lyt = lytItem.GetLayout();</span><br><span class="line">    <span class="keyword">if</span> (lyt != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Change properties</span></span><br><span class="line">      CIMPage page = lyt.GetPage();</span><br><span class="line">      page.Width = <span class="number">8.5</span>;</span><br><span class="line">      page.Height = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Apply the changes to the layout</span></span><br><span class="line">      lyt.SetPage(page);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ProSnippet-Group-CIM-Graphics-and-GraphicFactory"><a href="#ProSnippet-Group-CIM-Graphics-and-GraphicFactory" class="headerlink" title="ProSnippet Group CIM Graphics and GraphicFactory"></a>ProSnippet Group CIM Graphics and GraphicFactory</h3><h3 id="创建圆形图形"><a href="#创建圆形图形" class="headerlink" title="创建圆形图形"></a>创建圆形图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">EllipticArcSegment circle_seg = EllipticArcBuilderEx.CreateCircle(</span><br><span class="line">  <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">4</span>), <span class="number">0.5</span>, ArcOrientation.ArcClockwise, <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">var</span> circle_poly = PolygonBuilderEx.CreatePolygon(PolylineBuilderEx.CreatePolyline(circle_seg));</span><br><span class="line"></span><br><span class="line"><span class="comment">//PolylineBuilderEx.CreatePolyline(cir, AttributeFlags.AllAttributes));</span></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">  ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>, SimpleLineStyle.Dash);</span><br><span class="line"></span><br><span class="line">CIMPolygonSymbol circleSym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">  ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, outline);</span><br><span class="line">SymbolFactory.Instance.ConstructPolygonSymbol(<span class="literal">null</span>,</span><br><span class="line">  SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.RedRGB, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circleGraphic = GraphicFactory.Instance.CreateSimpleGraphic(circle_poly, circleSym);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//var elemInfo = new ElementInfo() &#123; Anchor = Anchor.CenterPoint &#125;;</span></span><br><span class="line"><span class="comment">//GraphicElement cirElm = ElementFactory.Instance.CreateGraphicElement(</span></span><br><span class="line"><span class="comment">//  container, circleGraphic, &quot;New Circle&quot;, true, elemInfo);</span></span><br></pre></td></tr></table></figure>

<h3 id="创建圆形文本图形"><a href="#创建圆形文本图形" class="headerlink" title="创建圆形文本图形"></a>创建圆形文本图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">var</span> eabCir = <span class="keyword">new</span> EllipticArcBuilderEx(center, <span class="number">0.5</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="keyword">var</span> cir = eabCir.ToSegment();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> poly = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(cir, AttributeFlags.AllAttributes));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">  ColorFactory.Instance.GreenRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Circle, circle, circle&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreateSimpleTextGraphic(</span><br><span class="line">  TextType.CircleParagraph, poly, sym, text);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//var ge = ElementFactory.Instance.CreateGraphicElement(container, graphic,</span></span><br><span class="line"><span class="comment">//  &quot;New Circle Text&quot;, true);</span></span><br></pre></td></tr></table></figure>

<h3 id="创建贝塞尔图形"><a href="#创建贝塞尔图形" class="headerlink" title="创建贝塞尔图形"></a>创建贝塞尔图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D pt1 = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">7.5</span>);</span><br><span class="line">Coordinate2D pt2 = <span class="keyword">new</span> Coordinate2D(<span class="number">4.16</span>, <span class="number">8</span>);</span><br><span class="line">Coordinate2D pt3 = <span class="keyword">new</span> Coordinate2D(<span class="number">4.83</span>, <span class="number">7.1</span>);</span><br><span class="line">Coordinate2D pt4 = <span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">7.5</span>);</span><br><span class="line"><span class="keyword">var</span> bez = <span class="keyword">new</span> CubicBezierBuilderEx(pt1, pt2, pt3, pt4);</span><br><span class="line"><span class="keyword">var</span> bezSeg = bez.ToSegment();</span><br><span class="line">Polyline bezPl = PolylineBuilderEx.CreatePolyline(bezSeg, AttributeFlags.AllAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">      ColorFactory.Instance.BlackRGB, <span class="number">24</span>, <span class="string">&quot;Comic Sans MS&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreateSimpleTextGraphic(</span><br><span class="line">  TextType.SplinedText, bezPl, sym, <span class="string">&quot;Splined text&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//var ge = ElementFactory.Instance.CreateGraphicElement(container, graphic);</span></span><br></pre></td></tr></table></figure>

<h3 id="创建图例图面图形"><a href="#创建图例图面图形" class="headerlink" title="创建图例图面图形"></a>创建图例图面图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.25</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.5</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.75</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.25</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.5</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.75</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">1</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">          ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">          ColorFactory.Instance.RedRGB, SimpleFillStyle.ForwardDiagonal, outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreateLegendPatchGraphic(</span><br><span class="line">            PatchShape.AreaBoundary, poly.Extent, polySym);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//var elemInfo = new ElementInfo()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  CustomProperties = null,</span></span><br><span class="line"><span class="comment">//  Anchor = Anchor.LeftMidPoint</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="comment">//var ge = ElementFactory.Instance.CreateGraphicElement(container, graphic,</span></span><br><span class="line"><span class="comment">//  &quot;New Legend Patch&quot;, true, elemInfo);</span></span><br></pre></td></tr></table></figure>

<h3 id="创建箭头图形"><a href="#创建箭头图形" class="headerlink" title="创建箭头图形"></a>创建箭头图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">8.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.66</span>, <span class="number">9</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.33</span>, <span class="number">8.1</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">8.5</span>));</span><br><span class="line">Polyline linePl = PolylineBuilderEx.CreatePolyline(plCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set up the arrow info</span></span><br><span class="line"><span class="keyword">var</span> arrowInfo = <span class="keyword">new</span> ArrowInfo()</span><br><span class="line">&#123;</span><br><span class="line">  ArrowHeadKey = ArrowInfo.DefaultArrowHeadKeys[<span class="number">1</span>],</span><br><span class="line">  ArrowOnBothEnds = <span class="literal">true</span>,</span><br><span class="line">  ArrowSizePoints = <span class="number">30</span>,</span><br><span class="line">  LineWidthPoints = <span class="number">15</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreateArrowGraphic(linePl, arrowInfo);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//var ge = ElementFactory.Instance.CreateGraphicElement(</span></span><br><span class="line"><span class="comment">//  container, graphic, &quot;Arrow Line&quot;, false);</span></span><br></pre></td></tr></table></figure>

<h3 id="创建图片图形"><a href="#创建图片图形" class="headerlink" title="创建图片图形"></a>创建图片图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">2</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create and add element to layout</span></span><br><span class="line"><span class="comment">//string picPath = ApplicationUtilities.BASEPATH + _settings.baseFolder + &quot;irefusetowatchthismovi�.jpg&quot;;</span></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreatePictureGraphic(env.Center, picPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make an element to add to GraphicsLayer or Layout</span></span><br><span class="line"><span class="comment">//var ge = ElementFactory.Instance.CreateGraphicElement(layout, graphic);</span></span><br></pre></td></tr></table></figure>

<h2 id="创建布局图形元素"><a href="#创建布局图形元素" class="headerlink" title="创建布局图形元素"></a>创建布局图形元素</h2><h3 id="创建椭圆图形元素"><a href="#创建椭圆图形元素" class="headerlink" title="创建椭圆图形元素"></a>创建椭圆图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">2.75</span>);</span><br><span class="line"><span class="keyword">var</span> eabElp = <span class="keyword">new</span> EllipticArcBuilderEx(center, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.45</span>, </span><br><span class="line">                                       ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="keyword">var</span> ellipse = eabElp.ToSegment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">                                ColorFactory.Instance.GreenRGB, <span class="number">2.0</span>,</span><br><span class="line">                        SimpleLineStyle.Dot);</span><br><span class="line">CIMPolygonSymbol ellipseSym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                         ColorFactory.Instance.GreyRGB, SimpleFillStyle.Vertical, </span><br><span class="line">                                                  outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> poly = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(ellipse, AttributeFlags.AllAttributes));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elpElm = ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, poly, ellipseSym, <span class="string">&quot;New Ellipse&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建套索线，手绘图形元素"><a href="#创建套索线，手绘图形元素" class="headerlink" title="创建套索线，手绘图形元素"></a>创建套索线，手绘图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.5</span>, <span class="number">10.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.25</span>, <span class="number">9.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">10.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.75</span>, <span class="number">9.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.5</span>, <span class="number">10.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.5</span>, <span class="number">1</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">0.75</span>, <span class="number">2</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">Polyline linePl = PolylineBuilderEx.CreatePolyline(plCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMLineSymbol lineSym = SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">          ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line"><span class="comment">//var graphic = GraphicFactory.Instance.CreateShapeGraphic(linePl, lineSym);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">                        container, linePl, lineSym, <span class="string">&quot;New Freehand&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建套索多边形，手绘元素"><a href="#创建套索多边形，手绘元素" class="headerlink" title="创建套索多边形，手绘元素"></a>创建套索多边形，手绘元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line">List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.25</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.5</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.75</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.25</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.5</span>, <span class="number">1.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.75</span>, <span class="number">2</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">1</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">            ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">         ColorFactory.Instance.RedRGB, SimpleFillStyle.ForwardDiagonal, outline);</span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, poly, polySym, <span class="string">&quot;New Lasso&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建线元素"><a href="#创建线元素" class="headerlink" title="创建线元素"></a>创建线元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">8.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.66</span>, <span class="number">9</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.33</span>, <span class="number">8.1</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">8.5</span>));</span><br><span class="line">Polyline linePl = PolylineBuilderEx.CreatePolyline(plCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a line symbol in a style</span></span><br><span class="line"><span class="keyword">var</span> ProjectStyles = Project.Current.GetItems&lt;StyleProjectItem&gt;();</span><br><span class="line">StyleProjectItem style = ProjectStyles.First(x =&gt; x.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> symStyle = style.SearchSymbols(StyleItemType.LineSymbol, <span class="string">&quot;Line with 2 Markers&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">CIMLineSymbol lineSym = symStyle.Symbol <span class="keyword">as</span> CIMLineSymbol;</span><br><span class="line">lineSym.SetSize(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line"><span class="comment">//CIMLineSymbol lineSym = SymbolFactory.Instance.ConstructLineSymbol(ColorFactory.Instance.BlueRGB, 4.0, SimpleLineStyle.Solid);</span></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, linePl, lineSym, <span class="string">&quot;New Line&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建点元素"><a href="#创建点元素" class="headerlink" title="创建点元素"></a>创建点元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a point symbol in a style</span></span><br><span class="line">StyleProjectItem stylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">         .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">SymbolStyleItem symStyleItm = stylePrjItm.SearchSymbols(</span><br><span class="line">                      StyleItemType.PointSymbol, <span class="string">&quot;City Hall&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">CIMPointSymbol pointSym = symStyleItm.Symbol <span class="keyword">as</span> CIMPointSymbol;</span><br><span class="line">pointSym.SetSize(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elemInfo = <span class="keyword">new</span> ElementInfo()</span><br><span class="line">&#123;</span><br><span class="line">  CustomProperties = <span class="keyword">new</span> List&lt;CIMStringMap&gt;() &#123;</span><br><span class="line">     <span class="keyword">new</span> CIMStringMap() &#123; Key = <span class="string">&quot;Key1&quot;</span>, Value = <span class="string">&quot;Value1&quot;</span>&#125;,</span><br><span class="line">     <span class="keyword">new</span> CIMStringMap() &#123; Key = <span class="string">&quot;Key2&quot;</span>, Value = <span class="string">&quot;Value2&quot;</span>&#125;</span><br><span class="line">   &#125;,</span><br><span class="line">  Anchor = Anchor.TopRightCorner,</span><br><span class="line">  Rotation = <span class="number">45.0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> graphic = GraphicFactory.Instance.CreateSimpleGraphic(</span><br><span class="line">                              coord2D.ToMapPoint(), pointSym);</span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, graphic, <span class="string">&quot;New Point&quot;</span>, <span class="literal">true</span>, elemInfo);</span><br></pre></td></tr></table></figure>

<h3 id="创建多边形元素"><a href="#创建多边形元素" class="headerlink" title="创建多边形元素"></a>创建多边形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">6.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">6.1</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">  ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.DashDotDot);</span><br><span class="line">CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">  ColorFactory.Instance.RedRGB, SimpleFillStyle.ForwardDiagonal, outline);</span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, poly, polySym, <span class="string">&quot;New Polygon&quot;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建矩形元素"><a href="#创建矩形元素" class="headerlink" title="创建矩形元素"></a>创建矩形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">4.75</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">3.0</span>, <span class="number">5.75</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">  ColorFactory.Instance.BlackRGB, <span class="number">5.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">  ColorFactory.Instance.GreenRGB, SimpleFillStyle.DiagonalCross, outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = GraphicFactory.Instance.CreateSimpleGraphic(env, polySym);</span><br><span class="line"><span class="keyword">var</span> elemInfo = <span class="keyword">new</span> ElementInfo()</span><br><span class="line">&#123;</span><br><span class="line">  Anchor = Anchor.CenterPoint,</span><br><span class="line">  Rotation = <span class="number">45.0</span>,</span><br><span class="line">  CornerRounding = <span class="number">5.0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">  container, env, polySym, <span class="string">&quot;New Rectangle&quot;</span>, <span class="literal">false</span>, elemInfo);</span><br></pre></td></tr></table></figure>

<h3 id="创建贝塞尔曲线元素"><a href="#创建贝塞尔曲线元素" class="headerlink" title="创建贝塞尔曲线元素"></a>创建贝塞尔曲线元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D pt1 = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">7.5</span>);</span><br><span class="line">Coordinate2D pt2 = <span class="keyword">new</span> Coordinate2D(<span class="number">1.66</span>, <span class="number">8</span>);</span><br><span class="line">Coordinate2D pt3 = <span class="keyword">new</span> Coordinate2D(<span class="number">2.33</span>, <span class="number">7.1</span>);</span><br><span class="line">Coordinate2D pt4 = <span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">7.5</span>);</span><br><span class="line"><span class="keyword">var</span> bez = <span class="keyword">new</span> CubicBezierBuilderEx(pt1, pt2, pt3, pt4);</span><br><span class="line"><span class="keyword">var</span> bezSeg = bez.ToSegment();</span><br><span class="line">Polyline bezPl = PolylineBuilderEx.CreatePolyline(bezSeg, AttributeFlags.AllAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbology, create and add element to layout</span></span><br><span class="line">CIMLineSymbol lineSym = SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">  ColorFactory.Instance.RedRGB, <span class="number">4.0</span>, SimpleLineStyle.DashDot);</span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(container, bezPl, lineSym, <span class="string">&quot;New Bezier&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建图形元素-1"><a href="#创建图形元素-1" class="headerlink" title="创建图形元素"></a>创建图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">6.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">6.1</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">4.75</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">3.0</span>, <span class="number">5.75</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g1 = GraphicFactory.Instance.CreateSimpleGraphic(poly);</span><br><span class="line"><span class="keyword">var</span> g2 = GraphicFactory.Instance.CreateSimpleGraphic(env);</span><br><span class="line"><span class="keyword">var</span> g3 = GraphicFactory.Instance.CreateSimpleGraphic(coord2D.ToMapPoint());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreateGraphicElements(</span><br><span class="line">  container, <span class="keyword">new</span> List&lt;CIMGraphic&gt;() &#123; g1, g2, g3 &#125;,</span><br><span class="line">  <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Poly&quot;</span>, <span class="string">&quot;Envelope&quot;</span>, <span class="string">&quot;MapPoint&quot;</span> &#125;,</span><br><span class="line">  <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMG-创建图形元素"><a href="#使用-CIMG-创建图形元素" class="headerlink" title="使用 CIMG 创建图形元素"></a>使用 CIMG 创建图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="comment">//Place symbol on the layout</span></span><br><span class="line"><span class="comment">//At 2.x - MapPoint location = MapPointBuilder.CreateMapPoint(</span></span><br><span class="line"><span class="comment">//                                               new Coordinate2D(9, 1));</span></span><br><span class="line">MapPoint location = MapPointBuilderEx.CreateMapPoint(<span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> pt_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a CIMGraphic </span></span><br><span class="line"><span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMPointGraphic()</span><br><span class="line">&#123;</span><br><span class="line">  Symbol = pt_symbol.MakeSymbolReference(),</span><br><span class="line">  Location = location <span class="comment">//center of map</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Or use GraphicFactory</span></span><br><span class="line"><span class="keyword">var</span> graphic2 = GraphicFactory.Instance.CreateSimpleGraphic(location, pt_symbol);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - LayoutElementFactory.Instance.CreateGraphicElement(layout, graphic);</span></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(container, graphic);</span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(container, graphic2);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMSymbol-创建图形元素"><a href="#使用-CIMSymbol-创建图形元素" class="headerlink" title="使用 CIMSymbol 创建图形元素"></a>使用 CIMSymbol 创建图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Place symbol on the layout</span></span><br><span class="line"><span class="comment">//At 2.x - MapPoint location = MapPointBuilder.CreateMapPoint(</span></span><br><span class="line"><span class="comment">//                                       new Coordinate2D(9, 1));</span></span><br><span class="line">MapPoint location = MapPointBuilderEx.CreateMapPoint(<span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> pt_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"><span class="comment">//At 2.x -</span></span><br><span class="line"><span class="comment">//     LayoutElementFactory.Instance.CreateGraphicElement(</span></span><br><span class="line"><span class="comment">//                                       layout, location, pt_symbol);</span></span><br><span class="line"></span><br><span class="line">ElementFactory.Instance.CreateGraphicElement(container, location, pt_symbol);</span><br></pre></td></tr></table></figure>

<h3 id="批量元素创建"><a href="#批量元素创建" class="headerlink" title="批量元素创建"></a>批量元素创建</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//List of Point graphics</span></span><br><span class="line"><span class="keyword">var</span> listGraphics = <span class="keyword">new</span> List&lt;CIMPointGraphic&gt;();</span><br><span class="line"><span class="keyword">var</span> listGraphics2 = <span class="keyword">new</span> List&lt;CIMPointGraphic&gt;();</span><br><span class="line"><span class="comment">//Symbol</span></span><br><span class="line"><span class="keyword">var</span> pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                                    ColorFactory.Instance.BlackRGB);</span><br><span class="line"><span class="comment">//Define size of the array</span></span><br><span class="line"><span class="built_in">int</span> dx = <span class="number">5</span>;</span><br><span class="line"><span class="built_in">int</span> dy = <span class="number">5</span>;</span><br><span class="line">MapPoint point = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//Create the List of graphics for the array</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> row = <span class="number">0</span>; row &lt;= dx; ++row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> col = <span class="number">0</span>; col &lt;= dy; ++col)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//At 2.x - point = MapPointBuilder.CreateMapPoint(col, row);</span></span><br><span class="line">    point = MapPointBuilderEx.CreateMapPoint(col, row);</span><br><span class="line">    <span class="comment">//create a CIMGraphic </span></span><br><span class="line">    <span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMPointGraphic()</span><br><span class="line">    &#123;</span><br><span class="line">      Symbol = pointSymbol.MakeSymbolReference(),</span><br><span class="line">      Location = point</span><br><span class="line">    &#125;;</span><br><span class="line">    listGraphics.Add(graphic);</span><br><span class="line">    <span class="comment">//Or use GraphicFactory</span></span><br><span class="line">    <span class="keyword">var</span> graphic2 = GraphicFactory.Instance.CreateSimpleGraphic(</span><br><span class="line">                                  point, pointSymbol) <span class="keyword">as</span> CIMPointGraphic;</span><br><span class="line">    listGraphics2.Add(graphic2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Draw the array of graphics</span></span><br><span class="line"><span class="comment">//At 2.x - var bulkgraphics =</span></span><br><span class="line"><span class="comment">//              LayoutElementFactory.Instance.CreateGraphicElements(</span></span><br><span class="line"><span class="comment">//                                              layout, listGraphics, null);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bulkgraphics = ElementFactory.Instance.CreateGraphicElements(</span><br><span class="line">                                                   container, listGraphics);</span><br><span class="line"><span class="keyword">var</span> bulkgraphics2 = ElementFactory.Instance.CreateGraphicElements(</span><br><span class="line">                                                   container, listGraphics2);</span><br></pre></td></tr></table></figure>

<h3 id="使用-CIMG-创建元素"><a href="#使用-CIMG-创建元素" class="headerlink" title="使用 CIMG 创建元素"></a>使用 CIMG 创建元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Place symbol on the layout</span></span><br><span class="line"><span class="comment">//At 2.x - MapPoint point = MapPointBuilder.CreateMapPoint(new Coordinate2D(9, 1));</span></span><br><span class="line">MapPoint point = MapPointBuilderEx.CreateMapPoint(<span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//specify a symbol</span></span><br><span class="line"><span class="keyword">var</span> pt_symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a CIMGraphic </span></span><br><span class="line"><span class="keyword">var</span> graphic = <span class="keyword">new</span> CIMGraphicElement()</span><br><span class="line">&#123;</span><br><span class="line">  Graphic = <span class="keyword">new</span> CIMPointGraphic()</span><br><span class="line">  &#123;</span><br><span class="line">    Symbol = pt_symbol.MakeSymbolReference(),</span><br><span class="line">    Location = point <span class="comment">//A point in the layout</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//At 2.x - LayoutElementFactory.Instance.CreateElement(layout, graphic);</span></span><br><span class="line">ElementFactory.Instance.CreateElement(container, graphic);</span><br></pre></td></tr></table></figure>

<h3 id="使用符号系统创建点图形"><a href="#使用符号系统创建点图形" class="headerlink" title="使用符号系统创建点图形"></a>使用符号系统创建点图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a simple 2D point graphic and apply an existing point style item as the symbology.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D point geometry  </span></span><br><span class="line">  Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//(optionally) Reference a point symbol in a style</span></span><br><span class="line">  StyleProjectItem ptStylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                                .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">  SymbolStyleItem ptSymStyleItm = ptStylePrjItm.SearchSymbols(</span><br><span class="line">                                         StyleItemType.PointSymbol, <span class="string">&quot;City Hall&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  CIMPointSymbol pointSym = ptSymStyleItm.Symbol <span class="keyword">as</span> CIMPointSymbol;</span><br><span class="line">  pointSym.SetSize(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//An alternative simple symbol is also commented out below.</span></span><br><span class="line">  <span class="comment">//This would elminate the four optional lines of code above that</span></span><br><span class="line">  <span class="comment">//reference a style.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(</span></span><br><span class="line">  <span class="comment">//                  ColorFactory.Instance.RedRGB, 25.0, SimpleMarkerStyle.Star);  </span></span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement ptElm =</span></span><br><span class="line">  <span class="comment">//                    LayoutElementFactory.Instance.CreatePointGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                        layout, coord2D, pointSym);</span></span><br><span class="line"></span><br><span class="line">  GraphicElement ptElm = ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">                                 container, coord2D.ToMapPoint(), pointSym);</span><br><span class="line">  ptElm.SetName(<span class="string">&quot;New Point&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用符号系统创建线图形"><a href="#使用符号系统创建线图形" class="headerlink" title="使用符号系统创建线图形"></a>使用符号系统创建线图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a simple 2D line graphic and apply an existing line</span></span><br><span class="line"><span class="comment">//style item as the symbology.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2d line geometry</span></span><br><span class="line">  List&lt;Coordinate2D&gt; plCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">  plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">8.5</span>));</span><br><span class="line">  plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.66</span>, <span class="number">9</span>));</span><br><span class="line">  plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.33</span>, <span class="number">8.1</span>));</span><br><span class="line">  plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">8.5</span>));</span><br><span class="line">  <span class="comment">//At 2.x - Polyline linePl = PolylineBuilder.CreatePolyline(plCoords);</span></span><br><span class="line">  Polyline linePl = PolylineBuilderEx.CreatePolyline(plCoords);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//(optionally) Reference a line symbol in a style</span></span><br><span class="line">  StyleProjectItem lnStylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                                .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">  SymbolStyleItem lnSymStyleItm = lnStylePrjItm.SearchSymbols(</span><br><span class="line">                                StyleItemType.LineSymbol, <span class="string">&quot;Line with 2 Markers&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  CIMLineSymbol lineSym = lnSymStyleItm.Symbol <span class="keyword">as</span> CIMLineSymbol;</span><br><span class="line">  lineSym.SetSize(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//An alternative simple symbol is also commented out below.</span></span><br><span class="line">  <span class="comment">//This would elminate the four optional lines of code above that</span></span><br><span class="line">  <span class="comment">//reference a style.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//CIMLineSymbol lineSym = SymbolFactory.Instance.ConstructLineSymbol(</span></span><br><span class="line">  <span class="comment">//         ColorFactory.Instance.BlueRGB, 4.0, SimpleLineStyle.Solid);  </span></span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement lineElm =</span></span><br><span class="line">  <span class="comment">//        LayoutElementFactory.Instance.CreateLineGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                            layout, linePl, lineSym);</span></span><br><span class="line"></span><br><span class="line">  GraphicElement lineElm = ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">                                              container, linePl, lineSym);</span><br><span class="line">  lineElm.SetName(<span class="string">&quot;New Line&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用简单符号系统创建矩形图形"><a href="#使用简单符号系统创建矩形图形" class="headerlink" title="使用简单符号系统创建矩形图形"></a>使用简单符号系统创建矩形图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a simple 2D rectangle graphic and apply simple fill and</span></span><br><span class="line"><span class="comment">//outline symbols.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D envelope geometry</span></span><br><span class="line">  Coordinate2D rec_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">4.75</span>);</span><br><span class="line">  Coordinate2D rec_ur = <span class="keyword">new</span> Coordinate2D(<span class="number">3.0</span>, <span class="number">5.75</span>);</span><br><span class="line">  <span class="comment">//At 2.x - Envelope rec_env = EnvelopeBuilder.CreateEnvelope(rec_ll, rec_ur);</span></span><br><span class="line">  Envelope rec_env = EnvelopeBuilderEx.CreateEnvelope(rec_ll, rec_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">  CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">    ColorFactory.Instance.BlackRGB, <span class="number">5.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">  CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">    ColorFactory.Instance.GreenRGB, SimpleFillStyle.DiagonalCross, outline);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement recElm =</span></span><br><span class="line">  <span class="comment">//           LayoutElementFactory.Instance.CreateRectangleGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                                  layout, rec_env, polySym);</span></span><br><span class="line">  <span class="comment">//         recElm.SetName(&quot;New Rectangle&quot;);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  GraphicElement recElm = ElementFactory.Instance.CreateGraphicElement(</span><br><span class="line">    container, rec_env, polySym, <span class="string">&quot;New Rectangle&quot;</span>);</span><br><span class="line">  <span class="comment">//Or use Predefined shape</span></span><br><span class="line">  GraphicElement recElm2 = ElementFactory.Instance.CreatePredefinedShapeGraphicElement(</span><br><span class="line">                            container, PredefinedShape.Rectangle, rec_env, polySym, </span><br><span class="line">                            <span class="string">&quot;New Rectangle2&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建文本图形元素"><a href="#创建文本图形元素" class="headerlink" title="创建文本图形元素"></a>创建文本图形元素</h2><h3 id="创建点文本元素-1"><a href="#创建点文本元素-1" class="headerlink" title="创建点文本元素 1"></a>创建点文本元素 1</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a simple point text element and assign basic symbology and text settings.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D point geometry</span></span><br><span class="line">  Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">  CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                ColorFactory.Instance.RedRGB, <span class="number">32</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line">  <span class="built_in">string</span> textString = <span class="string">&quot;Point text&quot;</span>;</span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement ptTxtElm =</span></span><br><span class="line">  <span class="comment">//         LayoutElementFactory.Instance.CreatePointTextGraphicElement(</span></span><br><span class="line">  <span class="comment">//                           layout, coord2D, textString, sym);</span></span><br><span class="line">  <span class="comment">//ptTxtElm.SetName(&quot;New Point Text&quot;);</span></span><br><span class="line">  <span class="comment">//ptTxtElm.SetAnchor(Anchor.CenterPoint);</span></span><br><span class="line">  <span class="comment">//ptTxtElm.SetX(4.5);</span></span><br><span class="line">  <span class="comment">//ptTxtElm.SetY(9.5);</span></span><br><span class="line">  <span class="comment">//ptTxtElm.SetRotation(45);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//use ElementInfo to set placement properties during create</span></span><br><span class="line">  <span class="keyword">var</span> elemInfo = <span class="keyword">new</span> ElementInfo()</span><br><span class="line">  &#123;</span><br><span class="line">    Anchor = Anchor.CenterPoint,</span><br><span class="line">    Rotation = <span class="number">45</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> ptTxtElm = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">    container, TextType.PointText, coord2D.ToMapPoint(), sym, textString,</span><br><span class="line">                       <span class="string">&quot;New Point Text&quot;</span>, <span class="literal">true</span>, elemInfo);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Change additional text properties</span></span><br><span class="line">  ptTxtElm.SetX(<span class="number">4.5</span>);</span><br><span class="line">  ptTxtElm.SetY(<span class="number">9.5</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建矩形段落文本元素-1"><a href="#创建矩形段落文本元素-1" class="headerlink" title="创建矩形段落文本元素 1"></a>创建矩形段落文本元素 1</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create rectangle text with background and border symbology.  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D polygon geometry</span></span><br><span class="line">  List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">7</span>));</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">7</span>));</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">6.7</span>));</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">6.7</span>));</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">6.1</span>));</span><br><span class="line">  plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">6.1</span>));</span><br><span class="line">  <span class="comment">//At 2.x - Polygon poly = PolygonBuilder.CreatePolygon(plyCoords);</span></span><br><span class="line">  Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">  <span class="comment">//Also notice how formatting tags are using within the text string.</span></span><br><span class="line">  CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                    ColorFactory.Instance.GreyRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line">  <span class="built_in">string</span> text = <span class="string">&quot;Some Text String that is really long and is &quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;BOL&gt;forced to wrap to other lines&lt;/BOL&gt; so that &quot;</span> +</span><br><span class="line">                <span class="string">&quot;we can see the effects.&quot;</span> <span class="keyword">as</span> String;</span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement polyTxtElm =</span></span><br><span class="line">  <span class="comment">//           LayoutElementFactory.Instance.CreatePolygonParagraphGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                      layout, poly, text, sym);</span></span><br><span class="line">  <span class="comment">//         polyTxtElm.SetName(&quot;New Polygon Text&quot;);</span></span><br><span class="line"></span><br><span class="line">  GraphicElement polyTxtElm = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">    container, TextType.RectangleParagraph, poly, sym, text, <span class="string">&quot;Polygon Paragraph&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//(Optionally) Modify paragraph border </span></span><br><span class="line">  CIMGraphic polyTxtGra = polyTxtElm.GetGraphic();</span><br><span class="line">  CIMParagraphTextGraphic cimPolyTxtGra = polyTxtGra <span class="keyword">as</span> CIMParagraphTextGraphic;</span><br><span class="line">  cimPolyTxtGra.Frame.BorderSymbol = <span class="keyword">new</span> CIMSymbolReference();</span><br><span class="line">  cimPolyTxtGra.Frame.BorderSymbol.Symbol =</span><br><span class="line">               SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">                          ColorFactory.Instance.GreyRGB, <span class="number">1.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">  polyTxtElm.SetGraphic(polyTxtGra);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建动态点文本元素"><a href="#创建动态点文本元素" class="headerlink" title="创建动态点文本元素"></a>创建动态点文本元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a dynamic text element.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the string with tags and the location</span></span><br><span class="line">String title = <span class="string">@&quot;&lt;dyn type = &quot;&quot;page&quot;&quot; property = &quot;&quot;name&quot;&quot; /&gt;&quot;</span>;</span><br><span class="line">Coordinate2D llTitle = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct element on worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create with default text properties</span></span><br><span class="line">  <span class="comment">//At 2.x - TextElement titleGraphics =</span></span><br><span class="line">  <span class="comment">//          LayoutElementFactory.Instance.CreatePointTextGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                  layout, llTitle, null) as TextElement;</span></span><br><span class="line">  TextElement titleGraphics = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">                container, TextType.PointText, llTitle.ToMapPoint()) <span class="keyword">as</span> TextElement;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Modify the text properties</span></span><br><span class="line">  titleGraphics.SetTextProperties(<span class="keyword">new</span> TextProperties(title, <span class="string">&quot;Arial&quot;</span>, <span class="number">24</span>, <span class="string">&quot;Bold&quot;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建点文本元素-2"><a href="#创建点文本元素-2" class="headerlink" title="创建点文本元素 2"></a>创建点文本元素 2</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">  ColorFactory.Instance.RedRGB, <span class="number">32</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> textString = <span class="string">&quot;Point text&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elemInfo = <span class="keyword">new</span> ElementInfo() &#123; Anchor = Anchor.BottomLeftCorner &#125;;</span><br><span class="line">GraphicElement ptTxtElm = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">  container, TextType.PointText, coord2D.ToMapPoint(), sym, textString,</span><br><span class="line">  <span class="string">&quot;New Point Text&quot;</span>, <span class="literal">true</span>, elemInfo);</span><br></pre></td></tr></table></figure>

<h3 id="创建多边形段落文本元素"><a href="#创建多边形段落文本元素" class="headerlink" title="创建多边形段落文本元素"></a>创建多边形段落文本元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plyCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">6.7</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">6.1</span>));</span><br><span class="line">plyCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">6.1</span>));</span><br><span class="line">Polygon poly = PolygonBuilderEx.CreatePolygon(plyCoords);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">     ColorFactory.Instance.GreyRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Some text string that is really long and &quot;</span> +</span><br><span class="line">              <span class="string">&quot;&lt;BOL&gt;wraps to other lines&lt;/BOL&gt;&quot;</span> +</span><br><span class="line">              <span class="string">&quot; so that we can see the effects.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">  container, TextType.PolygonParagraph, poly, sym, text,</span><br><span class="line">        <span class="string">&quot;New Polygon Text&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建矩形段落文本元素-2"><a href="#创建矩形段落文本元素-2" class="headerlink" title="创建矩形段落文本元素 2"></a>创建矩形段落文本元素 2</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">4.75</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">5.75</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">           ColorFactory.Instance.WhiteRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Some text string that is really long and &quot;</span> +</span><br><span class="line">              <span class="string">&quot;&lt;BOL&gt;wraps to other lines&lt;/BOL&gt;&quot;</span> +</span><br><span class="line">              <span class="string">&quot; so that we can see the effects.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//(Optionally) Modify border and background with 50% transparency </span></span><br><span class="line"><span class="comment">//CIMGraphic recTxtGra = recTxtElm.Graphic;</span></span><br><span class="line"><span class="comment">//CIMParagraphTextGraphic cimRecTxtGra = recTxtGra as CIMParagraphTextGraphic;</span></span><br><span class="line"><span class="comment">//CIMSymbolReference cimRecTxtBorder = cimRecTxtGra.Frame.BorderSymbol;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//CIMLineSymbol lineSym = SymbolFactory.Instance.ConstructLineSymbol(</span></span><br><span class="line"><span class="comment">//                    ColorFactory.Instance.BlackRGB, 1.0, SimpleLineStyle.Solid);</span></span><br><span class="line"><span class="comment">//cimRecTxtBorder.Symbol = lineSym;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//CIMSymbolReference cimRecTxtBkgrd = cimRecTxtGra.Frame.BackgroundSymbol;</span></span><br><span class="line"><span class="comment">//CIMPolygonSymbol polySym = SymbolFactory.Instance.ConstructPolygonSymbol(</span></span><br><span class="line"><span class="comment">//                            ColorFactory.Instance.GreyRGB, SimpleFillStyle.Solid);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//CIMColor symCol = polySym.GetColor(IElementContainer container);</span></span><br><span class="line"><span class="comment">//symCol.SetAlphaValue(50);</span></span><br><span class="line"><span class="comment">//cimRecTxtBkgrd.Symbol = polySym;</span></span><br><span class="line"><span class="comment">//recTxtElm.SetGraphic(recTxtGra);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreateTextGraphicElement(container,</span><br><span class="line">            TextType.RectangleParagraph, env, sym, text, <span class="string">&quot;New Rectangle Text&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建圆形文本元素"><a href="#创建圆形文本元素" class="headerlink" title="创建圆形文本元素"></a>创建圆形文本元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">var</span> eabCir = <span class="keyword">new</span> EllipticArcBuilderEx(center, <span class="number">0.5</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="keyword">var</span> cir = eabCir.ToSegment();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> poly = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(cir, AttributeFlags.AllAttributes));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                ColorFactory.Instance.GreenRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Circle, circle, circle&quot;</span>;</span><br><span class="line"></span><br><span class="line">GraphicElement cirTxtElm = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">  container, TextType.CircleParagraph, poly, sym, text, <span class="string">&quot;New Circle Text&quot;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建贝塞尔文本元素"><a href="#创建贝塞尔文本元素" class="headerlink" title="创建贝塞尔文本元素"></a>创建贝塞尔文本元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D pt1 = <span class="keyword">new</span> Coordinate2D(<span class="number">3.5</span>, <span class="number">7.5</span>);</span><br><span class="line">Coordinate2D pt2 = <span class="keyword">new</span> Coordinate2D(<span class="number">4.16</span>, <span class="number">8</span>);</span><br><span class="line">Coordinate2D pt3 = <span class="keyword">new</span> Coordinate2D(<span class="number">4.83</span>, <span class="number">7.1</span>);</span><br><span class="line">Coordinate2D pt4 = <span class="keyword">new</span> Coordinate2D(<span class="number">5.5</span>, <span class="number">7.5</span>);</span><br><span class="line"><span class="keyword">var</span> bez = <span class="keyword">new</span> CubicBezierBuilderEx(pt1, pt2, pt3, pt4);</span><br><span class="line"><span class="keyword">var</span> bezSeg = bez.ToSegment();</span><br><span class="line">Polyline bezPl = PolylineBuilderEx.CreatePolyline(bezSeg, AttributeFlags.AllAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">  ColorFactory.Instance.BlackRGB, <span class="number">24</span>, <span class="string">&quot;Comic Sans MS&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">  container, TextType.SplinedText, bezPl, sym, <span class="string">&quot;this is the bezier text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;New Bezier Text&quot;</span>, <span class="literal">true</span>, <span class="keyword">new</span> ElementInfo() &#123; Anchor = Anchor.CenterPoint &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建椭圆文本元素"><a href="#创建椭圆文本元素" class="headerlink" title="创建椭圆文本元素"></a>创建椭圆文本元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">4.5</span>, <span class="number">2.75</span>);</span><br><span class="line"><span class="keyword">var</span> eabElp = <span class="keyword">new</span> EllipticArcBuilderEx(center, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.45</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="keyword">var</span> ellipse = eabElp.ToSegment();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> poly = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(ellipse, AttributeFlags.AllAttributes));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMTextSymbol sym = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                      ColorFactory.Instance.BlueRGB, <span class="number">10</span>, <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Ellipse, ellipse, ellipse&quot;</span>;</span><br><span class="line"></span><br><span class="line">GraphicElement ge = ElementFactory.Instance.CreateTextGraphicElement(</span><br><span class="line">  container, TextType.PolygonParagraph, poly, sym, text, <span class="string">&quot;New Ellipse Text&quot;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h2 id="创建预定义的形状和箭头"><a href="#创建预定义的形状和箭头" class="headerlink" title="创建预定义的形状和箭头"></a>创建预定义的形状和箭头</h2><h3 id="创建预定义的形状图形元素"><a href="#创建预定义的形状图形元素" class="headerlink" title="创建预定义的形状图形元素"></a>创建预定义的形状图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//PredefinedShape shapeType =</span></span><br><span class="line"><span class="comment">//              PredefinedShape.Circle | Cloud | Cross |Circle | Triangle | ... ;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">4</span>, <span class="number">2.5</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">4.5</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">                ColorFactory.Instance.BlueRGB, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> poly_sym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                 <span class="literal">null</span>, outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreatePredefinedShapeGraphicElement(</span><br><span class="line">                       container, shapeType, env.Center, env.Width, env.Height, </span><br><span class="line">                        poly_sym, shapeType.ToString(), <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建预定义的形状图形元素-1"><a href="#创建预定义的形状图形元素-1" class="headerlink" title="创建预定义的形状图形元素"></a>创建预定义的形状图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">6.5</span>, <span class="number">7</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">9</span>, <span class="number">9</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">                ColorFactory.Instance.GreenRGB, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> poly_sym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                 <span class="literal">null</span>, outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreatePredefinedShapeGraphicElement(</span><br><span class="line">  container, PredefinedShape.RoundedRectangle, env, poly_sym, <span class="string">&quot;Rounded Rect&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建预定义的形状图形元素-2"><a href="#创建预定义的形状图形元素-2" class="headerlink" title="创建预定义的形状图形元素"></a>创建预定义的形状图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">2</span>, <span class="number">2.75</span>);</span><br><span class="line"><span class="keyword">var</span> eabElp = <span class="keyword">new</span> EllipticArcBuilderEx(</span><br><span class="line">                         center, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.45</span>, ArcOrientation.ArcClockwise);</span><br><span class="line"><span class="keyword">var</span> ellipse = eabElp.ToSegment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set symbolology, create and add element to layout</span></span><br><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">                      ColorFactory.Instance.GreenRGB, <span class="number">2.0</span>, SimpleLineStyle.Dot);</span><br><span class="line">CIMPolygonSymbol ellipseSym = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                 ColorFactory.Instance.GreyRGB, SimpleFillStyle.Vertical, outline);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> poly = PolygonBuilderEx.CreatePolygon(</span><br><span class="line">  PolylineBuilderEx.CreatePolyline(ellipse, AttributeFlags.AllAttributes));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ge = ElementFactory.Instance.CreatePredefinedShapeGraphicElement(</span><br><span class="line">  container, PredefinedShape.Ellipse, poly.Extent.Center, <span class="number">0</span>, <span class="number">0</span>, ellipseSym, </span><br><span class="line">  <span class="string">&quot;New Ellipse2&quot;</span>, <span class="literal">false</span>, <span class="keyword">new</span> ElementInfo() &#123; Anchor = Anchor.TopRightCorner &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建线箭头元素"><a href="#创建线箭头元素" class="headerlink" title="创建线箭头元素"></a>创建线箭头元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">List&lt;Coordinate2D&gt; plCoords = <span class="keyword">new</span> List&lt;Coordinate2D&gt;();</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">8.5</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">1.66</span>, <span class="number">9</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">2.33</span>, <span class="number">8.1</span>));</span><br><span class="line">plCoords.Add(<span class="keyword">new</span> Coordinate2D(<span class="number">3</span>, <span class="number">8.5</span>));</span><br><span class="line">Polyline linePl = PolylineBuilderEx.CreatePolyline(plCoords);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arrowInfo = <span class="keyword">new</span> ArrowInfo()</span><br><span class="line">&#123;</span><br><span class="line">  ArrowHeadKey = ArrowInfo.DefaultArrowHeadKeys[<span class="number">8</span>],</span><br><span class="line">  ArrowOnBothEnds = <span class="literal">true</span>,</span><br><span class="line">  ArrowSizePoints = <span class="number">24</span>,</span><br><span class="line">  LineWidthPoints = <span class="number">12</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create and add element to layout</span></span><br><span class="line">GraphicElement lineElm = ElementFactory.Instance.CreateArrowGraphicElement(</span><br><span class="line">  container, linePl, arrowInfo, <span class="string">&quot;Arrow Line&quot;</span>, <span class="literal">true</span>, </span><br><span class="line">                            <span class="keyword">new</span> ElementInfo() &#123; Rotation = <span class="number">15.0</span> &#125;);</span><br><span class="line"><span class="comment">//lineElm.SetName(&quot;New Line&quot;);</span></span><br></pre></td></tr></table></figure>

<h2 id="图片元素"><a href="#图片元素" class="headerlink" title="图片元素"></a>图片元素</h2><h3 id="使用-CIMSymbol-创建图片图形元素"><a href="#使用-CIMSymbol-创建图片图形元素" class="headerlink" title="使用 CIMSymbol 创建图片图形元素"></a>使用 CIMSymbol 创建图片图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">0.5</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">2.5</span>, <span class="number">2</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create and add element to layout</span></span><br><span class="line"><span class="comment">//string picPath = ApplicationUtilities.BASEPATH + _settings.baseFolder + &quot;irefusetowatchthismovi�.jpg&quot;;</span></span><br><span class="line"><span class="keyword">var</span> pic_gr = ElementFactory.Instance.CreatePictureGraphicElement(</span><br><span class="line">  layout, env.Center, picPath, <span class="string">&quot;New Picture&quot;</span>, <span class="literal">true</span>, <span class="keyword">new</span> ElementInfo() &#123; Anchor = Anchor.CenterPoint &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用高级符号设置创建新的图片元素"><a href="#使用高级符号设置创建新的图片元素" class="headerlink" title="使用高级符号设置创建新的图片元素"></a>使用高级符号设置创建新的图片元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a picture element and also set background and border symbology.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D envelope geometry</span></span><br><span class="line">  Coordinate2D pic_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">  Coordinate2D pic_ur = <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//At 2.x - Envelope env = EnvelopeBuilder.CreateEnvelope(pic_ll, pic_ur);</span></span><br><span class="line">  Envelope env = EnvelopeBuilderEx.CreateEnvelope(pic_ll, pic_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create and add element to layout</span></span><br><span class="line">  <span class="built_in">string</span> picPath = <span class="string">@&quot;C:\Temp\WhitePass.jpg&quot;</span>;</span><br><span class="line">  <span class="comment">//At 2.x - GraphicElement picElm =</span></span><br><span class="line">  <span class="comment">//    LayoutElementFactory.Instance.CreatePictureGraphicElement(</span></span><br><span class="line">  <span class="comment">//                                             layout, env, picPath);</span></span><br><span class="line">  <span class="comment">//         picElm.SetName(&quot;New Picture&quot;);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  GraphicElement picElm = ElementFactory.Instance.CreatePictureGraphicElement(</span><br><span class="line">                                       layout, env, picPath, <span class="string">&quot;New Picture&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//(Optionally) Modify the border and shadow </span></span><br><span class="line">  CIMGraphic picGra = picElm.GetGraphic();</span><br><span class="line">  CIMPictureGraphic cimPicGra = picGra <span class="keyword">as</span> CIMPictureGraphic;</span><br><span class="line">  cimPicGra.Frame.BorderSymbol = <span class="keyword">new</span> CIMSymbolReference();</span><br><span class="line">  cimPicGra.Frame.BorderSymbol.Symbol =</span><br><span class="line">        SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">               ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line"></span><br><span class="line">  cimPicGra.Frame.ShadowSymbol = <span class="keyword">new</span> CIMSymbolReference();</span><br><span class="line">  cimPicGra.Frame.ShadowSymbol.Symbol =</span><br><span class="line">              SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                    ColorFactory.Instance.BlackRGB, SimpleFillStyle.Solid);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Update the element</span></span><br><span class="line">  picElm.SetGraphic(picGra);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建地图框和环绕要素"><a href="#创建地图框和环绕要素" class="headerlink" title="创建地图框和环绕要素"></a>创建地图框和环绕要素</h2><h3 id="创建地图框并设置照相机"><a href="#创建地图框并设置照相机" class="headerlink" title="创建地图框并设置照相机"></a>创建地图框并设置照相机</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a map frame and set its camera by zooming to the extent of an existing bookmark.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D envelope geometry</span></span><br><span class="line">  Coordinate2D mf_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">6.0</span>, <span class="number">8.5</span>);</span><br><span class="line">  Coordinate2D mf_ur = <span class="keyword">new</span> Coordinate2D(<span class="number">8.0</span>, <span class="number">10.5</span>);</span><br><span class="line">  <span class="comment">//At 2.x - Envelope mf_env = EnvelopeBuilder.CreateEnvelope(mf_ll, mf_ur);</span></span><br><span class="line">  Envelope mf_env = EnvelopeBuilderEx.CreateEnvelope(mf_ll, mf_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference map, create MF and add to layout</span></span><br><span class="line">  MapProjectItem mapPrjItem = Project.Current.GetItems&lt;MapProjectItem&gt;()</span><br><span class="line">                       .FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;Map&quot;</span>));</span><br><span class="line">  Map mfMap = mapPrjItem.GetMap();</span><br><span class="line">  Bookmark bookmark = mfMap.GetBookmarks().FirstOrDefault(</span><br><span class="line">                        b =&gt; b.Name == <span class="string">&quot;Great Lakes&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//At 2.x - MapFrame mfElm =</span></span><br><span class="line">  <span class="comment">//                  LayoutElementFactory.Instance.CreateMapFrame(</span></span><br><span class="line">  <span class="comment">//                                             layout, mf_env, mfMap);</span></span><br><span class="line">  <span class="comment">//         mfElm.SetName(&quot;New Map Frame&quot;);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  MapFrame mfElm = ElementFactory.Instance.CreateMapFrameElement(</span><br><span class="line">                       layout, mf_env, mfMap, <span class="string">&quot;New Map Frame&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to bookmark</span></span><br><span class="line">  mfElm.SetCamera(bookmark);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建图例"><a href="#创建图例" class="headerlink" title="创建图例"></a>创建图例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a legend for an associated map frame.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D envelope geometry</span></span><br><span class="line">  Coordinate2D leg_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">2.5</span>);</span><br><span class="line">  Coordinate2D leg_ur = <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4.5</span>);</span><br><span class="line">  <span class="comment">//At 2.x - Envelope leg_env = EnvelopeBuilder.CreateEnvelope(leg_ll, leg_ur);</span></span><br><span class="line">  Envelope leg_env = EnvelopeBuilderEx.CreateEnvelope(leg_ll, leg_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference MF, create legend and add to layout</span></span><br><span class="line">  MapFrame mapFrame = layout.FindElement(<span class="string">&quot;New Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  <span class="keyword">if</span> (mapFrame == <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO handle null map frame</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//At 2.x - Legend legendElm = LayoutElementFactory.Instance.CreateLegend(</span></span><br><span class="line">  <span class="comment">//                                               layout, leg_env, mapFrame);</span></span><br><span class="line">  <span class="comment">//         legendElm.SetName(&quot;New Legend&quot;); </span></span><br><span class="line">  <span class="keyword">var</span> legendInfo = <span class="keyword">new</span> LegendInfo()</span><br><span class="line">  &#123;</span><br><span class="line">    MapFrameName = mapFrame.Name</span><br><span class="line">  &#125;;</span><br><span class="line">  Legend legendElm = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">                      layout, leg_env, legendInfo, <span class="string">&quot;New Legend&quot;</span>) <span class="keyword">as</span> Legend;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从样式项创建比例尺"><a href="#从样式项创建比例尺" class="headerlink" title="从样式项创建比例尺"></a>从样式项创建比例尺</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a scale bar using a style.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Search for a style project item by name</span></span><br><span class="line">StyleProjectItem arcgis_2dStyle = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                            .First(si =&gt; si.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference the specific scale bar by name </span></span><br><span class="line">  ScaleBarStyleItem scaleBarItem = arcgis_2dStyle.SearchScaleBars(</span><br><span class="line">                     <span class="string">&quot;Double Alternating Scale Bar&quot;</span>).FirstOrDefault();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference the map frame and define the location</span></span><br><span class="line">  MapFrame myMapFrame = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  Coordinate2D coord2D = <span class="keyword">new</span> Coordinate2D(<span class="number">10.0</span>, <span class="number">7.0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Construct the scale bar</span></span><br><span class="line">  <span class="comment">//At 2.x - LayoutElementFactory.Instance.CreateScaleBar(</span></span><br><span class="line">  <span class="comment">//             layout, coord2D, myMapFrame, scaleBarItem);</span></span><br><span class="line">  <span class="keyword">var</span> sbarInfo = <span class="keyword">new</span> ScaleBarInfo()</span><br><span class="line">  &#123;</span><br><span class="line">    MapFrameName = myMapFrame.Name,</span><br><span class="line">    ScaleBarStyleItem = scaleBarItem</span><br><span class="line">  &#125;;</span><br><span class="line">  ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">          layout, coord2D.ToMapPoint(), sbarInfo);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从样式项-1-创建指北针"><a href="#从样式项-1-创建指北针" class="headerlink" title="从样式项 1 创建指北针"></a>从样式项 1 创建指北针</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a north arrow using a style.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Search for a style project item by name</span></span><br><span class="line">StyleProjectItem arcgis2dStyles = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                  .First(si =&gt; si.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  NorthArrowStyleItem naStyleItem = arcgis2dStyles.SearchNorthArrows(</span><br><span class="line">                <span class="string">&quot;ArcGIS North 13&quot;</span>).FirstOrDefault();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference the map frame and define the location</span></span><br><span class="line">  MapFrame newFrame = layout.FindElement(<span class="string">&quot;New Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  Coordinate2D nArrow = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Construct the north arrow</span></span><br><span class="line">  <span class="comment">//At 2.x - var newNorthArrow = LayoutElementFactory.Instance.CreateNorthArrow(</span></span><br><span class="line">  <span class="comment">//                        layout, nArrow, newFrame, naStyleItem);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> naInfo = <span class="keyword">new</span> NorthArrowInfo()</span><br><span class="line">  &#123;</span><br><span class="line">    MapFrameName = newFrame.Name,</span><br><span class="line">    NorthArrowStyleItem = naStyleItem</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> newNorthArrow = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">                          layout, nArrow.ToMapPoint(), naInfo);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建表格框"><a href="#创建表格框" class="headerlink" title="创建表格框"></a>创建表格框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a table frame.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Build 2D envelope geometry</span></span><br><span class="line">  Coordinate2D rec_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">1.0</span>, <span class="number">3.5</span>);</span><br><span class="line">  Coordinate2D rec_ur = <span class="keyword">new</span> Coordinate2D(<span class="number">7.5</span>, <span class="number">4.5</span>);</span><br><span class="line">  <span class="comment">//At 2.x - Envelope rec_env = EnvelopeBuilder.CreateEnvelope(rec_ll, rec_ur);</span></span><br><span class="line">  Envelope rec_env = EnvelopeBuilderEx.CreateEnvelope(rec_ll, rec_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference map frame and layer</span></span><br><span class="line">  MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  FeatureLayer lyr = mf.Map.FindLayers(<span class="string">&quot;GreatLakes&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Build fields list</span></span><br><span class="line">  <span class="keyword">var</span> fields = <span class="keyword">new</span>[] &#123; <span class="string">&quot;NAME&quot;</span>, <span class="string">&quot;Shape_Area&quot;</span>, <span class="string">&quot;Shape_Length&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Construct the table frame</span></span><br><span class="line">  <span class="comment">//At 2.x - TableFrame tabFrame = LayoutElementFactory.Instance.CreateTableFrame(</span></span><br><span class="line">  <span class="comment">//              layout, rec_env, mf, lyr, fields);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> tableFrameInfo = <span class="keyword">new</span> TableFrameInfo()</span><br><span class="line">  &#123;</span><br><span class="line">    FieldNames = fields,</span><br><span class="line">    MapFrameName = mf.Name,</span><br><span class="line">    MapMemberUri = lyr.URI</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> tabFrame = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">    layout, rec_env, tableFrameInfo) <span class="keyword">as</span> TableFrame;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建地图框-1"><a href="#创建地图框-1" class="headerlink" title="创建地图框 1"></a>创建地图框 1</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">2.0</span>, <span class="number">4.5</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">6.5</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference map, create MF and add to layout</span></span><br><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//var map = mapProjectItem.GetMap();</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">MapFrame mfElm = ElementFactory.Instance.CreateMapFrameElement(</span><br><span class="line">                                                layout, env, map);</span><br></pre></td></tr></table></figure>

<h3 id="创建地图框-2"><a href="#创建地图框-2" class="headerlink" title="创建地图框 2"></a>创建地图框 2</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">4.0</span>, <span class="number">2.5</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">7.0</span>, <span class="number">5.5</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference map, create MF and add to layout</span></span><br><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//var map = mapProjectItem.GetMap();</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">MapFrame mfElm = ElementFactory.Instance.CreateMapFrameElement(</span><br><span class="line">  layout, env.Center, map);</span><br></pre></td></tr></table></figure>

<h3 id="创建图例-2"><a href="#创建图例-2" class="headerlink" title="创建图例 2"></a>创建图例 2</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">6</span>, <span class="number">2.5</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">8</span>, <span class="number">4.5</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference MF, create legend and add to layout</span></span><br><span class="line">MapFrame mf = layout.FindElement(mapFrameName) <span class="keyword">as</span> MapFrame;</span><br><span class="line"><span class="keyword">var</span> surroundInfo = <span class="keyword">new</span> LegendInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MapFrameName = mf.Name</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> legendElm = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">  layout, env.Center, surroundInfo) <span class="keyword">as</span> Legend;</span><br><span class="line">legendElm.SetName(<span class="string">&quot;New Legend&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从样式项-2-创建指北针"><a href="#从样式项-2-创建指北针" class="headerlink" title="从样式项 2 创建指北针"></a>从样式项 2 创建指北针</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D center = <span class="keyword">new</span> Coordinate2D(<span class="number">7</span>, <span class="number">5.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a North Arrow in a style</span></span><br><span class="line">StyleProjectItem stylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                               .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">NorthArrowStyleItem naStyleItm = stylePrjItm.SearchNorthArrows(</span><br><span class="line">                                       <span class="string">&quot;ArcGIS North 10&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference MF, create north arrow and add to layout </span></span><br><span class="line"><span class="comment">//var mf = container.FindElement(&quot;New Map Frame&quot;) as MapFrame;</span></span><br><span class="line"><span class="keyword">var</span> mf = layout.FindElement(MapFrameName) <span class="keyword">as</span> MapFrame;</span><br><span class="line"><span class="keyword">var</span> narrow_info = <span class="keyword">new</span> NorthArrowInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MapFrameName = mf.Name,</span><br><span class="line">  NorthArrowStyleItem = naStyleItm</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> arrowElm = (NorthArrow)ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">  layout, center.ToMapPoint(), narrow_info) <span class="keyword">as</span> NorthArrow;</span><br><span class="line">arrowElm.SetName(<span class="string">&quot;New North Arrow&quot;</span>);</span><br><span class="line">arrowElm.SetHeight(<span class="number">1.75</span>);</span><br><span class="line">arrowElm.SetX(<span class="number">7</span>);</span><br><span class="line">arrowElm.SetY(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建表格框-1"><a href="#创建表格框-1" class="headerlink" title="创建表格框"></a>创建表格框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">Envelope env = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tableFrameInfo = <span class="keyword">new</span> TableFrameInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MapFrameName = mapFrameName,</span><br><span class="line">  MapMemberUri = uri</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> attribs = <span class="keyword">new</span> List&lt;CIMStringMap&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">  attribs.Add(<span class="keyword">new</span> CIMStringMap</span><br><span class="line">  &#123;</span><br><span class="line">    Key = <span class="string">$&quot;Key <span class="subst">&#123;i&#125;</span>&quot;</span>,</span><br><span class="line">    Value = <span class="string">$&quot;Value <span class="subst">&#123;i&#125;</span>&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> elemInfo = <span class="keyword">new</span> ElementInfo()</span><br><span class="line">&#123;</span><br><span class="line">  CustomProperties = attribs</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> tableFrameElem = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">                              layout, env.Center, tableFrameInfo,</span><br><span class="line">                              <span class="string">&quot;New Table Frame&quot;</span>, <span class="literal">false</span>, elemInfo) <span class="keyword">as</span> TableFrame;</span><br></pre></td></tr></table></figure>

<h3 id="创建比例尺"><a href="#创建比例尺" class="headerlink" title="创建比例尺"></a>创建比例尺</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">5.0</span>, <span class="number">6</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">6.0</span>, <span class="number">7</span>);</span><br><span class="line">Envelope sbEnv = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a Scale Bar in a style</span></span><br><span class="line">StyleProjectItem stylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">              .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span><br><span class="line">             <span class="string">&quot;Alternating Scale Bar 1&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span></span><br><span class="line"><span class="comment">//                                   &quot;Double Alternating Scale Bar 1&quot;)[0];</span></span><br><span class="line"><span class="comment">//ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span></span><br><span class="line"><span class="comment">//                                    &quot;Hollow Scale Bar 1&quot;)[0];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create Scale Bar</span></span><br><span class="line">ScaleBarInfo sbInfo = <span class="keyword">new</span> ScaleBarInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MapFrameName = mapFrame.Name</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sbElm = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">                                   layout, sbEnv, sbInfo) <span class="keyword">as</span> ScaleBar;</span><br></pre></td></tr></table></figure>

<h3 id="创建比例线"><a href="#创建比例线" class="headerlink" title="创建比例线"></a>创建比例线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask.Run(() =&gt; &#123; ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Build geometry</span></span><br><span class="line">Coordinate2D ll = <span class="keyword">new</span> Coordinate2D(<span class="number">5.0</span>, <span class="number">8</span>);</span><br><span class="line">Coordinate2D ur = <span class="keyword">new</span> Coordinate2D(<span class="number">6.0</span>, <span class="number">9</span>);</span><br><span class="line">Envelope sbEnv = EnvelopeBuilderEx.CreateEnvelope(ll, ur);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a Scale Bar in a style</span></span><br><span class="line">StyleProjectItem stylePrjItm = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                             .FirstOrDefault(item =&gt; item.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line">ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span><br><span class="line">                              <span class="string">&quot;Scale Line 1&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span></span><br><span class="line"><span class="comment">//                                           &quot;Stepped Scale Line&quot;)[0];</span></span><br><span class="line"><span class="comment">//ScaleBarStyleItem sbStyleItm = stylePrjItm.SearchScaleBars(</span></span><br><span class="line"><span class="comment">//                                            &quot;Scale Line 2&quot;)[0];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create Scale Bar</span></span><br><span class="line">ScaleBarInfo sbInfo = <span class="keyword">new</span> ScaleBarInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MapFrameName = mapFrame.Name,</span><br><span class="line">  ScaleBarStyleItem = sbStyleItm</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sbElm = ElementFactory.Instance.CreateMapSurroundElement(</span><br><span class="line">                  layout, sbEnv, sbInfo, <span class="string">&quot;ScaleBar Line&quot;</span>) <span class="keyword">as</span> ScaleBar;</span><br></pre></td></tr></table></figure>

<h2 id="组元素"><a href="#组元素" class="headerlink" title="组元素"></a>组元素</h2><h3 id="创建空组元素"><a href="#创建空组元素" class="headerlink" title="创建空组元素"></a>创建空组元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create an empty group element at the root level of the contents pane</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create on worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//At 2.x - GroupElement grp1 =</span></span><br><span class="line">  <span class="comment">//             LayoutElementFactory.Instance.CreateGroupElement(layout);</span></span><br><span class="line">  <span class="comment">//         grp1.SetName(&quot;Group&quot;); </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//container is IElementContainer - GroupLayer or Layout</span></span><br><span class="line">  GroupElement grp1 = ElementFactory.Instance.CreateGroupElement(</span><br><span class="line">                        container, <span class="literal">null</span>, <span class="string">&quot;Group&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// *** or ***</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a group element inside another group element</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Find an existing group element</span></span><br><span class="line"><span class="comment">//container is IElementContainer - GroupLayer or Layout</span></span><br><span class="line">GroupElement existingGroup = container.FindElement(<span class="string">&quot;Group&quot;</span>) <span class="keyword">as</span> GroupElement;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create on worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//At 2.x - GroupElement grp2 =</span></span><br><span class="line">  <span class="comment">//      LayoutElementFactory.Instance.CreateGroupElement(existingGroup);</span></span><br><span class="line">  <span class="comment">//         grp2.SetName(&quot;Group in Group&quot;);</span></span><br><span class="line">  GroupElement grp2 = ElementFactory.Instance.CreateGroupElement(</span><br><span class="line">    existingGroup, <span class="literal">null</span>, <span class="string">&quot;Group in Group&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建包含元素的组元素"><a href="#创建包含元素的组元素" class="headerlink" title="创建包含元素的组元素"></a>创建包含元素的组元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a group with a list of elements at the root level of the contents pane.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Find an existing elements</span></span><br><span class="line"><span class="comment">//container is IElementContainer - GroupLayer or Layout</span></span><br><span class="line"><span class="keyword">var</span> elem1 = container.FindElement(<span class="string">&quot;Polygon 1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> elem2 = container.FindElement(<span class="string">&quot;Bezier Text&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> elem3 = container.FindElement(<span class="string">&quot;Cloud Shape 2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct a list and add the elements</span></span><br><span class="line"><span class="keyword">var</span> elmList = <span class="keyword">new</span> List&lt;Element&gt;</span><br><span class="line">&#123;</span><br><span class="line">  elem1,</span><br><span class="line">  elem2,</span><br><span class="line">  elem3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//At 2.x - GroupElement groupWithListOfElementsAtRoot =</span></span><br><span class="line">  <span class="comment">//             LayoutElementFactory.Instance.CreateGroupElement(layout, elmList);</span></span><br><span class="line">  <span class="comment">//groupWithListOfElementsAtRoot.SetName(&quot;Group with list of elements at root&quot;);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  GroupElement groupWithListOfElementsAtRoot =</span><br><span class="line">          ElementFactory.Instance.CreateGroupElement(</span><br><span class="line">                   container, elmList, <span class="string">&quot;Group with list of elements at root&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// *** or ***</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a group using a list of element names at the root level of the contents pane.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//List of element names</span></span><br><span class="line"><span class="keyword">var</span> elmNameList = <span class="keyword">new</span>[] &#123; <span class="string">&quot;Para Text1&quot;</span>, <span class="string">&quot;Line 3&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//At 2.x - GroupElement groupWithListOfElementNamesAtRoot =</span></span><br><span class="line">  <span class="comment">//   LayoutElementFactory.Instance.CreateGroupElement(layout, elmNameList);</span></span><br><span class="line">  <span class="comment">//         groupWithListOfElementNamesAtRoot.SetName(</span></span><br><span class="line">  <span class="comment">//                  &quot;Group with list of element names at root&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//At 3.x, use the names to find the relevant elements first</span></span><br><span class="line">  <span class="comment">//container is IElementContainer - GroupLayer or Layout</span></span><br><span class="line">  <span class="keyword">var</span> elems = container.FindElements(elmNameList);</span><br><span class="line">  GroupElement groupWithListOfElementNamesAtRoot =</span><br><span class="line">      ElementFactory.Instance.CreateGroupElement(</span><br><span class="line">           container, elems, <span class="string">&quot;Group with list of element names at root&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="布局元素和选择"><a href="#布局元素和选择" class="headerlink" title="布局元素和选择"></a>布局元素和选择</h2><h3 id="在布局上查找元素"><a href="#在布局上查找元素" class="headerlink" title="在布局上查找元素"></a>在布局上查找元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Find an element on a layout.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reference a layout project item by name</span></span><br><span class="line">LayoutProjectItem layoutItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyLayout&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (layoutItem != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">    Layout mylayout = layoutItem.GetLayout();</span><br><span class="line">    <span class="keyword">if</span> (mylayout != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Find a single specific element</span></span><br><span class="line">      Element rect = mylayout.FindElement(<span class="string">&quot;Rectangle&quot;</span>) <span class="keyword">as</span> Element;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Or use the Elements collection</span></span><br><span class="line">      Element rect2 = mylayout.Elements.FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;Rectangle&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找布局元素"><a href="#查找布局元素" class="headerlink" title="查找布局元素"></a>查找布局元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="comment">//Find elements by name</span></span><br><span class="line"><span class="keyword">var</span> layoutElementsToFind = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line"><span class="comment">//Get the collection of elements from the page layout. Nesting within GroupElement is preserved.</span></span><br><span class="line"><span class="keyword">var</span> elementCollection = layout.GetElements();</span><br><span class="line"><span class="comment">//Get the collection of Element from the page layout as a flattened list. Nested groups within GroupElement are not preserved.</span></span><br><span class="line"><span class="keyword">var</span> elements = layout.GetElementsAsFlattenedList();</span><br><span class="line"><span class="comment">//Convert collection of the elements to a collection of GraphicElements.</span></span><br><span class="line"><span class="keyword">var</span> graphicElements = elements.ToList().ConvertAll(x =&gt; (GraphicElement)x);</span><br><span class="line"><span class="comment">//Find elements by type</span></span><br><span class="line"><span class="comment">//Find all point graphics in the Layout</span></span><br><span class="line"><span class="keyword">var</span> pointGraphics = graphicElements.Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPointGraphic);</span><br><span class="line"><span class="comment">//Find all line graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> lineGraphics = graphicElements.Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMLineGraphic);</span><br><span class="line"><span class="comment"><span class="doctag">///</span>/Find all polygon graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> polyGraphics = graphicElements.Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPolygonGraphic);</span><br><span class="line"><span class="comment"><span class="doctag">///</span>/Find all text graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> textGraphics = graphicElements.Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMTextGraphic);</span><br><span class="line"><span class="comment"><span class="doctag">///</span>/Find all picture graphics in the Graphics Layer</span></span><br><span class="line"><span class="keyword">var</span> pictureGraphic = graphicElements.Where(elem =&gt; elem.GetGraphic() <span class="keyword">is</span> CIMPictureGraphic);</span><br></pre></td></tr></table></figure>

<h3 id="更新元素属性"><a href="#更新元素属性" class="headerlink" title="更新元素属性"></a>更新元素属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Update an element&#x27;s properties.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Performed on worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// update an element&#x27;s name</span></span><br><span class="line">  element.SetName(<span class="string">&quot;New Name&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update and element&#x27;s visibility</span></span><br><span class="line">  element.SetVisible(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取元素选择计数"><a href="#获取元素选择计数" class="headerlink" title="获取元素选择计数"></a>获取元素选择计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get element&#x27;s selection count.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Count the number of selected elements on the active layout view</span></span><br><span class="line">LayoutView activeLayoutView = LayoutView.Active;</span><br><span class="line"><span class="keyword">if</span> (activeLayoutView != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> selectedElements = activeLayoutView.GetSelectedElements();</span><br><span class="line">  ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="string">$@&quot;Selected elements: <span class="subst">&#123;selectedElements.Count&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置元素选择"><a href="#设置元素选择" class="headerlink" title="设置元素选择"></a>设置元素选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Set the active layout view&#x27;s selection to include 2 rectangle elements.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the active view </span></span><br><span class="line">LayoutView activeLayoutView = LayoutView.Active;</span><br><span class="line"><span class="keyword">if</span> (activeLayoutView != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Perform on the worker thread</span></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Reference the layout</span></span><br><span class="line">    Layout lyt = activeLayoutView.Layout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Reference the two rectangle elements</span></span><br><span class="line">    Element rec = lyt.FindElement(<span class="string">&quot;Rectangle&quot;</span>);</span><br><span class="line">    Element rec2 = lyt.FindElement(<span class="string">&quot;Rectangle 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Construct a list and add the elements</span></span><br><span class="line">    List&lt;Element&gt; elmList = <span class="keyword">new</span> List&lt;Element&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      rec,</span><br><span class="line">      rec2</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set the selection</span></span><br><span class="line">    activeLayoutView.SelectElements(elmList);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="取消选择布局上的元素"><a href="#取消选择布局上的元素" class="headerlink" title="取消选择布局上的元素"></a>取消选择布局上的元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Unselect one element.</span></span><br><span class="line"><span class="keyword">var</span> elementToUnSelect = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;MyPoint&quot;</span> &#125;).FirstOrDefault();</span><br><span class="line">layout.UnSelectElement(elementToUnSelect);</span><br><span class="line"><span class="comment">//Unselect multiple elements.</span></span><br><span class="line"><span class="keyword">var</span> elementsToUnSelect = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line">layout.UnSelectElements(elementsToUnSelect);</span><br></pre></td></tr></table></figure>

<h3 id="在布局视图中取消选择元素"><a href="#在布局视图中取消选择元素" class="headerlink" title="在布局视图中取消选择元素"></a>在布局视图中取消选择元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LayoutView layoutView = LayoutView.Active;</span><br><span class="line"><span class="comment">//Unselect one element.</span></span><br><span class="line"><span class="keyword">var</span> elementToUnSelectInView = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;MyPoint&quot;</span> &#125;).FirstOrDefault();</span><br><span class="line">layoutView.UnSelectElement(elementToUnSelect);</span><br><span class="line"><span class="comment">//Unselect multiple elements.</span></span><br><span class="line"><span class="keyword">var</span> elementsToUnSelectInView = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line">layoutView.UnSelectElements(elementsToUnSelect);</span><br></pre></td></tr></table></figure>

<h3 id="清除布局视图中的选择"><a href="#清除布局视图中的选择" class="headerlink" title="清除布局视图中的选择"></a>清除布局视图中的选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//If the a layout view is active, clear its selection</span></span><br><span class="line">LayoutView activeLayoutView = LayoutView.Active;</span><br><span class="line"><span class="keyword">if</span> (activeLayoutView != <span class="literal">null</span>)</span><br><span class="line">&#123;          </span><br><span class="line">  activeLayoutView.ClearElementSelection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="清除布局中的所选内容"><a href="#清除布局中的所选内容" class="headerlink" title="清除布局中的所选内容"></a>清除布局中的所选内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Clear the layout selection.</span></span><br><span class="line">layout.ClearElementSelection();</span><br></pre></td></tr></table></figure>

<h3 id="复制布局元素"><a href="#复制布局元素" class="headerlink" title="复制布局元素"></a>复制布局元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> elems = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> copiedElements = layout.CopyElements(elems);</span><br></pre></td></tr></table></figure>

<h3 id="删除布局元素"><a href="#删除布局元素" class="headerlink" title="删除布局元素"></a>删除布局元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask  </span></span><br><span class="line"><span class="keyword">var</span> elementsToRemove = layout.GetSelectedElements();</span><br><span class="line">layout.DeleteElements(elementsToRemove);</span><br></pre></td></tr></table></figure>

<h3 id="删除布局上的一个或多个元素"><a href="#删除布局上的一个或多个元素" class="headerlink" title="删除布局上的一个或多个元素"></a>删除布局上的一个或多个元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Delete an element or elements on a layout.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Delete a specific element on a layout</span></span><br><span class="line">  aLayout.DeleteElement(elm);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//Or delete a group of elements using a filter</span></span><br><span class="line">  aLayout.DeleteElements(item =&gt; item.Name.Contains(<span class="string">&quot;Clone&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Or delete all elements on a layout</span></span><br><span class="line">  aLayout.DeleteElements(item =&gt; <span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="缩放到元素"><a href="#缩放到元素" class="headerlink" title="缩放到元素"></a>缩放到元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LayoutView lytView = LayoutView.Active;</span><br><span class="line"><span class="comment">//Zoom to an element</span></span><br><span class="line"><span class="keyword">var</span> elementToZoomTo = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;MyPoint&quot;</span> &#125;).FirstOrDefault();</span><br><span class="line">lytView.ZoomToElement(elementToZoomTo);</span><br><span class="line"><span class="comment">//Zoom to  multiple elements.</span></span><br><span class="line"><span class="keyword">var</span> elementsToZoomTo = layout.FindElements(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Point 1&quot;</span>, <span class="string">&quot;Line 3&quot;</span>, <span class="string">&quot;Text 1&quot;</span> &#125;);</span><br><span class="line">lytView.ZoomToElements(elementsToZoomTo);</span><br></pre></td></tr></table></figure>

<h3 id="设置指北针的晕圈属性"><a href="#设置指北针的晕圈属性" class="headerlink" title="设置指北针的晕圈属性"></a>设置指北针的晕圈属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Set the CIM halo properties of a north arrow.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the first selected element (assumption is it is a north arrow)</span></span><br><span class="line">Element northArrow = LayoutView.Active.GetSelectedElements().First();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get definition of north arrow...</span></span><br><span class="line">  <span class="keyword">var</span> cim = northArrow.GetDefinition() <span class="keyword">as</span> CIMMarkerNorthArrow;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//this halo symbol is 50% transparent, no outline (i.e. 0 width)</span></span><br><span class="line">  <span class="comment">//First construct a polygon symbol to use in the Halo</span></span><br><span class="line">  <span class="comment">//Polygon symbol will need a fill and a stroke</span></span><br><span class="line">  <span class="keyword">var</span> polyFill = SymbolFactory.Instance.ConstructSolidFill(ColorFactory.Instance.CreateRGBColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>));</span><br><span class="line">  <span class="keyword">var</span> polyStroke = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">var</span> haloPoly = SymbolFactory.Instance.ConstructPolygonSymbol(polyFill, polyStroke);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Set the north arrow defintion of HaloSymbol and HaloSize </span></span><br><span class="line">  ((CIMPointSymbol)cim.PointSymbol.Symbol).HaloSymbol = haloPoly;</span><br><span class="line">  ((CIMPointSymbol)cim.PointSymbol.Symbol).HaloSize = <span class="number">3</span>;<span class="comment">//size of the halo</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//Apply the CIM changes back to the element</span></span><br><span class="line">  northArrow.SetDefinition(cim);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="对图形元素进行分组和排序-1"><a href="#对图形元素进行分组和排序-1" class="headerlink" title="对图形元素进行分组和排序"></a>对图形元素进行分组和排序</h2><h3 id="组图形元素-1"><a href="#组图形元素-1" class="headerlink" title="组图形元素"></a>组图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//on the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> elemsToGroup = layout.GetSelectedElements();</span><br><span class="line"><span class="comment">//Note: run within the QueuedTask</span></span><br><span class="line"><span class="comment">//group  elements</span></span><br><span class="line"><span class="keyword">var</span> groupElement = layout.GroupElements(elemsToGroup);</span><br></pre></td></tr></table></figure>

<h3 id="取消组合图形元素-1"><a href="#取消组合图形元素-1" class="headerlink" title="取消组合图形元素"></a>取消组合图形元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectedElements = layout.GetSelectedElements().ToList(); </span><br><span class="line"><span class="keyword">if</span> (selectedElements?.Any() == <span class="literal">false</span>)<span class="comment">//must be at least 1.</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> elementsToUnGroup = <span class="keyword">new</span> List&lt;GroupElement&gt;();</span><br><span class="line"><span class="comment">//All selected elements should be grouped elements.</span></span><br><span class="line"><span class="keyword">if</span> (selectedElements.Count() == selectedElements.OfType&lt;GroupElement&gt;().Count())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Convert to a GroupElement list.</span></span><br><span class="line">  elementsToUnGroup = selectedElements.ConvertAll(x =&gt; (GroupElement)x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (elementsToUnGroup.Count() == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//UnGroup many grouped elements</span></span><br><span class="line">layout.UnGroupElements(elementsToUnGroup);</span><br><span class="line"><span class="comment">//Ungroup one grouped element</span></span><br><span class="line">layout.UnGroupElement(elementsToUnGroup.FirstOrDefault());</span><br></pre></td></tr></table></figure>

<h3 id="组元素的父级-1"><a href="#组元素的父级-1" class="headerlink" title="组元素的父级"></a>组元素的父级</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//check the parent</span></span><br><span class="line"><span class="keyword">var</span> parent = groupElement.Elements.First().GetParent();<span class="comment">//will be the group element</span></span><br><span class="line"><span class="comment">//top-most parent</span></span><br><span class="line"><span class="comment">//will be a GraphicsLayer or Layout</span></span><br><span class="line"><span class="keyword">var</span> top_most = groupElement.Elements.First().GetParent(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="组元素中的子元素"><a href="#组元素中的子元素" class="headerlink" title="组元素中的子元素"></a>组元素中的子元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Nested groups within ArcGIS.Desktop.Layouts.GroupElement are not preserved.</span></span><br><span class="line"><span class="keyword">var</span> children = groupElement.GetElementsAsFlattenedList();</span><br></pre></td></tr></table></figure>

<h3 id="排序：向后发送和向前发送-1"><a href="#排序：向后发送和向前发送-1" class="headerlink" title="排序：向后发送和向前发送"></a>排序：向后发送和向前发送</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//get the current selection set</span></span><br><span class="line"><span class="keyword">var</span> sel_elems = layout.GetSelectedElements();</span><br><span class="line"><span class="comment">//can they be brought forward? This will also check that all elements have the same parent</span></span><br><span class="line"><span class="keyword">if</span> (layout.CanBringForward(sel_elems))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//bring forward</span></span><br><span class="line">  layout.BringForward(sel_elems);</span><br><span class="line">  <span class="comment">//bring to front (of parent)</span></span><br><span class="line">  <span class="comment">//graphicsLayer.BringToFront(sel_elems);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (layout.CanSendBackward(sel_elems))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//send back</span></span><br><span class="line">  layout.SendBackward(sel_elems);</span><br><span class="line">  <span class="comment">//send to the back (of parent)</span></span><br><span class="line">  <span class="comment">//graphicsLayer.SendToBack(sel_elems);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取-Z-顺序-1"><a href="#获取-Z-顺序-1" class="headerlink" title="获取 Z 顺序"></a>获取 Z 顺序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selElementsZOrder = layout.GetSelectedElements();</span><br><span class="line"><span class="comment">//list out the z order</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> elem <span class="keyword">in</span> selElementsZOrder)</span><br><span class="line">  <span class="comment">//At 2.x - System.Diagnostics.Debug.WriteLine($&quot;&#123;elem.Name&#125;: z-order &#123;elem.GetZOrder()&#125;&quot;);</span></span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;elem.Name&#125;</span>: z-order <span class="subst">&#123;elem.ZOrder&#125;</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="更新布局元素"><a href="#更新布局元素" class="headerlink" title="更新布局元素"></a>更新布局元素</h2><h3 id="更新文本元素属性"><a href="#更新文本元素属性" class="headerlink" title="更新文本元素属性"></a>更新文本元素属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Update text element properties for an existing text element.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reference a layoutitem in a project by name</span></span><br><span class="line">LayoutProjectItem layoutItem = Project.Current.GetItems&lt;LayoutProjectItem&gt;()</span><br><span class="line">                      .FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyLayout&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (layoutItem != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Perform on the worker thread</span></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">    Layout layout = layoutItem.GetLayout();</span><br><span class="line">    <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Reference a text element by name</span></span><br><span class="line">      TextElement txtElm = layout.FindElement(<span class="string">&quot;MyTextElement&quot;</span>) <span class="keyword">as</span> TextElement;</span><br><span class="line">      <span class="keyword">if</span> (txtElm != <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Change placement properties</span></span><br><span class="line">        txtElm.SetAnchor(Anchor.CenterPoint);</span><br><span class="line">        txtElm.SetX(x);</span><br><span class="line">        txtElm.SetY(y);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Change TextProperties</span></span><br><span class="line">        TextProperties txtProperties = <span class="keyword">new</span> TextProperties(</span><br><span class="line">                         <span class="string">&quot;Hello world&quot;</span>, <span class="string">&quot;Times New Roman&quot;</span>, <span class="number">48</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line">        txtElm.SetTextProperties(txtProperties);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新图片元素"><a href="#更新图片元素" class="headerlink" title="更新图片元素"></a>更新图片元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Update a picture element.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">  Layout layout = layoutItem.GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference a picture element by name</span></span><br><span class="line">    PictureElement picElm = layout.FindElement(<span class="string">&quot;MyPicture&quot;</span>) <span class="keyword">as</span> PictureElement;</span><br><span class="line">    <span class="comment">// Change the path to a new source</span></span><br><span class="line">    <span class="keyword">if</span> (picElm != <span class="literal">null</span>)</span><br><span class="line">      picElm.SetSourcePath(<span class="string">@&quot;D:\MyData\Pics\somePic.jpg&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将背景颜色应用于地图框"><a href="#将背景颜色应用于地图框" class="headerlink" title="将背景颜色应用于地图框"></a>将背景颜色应用于地图框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Apply a background color to the map frame element using the CIM.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the layout</span></span><br><span class="line">  <span class="keyword">var</span> myLayout = Project.Current.GetItems&lt;LayoutProjectItem&gt;()?.First().GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (myLayout == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the map frame in the layout</span></span><br><span class="line">  MapFrame mapFrame = myLayout.FindElement(<span class="string">&quot;New Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  <span class="keyword">if</span> (mapFrame == <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO Handle null mapframe</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the map frame&#x27;s definition in order to modify the background.</span></span><br><span class="line">  <span class="keyword">var</span> mapFrameDefn = mapFrame.GetDefinition() <span class="keyword">as</span> CIMMapFrame;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Construct the polygon symbol to use to create a background</span></span><br><span class="line">  <span class="keyword">var</span> polySymbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                 ColorFactory.Instance.BlueRGB, SimpleFillStyle.Solid);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the background</span></span><br><span class="line">  mapFrameDefn.GraphicFrame.BackgroundSymbol =</span><br><span class="line">                                   polySymbol.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the map frame definition</span></span><br><span class="line">  mapFrame.SetDefinition(mapFrameDefn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新地图整饰"><a href="#更新地图整饰" class="headerlink" title="更新地图整饰"></a>更新地图整饰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Update a map surround.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">  Layout layout = layoutItem.GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference a scale bar element by name</span></span><br><span class="line">    MapSurround scaleBar = layout.FindElement(<span class="string">&quot;MyScaleBar&quot;</span>) <span class="keyword">as</span> MapSurround;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reference a map frame element by name</span></span><br><span class="line">    MapFrame mf = layout.FindElement(<span class="string">&quot;MyMapFrame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((scaleBar != <span class="literal">null</span>) &amp;&amp; (mf != <span class="literal">null</span>))</span><br><span class="line">      <span class="comment">//Set the scale bar to the newly referenced map frame</span></span><br><span class="line">      scaleBar.SetMapFrame(mf);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="锁定元素"><a href="#锁定元素" class="headerlink" title="锁定元素"></a>锁定元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Locked property is displayed in the TOC as a lock symbol next</span></span><br><span class="line"><span class="comment">// to each element.  If locked the element can&#x27;t be selected in the layout</span></span><br><span class="line"><span class="comment">// using the graphic selection tools.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">  Layout layout = layoutItem.GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Reference an element by name</span></span><br><span class="line">    Element element = layout.FindElement(<span class="string">&quot;MyElement&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (element != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Modify the Locked property via the CIM</span></span><br><span class="line">      CIMElement CIMElement = element.GetDefinition() <span class="keyword">as</span> CIMElement;</span><br><span class="line">      CIMElement.Locked = <span class="literal">true</span>;</span><br><span class="line">      element.SetDefinition(CIMElement);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新元素透明度"><a href="#更新元素透明度" class="headerlink" title="更新元素透明度"></a>更新元素透明度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Update an element&#x27;s transparency using the CIM.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">  Layout layout = layoutItem.GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference a element by name</span></span><br><span class="line">    GraphicElement graphicElement = layout.FindElement(<span class="string">&quot;MyElement&quot;</span>) <span class="keyword">as</span> GraphicElement;</span><br><span class="line">    <span class="keyword">if</span> (graphicElement != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Modify the Transparency property that exists only in the CIMGraphic class.</span></span><br><span class="line">      CIMGraphic CIMGraphic = graphicElement.GetGraphic() <span class="keyword">as</span> CIMGraphic;</span><br><span class="line">      CIMGraphic.Transparency = <span class="number">50</span>; <span class="comment">// mark it 50% transparent</span></span><br><span class="line">      graphicElement.SetGraphic(CIMGraphic);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="克隆元素"><a href="#克隆元素" class="headerlink" title="克隆元素"></a>克隆元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Clone a layout graphic element and apply an offset.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Reference and load the layout associated with the layout item</span></span><br><span class="line">  Layout layout = layoutItem.GetLayout();</span><br><span class="line">  <span class="keyword">if</span> (layout != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Reference a graphic element by name</span></span><br><span class="line">    GraphicElement graphicElement = </span><br><span class="line">                        layout.FindElement(<span class="string">&quot;MyElement&quot;</span>) <span class="keyword">as</span> GraphicElement;</span><br><span class="line">    <span class="keyword">if</span> (graphicElement != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Clone and set the new x,y</span></span><br><span class="line">      GraphicElement cloneElement = graphicElement.Clone(<span class="string">&quot;Clone&quot;</span>);</span><br><span class="line">      cloneElement.SetX(cloneElement.GetX() + xOffset);</span><br><span class="line">      cloneElement.SetY(cloneElement.GetY() + yOffset);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="布局元数据"><a href="#布局元数据" class="headerlink" title="布局元数据"></a>布局元数据</h2><h3 id="布局元数据-1"><a href="#布局元数据-1" class="headerlink" title="布局元数据"></a>布局元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var layout = ...;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Gets the Layout metadata.</span></span><br><span class="line"><span class="keyword">var</span> layout_xml = layout.GetMetadata();</span><br><span class="line"><span class="comment">//Can metadata be edited?</span></span><br><span class="line"><span class="keyword">if</span> (layout.GetCanEditMetadata())</span><br><span class="line">  <span class="comment">//Set the metadata back</span></span><br><span class="line">  layout.SetMetadata(layout_xml);</span><br></pre></td></tr></table></figure>

<h2 id="布局地图框"><a href="#布局地图框" class="headerlink" title="布局地图框"></a>布局地图框</h2><h3 id="更改与地图框关联的地图"><a href="#更改与地图框关联的地图" class="headerlink" title="更改与地图框关联的地图"></a>更改与地图框关联的地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Change the map associated with a map frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a map frame on a layout</span></span><br><span class="line">MapFrame mfrm = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Peform on worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference map from the project item </span></span><br><span class="line">  Map map = Project.Current.GetItems&lt;MapProjectItem&gt;().FirstOrDefault(m =&gt; m.Name.Equals(<span class="string">&quot;Map1&quot;</span>)).GetMap();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the map to the map frame</span></span><br><span class="line">  mfrm.SetMap(map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更改地图框照相机设置"><a href="#更改地图框照相机设置" class="headerlink" title="更改地图框照相机设置"></a>更改地图框照相机设置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Change a map frame&#x27;s camera settings.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference MapFrame</span></span><br><span class="line">  MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference the camera associated with the map frame and change the scale</span></span><br><span class="line">  Camera cam = mf.Camera;</span><br><span class="line">  cam.Scale = <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the map frame extent based on the new camera info</span></span><br><span class="line">  mf.SetCamera(cam);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将地图框缩放到单个图层的范围"><a href="#将地图框缩放到单个图层的范围" class="headerlink" title="将地图框缩放到单个图层的范围"></a>将地图框缩放到单个图层的范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Zoom map frame to the extent of a single layer.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference MapFrame</span></span><br><span class="line">  MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference map and layer</span></span><br><span class="line">  Map m = mf.Map;</span><br><span class="line">  FeatureLayer lyr = m.FindLayers(<span class="string">&quot;GreatLakes&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the map frame extent to all features in the layer</span></span><br><span class="line">  mf.SetCamera(lyr, <span class="literal">false</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将地图框范围更改为多个图层中的所选要素"><a href="#将地图框范围更改为多个图层中的所选要素" class="headerlink" title="将地图框范围更改为多个图层中的所选要素"></a>将地图框范围更改为多个图层中的所选要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Change the extent of a map frame to the selected features multiple layers.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference MapFrame</span></span><br><span class="line">  MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference map, layers and create layer list</span></span><br><span class="line">  Map m = mf.Map;</span><br><span class="line">  FeatureLayer fl_1 = m.FindLayers(<span class="string">&quot;GreatLakes&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  FeatureLayer fl_2 = m.FindLayers(<span class="string">&quot;States_WithRegions&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  <span class="keyword">var</span> layers = <span class="keyword">new</span>[] &#123; fl_1, fl_2 &#125;;</span><br><span class="line">  <span class="comment">//IEnumerable&lt;Layer&gt; layers = m.Layers;  //This creates a list of ALL layers in map.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the map frame extent to the selected features in the list of layers</span></span><br><span class="line">  mf.SetCamera(layers, <span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将地图框范围更改为具有-15-缓冲区的单个要素"><a href="#将地图框范围更改为具有-15-缓冲区的单个要素" class="headerlink" title="将地图框范围更改为具有 15% 缓冲区的单个要素"></a>将地图框范围更改为具有 15% 缓冲区的单个要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Change map frame extent to single feature with 10 percent buffer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Process on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Reference the mapframe and its associated map</span></span><br><span class="line">  MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">  Map m = mf.Map;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Reference a feature layer and build a query (to return a single feature)</span></span><br><span class="line">  FeatureLayer fl = m.FindLayers(<span class="string">&quot;GreatLakes&quot;</span>).First() <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  QueryFilter qf = <span class="keyword">new</span> QueryFilter();</span><br><span class="line">  <span class="built_in">string</span> whereClause = <span class="string">&quot;NAME = &#x27;Lake Erie&#x27;&quot;</span>;</span><br><span class="line">  qf.WhereClause = whereClause;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the feature</span></span><br><span class="line">  <span class="keyword">using</span> (ArcGIS.Core.Data.RowCursor rowCursor = fl.Search(qf))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Get the shape from the row and set extent</span></span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> feature = rowCursor.Current <span class="keyword">as</span> ArcGIS.Core.Data.Feature)</span><br><span class="line">      &#123;</span><br><span class="line">        Polygon polygon = feature.GetShape() <span class="keyword">as</span> Polygon;</span><br><span class="line">        Envelope env = polygon.Extent <span class="keyword">as</span> Envelope;</span><br><span class="line">        mf.SetCamera(env);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Zoom out 15 percent</span></span><br><span class="line">        Camera cam = mf.Camera;</span><br><span class="line">        cam.Scale = cam.Scale * <span class="number">1.15</span>;</span><br><span class="line">        mf.SetCamera(cam);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将页面坐标中的点转换为地图坐标中的点。"><a href="#将页面坐标中的点转换为地图坐标中的点。" class="headerlink" title="将页面坐标中的点转换为地图坐标中的点。"></a>将页面坐标中的点转换为地图坐标中的点。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> layout = Project.Current.GetItems&lt;LayoutProjectItem&gt;().FirstOrDefault().GetLayout();</span><br><span class="line"><span class="keyword">var</span> mapFrame = layout.FindElement(<span class="string">&quot;New Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get a point in the center of the Map frame</span></span><br><span class="line"><span class="keyword">var</span> mapFrameCenterPoint = mapFrame.GetBounds().CenterCoordinate;</span><br><span class="line"><span class="comment">//Convert to MapPoint</span></span><br><span class="line"><span class="comment">//At 2.x - var pointInMapFrame = MapPointBuilder.CreateMapPoint(mapFrameCenterPoint);</span></span><br><span class="line"><span class="keyword">var</span> pointInMapFrame = MapPointBuilderEx.CreateMapPoint(mapFrameCenterPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Find the corresponding point in the MapView</span></span><br><span class="line"><span class="keyword">var</span> pointOnMap = mapFrame.PageToMap(pointInMapFrame);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a point graphic on the MapView.</span></span><br><span class="line"><span class="keyword">var</span> cimGraphicElement = <span class="keyword">new</span> CIMPointGraphic</span><br><span class="line">&#123;</span><br><span class="line">  Location = pointOnMap,</span><br><span class="line">  Symbol = pointSymbol.MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">graphicsLayer.AddElement(cimGraphicElement);</span><br></pre></td></tr></table></figure>

<h3 id="将地图坐标中的点转换为页面坐标中的点"><a href="#将地图坐标中的点转换为页面坐标中的点" class="headerlink" title="将地图坐标中的点转换为页面坐标中的点"></a>将地图坐标中的点转换为页面坐标中的点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">GetMapCoordinates</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolMouseDown</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.ChangedButton == System.Windows.Input.MouseButton.Left)</span><br><span class="line">      e.Handled = <span class="literal">true</span>; <span class="comment">//Handle the event args to get the call to the corresponding async method</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleMouseDownAsync</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.BlackRGB, <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">var</span> layout = Project.Current.GetItems&lt;LayoutProjectItem&gt;().FirstOrDefault().GetLayout();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//Convert the clicked point in client coordinates to the corresponding map coordinates.</span></span><br><span class="line">      <span class="keyword">var</span> mapPoint = MapView.Active.ClientToMap(e.ClientPoint);</span><br><span class="line">      ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="built_in">string</span>.Format(<span class="string">&quot;X: &#123;0&#125; Y: &#123;1&#125; Z: &#123;2&#125;&quot;</span>,</span><br><span class="line">          mapPoint.X, mapPoint.Y, mapPoint.Z), <span class="string">&quot;Map Coordinates&quot;</span>);</span><br><span class="line">      <span class="comment">//Get the corresponding layout point</span></span><br><span class="line">      <span class="keyword">var</span> mapFrame = layout.FindElement(<span class="string">&quot;New Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">      <span class="keyword">var</span> pointOnLayoutFrame = mapFrame.MapToPage(mapPoint);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Create a point graphic on the Layout.</span></span><br><span class="line">      <span class="keyword">var</span> cimGraphicElement = <span class="keyword">new</span> CIMPointGraphic</span><br><span class="line">      &#123;</span><br><span class="line">        Location = pointOnLayoutFrame,</span><br><span class="line">        Symbol = pointSymbol.MakeSymbolReference()</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">//Or use GraphicFactory</span></span><br><span class="line">      <span class="keyword">var</span> cimGraphicElement2 = GraphicFactory.Instance.CreateSimpleGraphic(</span><br><span class="line">              pointOnLayoutFrame, pointSymbol);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//At 2.x - LayoutElementFactory.Instance.CreateGraphicElement(layout, cimGraphicElement);</span></span><br><span class="line"></span><br><span class="line">      ElementFactory.Instance.CreateGraphicElement(layout, cimGraphicElement);</span><br><span class="line">      ElementFactory.Instance.CreateGraphicElement(layout, cimGraphicElement2);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="布局图系列"><a href="#布局图系列" class="headerlink" title="布局图系列"></a>布局图系列</h2><h3 id="修改现有地图系列"><a href="#修改现有地图系列" class="headerlink" title="修改现有地图系列"></a>修改现有地图系列</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Modify the currently active map series and changes its sort field and page number field.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Perform on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  SpatialMapSeries SMS = layout.MapSeries <span class="keyword">as</span> SpatialMapSeries; <span class="comment">//cast as spatial map seris for additional members</span></span><br><span class="line">  SMS.SortField = <span class="string">&quot;State_Name&quot;</span>;</span><br><span class="line">  SMS.SortAscending = <span class="literal">true</span>;</span><br><span class="line">  SMS.PageNumberField = <span class="string">&quot;PageNum&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Overwrite the current map series with these new settings</span></span><br><span class="line">  layout.SetMapSeries(SMS); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建新的空间地图系列"><a href="#创建新的空间地图系列" class="headerlink" title="创建新的空间地图系列"></a>创建新的空间地图系列</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This example create a new spatial map series and then applies it to the active layout. This will automatically </span></span><br><span class="line"><span class="comment">// overwrite an existing map series if one is already present.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference map frame and index layer</span></span><br><span class="line">MapFrame mf = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">Map m = mf.Map;</span><br><span class="line">BasicFeatureLayer indexLyr = m.FindLayers(<span class="string">&quot;Countries&quot;</span>).FirstOrDefault() <span class="keyword">as</span> BasicFeatureLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Construct map series on worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//SpatialMapSeries constructor - required parameters</span></span><br><span class="line">  SpatialMapSeries SMS = MapSeries.CreateSpatialMapSeries(layout, mf, indexLyr, <span class="string">&quot;Name&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Set optional, non-default values</span></span><br><span class="line">  SMS.CategoryField = <span class="string">&quot;Continent&quot;</span>;</span><br><span class="line">  SMS.SortField = <span class="string">&quot;Population&quot;</span>;</span><br><span class="line">  SMS.ExtentOptions = ExtentFitType.BestFit;</span><br><span class="line">  SMS.MarginType = ArcGIS.Core.CIM.UnitType.PageUnits;</span><br><span class="line">  SMS.MarginUnits = ArcGIS.Core.Geometry.LinearUnit.Centimeters;</span><br><span class="line">  SMS.Margin = <span class="number">1</span>;</span><br><span class="line">  SMS.ScaleRounding = <span class="number">1000</span>;</span><br><span class="line">  layout.SetMapSeries(SMS);  <span class="comment">//Overwrite existing map series.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="布局导出"><a href="#布局导出" class="headerlink" title="布局导出"></a>布局导出</h2><h3 id="将布局导出为-PDF"><a href="#将布局导出为-PDF" class="headerlink" title="将布局导出为 PDF"></a>将布局导出为 PDF</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Export a single page layout to PDF.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a PDF format with appropriate settings</span></span><br><span class="line"><span class="comment">//BMP, EMF, EPS, GIF, JPEG, PNG, SVG, TGA, and TFF formats are also available for export</span></span><br><span class="line">PDFFormat PDF = <span class="keyword">new</span> PDFFormat()</span><br><span class="line">&#123;</span><br><span class="line">  OutputFileName = filePath,</span><br><span class="line">  Resolution = <span class="number">300</span>,</span><br><span class="line">  DoCompressVectorGraphics = <span class="literal">true</span>,</span><br><span class="line">  DoEmbedFonts = <span class="literal">true</span>,</span><br><span class="line">  HasGeoRefInfo = <span class="literal">true</span>,</span><br><span class="line">  ImageCompression = ImageCompression.Adaptive,</span><br><span class="line">  ImageQuality = ImageQuality.Best,</span><br><span class="line">  LayersAndAttributes = LayersAndAttributes.LayersAndAttributes</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Check to see if the path is valid and export</span></span><br><span class="line"><span class="keyword">if</span> (PDF.ValidateOutputFilePath())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; layout.Export(PDF));  <span class="comment">//Export the layout to PDF on the worker thread</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将地图框导出为-JPG"><a href="#将地图框导出为-JPG" class="headerlink" title="将地图框导出为 JPG"></a>将地图框导出为 JPG</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Export a map frame to JPG.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create JPEG format with appropriate settings</span></span><br><span class="line"><span class="comment">//BMP, EMF, EPS, GIF, PDF, PNG, SVG, TGA, and TFF formats are also available for export</span></span><br><span class="line"><span class="comment">//at 2.x - JPEGFormat JPG = new JPEGFormat()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  HasWorldFile = true,</span></span><br><span class="line"><span class="comment">//  Resolution = 300,</span></span><br><span class="line"><span class="comment">//  OutputFileName = filePath,</span></span><br><span class="line"><span class="comment">//  JPEGColorMode = JPEGColorMode.TwentyFourBitTrueColor,</span></span><br><span class="line"><span class="comment">//  Height = 800,</span></span><br><span class="line"><span class="comment">//  Width = 1200</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line">JPEGFormat JPG = <span class="keyword">new</span> JPEGFormat()</span><br><span class="line">&#123;</span><br><span class="line">  HasWorldFile = <span class="literal">true</span>,</span><br><span class="line">  Resolution = <span class="number">300</span>,</span><br><span class="line">  OutputFileName = filePath,</span><br><span class="line">  ColorMode = JPEGColorMode.TwentyFourBitTrueColor,</span><br><span class="line">  Height = <span class="number">800</span>,</span><br><span class="line">  Width = <span class="number">1200</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the map frame</span></span><br><span class="line">MapFrame mf = layout.FindElement(<span class="string">&quot;MyMapFrame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Export on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check to see if the path is valid and export</span></span><br><span class="line">  <span class="keyword">if</span> (JPG.ValidateOutputFilePath())</span><br><span class="line">  &#123;</span><br><span class="line">    mf.Export(JPG);  <span class="comment">//Export the map frame to JPG</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将与地图框关联的地图视图导出到-BMP"><a href="#将与地图框关联的地图视图导出到-BMP" class="headerlink" title="将与地图框关联的地图视图导出到 BMP"></a>将与地图框关联的地图视图导出到 BMP</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Export the map view associated with a map frame to BMP.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create BMP format with appropriate settings</span></span><br><span class="line"><span class="comment">//EMF, EPS, GIF, JPEG, PDF, PNG, SVG, TGA, and TFF formats are also available for export</span></span><br><span class="line">BMPFormat BMP = <span class="keyword">new</span> BMPFormat()</span><br><span class="line">&#123;</span><br><span class="line">  Resolution = <span class="number">300</span>,</span><br><span class="line">  Height = <span class="number">500</span>,</span><br><span class="line">  Width = <span class="number">800</span>,</span><br><span class="line">  HasWorldFile = <span class="literal">true</span>,</span><br><span class="line">  OutputFileName = filePath</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the active layout view</span></span><br><span class="line">LayoutView lytView = LayoutView.Active;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference the map frame and its map view</span></span><br><span class="line">MapFrame mf_bmp = layout.FindElement(<span class="string">&quot;Map Frame&quot;</span>) <span class="keyword">as</span> MapFrame;</span><br><span class="line">MapView mv_bmp = mf_bmp.GetMapView(lytView);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mv_bmp != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Export on the worker thread</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Check to see if the path is valid and export</span></span><br><span class="line">    <span class="keyword">if</span> (BMP.ValidateOutputFilePath())</span><br><span class="line">    &#123;</span><br><span class="line">      mv_bmp.Export(BMP);  <span class="comment">//Export to BMP</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将地图系列导出为单个-PDF"><a href="#将地图系列导出为单个-PDF" class="headerlink" title="将地图系列导出为单个 PDF"></a>将地图系列导出为单个 PDF</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Export a map series with multiple pages to a single PDF.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create PDF format with appropriate settings</span></span><br><span class="line">PDFFormat MS_PDF = <span class="keyword">new</span> PDFFormat()</span><br><span class="line">&#123;</span><br><span class="line">  OutputFileName = filePath,</span><br><span class="line">  Resolution = <span class="number">300</span>,</span><br><span class="line">  DoCompressVectorGraphics = <span class="literal">true</span>,</span><br><span class="line">  DoEmbedFonts = <span class="literal">true</span>,</span><br><span class="line">  HasGeoRefInfo = <span class="literal">true</span>,</span><br><span class="line">  ImageCompression = ImageCompression.Adaptive,</span><br><span class="line">  ImageQuality = ImageQuality.Best,</span><br><span class="line">  LayersAndAttributes = LayersAndAttributes.LayersAndAttributes</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set up map series export options</span></span><br><span class="line">MapSeriesExportOptions MS_ExportOptions = <span class="keyword">new</span> MapSeriesExportOptions()</span><br><span class="line">&#123;</span><br><span class="line">  ExportPages = ExportPages.Custom,  <span class="comment">//Provide a specific list of pages</span></span><br><span class="line">  CustomPages = <span class="string">&quot;1-3, 5&quot;</span>,  <span class="comment">//Only used if ExportPages.Custom is set</span></span><br><span class="line">  ExportFileOptions = ExportFileOptions.ExportAsSinglePDF,  <span class="comment">//Export all pages to a single, multi-page PDF</span></span><br><span class="line">  ShowSelectedSymbology = <span class="literal">false</span>  <span class="comment">//Do no show selection symbology in the output</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Export on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check to see if the path is valid and export</span></span><br><span class="line">  <span class="keyword">if</span> (MS_PDF.ValidateOutputFilePath())</span><br><span class="line">  &#123;</span><br><span class="line">    layout.Export(MS_PDF, MS_ExportOptions);  <span class="comment">//Export to PDF</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将地图系列导出到单个-TIFF-文件"><a href="#将地图系列导出到单个-TIFF-文件" class="headerlink" title="将地图系列导出到单个 TIFF 文件"></a>将地图系列导出到单个 TIFF 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Export each page of a map series to an individual TIFF file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create TIFF format with appropriate settings</span></span><br><span class="line">TIFFFormat TIFF = <span class="keyword">new</span> TIFFFormat()</span><br><span class="line">&#123;</span><br><span class="line">  OutputFileName = filePath,</span><br><span class="line">  Resolution = <span class="number">300</span>,</span><br><span class="line">  ColorMode = TIFFColorMode.TwentyFourBitTrueColor,</span><br><span class="line">  HasGeoTiffTags = <span class="literal">true</span>,</span><br><span class="line">  HasWorldFile = <span class="literal">true</span>,</span><br><span class="line">  ImageCompression = TIFFImageCompression.LZW</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set up map series export options</span></span><br><span class="line">MapSeriesExportOptions MSExportOptions_TIFF = <span class="keyword">new</span> MapSeriesExportOptions()</span><br><span class="line">&#123;</span><br><span class="line">  ExportPages = ExportPages.All,  <span class="comment">//All pages</span></span><br><span class="line">  ExportFileOptions = ExportFileOptions.ExportMultipleNames,  <span class="comment">//Export each page to an individual file using page name as a suffix.</span></span><br><span class="line">  ShowSelectedSymbology = <span class="literal">true</span>  <span class="comment">//Include selection symbology in the output</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Export on the worker thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check to see if the path is valid and export</span></span><br><span class="line">  <span class="keyword">if</span> (TIFF.ValidateOutputFilePath())</span><br><span class="line">  &#123;</span><br><span class="line">    layout.Export(TIFF, MSExportOptions_TIFF);  <span class="comment">//Export to TIFF</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="布局选项"><a href="#布局选项" class="headerlink" title="布局选项"></a>布局选项</h2><h3 id="获取布局选项"><a href="#获取布局选项" class="headerlink" title="获取布局选项"></a>获取布局选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lastToolActive = ApplicationOptions.LayoutOptions.KeepLastToolActive;</span><br><span class="line"><span class="keyword">var</span> warnOnSurrounds = ApplicationOptions.LayoutOptions.WarnAboutAssociatedSurrounds;</span><br><span class="line"><span class="comment">//eg &lt;Install_Path&gt;\Resources\LayoutTemplates\en-US</span></span><br><span class="line"><span class="keyword">var</span> gallery_path = ApplicationOptions.LayoutOptions.LayoutTemplatePath;</span><br></pre></td></tr></table></figure>

<h3 id="设置布局选项"><a href="#设置布局选项" class="headerlink" title="设置布局选项"></a>设置布局选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//keep graphic element insert tool active</span></span><br><span class="line">ApplicationOptions.LayoutOptions.KeepLastToolActive = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//no warning when deleting a map frame results in other elements being deleted</span></span><br><span class="line">ApplicationOptions.LayoutOptions.WarnAboutAssociatedSurrounds = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//path to .pagx files used as templates</span></span><br><span class="line">ApplicationOptions.LayoutOptions.LayoutTemplatePath = <span class="string">@&quot;D:\data\layout_templates&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="文本和图形元素选项"><a href="#文本和图形元素选项" class="headerlink" title="文本和图形元素选项"></a>文本和图形元素选项</h2><h3 id="获取所有可用字体"><a href="#获取所有可用字体" class="headerlink" title="获取所有可用字体"></a>获取所有可用字体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: see also SymbolFactory.Instance.GetAvailableFonts() which returns the</span></span><br><span class="line"><span class="comment">//same list. Use for TextAndGraphicsElementsOptions.GetAvailableFonts() convenience</span></span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//A list of tuples of Font name + associated Font Styles, one tuple per</span></span><br><span class="line">  <span class="comment">//font, is returned</span></span><br><span class="line">  <span class="keyword">var</span> fonts = ApplicationOptions.TextAndGraphicsElementsOptions.GetAvailableFonts();</span><br><span class="line">  StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">  sb.AppendLine(<span class="string">&quot;Pro Fonts\r\n============================&quot;</span>);</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> font <span class="keyword">in</span> fonts)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> styles = <span class="built_in">string</span>.Join(<span class="string">&quot;,&quot;</span>, font.fontStyles);</span><br><span class="line">    sb.AppendLine(<span class="string">$&quot;<span class="subst">&#123;font.fontName&#125;</span>, [<span class="subst">&#123;styles&#125;</span>]&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(sb.ToString());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取文本和图形元素选项"><a href="#获取文本和图形元素选项" class="headerlink" title="获取文本和图形元素选项"></a>获取文本和图形元素选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the default font (see also &#x27;SymbolFactory.Instance.DefaultFont&#x27;)</span></span><br><span class="line">  <span class="keyword">var</span> def_font = ApplicationOptions.TextAndGraphicsElementsOptions.GetDefaultFont();</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(</span><br><span class="line">    <span class="string">$&quot;\r\ndefault font: <span class="subst">&#123;def_font.fontName&#125;</span>, <span class="subst">&#123;def_font.styleName&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the default graphics element symbols - point, line, poly, text</span></span><br><span class="line">  <span class="keyword">var</span> ptSymbol = ApplicationOptions.TextAndGraphicsElementsOptions.GetDefaultPointSymbol();</span><br><span class="line">  <span class="keyword">var</span> lineSymbol = ApplicationOptions.TextAndGraphicsElementsOptions.GetDefaultLineSymbol();</span><br><span class="line">  <span class="keyword">var</span> polySymbol = ApplicationOptions.TextAndGraphicsElementsOptions.GetDefaultPolygonSymbol();</span><br><span class="line">  <span class="keyword">var</span> textSymbol = ApplicationOptions.TextAndGraphicsElementsOptions.GetDefaultTextSymbol();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置文本和图形元素选项"><a href="#设置文本和图形元素选项" class="headerlink" title="设置文本和图形元素选项"></a>设置文本和图形元素选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set a default font. Use its default style</span></span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>);</span><br><span class="line">  <span class="comment">//or specify an explicit style</span></span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>, <span class="string">&quot;bold&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create symbols</span></span><br><span class="line">  <span class="keyword">var</span> ptSymbol2 = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    ColorFactory.Instance.RedRGB, <span class="number">14</span>, SimpleMarkerStyle.Diamond);</span><br><span class="line">  <span class="keyword">var</span> lineSymbol2 = SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">    ColorFactory.Instance.RedRGB, <span class="number">2</span>, SimpleLineStyle.Dash);</span><br><span class="line">  <span class="keyword">var</span> polySymbol2 = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">    ColorFactory.Instance.RedRGB, SimpleFillStyle.DiagonalCross);</span><br><span class="line">  <span class="keyword">var</span> textSymbol2 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">    ColorFactory.Instance.RedRGB, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set default point, line, poly, text graphics element symbols</span></span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultPointSymbol(ptSymbol2);</span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultLineSymbol(lineSymbol2);</span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultPolygonSymbol(polySymbol2);</span><br><span class="line">  ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultTextSymbol(textSymbol2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="MapFrame-Display-Constraints"><a href="#MapFrame-Display-Constraints" class="headerlink" title="MapFrame_Display_Constraints"></a>MapFrame_Display_Constraints</h2><h3 id="设置自动相机无"><a href="#设置自动相机无" class="headerlink" title="设置自动相机无"></a>设置自动相机无</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.None;</span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机固定范围"><a href="#设置自动相机固定范围" class="headerlink" title="设置自动相机固定范围"></a>设置自动相机固定范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.Fixed;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Extent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mf_extent = mf.GetViewExtent();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> extent = EnvelopeBuilderEx.CreateEnvelope(</span><br><span class="line">  <span class="number">400748.62</span>, <span class="number">800296.4</span>, <span class="number">1310669.05</span>, <span class="number">1424520.74</span>, mf.Map.SpatialReference);</span><br><span class="line">autoCamera.Extent = extent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机固定中心"><a href="#设置自动相机固定中心" class="headerlink" title="设置自动相机固定中心"></a>设置自动相机固定中心</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.Fixed;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Center;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera = mf.GetMapView(LayoutView.Active).Camera;</span><br><span class="line"><span class="keyword">var</span> center = mf.GetViewCenter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//var extent = EnvelopeBuilderEx.CreateEnvelope(</span></span><br><span class="line"><span class="comment">//    400748.62, 800296.4, 1310669.05, 1424520.74, mf.Map.SpatialReference);</span></span><br><span class="line"><span class="comment">//autoCamera.Extent = extent;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera2 = <span class="keyword">new</span> CIMViewCamera()</span><br><span class="line">&#123;</span><br><span class="line">  Heading = <span class="number">0</span>,</span><br><span class="line">  Pitch = <span class="number">-90</span>,</span><br><span class="line">  Roll = <span class="number">0</span>,</span><br><span class="line">  Scale = <span class="number">21169571</span>,</span><br><span class="line">  X = <span class="number">855708</span>,</span><br><span class="line">  Y = <span class="number">1112409</span>,</span><br><span class="line">  Z = <span class="built_in">double</span>.NaN</span><br><span class="line">&#125;;</span><br><span class="line">autoCamera.Camera = camera2;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机固定居中和缩放"><a href="#设置自动相机固定居中和缩放" class="headerlink" title="设置自动相机固定居中和缩放"></a>设置自动相机固定居中和缩放</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.Fixed;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.CenterAndScale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera = mf.GetMapView(LayoutView.Active).Camera;</span><br><span class="line"><span class="keyword">var</span> center = mf.GetViewCenter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//var extent = EnvelopeBuilderEx.CreateEnvelope(</span></span><br><span class="line"><span class="comment">//    400748.62, 800296.4, 1310669.05, 1424520.74, mf.Map.SpatialReference);</span></span><br><span class="line"><span class="comment">//autoCamera.Extent = extent;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera2 = <span class="keyword">new</span> CIMViewCamera()</span><br><span class="line">&#123;</span><br><span class="line">  Heading = <span class="number">0</span>,</span><br><span class="line">  Pitch = <span class="number">-90</span>,</span><br><span class="line">  Roll = <span class="number">0</span>,</span><br><span class="line">  Scale = <span class="number">21169571</span>,</span><br><span class="line">  X = <span class="number">1310669.0</span> + ((<span class="number">400748.5</span> - <span class="number">1310669.0</span>) / <span class="number">2.0</span>),</span><br><span class="line">  Y = <span class="number">800296.4</span> + ((<span class="number">1424520.74</span> - <span class="number">800296.4</span>) / <span class="number">2.0</span>),</span><br><span class="line">  Z = <span class="built_in">double</span>.NaN</span><br><span class="line">&#125;;</span><br><span class="line">autoCamera.Camera = camera2;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line"><span class="comment">//autoCamera.IntersectLayerPath = states.URI;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机固定比例"><a href="#设置自动相机固定比例" class="headerlink" title="设置自动相机固定比例"></a>设置自动相机固定比例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.Fixed;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Scale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera = mf.GetMapView(LayoutView.Active).Camera;</span><br><span class="line"><span class="keyword">var</span> center = mf.GetViewCenter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//var extent = EnvelopeBuilderEx.CreateEnvelope(</span></span><br><span class="line"><span class="comment">//    400748.62, 800296.4, 1310669.05, 1424520.74, mf.Map.SpatialReference);</span></span><br><span class="line"><span class="comment">//autoCamera.Extent = extent;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> camera2 = <span class="keyword">new</span> CIMViewCamera()</span><br><span class="line">&#123;</span><br><span class="line">  Heading = <span class="number">0</span>,</span><br><span class="line">  Pitch = <span class="number">-90</span>,</span><br><span class="line">  Roll = <span class="number">0</span>,</span><br><span class="line">  Scale = <span class="number">20000571</span>,</span><br><span class="line">  X = <span class="number">1310669.0</span> + ((<span class="number">400748.5</span> - <span class="number">1310669.0</span>) / <span class="number">2.0</span>),</span><br><span class="line">  Y = <span class="number">800296.4</span> + ((<span class="number">1424520.74</span> - <span class="number">800296.4</span>) / <span class="number">2.0</span>),</span><br><span class="line">  Z = <span class="built_in">double</span>.NaN</span><br><span class="line">&#125;;</span><br><span class="line">autoCamera.Camera = camera2;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line"><span class="comment">//autoCamera.IntersectLayerPath = states.URI;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动照相机链接范围"><a href="#设置自动照相机链接范围" class="headerlink" title="设置自动照相机链接范围"></a>设置自动照相机链接范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapFrameLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Extent;</span><br><span class="line">autoCamera.MapFrameLinkName = mapFrameLink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机链接中心"><a href="#设置自动相机链接中心" class="headerlink" title="设置自动相机链接中心"></a>设置自动相机链接中心</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapFrameLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Center;</span><br><span class="line">autoCamera.MapFrameLinkName = mapFrameLink;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机链接中心和缩放"><a href="#设置自动相机链接中心和缩放" class="headerlink" title="设置自动相机链接中心和缩放"></a>设置自动相机链接中心和缩放</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapFrameLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.CenterAndScale;</span><br><span class="line">autoCamera.MapFrameLinkName = mapFrameLink;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机链接缩放"><a href="#设置自动相机链接缩放" class="headerlink" title="设置自动相机链接缩放"></a>设置自动相机链接缩放</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapFrameLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Scale;</span><br><span class="line">autoCamera.MapFrameLinkName = mapFrameLink;</span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机链接地图系列形状"><a href="#设置自动相机链接地图系列形状" class="headerlink" title="设置自动相机链接地图系列形状"></a>设置自动相机链接地图系列形状</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapSeriesLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Extent;</span><br><span class="line"><span class="comment">//autoCamera.MapFrameLinkName = mapFrameLink;</span></span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h3 id="设置自动相机链接地图系列中心"><a href="#设置自动相机链接地图系列中心" class="headerlink" title="设置自动相机链接地图系列中心"></a>设置自动相机链接地图系列中心</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> layout = LayoutView.Active.Layout;</span><br><span class="line"><span class="keyword">var</span> mf = layout.GetElementsAsFlattenedList().OfType&lt;MapFrame&gt;()</span><br><span class="line">  .First(mf =&gt; mf.Name == mapFrame);</span><br><span class="line"><span class="keyword">var</span> autoCamera = mf.GetAutoCamera();</span><br><span class="line">autoCamera.Source = AutoCameraSource.MapSeriesLink;</span><br><span class="line">autoCamera.AutoCameraType = AutoCameraType.Center;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> states = mf.Map.GetLayersAsFlattenedList().First(l =&gt; l.Name == <span class="string">&quot;State_Polygons&quot;</span>);</span><br><span class="line">autoCamera.IntersectLayerPath = states.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mf.ValidateAutoCamera(autoCamera) &amp;&amp;</span><br><span class="line">  !mf.IsMapSeriesMapFrame())</span><br><span class="line">  mf.SetAutoCamera(autoCamera);</span><br></pre></td></tr></table></figure>

<h1 id="布局-报告"><a href="#布局-报告" class="headerlink" title="布局-报告"></a>布局-报告</h1><h2 id="报告项目项"><a href="#报告项目项" class="headerlink" title="报告项目项"></a>报告项目项</h2><h3 id="获取当前项目中的所有报表"><a href="#获取当前项目中的所有报表" class="headerlink" title="获取当前项目中的所有报表"></a>获取当前项目中的所有报表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> projectReports = Project.Current.GetItems&lt;ReportProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> reportItem <span class="keyword">in</span> projectReports)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something with the report</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取特定报告"><a href="#获取特定报告" class="headerlink" title="获取特定报告"></a>获取特定报告</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ReportProjectItem reportProjItem = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(reportName));</span><br><span class="line">Report report = reportProjItem?.GetReport();</span><br></pre></td></tr></table></figure>

<h3 id="在新视图中打开报表项目项"><a href="#在新视图中打开报表项目项" class="headerlink" title="在新视图中打开报表项目项"></a>在新视图中打开报表项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Open a report project item in a new view.</span></span><br><span class="line"><span class="comment">//A report project item may exist but it may not be open in a view. </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reference a report project item by name</span></span><br><span class="line">ReportProjectItem reportPrjItem = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(<span class="string">&quot;MyReport&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the report associated with the report project item</span></span><br><span class="line">Report reportToOpen = <span class="keyword">await</span> QueuedTask.Run(() =&gt; reportPrjItem.GetReport());</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the new pane</span></span><br><span class="line">IReportPane iNewReporttPane = <span class="keyword">await</span> ProApp.Panes.CreateReportPaneAsync(reportToOpen); <span class="comment">//GUI thread</span></span><br></pre></td></tr></table></figure>

<h3 id="激活已打开的报告视图"><a href="#激活已打开的报告视图" class="headerlink" title="激活已打开的报告视图"></a>激活已打开的报告视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Report report = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault().GetReport();</span><br><span class="line"><span class="keyword">var</span> reportPane = FrameworkApplication.Panes.FindReportPanes(report).Last();</span><br><span class="line"><span class="keyword">if</span> (reportPane == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Activate the pane</span></span><br><span class="line">(reportPane <span class="keyword">as</span> ArcGIS.Desktop.Framework.Contracts.Pane).Activate();</span><br><span class="line"><span class="comment">//Get the &quot;ReportView&quot; associated with the Report Pane.</span></span><br><span class="line">ReportView reportView = reportPane.ReportView;</span><br></pre></td></tr></table></figure>

<h3 id="引用活动报表视图"><a href="#引用活动报表视图" class="headerlink" title="引用活动报表视图"></a>引用活动报表视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Confirm if the current, active view is a report view.  If it is, do something.</span></span><br><span class="line">ReportView activeReportView = ReportView.Active;</span><br><span class="line"><span class="keyword">if</span> (activeReportView != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="刷新报表视图"><a href="#刷新报表视图" class="headerlink" title="刷新报表视图"></a>刷新报表视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (reportView == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt; reportView.Refresh());</span><br></pre></td></tr></table></figure>

<h3 id="缩放到整个页面"><a href="#缩放到整个页面" class="headerlink" title="缩放到整个页面"></a>缩放到整个页面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt; reportView.ZoomToWholePage());</span><br></pre></td></tr></table></figure>

<h3 id="缩放到报表视图上的特定位置"><a href="#缩放到报表视图上的特定位置" class="headerlink" title="缩放到报表视图上的特定位置"></a>缩放到报表视图上的特定位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> detailsSection = report.Elements.OfType&lt;ReportSection&gt;().FirstOrDefault().Elements.OfType&lt;ReportDetails&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> bounds = detailsSection.GetBounds();</span><br><span class="line">ReportView.Active.ZoomTo(bounds);</span><br></pre></td></tr></table></figure>

<h3 id="缩放到页面宽度"><a href="#缩放到页面宽度" class="headerlink" title="缩放到页面宽度"></a>缩放到页面宽度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Process on worker thread</span></span><br><span class="line">QueuedTask.Run(() =&gt; reportView.ZoomToPageWidth());</span><br></pre></td></tr></table></figure>

<h2 id="创建报告"><a href="#创建报告" class="headerlink" title="创建报告"></a>创建报告</h2><h3 id="创建报告-1"><a href="#创建报告-1" class="headerlink" title="创建报告"></a>创建报告</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//The fields in the datasource used for the report</span></span><br><span class="line"><span class="comment">//This uses a US Cities dataset</span></span><br><span class="line"><span class="keyword">var</span> listFields = <span class="keyword">new</span> List&lt;CIMReportField&gt; &#123;</span><br><span class="line">          <span class="comment">//Grouping should be the first field</span></span><br><span class="line">          <span class="keyword">new</span> CIMReportField&#123;Name = <span class="string">&quot;STATE_NAME&quot;</span>, FieldOrder = <span class="number">0</span>, Group = <span class="literal">true</span>, SortInfo = FieldSortInfo.Desc&#125;, <span class="comment">//Group cities using STATES</span></span><br><span class="line">          <span class="keyword">new</span> CIMReportField&#123;Name = <span class="string">&quot;CITY_NAME&quot;</span>, FieldOrder = <span class="number">1</span>&#125;,</span><br><span class="line">          <span class="keyword">new</span> CIMReportField&#123;Name = <span class="string">&quot;POP1990&quot;</span>, FieldOrder = <span class="number">2</span>, &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"><span class="comment">//Definition query to use for the data source</span></span><br><span class="line"><span class="keyword">var</span> defQuery = <span class="string">&quot;STATE_NAME LIKE &#x27;C%&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//Define the Datasource</span></span><br><span class="line"><span class="comment">//pass true to use the selection set</span></span><br><span class="line"><span class="keyword">var</span> reportDataSource = <span class="keyword">new</span> ReportDataSource(featureLayer, defQuery, <span class="literal">false</span>, listFields);</span><br><span class="line"><span class="comment">//The CIMPage defintion - page size, units, etc</span></span><br><span class="line"><span class="keyword">var</span> cimReportPage = <span class="keyword">new</span> CIMPage</span><br><span class="line">&#123;</span><br><span class="line">  Height = <span class="number">11</span>,</span><br><span class="line">  StretchElements = <span class="literal">false</span>,</span><br><span class="line">  Width = <span class="number">6.5</span>,</span><br><span class="line">  ShowRulers = <span class="literal">true</span>,</span><br><span class="line">  ShowGuides = <span class="literal">true</span>,</span><br><span class="line">  Margin = <span class="keyword">new</span> CIMMargin &#123; Bottom = <span class="number">1</span>, Left = <span class="number">1</span>, Right = <span class="number">1</span>, Top = <span class="number">1</span> &#125;,</span><br><span class="line">  Units = LinearUnit.Inches</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Report template</span></span><br><span class="line"><span class="keyword">var</span> reportTemplates = <span class="keyword">await</span> ReportTemplateManager.GetTemplatesAsync();</span><br><span class="line"><span class="keyword">var</span> reportTemplate = reportTemplates.Where(r =&gt; r.Name == <span class="string">&quot;Attribute List with Grouping&quot;</span>).First();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Report Styling</span></span><br><span class="line"><span class="keyword">var</span> reportStyles = <span class="keyword">await</span> ReportStylingManager.GetStylingsAsync();</span><br><span class="line"><span class="keyword">var</span> reportStyle = reportStyles.Where(s =&gt; s == <span class="string">&quot;Cool Tones&quot;</span>).First();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Field Statistics</span></span><br><span class="line"><span class="keyword">var</span> fieldStatisticsList = <span class="keyword">new</span> List&lt;ReportFieldStatistic&gt; &#123;</span><br><span class="line">          <span class="keyword">new</span> ReportFieldStatistic&#123; Field = <span class="string">&quot;POP1990&quot;</span>, Statistic = FieldStatisticsFlag.Sum&#125;</span><br><span class="line">          <span class="comment">//Note: NoStatistics option for FieldStatisticsFlag is not supported.</span></span><br><span class="line">      &#125;;</span><br><span class="line"><span class="keyword">var</span> report = ReportFactory.Instance.CreateReport(<span class="string">&quot;USAReport&quot;</span>, reportDataSource, cimReportPage, fieldStatisticsList, reportTemplate, reportStyle);</span><br></pre></td></tr></table></figure>

<h3 id="将报告导出为-pdf"><a href="#将报告导出为-pdf" class="headerlink" title="将报告导出为 pdf"></a>将报告导出为 pdf</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Define Export Options</span></span><br><span class="line"><span class="keyword">var</span> exportOptions = <span class="keyword">new</span> ReportExportOptions</span><br><span class="line">&#123;</span><br><span class="line">  ExportPageOption = ExportPageOptions.ExportAllPages,</span><br><span class="line">  TotalPageNumberOverride = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create PDF format with appropriate settings</span></span><br><span class="line">PDFFormat pdfFormat = <span class="keyword">new</span> PDFFormat();</span><br><span class="line">pdfFormat.Resolution = <span class="number">300</span>;</span><br><span class="line">pdfFormat.OutputFileName = path;</span><br><span class="line">report.ExportToPDF(<span class="string">$&quot;<span class="subst">&#123;report.Name&#125;</span>&quot;</span>, pdfFormat, exportOptions, useSelection);</span><br></pre></td></tr></table></figure>

<h3 id="导入报告文件"><a href="#导入报告文件" class="headerlink" title="导入报告文件"></a>导入报告文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line">Item reportToImport = ItemFactory.Instance.Create(reportFile);</span><br><span class="line">Project.Current.AddItem(reportToImport <span class="keyword">as</span> IProjectItem);</span><br></pre></td></tr></table></figure>

<h3 id="删除报表"><a href="#删除报表" class="headerlink" title="删除报表"></a>删除报表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Reference a reportitem in a project by name</span></span><br><span class="line">ReportProjectItem reportItem = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(reportName));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Check for report item</span></span><br><span class="line"><span class="keyword">if</span> (reportItem == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span> Task.FromResult&lt;<span class="built_in">bool</span>&gt;(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Delete the report from the project</span></span><br><span class="line"><span class="keyword">return</span> Task.FromResult&lt;<span class="built_in">bool</span>&gt;(Project.Current.RemoveItem(reportItem));</span><br></pre></td></tr></table></figure>

<h2 id="修改报表"><a href="#修改报表" class="headerlink" title="修改报表"></a>修改报表</h2><h3 id="重命名报表"><a href="#重命名报表" class="headerlink" title="重命名报表"></a>重命名报表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line">ReportProjectItem reportProjItem = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(item =&gt; item.Name.Equals(reportName));</span><br><span class="line">reportProjItem.GetReport().SetName(<span class="string">&quot;RenamedReport&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="修改报表定义查询"><a href="#修改报表定义查询" class="headerlink" title="修改报表定义查询"></a>修改报表定义查询</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Remove Groups</span></span><br><span class="line"><span class="comment">// The fields in the datasource used for the report</span></span><br><span class="line"><span class="keyword">var</span> listFields = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">       <span class="string">&quot;STATE_NAME&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line">report.RemoveGroups(listFields);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Add Group</span></span><br><span class="line">report.AddGroup(<span class="string">&quot;STATE_NAME&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Modify the Definition Query</span></span><br><span class="line"><span class="keyword">var</span> defQuery = <span class="string">&quot;STATE_NAME LIKE &#x27;C%&#x27;&quot;</span>;</span><br><span class="line">report.SetDefinitionQuery(defQuery);</span><br></pre></td></tr></table></figure>

<h3 id="修改报表页"><a href="#修改报表页" class="headerlink" title="修改报表页"></a>修改报表页</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> cimReportPage = <span class="keyword">new</span> CIMPage</span><br><span class="line">&#123;</span><br><span class="line">  Height = <span class="number">12</span>,</span><br><span class="line">  StretchElements = <span class="literal">false</span>,</span><br><span class="line">  Width = <span class="number">6.5</span>,</span><br><span class="line">  ShowRulers = <span class="literal">true</span>,</span><br><span class="line">  ShowGuides = <span class="literal">true</span>,</span><br><span class="line">  Margin = <span class="keyword">new</span> CIMMargin &#123; Bottom = <span class="number">1</span>, Left = <span class="number">1</span>, Right = <span class="number">1</span>, Top = <span class="number">1</span> &#125;,</span><br><span class="line">  Units = LinearUnit.Inches</span><br><span class="line">&#125;;</span><br><span class="line">report.SetPage(cimReportPage);</span><br><span class="line"><span class="comment">//Change only the report&#x27;s page height</span></span><br><span class="line">report.SetPageHeight(<span class="number">12</span>);</span><br></pre></td></tr></table></figure>

<h3 id="添加子报表"><a href="#添加子报表" class="headerlink" title="添加子报表"></a>添加子报表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> mainReport = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(r =&gt; r.Name == <span class="string">&quot;USAReports&quot;</span>)?.GetReport();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mainReport == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Add sub report</span></span><br><span class="line"><span class="keyword">var</span> vermontReportItem = Project.Current.GetItems&lt;ReportProjectItem&gt;().FirstOrDefault(r =&gt; r.Name == <span class="string">&quot;Vermont&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (vermontReportItem == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">Report vermontReport = vermontReportItem.GetReport();</span><br><span class="line">mainReport.AddSubReport(vermontReportItem, <span class="number">-1</span>, <span class="literal">true</span>); <span class="comment">//  If -1, the subreport is added to the end of the report.</span></span><br></pre></td></tr></table></figure>

<h2 id="报表设计"><a href="#报表设计" class="headerlink" title="报表设计"></a>报表设计</h2><h3 id="获取报告模板"><a href="#获取报告模板" class="headerlink" title="获取报告模板"></a>获取报告模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Report Template Styles:</span></span><br><span class="line"><span class="comment">//Attribute List</span></span><br><span class="line"><span class="comment">//Attribute List with Grouping</span></span><br><span class="line"><span class="comment">//Basic Summary</span></span><br><span class="line"><span class="comment">//Basic Summary with Grouping</span></span><br><span class="line"><span class="comment">//Page Per Feature</span></span><br><span class="line"><span class="keyword">var</span> reportTemplates = <span class="keyword">await</span> ReportTemplateManager.GetTemplatesAsync();</span><br><span class="line"><span class="keyword">var</span> reportTemplate = reportTemplates.Where(r =&gt; r.Name == reportTemplateName).First();</span><br></pre></td></tr></table></figure>

<h3 id="获取报表样式"><a href="#获取报表样式" class="headerlink" title="获取报表样式"></a>获取报表样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Report Styling:</span></span><br><span class="line"><span class="comment">//Black and White</span></span><br><span class="line"><span class="comment">//Cool Tones</span></span><br><span class="line"><span class="comment">//Warm Tones</span></span><br><span class="line"><span class="keyword">var</span> reportStyles = <span class="keyword">await</span> ReportStylingManager.GetStylingsAsync();</span><br><span class="line"><span class="keyword">var</span> reportStyle = reportStyles.Where(s =&gt; s == reportStyleName).First();</span><br></pre></td></tr></table></figure>

<h2 id="报表元素"><a href="#报表元素" class="headerlink" title="报表元素"></a>报表元素</h2><h3 id="获取各种报告部分"><a href="#获取各种报告部分" class="headerlink" title="获取各种报告部分"></a>获取各种报告部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the &quot;ReportSection element&quot;</span></span><br><span class="line"><span class="comment">//ReportSectionElement contains the ReportHeader, ReportPageHeader, ReportDetails. ReportPageFooter, ReportFooter sections.</span></span><br><span class="line"><span class="keyword">var</span> mainReportSection = report.Elements.OfType&lt;ReportSection&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the ReportHeader</span></span><br><span class="line"><span class="keyword">var</span> reportHeader = mainReportSection?.Elements.OfType&lt;ReportHeader&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the ReportHeader</span></span><br><span class="line"><span class="keyword">var</span> reportPageHeader = mainReportSection?.Elements.OfType&lt;ReportPageHeader&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the &quot;ReportDetails&quot; within the ReportSectionElement. ReportDetails is where &quot;fields&quot; are.</span></span><br><span class="line"><span class="keyword">var</span> reportDetailsSection = mainReportSection?.Elements.OfType&lt;ReportDetails&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the ReportPageFooter</span></span><br><span class="line"><span class="keyword">var</span> reportPageFooter = mainReportSection?.Elements.OfType&lt;ReportPageFooter&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the ReportFooter</span></span><br><span class="line"><span class="keyword">var</span> reportFooter = mainReportSection?.Elements.OfType&lt;ReportFooter&gt;().FirstOrDefault();</span><br></pre></td></tr></table></figure>

<h3 id="选择元素"><a href="#选择元素" class="headerlink" title="选择元素"></a>选择元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ReportDetailsSection contains the &quot;Fields&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elements = reportDetailsSection.Elements;</span><br><span class="line">reportDetailsSection.SelectElements(elements);</span><br></pre></td></tr></table></figure>

<h3 id="选择所有元素"><a href="#选择所有元素" class="headerlink" title="选择所有元素"></a>选择所有元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Select all elements in the Report Footer.</span></span><br><span class="line">ReportPageFooter pageFooterSection = report.Elements.OfType&lt;ReportSection&gt;().FirstOrDefault().Elements.OfType&lt;ReportPageFooter&gt;().FirstOrDefault();</span><br><span class="line">pageFooterSection.SelectAllElements();</span><br></pre></td></tr></table></figure>

<h3 id="获取所选元素"><a href="#获取所选元素" class="headerlink" title="获取所选元素"></a>获取所选元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IReadOnlyList&lt;Element&gt; selectedElements = report.GetSelectedElements();</span><br><span class="line"><span class="comment">//Can also use the active ReportView</span></span><br><span class="line">IReadOnlyList&lt;Element&gt; selectedElementsFromView = ReportView.Active.GetSelectedElements();</span><br></pre></td></tr></table></figure>

<h3 id="缩放至所选元素"><a href="#缩放至所选元素" class="headerlink" title="缩放至所选元素"></a>缩放至所选元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt; reportView.ZoomToSelectedElements());</span><br></pre></td></tr></table></figure>

<h3 id="清晰的元素选择"><a href="#清晰的元素选择" class="headerlink" title="清晰的元素选择"></a>清晰的元素选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reportView.ClearElementSelection();</span><br></pre></td></tr></table></figure>

<h3 id="根据名称查找报表中的特定元素。"><a href="#根据名称查找报表中的特定元素。" class="headerlink" title="根据名称查找报表中的特定元素。"></a>根据名称查找报表中的特定元素。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reportElementsToFind = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;ReportText1&quot;</span>, <span class="string">&quot;ReportText2&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> textReportElements = report.FindElements(reportElementsToFind);</span><br></pre></td></tr></table></figure>

<h3 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt; report.DeleteElements(textReportElements));</span><br></pre></td></tr></table></figure>

<h3 id="在报表中创建新字段"><a href="#在报表中创建新字段" class="headerlink" title="在报表中创建新字段"></a>在报表中创建新字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//This is the gap between two fields</span></span><br><span class="line"><span class="built_in">double</span> fieldIncrement = <span class="number">0.9388875113593206276389</span>;</span><br><span class="line"><span class="comment">//On the QueuedTask</span></span><br><span class="line"><span class="comment">//New field to add.</span></span><br><span class="line"><span class="keyword">var</span> newReportField = <span class="keyword">new</span> CIMReportField</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;POP1990&quot;</span>,</span><br><span class="line">  FieldOrder = <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Get the &quot;ReportSection element&quot;                </span></span><br><span class="line"><span class="keyword">var</span> mainReportSection = report.Elements.OfType&lt;ReportSection&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (mainReportSection == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the &quot;ReportDetails&quot; within the ReportSectionElement. ReportDetails is where &quot;fields&quot; are.</span></span><br><span class="line"><span class="keyword">var</span> reportDetailsSection = mainReportSection?.Elements.OfType&lt;ReportDetails&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (reportDetailsSection == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Within ReportDetails find the envelope that encloses a field.</span></span><br><span class="line"><span class="comment">//We get the first CIMParagraphTextGraphic in the collection so that we can add the new field next to it.                    </span></span><br><span class="line"><span class="keyword">var</span> lastFieldGraphic = reportDetailsSection.Elements.FirstOrDefault((r) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> gr = r <span class="keyword">as</span> GraphicElement;</span><br><span class="line">  <span class="keyword">if</span> (gr == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> (gr.GetGraphic() <span class="keyword">is</span> CIMParagraphTextGraphic ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//Get the Envelope of the last field</span></span><br><span class="line"><span class="keyword">var</span> graphicBounds = lastFieldGraphic.GetBounds();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Min and Max values of the envelope</span></span><br><span class="line"><span class="keyword">var</span> xMinOfFieldEnvelope = graphicBounds.XMin;</span><br><span class="line"><span class="keyword">var</span> yMinOfFieldEnvelope = graphicBounds.YMin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xMaxOfFieldEnvelope = graphicBounds.XMax;</span><br><span class="line"><span class="keyword">var</span> YMaxOfFieldEnvelope = graphicBounds.YMax;</span><br><span class="line"><span class="comment">//create the new Envelope to be offset from the existing field</span></span><br><span class="line"><span class="comment">//At 2.x</span></span><br><span class="line"><span class="comment">//MapPoint newMinPoint = MapPointBuilder.CreateMapPoint(xMinOfFieldEnvelope + fieldIncrement, yMinOfFieldEnvelope);</span></span><br><span class="line"><span class="comment">//MapPoint newMaxPoint = MapPointBuilder.CreateMapPoint(xMaxOfFieldEnvelope + fieldIncrement, YMaxOfFieldEnvelope);</span></span><br><span class="line"><span class="comment">//Envelope newFieldEnvelope = EnvelopeBuilder.CreateEnvelope(newMinPoint, newMaxPoint);</span></span><br><span class="line"></span><br><span class="line">MapPoint newMinPoint = MapPointBuilderEx.CreateMapPoint(xMinOfFieldEnvelope + fieldIncrement, yMinOfFieldEnvelope);</span><br><span class="line">MapPoint newMaxPoint = MapPointBuilderEx.CreateMapPoint(xMaxOfFieldEnvelope + fieldIncrement, YMaxOfFieldEnvelope);</span><br><span class="line">Envelope newFieldEnvelope = EnvelopeBuilderEx.CreateEnvelope(newMinPoint, newMaxPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create field</span></span><br><span class="line">GraphicElement fieldGraphic = ReportElementFactory.Instance.CreateFieldValueTextElement(reportDetailsSection, newFieldEnvelope, newReportField);</span><br></pre></td></tr></table></figure>

<h1 id="地图创作"><a href="#地图创作" class="headerlink" title="地图创作"></a>地图创作</h1><h2 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h2><h3 id="获取活动地图"><a href="#获取活动地图" class="headerlink" title="获取活动地图"></a>获取活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map map = MapView.Active.Map;</span><br></pre></td></tr></table></figure>

<h3 id="使用默认底图图层创建新地图"><a href="#使用默认底图图层创建新地图" class="headerlink" title="使用默认底图图层创建新地图"></a>使用默认底图图层创建新地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> map = MapFactory.Instance.CreateMap(mapName, basemap: Basemap.ProjectDefault);</span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span> use the map...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在工程中查找地图并将其打开"><a href="#在工程中查找地图并将其打开" class="headerlink" title="在工程中查找地图并将其打开"></a>在工程中查找地图并将其打开</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;Map&gt; <span class="title">FindOpenExistingMapAsync</span>(<span class="params"><span class="built_in">string</span> mapName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    Map map = <span class="literal">null</span>;</span><br><span class="line">    Project proj = Project.Current;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Finding the first project item with name matches with mapName</span></span><br><span class="line">    MapProjectItem mpi =</span><br><span class="line">        proj.GetItems&lt;MapProjectItem&gt;()</span><br><span class="line">            .FirstOrDefault(m =&gt; m.Name.Equals(mapName, StringComparison.CurrentCultureIgnoreCase));</span><br><span class="line">    <span class="keyword">if</span> (mpi != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      map = mpi.GetMap();</span><br><span class="line">      <span class="comment">//Opening the map in a mapview</span></span><br><span class="line">      <span class="keyword">await</span> ProApp.Panes.CreateMapPaneAsync(map);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开-web-地图"><a href="#打开-web-地图" class="headerlink" title="打开 web 地图"></a>打开 web 地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map map = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Assume we get the selected webmap from the Project pane&#x27;s Portal tab</span></span><br><span class="line"><span class="keyword">if</span> (Project.Current.SelectedItems.Count &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (MapFactory.Instance.CanCreateMapFrom(Project.Current.SelectedItems[<span class="number">0</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">    map = MapFactory.Instance.CreateMapFromItem(Project.Current.SelectedItems[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">await</span> ProApp.Panes.CreateMapPaneAsync(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取地图窗格"><a href="#获取地图窗格" class="headerlink" title="获取地图窗格"></a>获取地图窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">IEnumerable</span>&lt;<span class="title">IMapPane</span>&gt; <span class="title">GetMapPanes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Sorted by Map Uri</span></span><br><span class="line">  <span class="keyword">return</span> ProApp.Panes.OfType&lt;IMapPane&gt;().OrderBy((mp) =&gt; mp.MapView.Map.URI ?? mp.MapView.Map.Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从地图窗格中获取唯一的地图列表"><a href="#从地图窗格中获取唯一的地图列表" class="headerlink" title="从地图窗格中获取唯一的地图列表"></a>从地图窗格中获取唯一的地图列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IReadOnlyList&lt;Map&gt; <span class="title">GetMapsFromMapPanes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Gets the unique list of Maps from all the MapPanes.</span></span><br><span class="line">  <span class="comment">//Note: The list of maps retrieved from the MapPanes</span></span><br><span class="line">  <span class="comment">//maybe less than the total number of Maps in the project.</span></span><br><span class="line">  <span class="comment">//It depends on what maps the user has actually opened.</span></span><br><span class="line">  <span class="keyword">var</span> mapPanes = ProApp.Panes.OfType&lt;IMapPane&gt;()</span><br><span class="line">              .GroupBy((mp) =&gt; mp.MapView.Map.URI).Select(grp =&gt; grp.FirstOrDefault());</span><br><span class="line">  List&lt;Map&gt; uniqueMaps = <span class="keyword">new</span> List&lt;Map&gt;();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> pane <span class="keyword">in</span> mapPanes)</span><br><span class="line">    uniqueMaps.Add(pane.MapView.Map);</span><br><span class="line">  <span class="keyword">return</span> uniqueMaps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改地图名称"><a href="#更改地图名称" class="headerlink" title="更改地图名称"></a>更改地图名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MapView.Active.Map.SetName(<span class="string">&quot;Test&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="重命名窗格的标题"><a href="#重命名窗格的标题" class="headerlink" title="重命名窗格的标题"></a>重命名窗格的标题</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProApp.Panes.ActivePane.Caption = <span class="string">&quot;Caption&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="将地图转换为局部场景"><a href="#将地图转换为局部场景" class="headerlink" title="将地图转换为局部场景"></a>将地图转换为局部场景</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within the context of QueuedTask.Run</span></span><br><span class="line"><span class="built_in">bool</span> canConvertMap = MapFactory.Instance.CanConvertMap(map, MapConversionType.SceneLocal);</span><br><span class="line"><span class="keyword">if</span> (canConvertMap)</span><br><span class="line">  MapFactory.Instance.ConvertMap(map, MapConversionType.SceneLocal, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取底图"><a href="#获取底图" class="headerlink" title="获取底图"></a>获取底图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Basemaps stored locally in the project. This is usually an empty collection</span></span><br><span class="line"><span class="built_in">string</span> localBasemapTypeID = <span class="string">&quot;cim_map_basemap&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> localBasemaps = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapContainer = Project.Current.GetProjectItemContainer(<span class="string">&quot;Map&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> mapContainer.GetItems().Where(i =&gt; i.TypeID == localBasemapTypeID).ToList();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//portal basemaps. If there is no current active portal, the usual default</span></span><br><span class="line"><span class="comment">//is arcgis online</span></span><br><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetActivePortal();</span><br><span class="line"><span class="keyword">var</span> portalBaseMaps = <span class="keyword">await</span> portal.GetBasemapsAsync();</span><br><span class="line"></span><br><span class="line"><span class="comment">//use one of them...local or portal...</span></span><br><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//QueuedTask.Run(() =&gt; map?.SetBasemapLayers(portalBaseMaps[0]));</span></span><br></pre></td></tr></table></figure>

<h3 id="将地图另存为-MapX"><a href="#将地图另存为-MapX" class="headerlink" title="将地图另存为 MapX"></a>将地图另存为 MapX</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.SaveAsFile(<span class="string">@&quot;C:\Data\MyMap.mapx&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将-2D-地图另存为-Web-地图-在磁盘上"><a href="#将-2D-地图另存为-Web-地图-在磁盘上" class="headerlink" title="将 2D 地图另存为 Web 地图 在磁盘上"></a>将 2D 地图另存为 Web 地图 在磁盘上</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2D maps only</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run(...)</span></span><br><span class="line"><span class="keyword">if</span> (map.DefaultViewingMode == MapViewingMode.Map)</span><br><span class="line">  <span class="comment">//Only webmap compatible layers will be saved out to the file</span></span><br><span class="line">  map.SaveAsWebMapFile(<span class="string">@&quot;C:\Data\MyMap.json&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="裁剪映射到提供的裁剪多边形"><a href="#裁剪映射到提供的裁剪多边形" class="headerlink" title="裁剪映射到提供的裁剪多边形"></a>裁剪映射到提供的裁剪多边形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Run within QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//A layer to use for the clip extent</span></span><br><span class="line"><span class="keyword">var</span> lyrOfInterest = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().Where(l =&gt; l.Name == <span class="string">&quot;TestPoly&quot;</span>).FirstOrDefault();</span><br><span class="line"><span class="comment">//Get the polygon to use to clip the map</span></span><br><span class="line"><span class="keyword">var</span> extent = lyrOfInterest.QueryExtent();</span><br><span class="line"><span class="keyword">var</span> polygonForClipping = PolygonBuilderEx.CreatePolygon(extent);</span><br><span class="line"><span class="comment">//Clip the map using the layer&#x27;s extent</span></span><br><span class="line">map.SetClipGeometry(polygonForClipping,</span><br><span class="line">    SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">      SymbolFactory.Instance.ConstructStroke(</span><br><span class="line">        ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.Dash)));</span><br></pre></td></tr></table></figure>

<h3 id="清除当前地图剪辑几何"><a href="#清除当前地图剪辑几何" class="headerlink" title="清除当前地图剪辑几何"></a>清除当前地图剪辑几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Run within QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//Clear the Map clip.</span></span><br><span class="line"><span class="comment">//If no clipping is set then this is a no-op.</span></span><br><span class="line">map.ClearClipGeometry();</span><br></pre></td></tr></table></figure>

<h3 id="获取地图裁剪几何"><a href="#获取地图裁剪几何" class="headerlink" title="获取地图裁剪几何"></a>获取地图裁剪几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//If clipping is set to ArcGIS.Core.CIM.ClippingMode.None or ArcGIS.Core.CIM.ClippingMode.MapSeries null is returned</span></span><br><span class="line"><span class="comment">//If clipping is set to ArcGIS.Core.CIM.ClippingMode.MapExtent the ArcGIS.Core.CIM.CIMMap.CustomFullExtent is returned.</span></span><br><span class="line"><span class="comment">//Otherwise, if clipping is set to ArcGIS.Core.CIM.ClippingMode.CustomShape the custom clip polygon is returned.</span></span><br><span class="line"><span class="keyword">var</span> poly = map.GetClipGeometry();</span><br><span class="line"><span class="comment">//You can use the polygon returned</span></span><br><span class="line"><span class="comment">//For example: We make a polygon graphic element and add it to a Graphics Layer.</span></span><br><span class="line"><span class="keyword">var</span> gl = map.GetLayersAsFlattenedList().OfType&lt;GraphicsLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (gl == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> polygonSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line"><span class="keyword">var</span> cimGraphicElement = <span class="keyword">new</span> CIMPolygonGraphic</span><br><span class="line">&#123;</span><br><span class="line">  Polygon = poly,</span><br><span class="line">  Symbol = polygonSymbol.MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">gl.AddElement(cimGraphicElement);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图位置单元"><a href="#获取当前地图位置单元" class="headerlink" title="获取当前地图位置单元"></a>获取当前地图位置单元</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the current location unit</span></span><br><span class="line"><span class="keyword">var</span> loc_unit = map.GetLocationUnitFormat();</span><br><span class="line"><span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;loc_unit.DisplayName&#125;</span>, <span class="subst">&#123;loc_unit.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(line);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用的地图位置单位列表"><a href="#获取可用的地图位置单位列表" class="headerlink" title="获取可用的地图位置单位列表"></a>获取可用的地图位置单位列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Linear location unit formats are not included if the map sr</span></span><br><span class="line"><span class="comment">//is geographic.</span></span><br><span class="line"><span class="keyword">var</span> loc_units = map.GetAvailableLocationUnitFormats();</span><br></pre></td></tr></table></figure>

<h3 id="使用当前地图位置单元设置位置格式"><a href="#使用当前地图位置单元设置位置格式" class="headerlink" title="使用当前地图位置单元设置位置格式"></a>使用当前地图位置单元设置位置格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the current view camera location</span></span><br><span class="line">  <span class="keyword">var</span> center_pt = <span class="keyword">new</span> Coordinate2D(mv.Camera.X, mv.Camera.Y);</span><br><span class="line">  <span class="comment">//Get the current location unit</span></span><br><span class="line">  <span class="keyword">var</span> loc_unit = map.GetLocationUnitFormat();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Format the camera location</span></span><br><span class="line">  <span class="keyword">var</span> str = loc_unit.FormatLocation(center_pt, map.SpatialReference);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;Formatted location: <span class="subst">&#123;str&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图的位置单位"><a href="#设置当前地图的位置单位" class="headerlink" title="设置当前地图的位置单位"></a>设置当前地图的位置单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the list of available location unit formats</span></span><br><span class="line">  <span class="comment">//for the current map</span></span><br><span class="line">  <span class="keyword">var</span> loc_units = map.GetAvailableLocationUnitFormats();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//arbitrarily use the last unit in the list</span></span><br><span class="line">  map.SetLocationUnitFormat(loc_units.Last());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图高程单位"><a href="#获取当前地图高程单位" class="headerlink" title="获取当前地图高程单位"></a>获取当前地图高程单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//If the map is not a scene, the default Project distance</span></span><br><span class="line"><span class="comment">//unit will be returned</span></span><br><span class="line"><span class="keyword">var</span> elev_unit = map.GetElevationUnitFormat();</span><br><span class="line"><span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;elev_unit.DisplayName&#125;</span>, <span class="subst">&#123;elev_unit.UnitCode&#125;</span>&quot;</span>;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(line);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用的地图高程单位列表"><a href="#获取可用的地图高程单位列表" class="headerlink" title="获取可用的地图高程单位列表"></a>获取可用的地图高程单位列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//If the map is not a scene, the list of current</span></span><br><span class="line"><span class="comment">//Project distance units will be returned</span></span><br><span class="line"><span class="keyword">var</span> elev_units = map.GetAvailableElevationUnitFormats();</span><br></pre></td></tr></table></figure>

<h3 id="使用当前地图高程单位设置高程格式"><a href="#使用当前地图高程单位设置高程格式" class="headerlink" title="使用当前地图高程单位设置高程格式"></a>使用当前地图高程单位设置高程格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> map = mv.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the current elevation unit. If the map is not</span></span><br><span class="line">  <span class="comment">//a scene the default Project distance unit is returned</span></span><br><span class="line">  <span class="keyword">var</span> elev_unit = map.GetElevationUnitFormat();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Format the view camera elevation</span></span><br><span class="line">  <span class="keyword">var</span> str = elev_unit.FormatValue(mv.Camera.Z);</span><br><span class="line"></span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;Formatted elevation: <span class="subst">&#123;str&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图的高程单位"><a href="#设置当前地图的高程单位" class="headerlink" title="设置当前地图的高程单位"></a>设置当前地图的高程单位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Trying to set the elevation unit on a map other than</span></span><br><span class="line">  <span class="comment">//a scene will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">if</span> (map.IsScene)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the list of available elevation unit formats</span></span><br><span class="line">    <span class="comment">//for the current map</span></span><br><span class="line">    <span class="keyword">var</span> loc_units = map.GetAvailableElevationUnitFormats();</span><br><span class="line">    <span class="comment">//arbitrarily use the last unit in the list</span></span><br><span class="line">    map.SetElevationUnitFormat(loc_units.Last());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="离线地图"><a href="#离线地图" class="headerlink" title="离线地图"></a>离线地图</h2><h3 id="检查地图是否具有启用同步的内容"><a href="#检查地图是否具有启用同步的内容" class="headerlink" title="检查地图是否具有启用同步的内容"></a>检查地图是否具有启用同步的内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> hasSyncEnabledContent = GenerateOfflineMap.Instance.GetCanGenerateReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (hasSyncEnabledContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO - use status...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="为启用同步的内容生成副本"><a href="#为启用同步的内容生成副本" class="headerlink" title="为启用同步的内容生成副本"></a>为启用同步的内容生成副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has sync-enabled content that can be taken offline</span></span><br><span class="line">  <span class="keyword">var</span> hasSyncEnabledContent = GenerateOfflineMap.Instance.GetCanGenerateReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (hasSyncEnabledContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Generate Replicas and take the content offline</span></span><br><span class="line">    <span class="comment">//sync-enabled content gets copied local into a SQLite DB</span></span><br><span class="line">    <span class="keyword">var</span> gen_params = <span class="keyword">new</span> GenerateReplicaParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent, <span class="comment">//SR of extent must match map SR</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//DestinationFolder can be left blank, if specified,</span></span><br><span class="line">      <span class="comment">//it must exist. Defaults to project offline maps location</span></span><br><span class="line">      DestinationFolder = <span class="string">@&quot;C:\Data\Offline&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//Sync-enabled layer content will be resourced to point to the</span></span><br><span class="line">    <span class="comment">//local replica content.</span></span><br><span class="line">    GenerateOfflineMap.Instance.GenerateReplicas(map, gen_params);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查地图是否具有本地可同步内容"><a href="#检查地图是否具有本地可同步内容" class="headerlink" title="检查地图是否具有本地可同步内容"></a>检查地图是否具有本地可同步内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="keyword">var</span> canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canSyncContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO - use status</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="同步可同步内容的副本"><a href="#同步可同步内容的副本" class="headerlink" title="同步可同步内容的副本"></a>同步可同步内容的副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="keyword">var</span> canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canSyncContent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Sync Replicas - changes since last sync are pushed to the</span></span><br><span class="line">    <span class="comment">//parent replica. Parent changes are pulled to the client.</span></span><br><span class="line">    <span class="comment">//Unsaved edits are _not_ sync&#x27;d. </span></span><br><span class="line">    GenerateOfflineMap.Instance.SynchronizeReplicas(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除可同步内容的副本"><a href="#删除可同步内容的副本" class="headerlink" title="删除可同步内容的副本"></a>删除可同步内容的副本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check map has local syncable content</span></span><br><span class="line">  <span class="comment">//Either..</span></span><br><span class="line">  <span class="comment">//var canSyncContent = GenerateOfflineMap.Instance.GetCanSynchronizeReplicas(map);</span></span><br><span class="line">  <span class="comment">//Or...both accomplish the same thing...</span></span><br><span class="line">  <span class="keyword">var</span> canRemove = GenerateOfflineMap.Instance.GetCanRemoveReplicas(map);</span><br><span class="line">  <span class="keyword">if</span> (canRemove)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Remove Replicas - any unsync&#x27;d changes are lost</span></span><br><span class="line">    <span class="comment">//Call sync _first_ to push any outstanding changes if</span></span><br><span class="line">    <span class="comment">//needed. Local syncable content is re-sourced</span></span><br><span class="line">    <span class="comment">//to point to the service</span></span><br><span class="line">    GenerateOfflineMap.Instance.RemoveReplicas(map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="导出地图栅格切片缓存内容"><a href="#导出地图栅格切片缓存内容" class="headerlink" title="导出地图栅格切片缓存内容"></a>导出地图栅格切片缓存内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Does the map have any exportable raster content?</span></span><br><span class="line">  <span class="keyword">var</span> canExport = GenerateOfflineMap.Instance.GetCanExportRasterTileCache(map);</span><br><span class="line">  <span class="keyword">if</span> (canExport)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Check the available LOD scale ranges</span></span><br><span class="line">    <span class="keyword">var</span> scales = GenerateOfflineMap.Instance.GetExportRasterTileCacheScales(map, extent);</span><br><span class="line">    <span class="comment">//Pick the desired LOD scale</span></span><br><span class="line">    <span class="keyword">var</span> max_scale = scales[scales.Count() / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Configure the export parameters</span></span><br><span class="line">    <span class="keyword">var</span> export_params = <span class="keyword">new</span> ExportTileCacheParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent,<span class="comment">//Use same extent as was used to retrieve scales</span></span><br><span class="line">      MaximumUserDefinedScale = max_scale</span><br><span class="line">      <span class="comment">//DestinationFolder = .... (optional)</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//If DestinationFolder is not set, output defaults to project</span></span><br><span class="line">    <span class="comment">//offline maps location set in the project properties. If that is </span></span><br><span class="line">    <span class="comment">//not set, output defaults to the current project folder location.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Do the export. Depending on the MaximumUserDefinedScale and the</span></span><br><span class="line">    <span class="comment">//area of the extent requested, this can take minutes for tile packages</span></span><br><span class="line">    <span class="comment">//over 1 GB or less if your network speed is slow...</span></span><br><span class="line">    GenerateOfflineMap.Instance.ExportRasterTileCache(map, export_params);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="导出地图矢量切片缓存内容"><a href="#导出地图矢量切片缓存内容" class="headerlink" title="导出地图矢量切片缓存内容"></a>导出地图矢量切片缓存内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//namespace ArcGIS.Desktop.Mapping.Offline</span></span><br><span class="line"><span class="keyword">var</span> extent = MapView.Active.Extent;</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//await if needed...</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Does the map have any exportable vector tile content?</span></span><br><span class="line">  <span class="keyword">var</span> canExport = GenerateOfflineMap.Instance.GetCanExportVectorTileCache(map);</span><br><span class="line">  <span class="keyword">if</span> (canExport)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Check the available LOD scale ranges</span></span><br><span class="line">    <span class="keyword">var</span> scales = GenerateOfflineMap.Instance.GetExportVectorTileCacheScales(map, extent);</span><br><span class="line">    <span class="comment">//Pick the desired LOD scale</span></span><br><span class="line">    <span class="keyword">var</span> max_scale = scales[scales.Count() / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Configure the export parameters</span></span><br><span class="line">    <span class="keyword">var</span> export_params = <span class="keyword">new</span> ExportTileCacheParams()</span><br><span class="line">    &#123;</span><br><span class="line">      Extent = extent,<span class="comment">//Use same extent as was used to retrieve scales</span></span><br><span class="line">      MaximumUserDefinedScale = max_scale,</span><br><span class="line">      DestinationFolder = <span class="string">@&quot;C:\Data\Offline&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//If DestinationFolder is not set, output defaults to project</span></span><br><span class="line">    <span class="comment">//offline maps location set in the project properties. If that is </span></span><br><span class="line">    <span class="comment">//not set, output defaults to the current project folder location.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Do the export. Depending on the MaximumUserDefinedScale and the</span></span><br><span class="line">    <span class="comment">//area of the extent requested, this can take minutes for tile packages</span></span><br><span class="line">    <span class="comment">//over 1 GB or less if your network speed is slow...</span></span><br><span class="line">    GenerateOfflineMap.Instance.ExportVectorTileCache(map, export_params);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建图层"><a href="#创建图层" class="headerlink" title="创建图层"></a>创建图层</h2><h3 id="创建图层并将其添加到活动地图"><a href="#创建图层并将其添加到活动地图" class="headerlink" title="创建图层并将其添加到活动地图"></a>创建图层并将其添加到活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\project.gdb\DEM&quot;;  //Raster dataset from a FileGeodatabase</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\connections\mySDEConnection.sde\roads&quot;;  //FeatureClass of a SDE</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\connections\mySDEConnection.sde\States\roads&quot;;  //FeatureClass within a FeatureDataset from a SDE</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\roads.shp&quot;;  //Shapefile</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\imagery.tif&quot;;  //Image from a folder</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\mySDEConnection.sde\roads&quot;;  //.lyrx or .lpkx file</span></span><br><span class="line"><span class="comment">* string url = @&quot;c:\data\CAD\Charlottesville\N1W1.dwg\Polyline&quot;;  //FeatureClass in a CAD dwg file</span></span><br><span class="line"><span class="comment">* string url = @&quot;C:\data\CAD\UrbanHouse.rvt\Architectural\Windows&quot;; //Features in a Revit file</span></span><br><span class="line"><span class="comment">* string url = @&quot;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer&quot;;  //map service</span></span><br><span class="line"><span class="comment">* string url = @&quot;http://sampleserver6.arcgisonline.com/arcgis/rest/services/NapervilleShelters/FeatureServer/0&quot;;  //FeatureLayer off a map service or feature service</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;c:\data\project.gdb\roads&quot;</span>;  <span class="comment">//FeatureClass of a FileGeodatabase</span></span><br><span class="line"></span><br><span class="line">Uri uri = <span class="keyword">new</span> Uri(url);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; LayerFactory.Instance.CreateLayer(uri, MapView.Active.Map));</span><br></pre></td></tr></table></figure>

<h3 id="使用创建参数创建图层"><a href="#使用创建参数创建图层" class="headerlink" title="使用创建参数创建图层"></a>使用创建参数创建图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flyrCreatnParam = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\world.gdb\cities&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;World Cities&quot;</span>,</span><br><span class="line">  IsVisible = <span class="literal">false</span>,</span><br><span class="line">  MinimumScale = <span class="number">1000000</span>,</span><br><span class="line">  MaximumScale = <span class="number">5000</span>,</span><br><span class="line">  <span class="comment">// At 2.x - DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line">  <span class="comment">//&#123;</span></span><br><span class="line">  <span class="comment">//  DefinitionExpression = &quot;Population &gt; 100000&quot;,</span></span><br><span class="line">  <span class="comment">//  Name = &quot;More than 100k&quot;</span></span><br><span class="line">  <span class="comment">//&#125;,</span></span><br><span class="line">  DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;Population &gt; 100000&quot;</span>, name: <span class="string">&quot;More than 100k&quot;</span>),</span><br><span class="line">  RendererDefinition = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">      CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> featureLayer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">  flyrCreatnParam, map);</span><br></pre></td></tr></table></figure>

<h3 id="创建要素图层并使用图层创建参数添加到地图"><a href="#创建要素图层并使用图层创建参数添加到地图" class="headerlink" title="创建要素图层并使用图层创建参数添加到地图"></a>创建要素图层并使用图层创建参数添加到地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">var</span> layerDoc = <span class="keyword">new</span> LayerDocument(<span class="string">@&quot;E:\Data\SDK\Default2DPointSymbols.lyrx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> LayerCreationParams(layerDoc.GetCIMLayerDocument());</span><br><span class="line">LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(createParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="创建要素图层并设置为不显示在地图中。"><a href="#创建要素图层并设置为不显示在地图中。" class="headerlink" title="创建要素图层并设置为不显示在地图中。"></a>创建要素图层并设置为不显示在地图中。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUriVisibility = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="keyword">var</span> layerParamsVisibility = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUriVisibility)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set visibility</span></span><br><span class="line">  IsVisible = <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFC = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParamsVisibility, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="使用渲染器创建要素图层"><a href="#使用渲染器创建要素图层" class="headerlink" title="使用渲染器创建要素图层"></a>使用渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Define a simple renderer to draw the Point US Cities feature class.</span></span><br><span class="line"><span class="keyword">var</span> simpleRender = <span class="keyword">new</span> SimpleRendererDefinition</span><br><span class="line">&#123;</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">4.0</span>, SimpleMarkerStyle.Circle).MakeSymbolReference()</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUri = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="keyword">var</span> layerParams = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUri)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set visibility</span></span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//Set Renderer</span></span><br><span class="line">  RendererDefinition = simpleRender,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFCWithRenderer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="使用查询定义创建要素图层"><a href="#使用查询定义创建要素图层" class="headerlink" title="使用查询定义创建要素图层"></a>使用查询定义创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The catalog path of the feature layer to add to the map</span></span><br><span class="line"><span class="keyword">var</span> featureClassUriDefinition = <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Data\Admin\AdminData.gdb\USA\cities&quot;</span>);</span><br><span class="line"><span class="comment">//Define the Feature Layer&#x27;s parameters.</span></span><br><span class="line"><span class="comment">//At 2.x - var layerParamsQueryDefn = new FeatureLayerCreationParams(featureClassUriDefinition)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  IsVisible = true,</span></span><br><span class="line"><span class="comment">//  DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//    Name = &quot;CACities&quot;,</span></span><br><span class="line"><span class="comment">//    DefinitionExpression = &quot;STATE_NAME = &#x27;California&#x27;&quot;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="keyword">var</span> layerParamsQueryDefn = <span class="keyword">new</span> FeatureLayerCreationParams(featureClassUriDefinition)</span><br><span class="line">&#123;</span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">  DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;STATE_NAME = &#x27;California&#x27;&quot;</span>, name: <span class="string">&quot;CACities&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the layer with the feature layer parameters and add it to the active map</span></span><br><span class="line"><span class="keyword">var</span> createdFCWithQueryDefn = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParamsQueryDefn, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="将地图注释添加到活动地图"><a href="#将地图注释添加到活动地图" class="headerlink" title="将地图注释添加到活动地图"></a>将地图注释添加到活动地图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gets the collection of layer template packages installed with Pro for use with maps</span></span><br><span class="line"><span class="keyword">var</span> items = MapView.Active.Map.LayerTemplatePackages;</span><br><span class="line"><span class="comment">//Iterate through the collection of items to add each Map Note to the active map</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> items)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create a parameter item for the map note</span></span><br><span class="line">  <span class="keyword">var</span> layer_params = <span class="keyword">new</span> LayerCreationParams(item);</span><br><span class="line">  layer_params.IsVisible = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Create a feature layer for the map note</span></span><br><span class="line">    <span class="keyword">var</span> layer = LayerFactory.Instance.CreateLayer&lt;Layer&gt;(layer_params, MapView.Active.Map);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用目录中图层的符号系统"><a href="#应用目录中图层的符号系统" class="headerlink" title="应用目录中图层的符号系统"></a>应用目录中图层的符号系统</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Call within QueuedTask.Run()</span></span><br><span class="line"><span class="keyword">if</span> (MapView.Active.Map == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get an existing Layer. This layer has a symbol you want to use in a new layer.</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;()</span><br><span class="line">      .Where(l =&gt; l.ShapeType == esriGeometryType.esriGeometryPoint).FirstOrDefault();</span><br><span class="line"><span class="comment">//This is the renderer to use in the new Layer</span></span><br><span class="line"><span class="keyword">var</span> renderer = lyr.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line"><span class="comment">//Set the Dataconnection for the new layer</span></span><br><span class="line">Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(</span><br><span class="line">  <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;E:\Data\Admin\AdminData.gdb&quot;</span>)));</span><br><span class="line">FeatureClass featureClass = geodatabase.OpenDataset&lt;FeatureClass&gt;(<span class="string">&quot;Cities&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> dataConnection = featureClass.GetDataConnection();</span><br><span class="line"><span class="comment">//Create the definition for the new feature layer</span></span><br><span class="line"><span class="keyword">var</span> featureLayerParams = <span class="keyword">new</span> FeatureLayerCreationParams(dataConnection)</span><br><span class="line">&#123;</span><br><span class="line">  RendererDefinition = <span class="keyword">new</span> SimpleRendererDefinition(renderer.Symbol),</span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//create the new layer</span></span><br><span class="line">LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">  featureLayerParams, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="创建新的子类型图层组"><a href="#创建新的子类型图层组" class="headerlink" title="创建新的子类型图层组"></a>创建新的子类型图层组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subtypeGroupLayerCreateParam = <span class="keyword">new</span> SubtypeGroupLayerCreationParams</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\SubtypeAndDomain.gdb\Fittings&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define Subtype layers</span></span><br><span class="line"><span class="comment">//At 2.x - var rendererDefn1 = new UniqueValueRendererDefinition(new string[] &#123; &quot;type&quot; &#125;);</span></span><br><span class="line"><span class="keyword">var</span> rendererDefn1 = <span class="keyword">new</span> UniqueValueRendererDefinition(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;type&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> renderDefn2 = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">          CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">subtypeGroupLayerCreateParam.SubtypeLayers = <span class="keyword">new</span> List&lt;SubtypeFeatureLayerCreationParams&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//define first subtype layer with unique value renderer</span></span><br><span class="line">  <span class="comment">//At 2.x - new SubtypeFeatureLayerCreationParams(new UniqueValueRendererDefinition(new string[] &#123; &quot;type&quot; &#125;), 1),</span></span><br><span class="line">  <span class="keyword">new</span> SubtypeFeatureLayerCreationParams(<span class="keyword">new</span> UniqueValueRendererDefinition(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;type&quot;</span> &#125;), <span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">//define second subtype layer with simple symbol renderer</span></span><br><span class="line">  <span class="keyword">new</span> SubtypeFeatureLayerCreationParams(renderDefn2, <span class="number">2</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define additional parameters</span></span><br><span class="line"><span class="comment">//At - 2.x subtypeGroupLayerCreateParam.DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  Name = &quot;IsActive&quot;,</span></span><br><span class="line"><span class="comment">//  DefinitionExpression = &quot;Enabled = 1&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line">subtypeGroupLayerCreateParam.DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;Enabled = 1&quot;</span>, name: <span class="string">&quot;IsActive&quot;</span>);</span><br><span class="line">subtypeGroupLayerCreateParam.IsVisible = <span class="literal">true</span>;</span><br><span class="line">subtypeGroupLayerCreateParam.MinimumScale = <span class="number">50000</span>;</span><br><span class="line"></span><br><span class="line">SubtypeGroupLayer subtypeGroupLayer2 = LayerFactory.Instance.CreateLayer&lt;SubtypeGroupLayer&gt;(</span><br><span class="line">              subtypeGroupLayerCreateParam, MapView.Active.Map);</span><br></pre></td></tr></table></figure>

<h3 id="从-lyrx-文件创建图层"><a href="#从-lyrx-文件创建图层" class="headerlink" title="从 lyrx 文件创建图层"></a>从 lyrx 文件创建图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyrDocFromLyrxFile = <span class="keyword">new</span> LayerDocument(<span class="string">@&quot;d:\data\cities.lyrx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//modifying its renderer symbol to red</span></span><br><span class="line"><span class="keyword">var</span> r = ((CIMFeatureLayer)cimLyrDoc.LayerDefinitions[<span class="number">0</span>]).Renderer <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">r.Symbol.Symbol.SetColor(<span class="keyword">new</span> CIMRGBColor() &#123; R = <span class="number">255</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//optionally save the updates out as a file</span></span><br><span class="line">lyrDocFromLyrxFile.Save(<span class="string">@&quot;c:\data\cities_red.lyrx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//get a json representation of the layer document and you want store away...</span></span><br><span class="line"><span class="keyword">var</span> aJSONString = lyrDocFromLyrxFile.AsJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">//... and load it back when needed</span></span><br><span class="line">lyrDocFromLyrxFile.Load(aJSONString);</span><br><span class="line">cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//create a layer and add it to a map</span></span><br><span class="line"><span class="keyword">var</span> lcp = <span class="keyword">new</span> LayerCreationParams(cimLyrDoc);</span><br><span class="line"><span class="keyword">var</span> lyr = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(lcp, map);</span><br></pre></td></tr></table></figure>

<h3 id="将符号系统应用于图层文件中的图层"><a href="#将符号系统应用于图层文件中的图层" class="headerlink" title="将符号系统应用于图层文件中的图层"></a>将符号系统应用于图层文件中的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within QueuedTask.Run</span></span><br><span class="line"><span class="comment">//Get the Layer Document from the lyrx file</span></span><br><span class="line"><span class="keyword">var</span> lyrDocFromLyrxFile = <span class="keyword">new</span> LayerDocument(layerFile);</span><br><span class="line"><span class="keyword">var</span> cimLyrDoc = lyrDocFromLyrxFile.GetCIMLayerDocument();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the renderer from the layer file</span></span><br><span class="line"><span class="keyword">var</span> rendererFromLayerFile = ((CIMFeatureLayer)cimLyrDoc.LayerDefinitions[<span class="number">0</span>]).Renderer <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Apply the renderer to the feature layer</span></span><br><span class="line"><span class="comment">//Note: If working with a raster layer, use the SetColorizer method.</span></span><br><span class="line">featureLayer?.SetRenderer(rendererFromLayerFile);</span><br></pre></td></tr></table></figure>

<h3 id="添加-WMS-服务"><a href="#添加-WMS-服务" class="headerlink" title="添加 WMS 服务"></a>添加 WMS 服务</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a connection to the WMS server</span></span><br><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection &#123; URL = <span class="string">&quot;URL of the WMS service&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> CIMWMSServiceConnection &#123; ServerConnection = serverConnection &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a new layer to the map</span></span><br><span class="line"><span class="keyword">var</span> layerParams = <span class="keyword">new</span> LayerCreationParams(connection);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> layer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParams, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="添加-WFS-服务"><a href="#添加-WFS-服务" class="headerlink" title="添加 WFS 服务"></a>添加 WFS 服务</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CIMStandardDataConnection cIMStandardDataConnection = <span class="keyword">new</span> CIMStandardDataConnection()</span><br><span class="line">&#123;</span><br><span class="line">  WorkspaceConnectionString = <span class="string">@&quot;SWAPXY=TRUE;SWAPXYFILTER=FALSE;URL=http://sampleserver6.arcgisonline.com/arcgis/services/SampleWorldCities/MapServer/WFSServer;VERSION=2.0.0&quot;</span>,</span><br><span class="line">  WorkspaceFactory = WorkspaceFactory.WFS,</span><br><span class="line">  Dataset = <span class="string">&quot;Continent&quot;</span>,</span><br><span class="line">  DatasetType = esriDatasetType.esriDTFeatureClass</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a new layer to the map</span></span><br><span class="line"><span class="keyword">var</span> layerPamsDC = <span class="keyword">new</span> LayerCreationParams(cIMStandardDataConnection);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Layer layer = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerPamsDC, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="添加和更改-WMS-服务图层的样式"><a href="#添加和更改-WMS-服务图层的样式" class="headerlink" title="添加和更改 WMS 服务图层的样式"></a>添加和更改 WMS 服务图层的样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection &#123; URL = <span class="string">&quot;https://spritle.esri.com/arcgis/services/sanfrancisco_sld/MapServer/WMSServer&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> CIMWMSServiceConnection &#123; ServerConnection = serverConnection &#125;;</span><br><span class="line">LayerCreationParams parameters = <span class="keyword">new</span> LayerCreationParams(connection);</span><br><span class="line">parameters.MapMemberPosition = MapMemberPosition.AddToBottom;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> compositeLyr = LayerFactory.Instance.CreateLayer&lt;WMSLayer&gt;(parameters, MapView.Active.Map);</span><br><span class="line">  <span class="comment">//wms layer in ArcGIS Pro always has a composite layer inside it</span></span><br><span class="line">  <span class="keyword">var</span> wmsLayers = compositeLyr.Layers[<span class="number">0</span>] <span class="keyword">as</span> ServiceCompositeSubLayer;</span><br><span class="line">  <span class="comment">//each wms sublayer belongs in that composite layer</span></span><br><span class="line">  <span class="keyword">var</span> highwayLayerWMSSub = wmsLayers.Layers[<span class="number">1</span>] <span class="keyword">as</span> WMSSubLayer;</span><br><span class="line">  <span class="comment">//toggling a sublayer&#x27;s visibility</span></span><br><span class="line">  <span class="keyword">if</span> ((highwayLayerWMSSub != <span class="literal">null</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bool</span> visibility = highwayLayerWMSSub.IsVisible;</span><br><span class="line">    highwayLayerWMSSub.SetVisibility(!visibility);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//applying an existing style to a wms sub layer</span></span><br><span class="line">  <span class="keyword">var</span> pizzaLayerWMSSub = wmsLayers.Layers[<span class="number">0</span>] <span class="keyword">as</span> WMSSubLayer;</span><br><span class="line">  <span class="keyword">var</span> currentStyles = pizzaLayerWMSSub.GetStyleNames();</span><br><span class="line">  pizzaLayerWMSSub.SetStyleName(currentStyles[<span class="number">1</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建查询图层"><a href="#创建查询图层" class="headerlink" title="创建查询图层"></a>创建查询图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Map map = MapView.Active.Map;</span><br><span class="line">  Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(<span class="keyword">new</span> DatabaseConnectionFile(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Connections\mySDE.sde&quot;</span>)));</span><br><span class="line">  CIMSqlQueryDataConnection sqldc = <span class="keyword">new</span> CIMSqlQueryDataConnection()</span><br><span class="line">  &#123;</span><br><span class="line">    WorkspaceConnectionString = geodatabase.GetConnectionString(),</span><br><span class="line">    GeometryType = esriGeometryType.esriGeometryPolygon,</span><br><span class="line">    OIDFields = <span class="string">&quot;OBJECTID&quot;</span>,</span><br><span class="line">    Srid = <span class="string">&quot;102008&quot;</span>,</span><br><span class="line">    SqlQuery = <span class="string">&quot;select * from MySDE.dbo.STATES&quot;</span>,</span><br><span class="line">    Dataset = <span class="string">&quot;States&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> lcp = <span class="keyword">new</span> LayerCreationParams(sqldc)</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;States&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  FeatureLayer flyr = LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(lcp, map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用默认值分类间隔渲染器创建要素图层"><a href="#使用默认值分类间隔渲染器创建要素图层" class="headerlink" title="使用默认值分类间隔渲染器创建要素图层"></a>使用默认值分类间隔渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> featureLayerCreationParams = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\data\countydata.gdb\counties&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Population Density (sq mi) Year 2010&quot;</span>,</span><br><span class="line">    RendererDefinition = <span class="keyword">new</span> GraduatedColorsRendererDefinition(<span class="string">&quot;POP10_SQMI&quot;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(</span><br><span class="line">    featureLayerCreationParams,</span><br><span class="line">    MapView.Active.Map</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用分类间隔渲染器创建要素图层"><a href="#使用分类间隔渲染器创建要素图层" class="headerlink" title="使用分类间隔渲染器创建要素图层"></a>使用分类间隔渲染器创建要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ColorBrewer Schemes (RGB)&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Greens (Continuous)&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  GraduatedColorsRendererDefinition gcDef = <span class="keyword">new</span> GraduatedColorsRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    ClassificationField = <span class="string">&quot;CROP_ACR07&quot;</span>,</span><br><span class="line">    ClassificationMethod = ArcGIS.Core.CIM.ClassificationMethod.NaturalBreaks,</span><br><span class="line">    BreakCount = <span class="number">6</span>,</span><br><span class="line">    ColorRamp = colorRamp.ColorRamp,</span><br><span class="line">    SymbolTemplate = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                            ColorFactory.Instance.GreenRGB, SimpleFillStyle.Solid, <span class="literal">null</span>).MakeSymbolReference(),</span><br><span class="line">    ExclusionClause = <span class="string">&quot;CROP_ACR07 = -99&quot;</span>,</span><br><span class="line">    ExclusionSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">                            ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, <span class="literal">null</span>).MakeSymbolReference(),</span><br><span class="line">    ExclusionLabel = <span class="string">&quot;No yield&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> featureLayerCreationParams = <span class="keyword">new</span> FeatureLayerCreationParams((<span class="keyword">new</span> Uri(<span class="string">@&quot;c:\Data\CountyData.gdb\Counties&quot;</span>)))</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Crop&quot;</span>,</span><br><span class="line">    RendererDefinition = gcDef</span><br><span class="line">  &#125;;</span><br><span class="line">  LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(featureLayerCreationParams, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="底图图层"><a href="#底图图层" class="headerlink" title="底图图层"></a>底图图层</h2><h3 id="更新地图的底图图层"><a href="#更新地图的底图图层" class="headerlink" title="更新地图的底图图层"></a>更新地图的底图图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aMap.SetBasemapLayers(Basemap.Gray);</span><br></pre></td></tr></table></figure>

<h3 id="从地图中移除底图图层"><a href="#从地图中移除底图图层" class="headerlink" title="从地图中移除底图图层"></a>从地图中移除底图图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aMap.SetBasemapLayers(Basemap.None);</span><br></pre></td></tr></table></figure>

<h2 id="使用图层"><a href="#使用图层" class="headerlink" title="使用图层"></a>使用图层</h2><h3 id="从地图中获取按图层类型过滤的图层列表"><a href="#从地图中获取按图层类型过滤的图层列表" class="headerlink" title="从地图中获取按图层类型过滤的图层列表"></a>从地图中获取按图层类型过滤的图层列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeatureLayer&gt; featureLayerList = aMap.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().ToList();</span><br></pre></td></tr></table></figure>

<h3 id="获取特定几何类型的图层"><a href="#获取特定几何类型的图层" class="headerlink" title="获取特定几何类型的图层"></a>获取特定几何类型的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get an existing Layer. This layer has a symbol you want to use in a new layer.</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;()</span><br><span class="line">      .Where(l =&gt; l.ShapeType == esriGeometryType.esriGeometryPoint).FirstOrDefault();</span><br></pre></td></tr></table></figure>

<h3 id="查找图层"><a href="#查找图层" class="headerlink" title="查找图层"></a>查找图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Finds layers by name and returns a read only list of Layers</span></span><br><span class="line">IReadOnlyList&lt;Layer&gt; layers = aMap.FindLayers(<span class="string">&quot;cities&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Finds a layer using a URI.</span></span><br><span class="line"><span class="comment">//The Layer URI you pass in helps you search for a specific layer in a map</span></span><br><span class="line"><span class="keyword">var</span> lyrFindLayer = MapView.Active.Map.FindLayer(<span class="string">&quot;CIMPATH=map/u_s__states__generalized_.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//This returns a collection of layers of the &quot;name&quot; specified. You can use any Linq expression to query the collection.  </span></span><br><span class="line"><span class="keyword">var</span> lyrExists = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                   .OfType&lt;FeatureLayer&gt;().Any(f =&gt; f.Name == <span class="string">&quot;U.S. States (Generalized)&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查找独立表"><a href="#查找独立表" class="headerlink" title="查找独立表"></a>查找独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// these routines find a standalone table whether it is a child of the Map or a GroupLayer</span></span><br><span class="line"><span class="keyword">var</span> tblFind = aMap.FindStandaloneTable(<span class="string">&quot;CIMPATH=map/address_audit.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">IReadOnlyList&lt;StandaloneTable&gt; tables = aMap.FindStandaloneTables(<span class="string">&quot;addresses&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// this method finds a standalone table as a child of the map only</span></span><br><span class="line"><span class="keyword">var</span> table = aMap.StandaloneTables.FirstOrDefault(t =&gt; t.Name == <span class="string">&quot;Addresses&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用部分名称搜索查找图层"><a href="#使用部分名称搜索查找图层" class="headerlink" title="使用部分名称搜索查找图层"></a>使用部分名称搜索查找图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map map = MapView.Active.Map;</span><br><span class="line">IEnumerable&lt;Layer&gt; matches = map.GetLayersAsFlattenedList().Where(l =&gt; l.Name.IndexOf(partialName, StringComparison.CurrentCultureIgnoreCase) &gt;= <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="更改图层可见性、可编辑性、捕捉性"><a href="#更改图层可见性、可编辑性、捕捉性" class="headerlink" title="更改图层可见性、可编辑性、捕捉性"></a>更改图层可见性、可编辑性、捕捉性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!layer.IsVisible)</span><br><span class="line">  layer.SetVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (layer <span class="keyword">is</span> FeatureLayer featureLayer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsEditable)</span><br><span class="line">    featureLayer.SetEditable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsSnappable)</span><br><span class="line">    featureLayer.SetSnappable(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-Lyrx-文件"><a href="#创建-Lyrx-文件" class="headerlink" title="创建 Lyrx 文件"></a>创建 Lyrx 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LayerDocument layerDocument = <span class="keyword">new</span> LayerDocument(layer);</span><br><span class="line">layerDocument.Save(<span class="string">@&quot;c:\Data\MyLayerDocument.lyrx&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="计算图层上所选要素的数量"><a href="#计算图层上所选要素的数量" class="headerlink" title="计算图层上所选要素的数量"></a>计算图层上所选要素的数量</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> noFeaturesSelected = lyr.SelectionCount;</span><br></pre></td></tr></table></figure>

<h3 id="访问图层的显示字段"><a href="#访问图层的显示字段" class="headerlink" title="访问图层的显示字段"></a>访问图层的显示字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM definition from the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimFeatureDefinition = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">// get the view of the source table underlying the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimDisplayTable = cimFeatureDefinition.FeatureTable;</span><br><span class="line">  <span class="comment">// this field is used as the &#x27;label&#x27; to represent the row</span></span><br><span class="line">  <span class="keyword">var</span> displayField = cimDisplayTable.DisplayField;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在图层上启用标注"><a href="#在图层上启用标注" class="headerlink" title="在图层上启用标注"></a>在图层上启用标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// toggle the label visibility</span></span><br><span class="line">  featureLayer.SetLabelVisibility(!featureLayer.IsLabelVisible);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将-2D-组中的图层移动到局部场景中的-3D-组"><a href="#将-2D-组中的图层移动到局部场景中的-3D-组" class="headerlink" title="将 2D 组中的图层移动到局部场景中的 3D 组"></a>将 2D 组中的图层移动到局部场景中的 3D 组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer in the 2D group to move to the 3D Group in a Local Scene</span></span><br><span class="line"><span class="keyword">var</span> layer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">  <span class="keyword">var</span> lyrDefn = layer.GetDefinition() <span class="keyword">as</span> CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">//setting this property moves the layer to 3D group in a scene</span></span><br><span class="line">  lyrDefn.IsFlattened = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">//Set the definition back to the layer</span></span><br><span class="line">  layer.SetDefinition(lyrDefn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="重置要素服务图层的-URL"><a href="#重置要素服务图层的-URL" class="headerlink" title="重置要素服务图层的 URL"></a>重置要素服务图层的 URL</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CIMStandardDataConnection dataConnection = dataConnectionLayer.GetDataConnection() <span class="keyword">as</span> CIMStandardDataConnection;</span><br><span class="line">dataConnection.WorkspaceConnectionString = newConnectionString;</span><br><span class="line">dataConnectionLayer.SetDataConnection(dataConnection);</span><br></pre></td></tr></table></figure>

<h3 id="更改要素图层的基础数据源-相同的工作空间类型"><a href="#更改要素图层的基础数据源-相同的工作空间类型" class="headerlink" title="更改要素图层的基础数据源 - 相同的工作空间类型"></a>更改要素图层的基础数据源 - 相同的工作空间类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//This is the existing layer for which we want to switch the underlying datasource</span></span><br><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> connectionStringToReplace = lyr.GetFeatureClass().GetDatastore().GetConnectionString();</span><br><span class="line">  <span class="built_in">string</span> databaseConnectionPath = <span class="string">@&quot;Path to the .sde connection file to replace with&quot;</span>;</span><br><span class="line">  <span class="comment">//If the new SDE connection did not have a dataset with the same name as in the feature layer,</span></span><br><span class="line">  <span class="comment">//pass false for the validate parameter of the FindAndReplaceWorkspacePath method to achieve this. </span></span><br><span class="line">  <span class="comment">//If validate is true and the SDE did not have a dataset with the same name, </span></span><br><span class="line">  <span class="comment">//FindAndReplaceWorkspacePath will return failure</span></span><br><span class="line">  lyr.FindAndReplaceWorkspacePath(connectionStringToReplace, databaseConnectionPath, <span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="将图层的地理数据库版本更改为地图中的指定版本"><a href="#将图层的地理数据库版本更改为地图中的指定版本" class="headerlink" title="将图层的地理数据库版本更改为地图中的指定版本"></a>将图层的地理数据库版本更改为地图中的指定版本</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Getting the current version name from the first feature layer of the map</span></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">          .OfType&lt;FeatureLayer&gt;().FirstOrDefault();  <span class="comment">//first feature layer</span></span><br><span class="line">  Datastore dataStore = flyr.GetFeatureClass().GetDatastore();  <span class="comment">//getting datasource</span></span><br><span class="line">  Geodatabase geodatabase = dataStore <span class="keyword">as</span> Geodatabase; <span class="comment">//casting to Geodatabase</span></span><br><span class="line">  <span class="keyword">if</span> (geodatabase == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  VersionManager versionManager = geodatabase.GetVersionManager();</span><br><span class="line">  ArcGIS.Core.Data.Version currentVersion = versionManager.GetCurrentVersion();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Getting all available versions except the current one</span></span><br><span class="line">  IEnumerable&lt;ArcGIS.Core.Data.Version&gt; versions = versionManager.GetVersions()</span><br><span class="line">          .Where(v =&gt; !v.GetName().Equals(currentVersion.GetName(), StringComparison.CurrentCultureIgnoreCase));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Assuming there is at least one other version we pick the first one from the list</span></span><br><span class="line">  ArcGIS.Core.Data.Version toVersion = versions.FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (toVersion != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Changing version</span></span><br><span class="line">    MapView.Active.Map.ChangeVersion(currentVersion, toVersion);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查询要素图层"><a href="#查询要素图层" class="headerlink" title="查询要素图层"></a>查询要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  QueryFilter qf = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    WhereClause = <span class="string">&quot;Class = &#x27;city&#x27;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Getting the first selected feature layer of the map view</span></span><br><span class="line">  <span class="keyword">var</span> flyr = (FeatureLayer)MapView.Active.GetSelectedLayers()</span><br><span class="line">                    .OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">using</span> (RowCursor rows = flyr.Search(qf)) <span class="comment">//execute</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Looping through to count</span></span><br><span class="line">    <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (rows.MoveNext()) i++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">MessageBox.Show(String.Format(</span><br><span class="line">   <span class="string">&quot;Total features that matched the search criteria: &#123;0&#125;&quot;</span>, count));</span><br></pre></td></tr></table></figure>

<h3 id="获取图层的属性旋转字段"><a href="#获取图层的属性旋转字段" class="headerlink" title="获取图层的属性旋转字段"></a>获取图层的属性旋转字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> cimRenderer = featureLayer.GetRenderer() <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line">  <span class="keyword">var</span> cimRotationVariable = cimRenderer.VisualVariables.OfType&lt;CIMRotationVisualVariable&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">var</span> rotationInfoZ = cimRotationVariable.VisualVariableInfoZ;</span><br><span class="line">  <span class="keyword">var</span> rotationExpression = rotationInfoZ.ValueExpressionInfo.Expression; <span class="comment">// this expression stores the field name  </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="查找要旋转的连接属性字段"><a href="#查找要旋转的连接属性字段" class="headerlink" title="查找要旋转的连接属性字段"></a>查找要旋转的连接属性字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM renderer from the layer</span></span><br><span class="line">  <span class="keyword">var</span> cimRenderer = featureLayer.GetRenderer() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMSimpleRenderer;</span><br><span class="line">  <span class="comment">// get the collection of connected attributes for rotation</span></span><br><span class="line">  <span class="keyword">var</span> cimRotationVariable = cimRenderer.VisualVariables.OfType&lt;ArcGIS.Core.CIM.CIMRotationVisualVariable&gt;().FirstOrDefault();</span><br><span class="line">  <span class="comment">// the z direction is describing the heading rotation</span></span><br><span class="line">  <span class="keyword">var</span> rotationInfoZ = cimRotationVariable.VisualVariableInfoZ;</span><br><span class="line">  <span class="keyword">var</span> rotationExpression = rotationInfoZ.Expression; <span class="comment">// this expression stores the field name  </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="切换“设置参考比例时缩放图层符号”"><a href="#切换“设置参考比例时缩放图层符号”" class="headerlink" title="切换“设置参考比例时缩放图层符号”"></a>切换“设置参考比例时缩放图层符号”</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM layer definition</span></span><br><span class="line">  <span class="keyword">var</span> cimFeatureLayer = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMFeatureLayer;</span><br><span class="line">  <span class="comment">// turn on the option to scale the symbols in this layer based in the map&#x27;s reference scale</span></span><br><span class="line">  cimFeatureLayer.ScaleSymbols = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置图层缓存"><a href="#设置图层缓存" class="headerlink" title="设置图层缓存"></a>设置图层缓存</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// change the layer cache type to maximum age</span></span><br><span class="line">  <span class="comment">//At 2.x - featureLayer.SetDisplayCacheType(ArcGIS.Core.CIM.DisplayCacheType.MaxAge);</span></span><br><span class="line">  featureLayer.SetCacheOptions(LayerCacheType.MaxAge);</span><br><span class="line">  <span class="comment">// change from the default 5 min to 2 min</span></span><br><span class="line">  featureLayer.SetDisplayCacheMaxAge(TimeSpan.FromMinutes(<span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更改图层选择颜色"><a href="#更改图层选择颜色" class="headerlink" title="更改图层选择颜色"></a>更改图层选择颜色</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">ArcGIS.Desktop.Framework.Threading.Tasks.QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the CIM definition of the layer</span></span><br><span class="line">  <span class="keyword">var</span> layerDef = featureLayer.GetDefinition() <span class="keyword">as</span> ArcGIS.Core.CIM.CIMBasicFeatureLayer;</span><br><span class="line">  <span class="comment">// disable the default symbol</span></span><br><span class="line">  layerDef.UseSelectionSymbol = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// assign a new color</span></span><br><span class="line">  layerDef.SelectionColor = ColorFactory.Instance.RedRGB;</span><br><span class="line">  <span class="comment">// apply the definition to the layer</span></span><br><span class="line">  featureLayer.SetDefinition(layerDef);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!featureLayer.IsVisible) </span><br><span class="line">    featureLayer.SetVisibility(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">//Do a selection</span></span><br><span class="line"></span><br><span class="line">  MapView.Active.SelectFeatures(MapView.Active.Extent);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除所有未选中的图层"><a href="#删除所有未选中的图层" class="headerlink" title="删除所有未选中的图层"></a>删除所有未选中的图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get the group layers first</span></span><br><span class="line">IReadOnlyList&lt;GroupLayer&gt; groupLayers = map.Layers.OfType&lt;GroupLayer&gt;().ToList();</span><br><span class="line"><span class="comment">//Iterate and remove the layers within the group layers that are unchecked.</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> groupLayer <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get layers that not visible within the group</span></span><br><span class="line">  <span class="keyword">var</span> layers = groupLayer.Layers.Where(l =&gt; l.IsVisible == <span class="literal">false</span>).ToList();</span><br><span class="line">  <span class="comment">//Remove all the layers that are not visible within the group</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayers(layers));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Group Layers that are empty and are unchecked</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">group</span>.Layers.Count == <span class="number">0</span> &amp;&amp; <span class="keyword">group</span>.IsVisible == <span class="literal">false</span>) <span class="comment">//No layers in the group</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//remove the group</span></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayer(<span class="keyword">group</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get Layers that are NOT Group layers and are unchecked</span></span><br><span class="line"><span class="keyword">var</span> notAGroupAndUnCheckedLayers = map.Layers.Where(l =&gt; !(l <span class="keyword">is</span> GroupLayer) &amp;&amp; l.IsVisible == <span class="literal">false</span>).ToList();</span><br><span class="line"><span class="comment">//Remove all the non group layers that are not visible</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayers(notAGroupAndUnCheckedLayers));</span><br></pre></td></tr></table></figure>

<h3 id="删除空组"><a href="#删除空组" class="headerlink" title="删除空组"></a>删除空组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get the group layers</span></span><br><span class="line">IReadOnlyList&lt;GroupLayer&gt; groupLayers = map.Layers.OfType&lt;GroupLayer&gt;().ToList();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> groupLayers)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">group</span>.Layers.Count == <span class="number">0</span>) <span class="comment">//No layers in the group</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//remove the group</span></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt; map.RemoveLayer(<span class="keyword">group</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在地图定义中创建缩写字典并将其应用于图层"><a href="#在地图定义中创建缩写字典并将其应用于图层" class="headerlink" title="在地图定义中创建缩写字典并将其应用于图层"></a>在地图定义中创建缩写字典并将其应用于图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateDictionary</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the map&#x27;s defintion</span></span><br><span class="line">  <span class="keyword">var</span> mapDefn = MapView.Active.Map.GetDefinition();</span><br><span class="line">  <span class="comment">//Get the Map&#x27;s Maplex labelling engine properties</span></span><br><span class="line">  <span class="keyword">var</span> mapDefnPlacementProps = mapDefn.GeneralPlacementProperties <span class="keyword">as</span> CIMMaplexGeneralPlacementProperties;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Define the abbreaviations we need in an array            </span></span><br><span class="line">  List&lt;CIMMaplexDictionaryEntry&gt; abbreviationDictionary = <span class="keyword">new</span> List&lt;CIMMaplexDictionaryEntry&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionaryEntry &#123;</span><br><span class="line">            Abbreviation = <span class="string">&quot;Hts&quot;</span>,</span><br><span class="line">            Text = <span class="string">&quot;Heights&quot;</span>,</span><br><span class="line">            MaplexAbbreviationType = MaplexAbbreviationType.Ending</span><br><span class="line"></span><br><span class="line">         &#125;,</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionaryEntry</span><br><span class="line">            &#123;</span><br><span class="line">                Abbreviation = <span class="string">&quot;Ct&quot;</span>,</span><br><span class="line">                Text = <span class="string">&quot;Text&quot;</span>,</span><br><span class="line">                MaplexAbbreviationType = MaplexAbbreviationType.Ending</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//etc</span></span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="comment">//The Maplex Dictionary - can hold multiple Abbreviation collections</span></span><br><span class="line">  <span class="keyword">var</span> maplexDictionary = <span class="keyword">new</span> List&lt;CIMMaplexDictionary&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> CIMMaplexDictionary &#123;</span><br><span class="line">                Name = <span class="string">&quot;NameEndingsAbbreviations&quot;</span>,</span><br><span class="line">                MaplexDictionary = abbreviationDictionary.ToArray()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="comment">//Set the Maplex Label Engine Dictionary property to the Maplex Dictionary collection created above.</span></span><br><span class="line">  mapDefnPlacementProps.Dictionaries = maplexDictionary.ToArray();</span><br><span class="line">  <span class="comment">//Set the Map defintion </span></span><br><span class="line">  MapView.Active.Map.SetDefinition(mapDefn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ApplyDictionary</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().First();</span><br><span class="line"></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Creates Abbreviation dictionary and adds to Map Defintion                                </span></span><br><span class="line">    CreateDictionary();</span><br><span class="line">    <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">    <span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line">    <span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line">    <span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line">    <span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line">    <span class="comment">//Modify label Placement props to use abbreviation dictionary </span></span><br><span class="line">    CIMGeneralPlacementProperties labelEngine = MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.DictionaryName = <span class="string">&quot;NameEndingsAbbreviations&quot;</span>;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.CanAbbreviateLabel = <span class="literal">true</span>;</span><br><span class="line">    theLabelClass.MaplexLabelPlacementProperties.CanStackLabel = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//Set the labelClasses back</span></span><br><span class="line">    lyrDefn.LabelClasses = listLabelClasses.ToArray();</span><br><span class="line">    <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">    featureLayer.SetDefinition(lyrDefn);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性表-ITablePane"><a href="#属性表-ITablePane" class="headerlink" title="属性表 - ITablePane"></a>属性表 - ITablePane</h2><h3 id="设置属性表的缩放级别"><a href="#设置属性表的缩放级别" class="headerlink" title="设置属性表的缩放级别"></a>设置属性表的缩放级别</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> currentZoomLevel = tablePane.ZoomLevel;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newZoomLevel = currentZoomLevel + <span class="number">50</span>;</span><br><span class="line">  tablePane.SetZoomLevel(newZoomLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检索属性表中所选像元的值"><a href="#检索属性表中所选像元的值" class="headerlink" title="检索属性表中所选像元的值"></a>检索属性表中所选像元的值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapMember = tablePane.MapMember;</span><br><span class="line">  <span class="keyword">var</span> oid = tablePane.ActiveObjectID;</span><br><span class="line">  <span class="keyword">if</span> (oid.HasValue &amp;&amp; oid.Value != <span class="number">-1</span> &amp;&amp; mapMember != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> activeField = tablePane.ActiveColumn;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run&lt;<span class="built_in">object</span>&gt;(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> Use core objects to retrieve record and get value</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="移动到特定行"><a href="#移动到特定行" class="headerlink" title="移动到特定行"></a>移动到特定行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FrameworkApplication.Panes.ActivePane <span class="keyword">is</span> ITablePane tablePane)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// move to first row</span></span><br><span class="line">  tablePane.BringIntoView(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// move to sixth row</span></span><br><span class="line">  tablePane.BringIntoView(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h2 id="元数据-1"><a href="#元数据-1" class="headerlink" title="元数据"></a>元数据</h2><h3 id="获取和设置地图元数据"><a href="#获取和设置地图元数据" class="headerlink" title="获取和设置地图元数据"></a>获取和设置地图元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Get map&#x27;s metadata</span></span><br><span class="line"><span class="keyword">var</span> mapMetadata = map.GetMetadata();</span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>Make edits to metadata using the retrieved mapMetadata string.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the modified metadata back to the map.</span></span><br><span class="line"><span class="keyword">if</span> (map.GetCanEditMetadata())</span><br><span class="line">  map.SetMetadata(mapMetadata);</span><br></pre></td></tr></table></figure>

<h3 id="图层元数据"><a href="#图层元数据" class="headerlink" title="图层元数据"></a>图层元数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MapMember mapMember = map.GetLayersAsFlattenedList().FirstOrDefault(); <span class="comment">//Search for only layers/tables here if needed.</span></span><br><span class="line"><span class="keyword">if</span> (mapMember == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Gets whether or not the MapMember stores its own metadata or uses metadata retrieved</span></span><br><span class="line"><span class="comment">//from its source. This method must be called on the MCT. Use QueuedTask.Run</span></span><br><span class="line"><span class="built_in">bool</span> doesUseSourceMetadata = mapMember.GetUseSourceMetadata();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sets whether or not the MapMember will use its own metadata or the metadata from</span></span><br><span class="line"><span class="comment">//its underyling source (if it has one). This method must be called on the MCT.</span></span><br><span class="line"><span class="comment">//Use QueuedTask.Run</span></span><br><span class="line">mapMember.SetUseSourceMetadata(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Does the MapMember supports metadata</span></span><br><span class="line"><span class="keyword">var</span> supportsMetadata = mapMember.SupportsMetadata;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get MapMember metadata</span></span><br><span class="line"><span class="keyword">var</span> metadatstring = mapMember.GetMetadata();</span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>Make edits to metadata using the retrieved mapMetadata string.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the modified metadata back to the mapmember (layer, table..)</span></span><br><span class="line"><span class="keyword">if</span> (mapMember.GetCanEditMetadata())</span><br><span class="line">  mapMember.SetMetadata(metadatstring);</span><br></pre></td></tr></table></figure>

<h2 id="渲染器"><a href="#渲染器" class="headerlink" title="渲染器"></a>渲染器</h2><h3 id="将唯一值渲染器设置为活动地图的所选要素图层"><a href="#将唯一值渲染器设置为活动地图的所选要素图层" class="headerlink" title="将唯一值渲染器设置为活动地图的所选要素图层"></a>将唯一值渲染器设置为活动地图的所选要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> fields = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Type&quot;</span> &#125;; <span class="comment">//field to be used to retrieve unique values</span></span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">            ColorFactory.Instance.GreenRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Pushpin);  <span class="comment">//constructing a point symbol as a template symbol</span></span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//constructing renderer definition for unique value renderer</span></span><br><span class="line">  UniqueValueRendererDefinition uniqueValueRendererDef =</span><br><span class="line">      <span class="keyword">new</span> UniqueValueRendererDefinition(fields, symbolPointTemplate);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//creating a unique value renderer</span></span><br><span class="line">  <span class="keyword">var</span> flyr = MapView.Active.GetSelectedLayers()[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMUniqueValueRenderer uniqueValueRenderer = flyr.CreateRenderer(uniqueValueRendererDef) <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setting the renderer to the feature layer</span></span><br><span class="line">  flyr.SetRenderer(uniqueValueRenderer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建一个唯一值呈现器以指定值的符号"><a href="#创建一个唯一值呈现器以指定值的符号" class="headerlink" title="创建一个唯一值呈现器以指定值的符号"></a>创建一个唯一值呈现器以指定值的符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//The goal is to construct the CIMUniqueValueRenderer which will be applied to the feature layer.</span></span><br><span class="line">  <span class="comment">// To do this, the following are the objects we need to set the renderer up with the fields and symbols.</span></span><br><span class="line">  <span class="comment">// As a reference, this is the USCities dataset. Snippet will create a unique value renderer that applies </span></span><br><span class="line">  <span class="comment">// specific symbols to all the cities in California and Alabama.  The rest of the cities will use a default symbol.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// First create a &quot;CIMUniqueValueClass&quot; for the cities in Alabama.</span></span><br><span class="line">  List&lt;CIMUniqueValue&gt; listUniqueValuesAlabama = <span class="keyword">new</span> List&lt;CIMUniqueValue&gt; &#123; <span class="keyword">new</span> CIMUniqueValue &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;Alabama&quot;</span> &#125; &#125; &#125;;</span><br><span class="line">  CIMUniqueValueClass alabamaUniqueValueClass = <span class="keyword">new</span> CIMUniqueValueClass</span><br><span class="line">  &#123;</span><br><span class="line">    Editable = <span class="literal">true</span>,</span><br><span class="line">    Label = <span class="string">&quot;Alabama&quot;</span>,</span><br><span class="line">    Patch = PatchShape.Default,</span><br><span class="line">    Symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB).MakeSymbolReference(),</span><br><span class="line">    Visible = <span class="literal">true</span>,</span><br><span class="line">    Values = listUniqueValuesAlabama.ToArray()</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Create a &quot;CIMUniqueValueClass&quot; for the cities in California.</span></span><br><span class="line">  List&lt;CIMUniqueValue&gt; listUniqueValuescalifornia = <span class="keyword">new</span> List&lt;CIMUniqueValue&gt; &#123; <span class="keyword">new</span> CIMUniqueValue &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;California&quot;</span> &#125; &#125; &#125;;</span><br><span class="line">  CIMUniqueValueClass californiaUniqueValueClass = <span class="keyword">new</span> CIMUniqueValueClass</span><br><span class="line">  &#123;</span><br><span class="line">    Editable = <span class="literal">true</span>,</span><br><span class="line">    Label = <span class="string">&quot;California&quot;</span>,</span><br><span class="line">    Patch = PatchShape.Default,</span><br><span class="line">    Symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.BlueRGB).MakeSymbolReference(),</span><br><span class="line">    Visible = <span class="literal">true</span>,</span><br><span class="line">    Values = listUniqueValuescalifornia.ToArray()</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//Create a list of the above two CIMUniqueValueClasses</span></span><br><span class="line">  List&lt;CIMUniqueValueClass&gt; listUniqueValueClasses = <span class="keyword">new</span> List&lt;CIMUniqueValueClass&gt;</span><br><span class="line">    &#123;</span><br><span class="line">                  alabamaUniqueValueClass, californiaUniqueValueClass</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="comment">//Create a list of CIMUniqueValueGroup</span></span><br><span class="line">  CIMUniqueValueGroup uvg = <span class="keyword">new</span> CIMUniqueValueGroup</span><br><span class="line">  &#123;</span><br><span class="line">    Classes = listUniqueValueClasses.ToArray(),</span><br><span class="line">  &#125;;</span><br><span class="line">  List&lt;CIMUniqueValueGroup&gt; listUniqueValueGroups = <span class="keyword">new</span> List&lt;CIMUniqueValueGroup&gt; &#123; uvg &#125;;</span><br><span class="line">  <span class="comment">//Create the CIMUniqueValueRenderer</span></span><br><span class="line">  CIMUniqueValueRenderer uvr = <span class="keyword">new</span> CIMUniqueValueRenderer</span><br><span class="line">  &#123;</span><br><span class="line">    UseDefaultSymbol = <span class="literal">true</span>,</span><br><span class="line">    DefaultLabel = <span class="string">&quot;all other values&quot;</span>,</span><br><span class="line">    DefaultSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreyRGB).MakeSymbolReference(),</span><br><span class="line">    Groups = listUniqueValueGroups.ToArray(),</span><br><span class="line">    Fields = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;STATE_NAME&quot;</span> &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//Set the feature layer&#x27;s renderer.</span></span><br><span class="line">  featureLayer.SetRenderer(uvr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建热图渲染器"><a href="#创建热图渲染器" class="headerlink" title="创建热图渲染器"></a>创建热图渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//defining a heatmap renderer that uses values from Population field as the weights</span></span><br><span class="line">  HeatMapRendererDefinition heatMapDef = <span class="keyword">new</span> HeatMapRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    Radius = <span class="number">20</span>,</span><br><span class="line">    WeightField = <span class="string">&quot;Population&quot;</span>,</span><br><span class="line">    ColorRamp = colorRamp.ColorRamp,</span><br><span class="line">    RendereringQuality = <span class="number">8</span>,</span><br><span class="line">    UpperLabel = <span class="string">&quot;High Density&quot;</span>,</span><br><span class="line">    LowerLabel = <span class="string">&quot;Low Density&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMHeatMapRenderer heatMapRndr = flyr.CreateRenderer(heatMapDef) <span class="keyword">as</span> CIMHeatMapRenderer;</span><br><span class="line">  flyr.SetRenderer(heatMapRndr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建未分类渲染器"><a href="#创建未分类渲染器" class="headerlink" title="创建未分类渲染器"></a>创建未分类渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Diamond);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//defining an unclassed renderer with custom upper and lower stops</span></span><br><span class="line">  <span class="comment">//all features with value &gt;= 5,000,000 will be drawn with the upper color from the color ramp</span></span><br><span class="line">  <span class="comment">//all features with value &lt;= 50,000 will be drawn with the lower color from the color ramp</span></span><br><span class="line">  UnclassedColorsRendererDefinition unclassRndrDef = <span class="keyword">new</span> UnclassedColorsRendererDefinition</span><br><span class="line">                              (<span class="string">&quot;Population&quot;</span>, symbolPointTemplate, colorRamp.ColorRamp, <span class="string">&quot;Highest&quot;</span>, <span class="string">&quot;Lowest&quot;</span>, <span class="number">5000000</span>, <span class="number">50000</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//drawing features with null values with a different symbol</span></span><br><span class="line">    ShowNullValues = <span class="literal">true</span>,</span><br><span class="line">    NullValueLabel = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  CIMPointSymbol nullSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">16.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  unclassRndrDef.NullValueSymbol = nullSym.MakeSymbolReference();</span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMClassBreaksRenderer cbRndr = flyr.CreateRenderer(unclassRndrDef) <span class="keyword">as</span> CIMClassBreaksRenderer;</span><br><span class="line">  flyr.SetRenderer(cbRndr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建最大和最小符号大小上限的比例渲染器"><a href="#创建最大和最小符号大小上限的比例渲染器" class="headerlink" title="创建最大和最小符号大小上限的比例渲染器"></a>创建最大和最小符号大小上限的比例渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//minimum symbol size is capped to 4 point while the maximum symbol size is set to 50 point</span></span><br><span class="line">  ProportionalRendererDefinition prDef = <span class="keyword">new</span> ProportionalRendererDefinition(<span class="string">&quot;POPULATION&quot;</span>, symbolPointTemplate, <span class="number">4</span>, <span class="number">50</span>, <span class="literal">true</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setting upper and lower size stops to stop symbols growing or shrinking beyond those thresholds</span></span><br><span class="line">    UpperSizeStop = <span class="number">5000000</span>,  <span class="comment">//features with values &gt;= 5,000,000 will be drawn with maximum symbol size</span></span><br><span class="line">    LowerSizeStop = <span class="number">50000</span>    <span class="comment">//features with values &lt;= 50,000 will be drawn with minimum symbol size</span></span><br><span class="line">  &#125;;</span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMProportionalRenderer propRndr = flyr.CreateRenderer(prDef) <span class="keyword">as</span> CIMProportionalRenderer;</span><br><span class="line">  flyr.SetRenderer(propRndr);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="创建真实比例渲染器"><a href="#创建真实比例渲染器" class="headerlink" title="创建真实比例渲染器"></a>创建真实比例渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> colorBrewerSchemesName = <span class="string">&quot;ArcGIS Colors&quot;</span>;</span><br><span class="line">StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(s =&gt; s.Name == colorBrewerSchemesName);</span><br><span class="line"><span class="built_in">string</span> colorRampName = <span class="string">&quot;Heat Map 4 - Semitransparent&quot;</span>;</span><br><span class="line">IList&lt;ColorRampStyleItem&gt; colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> style.SearchColorRamps(colorRampName);</span><br><span class="line">&#125;);</span><br><span class="line">ColorRampStyleItem colorRamp = colorRampList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSym = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  CIMSymbolReference symbolPointTemplate = pointSym.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Defining proportional renderer where size of symbol will be same as its value in field used in the renderer.</span></span><br><span class="line">  ProportionalRendererDefinition prDef = <span class="keyword">new</span> ProportionalRendererDefinition(<span class="string">&quot;POPULATION&quot;</span>, esriUnits.esriMeters, symbolPointTemplate, SymbolShapes.Square, ValueRepresentations.Radius);</span><br><span class="line"></span><br><span class="line">  FeatureLayer flyr = MapView.Active.Map.Layers[<span class="number">0</span>] <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">  CIMProportionalRenderer propRndr = flyr.CreateRenderer(prDef) <span class="keyword">as</span> CIMProportionalRenderer;</span><br><span class="line">  flyr.SetRenderer(propRndr);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="拱廊"><a href="#拱廊" class="headerlink" title="拱廊"></a>拱廊</h2><h3 id="使用-Arcade-修改渲染器"><a href="#使用-Arcade-修改渲染器" class="headerlink" title="使用 Arcade 修改渲染器"></a>使用 Arcade 修改渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault(f =&gt; f.ShapeType == esriGeometryType.esriGeometryPolygon);</span><br><span class="line"><span class="keyword">if</span> (lyr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// GetRenderer from Layer (assumes it is a unique value renderer)</span></span><br><span class="line">  <span class="keyword">var</span> uvRenderer = lyr.GetRenderer() <span class="keyword">as</span> CIMUniqueValueRenderer;</span><br><span class="line">  <span class="keyword">if</span> (uvRenderer == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//layer has STATE_NAME field</span></span><br><span class="line">  <span class="comment">//community sample Data\Admin\AdminSample.aprx</span></span><br><span class="line">  <span class="built_in">string</span> expression = <span class="string">&quot;if ($view.scale &gt; 21000000) &#123; return $feature.STATE_NAME &#125; else &#123; return &#x27;All&#x27; &#125;&quot;</span>;</span><br><span class="line">  CIMExpressionInfo updatedExpressionInfo = <span class="keyword">new</span> CIMExpressionInfo</span><br><span class="line">  &#123;</span><br><span class="line">    Expression = expression,</span><br><span class="line">    Title = <span class="string">&quot;Custom&quot;</span> <span class="comment">// can be any string used for UI purpose.</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//set the renderer&#x27;s expression</span></span><br><span class="line">  uvRenderer.ValueExpressionInfo = updatedExpressionInfo;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//SetRenderer on Layer</span></span><br><span class="line">  lyr.SetRenderer(uvRenderer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用-Arcade-修改标注表达式"><a href="#使用-Arcade-修改标注表达式" class="headerlink" title="使用 Arcade 修改标注表达式"></a>使用 Arcade 修改标注表达式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault(f =&gt; f.ShapeType == esriGeometryType.esriGeometryPolygon);</span><br><span class="line"><span class="keyword">if</span> (lyr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line">  <span class="comment">//community sample Data\Admin\AdminSample.aprx</span></span><br><span class="line">  <span class="keyword">var</span> lyrDefn = lyr.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line">  <span class="keyword">if</span> (lyrDefn == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line">  <span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line">  <span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line">  <span class="comment">//set the label class Expression to use the Arcade expression</span></span><br><span class="line">  theLabelClass.Expression = <span class="string">&quot;return $feature.STATE_NAME + TextFormatting.NewLine + $feature.POP2000;&quot;</span>;</span><br><span class="line">  <span class="comment">//Set the label definition back to the layer.</span></span><br><span class="line">  lyr.SetDefinition(lyrDefn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="高程表面图层"><a href="#高程表面图层" class="headerlink" title="高程表面图层"></a>高程表面图层</h2><h3 id="创建具有地表图层的场景"><a href="#创建具有地表图层的场景" class="headerlink" title="创建具有地表图层的场景"></a>创建具有地表图层的场景</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> scene = MapFactory.Instance.CreateScene(<span class="string">&quot;My scene&quot;</span>, groundSourceUri, MapViewingMode.SceneGlobal);</span><br></pre></td></tr></table></figure>

<h3 id="创建新的高程表面"><a href="#创建新的高程表面" class="headerlink" title="创建新的高程表面"></a>创建新的高程表面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//Define a ServiceConnection to use for the new Elevation surface</span></span><br><span class="line"><span class="keyword">var</span> serverConnection = <span class="keyword">new</span> CIMInternetServerConnection</span><br><span class="line">&#123;</span><br><span class="line">  Anonymous = <span class="literal">true</span>,</span><br><span class="line">  HideUserProperty = <span class="literal">true</span>,</span><br><span class="line">  URL = <span class="string">&quot;https://elevation.arcgis.com/arcgis/services&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">CIMAGSServiceConnection serviceConnection = <span class="keyword">new</span> CIMAGSServiceConnection</span><br><span class="line">&#123;</span><br><span class="line">  ObjectName = <span class="string">&quot;WorldElevation/Terrain&quot;</span>,</span><br><span class="line">  ObjectType = <span class="string">&quot;ImageServer&quot;</span>,</span><br><span class="line">  URL = <span class="string">&quot;https://elevation.arcgis.com/arcgis/services/WorldElevation/Terrain/ImageServer&quot;</span>,</span><br><span class="line">  ServerConnection = serverConnection</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Defines a new elevation source set to the CIMAGSServiceConnection defined above</span></span><br><span class="line"><span class="comment">//At 2.x - var newElevationSource = new ArcGIS.Core.CIM.CIMElevationSource</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  VerticalUnit = ArcGIS.Core.Geometry.LinearUnit.Meters,</span></span><br><span class="line"><span class="comment">//  DataConnection = serviceConnection,</span></span><br><span class="line"><span class="comment">//  Name = &quot;WorldElevation/Terrain&quot;,</span></span><br><span class="line"><span class="comment">//  Visibility = true</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="comment">//The elevation surface</span></span><br><span class="line"><span class="comment">//At 2.x - var newElevationSurface = new ArcGIS.Core.CIM.CIMMapElevationSurface</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  Name = &quot;New Elevation Surface&quot;,</span></span><br><span class="line"><span class="comment">//  BaseSources = new ArcGIS.Core.CIM.CIMElevationSource[1] &#123; newElevationSource &#125;,</span></span><br><span class="line"><span class="comment">//  Visibility = true,</span></span><br><span class="line"><span class="comment">//  ElevationMode = ElevationMode.CustomSurface,</span></span><br><span class="line"><span class="comment">//  VerticalExaggeration = 1,</span></span><br><span class="line"><span class="comment">//  EnableSurfaceShading = false,</span></span><br><span class="line"><span class="comment">//  SurfaceTINShadingMode = SurfaceTINShadingMode.Smooth,</span></span><br><span class="line"><span class="comment">//  Expanded = false,</span></span><br><span class="line"><span class="comment">//  MapElevationID = &quot;&#123;3DEC3CC5-7C69-4132-A700-DCD5BDED14D6&#125;&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="comment">//Get the active map</span></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="comment">//Get the elevation surfaces defined in the map</span></span><br><span class="line"><span class="comment">//At 2.x - var listOfElevationSurfaces = definition.ElevationSurfaces.ToList();</span></span><br><span class="line"><span class="keyword">var</span> listOfElevationSurfaces = map.GetElevationSurfaceLayers();</span><br><span class="line"><span class="comment">//Add the new elevation surface </span></span><br><span class="line"><span class="comment">//At 2.x - listOfElevationSurfaces.Add(newElevationSurface);</span></span><br><span class="line"><span class="keyword">var</span> elevationLyrCreationParams = <span class="keyword">new</span> ElevationLayerCreationParams(serviceConnection);</span><br><span class="line"><span class="keyword">var</span> elevationSurface = LayerFactory.Instance.CreateLayer&lt;ElevationSurfaceLayer&gt;(</span><br><span class="line">       elevationLyrCreationParams, map);</span><br></pre></td></tr></table></figure>

<h3 id="将自定义高程表面设置为-Z-感知图层"><a href="#将自定义高程表面设置为-Z-感知图层" class="headerlink" title="将自定义高程表面设置为 Z 感知图层"></a>将自定义高程表面设置为 Z 感知图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Define the custom elevation surface to use</span></span><br><span class="line"><span class="comment">//At 2.x - var layerElevationSurface = new CIMLayerElevationSurface</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//  MapElevationID = &quot;&#123;3DEC3CC5-7C69-4132-A700-DCD5BDED14D6&#125;&quot;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br><span class="line"><span class="keyword">var</span> layerElevationSurface = <span class="keyword">new</span> CIMLayerElevationSurface</span><br><span class="line">&#123;</span><br><span class="line">  ElevationSurfaceLayerURI = <span class="string">&quot;https://elevation3d.arcgis.com/arcgis/services/WorldElevation3D/Terrain3D/ImageServer&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMBasicFeatureLayer;</span><br><span class="line"><span class="comment">//Set the layer&#x27;s elevation surface</span></span><br><span class="line">lyrDefn.LayerElevation = layerElevationSurface;</span><br><span class="line"><span class="comment">//Set the layer&#x27;s definition</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn);</span><br></pre></td></tr></table></figure>

<h3 id="将高程源添加到现有高程表面图层"><a href="#将高程源添加到现有高程表面图层" class="headerlink" title="将高程源添加到现有高程表面图层"></a>将高程源添加到现有高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in QueuendTask.Run</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// surfaceLayer could also be the ground layer</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> uri = <span class="string">&quot;https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> ElevationLayerCreationParams(<span class="keyword">new</span> Uri(uri));</span><br><span class="line">createParams.Name = <span class="string">&quot;Terrain 3D&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> eleSourceLayer = LayerFactory.Instance.CreateLayer&lt;Layer&gt;(createParams, surfaceLayer);</span><br></pre></td></tr></table></figure>

<h3 id="从地图中获取高程表面图层和高程源图层"><a href="#从地图中获取高程表面图层和高程源图层" class="headerlink" title="从地图中获取高程表面图层和高程源图层"></a>从地图中获取高程表面图层和高程源图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrieve the elevation surface layers in the map including the Ground</span></span><br><span class="line"><span class="keyword">var</span> surfaceLayers = map.GetElevationSurfaceLayers();</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve the single ground elevation surface layer in the map</span></span><br><span class="line"><span class="keyword">var</span> groundSurfaceLayer = map.GetGroundElevationSurfaceLayer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// determine the number of elevation sources in the ground elevation surface layer</span></span><br><span class="line"><span class="built_in">int</span> numberGroundSources = groundSurfaceLayer.Layers.Count;</span><br><span class="line"><span class="comment">// get the first elevation source layer from the ground elevation surface layer</span></span><br><span class="line"><span class="keyword">var</span> groundSourceLayer = groundSurfaceLayer.Layers.FirstOrDefault();</span><br></pre></td></tr></table></figure>

<h3 id="查找高程表面图层"><a href="#查找高程表面图层" class="headerlink" title="查找高程表面图层"></a>查找高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> surfaceLayers = map.GetElevationSurfaceLayers();</span><br><span class="line"><span class="keyword">var</span> surfaceLayer = surfaceLayers.FirstOrDefault(l =&gt; l.Name == <span class="string">&quot;Surface2&quot;</span>);</span><br><span class="line"></span><br><span class="line">surfaceLayer = map.FindElevationSurfaceLayer(layerUri);</span><br></pre></td></tr></table></figure>

<h3 id="移除高程表面图层"><a href="#移除高程表面图层" class="headerlink" title="移除高程表面图层"></a>移除高程表面图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap in a QueuedTask.Run</span></span><br><span class="line"></span><br><span class="line">map.ClearElevationSurfaceLayers();   <span class="comment">//Ground will not be removed</span></span><br><span class="line"></span><br><span class="line">map.RemoveLayer(surfaceLayer);<span class="comment">//Cannot remove ground</span></span><br><span class="line">map.RemoveLayers(map.GetElevationSurfaceLayers()); <span class="comment">//Ground will not be removed</span></span><br></pre></td></tr></table></figure>

<h3 id="从曲面获取-Z-值"><a href="#从曲面获取-Z-值" class="headerlink" title="从曲面获取 Z 值"></a>从曲面获取 Z 值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">await</span> QueuedTask.Run&lt;Geometry&gt;(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Geometry mapCentergeometry = MapView.Active.Map.CalculateFullExtent().Center;</span><br><span class="line">  <span class="keyword">return</span> mapCentergeometry;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//Pass any Geometry type to GetZsFromSurfaceAsync</span></span><br><span class="line"><span class="keyword">var</span> surfaceZResult = <span class="keyword">await</span> MapView.Active.Map.GetZsFromSurfaceAsync(geometry);</span><br><span class="line"><span class="keyword">return</span> surfaceZResult;</span><br></pre></td></tr></table></figure>

<h2 id="栅格图层"><a href="#栅格图层" class="headerlink" title="栅格图层"></a>栅格图层</h2><h3 id="创建栅格图层"><a href="#创建栅格图层" class="headerlink" title="创建栅格图层"></a>创建栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;C:\Images\Italy.tif&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a raster layer using a path to an image.</span></span><br><span class="line">  <span class="comment">// Note: You can create a raster layer from a url, project item, or data connection.</span></span><br><span class="line">  rasterLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> RasterLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新栅格图层上的栅格着色器"><a href="#更新栅格图层上的栅格着色器" class="headerlink" title="更新栅格图层上的栅格着色器"></a>更新栅格图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the raster layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = rasterLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update raster colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the raster layer with the changed colorizer.</span></span><br><span class="line">  rasterLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新栅格图层上的-RGB-着色器"><a href="#更新栅格图层上的-RGB-着色器" class="headerlink" title="更新栅格图层上的 RGB 着色器"></a>更新栅格图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the raster layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = rasterLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the raster layer with the changed colorizer.</span></span><br><span class="line">    rasterLayer.SetColorizer(rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将某个着色器应用于栅格图层"><a href="#检查是否可以将某个着色器应用于栅格图层" class="headerlink" title="检查是否可以将某个着色器应用于栅格图层"></a>检查是否可以将某个着色器应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the raster layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList = rasterLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于栅格图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于栅格图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于栅格图层"></a>基于默认着色器定义创建新的着色器并将其应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the raster layer.</span></span><br><span class="line">  <span class="keyword">if</span> (rasterLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> rasterLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the raster layer.</span></span><br><span class="line">    rasterLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于栅格图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于栅格图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于栅格图层"></a>基于自定义着色器定义创建新的着色器并将其应用于栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the raster layer.</span></span><br><span class="line">  <span class="keyword">if</span> (rasterLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition specifying parameters </span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> rasterLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the raster layer.</span></span><br><span class="line">    rasterLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建栅格图层"><a href="#使用新的着色器定义创建栅格图层" class="headerlink" title="使用新的着色器定义创建栅格图层"></a>使用新的着色器定义创建栅格图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new stretch colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  Name = layerName,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a raster layer using the colorizer definition created above.</span></span><br><span class="line">  <span class="comment">// Note: You can create a raster layer from a url, project item, or data connection.</span></span><br><span class="line">  RasterLayer rasterLayerfromURL =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;RasterLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="马赛克图层"><a href="#马赛克图层" class="headerlink" title="马赛克图层"></a>马赛克图层</h2><h3 id="创建镶嵌图层"><a href="#创建镶嵌图层" class="headerlink" title="创建镶嵌图层"></a>创建镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MosaicLayer mosaicLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">string</span> url = <span class="string">@&quot;C:\Images\countries.gdb\Italy&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a mosaic layer using a path to a mosaic dataset.</span></span><br><span class="line">  <span class="comment">// Note: You can create a mosaic layer from a url, project item, or data connection.</span></span><br><span class="line">  mosaicLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> MosaicLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的栅格着色器"><a href="#更新镶嵌图层上的栅格着色器" class="headerlink" title="更新镶嵌图层上的栅格着色器"></a>更新镶嵌图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the colorizer from the image sub-layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = mosaicImageSubLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update raster colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the image sub-layer with the changed colorizer.</span></span><br><span class="line">  mosaicImageSubLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的-RGB-着色器"><a href="#更新镶嵌图层上的-RGB-着色器" class="headerlink" title="更新镶嵌图层上的 RGB 着色器"></a>更新镶嵌图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the colorizer from the image sub-layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = mosaicImageSubLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the image sub-layer with the changed colorizer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将某种着色器应用于马赛克图层"><a href="#检查是否可以将某种着色器应用于马赛克图层" class="headerlink" title="检查是否可以将某种着色器应用于马赛克图层"></a>检查是否可以将某种着色器应用于马赛克图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the image sub-layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList =</span><br><span class="line">    mosaicImageSubLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于镶嵌图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于镶嵌图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于镶嵌图层"></a>基于默认着色器定义创建新的着色器并将其应用于镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image sub-layer.</span></span><br><span class="line">  <span class="keyword">if</span> (mosaicImageSubLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> mosaicImageSubLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image sub-layer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层"></a>基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageMosaicSubLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer();</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image sub-layer.</span></span><br><span class="line">  <span class="keyword">if</span> (mosaicImageSubLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer definition specifying parameters</span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> mosaicImageSubLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image sub-layer.</span></span><br><span class="line">    mosaicImageSubLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建镶嵌图层"><a href="#使用新的着色器定义创建镶嵌图层" class="headerlink" title="使用新的着色器定义创建镶嵌图层"></a>使用新的着色器定义创建镶嵌图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  Name = layerName,</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a mosaic layer using the colorizer definition created above.</span></span><br><span class="line">  <span class="comment">// Note: You can create a mosaic layer from a url, project item, or data connection.</span></span><br><span class="line">  MosaicLayer newMosaicLayer =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;MosaicLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的排序顺序-镶嵌方法"><a href="#更新镶嵌图层上的排序顺序-镶嵌方法" class="headerlink" title="更新镶嵌图层上的排序顺序 - 镶嵌方法"></a>更新镶嵌图层上的排序顺序 - 镶嵌方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageServiceLayer mosaicImageSubLayer = mosaicLayer.GetImageLayer() <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">  <span class="comment">// Get the mosaic rule.</span></span><br><span class="line">  CIMMosaicRule mosaicingRule = mosaicImageSubLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Method to Center.</span></span><br><span class="line">  mosaicingRule.MosaicMethod = RasterMosaicMethod.Center;</span><br><span class="line">  <span class="comment">// Update the mosaic with the changed mosaic rule.</span></span><br><span class="line">  mosaicImageSubLayer.SetMosaicRule(mosaicingRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新镶嵌图层上的解析重叠-镶嵌运算符"><a href="#更新镶嵌图层上的解析重叠-镶嵌运算符" class="headerlink" title="更新镶嵌图层上的解析重叠 - 镶嵌运算符"></a>更新镶嵌图层上的解析重叠 - 镶嵌运算符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the image sub-layer from the mosaic layer.</span></span><br><span class="line">  ImageServiceLayer mosaicImageSublayer = mosaicLayer.GetImageLayer() <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">  <span class="comment">// Get the mosaic rule.</span></span><br><span class="line">  CIMMosaicRule mosaicRule = mosaicImageSublayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Operator to Mean.</span></span><br><span class="line">  mosaicRule.MosaicOperatorType = RasterMosaicOperatorType.Mean;</span><br><span class="line">  <span class="comment">// Update the mosaic with the changed mosaic rule.</span></span><br><span class="line">  mosaicImageSublayer.SetMosaicRule(mosaicRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="影像服务图层"><a href="#影像服务图层" class="headerlink" title="影像服务图层"></a>影像服务图层</h2><h3 id="创建影像服务图层"><a href="#创建影像服务图层" class="headerlink" title="创建影像服务图层"></a>创建影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ImageServiceLayer isLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">string</span> url =</span><br><span class="line"><span class="string">@&quot;http://imagery.arcgisonline.com/arcgis/services/LandsatGLS/GLS2010_Enhanced/ImageServer&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create an image service layer using the url for an image service.</span></span><br><span class="line">  isLayer = LayerFactory.Instance.CreateLayer(<span class="keyword">new</span> Uri(url), aMap) <span class="keyword">as</span> ImageServiceLayer;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的栅格着色器"><a href="#更新影像服务图层上的栅格着色器" class="headerlink" title="更新影像服务图层上的栅格着色器"></a>更新影像服务图层上的栅格着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the image service layer.</span></span><br><span class="line">  CIMRasterColorizer rasterColorizer = isLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Update the colorizer properties.</span></span><br><span class="line">  rasterColorizer.Brightness = <span class="number">10</span>;</span><br><span class="line">  rasterColorizer.Contrast = <span class="number">-5</span>;</span><br><span class="line">  rasterColorizer.ResamplingType = RasterResamplingType.NearestNeighbor;</span><br><span class="line">  <span class="comment">// Update the image service layer with the changed colorizer.</span></span><br><span class="line">  isLayer.SetColorizer(rasterColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的-RGB-着色器"><a href="#更新影像服务图层上的-RGB-着色器" class="headerlink" title="更新影像服务图层上的 RGB 着色器"></a>更新影像服务图层上的 RGB 着色器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the colorizer from the image service layer.</span></span><br><span class="line">  CIMRasterColorizer rColorizer = isLayer.GetColorizer();</span><br><span class="line">  <span class="comment">// Check if the colorizer is an RGB colorizer.</span></span><br><span class="line">  <span class="keyword">if</span> (rColorizer <span class="keyword">is</span> CIMRasterRGBColorizer rasterRGBColorizer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update RGB colorizer properties.</span></span><br><span class="line">    rasterRGBColorizer.StretchType = RasterStretchType.ESRI;</span><br><span class="line">    <span class="comment">// Update the image service layer with the changed colorizer.</span></span><br><span class="line">    isLayer.SetColorizer((CIMRasterColorizer)rasterRGBColorizer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查是否可以将特定着色器应用于影像服务图层"><a href="#检查是否可以将特定着色器应用于影像服务图层" class="headerlink" title="检查是否可以将特定着色器应用于影像服务图层"></a>检查是否可以将特定着色器应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the list of colorizers that can be applied to the imager service layer.</span></span><br><span class="line">  IEnumerable&lt;RasterColorizerType&gt; applicableColorizerList = isLayer.GetApplicableColorizers();</span><br><span class="line">  <span class="comment">// Check if the RGB colorizer is part of the list.</span></span><br><span class="line">  <span class="built_in">bool</span> isTrue_ContainTheColorizerType =</span><br><span class="line">    applicableColorizerList.Contains(RasterColorizerType.RGBColorizer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于默认着色器定义创建新的着色器并将其应用于影像服务图层"><a href="#基于默认着色器定义创建新的着色器并将其应用于影像服务图层" class="headerlink" title="基于默认着色器定义创建新的着色器并将其应用于影像服务图层"></a>基于默认着色器定义创建新的着色器并将其应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image service layer.</span></span><br><span class="line">  <span class="keyword">if</span> (isLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition using the default constructor.</span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_default = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line">    <span class="comment">// Create a new Stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_default =</span><br><span class="line">      <span class="keyword">await</span> isLayer.CreateColorizerAsync(stretchColorizerDef_default) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image service layer.</span></span><br><span class="line">    isLayer.SetColorizer(newStretchColorizer_default);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="基于自定义着色器定义创建新的着色器并将其应用于影像服务图层"><a href="#基于自定义着色器定义创建新的着色器并将其应用于影像服务图层" class="headerlink" title="基于自定义着色器定义创建新的着色器并将其应用于影像服务图层"></a>基于自定义着色器定义创建新的着色器并将其应用于影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Check if the Stretch colorizer can be applied to the image service layer.</span></span><br><span class="line">  <span class="keyword">if</span> (isLayer.GetApplicableColorizers().Contains(RasterColorizerType.StretchColorizer))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a new Stretch Colorizer Definition specifying parameters</span></span><br><span class="line">    <span class="comment">// for band index, stretch type, gamma and color ramp. </span></span><br><span class="line">    StretchColorizerDefinition stretchColorizerDef_custom =</span><br><span class="line">      <span class="keyword">new</span> StretchColorizerDefinition(<span class="number">1</span>, RasterStretchType.ESRI, <span class="number">2</span>, colorRamp);</span><br><span class="line">    <span class="comment">// Create a new stretch colorizer using the colorizer definition created above.</span></span><br><span class="line">    CIMRasterStretchColorizer newStretchColorizer_custom =</span><br><span class="line">      <span class="keyword">await</span> isLayer.CreateColorizerAsync(stretchColorizerDef_custom) <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">    <span class="comment">// Set the new colorizer on the image service layer.</span></span><br><span class="line">    isLayer.SetColorizer(newStretchColorizer_custom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用新的着色器定义创建影像服务图层"><a href="#使用新的着色器定义创建影像服务图层" class="headerlink" title="使用新的着色器定义创建影像服务图层"></a>使用新的着色器定义创建影像服务图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new colorizer definition using default constructor.</span></span><br><span class="line">StretchColorizerDefinition stretchColorizerDef = <span class="keyword">new</span> StretchColorizerDefinition();</span><br><span class="line"><span class="keyword">var</span> rasterLayerCreationParams = <span class="keyword">new</span> RasterLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  Name = layerName,</span><br><span class="line">  ColorizerDefinition = stretchColorizerDef,</span><br><span class="line">  MapMemberIndex = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create an image service layer using the colorizer definition created above.</span></span><br><span class="line">  ImageServiceLayer imageServiceLayer =</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;ImageServiceLayer&gt;(rasterLayerCreationParams, aMap);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的排序顺序-镶嵌方法"><a href="#更新影像服务图层上的排序顺序-镶嵌方法" class="headerlink" title="更新影像服务图层上的排序顺序 - 镶嵌方法"></a>更新影像服务图层上的排序顺序 - 镶嵌方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the mosaic rule of the image service.</span></span><br><span class="line">  CIMMosaicRule mosaicRule = isLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Method to Center.</span></span><br><span class="line">  mosaicRule.MosaicMethod = RasterMosaicMethod.Center;</span><br><span class="line">  <span class="comment">// Update the image service with the changed mosaic rule.</span></span><br><span class="line">  isLayer.SetMosaicRule(mosaicRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更新影像服务图层上的解决重叠-镶嵌运算符"><a href="#更新影像服务图层上的解决重叠-镶嵌运算符" class="headerlink" title="更新影像服务图层上的解决重叠 - 镶嵌运算符"></a>更新影像服务图层上的解决重叠 - 镶嵌运算符</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the mosaic rule of the image service.</span></span><br><span class="line">  CIMMosaicRule mosaicingRule = isLayer.GetMosaicRule();</span><br><span class="line">  <span class="comment">// Set the Mosaic Operator to Mean.</span></span><br><span class="line">  mosaicingRule.MosaicOperatorType = RasterMosaicOperatorType.Mean;</span><br><span class="line">  <span class="comment">// Update the image service with the changed mosaic rule.</span></span><br><span class="line">  isLayer.SetMosaicRule(mosaicingRule);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用独立表"><a href="#使用独立表" class="headerlink" title="使用独立表"></a>使用独立表</h2><h3 id="创建独立表"><a href="#创建独立表" class="headerlink" title="创建独立表"></a>创建独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//container can be a map or group layer</span></span><br><span class="line"><span class="keyword">var</span> container = MapView.Active.Map;</span><br><span class="line"><span class="comment">//var container =  MapView.Active.Map.GetLayersAsFlattenedList()</span></span><br><span class="line"><span class="comment">//                                  .OfType&lt;GroupLayer&gt;().First();</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//use a local path</span></span><br><span class="line">  <span class="keyword">var</span> table = StandaloneTableFactory.Instance.CreateStandaloneTable(</span><br><span class="line">      <span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Temp\Data\SDK.gdb\EarthquakeDamage&quot;</span>, UriKind.Absolute),</span><br><span class="line">      container);</span><br><span class="line">  <span class="comment">//use a URI to a feature service table endpoint</span></span><br><span class="line">  <span class="keyword">var</span> table2 = StandaloneTableFactory.Instance.CreateStandaloneTable(</span><br><span class="line">    <span class="keyword">new</span> Uri(<span class="string">@&quot;https://bexdog.esri.com/server/rest/services/FeatureServer&quot;</span> + <span class="string">&quot;/2&quot;</span>, UriKind.Absolute),</span><br><span class="line">    container);</span><br><span class="line">  <span class="comment">//Use an item</span></span><br><span class="line">  <span class="keyword">var</span> item = ItemFactory.Instance.Create(<span class="string">@&quot;C:\Temp\Data\SDK.gdb\ParcelOwners&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> tableCreationParams = <span class="keyword">new</span> StandaloneTableCreationParams(item);</span><br><span class="line">  <span class="keyword">var</span> table3 = StandaloneTableFactory.Instance.CreateStandaloneTable(tableCreationParams, container);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//use table creation params</span></span><br><span class="line">  <span class="keyword">var</span> table_params = <span class="keyword">new</span> StandaloneTableCreationParams(item)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// At 2.x - DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//  //optional - use a filter</span></span><br><span class="line">    <span class="comment">//  DefinitionExpression = &quot;LAND_USE = 3&quot;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;LAND_USE = 3&quot;</span>, name: <span class="string">&quot;Landuse&quot;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> table4 = StandaloneTableFactory.Instance.CreateStandaloneTable(table_params,</span><br><span class="line">                           container);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从表的容器中检索表"><a href="#从表的容器中检索表" class="headerlink" title="从表的容器中检索表"></a>从表的容器中检索表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = MapView.Active.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//the map standalone table collection</span></span><br><span class="line"><span class="keyword">var</span> table = container.GetStandaloneTablesAsFlattenedList()</span><br><span class="line">                        .FirstOrDefault(tbl =&gt; tbl.Name == <span class="string">&quot;EarthquakeDamage&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//or from a group layer</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.FindLayers(<span class="string">&quot;GroupLayer1&quot;</span>).First() <span class="keyword">as</span> GroupLayer;</span><br><span class="line"><span class="keyword">var</span> table2 = grp_layer.FindStandaloneTables(<span class="string">&quot;EarthquakeDamage&quot;</span>).First();</span><br><span class="line"><span class="comment">//or         grp_layer.GetStandaloneTablesAsFlattenedList().First()</span></span><br><span class="line"><span class="comment">//or         grp_layer.StandaloneTables.Where(...).First(), etc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//show the table in a table view </span></span><br><span class="line"><span class="comment">//use FrameworkApplication.Current.Dispatcher.BeginInvoke if not on the UI thread</span></span><br><span class="line">FrameworkApplication.Panes.OpenTablePane(table2);</span><br></pre></td></tr></table></figure>

<h3 id="移动独立表"><a href="#移动独立表" class="headerlink" title="移动独立表"></a>移动独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the first group layer that has at least one table</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;GroupLayer&gt;().First(g =&gt; g.StandaloneTables.Count &gt; <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;<span class="comment">//assumes non-null</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//move the first table to the bottom of the container</span></span><br><span class="line">  grp_layer.MoveStandaloneTable(grp_layer.StandaloneTables.First(), <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//move the last table in the map standalone tables to a group</span></span><br><span class="line">  <span class="comment">//layer and place it at position 3. If 3 is invalid, the table</span></span><br><span class="line">  <span class="comment">//will be placed at the bottom of the target container</span></span><br><span class="line">  <span class="comment">//assumes the map has at least one standalone table...</span></span><br><span class="line">  <span class="keyword">var</span> table = map.StandaloneTables.Last();</span><br><span class="line">  map.MoveStandaloneTable(table, grp_layer, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//move a table from a group layer to the map standalone tables</span></span><br><span class="line">  <span class="comment">//collection - assumes a table called &#x27;Earthquakes&#x27; exists</span></span><br><span class="line">  <span class="keyword">var</span> table2 = grp_layer.FindStandaloneTables(<span class="string">&quot;Earthquakes&quot;</span>).First();</span><br><span class="line">  <span class="comment">//move to the map container</span></span><br><span class="line">  map.MoveStandaloneTable(table2, <span class="number">0</span>);<span class="comment">//will be placed at the top</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="删除独立表"><a href="#删除独立表" class="headerlink" title="删除独立表"></a>删除独立表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the first group layer that has at least one table</span></span><br><span class="line"><span class="keyword">var</span> grp_layer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">  .OfType&lt;GroupLayer&gt;().First(g =&gt; g.StandaloneTables.Count &gt; <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;<span class="comment">//assumes non-null</span></span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//get the tables from the map container</span></span><br><span class="line">  <span class="keyword">var</span> tables = map.GetStandaloneTablesAsFlattenedList();</span><br><span class="line">  <span class="comment">//delete the first...</span></span><br><span class="line">  <span class="keyword">if</span> (tables.Count() &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    map.RemoveStandaloneTable(tables.First());</span><br><span class="line">    <span class="comment">//or delete all of them</span></span><br><span class="line">    map.RemoveStandaloneTables(tables);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//delete a table from a group layer</span></span><br><span class="line">  <span class="comment">//assumes it has at least one table...</span></span><br><span class="line">  grp_layer.RemoveStandaloneTable(grp_layer.StandaloneTables.First());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="符号图层绘制-（SLD）"><a href="#符号图层绘制-（SLD）" class="headerlink" title="符号图层绘制 （SLD）"></a>符号图层绘制 （SLD）</h2><h3 id="添加-SLD"><a href="#添加-SLD" class="headerlink" title="添加 SLD"></a>添加 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//check if it can be added to the layer</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.CanAddSymbolLayerDrawing())</span><br><span class="line">    featLayer.AddSymbolLayerDrawing();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ditto for a group layer...must have at least</span></span><br><span class="line">  <span class="comment">//one child feature layer that can participate</span></span><br><span class="line">  <span class="keyword">if</span> (groupLayer.CanAddSymbolLayerDrawing())</span><br><span class="line">    groupLayer.AddSymbolLayerDrawing();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="确定图层是否添加了-SLD"><a href="#确定图层是否添加了-SLD" class="headerlink" title="确定图层是否添加了 SLD"></a>确定图层是否添加了 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SLD can be added to feature layers and group layers</span></span><br><span class="line"><span class="comment">//For a group layer, SLD controls all child feature layers</span></span><br><span class="line"><span class="comment">//that are participating in the SLD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var featLayer = ...;//retrieve the feature layer</span></span><br><span class="line"><span class="comment">//var groupLayer = ...;//retrieve the group layer</span></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Check if the layer has SLD added -returns a tuple</span></span><br><span class="line">  <span class="keyword">var</span> tuple = featLayer.HasSymbolLayerDrawingAdded();</span><br><span class="line">  <span class="keyword">if</span> (tuple.addedOnLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//SLD is added on the layer</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (tuple.addedOnParent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//SLD is added on the parent (group layer) - </span></span><br><span class="line">    <span class="comment">//check parent...this can be recursive</span></span><br><span class="line">    <span class="keyword">var</span> parentLayer = GetParentLayerWithSLD(featLayer.Parent <span class="keyword">as</span> GroupLayer);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">   //Recursively get the parent with SLD</span></span><br><span class="line"><span class="comment">   public GroupLayer GetParentLayerWithSLD(GroupLayer groupLayer) </span></span><br><span class="line"><span class="comment">   &#123;</span></span><br><span class="line"><span class="comment">     if (groupLayer == null)</span></span><br><span class="line"><span class="comment">       return null;</span></span><br><span class="line"><span class="comment">     //Must be on QueuedTask</span></span><br><span class="line"><span class="comment">     var sld_added = groupLayer.HasSymbolLayerDrawingAdded();</span></span><br><span class="line"><span class="comment">     if (sld_added.addedOnLayer)</span></span><br><span class="line"><span class="comment">       return groupLayer;</span></span><br><span class="line"><span class="comment">     else if (sld_added.addedOnParent)</span></span><br><span class="line"><span class="comment">       return GetParentLayerWithSLD(groupLayer.Parent as GroupLayer);</span></span><br><span class="line"><span class="comment">     return null;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="启用-x2F-禁用-SLD"><a href="#启用-x2F-禁用-SLD" class="headerlink" title="启用&#x2F;禁用 SLD"></a>启用&#x2F;禁用 SLD</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//A layer may have SLD added but is not using it</span></span><br><span class="line">  <span class="comment">//HasSymbolLayerDrawingAdded returns a tuple - to check</span></span><br><span class="line">  <span class="comment">//the layer has SLD (not its parent) check addedOnLayer</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.HasSymbolLayerDrawingAdded().addedOnLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//the layer has SLD but is the layer currently using it?</span></span><br><span class="line">    <span class="comment">//GetUseSymbolLayerDrawing returns a tuple - useOnLayer for </span></span><br><span class="line">    <span class="comment">//the layer (and useOnParent for the parent layer)</span></span><br><span class="line">    <span class="keyword">if</span> (!featLayer.GetUseSymbolLayerDrawing().useOnLayer)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//enable it</span></span><br><span class="line">      featLayer.SetUseSymbolLayerDrawing(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Enable/Disable SLD on a layer parent</span></span><br><span class="line">  <span class="keyword">if</span> (featLayer.HasSymbolLayerDrawingAdded().addedOnParent)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//check parent...this can be recursive</span></span><br><span class="line">    <span class="keyword">var</span> parent = GetParentLayerWithSLD(featLayer.Parent <span class="keyword">as</span> GroupLayer);</span><br><span class="line">    <span class="keyword">if</span> (parent.GetUseSymbolLayerDrawing().useOnLayer)</span><br><span class="line">      parent.SetUseSymbolLayerDrawing(<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   //Recursively get the parent with SLD</span></span><br><span class="line"><span class="comment">   public GroupLayer GetParentLayerWithSLD(GroupLayer groupLayer) </span></span><br><span class="line"><span class="comment">   &#123;</span></span><br><span class="line"><span class="comment">     if (groupLayer == null)</span></span><br><span class="line"><span class="comment">       return null;</span></span><br><span class="line"><span class="comment">     //Must be on QueuedTask</span></span><br><span class="line"><span class="comment">     var sld_added = groupLayer.HasSymbolLayerDrawingAdded();</span></span><br><span class="line"><span class="comment">     if (sld_added.addedOnLayer)</span></span><br><span class="line"><span class="comment">       return groupLayer;</span></span><br><span class="line"><span class="comment">     else if (sld_added.addedOnParent)</span></span><br><span class="line"><span class="comment">       return GetParentLayerWithSLD(groupLayer.Parent as GroupLayer);</span></span><br><span class="line"><span class="comment">     return null;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="设备位置-API、GPS-x2F-GNSS-设备"><a href="#设备位置-API、GPS-x2F-GNSS-设备" class="headerlink" title="设备位置 API、GPS&#x2F;GNSS 设备"></a>设备位置 API、GPS&#x2F;GNSS 设备</h2><h3 id="连接到设备位置源"><a href="#连接到设备位置源" class="headerlink" title="连接到设备位置源"></a>连接到设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newSrc = <span class="keyword">new</span> SerialPortDeviceLocationSource();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Specify the COM port the device is connected to</span></span><br><span class="line">newSrc.ComPort = <span class="string">&quot;Com3&quot;</span>;</span><br><span class="line">newSrc.BaudRate = <span class="number">4800</span>;</span><br><span class="line">newSrc.AntennaHeight = <span class="number">3</span>;  <span class="comment">// meters</span></span><br><span class="line"><span class="comment">//fill in other properties as needed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> props = <span class="keyword">new</span> DeviceLocationProperties();</span><br><span class="line">props.AccuracyThreshold = <span class="number">10</span>;   <span class="comment">// meters</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jump to the background thread</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//open the device</span></span><br><span class="line">  DeviceLocationService.Instance.Open(newSrc, props);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前设备位置源"><a href="#获取当前设备位置源" class="headerlink" title="获取当前设备位置源"></a>获取当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = DeviceLocationService.Instance.GetSource();</span><br><span class="line"><span class="keyword">if</span> (source == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//There is no current source</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭当前设备位置源"><a href="#关闭当前设备位置源" class="headerlink" title="关闭当前设备位置源"></a>关闭当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Is there a current device source?</span></span><br><span class="line"><span class="keyword">var</span> src = DeviceLocationService.Instance.GetSource();</span><br><span class="line"><span class="keyword">if</span> (src == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//no current source</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationService.Instance.Close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前设备位置源和属性"><a href="#获取当前设备位置源和属性" class="headerlink" title="获取当前设备位置源和属性"></a>获取当前设备位置源和属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> isConnected = DeviceLocationService.Instance.IsDeviceConnected();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = DeviceLocationService.Instance.GetSource();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (src <span class="keyword">is</span> SerialPortDeviceLocationSource serialPortSrc)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> port = serialPortSrc.ComPort;</span><br><span class="line">  <span class="keyword">var</span> antennaHeight = serialPortSrc.AntennaHeight;</span><br><span class="line">  <span class="keyword">var</span> dataBits = serialPortSrc.DataBits;</span><br><span class="line">  <span class="keyword">var</span> baudRate = serialPortSrc.BaudRate;</span><br><span class="line">  <span class="keyword">var</span> parity = serialPortSrc.Parity;</span><br><span class="line">  <span class="keyword">var</span> stopBits = serialPortSrc.StopBits;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// retrieving spatial reference needs the MCT</span></span><br><span class="line">  <span class="keyword">var</span> sr = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> serialPortSrc.GetSpatialReference();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> dlProps = DeviceLocationService.Instance.GetProperties();</span><br><span class="line"><span class="keyword">var</span> accuracy = dlProps.AccuracyThreshold;</span><br></pre></td></tr></table></figure>

<h3 id="更新当前设备位置源上的属性"><a href="#更新当前设备位置源上的属性" class="headerlink" title="更新当前设备位置源上的属性"></a>更新当前设备位置源上的属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> dlProps = DeviceLocationService.Instance.GetProperties();</span><br><span class="line">  <span class="comment">//Change the accuracy threshold</span></span><br><span class="line">  dlProps.AccuracyThreshold = <span class="number">22.5</span>; <span class="comment">// meters</span></span><br><span class="line"></span><br><span class="line">  DeviceLocationService.Instance.UpdateProperties(dlProps);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="订阅设备位置属性更新事件"><a href="#订阅设备位置属性更新事件" class="headerlink" title="订阅设备位置属性更新事件"></a>订阅设备位置属性更新事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToPropertiesEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationPropertiesUpdatedEvent.Subscribe(OnDeviceLocationPropertiesUpdated);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDeviceLocationPropertiesUpdated</span>(<span class="params">DeviceLocationPropertiesUpdatedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> properties = args.DeviceLocationProperties;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  TODO - something with the updated properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="订阅设备位置源更改事件"><a href="#订阅设备位置源更改事件" class="headerlink" title="订阅设备位置源更改事件"></a>订阅设备位置源更改事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToSourceEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  DeviceLocationSourceChangedEvent.Subscribe(OnDeviceLocationSourceChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDeviceLocationSourceChanged</span>(<span class="params">DeviceLocationSourceChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> source = args.DeviceLocationSource; </span><br><span class="line"></span><br><span class="line">  <span class="comment">//  TODO - something with the updated source properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="映射设备位置选项"><a href="#映射设备位置选项" class="headerlink" title="映射设备位置选项"></a>映射设备位置选项</h2><h3 id="启用-x2F-禁用地图的当前设备位置源"><a href="#启用-x2F-禁用地图的当前设备位置源" class="headerlink" title="启用&#x2F;禁用地图的当前设备位置源"></a>启用&#x2F;禁用地图的当前设备位置源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> enabled = MapDeviceLocationService.Instance.IsDeviceLocationEnabled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  MapDeviceLocationService.Instance.SetDeviceLocationEnabled(!enabled);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前地图设备位置选项"><a href="#获取当前地图设备位置选项" class="headerlink" title="获取当前地图设备位置选项"></a>获取当前地图设备位置选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = MapDeviceLocationService.Instance.GetDeviceLocationOptions();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> visibility = options.DeviceLocationVisibility;</span><br><span class="line"><span class="keyword">var</span> navMode = options.NavigationMode;</span><br><span class="line"><span class="keyword">var</span> trackUp = options.TrackUpNavigation;</span><br><span class="line"><span class="keyword">var</span> showBuffer = options.ShowAccuracyBuffer;</span><br></pre></td></tr></table></figure>

<h3 id="检查地图上是否启用了当前设备位置"><a href="#检查地图上是否启用了当前设备位置" class="headerlink" title="检查地图上是否启用了当前设备位置"></a>检查地图上是否启用了当前设备位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//The Device Location Source is Enabled</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置当前地图设备位置选项"><a href="#设置当前地图设备位置选项" class="headerlink" title="设置当前地图设备位置选项"></a>设置当前地图设备位置选项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Check there is a source first...</span></span><br><span class="line"><span class="keyword">if</span> (DeviceLocationService.Instance.GetSource() == <span class="literal">null</span>)</span><br><span class="line">  <span class="comment">//Setting DeviceLocationOptions w/ no Device Location Source</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = MapView.Active.Map;</span><br><span class="line"><span class="keyword">if</span> (!MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">  <span class="comment">//Setting DeviceLocationOptions w/ no Device Location Enabled</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">MapDeviceLocationService.Instance.SetDeviceLocationOptions(</span><br><span class="line">  <span class="keyword">new</span> MapDeviceLocationOptions()</span><br><span class="line">  &#123;</span><br><span class="line">    DeviceLocationVisibility = <span class="literal">true</span>,</span><br><span class="line">    NavigationMode = MappingDeviceLocationNavigationMode.KeepAtCenter,</span><br><span class="line">    TrackUpNavigation = <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="缩放-x2F-平移地图到最新位置"><a href="#缩放-x2F-平移地图到最新位置" class="headerlink" title="缩放&#x2F;平移地图到最新位置"></a>缩放&#x2F;平移地图到最新位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!MapDeviceLocationService.Instance.IsDeviceLocationEnabled)</span><br><span class="line">  <span class="comment">//Calling ZoomOrPanToCurrentLocation w/ no Device Location Enabled</span></span><br><span class="line">  <span class="comment">//Will throw an InvalidOperationException</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// true for zoom, false for pan</span></span><br><span class="line">MapDeviceLocationService.Instance.ZoomOrPanToCurrentLocation(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将最新位置添加到图形图层"><a href="#将最新位置添加到图形图层" class="headerlink" title="将最新位置添加到图形图层"></a>将最新位置添加到图形图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var graphicsLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get the last location</span></span><br><span class="line"><span class="keyword">var</span> pt = DeviceLocationService.Instance.GetCurrentSnapshot()?.GetPositionAsMapPoint();</span><br><span class="line"><span class="keyword">if</span> (pt != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create a point symbol</span></span><br><span class="line">  <span class="keyword">var</span> ptSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                    CIMColor.CreateRGBColor(<span class="number">125</span>, <span class="number">125</span>, <span class="number">0</span>), <span class="number">10</span>, SimpleMarkerStyle.Triangle);</span><br><span class="line">  <span class="comment">//Add a graphic to the graphics layer</span></span><br><span class="line">  graphicsLayer.AddElement(pt, ptSymbol);</span><br><span class="line">  <span class="comment">//unselect it</span></span><br><span class="line">  graphicsLayer.ClearSelection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="订阅位置快照事件"><a href="#订阅位置快照事件" class="headerlink" title="订阅位置快照事件"></a>订阅位置快照事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SubscribeToSnapshotEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  SnapshotChangedEvent.Subscribe(OnSnapshotChanged);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSnapshotChanged</span>(<span class="params">SnapshotChangedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> snapshot = args.Snapshot <span class="keyword">as</span> NMEASnapshot;</span><br><span class="line">  <span class="keyword">if</span> (snapshot == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> pt = snapshot.GetPositionAsMapPoint();</span><br><span class="line">    <span class="keyword">if</span> (pt?.IsEmpty ?? <span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// access properties</span></span><br><span class="line">    <span class="keyword">var</span> alt = snapshot.Altitude;</span><br><span class="line">    <span class="keyword">var</span> dt = snapshot.DateTime;</span><br><span class="line">    <span class="keyword">var</span> vdop = snapshot.VDOP;</span><br><span class="line">    <span class="keyword">var</span> hdop = snapshot.HDOP;</span><br><span class="line">    <span class="comment">// etc</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> use the snapshot</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="特征遮罩"><a href="#特征遮罩" class="headerlink" title="特征遮罩"></a>特征遮罩</h2><h3 id="获取要素的遮罩几何"><a href="#获取要素的遮罩几何" class="headerlink" title="获取要素的遮罩几何"></a>获取要素的遮罩几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featureLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                           .OfType&lt;BasicFeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (featureLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> table = featureLayer.GetTable())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = table.Search())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//get the first feature...</span></span><br><span class="line">      <span class="comment">//...assuming at least one feature gets retrieved</span></span><br><span class="line">      rc.MoveNext();</span><br><span class="line">      <span class="keyword">var</span> oid = rc.Current.GetObjectID();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use DrawingOutlineType.BoundingEnvelope to retrieve a generalized</span></span><br><span class="line">      <span class="comment">//mask geometry or &quot;Box&quot;. The mask will be in the same SpatRef as the map</span></span><br><span class="line">      <span class="comment">//At 2.x - var mask_geom = featureLayer.QueryDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span></span><br><span class="line">      <span class="keyword">var</span> mask_geom = featureLayer.GetDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//TODO - use the mask geometry...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="风格管理"><a href="#风格管理" class="headerlink" title="风格管理"></a>风格管理</h2><h3 id="如何按名称获取项目中的样式"><a href="#如何按名称获取项目中的样式" class="headerlink" title="如何按名称获取项目中的样式"></a>如何按名称获取项目中的样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get all styles in the project</span></span><br><span class="line"><span class="keyword">var</span> ProjectStyles = Project.Current.GetItems&lt;StyleProjectItem&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get a specific style in the project by name</span></span><br><span class="line">StyleProjectItem style = ProjectStyles.First(x =&gt; x.Name == <span class="string">&quot;NameOfTheStyle&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="如何创建新样式"><a href="#如何创建新样式" class="headerlink" title="如何创建新样式"></a>如何创建新样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Full path for the new style file (.stylx) to be created</span></span><br><span class="line"><span class="built_in">string</span> styleToCreate = <span class="string">@&quot;C:\Temp\NewStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.CreateStyle(Project.Current, styleToCreate));</span><br></pre></td></tr></table></figure>

<h3 id="如何向项目添加样式"><a href="#如何向项目添加样式" class="headerlink" title="如何向项目添加样式"></a>如何向项目添加样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//For ArcGIS Pro system styles, just pass in the name of the style to add to the project</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, <span class="string">&quot;3D Vehicles&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//For custom styles, pass in the full path to the style file on disk</span></span><br><span class="line"><span class="built_in">string</span> customStyleToAdd = <span class="string">@&quot;C:\Temp\CustomStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, customStyleToAdd));</span><br></pre></td></tr></table></figure>

<h3 id="如何从项目中删除样式"><a href="#如何从项目中删除样式" class="headerlink" title="如何从项目中删除样式"></a>如何从项目中删除样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//For ArcGIS Pro system styles, just pass in the name of the style to remove from the project</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.RemoveStyle(Project.Current, <span class="string">&quot;3D Vehicles&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//For custom styles, pass in the full path to the style file on disk</span></span><br><span class="line"><span class="built_in">string</span> customStyleToAdd = <span class="string">@&quot;C:\Temp\CustomStyle.stylx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.RemoveStyle(Project.Current, customStyleToAdd));</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式项添加到样式"><a href="#如何将样式项添加到样式" class="headerlink" title="如何将样式项添加到样式"></a>如何将样式项添加到样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">AddStyleItemAsync</span>(<span class="params">StyleProjectItem style, StyleItem itemToAdd</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span> || itemToAdd == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Add the item to style</span></span><br><span class="line">    style.AddItem(itemToAdd);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何从样式中删除样式项"><a href="#如何从样式中删除样式项" class="headerlink" title="如何从样式中删除样式项"></a>如何从样式中删除样式项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">RemoveStyleItemAsync</span>(<span class="params">StyleProjectItem style, StyleItem itemToRemove</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span> || itemToRemove == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Remove the item from style</span></span><br><span class="line">    style.RemoveItem(itemToRemove);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否可以升级"><a href="#如何确定样式是否可以升级" class="headerlink" title="如何确定样式是否可以升级"></a>如何确定样式是否可以升级</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">CanUpgradeStyleAsync</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style can be upgraded</span></span><br><span class="line">  <span class="keyword">return</span> style.CanUpgrade;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否为只读"><a href="#如何确定样式是否为只读" class="headerlink" title="如何确定样式是否为只读"></a>如何确定样式是否为只读</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">IsReadOnly</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style is read-only</span></span><br><span class="line">  <span class="keyword">return</span> style.IsReadOnly;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何确定样式是否为当前样式"><a href="#如何确定样式是否为当前样式" class="headerlink" title="如何确定样式是否为当前样式"></a>如何确定样式是否为当前样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">IsCurrent</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//returns true if style matches the current Pro version</span></span><br><span class="line">  <span class="keyword">return</span> style.IsCurrent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何升级样式"><a href="#如何升级样式" class="headerlink" title="如何升级样式"></a>如何升级样式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pass in the full path to the style file on disk</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">UpgradeStyleAsync</span>(<span class="params"><span class="built_in">string</span> stylePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> success = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Add the style to the current project</span></span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.AddStyle(Project.Current, stylePath));</span><br><span class="line">  StyleProjectItem style = Project.Current.GetItems&lt;StyleProjectItem&gt;().First(x =&gt; x.Path == stylePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Verify that style can be upgraded</span></span><br><span class="line">  <span class="keyword">if</span> (style.CanUpgrade)</span><br><span class="line">  &#123;</span><br><span class="line">    success = <span class="keyword">await</span> QueuedTask.Run(() =&gt; StyleHelper.UpgradeStyle(style));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//return true if style was upgraded</span></span><br><span class="line">  <span class="keyword">return</span> success;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h2><h3 id="如何构建特定颜色和大小的点符号"><a href="#如何构建特定颜色和大小的点符号" class="headerlink" title="如何构建特定颜色和大小的点符号"></a>如何构建特定颜色和大小的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">10.0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、大小和形状的点符号"><a href="#如何构建特定颜色、大小和形状的点符号" class="headerlink" title="如何构建特定颜色、大小和形状的点符号"></a>如何构建特定颜色、大小和形状的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMPointSymbol starPointSymbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.RedRGB, <span class="number">10.0</span>, SimpleMarkerStyle.Star);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何根据标记构造点符号"><a href="#如何根据标记构造点符号" class="headerlink" title="如何根据标记构造点符号"></a>如何根据标记构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  CIMMarker marker = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.GreenRGB, <span class="number">8.0</span>, SimpleMarkerStyle.Pushpin);</span><br><span class="line">  CIMPointSymbol pointSymbolFromMarker = SymbolFactory.Instance.ConstructPointSymbol(marker);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="如何从磁盘上的文件构造点符号"><a href="#如何从磁盘上的文件构造点符号" class="headerlink" title="如何从磁盘上的文件构造点符号"></a>如何从磁盘上的文件构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The following file formats can be used to create the marker: DAE, 3DS, FLT, EMF, JPG, PNG, BMP, GIF</span></span><br><span class="line">CIMMarker markerFromFile = <span class="keyword">await</span> QueuedTask.Run(() =&gt; SymbolFactory.Instance.ConstructMarkerFromFile(<span class="string">@&quot;C:\Temp\fileName.dae&quot;</span>));</span><br><span class="line"></span><br><span class="line">CIMPointSymbol pointSymbolFromFile = SymbolFactory.Instance.ConstructPointSymbol(markerFromFile);</span><br></pre></td></tr></table></figure>

<h3 id="如何从内存图形构造点符号"><a href="#如何从内存图形构造点符号" class="headerlink" title="如何从内存图形构造点符号"></a>如何从内存图形构造点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Create a stream for the image</span></span><br><span class="line"><span class="comment">//At 3.0 you need https://www.nuget.org/packages/Microsoft.Windows.Compatibility</span></span><br><span class="line"><span class="comment">//System.Drawing</span></span><br><span class="line"></span><br><span class="line">System.Drawing.Image newImage = System.Drawing.Image.FromFile(<span class="string">@&quot;C:\PathToImage\Image.png&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> stream = <span class="keyword">new</span> System.IO.MemoryStream();</span><br><span class="line">newImage.Save(stream, System.Drawing.Imaging.ImageFormat.Png);</span><br><span class="line">stream.Position = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//Create marker using the stream</span></span><br><span class="line">CIMMarker markerFromStream = SymbolFactory.Instance.ConstructMarkerFromStream(stream);</span><br><span class="line"><span class="comment">//Create the point symbol from the marker</span></span><br><span class="line">CIMPointSymbol pointSymbolFromStream = SymbolFactory.Instance.ConstructPointSymbol(markerFromStream);</span><br></pre></td></tr></table></figure>

<h3 id="如何构造特定颜色和填充样式的面符号"><a href="#如何构造特定颜色和填充样式的面符号" class="headerlink" title="如何构造特定颜色和填充样式的面符号"></a>如何构造特定颜色和填充样式的面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol polygonSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、填充样式和轮廓的多边形符号"><a href="#如何构建特定颜色、填充样式和轮廓的多边形符号" class="headerlink" title="如何构建特定颜色、填充样式和轮廓的多边形符号"></a>如何构建特定颜色、填充样式和轮廓的多边形符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CIMStroke outline = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlueRGB, <span class="number">2.0</span>, SimpleLineStyle.Solid);</span><br><span class="line">CIMPolygonSymbol fillWithOutline = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, outline);</span><br></pre></td></tr></table></figure>

<h3 id="如何在没有轮廓的情况下构建面符号"><a href="#如何在没有轮廓的情况下构建面符号" class="headerlink" title="如何在没有轮廓的情况下构建面符号"></a>如何在没有轮廓的情况下构建面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol fillWithoutOutline = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB, SimpleFillStyle.Solid, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建特定颜色、大小和线条样式的线符号"><a href="#如何构建特定颜色、大小和线条样式的线符号" class="headerlink" title="如何构建特定颜色、大小和线条样式的线符号"></a>如何构建特定颜色、大小和线条样式的线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CIMLineSymbol lineSymbol = SymbolFactory.Instance.ConstructLineSymbol(ColorFactory.Instance.BlueRGB, <span class="number">4.0</span>, SimpleLineStyle.Solid);</span><br></pre></td></tr></table></figure>

<h3 id="如何根据笔划构造线条符号"><a href="#如何根据笔划构造线条符号" class="headerlink" title="如何根据笔划构造线条符号"></a>如何根据笔划构造线条符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CIMStroke stroke = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">2.0</span>);</span><br><span class="line">CIMLineSymbol lineSymbolFromStroke = SymbolFactory.Instance.ConstructLineSymbol(stroke);</span><br></pre></td></tr></table></figure>

<h3 id="如何构建线端带有圆形标记的多图层线符号"><a href="#如何构建线端带有圆形标记的多图层线符号" class="headerlink" title="如何构建线端带有圆形标记的多图层线符号"></a>如何构建线端带有圆形标记的多图层线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//These methods must be called within the lambda passed to QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> lineStrokeRed = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.RedRGB, <span class="number">4.0</span>);</span><br><span class="line"><span class="keyword">var</span> markerCircle = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.RedRGB, <span class="number">12</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">markerCircle.MarkerPlacement = <span class="keyword">new</span> CIMMarkerPlacementOnVertices()</span><br><span class="line">&#123;</span><br><span class="line">  AngleToLine = <span class="literal">true</span>,</span><br><span class="line">  PlaceOnEndPoints = <span class="literal">true</span>,</span><br><span class="line">  Offset = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> lineSymbolWithCircles = <span class="keyword">new</span> CIMLineSymbol()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[<span class="number">2</span>] &#123; markerCircle, lineStrokeRed &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="如何构建末端带有箭头的多图层线符号"><a href="#如何构建末端带有箭头的多图层线符号" class="headerlink" title="如何构建末端带有箭头的多图层线符号"></a>如何构建末端带有箭头的多图层线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//These methods must be called within the lambda passed to QueuedTask.Run</span></span><br><span class="line"><span class="keyword">var</span> markerTriangle = SymbolFactory.Instance.ConstructMarker(ColorFactory.Instance.RedRGB, <span class="number">12</span>, SimpleMarkerStyle.Triangle);</span><br><span class="line">markerTriangle.Rotation = <span class="number">-90</span>; <span class="comment">// or -90</span></span><br><span class="line">markerTriangle.MarkerPlacement = <span class="keyword">new</span> CIMMarkerPlacementOnLine() &#123; AngleToLine = <span class="literal">true</span>, RelativeTo = PlacementOnLineRelativeTo.LineEnd &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lineSymbolWithArrow = <span class="keyword">new</span> CIMLineSymbol()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolLayers = <span class="keyword">new</span> CIMSymbolLayer[<span class="number">2</span>] &#123; markerTriangle,</span><br><span class="line">              SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.RedRGB, <span class="number">2</span>)</span><br><span class="line">          &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="如何从符号获取符号引用"><a href="#如何从符号获取符号引用" class="headerlink" title="如何从符号获取符号引用"></a>如何从符号获取符号引用</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CIMPolygonSymbol symbol = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.RedRGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get symbol reference from the symbol</span></span><br><span class="line">CIMSymbolReference symbolReference = symbol.MakeSymbolReference();</span><br></pre></td></tr></table></figure>

<h3 id="修改从字符标记创建的点符号"><a href="#修改从字符标记创建的点符号" class="headerlink" title="修改从字符标记创建的点符号"></a>修改从字符标记创建的点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//create marker from the Font, char index,size,color</span></span><br><span class="line"><span class="keyword">var</span> cimMarker = SymbolFactory.Instance.ConstructMarker(<span class="number">125</span>, <span class="string">&quot;Wingdings 3&quot;</span>, <span class="string">&quot;Regular&quot;</span>, <span class="number">6</span>, ColorFactory.Instance.BlueRGB) <span class="keyword">as</span> CIMCharacterMarker;</span><br><span class="line">  <span class="keyword">var</span> polygonMarker = cimMarker.Symbol;</span><br><span class="line">  <span class="comment">//modifying the polygon&#x27;s outline and fill</span></span><br><span class="line">  <span class="comment">//This is the outline</span></span><br><span class="line">  polygonMarker.SymbolLayers[<span class="number">0</span>] = SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.GreenRGB, <span class="number">2</span>, SimpleLineStyle.Solid);</span><br><span class="line">  <span class="comment">//This is the fill</span></span><br><span class="line">  polygonMarker.SymbolLayers[<span class="number">1</span>] = SymbolFactory.Instance.ConstructSolidFill(ColorFactory.Instance.BlueRGB);</span><br><span class="line">  <span class="comment">//create a symbol from the marker </span></span><br><span class="line">  <span class="comment">//Note this overload of ConstructPointSymbol does not need to be run within QueuedTask.Run.</span></span><br><span class="line">  <span class="keyword">var</span> pointSymbol = SymbolFactory.Instance.ConstructPointSymbol(cimMarker);</span><br></pre></td></tr></table></figure>

<h3 id="获取可用字体的列表"><a href="#获取可用字体的列表" class="headerlink" title="获取可用字体的列表"></a>获取可用字体的列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must use QueuedTask.Run(...)</span></span><br><span class="line"><span class="comment">//returns a tuple per font: (string fontName, List&lt;string&gt; fontStyles)</span></span><br><span class="line"><span class="keyword">var</span> fonts = SymbolFactory.Instance.GetAvailableFonts();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> font <span class="keyword">in</span> fonts)</span><br><span class="line">      &#123;</span><br><span class="line">  <span class="keyword">var</span> styles = <span class="built_in">string</span>.Join(<span class="string">&quot;,&quot;</span>, font.fontStyles);</span><br><span class="line">  System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;font.fontName&#125;</span>, styles: <span class="subst">&#123;styles&#125;</span>&quot;</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取-x2F-设置默认字体"><a href="#获取-x2F-设置默认字体" class="headerlink" title="获取&#x2F;设置默认字体"></a>获取&#x2F;设置默认字体</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must use QueuedTask.Run(...)</span></span><br><span class="line"><span class="keyword">var</span> def_font = SymbolFactory.Instance.DefaultFont;</span><br><span class="line">System.Diagnostics.Debug.WriteLine(<span class="string">$&quot;<span class="subst">&#123;def_font.fontName&#125;</span>, styles: <span class="subst">&#123;def_font.styleName&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//set default font - set through application options</span></span><br><span class="line"><span class="comment">//Must use QueuedTask</span></span><br><span class="line">ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>);</span><br><span class="line">ApplicationOptions.TextAndGraphicsElementsOptions.SetDefaultFont(<span class="string">&quot;tahoma&quot;</span>,<span class="string">&quot;bold&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用选项构建文本符号"><a href="#使用选项构建文本符号" class="headerlink" title="使用选项构建文本符号"></a>使用选项构建文本符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//using the default font</span></span><br><span class="line">  <span class="keyword">var</span> textSym1 = SymbolFactory.Instance.ConstructTextSymbol();</span><br><span class="line">  <span class="keyword">var</span> textSym2 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                     ColorFactory.Instance.BlueRGB, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//using a specific font</span></span><br><span class="line">  <span class="keyword">var</span> textSym3 = SymbolFactory.Instance.ConstructTextSymbol(<span class="string">&quot;Arial&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> textSym4 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                    <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;Narrow Bold&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//or query available fonts to ensure the font is there</span></span><br><span class="line">  <span class="keyword">var</span> all_fonts = SymbolFactory.Instance.GetAvailableFonts();</span><br><span class="line">  <span class="keyword">var</span> font = all_fonts.FirstOrDefault(f =&gt; f.fontName == <span class="string">&quot;Arial&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(font.fontName))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> textSym5 = SymbolFactory.Instance.ConstructTextSymbol(font.fontName);</span><br><span class="line">    <span class="comment">//or with a font+style</span></span><br><span class="line">    <span class="keyword">var</span> textSym6 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                                    font.fontName, font.fontStyles.First());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//overloads - font + color and size, etc</span></span><br><span class="line">  <span class="keyword">var</span> textSym7 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">                  ColorFactory.Instance.BlueRGB, <span class="number">14</span>, <span class="string">&quot;Times New Roman&quot;</span>, <span class="string">&quot;Italic&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//custom symbol - black stroke, red fill</span></span><br><span class="line">  <span class="keyword">var</span> poly_symbol = SymbolFactory.Instance.ConstructPolygonSymbol(</span><br><span class="line">    SymbolFactory.Instance.ConstructSolidFill(ColorFactory.Instance.RedRGB),</span><br><span class="line">    SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">var</span> textSym8 = SymbolFactory.Instance.ConstructTextSymbol(</span><br><span class="line">          poly_symbol, <span class="number">14</span>, <span class="string">&quot;Georgia&quot;</span>, <span class="string">&quot;Bold&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="为给定符号创建色板"><a href="#为给定符号创建色板" class="headerlink" title="为给定符号创建色板"></a>为给定符号创建色板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line">CIMSymbol symbol = SymbolFactory.Instance.ConstructPointSymbol(ColorFactory.Instance.GreenRGB, <span class="number">1.0</span>, SimpleMarkerStyle.Circle);</span><br><span class="line">  <span class="comment">//You can generate a swatch for a text symbols also.</span></span><br><span class="line">  <span class="keyword">var</span> si = <span class="keyword">new</span> SymbolStyleItem()</span><br><span class="line">  &#123;</span><br><span class="line">      Symbol = symbol,</span><br><span class="line">      PatchHeight = <span class="number">64</span>,</span><br><span class="line">      PatchWidth = <span class="number">64</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> si.PreviewImage;</span><br></pre></td></tr></table></figure>

<h3 id="查找符号"><a href="#查找符号" class="headerlink" title="查找符号"></a>查找符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: Run within QueuedTask.Run</span></span><br><span class="line"><span class="comment">//Get the selection</span></span><br><span class="line"><span class="keyword">var</span> selection = featureLayer.GetSelection();</span><br><span class="line">  <span class="comment">//Get the first Object ID</span></span><br><span class="line">  <span class="keyword">var</span> firstOID = selection.GetObjectIDs().FirstOrDefault();</span><br><span class="line">  <span class="comment">//Determine whether the layer&#x27;s renderer type supports symbol lookup.</span></span><br><span class="line">  <span class="keyword">if</span> (featureLayer.CanLookupSymbol())</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//Looks up the symbol for the corresponding feature identified by the object id.</span></span><br><span class="line">      <span class="keyword">var</span> symbol = featureLayer.LookupSymbol(firstOID, MapView.Active);</span><br><span class="line">      <span class="keyword">var</span> jSon = symbol.ToJson(); <span class="comment">//Create a JSON encoding of the symbol</span></span><br><span class="line">      <span class="comment">//Do something with symbol</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="符号搜索"><a href="#符号搜索" class="headerlink" title="符号搜索"></a>符号搜索</h2><h3 id="如何在样式中搜索特定项目"><a href="#如何在样式中搜索特定项目" class="headerlink" title="如何在样式中搜索特定项目"></a>如何在样式中搜索特定项目</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;SymbolStyleItem&gt; <span class="title">GetSymbolFromStyleAsync</span>(<span class="params">StyleProjectItem style, <span class="built_in">string</span> key</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Search for a specific point symbol in style</span></span><br><span class="line">    SymbolStyleItem item = (SymbolStyleItem)style.LookupItem(StyleItemType.PointSymbol, key);</span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索点符号"><a href="#如何在样式中搜索点符号" class="headerlink" title="如何在样式中搜索点符号"></a>如何在样式中搜索点符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetPointSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for point symbols</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.PointSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索线符号"><a href="#如何在样式中搜索线符号" class="headerlink" title="如何在样式中搜索线符号"></a>如何在样式中搜索线符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetLineSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for line symbols</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.LineSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索面符号"><a href="#如何在样式中搜索面符号" class="headerlink" title="如何在样式中搜索面符号"></a>如何在样式中搜索面符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;SymbolStyleItem&gt;&gt; GetPolygonSymbolsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for polygon symbols</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchSymbols(StyleItemType.PolygonSymbol, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索颜色"><a href="#如何在样式中搜索颜色" class="headerlink" title="如何在样式中搜索颜色"></a>如何在样式中搜索颜色</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;ColorStyleItem&gt;&gt; GetColorsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for colors</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchColors(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索色带"><a href="#如何在样式中搜索色带" class="headerlink" title="如何在样式中搜索色带"></a>如何在样式中搜索色带</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IList&lt;ColorRampStyleItem&gt;&gt; GetColorRampsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//StyleProjectItem can be &quot;ColorBrewer Schemes (RGB)&quot;, &quot;ArcGIS 2D&quot;...</span></span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for color ramps</span></span><br><span class="line">  <span class="comment">//Color Ramp searchString can be &quot;Spectral (7 Classes)&quot;, &quot;Pastel 1 (3 Classes)&quot;, &quot;Red-Gray (10 Classes)&quot;..</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> QueuedTask.Run(() =&gt; style.SearchColorRamps(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索指北针"><a href="#如何在样式中搜索指北针" class="headerlink" title="如何在样式中搜索指北针"></a>如何在样式中搜索指北针</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;NorthArrowStyleItem&gt;&gt; GetNorthArrowsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for north arrows</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchNorthArrows(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索比例尺"><a href="#如何在样式中搜索比例尺" class="headerlink" title="如何在样式中搜索比例尺"></a>如何在样式中搜索比例尺</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;ScaleBarStyleItem&gt;&gt; GetScaleBarsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for scale bars</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchScaleBars(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索标签展示位置"><a href="#如何在样式中搜索标签展示位置" class="headerlink" title="如何在样式中搜索标签展示位置"></a>如何在样式中搜索标签展示位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LabelPlacementStyleItem&gt;&gt; GetLabelPlacementsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Search for standard label placement</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLabelPlacements(StyleItemType.StandardLabelPlacement, searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索图例"><a href="#如何在样式中搜索图例" class="headerlink" title="如何在样式中搜索图例"></a>如何在样式中搜索图例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LegendStyleItem&gt;&gt; GetLegendFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLegends(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索图例项"><a href="#如何在样式中搜索图例项" class="headerlink" title="如何在样式中搜索图例项"></a>如何在样式中搜索图例项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;LegendItemStyleItem&gt;&gt; GetLegendItemsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchLegendItems(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索网格"><a href="#如何在样式中搜索网格" class="headerlink" title="如何在样式中搜索网格"></a>如何在样式中搜索网格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;GridStyleItem&gt;&gt; GetGridsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchGrids(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索地图整饰"><a href="#如何在样式中搜索地图整饰" class="headerlink" title="如何在样式中搜索地图整饰"></a>如何在样式中搜索地图整饰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;MapSurroundStyleItem&gt;&gt; GetMapSurroundsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchMapSurrounds(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索表格框"><a href="#如何在样式中搜索表格框" class="headerlink" title="如何在样式中搜索表格框"></a>如何在样式中搜索表格框</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;TableFrameStyleItem&gt;&gt; GetTableFramesFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchTableFrames(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何在样式中搜索表格框字段"><a href="#如何在样式中搜索表格框字段" class="headerlink" title="如何在样式中搜索表格框字段"></a>如何在样式中搜索表格框字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;IList&lt;TableFrameFieldStyleItem&gt;&gt; GetTableFrameFieldsFromStyleAsync(StyleProjectItem style, <span class="built_in">string</span> searchString)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (style == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; style.SearchTableFrameFields(searchString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="要素图层符号系统"><a href="#要素图层符号系统" class="headerlink" title="要素图层符号系统"></a>要素图层符号系统</h2><h3 id="如何为使用简单渲染器符号化的要素图层设置符号"><a href="#如何为使用简单渲染器符号化的要素图层设置符号" class="headerlink" title="如何为使用简单渲染器符号化的要素图层设置符号"></a>如何为使用简单渲染器符号化的要素图层设置符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">SetFeatureLayerSymbolAsync</span>(<span class="params">FeatureLayer ftrLayer, CIMSymbol symbolToApply</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (ftrLayer == <span class="literal">null</span> || symbolToApply == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get simple renderer from the feature layer</span></span><br><span class="line">    CIMSimpleRenderer currentRenderer = ftrLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">    <span class="keyword">if</span> (currentRenderer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbolToApply.SetRealWorldUnits(ftrLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Update the symbol of the current simple renderer</span></span><br><span class="line">    currentRenderer.Symbol = symbolToApply.MakeSymbolReference();</span><br><span class="line">    <span class="comment">//Update the feature layer renderer</span></span><br><span class="line">    ftrLayer.SetRenderer(currentRenderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式中的符号应用于要素图层"><a href="#如何将样式中的符号应用于要素图层" class="headerlink" title="如何将样式中的符号应用于要素图层"></a>如何将样式中的符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">SetFeatureLayerSymbolFromStyleItemAsync</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">           FeatureLayer ftrLayer, SymbolStyleItem symbolItem</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (ftrLayer == <span class="literal">null</span> || symbolItem == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentNullException();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get simple renderer from the feature layer</span></span><br><span class="line">    CIMSimpleRenderer currentRenderer = ftrLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line">    <span class="keyword">if</span> (currentRenderer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//Get symbol from the SymbolStyleItem</span></span><br><span class="line">    CIMSymbol symbol = symbolItem.Symbol;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbol.SetRealWorldUnits(ftrLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Update the symbol of the current simple renderer</span></span><br><span class="line">    currentRenderer.Symbol = symbol.MakeSymbolReference();</span><br><span class="line">    <span class="comment">//Update the feature layer renderer</span></span><br><span class="line">    ftrLayer.SetRenderer(currentRenderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式中的点符号应用于要素图层"><a href="#如何将样式中的点符号应用于要素图层" class="headerlink" title="如何将样式中的点符号应用于要素图层"></a>如何将样式中的点符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var map = MapView.Active.Map;</span></span><br><span class="line"><span class="comment">// if (map == null)</span></span><br><span class="line"><span class="comment">//        return;</span></span><br><span class="line"><span class="comment">// var pointFeatureLayer =</span></span><br><span class="line"><span class="comment">//       map.GetLayersAsFlattenedList()</span></span><br><span class="line"><span class="comment">//          .OfType&lt;FeatureLayer&gt;()</span></span><br><span class="line"><span class="comment">//         .Where(fl =&gt; fl.ShapeType == esriGeometryType.esriGeometryPoint);</span></span><br><span class="line"><span class="comment">//   await ApplySymbolToFeatureLayerAsync(pointFeatureLayer.FirstOrDefault(), &quot;Fire Station&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">ApplySymbolToFeatureLayerAsync</span>(<span class="params">FeatureLayer featureLayer, <span class="built_in">string</span> symbolName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the ArcGIS 2D System style from the Project</span></span><br><span class="line">    <span class="keyword">var</span> arcGIS2DStyle =</span><br><span class="line">  Project.Current.GetItems&lt;StyleProjectItem&gt;().FirstOrDefault(s =&gt; s.Name == <span class="string">&quot;ArcGIS 2D&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Search for the symbolName style items within the ArcGIS 2D style project item.</span></span><br><span class="line">    <span class="keyword">var</span> items = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    arcGIS2DStyle.SearchSymbols(StyleItemType.PointSymbol, symbolName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Gets the CIMSymbol</span></span><br><span class="line">    CIMSymbol symbol = items.FirstOrDefault().Symbol;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the renderer of the point feature layer</span></span><br><span class="line">    CIMSimpleRenderer renderer = featureLayer.GetRenderer() <span class="keyword">as</span> CIMSimpleRenderer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set symbol&#x27;s real world setting to be the same as that of the feature layer</span></span><br><span class="line">    symbol.SetRealWorldUnits(featureLayer.UsesRealWorldSymbolSizes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Apply the symbol to the feature layer&#x27;s current renderer</span></span><br><span class="line">    renderer.Symbol = symbol.MakeSymbolReference();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Appy the renderer to the feature layer</span></span><br><span class="line">    featureLayer.SetRenderer(renderer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将样式的色带应用于要素图层"><a href="#如何将样式的色带应用于要素图层" class="headerlink" title="如何将样式的色带应用于要素图层"></a>如何将样式的色带应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">ApplyColorRampAsync</span>(<span class="params">FeatureLayer featureLayer, List&lt;<span class="built_in">string</span>&gt; fields</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    StyleProjectItem style =</span><br><span class="line">        Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">            .FirstOrDefault(s =&gt; s.Name == <span class="string">&quot;ColorBrewer Schemes (RGB)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (style == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> colorRampList = <span class="keyword">await</span> QueuedTask.Run(() =&gt; </span><br><span class="line">                style.SearchColorRamps(<span class="string">&quot;Red-Gray (10 Classes)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (colorRampList == <span class="literal">null</span> || colorRampList.Count == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    CIMColorRamp cimColorRamp = <span class="literal">null</span>;</span><br><span class="line">    CIMRenderer renderer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        cimColorRamp = colorRampList[<span class="number">0</span>].ColorRamp;</span><br><span class="line">        <span class="keyword">var</span> rendererDef = <span class="keyword">new</span> UniqueValueRendererDefinition(fields, <span class="literal">null</span>, cimColorRamp);</span><br><span class="line">        renderer = featureLayer?.CreateRenderer(rendererDef);</span><br><span class="line">        featureLayer?.SetRenderer(renderer);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地图创作-注释片段"><a href="#地图创作-注释片段" class="headerlink" title="地图创作-注释片段"></a>地图创作-注释片段</h2><h3 id="创建注记构造工具-1"><a href="#创建注记构造工具-1" class="headerlink" title="创建注记构造工具"></a>创建注记构造工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//In your config.daml...set the categoryRefID</span></span><br><span class="line"><span class="comment">//&lt;tool id=&quot;...&quot; categoryRefID=&quot;esri_editing_construction_annotation&quot; caption=&quot;Create Anno&quot; ...&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Sketch type Point or Line or BezierLine in the constructor...</span></span><br><span class="line"><span class="comment">//internal class AnnoConstructionTool : MapTool  &#123;</span></span><br><span class="line"><span class="comment">//  public AnnoConstructionTool()  &#123;</span></span><br><span class="line"><span class="comment">//    IsSketchTool = true;</span></span><br><span class="line"><span class="comment">//    UseSnapping = true;</span></span><br><span class="line"><span class="comment">//    SketchType = SketchGeometryType.Point;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="keyword">override</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (CurrentTemplate == <span class="literal">null</span> || geometry == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an edit operation</span></span><br><span class="line">    <span class="keyword">var</span> createOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">    createOperation.Name = <span class="built_in">string</span>.Format(<span class="string">&quot;Create &#123;0&#125;&quot;</span>, CurrentTemplate.Layer.Name);</span><br><span class="line">    createOperation.SelectNewFeatures = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update the geometry point into a 2 point line</span></span><br><span class="line">    <span class="comment">//annotation needs at minimum a 2 point line for the text to be placed</span></span><br><span class="line">    <span class="built_in">double</span> tol = <span class="number">0.01</span>;</span><br><span class="line">    <span class="keyword">var</span> polyline = <span class="keyword">await</span> CreatePolylineFromPointAsync((MapPoint)geometry, tol);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Queue feature creation</span></span><br><span class="line">    createOperation.Create(CurrentTemplate, polyline);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute the operation</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> createOperation.ExecuteAsync();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> Task&lt;Polyline&gt; <span class="title">CreatePolylineFromPointAsync</span>(<span class="params">MapPoint pt, <span class="built_in">double</span> tolerance</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// create a polyline from a starting point</span></span><br><span class="line">    <span class="comment">//use a tolerance to construct the second point</span></span><br><span class="line">    MapPoint pt2 = MapPointBuilderEx.CreateMapPoint(pt.X + tolerance, pt.Y, pt.SpatialReference);</span><br><span class="line">        <span class="keyword">return</span> PolylineBuilderEx.CreatePolyline(<span class="keyword">new</span> List&lt;MapPoint&gt;() &#123; pt, pt2 &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在-1"><a href="#通过属性更新批注文本。警告：TEXTSTRING-Anno-属性必须存在-1" class="headerlink" title="通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在"></a>通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//See &quot;Change Annotation Text Graphic&quot; for an alternative if TEXTSTRING is missing from the schema</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//annoLayer is ~your~ Annotation layer...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// use the inspector methodology</span></span><br><span class="line">    <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">    insp.Load(annoLayer, oid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure TextString attribute exists.</span></span><br><span class="line">    <span class="comment">//It is not guaranteed to be in the schema</span></span><br><span class="line">    ArcGIS.Desktop.Editing.Attributes.Attribute att = insp.FirstOrDefault(a =&gt; a.FieldName == <span class="string">&quot;TEXTSTRING&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (att != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        insp[<span class="string">&quot;TEXTSTRING&quot;</span>] = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create and execute the edit operation</span></span><br><span class="line">        EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">        op.Name = <span class="string">&quot;Update annotation&quot;</span>;</span><br><span class="line">        op.Modify(insp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//OR using a Dictionary - again TEXTSTRING has to exist in the schema</span></span><br><span class="line">        <span class="comment">//Dictionary&lt;string, object&gt; newAtts = new Dictionary&lt;string, object&gt;();</span></span><br><span class="line">        <span class="comment">//newAtts.Add(&quot;TEXTSTRING&quot;, &quot;hello world&quot;);</span></span><br><span class="line">        <span class="comment">//op.Modify(annoLayer, oid, newAtts);</span></span><br><span class="line"></span><br><span class="line">        op.Execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="旋转或移动批注-1"><a href="#旋转或移动批注-1" class="headerlink" title="旋转或移动批注"></a>旋转或移动批注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Don&#x27;t use &#x27;Shape&#x27;....Shape is the bounding box of the annotation text. This is NOT what you want...</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//var insp = new Inspector();</span></span><br><span class="line">    <span class="comment">//insp.Load(annoLayer, oid);</span></span><br><span class="line">    <span class="comment">//var shape = insp[&quot;SHAPE&quot;] as Polygon;</span></span><br><span class="line">    <span class="comment">//...wrong shape...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Instead, we must get the TextGraphic from the anno feature.</span></span><br><span class="line">    <span class="comment">//The TextGraphic shape will be the anno baseline...</span></span><br><span class="line">    <span class="comment">//At 2.1 the only way to retrieve this textLine is to obtain the TextGraphic from the AnnotationFeature</span></span><br><span class="line">    QueryFilter qf = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">    &#123;</span><br><span class="line">        WhereClause = <span class="string">&quot;OBJECTID = 1&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//annoLayer is ~your~ Annotation layer</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rowCursor = annoLayer.Search(qf))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (rowCursor.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> annoFeature = rowCursor.Current <span class="keyword">as</span> </span><br><span class="line">            ArcGIS.Core.Data.Mapping.AnnotationFeature)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> graphic = annoFeature.GetGraphic();</span><br><span class="line">  <span class="keyword">var</span> textGraphic = graphic <span class="keyword">as</span> CIMTextGraphic;</span><br><span class="line">  <span class="keyword">var</span> textLine = textGraphic.Shape <span class="keyword">as</span> Polyline;</span><br><span class="line">  <span class="comment">// rotate the shape 90 degrees</span></span><br><span class="line">  <span class="keyword">var</span> origin = GeometryEngine.Instance.Centroid(textLine);</span><br><span class="line">  Geometry rotatedPolyline = GeometryEngine.Instance.Rotate(textLine, origin, System.Math.PI / <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//Move the line 5 &quot;units&quot; in the x and y direction</span></span><br><span class="line">  <span class="comment">//GeometryEngine.Instance.Move(textLine, 5, 5);</span></span><br><span class="line"></span><br><span class="line">  EditOperation op = <span class="keyword">new</span> EditOperation();</span><br><span class="line">  op.Name = <span class="string">&quot;Change annotation angle&quot;</span>;</span><br><span class="line">  op.Modify(annoLayer, oid, rotatedPolyline);</span><br><span class="line">  op.Execute();</span><br><span class="line">&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取批注文本图形"><a href="#获取批注文本图形" class="headerlink" title="获取批注文本图形"></a>获取批注文本图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> table = annoLayer.GetTable())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = table.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> af = rc.Current <span class="keyword">as</span> AnnotationFeature)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> graphic = af.GetGraphic();</span><br><span class="line">                <span class="keyword">var</span> textGraphic = graphic <span class="keyword">as</span> CIMTextGraphic;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Note: </span></span><br><span class="line">                <span class="comment">//var outline_geom = af.GetGraphicOutline(); </span></span><br><span class="line">                <span class="comment">//gets the anno text outline geometry...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取注释的轮廓几何图形"><a href="#获取注释的轮廓几何图形" class="headerlink" title="获取注释的轮廓几何图形"></a>获取注释的轮廓几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> annoLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                               .OfType&lt;AnnotationLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (annoLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//get the first annotation feature...</span></span><br><span class="line">    <span class="comment">//...assuming at least one feature gets selected</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> fc = annoLayer.GetFeatureClass())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = fc.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> af = rc.Current <span class="keyword">as</span> AnnotationFeature)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> outline_geom = af.GetGraphicOutline();</span><br><span class="line">                <span class="comment">//TODO - use the outline...</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//Note: </span></span><br><span class="line">                <span class="comment">//var graphic = annoFeature.GetGraphic(); </span></span><br><span class="line">                <span class="comment">//gets the CIMTextGraphic...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取注释的遮罩几何图形"><a href="#获取注释的遮罩几何图形" class="headerlink" title="获取注释的遮罩几何图形"></a>获取注释的遮罩几何图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> annoLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                         .OfType&lt;AnnotationLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (annoLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> mv = MapView.Active;</span><br><span class="line"></span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//get the first annotation feature...</span></span><br><span class="line">    <span class="comment">//...assuming at least one feature gets selected</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> fc = annoLayer.GetFeatureClass())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> rc = fc.Search())</span><br><span class="line">        &#123;</span><br><span class="line">            rc.MoveNext();</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> oid = row.GetObjectID();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Use DrawingOutlineType.BoundingEnvelope to retrieve a generalized</span></span><br><span class="line">                <span class="comment">//mask geometry or &quot;Box&quot;. The mask will be in the same SpatRef as the map.</span></span><br><span class="line">                <span class="comment">//The mask will be constructed using the anno class reference scale</span></span><br><span class="line">                <span class="comment">//At 2.x - var mask_geom = annoLayer.QueryDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> mask_geom = annoLayer.GetDrawingOutline(oid, mv, DrawingOutlineType.Exact);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="地图创作标记代码段"><a href="#地图创作标记代码段" class="headerlink" title="地图创作标记代码段"></a>地图创作标记代码段</h2><h3 id="获取活动地图的标注引擎-Maplex-或标准标注引擎"><a href="#获取活动地图的标注引擎-Maplex-或标准标注引擎" class="headerlink" title="获取活动地图的标注引擎 - Maplex 或标准标注引擎"></a>获取活动地图的标注引擎 - Maplex 或标准标注引擎</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the active map&#x27;s definition - CIMMap.</span></span><br><span class="line"><span class="keyword">var</span> cimMap = MapView.Active.Map.GetDefinition();</span><br><span class="line"><span class="comment">//Get the labeling engine from the map definition</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = cimMap.GeneralPlacementProperties;</span><br></pre></td></tr></table></figure>

<h3 id="将活动地图的标注引擎从标准更改为-Maplex，反之亦然"><a href="#将活动地图的标注引擎从标准更改为-Maplex，反之亦然" class="headerlink" title="将活动地图的标注引擎从标准更改为 Maplex，反之亦然"></a>将活动地图的标注引擎从标准更改为 Maplex，反之亦然</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the active map&#x27;s definition - CIMMap.</span></span><br><span class="line"><span class="keyword">var</span> cimMap = MapView.Active.Map.GetDefinition();</span><br><span class="line"><span class="comment">//Get the labeling engine from the map definition</span></span><br><span class="line"><span class="keyword">var</span> cimGeneralPlacement = cimMap.GeneralPlacementProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cimGeneralPlacement <span class="keyword">is</span> CIMMaplexGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">  <span class="comment">//Create a new standard label engine properties</span></span><br><span class="line">  <span class="keyword">var</span> cimStandardPlacementProperties = <span class="keyword">new</span> CIMStandardGeneralPlacementProperties();</span><br><span class="line">  <span class="comment">//Set the CIMMap&#x27;s GeneralPlacementProperties to the new label engine</span></span><br><span class="line">  cimMap.GeneralPlacementProperties = cimStandardPlacementProperties;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard labeling engine</span></span><br><span class="line">  <span class="comment">//Create a new Maplex label engine properties</span></span><br><span class="line">  <span class="keyword">var</span> cimMaplexGeneralPlacementProperties = <span class="keyword">new</span> CIMMaplexGeneralPlacementProperties();</span><br><span class="line">  <span class="comment">//Set the CIMMap&#x27;s GeneralPlacementProperties to the new label engine</span></span><br><span class="line">  cimMap.GeneralPlacementProperties = cimMaplexGeneralPlacementProperties;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Set the map&#x27;s definition</span></span><br><span class="line">MapView.Active.Map.SetDefinition(cimMap);</span><br></pre></td></tr></table></figure>

<h3 id="将文本符号应用于要素图层"><a href="#将文本符号应用于要素图层" class="headerlink" title="将文本符号应用于要素图层"></a>将文本符号应用于要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Set the label classes&#x27; symbol to the custom text symbol</span></span><br><span class="line"><span class="comment">//Refer to the ProSnippets-TextSymbols wiki page for help with creating custom text symbols.</span></span><br><span class="line"><span class="comment">//Example: var textSymbol = await CreateTextSymbolWithHaloAsync();</span></span><br><span class="line">theLabelClass.TextSymbol.Symbol = textSymbol;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">                                     <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="启用图层标注"><a href="#启用图层标注" class="headerlink" title="启用图层标注"></a>启用图层标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!featureLayer.IsLabelVisible)</span><br><span class="line">  <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">  featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="修改标签的位置-x2F-位置-点几何"><a href="#修改标签的位置-x2F-位置-点几何" class="headerlink" title="修改标签的位置&#x2F;位置 - 点几何"></a>修改标签的位置&#x2F;位置 - 点几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = </span><br><span class="line">   MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties) <span class="comment">//Current labeling engine is Standard labeling engine               </span></span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PointPlacementMethod = </span><br><span class="line">           StandardPointPlacementMethod.OnTopPoint;</span><br><span class="line"><span class="keyword">else</span>    <span class="comment">//Current labeling engine is Maplex labeling engine            </span></span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PointPlacementMethod = </span><br><span class="line">          MaplexPointPlacementMethod.CenteredOnPoint;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签的位置-x2F-位置-线几何"><a href="#修改标签的位置-x2F-位置-线几何" class="headerlink" title="修改标签的位置&#x2F;位置 - 线几何"></a>修改标签的位置&#x2F;位置 - 线几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = </span><br><span class="line">    MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard labeling engine</span></span><br><span class="line">  <span class="keyword">var</span> lineLablePosition = <span class="keyword">new</span> CIMStandardLineLabelPosition</span><br><span class="line">  &#123;</span><br><span class="line">    Perpendicular = <span class="literal">true</span>,</span><br><span class="line">    Parallel = <span class="literal">false</span>,</span><br><span class="line">    ProduceCurvedLabels = <span class="literal">false</span>,</span><br><span class="line">    Horizontal = <span class="literal">false</span>,</span><br><span class="line">    OnTop = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.LineLabelPosition = </span><br><span class="line">      lineLablePosition;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">&#123;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.LinePlacementMethod = </span><br><span class="line">                MaplexLinePlacementMethod.CenteredPerpendicularOnLine;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.LineFeatureType = </span><br><span class="line">                MaplexLineFeatureType.General;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//theLabelClass.MaplexLabelPlacementProperties.LinePlacementMethod = MaplexLinePlacementMethod.CenteredPerpendicularOnLine;</span></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标注的位置-x2F-位置-多边形几何"><a href="#修改标注的位置-x2F-位置-多边形几何" class="headerlink" title="修改标注的位置&#x2F;位置 - 多边形几何"></a>修改标注的位置&#x2F;位置 - 多边形几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Placement </span></span><br><span class="line"><span class="comment">//Check if the label engine is Maplex or standard.</span></span><br><span class="line">CIMGeneralPlacementProperties labelEngine = MapView.Active.Map.GetDefinition().GeneralPlacementProperties;</span><br><span class="line"><span class="keyword">if</span> (labelEngine <span class="keyword">is</span> CIMStandardGeneralPlacementProperties)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Standard Labeling engine</span></span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PolygonPlacementMethod = </span><br><span class="line">           StandardPolygonPlacementMethod.AlwaysHorizontal;</span><br><span class="line">  theLabelClass.StandardLabelPlacementProperties.PlaceOnlyInsidePolygon = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Current labeling engine is Maplex labeling engine</span></span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PolygonFeatureType = </span><br><span class="line">                           MaplexPolygonFeatureType.LandParcel;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.AvoidPolygonHoles = <span class="literal">true</span>;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.PolygonPlacementMethod = </span><br><span class="line">                      MaplexPolygonPlacementMethod.HorizontalInPolygon;</span><br><span class="line">  theLabelClass.MaplexLabelPlacementProperties.CanPlaceLabelOutsidePolygon = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br><span class="line">                                     <span class="comment">//set the label&#x27;s visiblity</span></span><br><span class="line">featureLayer.SetLabelVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用-MaplexEngine-修改标注的方向-点和面几何"><a href="#使用-MaplexEngine-修改标注的方向-点和面几何" class="headerlink" title="使用 MaplexEngine 修改标注的方向 - 点和面几何"></a>使用 MaplexEngine 修改标注的方向 - 点和面几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Orientation                 </span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.GraticuleAlignment = <span class="literal">true</span>;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.GraticuleAlignmentType = MaplexGraticuleAlignmentType.Curved;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-MaplexEngine-线几何修改标注的方向"><a href="#使用-MaplexEngine-线几何修改标注的方向" class="headerlink" title="使用 MaplexEngine - 线几何修改标注的方向"></a>使用 MaplexEngine - 线几何修改标注的方向</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Orientation</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.AlignLabelToLineDirection = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签旋转-点几何"><a href="#修改标签旋转-点几何" class="headerlink" title="修改标签旋转 - 点几何"></a>修改标签旋转 - 点几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Modify label Rotation</span></span><br><span class="line">CIMMaplexRotationProperties rotationProperties = <span class="keyword">new</span> CIMMaplexRotationProperties</span><br><span class="line">&#123;</span><br><span class="line">  Enable = <span class="literal">true</span>, <span class="comment">//Enable rotation</span></span><br><span class="line">  RotationField = <span class="string">&quot;ELEVATION&quot;</span>, <span class="comment">//Field that is used to define rotation angle</span></span><br><span class="line">  AdditionalAngle = <span class="number">15</span>, <span class="comment">//Additional rotation </span></span><br><span class="line">  RotationType = MaplexLabelRotationType.Arithmetic,</span><br><span class="line">  AlignmentType = MaplexRotationAlignmentType.Perpendicular,</span><br><span class="line">  AlignLabelToAngle = <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.RotationProperties = rotationProperties;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="在多边形几何中展开标注"><a href="#在多边形几何中展开标注" class="headerlink" title="在多边形几何中展开标注"></a>在多边形几何中展开标注</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//Spread Labels (words and characters to fill feature)</span></span><br><span class="line"><span class="comment">// Spread words to fill feature</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.SpreadWords = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//Spread Characters to a fixed limit of 50%</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.SpreadCharacters = <span class="literal">true</span>;</span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.MaximumCharacterSpacing = <span class="number">50.0</span>;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h3 id="修改标签的引出线锚点属性-多边形几何"><a href="#修改标签的引出线锚点属性-多边形几何" class="headerlink" title="修改标签的引出线锚点属性 - 多边形几何"></a>修改标签的引出线锚点属性 - 多边形几何</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: call within QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = featureLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//Get the label classes - we need the first one</span></span><br><span class="line"><span class="keyword">var</span> listLabelClasses = lyrDefn.LabelClasses.ToList();</span><br><span class="line"><span class="keyword">var</span> theLabelClass = listLabelClasses.FirstOrDefault();</span><br><span class="line"><span class="comment">//If TextSymbol is a callout the leader line anachor point can be modified</span></span><br><span class="line">theLabelClass.MaplexLabelPlacementProperties.PolygonAnchorPointType = MaplexAnchorPointType.Perimeter;</span><br><span class="line">lyrDefn.LabelClasses = listLabelClasses.ToArray(); <span class="comment">//Set the labelClasses back</span></span><br><span class="line">featureLayer.SetDefinition(lyrDefn); <span class="comment">//set the layer&#x27;s definition</span></span><br></pre></td></tr></table></figure>

<h1 id="地图创作-体素图层"><a href="#地图创作-体素图层" class="headerlink" title="地图创作-体素图层"></a>地图创作-体素图层</h1><h2 id="创建体素图层"><a href="#创建体素图层" class="headerlink" title="创建体素图层"></a>创建体素图层</h2><h3 id="检查是否可以创建体素图层"><a href="#检查是否可以创建体素图层" class="headerlink" title="检查是否可以创建体素图层"></a>检查是否可以创建体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map must be a local scene</span></span><br><span class="line"><span class="built_in">bool</span> canCreateVoxel = (MapView.Active.ViewingMode == MapViewingMode.SceneLocal);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (canCreateVoxel)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//TODO - use the voxel api methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建体素图层-1"><a href="#创建体素图层-1" class="headerlink" title="创建体素图层"></a>创建体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Must be a .NetCDF file for voxels</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">@&quot;C:\MyData\AirQuality_Redlands.nc&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> cim_connection = <span class="keyword">new</span> CIMVoxelDataConnection()</span><br><span class="line">&#123;</span><br><span class="line">    URI = url</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create a VoxelLayerCreationParams</span></span><br><span class="line"><span class="keyword">var</span> createParams = VoxelLayerCreationParams.Create(cim_connection);</span><br><span class="line">createParams.IsVisible = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Can also just use the path directly...</span></span><br><span class="line"><span class="comment">//var createParams = VoxelLayerCreationParams.Create(url);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use VoxelLayerCreationParams to enumerate the variables within</span></span><br><span class="line"><span class="comment">//the voxel</span></span><br><span class="line"><span class="keyword">var</span> variables = createParams.Variables;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> variable <span class="keyword">in</span> variables)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> line = <span class="string">$&quot;<span class="subst">&#123;variable.Variable&#125;</span>: <span class="subst">&#123;variable.DataType&#125;</span>, &quot;</span> +</span><br><span class="line">       <span class="string">$&quot;<span class="subst">&#123;variable.Description&#125;</span>, <span class="subst">&#123;variable.IsDefault&#125;</span>, <span class="subst">&#123;variable.IsSelected&#125;</span>&quot;</span>;</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(line);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Optional: set the default variable</span></span><br><span class="line">createParams.SetDefaultVariable(variables.Last());</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the layer - map must be a local scene</span></span><br><span class="line">VoxelLayer voxelLayer = LayerFactory.Instance.CreateLayer&lt;VoxelLayer&gt;(createParams, map);</span><br></pre></td></tr></table></figure>

<h2 id="体素图层设置和属性"><a href="#体素图层设置和属性" class="headerlink" title="体素图层设置和属性"></a>体素图层设置和属性</h2><h3 id="从目录中获取体素图层"><a href="#从目录中获取体素图层" class="headerlink" title="从目录中获取体素图层"></a>从目录中获取体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get selected layer if a voxel layer is selected</span></span><br><span class="line"><span class="keyword">var</span> voxelLayer = MapView.Active.GetSelectedLayers().OfType&lt;VoxelLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (voxelLayer == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//just get the first voxel layer in the TOC</span></span><br><span class="line">    voxelLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;VoxelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (voxelLayer == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作体素图层目录组"><a href="#操作体素图层目录组" class="headerlink" title="操作体素图层目录组"></a>操作体素图层目录组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ...</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Toggle containers and visibility in the TOC</span></span><br><span class="line">voxelLayer.SetExpanded(!voxelLayer.IsExpanded);</span><br><span class="line">voxelLayer.SetVisibility(!voxelLayer.IsVisible);</span><br><span class="line">voxelLayer.SetIsosurfaceContainerExpanded(!voxelLayer.IsIsosurfaceContainerExpanded);</span><br><span class="line">voxelLayer.SetIsosurfaceContainerVisibility(!voxelLayer.IsIsosurfaceContainerVisible);</span><br><span class="line">voxelLayer.SetSliceContainerExpanded(voxelLayer.IsSliceContainerExpanded);</span><br><span class="line">voxelLayer.SetSliceContainerVisibility(!voxelLayer.IsSliceContainerVisible);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(!voxelLayer.IsSectionContainerExpanded);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(!voxelLayer.IsSectionContainerVisible);</span><br><span class="line">voxelLayer.SetLockedSectionContainerExpanded(!voxelLayer.IsLockedSectionContainerExpanded);</span><br><span class="line">voxelLayer.SetLockedSectionContainerVisibility(!voxelLayer.IsLockedSectionContainerVisible);</span><br></pre></td></tr></table></figure>

<h3 id="从目录中获取-x2F-设置选定的体素资源"><a href="#从目录中获取-x2F-设置选定的体素资源" class="headerlink" title="从目录中获取&#x2F;设置选定的体素资源"></a>从目录中获取&#x2F;设置选定的体素资源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> surfaces = MapView.Active.GetSelectedIsosurfaces();</span><br><span class="line"><span class="comment">//set selected w/ MapView.Active.SelectVoxelIsosurface(isoSurface)</span></span><br><span class="line"><span class="keyword">var</span> slices = MapView.Active.GetSelectedSlices();</span><br><span class="line"><span class="comment">//set selected w/ MapView.Active.SelectVoxelSlice(slice)</span></span><br><span class="line"><span class="keyword">var</span> sections = MapView.Active.GetSelectedSections();</span><br><span class="line"><span class="comment">//set selected w/ MapView.Active.SelectVoxelSection(section)</span></span><br><span class="line"><span class="keyword">var</span> locked_sections = MapView.Active.GetSelectedLockedSections();</span><br><span class="line"><span class="comment">//set selected w/ MapView.Active.SelectVoxelLockedSection(locked_section)</span></span><br></pre></td></tr></table></figure>

<h3 id="更改体素可视化效果"><a href="#更改体素可视化效果" class="headerlink" title="更改体素可视化效果"></a>更改体素可视化效果</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Change the visualization to Volume</span></span><br><span class="line"><span class="comment">//e.g. for creating slices</span></span><br><span class="line">voxelLayer.SetVisualization(VoxelVisualization.Volume);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Change the visualization to Surface</span></span><br><span class="line"><span class="comment">//e.g. to create isosurfaces and sections</span></span><br><span class="line">voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br></pre></td></tr></table></figure>

<h3 id="照明属性、偏移、垂直夸大"><a href="#照明属性、偏移、垂直夸大" class="headerlink" title="照明属性、偏移、垂直夸大"></a>照明属性、偏移、垂直夸大</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Offset</span></span><br><span class="line"><span class="keyword">var</span> offset = voxelLayer.CartographicOffset;</span><br><span class="line"><span class="comment">//apply an offset</span></span><br><span class="line">voxelLayer.SetCartographicOffset(offset + <span class="number">100.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//VerticalExaggeration</span></span><br><span class="line"><span class="keyword">var</span> exaggeration = voxelLayer.VerticalExaggeration;</span><br><span class="line"><span class="comment">//apply an exaggeration</span></span><br><span class="line">voxelLayer.SetVerticalExaggeration(exaggeration + <span class="number">100.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Change the exaggeration mode to &quot;ScaleZ&quot; - corresponds to &#x27;Z-coordinates&#x27; </span></span><br><span class="line"><span class="comment">//on the Layer properties UI - must use the CIM</span></span><br><span class="line"><span class="keyword">var</span> def = voxelLayer.GetDefinition() <span class="keyword">as</span> CIMVoxelLayer;</span><br><span class="line">def.Layer3DProperties.ExaggerationMode = ExaggerationMode.ScaleZ;</span><br><span class="line"><span class="comment">//can set vertical exaggeration via the CIM also</span></span><br><span class="line"><span class="comment">//def.Layer3DProperties.VerticalExaggeration = exaggeration + 100.0;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//apply the change</span></span><br><span class="line">voxelLayer.SetDefinition(def);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Diffuse Lighting</span></span><br><span class="line"><span class="keyword">if</span> (!voxelLayer.IsDiffuseLightingEnabled)</span><br><span class="line">    voxelLayer.SetDiffuseLightingEnabled(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">var</span> diffuse = voxelLayer.DiffuseLighting;</span><br><span class="line"><span class="comment">//set Diffuse lighting to a value between 0 and 1</span></span><br><span class="line">voxelLayer.SetDiffuseLighting(<span class="number">0.5</span>); <span class="comment">//50%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Specular Lighting</span></span><br><span class="line"><span class="keyword">if</span> (!voxelLayer.IsSpecularLightingEnabled)</span><br><span class="line">    voxelLayer.SetSpecularLightingEnabled(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">var</span> specular = voxelLayer.SpecularLighting;</span><br><span class="line"><span class="comment">//set Diffuse lighting to a value between 0 and 1</span></span><br><span class="line">voxelLayer.SetSpecularLighting(<span class="number">0.5</span>); <span class="comment">//50%</span></span><br></pre></td></tr></table></figure>

<h3 id="获取体素体积维度"><a href="#获取体素体积维度" class="headerlink" title="获取体素体积维度"></a>获取体素体积维度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//At 2.x - var volume = voxelLayer.GetVolumeSize();</span></span><br><span class="line"><span class="comment">//var x_max = volume.Item1;</span></span><br><span class="line"><span class="comment">//var y_max = volume.Item2;</span></span><br><span class="line"><span class="comment">//var z_max = volume.Item3;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x_max = voxelLayer.GetVolumes().Max(v =&gt; v.GetVolumeSize().X);</span><br><span class="line"><span class="keyword">var</span> y_max = voxelLayer.GetVolumes().Max(v =&gt; v.GetVolumeSize().Y);</span><br><span class="line"><span class="keyword">var</span> z_max = voxelLayer.GetVolumes().Max(v =&gt; v.GetVolumeSize().Z);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the dimensions of just one volume</span></span><br><span class="line"><span class="keyword">var</span> dimensions = voxelLayer.GetVolumes().FirstOrDefault();</span><br><span class="line"><span class="comment">//Get the dimensions of the volume associated with the selected variable</span></span><br><span class="line"><span class="keyword">var</span> dimensions2 = voxelLayer.SelectedVariableProfile.Volume.GetVolumeSize();</span><br></pre></td></tr></table></figure>

<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="订阅对体素图层的更改"><a href="#订阅对体素图层的更改" class="headerlink" title="订阅对体素图层的更改"></a>订阅对体素图层的更改</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Mapping.Events.MapMemberPropertiesChangedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> voxel = args.MapMembers.OfType&lt;VoxelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (voxel == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//Anything changed on a voxel layer?</span></span><br><span class="line">    <span class="comment">//At 2.x - if (args.EventHints.Any(hint =&gt; hint == MapMemberEventHint.VoxelSelectedVariableProfileIndex))</span></span><br><span class="line">    <span class="keyword">if</span> (args.EventHints.Any(hint =&gt; hint == MapMemberEventHint.VoxelSelectedVariable))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Voxel variable profile selection changed</span></span><br><span class="line">        <span class="keyword">var</span> changed_variable_name = voxel.SelectedVariableProfile.Variable;</span><br><span class="line">        <span class="comment">//TODO respond to change, use QueuedTask if needed</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (args.EventHints.Any(hint =&gt; hint == MapMemberEventHint.Renderer))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//This can fire when a renderer becomes ready on a new layer; the selected variable profile</span></span><br><span class="line">        <span class="comment">//is changed; visualization is changed, etc.</span></span><br><span class="line">        <span class="keyword">var</span> renderer = voxel.SelectedVariableProfile.Renderer;</span><br><span class="line">        <span class="comment">//TODO respond to change, use QueuedTask if needed</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Mapping.Voxel.Events.VoxelAssetChangedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//An asset changed on a voxel layer</span></span><br><span class="line">    System.Diagnostics.Debug.WriteLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(<span class="string">&quot;VoxelAssetChangedEvent&quot;</span>);</span><br><span class="line">    System.Diagnostics.Debug.WriteLine(<span class="string">$&quot; AssetType: <span class="subst">&#123;args.AssetType&#125;</span>, ChangeType: <span class="subst">&#123;args.ChangeType&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args.ChangeType == VoxelAssetEventArgs.VoxelAssetChangeType.Remove)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//Get &quot;what&quot;changed - add or update</span></span><br><span class="line">    <span class="comment">//eg IsoSurface</span></span><br><span class="line">    VoxelLayer voxelLayer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (args.AssetType == VoxelAssetEventArgs.VoxelAssetType.Isosurface)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> surface = MapView.Active.GetSelectedIsosurfaces().FirstOrDefault();</span><br><span class="line">        <span class="comment">//there will only be one selected...</span></span><br><span class="line">        <span class="keyword">if</span> (surface != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            voxelLayer = surface.Layer;</span><br><span class="line">            <span class="comment">//TODO respond to change, use QueuedTask if needed</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Repeat for Slices, Sections, LockedSections...</span></span><br><span class="line">    <span class="comment">//GetSelectedSlices(), GetSelectedSections(), GetSelectedLockedSections();</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="变量配置文件-渲染器"><a href="#变量配置文件-渲染器" class="headerlink" title="变量配置文件 + 渲染器"></a>变量配置文件 + 渲染器</h2><h3 id="获取选定的变量配置文件"><a href="#获取选定的变量配置文件" class="headerlink" title="获取选定的变量配置文件"></a>获取选定的变量配置文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sel_profile = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the variable profile name</span></span><br><span class="line"><span class="keyword">var</span> profile_name = sel_profile.Variable;</span><br></pre></td></tr></table></figure>

<h3 id="更改选定的变量配置文件"><a href="#更改选定的变量配置文件" class="headerlink" title="更改选定的变量配置文件"></a>更改选定的变量配置文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> profiles = voxelLayer.GetVariableProfiles();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Select any profile as long as it is not the current selected variable</span></span><br><span class="line"><span class="keyword">var</span> not_selected = profiles.Where(p =&gt; p.Variable != sel_profile.Variable).ToList();</span><br><span class="line"><span class="keyword">if</span> (not_selected.Count() &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    voxelLayer.SetSelectedVariableProfile(not_selected.First());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取变量配置文件"><a href="#获取变量配置文件" class="headerlink" title="获取变量配置文件"></a>获取变量配置文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable_profiles = voxelLayer.GetVariableProfiles();</span><br></pre></td></tr></table></figure>

<h3 id="获取变量渲染器"><a href="#获取变量渲染器" class="headerlink" title="获取变量渲染器"></a>获取变量渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.GetVariableProfiles().First();</span><br><span class="line"><span class="keyword">var</span> renderer = variable.Renderer;</span><br><span class="line"><span class="keyword">if</span> (variable.DataType == VoxelVariableDataType.Continuous)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Renderer will be stretch</span></span><br><span class="line">    <span class="keyword">var</span> stretchRenderer = renderer <span class="keyword">as</span> CIMVoxelStretchRenderer;</span><br><span class="line">    <span class="comment">//access the renderer</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//VoxelVariableDataType.Discrete</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Renderer will be unique value</span></span><br><span class="line">    <span class="keyword">var</span> uvr = renderer <span class="keyword">as</span> CIMVoxelUniqueValueRenderer;</span><br><span class="line">    <span class="comment">//access the renderer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问拉伸渲染器的统计信息和颜色范围"><a href="#访问拉伸渲染器的统计信息和颜色范围" class="headerlink" title="访问拉伸渲染器的统计信息和颜色范围"></a>访问拉伸渲染器的统计信息和颜色范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the variable profile on which to access the data</span></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"><span class="comment">//or use ...voxelLayer.GetVariableProfiles()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Data range</span></span><br><span class="line"><span class="comment">//At 2.x - </span></span><br><span class="line"><span class="comment">//var min = variable.GetVariableStatistics().MinimumValue;</span></span><br><span class="line"><span class="comment">//var max = variable.GetVariableStatistics().MaximumValue;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> min = variable.Statistics.MinimumValue;</span><br><span class="line"><span class="keyword">var</span> max = variable.Statistics.MaximumValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Color range (Continuous only)</span></span><br><span class="line"><span class="built_in">double</span> color_min, color_max;</span><br><span class="line"><span class="keyword">if</span> (variable.DataType == VoxelVariableDataType.Continuous)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> renderer = variable.Renderer <span class="keyword">as</span> CIMVoxelStretchRenderer;</span><br><span class="line">    color_min = renderer.ColorRangeMin;</span><br><span class="line">    color_max = renderer.ColorRangeMax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改拉伸渲染器颜色范围"><a href="#更改拉伸渲染器颜色范围" class="headerlink" title="更改拉伸渲染器颜色范围"></a>更改拉伸渲染器颜色范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Typically, the default color range covers the most</span></span><br><span class="line"><span class="comment">//commonly occuring voxel values. Usually, the data</span></span><br><span class="line"><span class="comment">//range is much broader than the color range</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the variable profile whose renderer will be changed</span></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Check DataType</span></span><br><span class="line"><span class="keyword">if</span> (variable.DataType != VoxelVariableDataType.Continuous)</span><br><span class="line">    <span class="keyword">return</span>;<span class="comment">//must be continuous to have a Stretch Renderer...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> renderer = variable.Renderer <span class="keyword">as</span> CIMVoxelStretchRenderer;</span><br><span class="line"><span class="keyword">var</span> color_min = renderer.ColorRangeMin;</span><br><span class="line"><span class="keyword">var</span> color_max = renderer.ColorRangeMax;</span><br><span class="line"><span class="comment">//increase range by 10% of the current difference</span></span><br><span class="line"><span class="keyword">var</span> dif = (color_max - color_min) * <span class="number">0.05</span>;</span><br><span class="line">color_min -= dif;</span><br><span class="line">color_max += dif;</span><br><span class="line"></span><br><span class="line"><span class="comment">//make sure we do not exceed data range</span></span><br><span class="line"><span class="comment">//At 2.x - </span></span><br><span class="line"><span class="comment">//if (color_min &lt; variable.GetVariableStatistics().MinimumValue)</span></span><br><span class="line"><span class="comment">//    color_min = variable.GetVariableStatistics().MinimumValue;</span></span><br><span class="line"><span class="comment">//if (color_max &gt; variable.GetVariableStatistics().MaximumValue)</span></span><br><span class="line"><span class="comment">//    color_max = variable.GetVariableStatistics().MaximumValue;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (color_min &lt; variable.Statistics.MinimumValue)</span><br><span class="line">    color_min = variable.Statistics.MinimumValue;</span><br><span class="line"><span class="keyword">if</span> (color_max &gt; variable.Statistics.MaximumValue)</span><br><span class="line">    color_max = variable.Statistics.MaximumValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">//variable.Statistics.MinimumValue</span></span><br><span class="line">renderer.ColorRangeMin = color_min;</span><br><span class="line">renderer.ColorRangeMax = color_max;</span><br><span class="line"></span><br><span class="line"><span class="comment">//apply changes</span></span><br><span class="line">variable.SetRenderer(renderer);</span><br></pre></td></tr></table></figure>

<h3 id="更改-CIMVoxelColorUniqueValue-类的可见性"><a href="#更改-CIMVoxelColorUniqueValue-类的可见性" class="headerlink" title="更改 CIMVoxelColorUniqueValue 类的可见性"></a>更改 CIMVoxelColorUniqueValue 类的可见性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the variable profile whose renderer will be changed</span></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Check DataType</span></span><br><span class="line"><span class="keyword">if</span> (variable.DataType != VoxelVariableDataType.Discrete)</span><br><span class="line">    <span class="keyword">return</span>;<span class="comment">//must be Discrete to have a UV Renderer...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> renderer = variable.Renderer <span class="keyword">as</span> CIMVoxelUniqueValueRenderer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//A CIMVoxelUniqueValueRenderer consists of a collection of</span></span><br><span class="line"><span class="comment">//CIMVoxelColorUniqueValue classes - one per discrete value</span></span><br><span class="line"><span class="comment">//in the associated variable profile value array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the first class</span></span><br><span class="line"><span class="keyword">var</span> classes = renderer.Classes.ToList();</span><br><span class="line"><span class="keyword">var</span> unique_value_class = classes.First();</span><br><span class="line"><span class="comment">//Set its visibility off</span></span><br><span class="line">unique_value_class.Visible = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Apply the change to the renderer</span></span><br><span class="line">renderer.Classes = classes.ToArray();</span><br><span class="line"><span class="comment">//apply the changes</span></span><br><span class="line">variable.SetRenderer(renderer);</span><br></pre></td></tr></table></figure>

<h2 id="等值面"><a href="#等值面" class="headerlink" title="等值面"></a>等值面</h2><h3 id="检查变量的最大等值面数"><a href="#检查变量的最大等值面数" class="headerlink" title="检查变量的最大等值面数"></a>检查变量的最大等值面数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.GetVariableProfiles().First();</span><br><span class="line"><span class="keyword">var</span> max = variable.MaxNumberOfIsosurfaces;</span><br><span class="line"><span class="keyword">if</span> (max &gt;= variable.GetIsosurfaces().Count)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//no more surfaces can be created on this variable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查变量的数据类型"><a href="#检查变量的数据类型" class="headerlink" title="检查变量的数据类型"></a>检查变量的数据类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.GetVariableProfiles().First();</span><br><span class="line"><span class="keyword">if</span> (variable.DataType != VoxelVariableDataType.Continuous)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//No iso surfaces</span></span><br><span class="line">    <span class="comment">//Iso surface can only be created for VoxelVariableDataType.Continuous</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查CanCreateIsoSurface"><a href="#检查CanCreateIsoSurface" class="headerlink" title="检查CanCreateIsoSurface"></a>检查CanCreateIsoSurface</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Visualization must be surface or CanCreateIsosurface will return</span></span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the variable profile on which to create the iso surface</span></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"><span class="comment">//or use ...voxelLayer.GetVariableProfiles().First(....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// o Visualization must be Surface</span></span><br><span class="line"><span class="comment">// o Variable profile must be continuous</span></span><br><span class="line"><span class="comment">// o Variable MaxNumberofIsoSurfaces must not have been reached...</span></span><br><span class="line"><span class="keyword">if</span> (variable.CanCreateIsosurface)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Do the create</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建等值面"><a href="#创建等值面" class="headerlink" title="创建等值面"></a>创建等值面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Visualization must be surface</span></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the variable profile on which to create the iso surface</span></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">// o Visualization must be Surface</span></span><br><span class="line"><span class="comment">// o Variable profile must be continuous</span></span><br><span class="line"><span class="comment">// o Variable MaxNumberofIsoSurfaces must not have been reached...</span></span><br><span class="line"><span class="keyword">if</span> (variable.CanCreateIsosurface)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Note: calling create if variable.CanCreateIsosurface == false</span></span><br><span class="line">    <span class="comment">//will trigger an InvalidOperationException</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Specify a voxel value for the iso surface</span></span><br><span class="line">    <span class="comment">//At 2.x - </span></span><br><span class="line">    <span class="comment">//var min = variable.GetVariableStatistics().MinimumValue;</span></span><br><span class="line">    <span class="comment">//var max = variable.GetVariableStatistics().MaximumValue;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> min = variable.Statistics.MinimumValue;</span><br><span class="line">    <span class="keyword">var</span> max = variable.Statistics.MaximumValue;</span><br><span class="line">    <span class="keyword">var</span> mid = (max + min) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//color range (i.e. values that are being rendered)</span></span><br><span class="line">    <span class="keyword">var</span> renderer = variable.Renderer <span class="keyword">as</span> CIMVoxelStretchRenderer;</span><br><span class="line">    <span class="keyword">var</span> color_min = renderer.ColorRangeMin;</span><br><span class="line">    <span class="keyword">var</span> color_max = renderer.ColorRangeMax;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//keep the surface within the current color range (or it</span></span><br><span class="line">    <span class="comment">//won&#x27;t render)</span></span><br><span class="line">    <span class="keyword">if</span> (mid &lt; color_min)</span><br><span class="line">    &#123;</span><br><span class="line">        mid = renderer.ColorRangeMin;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (mid &gt; color_max)</span><br><span class="line">    &#123;</span><br><span class="line">        mid = renderer.ColorRangeMax;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Create the iso surface</span></span><br><span class="line">    <span class="keyword">var</span> suffix = Math.Truncate(mid * <span class="number">100</span>) / <span class="number">100</span>;</span><br><span class="line">    variable.CreateIsosurface(<span class="keyword">new</span> IsosurfaceDefinition()</span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">$&quot;Surface <span class="subst">&#123;suffix&#125;</span>&quot;</span>,</span><br><span class="line">        Value = mid,</span><br><span class="line">        IsVisible = <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何更改等值面上的值和颜色"><a href="#如何更改等值面上的值和颜色" class="headerlink" title="如何更改等值面上的值和颜色"></a>如何更改等值面上的值和颜色</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Change the color of the first surface for the given profile</span></span><br><span class="line"><span class="keyword">var</span> surface = variable.GetIsosurfaces().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (surface != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">        voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Change the iso surface voxel value</span></span><br><span class="line">    surface.Value = surface.Value * <span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//get a random color</span></span><br><span class="line">    <span class="keyword">var</span> count = <span class="keyword">new</span> Random().Next(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">var</span> colors = ColorFactory.Instance.GenerateColorsFromColorRamp(</span><br><span class="line">        ((CIMVoxelStretchRenderer)variable.Renderer).ColorRamp, count);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> idx = <span class="keyword">new</span> Random().Next(<span class="number">0</span>, count - <span class="number">1</span>);</span><br><span class="line">    surface.Color = colors[idx];</span><br><span class="line">    <span class="comment">//set the custom color flag true to lock the color</span></span><br><span class="line">    <span class="comment">//locking the color prevents it from being changed if the</span></span><br><span class="line">    <span class="comment">//renderer color range or color theme is updated</span></span><br><span class="line">    surface.IsCustomColor = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//update the surface</span></span><br><span class="line">    variable.UpdateIsosurface(surface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将-Isourface-颜色更改回默认值"><a href="#将-Isourface-颜色更改回默认值" class="headerlink" title="将 Isourface 颜色更改回默认值"></a>将 Isourface 颜色更改回默认值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"><span class="comment">//var variable = ...;</span></span><br><span class="line"><span class="comment">//var surface = ...;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (surface.IsCustomColor)</span><br><span class="line">&#123;</span><br><span class="line">    surface.Color = variable.GetIsosurfaceColor((<span class="built_in">double</span>)surface.Value);</span><br><span class="line">    surface.IsCustomColor = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//update the surface</span></span><br><span class="line">    variable.UpdateIsosurface(surface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除等值面"><a href="#删除等值面" class="headerlink" title="删除等值面"></a>删除等值面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variable = voxelLayer.SelectedVariableProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//delete the last surface</span></span><br><span class="line"><span class="keyword">var</span> last_surface = variable.GetIsosurfaces().LastOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (last_surface != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    variable.DeleteIsosurface(last_surface);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//delete all the surfaces</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> surface <span class="keyword">in</span> variable.GetIsosurfaces())</span><br><span class="line">    variable.DeleteIsosurface(surface);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Optional - set visualization back to Volume</span></span><br><span class="line"><span class="keyword">if</span> (variable.GetIsosurfaces().Count() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Volume);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="片"><a href="#片" class="headerlink" title="片"></a>片</h2><h3 id="获取切片集合"><a href="#获取切片集合" class="headerlink" title="获取切片集合"></a>获取切片集合</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var slices = voxelLayer.GetSlices();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the slices currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> slices = volume.GetSlices();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Do something... e.g. make them visible</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> slice <span class="keyword">in</span> slices)</span><br><span class="line">&#123;</span><br><span class="line">    slice.IsVisible = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//at 2.x - voxelLayer.UpdateSlice(slice);</span></span><br><span class="line">    volume.UpdateSlice(slice);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//expand the slice container and make sure container visibility is true</span></span><br><span class="line">voxelLayer.SetSliceContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSliceContainerVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取切片"><a href="#获取切片" class="headerlink" title="获取切片"></a>获取切片</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x -</span></span><br><span class="line"><span class="comment">//var slice = voxelLayer.GetSlices().FirstOrDefault();</span></span><br><span class="line"><span class="comment">//var slice2 = voxelLayer.GetSlices().First(s =&gt; s.Id == my_slice_id);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the slices currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> slice = volume.GetSlices().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> slice2 = volume.GetSlices().First(s =&gt; s.Id == my_slice_id);</span><br></pre></td></tr></table></figure>

<h3 id="获取目录中的选定切片"><a href="#获取目录中的选定切片" class="headerlink" title="获取目录中的选定切片"></a>获取目录中的选定切片</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// cref: ArcGIS.Desktop.Mapping.MapView.GetSelectedSlices()</span></span><br><span class="line"><span class="comment">// cref: ArcGIS.Desktop.Mapping.Voxel.SliceDefinition</span></span><br><span class="line"><span class="keyword">var</span> slice = MapView.Active?.GetSelectedSlices()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (slice != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取目录中所选切片的体素图层"><a href="#获取目录中所选切片的体素图层" class="headerlink" title="获取目录中所选切片的体素图层"></a>获取目录中所选切片的体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line">VoxelLayer voxelLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> slice = MapView.Active?.GetSelectedSlices()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (slice != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    voxelLayer = slice.Layer;</span><br><span class="line">    <span class="comment">//TODO - use the layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建切片"><a href="#创建切片" class="headerlink" title="创建切片"></a>创建切片</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Volume)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Volume);</span><br><span class="line">voxelLayer.SetSliceContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSliceContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//To stop the Voxel Exploration Dockpane activating use:</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//This is useful if u have your own dockpane currently activated...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volumeSize = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the slices currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Orientation 90 degrees (West), Tilt 0.0 (vertical)</span></span><br><span class="line"><span class="comment">//Convert to a normal</span></span><br><span class="line"><span class="keyword">var</span> normal = voxelLayer.GetNormal(<span class="number">90</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the slice at the voxel mid-point. VoxelPosition</span></span><br><span class="line"><span class="comment">//is specified in voxel-space coordinates</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - </span></span><br><span class="line"><span class="comment">//voxelLayer.CreateSlice(new SliceDefinition()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    Name = &quot;Middle Slice&quot;,</span></span><br><span class="line"><span class="comment">//    VoxelPosition = new Coordinate3D(volume.Item1 / 2, volume.Item2 / 2, volume.Item3 / 2),</span></span><br><span class="line"><span class="comment">//    Normal = normal,</span></span><br><span class="line"><span class="comment">//    IsVisible = true</span></span><br><span class="line"><span class="comment">//&#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the slice on the respective volume</span></span><br><span class="line">volume.CreateSlice(<span class="keyword">new</span> SliceDefinition()</span><br><span class="line">&#123;</span><br><span class="line">    Name = <span class="string">&quot;Middle Slice&quot;</span>,</span><br><span class="line">    VoxelPosition = <span class="keyword">new</span> Coordinate3D(volumeSize.X / <span class="number">2</span>, volumeSize.Y / <span class="number">2</span>, volumeSize.Z / <span class="number">2</span>),</span><br><span class="line">    Normal = normal,</span><br><span class="line">    IsVisible = <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//reset if needed...</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="更改切片的倾斜度"><a href="#更改切片的倾斜度" class="headerlink" title="更改切片的倾斜度"></a>更改切片的倾斜度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//To stop the Voxel Exploration Dockpane activating use:</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//This is useful if u have your own dockpane currently activated...</span></span><br><span class="line"><span class="comment">//Normally, it would be set in your dockpane</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Volume)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Volume);</span><br><span class="line">voxelLayer.SetSliceContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var slice = voxelLayer.GetSlices().First(s =&gt; s.Name == &quot;Change Tilt Slice&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the slices currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> slice = volume.GetSlices().First(s =&gt; s.Name == <span class="string">&quot;Change Tilt Slice&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="built_in">double</span> orientation, <span class="built_in">double</span> tilt) = voxelLayer.GetOrientationAndTilt(slice.Normal);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Convert orientation and tilt to a normal</span></span><br><span class="line">slice.Normal = voxelLayer.GetNormal(orientation, <span class="number">45.0</span>);</span><br><span class="line"><span class="comment">//At 2.x - voxelLayer.UpdateSlice(slice);</span></span><br><span class="line">volume.UpdateSlice(slice);</span><br><span class="line"></span><br><span class="line"><span class="comment">//reset if needed...Normally this might be when your dockpane</span></span><br><span class="line"><span class="comment">//was de-activated (ie &quot;closed&quot;)</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="删除切片"><a href="#删除切片" class="headerlink" title="删除切片"></a>删除切片</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x</span></span><br><span class="line"><span class="comment">//var last_slice = voxelLayer.GetSlices().LastOrDefault();</span></span><br><span class="line"><span class="comment">//   if (last_slice != null)</span></span><br><span class="line"><span class="comment">//     voxelLayer.DeleteSlice(last_slice);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   //Delete all slices</span></span><br><span class="line"><span class="comment">//   var slices = voxelLayer.GetSlices();</span></span><br><span class="line"><span class="comment">//   foreach (var slice in slices)</span></span><br><span class="line"><span class="comment">//     voxelLayer.DeleteSlice(slice);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the slices currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> last_slice = volume.GetSlices().LastOrDefault();</span><br><span class="line"><span class="keyword">if</span> (last_slice != <span class="literal">null</span>)</span><br><span class="line">    volume.DeleteSlice(last_slice);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Delete all slices</span></span><br><span class="line"><span class="keyword">var</span> slices = volume.GetSlices();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> slice <span class="keyword">in</span> slices)</span><br><span class="line">    volume.DeleteSlice(slice);</span><br></pre></td></tr></table></figure>

<h2 id="部分"><a href="#部分" class="headerlink" title="部分"></a>部分</h2><h3 id="获取部分"><a href="#获取部分" class="headerlink" title="获取部分"></a>获取部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x -</span></span><br><span class="line"><span class="comment">//var section = voxelLayer.GetSections().FirstOrDefault();</span></span><br><span class="line"><span class="comment">//var section2 = voxelLayer.GetSections().First(sec =&gt; sec.Id == my_section_id);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> section = volume.GetSections().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> section2 = volume.GetSections().First(sec =&gt; sec.ID == my_section_id);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前部分集合"><a href="#获取当前部分集合" class="headerlink" title="获取当前部分集合"></a>获取当前部分集合</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var sections = voxelLayer.GetSections();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections currently in the TOC</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> sections = volume.GetSections();</span><br></pre></td></tr></table></figure>

<h3 id="获取目录中的选定部分"><a href="#获取目录中的选定部分" class="headerlink" title="获取目录中的选定部分"></a>获取目录中的选定部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> section = MapView.Active?.GetSelectedSections()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (section != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取目录中所选部分的体素图层"><a href="#获取目录中所选部分的体素图层" class="headerlink" title="获取目录中所选部分的体素图层"></a>获取目录中所选部分的体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line">VoxelLayer voxelLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> section = MapView.Active?.GetSelectedSections()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (section != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    voxelLayer = section.Layer;</span><br><span class="line">    <span class="comment">//TODO - use the layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在体素中点处创建一个剖面"><a href="#在体素中点处创建一个剖面" class="headerlink" title="在体素中点处创建一个剖面"></a>在体素中点处创建一个剖面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//To stop the Voxel Exploration Dockpane activating use:</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//This is useful if u have your own dockpane currently activated...</span></span><br><span class="line"><span class="comment">//Normally, it would be set in your dockpane</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a section that cuts the volume in two on the vertical plane</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volume = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Orientation 90 degrees (due West), Tilt 0 degrees</span></span><br><span class="line"><span class="keyword">var</span> normal = voxelLayer.GetNormal(<span class="number">90</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Position must be specified in voxel space</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x -</span></span><br><span class="line"><span class="comment">//voxelLayer.CreateSection(new SectionDefinition()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    Name = &quot;Middle Section&quot;,</span></span><br><span class="line"><span class="comment">//    VoxelPosition = new Coordinate3D(volume.Item1 / 2, volume.Item2 / 2, volume.Item3 / 2),</span></span><br><span class="line"><span class="comment">//    Normal = normal,</span></span><br><span class="line"><span class="comment">//    IsVisible = true</span></span><br><span class="line"><span class="comment">//&#125;);</span></span><br><span class="line">volume.CreateSection(<span class="keyword">new</span> SectionDefinition()</span><br><span class="line">&#123;</span><br><span class="line">    Name = <span class="string">&quot;Middle Section&quot;</span>,</span><br><span class="line">    VoxelPosition = <span class="keyword">new</span> Coordinate3D(volumeSize.X / <span class="number">2</span>, volumeSize.Y / <span class="number">2</span>, volumeSize.Z / <span class="number">2</span>),</span><br><span class="line">    Normal = normal,</span><br><span class="line">    IsVisible = <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//reset if needed...Normally this might be when your dockpane</span></span><br><span class="line"><span class="comment">//was de-activated (ie &quot;closed&quot;)</span></span><br><span class="line">voxelLayer.AutoShowExploreDockPane = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建水平剖面"><a href="#创建水平剖面" class="headerlink" title="创建水平剖面"></a>创建水平剖面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a section that cuts the volume in two on the horizontal plane</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volumeSize = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Or use normal (0, 0, 1) or (0, 0, -1)...</span></span><br><span class="line"><span class="keyword">var</span> horz_section = SectionDefinition.CreateHorizontalSectionDefinition();</span><br><span class="line"></span><br><span class="line">horz_section.Name = <span class="string">&quot;Horizontal Section&quot;</span>;</span><br><span class="line">horz_section.IsVisible = <span class="literal">true</span>;</span><br><span class="line">horz_section.VoxelPosition = <span class="keyword">new</span> Coordinate3D(volumeSize.X / <span class="number">2</span>, volumeSize.Y / <span class="number">2</span>, volumeSize.Z / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - voxelLayer.CreateSection(horz_section);</span></span><br><span class="line">volume.CreateSection(horz_section);</span><br></pre></td></tr></table></figure>

<h3 id="以圆形模式创建截面"><a href="#以圆形模式创建截面" class="headerlink" title="以圆形模式创建截面"></a>以圆形模式创建截面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volumeSize = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//180 degrees orientation is due South. 90 degrees orientation is due west.</span></span><br><span class="line"><span class="keyword">var</span> south = <span class="number">180.0</span>;</span><br><span class="line"><span class="keyword">var</span> num_sections = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">var</span> spacing = <span class="number">1</span> / (<span class="built_in">double</span>)num_sections;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a section every nth degree of orientation. Each section</span></span><br><span class="line"><span class="comment">//bisects the middle of the voxel</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> s = <span class="number">0</span>; s &lt; num_sections; s++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> orientation = south * (s * spacing);</span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//voxelLayer.CreateSection(new SectionDefinition()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    Name = $&quot;Circle &#123;s + 1&#125;&quot;,</span></span><br><span class="line">    <span class="comment">//    VoxelPosition = new Coordinate3D(volumeSize.Item1 / 2, volumeSize.Item2 / 2, volumeSize.Item3 / 2),</span></span><br><span class="line">    <span class="comment">//    Normal = voxelLayer.GetNormal(orientation, 0.0),</span></span><br><span class="line">    <span class="comment">//    IsVisible = true</span></span><br><span class="line">    <span class="comment">//&#125;);</span></span><br><span class="line"></span><br><span class="line">    volume.CreateSection(<span class="keyword">new</span> SectionDefinition()</span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">$&quot;Circle <span class="subst">&#123;s + <span class="number">1</span>&#125;</span>&quot;</span>,</span><br><span class="line">        VoxelPosition = <span class="keyword">new</span> Coordinate3D(volumeSize.X / <span class="number">2</span>, volumeSize.Y / <span class="number">2</span>, volumeSize.Z / <span class="number">2</span>),</span><br><span class="line">        Normal = voxelLayer.GetNormal(orientation, <span class="number">0.0</span>),</span><br><span class="line">        IsVisible = <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建将体素平分的部分"><a href="#创建将体素平分的部分" class="headerlink" title="创建将体素平分的部分"></a>创建将体素平分的部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volumeSize = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make three Normals - each is a Unit Vector (x, y, z)</span></span><br><span class="line"><span class="keyword">var</span> north_south = <span class="keyword">new</span> Coordinate3D(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> east_west = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> horizontal = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//The two verticals bisect the x,y plane. The horizontal normal bisects</span></span><br><span class="line"><span class="comment">//the Z plane.</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> normal <span class="keyword">in</span> <span class="keyword">new</span> List&lt;Coordinate3D&gt; &#123; north_south, east_west, horizontal &#125;)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//voxelLayer.CreateSection(new SectionDefinition()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    Name = $&quot;Cross &#123;++n&#125;&quot;,</span></span><br><span class="line">    <span class="comment">//    VoxelPosition = new Coordinate3D(volumeSize.Item1 / 2, volumeSize.Item2 / 2, volumeSize.Item3 / 2),</span></span><br><span class="line">    <span class="comment">//    Normal = normal,</span></span><br><span class="line">    <span class="comment">//    IsVisible = true</span></span><br><span class="line">    <span class="comment">//&#125;);</span></span><br><span class="line"></span><br><span class="line">    volume.CreateSection(<span class="keyword">new</span> SectionDefinition()</span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">$&quot;Cross <span class="subst">&#123;++n&#125;</span>&quot;</span>,</span><br><span class="line">        VoxelPosition = <span class="keyword">new</span> Coordinate3D(volumeSize.X / <span class="number">2</span>, volumeSize.Y / <span class="number">2</span>, volumeSize.Z / <span class="number">2</span>),</span><br><span class="line">        Normal = normal,</span><br><span class="line">        IsVisible = <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在体素对角线上创建截面"><a href="#在体素对角线上创建截面" class="headerlink" title="在体素对角线上创建截面"></a>在体素对角线上创建截面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var volumeSize = voxelLayer.GetVolumeSize();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> volumeSize = volume.GetVolumeSize();</span><br><span class="line"></span><br><span class="line"><span class="comment">//make a diagonal across the voxel</span></span><br><span class="line"><span class="keyword">var</span> voxel_pos = <span class="keyword">new</span> Coordinate3D(<span class="number">0</span>, <span class="number">0</span>, volumeSize.Z);</span><br><span class="line"><span class="keyword">var</span> voxel_pos_ur = <span class="keyword">new</span> Coordinate3D(volumeSize.X, volumeSize.Y, volumeSize.Z);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lineBuilder = <span class="keyword">new</span> LineBuilderEx(voxel_pos, voxel_pos_ur, <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">var</span> diagonal = PolylineBuilderEx.CreatePolyline(lineBuilder.ToSegment());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num_sections = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">var</span> spacing = <span class="number">1</span> / (<span class="built_in">double</span>)num_sections;</span><br><span class="line"></span><br><span class="line"><span class="comment">//change as needed</span></span><br><span class="line"><span class="keyword">var</span> orientation = <span class="number">20.0</span>; <span class="comment">//(approx NNW)</span></span><br><span class="line"><span class="keyword">var</span> tilt = <span class="number">-15.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> normal = voxelLayer.GetNormal(orientation, tilt);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> s = <span class="number">0</span>; s &lt; num_sections; s++)</span><br><span class="line">&#123;</span><br><span class="line">    Coordinate2D end_pt = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//position each section evenly spaced along the diagonal</span></span><br><span class="line">        <span class="keyword">var</span> segments = <span class="keyword">new</span> List&lt;Segment&gt;() <span class="keyword">as</span> ICollection&lt;Segment&gt;;</span><br><span class="line">        <span class="keyword">var</span> part = GeometryEngine.Instance.GetSubCurve3D(</span><br><span class="line">                diagonal, <span class="number">0.0</span>, s * spacing, AsRatioOrLength.AsRatio);</span><br><span class="line">        part.GetAllSegments(<span class="keyword">ref</span> segments);</span><br><span class="line">        end_pt = segments.First().EndCoordinate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//voxelLayer.CreateSection(new SectionDefinition()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    Name = $&quot;Diagonal &#123;s + 1&#125;&quot;,</span></span><br><span class="line">    <span class="comment">//    VoxelPosition = new Coordinate3D(end_pt.X, end_pt.Y, volumeSize.Item3),</span></span><br><span class="line">    <span class="comment">//    Normal = normal,</span></span><br><span class="line">    <span class="comment">//    IsVisible = true</span></span><br><span class="line">    <span class="comment">//&#125;);</span></span><br><span class="line"></span><br><span class="line">    volume.CreateSection(<span class="keyword">new</span> SectionDefinition()</span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">$&quot;Diagonal <span class="subst">&#123;s + <span class="number">1</span>&#125;</span>&quot;</span>,</span><br><span class="line">        VoxelPosition = <span class="keyword">new</span> Coordinate3D(end_pt.X, end_pt.Y, volumeSize.Z),</span><br><span class="line">        Normal = normal,</span><br><span class="line">        IsVisible = <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新截面方向和倾斜度"><a href="#更新截面方向和倾斜度" class="headerlink" title="更新截面方向和倾斜度"></a>更新截面方向和倾斜度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - foreach (var section in voxelLayer.GetSections())</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> section <span class="keyword">in</span> volume.GetSections())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//set each normal to 45.0 orientation and tilt</span></span><br><span class="line">    section.Normal = voxelLayer.GetNormal(<span class="number">45.0</span>, <span class="number">45.0</span>);</span><br><span class="line">    <span class="comment">//apply the change</span></span><br><span class="line">    <span class="comment">//At 2.x - voxelLayer.UpdateSection(section);</span></span><br><span class="line">    volume.UpdateSection(section);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新版块可见性"><a href="#更新版块可见性" class="headerlink" title="更新版块可见性"></a>更新版块可见性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var sections = voxelLayer.GetSections().Where(s =&gt; !s.IsVisible);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"><span class="keyword">var</span> sections = volume.GetSections().Where(s =&gt; !s.IsVisible);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make them all visible</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> section <span class="keyword">in</span> sections)</span><br><span class="line">&#123;</span><br><span class="line">    section.IsVisible = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//apply the change</span></span><br><span class="line">    <span class="comment">//At 2.x - voxelLayer.UpdateSection(section);</span></span><br><span class="line">    volume.UpdateSection(section);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除部分"><a href="#删除部分" class="headerlink" title="删除部分"></a>删除部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - foreach (var section in voxelLayer.GetSections())</span></span><br><span class="line"><span class="comment">//                        voxelLayer.DeleteSection(section);</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> section <span class="keyword">in</span> volume.GetSections())</span><br><span class="line">    volume.DeleteSection(section);</span><br><span class="line"></span><br><span class="line"><span class="comment">//optional...</span></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Volume)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Volume);</span><br></pre></td></tr></table></figure>

<h2 id="锁定部分"><a href="#锁定部分" class="headerlink" title="锁定部分"></a>锁定部分</h2><h3 id="获取锁定部分的当前集合"><a href="#获取锁定部分的当前集合" class="headerlink" title="获取锁定部分的当前集合"></a>获取锁定部分的当前集合</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetLockedSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetLockedSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> locked_sections = voxelLayer.GetLockedSections();</span><br></pre></td></tr></table></figure>

<h3 id="获取锁定的部分"><a href="#获取锁定的部分" class="headerlink" title="获取锁定的部分"></a>获取锁定的部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> locked_section = voxelLayer.GetLockedSections().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> locked_section2 = voxelLayer.GetLockedSections()</span><br><span class="line">                                .First(lsec =&gt; lsec.ID == my_locked_section_id);</span><br></pre></td></tr></table></figure>

<h3 id="在目录中获取选定的锁定部分"><a href="#在目录中获取选定的锁定部分" class="headerlink" title="在目录中获取选定的锁定部分"></a>在目录中获取选定的锁定部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> locked_section = MapView.Active?.GetSelectedLockedSections()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (locked_section != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取目录中所选锁定部分的体素图层"><a href="#获取目录中所选锁定部分的体素图层" class="headerlink" title="获取目录中所选锁定部分的体素图层"></a>获取目录中所选锁定部分的体素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line">VoxelLayer voxelLayer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> locked_section = MapView.Active?.GetSelectedLockedSections()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (locked_section != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    voxelLayer = locked_section.Layer;</span><br><span class="line">    <span class="comment">//TODO - use the layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为选定的锁定部分设置活动的变量配置文件"><a href="#为选定的锁定部分设置活动的变量配置文件" class="headerlink" title="为选定的锁定部分设置活动的变量配置文件"></a>为选定的锁定部分设置活动的变量配置文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> locked_section = MapView.Active?.GetSelectedLockedSections()?.FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (locked_section != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> variable = locked_section.Layer.GetVariableProfile(locked_section.VariableName);</span><br><span class="line">    locked_section.Layer.SetSelectedVariableProfile(variable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="锁定分区-x2F-“创建”锁定分区"><a href="#锁定分区-x2F-“创建”锁定分区" class="headerlink" title="锁定分区&#x2F;“创建”锁定分区"></a>锁定分区&#x2F;“创建”锁定分区</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetLockedSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetLockedSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use the SelectedVariableProfile to get the sections</span></span><br><span class="line"><span class="comment">//via its associated volume</span></span><br><span class="line"><span class="keyword">var</span> volume = voxelLayer.SelectedVariableProfile.Volume;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get the selected section</span></span><br><span class="line"><span class="keyword">var</span> section = MapView.Active.GetSelectedSections().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (section == <span class="literal">null</span>)</span><br><span class="line">      &#123;</span><br><span class="line">    <span class="comment">//At 2.x - section = voxelLayer.GetSections().FirstOrDefault();</span></span><br><span class="line">    section = volume.GetSections().FirstOrDefault();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (section == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Lock the section (Creates a locked section, deletes</span></span><br><span class="line"><span class="comment">//the section)</span></span><br><span class="line"><span class="comment">//if (voxelLayer.CanLockSection(section))</span></span><br><span class="line"><span class="comment">//    voxelLayer.LockSection(section);</span></span><br><span class="line"><span class="keyword">if</span> (volume.CanLockSection(section))</span><br><span class="line">    volume.LockSection(section);</span><br></pre></td></tr></table></figure>

<h3 id="更新锁定部分可见性"><a href="#更新锁定部分可见性" class="headerlink" title="更新锁定部分可见性"></a>更新锁定部分可见性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetLockedSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetLockedSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> locked_sections = voxelLayer.GetLockedSections().Where(ls =&gt; !ls.IsVisible);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make them visible</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> locked_section <span class="keyword">in</span> locked_sections)</span><br><span class="line">&#123;</span><br><span class="line">    locked_section.IsVisible = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//apply change</span></span><br><span class="line">    voxelLayer.UpdateSection(locked_section);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解锁锁定部分"><a href="#解锁锁定部分" class="headerlink" title="解锁锁定部分"></a>解锁锁定部分</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.Visualization != VoxelVisualization.Surface)</span><br><span class="line">    voxelLayer.SetVisualization(VoxelVisualization.Surface);</span><br><span class="line">voxelLayer.SetSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetSectionContainerVisibility(<span class="literal">true</span>);</span><br><span class="line">voxelLayer.SetLockedSectionContainerExpanded(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//get the selected locked section</span></span><br><span class="line"><span class="keyword">var</span> locked_section = MapView.Active.GetSelectedLockedSections().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (locked_section == <span class="literal">null</span>)</span><br><span class="line">    locked_section = voxelLayer.GetLockedSections().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (locked_section == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Unlock the locked section (Deletes the locked section, creates</span></span><br><span class="line"><span class="comment">//a section)</span></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.CanUnlockSection(locked_section))</span><br><span class="line">    voxelLayer.UnlockSection(locked_section);</span><br></pre></td></tr></table></figure>

<h3 id="删除锁定的分区"><a href="#删除锁定的分区" class="headerlink" title="删除锁定的分区"></a>删除锁定的分区</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var voxelLayer = ... ;</span></span><br><span class="line"><span class="comment">//Must be on the QueuedTask.Run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (voxelLayer.GetLockedSections().Count() == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Delete the last locked section from the collection of</span></span><br><span class="line"><span class="comment">//locked sections</span></span><br><span class="line">voxelLayer.DeleteSection(voxelLayer.GetLockedSections().Last());</span><br></pre></td></tr></table></figure>

<h1 id="地图探索"><a href="#地图探索" class="headerlink" title="地图探索"></a>地图探索</h1><h2 id="地图视图"><a href="#地图视图" class="headerlink" title="地图视图"></a>地图视图</h2><h3 id="测试视图是否为-3D-视图"><a href="#测试视图是否为-3D-视图" class="headerlink" title="测试视图是否为 3D 视图"></a>测试视图是否为 3D 视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsView3D</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Return whether the viewing mode is SceneLocal or SceneGlobal</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ViewingMode == ArcGIS.Core.CIM.MapViewingMode.SceneLocal ||</span><br><span class="line">         mapView.ViewingMode == ArcGIS.Core.CIM.MapViewingMode.SceneGlobal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置查看模式"><a href="#设置查看模式" class="headerlink" title="设置查看模式"></a>设置查看模式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetViewingModeToSceneLocal</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Check if the view can be set to SceneLocal and if it can set it.</span></span><br><span class="line">  <span class="keyword">if</span> (mapView.CanSetViewingMode(ArcGIS.Core.CIM.MapViewingMode.SceneLocal))</span><br><span class="line">    mapView.SetViewingModeAsync(ArcGIS.Core.CIM.MapViewingMode.SceneLocal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启用视图链接"><a href="#启用视图链接" class="headerlink" title="启用视图链接"></a>启用视图链接</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnableViewLinking</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set the view linking mode to Center and Scale.</span></span><br><span class="line">  MapView.LinkMode = LinkMode.Center | LinkMode.Scale;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更新地图视图范围（缩放、平移等）"><a href="#更新地图视图范围（缩放、平移等）" class="headerlink" title="更新地图视图范围（缩放、平移等）"></a>更新地图视图范围（缩放、平移等）</h2><h3 id="转到上一个相机"><a href="#转到上一个相机" class="headerlink" title="转到上一个相机"></a>转到上一个相机</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToPreviousCameraAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the selected layers in the TOC</span></span><br><span class="line">  <span class="keyword">if</span> (mapView.HasPreviousCamera())</span><br><span class="line">    <span class="keyword">return</span> mapView.PreviousCameraAsync();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="转到下一个相机"><a href="#转到下一个相机" class="headerlink" title="转到下一个相机"></a>转到下一个相机</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToNextCameraAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the selected layers in the TOC</span></span><br><span class="line">  <span class="keyword">if</span> (mapView.HasNextCamera())</span><br><span class="line">    <span class="keyword">return</span> mapView.NextCameraAsync();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至全图范围"><a href="#缩放至全图范围" class="headerlink" title="缩放至全图范围"></a>缩放至全图范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToFullExtent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom to the map&#x27;s full extent</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomToFullExtent();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToFullExtentAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the map&#x27;s full extent</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomToFullExtentAsync(TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="固定放大"><a href="#固定放大" class="headerlink" title="固定放大"></a>固定放大</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomInFixed</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom in the map view by a fixed amount.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomInFixed();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomInFixedAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom in the map view by a fixed amount.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomInFixedAsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="固定缩小"><a href="#固定缩小" class="headerlink" title="固定缩小"></a>固定缩小</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomOutFixed</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom out in the map view by a fixed amount.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomOutFixed();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomOutFixedAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom in the map view by a fixed amount.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomOutFixedAsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至某个范围"><a href="#缩放至某个范围" class="headerlink" title="缩放至某个范围"></a>缩放至某个范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToExtent</span>(<span class="params"><span class="built_in">double</span> xMin, <span class="built_in">double</span> yMin, <span class="built_in">double</span> xMax, <span class="built_in">double</span> yMax, ArcGIS.Core.Geometry.SpatialReference spatialReference</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create the envelope</span></span><br><span class="line">  <span class="keyword">var</span> envelope = ArcGIS.Core.Geometry.EnvelopeBuilderEx.CreateEnvelope(xMin, yMin, xMax, yMax, spatialReference);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom the view to a given extent.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomToAsync(envelope, TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至点"><a href="#缩放至点" class="headerlink" title="缩放至点"></a>缩放至点</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToPoint</span>(<span class="params"><span class="built_in">double</span> x, <span class="built_in">double</span> y, ArcGIS.Core.Geometry.SpatialReference spatialReference</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Note: Run within QueuedTask</span></span><br><span class="line">    <span class="comment">//Create a point</span></span><br><span class="line">    <span class="keyword">var</span> pt = MapPointBuilderEx.CreateMapPoint(x, y, spatialReference);</span><br><span class="line">    <span class="comment">//Buffer it - for purpose of zoom</span></span><br><span class="line">    <span class="keyword">var</span> poly = GeometryEngine.Instance.Buffer(pt, buffer_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//do we need to project the buffer polygon?</span></span><br><span class="line">    <span class="keyword">if</span> (!MapView.Active.Map.SpatialReference.IsEqual(poly.SpatialReference))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//project the polygon</span></span><br><span class="line">      poly = GeometryEngine.Instance.Project(poly, MapView.Active.Map.SpatialReference);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom - add in a delay for animation effect</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomTo(poly, <span class="keyword">new</span> TimeSpan(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至所选要素"><a href="#缩放至所选要素" class="headerlink" title="缩放至所选要素"></a>缩放至所选要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToSelected</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom to the map&#x27;s selected features.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomToSelected();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToSelectedAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the map&#x27;s selected features.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomToSelectedAsync(TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="按名称缩放至书签"><a href="#按名称缩放至书签" class="headerlink" title="按名称缩放至书签"></a>按名称缩放至书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToBookmark</span>(<span class="params"><span class="built_in">string</span> bookmarkName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the first bookmark with the given name.</span></span><br><span class="line">    <span class="keyword">var</span> bookmark = mapView.Map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == bookmarkName);</span><br><span class="line">    <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom the view to the bookmark.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomTo(bookmark);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToBookmarkAsync</span>(<span class="params"><span class="built_in">string</span> bookmarkName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the first bookmark with the given name.</span></span><br><span class="line">  <span class="keyword">var</span> bookmark = <span class="keyword">await</span> QueuedTask.Run(() =&gt; mapView.Map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == bookmarkName));</span><br><span class="line">  <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom the view to the bookmark.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> mapView.ZoomToAsync(bookmark, TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至可见图层"><a href="#缩放至可见图层" class="headerlink" title="缩放至可见图层"></a>缩放至可见图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToAllVisibleLayersAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Zoom to all visible layers in the map.</span></span><br><span class="line">    <span class="keyword">var</span> visibleLayers = mapView.Map.Layers.Where(l =&gt; l.IsVisible);</span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomTo(visibleLayers);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放至所选图层"><a href="#缩放至所选图层" class="headerlink" title="缩放至所选图层"></a>缩放至所选图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ZoomToTOCSelectedLayersAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the selected layers in the TOC</span></span><br><span class="line">  <span class="keyword">var</span> selectedLayers = mapView.GetSelectedLayers();</span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomToAsync(selectedLayers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在一定程度上平移"><a href="#在一定程度上平移" class="headerlink" title="在一定程度上平移"></a>在一定程度上平移</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToExtent</span>(<span class="params"><span class="built_in">double</span> xMin, <span class="built_in">double</span> yMin, <span class="built_in">double</span> xMax, <span class="built_in">double</span> yMax, ArcGIS.Core.Geometry.SpatialReference spatialReference</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Pan the view to a given extent.</span></span><br><span class="line">    <span class="keyword">var</span> envelope = ArcGIS.Core.Geometry.EnvelopeBuilderEx.CreateEnvelope(xMin, yMin, xMax, yMax, spatialReference);</span><br><span class="line">    <span class="keyword">return</span> mapView.PanTo(envelope);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToExtentAsync</span>(<span class="params"><span class="built_in">double</span> xMin, <span class="built_in">double</span> yMin, <span class="built_in">double</span> xMax, <span class="built_in">double</span> yMax, ArcGIS.Core.Geometry.SpatialReference spatialReference</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create the envelope</span></span><br><span class="line">  <span class="keyword">var</span> envelope = ArcGIS.Core.Geometry.EnvelopeBuilderEx.CreateEnvelope(xMin, yMin, xMax, yMax, spatialReference);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Pan the view to a given extent.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.PanToAsync(envelope, TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="平移到所选要素"><a href="#平移到所选要素" class="headerlink" title="平移到所选要素"></a>平移到所选要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToSelected</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Pan to the map&#x27;s selected features.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.PanToSelected();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToSelectedAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Pan to the map&#x27;s selected features.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.PanToSelectedAsync(TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="平移到书签"><a href="#平移到书签" class="headerlink" title="平移到书签"></a>平移到书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToBookmark</span>(<span class="params"><span class="built_in">string</span> bookmarkName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the first bookmark with the given name.</span></span><br><span class="line">    <span class="keyword">var</span> bookmark = mapView.Map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == bookmarkName);</span><br><span class="line">    <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Pan the view to the bookmark.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.PanTo(bookmark);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToBookmarkAsync</span>(<span class="params"><span class="built_in">string</span> bookmarkName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the first bookmark with the given name.</span></span><br><span class="line">  <span class="keyword">var</span> bookmark = <span class="keyword">await</span> QueuedTask.Run(() =&gt; mapView.Map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == bookmarkName));</span><br><span class="line">  <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Pan the view to the bookmark.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> mapView.PanToAsync(bookmark, TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="平移到可见图层"><a href="#平移到可见图层" class="headerlink" title="平移到可见图层"></a>平移到可见图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToAllVisibleLayersAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Pan to all visible layers in the map.</span></span><br><span class="line">    <span class="keyword">var</span> visibleLayers = mapView.Map.Layers.Where(l =&gt; l.IsVisible);</span><br><span class="line">    <span class="keyword">return</span> mapView.PanTo(visibleLayers);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异步平移到所选图层"><a href="#异步平移到所选图层" class="headerlink" title="异步平移到所选图层"></a>异步平移到所选图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">PanToTOCSelectedLayersAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Pan to the selected layers in the TOC</span></span><br><span class="line">  <span class="keyword">var</span> selectedLayers = mapView.GetSelectedLayers();</span><br><span class="line">  <span class="keyword">return</span> mapView.PanToAsync(selectedLayers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="旋转地图视图"><a href="#旋转地图视图" class="headerlink" title="旋转地图视图"></a>旋转地图视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">RotateView</span>(<span class="params"><span class="built_in">double</span> heading</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> Task.FromResult(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Get the camera for the view, adjust the heading and zoom to the new camera position.</span></span><br><span class="line">  <span class="keyword">var</span> camera = mapView.Camera;</span><br><span class="line">  camera.Heading = heading;</span><br><span class="line">  <span class="keyword">return</span> mapView.ZoomToAsync(camera, TimeSpan.Zero);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use the synchronous method</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">RotateViewAsync</span>(<span class="params"><span class="built_in">double</span> heading</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the camera for the view, adjust the heading and zoom to the new camera position.</span></span><br><span class="line">    <span class="keyword">var</span> camera = mapView.Camera;</span><br><span class="line">    camera.Heading = heading;</span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomTo(camera, TimeSpan.Zero);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="展开范围"><a href="#展开范围" class="headerlink" title="展开范围"></a>展开范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ExpandExtentAsync</span>(<span class="params"><span class="built_in">double</span> dx, <span class="built_in">double</span> dy</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Expand the current extent by the given ratio.</span></span><br><span class="line">    <span class="keyword">var</span> extent = mapView.Extent;</span><br><span class="line">    <span class="keyword">var</span> newExtent = ArcGIS.Core.Geometry.GeometryEngine.Instance.Expand(extent, dx, dy, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> mapView.ZoomTo(newExtent);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="地图-1"><a href="#地图-1" class="headerlink" title="地图"></a>地图</h2><h3 id="获取活动地图的名称"><a href="#获取活动地图的名称" class="headerlink" title="获取活动地图的名称"></a>获取活动地图的名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetActiveMapName</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Return the name of the map currently displayed in the active map view.</span></span><br><span class="line">  <span class="keyword">return</span> mapView.Map.Name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="清除活动地图中的所有选择"><a href="#清除活动地图中的所有选择" class="headerlink" title="清除活动地图中的所有选择"></a>清除活动地图中的所有选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (MapView.Active.Map != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    MapView.Active.Map.SetSelection(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="以地图单位计算选择容差"><a href="#以地图单位计算选择容差" class="headerlink" title="以地图单位计算选择容差"></a>以地图单位计算选择容差</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Selection tolerance for the map in pixels</span></span><br><span class="line"><span class="keyword">var</span> selectionTolerance = SelectionEnvironment.SelectionTolerance;</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the map center</span></span><br><span class="line">  <span class="keyword">var</span> mapExtent = MapView.Active.Map.GetDefaultExtent();</span><br><span class="line">  <span class="keyword">var</span> mapPoint = mapExtent.Center;</span><br><span class="line">  <span class="comment">//Map center as screen point</span></span><br><span class="line">  <span class="keyword">var</span> screenPoint = MapView.Active.MapToScreen(mapPoint);</span><br><span class="line">  <span class="comment">//Add selection tolerance pixels to get a &quot;radius&quot;.</span></span><br><span class="line">  <span class="keyword">var</span> radiusScreenPoint = <span class="keyword">new</span> System.Windows.Point((screenPoint.X + selectionTolerance), screenPoint.Y);</span><br><span class="line">  <span class="keyword">var</span> radiusMapPoint = MapView.Active.ScreenToMap(radiusScreenPoint);</span><br><span class="line">  <span class="comment">//Calculate the selection tolerance distance in map uints.</span></span><br><span class="line">  <span class="keyword">var</span> searchRadius = GeometryEngine.Instance.Distance(mapPoint, radiusMapPoint);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="地图视图叠加控制"><a href="#地图视图叠加控制" class="headerlink" title="地图视图叠加控制"></a>地图视图叠加控制</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Creat a Progress Bar user control</span></span><br><span class="line"><span class="keyword">var</span> progressBarControl = <span class="keyword">new</span> System.Windows.Controls.ProgressBar();</span><br><span class="line"><span class="comment">//Configure the progress bar</span></span><br><span class="line">progressBarControl.Minimum = <span class="number">0</span>;</span><br><span class="line">progressBarControl.Maximum = <span class="number">100</span>;</span><br><span class="line">progressBarControl.IsIndeterminate = <span class="literal">true</span>;</span><br><span class="line">progressBarControl.Width = <span class="number">300</span>;</span><br><span class="line">progressBarControl.Value = <span class="number">10</span>;</span><br><span class="line">progressBarControl.Height = <span class="number">25</span>;</span><br><span class="line">progressBarControl.Visibility = System.Windows.Visibility.Visible;</span><br><span class="line"><span class="comment">//Create a MapViewOverlayControl. </span></span><br><span class="line"><span class="keyword">var</span> mapViewOverlayControl = <span class="keyword">new</span> MapViewOverlayControl(progressBarControl, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, OverlayControlRelativePosition.BottomCenter, <span class="number">.5</span>, <span class="number">.8</span>);</span><br><span class="line"><span class="comment">//Add to the active map</span></span><br><span class="line">MapView.Active.AddOverlayControl(mapViewOverlayControl);</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Wait 3 seconds to remove the progress bar from the map.</span></span><br><span class="line">  Thread.Sleep(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//Remove from active map</span></span><br><span class="line">MapView.Active.RemoveOverlayControl(mapViewOverlayControl);</span><br></pre></td></tr></table></figure>

<h2 id="层"><a href="#层" class="headerlink" title="层"></a>层</h2><h3 id="选择目录中的所有要素图层"><a href="#选择目录中的所有要素图层" class="headerlink" title="选择目录中的所有要素图层"></a>选择目录中的所有要素图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SelectAllFeatureLayersInTOC</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Zoom to the selected layers in the TOC</span></span><br><span class="line">  <span class="keyword">var</span> featureLayers = mapView.Map.Layers.OfType&lt;FeatureLayer&gt;();</span><br><span class="line">  mapView.SelectLayers(featureLayers.ToList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="闪烁所选功能"><a href="#闪烁所选功能" class="headerlink" title="闪烁所选功能"></a>闪烁所选功能</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">FlashSelectedFeaturesAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the selected features from the map and filter out the standalone table selection.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//At 2.x</span></span><br><span class="line">    <span class="comment">//var selectedFeatures = mapView.Map.GetSelection()</span></span><br><span class="line">    <span class="comment">//    .Where(kvp =&gt; kvp.Key is BasicFeatureLayer)</span></span><br><span class="line">    <span class="comment">//    .ToDictionary(kvp =&gt; (BasicFeatureLayer)kvp.Key, kvp =&gt; kvp.Value);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span>/Flash the collection of features.</span></span><br><span class="line">    <span class="comment">//mapView.FlashFeature(selectedFeatures);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> selectedFeatures = mapView.Map.GetSelection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Flash the collection of features.</span></span><br><span class="line">    mapView.FlashFeature(selectedFeatures);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查图层在给定的地图视图中是否可见"><a href="#检查图层在给定的地图视图中是否可见" class="headerlink" title="检查图层在给定的地图视图中是否可见"></a>检查图层在给定的地图视图中是否可见</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line"><span class="keyword">var</span> layer = mapView.Map.GetLayersAsFlattenedList().OfType&lt;Layer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (mapView == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="built_in">bool</span> isLayerVisibleInView = layer.IsVisibleInView(mapView);</span><br><span class="line"><span class="keyword">if</span> (isLayerVisibleInView)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do Something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择一个图层并打开其图层属性页面"><a href="#选择一个图层并打开其图层属性页面" class="headerlink" title="选择一个图层并打开其图层属性页面"></a>选择一个图层并打开其图层属性页面</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the layer you want</span></span><br><span class="line"><span class="keyword">var</span> layer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">// select it in the TOC</span></span><br><span class="line">List&lt;Layer&gt; layersToSelect = <span class="keyword">new</span> List&lt;Layer&gt;();</span><br><span class="line">layersToSelect.Add(layer);</span><br><span class="line">MapView.Active.SelectLayers(layersToSelect);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now execute the layer properties command</span></span><br><span class="line"><span class="keyword">var</span> wrapper = FrameworkApplication.GetPlugInWrapper(<span class="string">&quot;esri_mapping_selectedLayerPropertiesButton&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> command = wrapper <span class="keyword">as</span> ICommand;</span><br><span class="line"><span class="keyword">if</span> (command == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// execute the command</span></span><br><span class="line"><span class="keyword">if</span> (command.CanExecute(<span class="literal">null</span>))</span><br><span class="line">  command.Execute(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="清除特定图层的选择"><a href="#清除特定图层的选择" class="headerlink" title="清除特定图层的选择"></a>清除特定图层的选择</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  lyr.ClearSelection();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="地图成员的显示表窗格"><a href="#地图成员的显示表窗格" class="headerlink" title="地图成员的显示表窗格"></a>地图成员的显示表窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapMember = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;MapMember&gt;().FirstOrDefault();</span><br><span class="line"><span class="comment">//Gets or creates the CIMMapTableView for a MapMember.</span></span><br><span class="line"><span class="keyword">var</span> tableView = FrameworkApplication.Panes.GetMapTableView(mapMember);</span><br><span class="line"><span class="comment">//Configure the table view</span></span><br><span class="line">tableView.DisplaySubtypeDomainDescriptions = <span class="literal">false</span>;</span><br><span class="line">tableView.SelectionMode = <span class="literal">false</span>;</span><br><span class="line">tableView.ShowOnlyContingentValueFields = <span class="literal">true</span>;</span><br><span class="line">tableView.HighlightInvalidContingentValueFields = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//Open the table pane using the configured tableView. If a table pane is already open it will be activated.</span></span><br><span class="line"><span class="comment">//You must be on the UI thread to call this function.</span></span><br><span class="line"><span class="keyword">var</span> tablePane = FrameworkApplication.Panes.OpenTablePane(tableView);</span><br></pre></td></tr></table></figure>

<h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><h3 id="遮罩功能"><a href="#遮罩功能" class="headerlink" title="遮罩功能"></a>遮罩功能</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the layer to be masked</span></span><br><span class="line"><span class="keyword">var</span> lineLyrToBeMasked = MapView.Active.Map.Layers.FirstOrDefault(lyr =&gt; lyr.Name == <span class="string">&quot;TestLine&quot;</span>) <span class="keyword">as</span> FeatureLayer;</span><br><span class="line"><span class="comment">//Get the layer&#x27;s definition</span></span><br><span class="line"><span class="keyword">var</span> lyrDefn = lineLyrToBeMasked.GetDefinition();</span><br><span class="line"><span class="comment">//Create an array of Masking layers (polygon only)</span></span><br><span class="line"><span class="comment">//Set the LayerMasks property of the Masked layer</span></span><br><span class="line">lyrDefn.LayerMasks = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;CIMPATH=map3/testpoly.xml&quot;</span> &#125;;</span><br><span class="line"><span class="comment">//Re-set the Masked layer&#x27;s defintion</span></span><br><span class="line">lineLyrToBeMasked.SetDefinition(lyrDefn);</span><br></pre></td></tr></table></figure>

<h2 id="弹出窗口"><a href="#弹出窗口" class="headerlink" title="弹出窗口"></a>弹出窗口</h2><h3 id="显示要素的弹出窗口"><a href="#显示要素的弹出窗口" class="headerlink" title="显示要素的弹出窗口"></a>显示要素的弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowPopup</span>(<span class="params">MapMember mapMember, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  mapView.ShowPopup(mapMember, objectID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="显示自定义弹出窗口"><a href="#显示自定义弹出窗口" class="headerlink" title="显示自定义弹出窗口"></a>显示自定义弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowCustomPopup</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create custom popup content</span></span><br><span class="line">  <span class="keyword">var</span> popups = <span class="keyword">new</span> List&lt;PopupContent&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> PopupContent(<span class="string">&quot;&lt;b&gt;This text is bold.&lt;/b&gt;&quot;</span>, <span class="string">&quot;Custom tooltip from HTML string&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> PopupContent(<span class="keyword">new</span> Uri(<span class="string">&quot;http://www.esri.com/&quot;</span>), <span class="string">&quot;Custom tooltip from Uri&quot;</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">  mapView.ShowCustomPopup(popups);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用弹出窗口属性显示要素的弹出窗口"><a href="#使用弹出窗口属性显示要素的弹出窗口" class="headerlink" title="使用弹出窗口属性显示要素的弹出窗口"></a>使用弹出窗口属性显示要素的弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowPopupWithWindowDef</span>(<span class="params">MapMember mapMember, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (MapView.Active == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// Sample code: https://github.com/Esri/arcgis-pro-sdk-community-samples/blob/master/Map-Exploration/CustomIdentify/CustomIdentify.cs</span></span><br><span class="line">  <span class="keyword">var</span> topLeftCornerPoint = <span class="keyword">new</span> System.Windows.Point(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">  <span class="keyword">var</span> popupDef = <span class="keyword">new</span> PopupDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    Append = <span class="literal">true</span>,      <span class="comment">// if true new record is appended to existing (if any)</span></span><br><span class="line">    Dockable = <span class="literal">true</span>,    <span class="comment">// if true popup is dockable - if false Append is not applicable</span></span><br><span class="line">    Position = topLeftCornerPoint,  <span class="comment">// Position of top left corner of the popup (in pixels)</span></span><br><span class="line">    Size = <span class="keyword">new</span> System.Windows.Size(<span class="number">200</span>, <span class="number">400</span>)    <span class="comment">// size of the popup (in pixels)</span></span><br><span class="line">  &#125;;</span><br><span class="line">  MapView.Active.ShowPopup(mapMember, objectID, popupDef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用弹出窗口属性显示自定义弹出窗口"><a href="#使用弹出窗口属性显示自定义弹出窗口" class="headerlink" title="使用弹出窗口属性显示自定义弹出窗口"></a>使用弹出窗口属性显示自定义弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowCustomPopupWithWindowDef</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (MapView.Active == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create custom popup content</span></span><br><span class="line">  <span class="keyword">var</span> popups = <span class="keyword">new</span> List&lt;PopupContent&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> PopupContent(<span class="string">&quot;&lt;b&gt;This text is bold.&lt;/b&gt;&quot;</span>, <span class="string">&quot;Custom tooltip from HTML string&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> PopupContent(<span class="keyword">new</span> Uri(<span class="string">&quot;http://www.esri.com/&quot;</span>), <span class="string">&quot;Custom tooltip from Uri&quot;</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="comment">// Sample code: https://github.com/Esri/arcgis-pro-sdk-community-samples/blob/master/Framework/DynamicMenu/DynamicFeatureSelectionMenu.cs</span></span><br><span class="line">  <span class="keyword">var</span> topLeftCornerPoint = <span class="keyword">new</span> System.Windows.Point(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">  <span class="keyword">var</span> popupDef = <span class="keyword">new</span> PopupDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    Append = <span class="literal">true</span>,      <span class="comment">// if true new record is appended to existing (if any)</span></span><br><span class="line">    Dockable = <span class="literal">true</span>,    <span class="comment">// if true popup is dockable - if false Append is not applicable</span></span><br><span class="line">    Position = topLeftCornerPoint,  <span class="comment">// Position of top left corner of the popup (in pixels)</span></span><br><span class="line">    Size = <span class="keyword">new</span> System.Windows.Size(<span class="number">200</span>, <span class="number">400</span>)    <span class="comment">// size of the popup (in pixels)</span></span><br><span class="line">  &#125;;</span><br><span class="line">  MapView.Active.ShowCustomPopup(popups, <span class="literal">null</span>, <span class="literal">true</span>, popupDef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="显示带有自定义命令的弹出窗口"><a href="#显示带有自定义命令的弹出窗口" class="headerlink" title="显示带有自定义命令的弹出窗口"></a>显示带有自定义命令的弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowCustomPopup</span>(<span class="params">MapMember mapMember, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create custom popup content from existing map member and object id</span></span><br><span class="line">  <span class="keyword">var</span> popups = <span class="keyword">new</span> List&lt;PopupContent&gt;();</span><br><span class="line">  popups.Add(<span class="keyword">new</span> PopupContent(mapMember, objectID));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create a new custom command to add to the popup window</span></span><br><span class="line">  <span class="keyword">var</span> commands = <span class="keyword">new</span> List&lt;PopupCommand&gt;();</span><br><span class="line">  commands.Add(<span class="keyword">new</span> PopupCommand(</span><br><span class="line">    p =&gt; MessageBox.Show(<span class="built_in">string</span>.Format(<span class="string">&quot;Map Member: &#123;0&#125;, ID: &#123;1&#125;&quot;</span>, p.MapMember, p.IDString)),</span><br><span class="line">    p =&gt; &#123; <span class="keyword">return</span> p != <span class="literal">null</span>; &#125;,</span><br><span class="line">    <span class="string">&quot;My custom command&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> BitmapImage(<span class="keyword">new</span> Uri(<span class="string">&quot;pack://application:,,,/ArcGIS.Desktop.Resources;component/Images/GenericCheckMark16.png&quot;</span>)) <span class="keyword">as</span> ImageSource));</span><br><span class="line"></span><br><span class="line">  mapView.ShowCustomPopup(popups, commands, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="显示动态弹出窗口"><a href="#显示动态弹出窗口" class="headerlink" title="显示动态弹出窗口"></a>显示动态弹出窗口</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowDynamicPopup</span>(<span class="params">MapMember mapMember, List&lt;<span class="built_in">long</span>&gt; objectIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active map view.</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create popup whose content is created the first time the item is requested.</span></span><br><span class="line">  <span class="keyword">var</span> popups = <span class="keyword">new</span> List&lt;PopupContent&gt;();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> id <span class="keyword">in</span> objectIDs)</span><br><span class="line">  &#123;</span><br><span class="line">    popups.Add(<span class="keyword">new</span> DynamicPopupContent(mapMember, id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapView.ShowCustomPopup(popups);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">DynamicPopupContent</span> : <span class="title">PopupContent</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DynamicPopupContent</span>(<span class="params">MapMember mapMember, <span class="built_in">long</span> objectID</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    MapMember = mapMember;</span><br><span class="line">    IDString = objectID.ToString();</span><br><span class="line">    IsDynamicContent = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Called when the pop-up is loaded in the window.</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">OnCreateHtmlContent</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt; <span class="built_in">string</span>.Format(<span class="string">&quot;&lt;b&gt;Map Member: &#123;0&#125;, ID: &#123;1&#125;&lt;/b&gt;&quot;</span>, MapMember, IDString));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h2><h3 id="使用活动地图视图创建新书签"><a href="#使用活动地图视图创建新书签" class="headerlink" title="使用活动地图视图创建新书签"></a>使用活动地图视图创建新书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;Bookmark&gt; <span class="title">AddBookmarkAsync</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Adding a new bookmark using the active view.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.Map.AddBookmark(mapView, name);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从联昌国际添加新书签"><a href="#从联昌国际添加新书签" class="headerlink" title="从联昌国际添加新书签"></a>从联昌国际添加新书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;Bookmark&gt; <span class="title">AddBookmarkFromCameraAsync</span>(<span class="params">Camera camera, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Set properties for Camera</span></span><br><span class="line">    CIMViewCamera cimCamera = <span class="keyword">new</span> CIMViewCamera()</span><br><span class="line">    &#123;</span><br><span class="line">      X = camera.X,</span><br><span class="line">      Y = camera.Y,</span><br><span class="line">      Z = camera.Z,</span><br><span class="line">      Scale = camera.Scale,</span><br><span class="line">      Pitch = camera.Pitch,</span><br><span class="line">      Heading = camera.Heading,</span><br><span class="line">      Roll = camera.Roll</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Create new CIM bookmark and populate its properties</span></span><br><span class="line">    <span class="keyword">var</span> cimBookmark = <span class="keyword">new</span> CIMBookmark() &#123; Camera = cimCamera, Name = name, ThumbnailImagePath = <span class="string">&quot;&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Add a new bookmark for the active map.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.Map.AddBookmark(cimBookmark);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取项目的书签集合"><a href="#获取项目的书签集合" class="headerlink" title="获取项目的书签集合"></a>获取项目的书签集合</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;ReadOnlyObservableCollection&lt;Bookmark&gt;&gt; GetProjectBookmarksAsync()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the collection of bookmarks for the project.</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; Project.Current.GetBookmarks());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取地图书签"><a href="#获取地图书签" class="headerlink" title="获取地图书签"></a>获取地图书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;ReadOnlyObservableCollection&lt;Bookmark&gt;&gt; GetActiveMapBookmarksAsync()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Return the collection of bookmarks for the map.</span></span><br><span class="line">    <span class="keyword">return</span> mapView.Map.GetBookmarks();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将书签移到顶部"><a href="#将书签移到顶部" class="headerlink" title="将书签移到顶部"></a>将书签移到顶部</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">MoveBookmarkToTopAsync</span>(<span class="params">Map map, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Find the first bookmark with the name</span></span><br><span class="line">    <span class="keyword">var</span> bookmark = map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == name);</span><br><span class="line">    <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Remove the bookmark</span></span><br><span class="line">    map.MoveBookmark(bookmark, <span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重命名书签"><a href="#重命名书签" class="headerlink" title="重命名书签"></a>重命名书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">RenameBookmarkAsync</span>(<span class="params">Bookmark bookmark, <span class="built_in">string</span> newName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; bookmark.Rename(newName));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除具有给定名称的书签"><a href="#删除具有给定名称的书签" class="headerlink" title="删除具有给定名称的书签"></a>删除具有给定名称的书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">RemoveBookmarkAsync</span>(<span class="params">Map map, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Find the first bookmark with the name</span></span><br><span class="line">    <span class="keyword">var</span> bookmark = map.GetBookmarks().FirstOrDefault(b =&gt; b.Name == name);</span><br><span class="line">    <span class="keyword">if</span> (bookmark == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Remove the bookmark</span></span><br><span class="line">    map.RemoveBookmark(bookmark);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改书签的缩略图"><a href="#更改书签的缩略图" class="headerlink" title="更改书签的缩略图"></a>更改书签的缩略图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">SetThumbnailAsync</span>(<span class="params">Bookmark bookmark, <span class="built_in">string</span> imagePath</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Set the thumbnail to an image on disk, ie. C:\Pictures\MyPicture.png.</span></span><br><span class="line">  BitmapImage image = <span class="keyword">new</span> BitmapImage(<span class="keyword">new</span> Uri(imagePath, UriKind.RelativeOrAbsolute));</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt; bookmark.SetThumbnail(image));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新书签"><a href="#更新书签" class="headerlink" title="更新书签"></a>更新书签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">UpdateBookmarkAsync</span>(<span class="params">Bookmark bookmark</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the active map view.</span></span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Update the bookmark using the active map view.</span></span><br><span class="line">    bookmark.Update(mapView);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新书签的范围"><a href="#更新书签的范围" class="headerlink" title="更新书签的范围"></a>更新书签的范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">UpdateBookmarkExtentAsync</span>(<span class="params">Bookmark bookmark, ArcGIS.Core.Geometry.Envelope envelope</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the bookmark&#x27;s definition</span></span><br><span class="line">    <span class="keyword">var</span> bookmarkDef = bookmark.GetDefinition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Modify the bookmark&#x27;s location</span></span><br><span class="line">    bookmarkDef.Location = envelope;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Clear the camera as it is no longer valid.</span></span><br><span class="line">    bookmarkDef.Camera = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set the bookmark definition</span></span><br><span class="line">    bookmark.SetDefinition(bookmarkDef);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><h3 id="时间提前-1-个月"><a href="#时间提前-1-个月" class="headerlink" title="时间提前 1 个月"></a>时间提前 1 个月</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StepMapTime</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get the active view</span></span><br><span class="line">  MapView mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Step current map time forward by 1 month</span></span><br><span class="line">  TimeDelta timeDelta = <span class="keyword">new</span> TimeDelta(<span class="number">1</span>, TimeUnit.Months);</span><br><span class="line">  mapView.Time = mapView.Time.Offset(timeDelta);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="禁用地图中的时间。"><a href="#禁用地图中的时间。" class="headerlink" title="禁用地图中的时间。"></a>禁用地图中的时间。</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MapView.Active.Time.Start = <span class="literal">null</span>;</span><br><span class="line">MapView.Active.Time.End = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><h3 id="设置动画长度"><a href="#设置动画长度" class="headerlink" title="设置动画长度"></a>设置动画长度</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetAnimationLength</span>(<span class="params">TimeSpan length</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> duration = animation.Duration;</span><br><span class="line">  <span class="keyword">if</span> (duration == TimeSpan.Zero)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> factor = length.TotalSeconds / duration.TotalSeconds;</span><br><span class="line">  animation.ScaleDuration(factor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缩放动画"><a href="#缩放动画" class="headerlink" title="缩放动画"></a>缩放动画</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ScaleAnimationAfterTime</span>(<span class="params">TimeSpan afterTime, TimeSpan length</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> duration = animation.Duration;</span><br><span class="line">  <span class="keyword">if</span> (duration == TimeSpan.Zero || duration &lt;= afterTime)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> factor = length.TotalSeconds / (duration.TotalSeconds - afterTime.TotalSeconds);</span><br><span class="line">  animation.ScaleDuration(afterTime, duration, factor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="相机关键帧"><a href="#相机关键帧" class="headerlink" title="相机关键帧"></a>相机关键帧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CameraKeyframe&gt; <span class="title">GetCameraKeyframes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> cameraTrack = animation.Tracks.OfType&lt;CameraTrack&gt;().First(); <span class="comment">//There will always be only 1 CameraTrack in the animation.</span></span><br><span class="line">  <span class="keyword">return</span> cameraTrack.Keyframes.OfType&lt;CameraKeyframe&gt;().ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插值相机"><a href="#插值相机" class="headerlink" title="插值相机"></a>插值相机</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;List&lt;Camera&gt;&gt; GetInterpolatedCameras()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Return the collection representing the camera for each frame in animation.</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView != <span class="literal">null</span> || mapView.Animation == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cameras = <span class="keyword">new</span> List&lt;Camera&gt;();</span><br><span class="line">    <span class="comment">//We will use ticks here rather than milliseconds to get the highest precision possible.</span></span><br><span class="line">    <span class="keyword">var</span> ticksPerFrame = Convert.ToInt64(animation.Duration.Ticks / (animation.NumberOfFrames - <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; animation.NumberOfFrames; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> time = TimeSpan.FromTicks(i * ticksPerFrame);</span><br><span class="line">      <span class="comment">//Because of rounding for ticks the last calculated time may be greating than the duration.</span></span><br><span class="line">      <span class="keyword">if</span> (time &gt; animation.Duration)</span><br><span class="line">        time = animation.Duration;</span><br><span class="line">      cameras.Add(mapView.Animation.GetCameraAtTime(time));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cameras;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插值时间"><a href="#插值时间" class="headerlink" title="插值时间"></a>插值时间</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;List&lt;TimeRange&gt;&gt; GetInterpolatedMapTimes()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Return the collection representing the map time for each frame in animation.</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView != <span class="literal">null</span> || mapView.Animation == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> timeRanges = <span class="keyword">new</span> List&lt;TimeRange&gt;();</span><br><span class="line">    <span class="comment">//We will use ticks here rather than milliseconds to get the highest precision possible.</span></span><br><span class="line">    <span class="keyword">var</span> ticksPerFrame = Convert.ToInt64(animation.Duration.Ticks / (animation.NumberOfFrames - <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; animation.NumberOfFrames; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> time = TimeSpan.FromTicks(i * ticksPerFrame);</span><br><span class="line">      <span class="comment">//Because of rounding for ticks the last calculated time may be greating than the duration.</span></span><br><span class="line">      <span class="keyword">if</span> (time &gt; animation.Duration)</span><br><span class="line">        time = animation.Duration;</span><br><span class="line">      timeRanges.Add(mapView.Animation.GetCurrentTimeAtTime(time));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> timeRanges;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插值范围"><a href="#插值范围" class="headerlink" title="插值范围"></a>插值范围</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Task&lt;List&lt;ArcGIS.Desktop.Mapping.Range&gt;&gt; GetInterpolatedMapRanges()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Return the collection representing the map time for each frame in animation.</span></span><br><span class="line">  <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">    <span class="keyword">if</span> (mapView != <span class="literal">null</span> || mapView.Animation == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ranges = <span class="keyword">new</span> List&lt;ArcGIS.Desktop.Mapping.Range&gt;();</span><br><span class="line">    <span class="comment">//We will use ticks here rather than milliseconds to get the highest precision possible.</span></span><br><span class="line">    <span class="keyword">var</span> ticksPerFrame = Convert.ToInt64(animation.Duration.Ticks / (animation.NumberOfFrames - <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; animation.NumberOfFrames; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> time = TimeSpan.FromTicks(i * ticksPerFrame);</span><br><span class="line">      <span class="comment">//Because of rounding for ticks the last calculated time may be greeting than the duration.</span></span><br><span class="line">      <span class="keyword">if</span> (time &gt; animation.Duration)</span><br><span class="line">        time = animation.Duration;</span><br><span class="line">      ranges.Add(mapView.Animation.GetCurrentRangeAtTime(time));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ranges;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建摄像机关键帧"><a href="#创建摄像机关键帧" class="headerlink" title="创建摄像机关键帧"></a>创建摄像机关键帧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateCameraKeyframe</span>(<span class="params">TimeSpan atTime</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> cameraTrack = animation.Tracks.OfType&lt;CameraTrack&gt;().First(); <span class="comment">//There will always be only 1 CameraTrack in the animation.</span></span><br><span class="line">  cameraTrack.CreateKeyframe(mapView.Camera, atTime, ArcGIS.Core.CIM.AnimationTransition.FixedArc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建时间关键帧"><a href="#创建时间关键帧" class="headerlink" title="创建时间关键帧"></a>创建时间关键帧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateTimeKeyframe</span>(<span class="params">TimeSpan atTime</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> timeTrack = animation.Tracks.OfType&lt;TimeTrack&gt;().First(); <span class="comment">//There will always be only 1 TimeTrack in the animation.</span></span><br><span class="line">  timeTrack.CreateKeyframe(mapView.Time, atTime, ArcGIS.Core.CIM.AnimationTransition.Linear);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建范围关键帧"><a href="#创建范围关键帧" class="headerlink" title="创建范围关键帧"></a>创建范围关键帧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateRangeKeyframe</span>(<span class="params">ArcGIS.Desktop.Mapping.Range range, TimeSpan atTime</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> rangeTrack = animation.Tracks.OfType&lt;RangeTrack&gt;().First(); <span class="comment">//There will always be only 1 RangeTrack in the animation.</span></span><br><span class="line">  rangeTrack.CreateKeyframe(range, atTime, ArcGIS.Core.CIM.AnimationTransition.Linear);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建图层关键帧"><a href="#创建图层关键帧" class="headerlink" title="创建图层关键帧"></a>创建图层关键帧</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateLayerKeyframe</span>(<span class="params">Layer layer, <span class="built_in">double</span> transparency, TimeSpan atTime</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> animation = mapView.Map.Animation;</span><br><span class="line">  <span class="keyword">var</span> layerTrack = animation.Tracks.OfType&lt;LayerTrack&gt;().First(); <span class="comment">//There will always be only 1 LayerTrack in the animation.</span></span><br><span class="line">  layerTrack.CreateKeyframe(layer, atTime, <span class="literal">true</span>, transparency, ArcGIS.Core.CIM.AnimationTransition.Linear);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图形叠加"><a href="#图形叠加" class="headerlink" title="图形叠加"></a>图形叠加</h2><h3 id="图形叠加-1"><a href="#图形叠加-1" class="headerlink" title="图形叠加"></a>图形叠加</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Defined elsewhere</span></span><br><span class="line"><span class="keyword">private</span> IDisposable _graphic = <span class="literal">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">GraphicOverlaySnippetTest</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get the current mapview and point</span></span><br><span class="line">  <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">  <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> myextent = mapView.Extent;</span><br><span class="line">  <span class="keyword">var</span> point = myextent.Center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add point graphic to the overlay at the center of the mapView</span></span><br><span class="line">  _graphic = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//add these to the overlay</span></span><br><span class="line">    <span class="keyword">return</span> mapView.AddOverlay(point,</span><br><span class="line">        SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                ColorFactory.Instance.RedRGB, <span class="number">30.0</span>, SimpleMarkerStyle.Star).MakeSymbolReference());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update the overlay with new point graphic symbol</span></span><br><span class="line">  MessageBox.Show(<span class="string">&quot;Now to update the overlay...&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    mapView.UpdateOverlay(_graphic, point, SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                                  ColorFactory.Instance.BlueRGB, <span class="number">20.0</span>, SimpleMarkerStyle.Circle).MakeSymbolReference());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clear the overlay display by disposing of the graphic</span></span><br><span class="line">  MessageBox.Show(<span class="string">&quot;Now to clear the overlay...&quot;</span>);</span><br><span class="line">  _graphic.Dispose();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图形叠加与-CIMPicture图形"><a href="#图形叠加与-CIMPicture图形" class="headerlink" title="图形叠加与 CIMPicture图形"></a>图形叠加与 CIMPicture图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the current mapview</span></span><br><span class="line"><span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line"><span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Valid formats for PictureURL are:</span></span><br><span class="line"><span class="comment">// e.g. local file URL:</span></span><br><span class="line"><span class="comment">// file:///&lt;path&gt;</span></span><br><span class="line"><span class="comment">// file:///c:/images/symbol.png</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// e.g. network file URL:</span></span><br><span class="line"><span class="comment">// file://&lt;host&gt;/&lt;path&gt;</span></span><br><span class="line"><span class="comment">// file://server/share/symbol.png</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// e.g. data URL:</span></span><br><span class="line"><span class="comment">// data:&lt;mediatype&gt;;base64,&lt;data&gt;</span></span><br><span class="line"><span class="comment">// data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAU ...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// image/bmp</span></span><br><span class="line"><span class="comment">// image/gif</span></span><br><span class="line"><span class="comment">// image/jpeg</span></span><br><span class="line"><span class="comment">// image/png</span></span><br><span class="line"><span class="comment">// image/tiff</span></span><br><span class="line"><span class="comment">// image/x-esri-bglf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pictureGraphic = <span class="keyword">new</span> CIMPictureGraphic</span><br><span class="line">&#123;</span><br><span class="line">  PictureURL = <span class="string">@&quot;file:///C:/Images/MyImage.png&quot;</span>,</span><br><span class="line">  Box = envelope</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">IDisposable _graphic = mapView.AddOverlay(pictureGraphic);</span><br></pre></td></tr></table></figure>

<h3 id="添加带有文本的叠加图形"><a href="#添加带有文本的叠加图形" class="headerlink" title="添加带有文本的叠加图形"></a>添加带有文本的叠加图形</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">AddOverlayWithText</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> IDisposable _graphic = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">private</span> CIMLineSymbol _lineSymbol = <span class="literal">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AddOverlayWithText</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    IsSketchTool = <span class="literal">true</span>;</span><br><span class="line">    SketchType = SketchGeometryType.Line;</span><br><span class="line">    SketchOutputMode = SketchOutputMode.Map;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Add an overlay graphic to the map view</span></span><br><span class="line">    _graphic = <span class="keyword">await</span> <span class="keyword">this</span>.AddOverlayAsync(geometry, _lineSymbol.MakeSymbolReference());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//define the text symbol</span></span><br><span class="line">    <span class="keyword">var</span> textSymbol = <span class="keyword">new</span> CIMTextSymbol();</span><br><span class="line">    <span class="comment">//define the text graphic</span></span><br><span class="line">    <span class="keyword">var</span> textGraphic = <span class="keyword">new</span> CIMTextGraphic();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Create a simple text symbol</span></span><br><span class="line">      textSymbol = SymbolFactory.Instance.ConstructTextSymbol(ColorFactory.Instance.BlackRGB, <span class="number">8.5</span>, <span class="string">&quot;Corbel&quot;</span>, <span class="string">&quot;Regular&quot;</span>);</span><br><span class="line">      <span class="comment">//Sets the geometry of the text graphic</span></span><br><span class="line">      textGraphic.Shape = geometry;</span><br><span class="line">      <span class="comment">//Sets the text string to use in the text graphic</span></span><br><span class="line">      textGraphic.Text = <span class="string">&quot;This is my line&quot;</span>;</span><br><span class="line">      <span class="comment">//Sets symbol to use to draw the text graphic</span></span><br><span class="line">      textGraphic.Symbol = textSymbol.MakeSymbolReference();</span><br><span class="line">      <span class="comment">//Draw the overlay text graphic</span></span><br><span class="line">      _graphic = <span class="keyword">this</span>.ActiveMapView.AddOverlay(textGraphic);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="更改草图工具的符号"><a href="#更改草图工具的符号" class="headerlink" title="更改草图工具的符号"></a>更改草图工具的符号</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">SketchTool_WithSymbol</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SketchTool_WithSymbol</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    IsSketchTool = <span class="literal">true</span>;</span><br><span class="line">    SketchOutputMode = SketchOutputMode.Map; <span class="comment">//Changing the Sketch Symbol is only supported with map sketches.</span></span><br><span class="line">    SketchType = SketchGeometryType.Rectangle;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">OnToolActivateAsync</span>(<span class="params"><span class="built_in">bool</span> hasMapViewChanged</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Set the Sketch Symbol if it hasn&#x27;t already been set.</span></span><br><span class="line">      <span class="keyword">if</span> (SketchSymbol != <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">var</span> polygonSymbol = SymbolFactory.Instance.ConstructPolygonSymbol(ColorFactory.Instance.CreateRGBColor(<span class="number">24</span>, <span class="number">69</span>, <span class="number">59</span>),</span><br><span class="line">                          SimpleFillStyle.Solid,</span><br><span class="line">                        SymbolFactory.Instance.ConstructStroke(ColorFactory.Instance.BlackRGB, <span class="number">1.0</span>, SimpleLineStyle.Dash));</span><br><span class="line">      SketchSymbol = polygonSymbol.MakeSymbolReference();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建用于地图中单击的点的返回坐标的工具"><a href="#创建用于地图中单击的点的返回坐标的工具" class="headerlink" title="创建用于地图中单击的点的返回坐标的工具"></a>创建用于地图中单击的点的返回坐标的工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">GetMapCoordinates</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolMouseDown</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.ChangedButton == System.Windows.Input.MouseButton.Left)</span><br><span class="line">      e.Handled = <span class="literal">true</span>; <span class="comment">//Handle the event args to get the call to the corresponding async method</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleMouseDownAsync</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Convert the clicked point in client coordinates to the corresponding map coordinates.</span></span><br><span class="line">      <span class="keyword">var</span> mapPoint = MapView.Active.ClientToMap(e.ClientPoint);</span><br><span class="line">      ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="built_in">string</span>.Format(<span class="string">&quot;X: &#123;0&#125; Y: &#123;1&#125; Z: &#123;2&#125;&quot;</span>,</span><br><span class="line">                  mapPoint.X, mapPoint.Y, mapPoint.Z), <span class="string">&quot;Map Coordinates&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建用于识别与草图几何相交的特征的工具"><a href="#创建用于识别与草图几何相交的特征的工具" class="headerlink" title="创建用于识别与草图几何相交的特征的工具"></a>创建用于识别与草图几何相交的特征的工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">CustomIdentify</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CustomIdentify</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    IsSketchTool = <span class="literal">true</span>;</span><br><span class="line">    SketchType = SketchGeometryType.Rectangle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//To perform a interactive selection or identify in 3D or 2D, sketch must be created in screen coordinates.</span></span><br><span class="line">    SketchOutputMode = SketchOutputMode.Screen;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">OnSketchCompleteAsync</span>(<span class="params">Geometry geometry</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> mapView = MapView.Active;</span><br><span class="line">      <span class="keyword">if</span> (mapView == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Get all the features that intersect the sketch geometry and flash them in the view. </span></span><br><span class="line">      <span class="keyword">var</span> results = mapView.GetFeatures(geometry);</span><br><span class="line">      mapView.FlashFeature(results);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> debug = String.Join(<span class="string">&quot;\n&quot;</span>, results.ToDictionary()</span><br><span class="line">                    .Select(kvp =&gt; String.Format(<span class="string">&quot;&#123;0&#125;: &#123;1&#125;&quot;</span>, kvp.Key.Name, kvp.Value.Count())));</span><br><span class="line">      System.Diagnostics.Debug.WriteLine(debug);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改工具的光标"><a href="#更改工具的光标" class="headerlink" title="更改工具的光标"></a>更改工具的光标</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">CustomMapTool</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CustomMapTool</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    IsSketchTool = <span class="literal">true</span>;</span><br><span class="line">    SketchType = SketchGeometryType.Rectangle;</span><br><span class="line">    SketchOutputMode = SketchOutputMode.Map;</span><br><span class="line">    <span class="comment">//A custom cursor file as an embedded resource</span></span><br><span class="line">    <span class="keyword">var</span> cursorEmbeddedResource = <span class="keyword">new</span> Cursor(<span class="keyword">new</span> MemoryStream(Resource1.red_cursor));</span><br><span class="line">    <span class="comment">//A built in system cursor</span></span><br><span class="line">    <span class="keyword">var</span> systemCursor = System.Windows.Input.Cursors.ArrowCD;</span><br><span class="line">    <span class="comment">//Set the &quot;CustomMapTool&#x27;s&quot; Cursor property to either one of the cursors defined above</span></span><br><span class="line">    Cursor = cursorEmbeddedResource;</span><br><span class="line">    <span class="comment">//or</span></span><br><span class="line">    Cursor = systemCursor;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="具有可嵌入控件的工具"><a href="#具有可嵌入控件的工具" class="headerlink" title="具有可嵌入控件的工具"></a>具有可嵌入控件的工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Using the Visual Studio SDK templates, add a MapTool and an EmbeddableControl</span></span><br><span class="line"><span class="comment">// The EmbeddableControl is registered in the &quot;esri_embeddableControls&quot; category in the config.daml file</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//  &lt;categories&gt;</span></span><br><span class="line"><span class="comment">//    &lt;updateCategory refID = &quot;esri_embeddableControls&quot; &gt;</span></span><br><span class="line"><span class="comment">//      &lt;insertComponent id=&quot;mapTool_EmbeddableControl&quot; className=&quot;EmbeddableControl1ViewModel&quot;&gt;</span></span><br><span class="line"><span class="comment">//        &lt;content className = &quot;EmbeddableControl1View&quot; /&gt;</span></span><br><span class="line"><span class="comment">//      &lt;/insertComponent&gt;</span></span><br><span class="line"><span class="comment">//    &lt;updateCategory&gt;</span></span><br><span class="line"><span class="comment">//  &lt;/categories&gt;</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MapTool_WithControl</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MapTool_WithControl</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// substitute this string with the daml ID of the embeddable control you added</span></span><br><span class="line">    ControlID = <span class="string">&quot;mapTool_EmbeddableControl&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolMouseDown</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    e.Handled = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleMouseDownAsync</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the instance of the ViewModel</span></span><br><span class="line">    <span class="keyword">var</span> vm = EmbeddableControl;</span><br><span class="line">    <span class="keyword">if</span> (vm == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> Task.FromResult(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cast vm to your viewModel in order to access your properties</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the map coordinates from the click point and set the property on the ViewMode.</span></span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> mapPoint = MapView.Active.ClientToMap(e.ClientPoint);</span><br><span class="line">      <span class="built_in">string</span> clickText = <span class="built_in">string</span>.Format(<span class="string">&quot;X: &#123;0&#125;, Y: &#123;1&#125;, Z: &#123;2&#125;&quot;</span>, mapPoint.X, mapPoint.Y, mapPoint.Z);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="具有可嵌入叠加控件的工具"><a href="#具有可嵌入叠加控件的工具" class="headerlink" title="具有可嵌入叠加控件的工具"></a>具有可嵌入叠加控件的工具</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Using the Visual Studio SDK templates, add a MapTool and an EmbeddableControl</span></span><br><span class="line"><span class="comment">// The EmbeddableControl is registered in the &quot;esri_embeddableControls&quot; category in the config.daml file</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//  &lt;categories&gt;</span></span><br><span class="line"><span class="comment">//    &lt;updateCategory refID = &quot;esri_embeddableControls&quot; &gt;</span></span><br><span class="line"><span class="comment">//      &lt;insertComponent id=&quot;mapTool_EmbeddableControl&quot; className=&quot;EmbeddableControl1ViewModel&quot;&gt;</span></span><br><span class="line"><span class="comment">//        &lt;content className = &quot;EmbeddableControl1View&quot; /&gt;</span></span><br><span class="line"><span class="comment">//      &lt;/insertComponent&gt;</span></span><br><span class="line"><span class="comment">//    &lt;updateCategory&gt;</span></span><br><span class="line"><span class="comment">//  &lt;/categories&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MapTool_WithOverlayControl</span> : <span class="title">MapTool</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MapTool_WithOverlayControl</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// substitute this string with the daml ID of the embeddable control you added</span></span><br><span class="line">    OverlayControlID = <span class="string">&quot;mapTool_EmbeddableControl&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnToolMouseDown</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    e.Handled = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleMouseDownAsync</span>(<span class="params">MapViewMouseButtonEventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Get the instance of the ViewModel</span></span><br><span class="line">    <span class="keyword">var</span> vm = OverlayEmbeddableControl;</span><br><span class="line">    <span class="keyword">if</span> (vm == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> Task.FromResult(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cast vm to your viewModel in order to access your properties</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get the map coordinates from the click point and set the property on the ViewMode.</span></span><br><span class="line">    <span class="keyword">return</span> QueuedTask.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> mapPoint = MapView.Active.ClientToMap(e.ClientPoint);</span><br><span class="line">      <span class="built_in">string</span> clickText = <span class="built_in">string</span>.Format(<span class="string">&quot;X: &#123;0&#125;, Y: &#123;1&#125;, Z: &#123;2&#125;&quot;</span>, mapPoint.X, mapPoint.Y, mapPoint.Z);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="共享"><a href="#共享" class="headerlink" title="共享"></a>共享</h1><h3 id="ArcGIS-项目管理器：获取当前活动门户"><a href="#ArcGIS-项目管理器：获取当前活动门户" class="headerlink" title="ArcGIS 项目管理器：获取当前活动门户"></a>ArcGIS 项目管理器：获取当前活动门户</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> active_portal = ArcGISPortalManager.Current.GetActivePortal();</span><br><span class="line"><span class="built_in">string</span> uri = active_portal.PortalUri.ToString();</span><br></pre></td></tr></table></figure>

<h3 id="ArcGIS-项目管理器：获取所有门户的列表"><a href="#ArcGIS-项目管理器：获取所有门户的列表" class="headerlink" title="ArcGIS 项目管理器：获取所有门户的列表"></a>ArcGIS 项目管理器：获取所有门户的列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portals = ArcGISPortalManager.Current.GetPortals();</span><br><span class="line"><span class="comment">//Make a list of all the Uris</span></span><br><span class="line"><span class="keyword">var</span> portalUris = portals.Select(p =&gt; p.PortalUri.ToString()).ToList();</span><br></pre></td></tr></table></figure>

<h3 id="ArcGIS-项目管理器：将门户添加到门户列表"><a href="#ArcGIS-项目管理器：将门户添加到门户列表" class="headerlink" title="ArcGIS 项目管理器：将门户添加到门户列表"></a>ArcGIS 项目管理器：将门户添加到门户列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portalUri = <span class="keyword">new</span> Uri(<span class="string">&quot;http://myportal.esri.com/portal/&quot;</span>, UriKind.Absolute);</span><br><span class="line">ArcGISPortalManager.Current.AddPortal(portalUri);</span><br></pre></td></tr></table></figure>

<h3 id="ArcGIS-项目管理器：获取门户并登录，将其设置为活动状态"><a href="#ArcGIS-项目管理器：获取门户并登录，将其设置为活动状态" class="headerlink" title="ArcGIS 项目管理器：获取门户并登录，将其设置为活动状态"></a>ArcGIS 项目管理器：获取门户并登录，将其设置为活动状态</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Find the portal to sign in with using its Uri...</span></span><br><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetPortal(<span class="keyword">new</span> Uri(uri, UriKind.Absolute));</span><br><span class="line"><span class="keyword">if</span> (!portal.IsSignedOn())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Calling &quot;SignIn&quot; will trigger the OAuth popup if your credentials are</span></span><br><span class="line">  <span class="comment">//not cached (eg from a previous sign in in the session)</span></span><br><span class="line">  <span class="keyword">if</span> (portal.SignIn().success)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Set this portal as my active portal</span></span><br><span class="line">    ArcGISPortalManager.Current.SetActivePortal(portal);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ArcGIS-程序管理器：侦听门户事件"><a href="#ArcGIS-程序管理器：侦听门户事件" class="headerlink" title="ArcGIS 程序管理器：侦听门户事件"></a>ArcGIS 程序管理器：侦听门户事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ArcGIS.Desktop.Core.Events.ActivePortalChangedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> active_uri = args.ActivePortal?.PortalUri.ToString();</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Core.Events.ArcGISPortalAddedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> added_portal = args.Portal;</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Core.Events.ArcGISPortalRemovedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> old_uri = args.RemovedPortalUri;</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Core.Events.PortalSignOnChangedEvent.Subscribe((args) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> portal = args.Portal;</span><br><span class="line">  <span class="keyword">var</span> isSignedOn = args.IsSignedOn;</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="门户：从活动门户获取当前登录用户"><a href="#门户：从活动门户获取当前登录用户" class="headerlink" title="门户：从活动门户获取当前登录用户"></a>门户：从活动门户获取当前登录用户</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetActivePortal();</span><br><span class="line"><span class="comment">//Force login</span></span><br><span class="line"><span class="keyword">if</span> (!portal.IsSignedOn())</span><br><span class="line">&#123;</span><br><span class="line">  portal.SignIn();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> user = portal.GetSignOnUsername();</span><br></pre></td></tr></table></figure>

<h3 id="门户：获取当前用户的“联机”门户视图"><a href="#门户：获取当前用户的“联机”门户视图" class="headerlink" title="门户：获取当前用户的“联机”门户视图"></a>门户：获取当前用户的“联机”门户视图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//If no-one is signed in, this will be the default view for</span></span><br><span class="line"><span class="comment">//the anonymous user.</span></span><br><span class="line"><span class="keyword">var</span> online = ArcGISPortalManager.Current.GetPortal(<span class="keyword">new</span> Uri(<span class="string">&quot;http://www.arcgis.com&quot;</span>));</span><br><span class="line"><span class="keyword">var</span> portalInfo = <span class="keyword">await</span> online.GetPortalInfoAsync();</span><br></pre></td></tr></table></figure>

<h3 id="门户：获取当前用户的组织-ID"><a href="#门户：获取当前用户的组织-ID" class="headerlink" title="门户：获取当前用户的组织 ID"></a>门户：获取当前用户的组织 ID</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetPortal(<span class="keyword">new</span> Uri(portalUri));</span><br><span class="line"><span class="keyword">var</span> portalInfo = <span class="keyword">await</span> portal.GetPortalInfoAsync();</span><br><span class="line"><span class="keyword">var</span> orgid = portalInfo.OrganizationId;</span><br></pre></td></tr></table></figure>

<h3 id="门户：从活动门户获取活动用户的用户内容"><a href="#门户：从活动门户获取活动用户的用户内容" class="headerlink" title="门户：从活动门户获取活动用户的用户内容"></a>门户：从活动门户获取活动用户的用户内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetActivePortal();</span><br><span class="line"><span class="keyword">var</span> owner = portal.GetSignOnUsername();</span><br><span class="line"><span class="keyword">var</span> userContent = <span class="keyword">await</span> portal.GetUserContentAsync(owner);</span><br><span class="line"><span class="comment">//Get content for a specific folder (identified by its folder id)</span></span><br><span class="line"><span class="comment">//var userContent = await portal.GetUserContentAsync(owner, folderId);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Get all the folders</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> pf <span class="keyword">in</span> userContent.PortalFolders)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do something with the folders</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get all the content items</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> pi <span class="keyword">in</span> userContent.PortalItems)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do something with the portal items</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="门户：下载用户内容中的任何包项"><a href="#门户：下载用户内容中的任何包项" class="headerlink" title="门户：下载用户内容中的任何包项"></a>门户：下载用户内容中的任何包项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//user content previously from...</span></span><br><span class="line"><span class="comment">//var userContent = await portal.GetUserContentAsync(owner);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> packages = <span class="keyword">new</span> List&lt;PortalItemType&gt;</span><br><span class="line">&#123;</span><br><span class="line">  PortalItemType.BasemapPackage,</span><br><span class="line">  PortalItemType.GeoprocessingPackage,</span><br><span class="line">  PortalItemType.LayerPackage,</span><br><span class="line">  PortalItemType.LocatorPackage,</span><br><span class="line">  PortalItemType.MapPackage,</span><br><span class="line">  PortalItemType.ProjectPackage,</span><br><span class="line">  PortalItemType.ScenePackage,</span><br><span class="line">  PortalItemType.RulePackage,</span><br><span class="line">  PortalItemType.VectorTilePackage</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> folder = <span class="string">@&quot;E:\Temp\PortalAPITest\&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> di <span class="keyword">in</span> userContent.PortalItems.Where(pi =&gt; packages.Contains(pi.PortalItemType)))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> path = System.IO.Path.Combine(folder, di.Name);</span><br><span class="line">  <span class="keyword">await</span> di.GetItemDataAsync(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="门户：获取指定用户的组"><a href="#门户：获取指定用户的组" class="headerlink" title="门户：获取指定用户的组"></a>门户：获取指定用户的组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//elsewhere...</span></span><br><span class="line"><span class="comment">//var owner = portal.GetSignOnUsername();</span></span><br><span class="line"><span class="keyword">var</span> groups = <span class="keyword">await</span> portal.GetGroupsFromUserAsync(owner);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> groups)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do something with the portal groups</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="门户：执行门户搜索"><a href="#门户：执行门户搜索" class="headerlink" title="门户：执行门户搜索"></a>门户：执行门户搜索</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> portal = ArcGISPortalManager.Current.GetPortal(portalUri);</span><br><span class="line"><span class="keyword">var</span> owner = portal.GetSignOnUsername();</span><br><span class="line"><span class="keyword">var</span> portalInfo = <span class="keyword">await</span> portal.GetPortalInfoAsync();</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. Get all web maps</span></span><br><span class="line"><span class="keyword">var</span> query1 = PortalQueryParameters.CreateForItemsOfType(PortalItemType.WebMap);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. Get all web maps and map services - include user, organization</span></span><br><span class="line"><span class="comment">// and &quot;usa&quot; in the title</span></span><br><span class="line"><span class="keyword">var</span> query2 = PortalQueryParameters.CreateForItemsOfTypes(<span class="keyword">new</span> List&lt;PortalItemType&gt;() &#123;</span><br><span class="line">  PortalItemType.WebMap, PortalItemType.MapService&#125;, owner, <span class="string">&quot;&quot;</span>, <span class="string">&quot;title:usa&quot;</span>);</span><br><span class="line">query2.OrganizationId = portalInfo.OrganizationId;</span><br><span class="line"></span><br><span class="line"><span class="comment">//retrieve in batches of up to a 100 each time</span></span><br><span class="line">query2.Limit = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Loop until done</span></span><br><span class="line"><span class="keyword">var</span> portalItems = <span class="keyword">new</span> List&lt;PortalItem&gt;();</span><br><span class="line"><span class="keyword">while</span> (query2 != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//run the search</span></span><br><span class="line">  PortalQueryResultSet&lt;PortalItem&gt; results = <span class="keyword">await</span> portal.SearchForContentAsync(query2);</span><br><span class="line">  portalItems.AddRange(results.Results);</span><br><span class="line">  query2 = results.NextQueryParameters;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//process results</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> pi <span class="keyword">in</span> portalItems)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Do something with the portal items</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EsriHttpClient：获取当前登录用户"><a href="#EsriHttpClient：获取当前登录用户" class="headerlink" title="EsriHttpClient：获取当前登录用户"></a>EsriHttpClient：获取当前登录用户</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Reference Newtonsoft - Json.Net</span></span><br><span class="line"><span class="comment">//Reference System.Net.Http</span></span><br><span class="line">UriBuilder selfURL = <span class="keyword">new</span> UriBuilder(ArcGISPortalManager.Current.GetActivePortal().PortalUri)</span><br><span class="line">&#123;</span><br><span class="line">  Path = <span class="string">&quot;sharing/rest/portals/self&quot;</span>,</span><br><span class="line">  Query = <span class="string">&quot;f=json&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">EsriHttpResponseMessage response = <span class="keyword">new</span> EsriHttpClient().Get(selfURL.Uri.ToString());</span><br><span class="line"></span><br><span class="line"><span class="built_in">dynamic</span> portalSelf = JObject.Parse(<span class="keyword">await</span> response.Content.ReadAsStringAsync());</span><br><span class="line"><span class="comment">// if the response doesn&#x27;t contain the user information then it is essentially</span></span><br><span class="line"><span class="comment">// an anonymous request against the portal</span></span><br><span class="line"><span class="keyword">if</span> (portalSelf.user == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="built_in">string</span> userName = portalSelf.user.username;</span><br></pre></td></tr></table></figure>

<h3 id="获取当前登录用户的组"><a href="#获取当前登录用户的组" class="headerlink" title="获取当前登录用户的组"></a>获取当前登录用户的组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Assume that you have executed the &quot;Get the Current signed on User&quot; snippet and have &#x27;userName&#x27;</span></span><br><span class="line">UriBuilder groupsURL = <span class="keyword">new</span> UriBuilder(ArcGISPortalManager.Current.GetActivePortal().PortalUri)</span><br><span class="line">&#123;</span><br><span class="line">  Path = String.Format(<span class="string">&quot;sharing/rest/community/users/&#123;0&#125;&quot;</span>, userName),</span><br><span class="line">  Query = <span class="string">&quot;f=json&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> groupResponse = <span class="keyword">new</span> EsriHttpClient().Get(groupsURL.Uri.ToString());</span><br><span class="line"><span class="built_in">dynamic</span> portalGroups = JObject.Parse(<span class="keyword">await</span> groupResponse.Content.ReadAsStringAsync());</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> groups = portalGroups.groups.ToString();</span><br></pre></td></tr></table></figure>

<h3 id="EsriHttpClient：查询活动门户上的-Esri-内容"><a href="#EsriHttpClient：查询活动门户上的-Esri-内容" class="headerlink" title="EsriHttpClient：查询活动门户上的 Esri 内容"></a>EsriHttpClient：查询活动门户上的 Esri 内容</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http://www.arcgis.com/sharing/search?q=owner:esri&amp;f=json</span></span><br><span class="line"></span><br><span class="line">UriBuilder searchURL = <span class="keyword">new</span> UriBuilder(ArcGISPortalManager.Current.GetActivePortal().PortalUri)</span><br><span class="line">&#123;</span><br><span class="line">  Path = <span class="string">&quot;sharing/rest/search&quot;</span>,</span><br><span class="line">  Query = <span class="string">&quot;q=owner:esri&amp;f=json&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">EsriHttpClient httpClient = <span class="keyword">new</span> EsriHttpClient();</span><br><span class="line"><span class="keyword">var</span> searchResponse = httpClient.Get(searchURL.Uri.ToString());</span><br><span class="line"><span class="built_in">dynamic</span> resultItems = JObject.Parse(<span class="keyword">await</span> searchResponse.Content.ReadAsStringAsync());</span><br><span class="line"></span><br><span class="line"><span class="built_in">long</span> numberOfTotalItems = resultItems.total.Value;</span><br><span class="line"><span class="built_in">long</span> currentCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">List&lt;<span class="built_in">dynamic</span>&gt; resultItemList = <span class="keyword">new</span> List&lt;<span class="built_in">dynamic</span>&gt;();</span><br><span class="line"><span class="comment">// store the first results in the list</span></span><br><span class="line">resultItemList.AddRange(resultItems.results);</span><br><span class="line">currentCount = currentCount + resultItems.num.Value;</span><br><span class="line"><span class="comment">//Up to 50</span></span><br><span class="line"><span class="keyword">while</span> (currentCount &lt; numberOfTotalItems &amp;&amp; currentCount &lt;= <span class="number">50</span>)</span><br><span class="line">&#123;</span><br><span class="line">  searchURL.Query = String.Format(<span class="string">&quot;q=owner:esri&amp;start=&#123;0&#125;&amp;f=json&quot;</span>, resultItems.nextStart.Value);</span><br><span class="line">  searchResponse = httpClient.Get(searchURL.Uri.ToString());</span><br><span class="line">  resultItems = JObject.Parse(<span class="keyword">await</span> searchResponse.Content.ReadAsStringAsync());</span><br><span class="line">  resultItemList.AddRange(resultItems.results);</span><br><span class="line">  currentCount = currentCount + resultItems.num.Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EsriHttpClient：获取当前用户的-web-地图并将其添加到专业版"><a href="#EsriHttpClient：获取当前用户的-web-地图并将其添加到专业版" class="headerlink" title="EsriHttpClient：获取当前用户的 web 地图并将其添加到专业版"></a>EsriHttpClient：获取当前用户的 web 地图并将其添加到专业版</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">UriBuilder searchURL = <span class="keyword">new</span> UriBuilder(ArcGISPortalManager.Current.GetActivePortal().PortalUri)</span><br><span class="line">&#123;</span><br><span class="line">  Path = <span class="string">&quot;sharing/rest/portals/self&quot;</span>,</span><br><span class="line">  Query = <span class="string">&quot;f=json&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">EsriHttpClient httpClient = <span class="keyword">new</span> EsriHttpClient();</span><br><span class="line">EsriHttpResponseMessage response = httpClient.Get(searchURL.Uri.ToString());</span><br><span class="line"></span><br><span class="line"><span class="built_in">dynamic</span> portalSelf = JObject.Parse(<span class="keyword">await</span> response.Content.ReadAsStringAsync());</span><br><span class="line"><span class="comment">// if the response doesn&#x27;t contain the user information then it is essentially</span></span><br><span class="line"><span class="comment">// an anonymous request against the portal</span></span><br><span class="line"><span class="keyword">if</span> (portalSelf.user == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="built_in">string</span> userName = portalSelf.user.username;</span><br><span class="line"></span><br><span class="line">searchURL.Path = <span class="string">&quot;sharing/rest/search&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> webMaps = <span class="string">&quot;(type:\&quot;Web Map\&quot; OR type:\&quot;Explorer Map\&quot; OR type:\&quot;Web Mapping Application\&quot; OR type:\&quot;Online Map\&quot;)&quot;</span>;</span><br><span class="line">searchURL.Query = <span class="built_in">string</span>.Format(<span class="string">&quot;q=owner:&#123;0&#125; &#123;1&#125;&amp;f=json&quot;</span>, userName, webMaps);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> searchResponse = httpClient.Get(searchURL.Uri.ToString());</span><br><span class="line"><span class="built_in">dynamic</span> resultItems = JObject.Parse(<span class="keyword">await</span> searchResponse.Content.ReadAsStringAsync());</span><br><span class="line"></span><br><span class="line"><span class="built_in">long</span> numberOfTotalItems = resultItems.total.Value;</span><br><span class="line"><span class="keyword">if</span> (numberOfTotalItems == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">List&lt;<span class="built_in">dynamic</span>&gt; resultItemList = <span class="keyword">new</span> List&lt;<span class="built_in">dynamic</span>&gt;();</span><br><span class="line">resultItemList.AddRange(resultItems.results);</span><br><span class="line"><span class="comment">//get the first result</span></span><br><span class="line"><span class="built_in">dynamic</span> item = resultItemList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> itemID = item.id;</span><br><span class="line">Item currentItem = ItemFactory.Instance.Create(itemID, ItemFactory.ItemType.PortalItem);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (MapFactory.Instance.CanCreateMapFrom(currentItem))</span><br><span class="line">&#123;</span><br><span class="line">  Map newMap = MapFactory.Instance.CreateMapFromItem(currentItem);</span><br><span class="line">  <span class="keyword">await</span> ProApp.Panes.CreateMapPaneAsync(newMap);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EsriHttpClient：获取服务图层并将其添加到专业版"><a href="#EsriHttpClient：获取服务图层并将其添加到专业版" class="headerlink" title="EsriHttpClient：获取服务图层并将其添加到专业版"></a>EsriHttpClient：获取服务图层并将其添加到专业版</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">UriBuilder searchURL = <span class="keyword">new</span> UriBuilder(ArcGISPortalManager.Current.GetActivePortal().PortalUri)</span><br><span class="line">&#123;</span><br><span class="line">  Path = <span class="string">&quot;sharing/rest/search&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> layers = <span class="string">&quot;(type:\&quot;Map Service\&quot; OR type:\&quot;Image Service\&quot; OR type:\&quot;Feature Service\&quot; OR type:\&quot;WMS\&quot; OR type:\&quot;KML\&quot;)&quot;</span>;</span><br><span class="line"><span class="comment">//any public layer content</span></span><br><span class="line">searchURL.Query = <span class="built_in">string</span>.Format(<span class="string">&quot;q=&#123;0&#125;&amp;f=json&quot;</span>, layers);</span><br><span class="line"></span><br><span class="line">EsriHttpClient httpClient = <span class="keyword">new</span> EsriHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> searchResponse = httpClient.Get(searchURL.Uri.ToString());</span><br><span class="line"><span class="built_in">dynamic</span> resultItems = JObject.Parse(<span class="keyword">await</span> searchResponse.Content.ReadAsStringAsync());</span><br><span class="line"></span><br><span class="line"><span class="built_in">long</span> numberOfTotalItems = resultItems.total.Value;</span><br><span class="line"><span class="keyword">if</span> (numberOfTotalItems == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">List&lt;<span class="built_in">dynamic</span>&gt; resultItemList = <span class="keyword">new</span> List&lt;<span class="built_in">dynamic</span>&gt;();</span><br><span class="line">resultItemList.AddRange(resultItems.results);</span><br><span class="line"><span class="comment">//get the first result</span></span><br><span class="line"><span class="built_in">dynamic</span> item = resultItemList[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> itemID = item.id;</span><br><span class="line">Item currentItem = ItemFactory.Instance.Create(itemID, ItemFactory.ItemType.PortalItem);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">//Create a LayerCreationParam</span></span><br><span class="line">      <span class="keyword">var</span> layerParam = <span class="keyword">new</span> LayerCreationParams(currentItem);</span><br><span class="line">      <span class="comment">// if we have an item that can be turned into a layer</span></span><br><span class="line">      <span class="comment">// add it to the map</span></span><br><span class="line">      <span class="keyword">if</span> (LayerFactory.Instance.CanCreateLayerFrom(currentItem))</span><br><span class="line">    LayerFactory.Instance.CreateLayer&lt;FeatureLayer&gt;(layerParam, MapView.Active.Map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="公共设施网络-1"><a href="#公共设施网络-1" class="headerlink" title="公共设施网络"></a>公共设施网络</h1><h2 id="获取公共设施网络"><a href="#获取公共设施网络" class="headerlink" title="获取公共设施网络"></a>获取公共设施网络</h2><h3 id="从表中获取公共设施网络"><a href="#从表中获取公共设施网络" class="headerlink" title="从表中获取公共设施网络"></a>从表中获取公共设施网络</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UtilityNetwork <span class="title">GetUtilityNetworkFromTable</span>(<span class="params">Table table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  UtilityNetwork utilityNetwork = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (table.IsControllerDatasetSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Tables can belong to multiple controller datasets, but at most one of them will be a UtilityNetwork</span></span><br><span class="line">    IReadOnlyList&lt;Dataset&gt; controllerDatasets = table.GetControllerDatasets();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (Dataset controllerDataset <span class="keyword">in</span> controllerDatasets)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (controllerDataset <span class="keyword">is</span> UtilityNetwork)</span><br><span class="line">      &#123;</span><br><span class="line">        utilityNetwork = controllerDataset <span class="keyword">as</span> UtilityNetwork;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        controllerDataset.Dispose();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> utilityNetwork;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从图层获取公共设施网络"><a href="#从图层获取公共设施网络" class="headerlink" title="从图层获取公共设施网络"></a>从图层获取公共设施网络</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This routine obtains a utility network from a FeatureLayer, SubtypeGroupLayer, or UtilityNetworkLayer</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UtilityNetwork <span class="title">GetUtilityNetworkFromLayer</span>(<span class="params">Layer layer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  UtilityNetwork utilityNetwork = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (layer <span class="keyword">is</span> UtilityNetworkLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    UtilityNetworkLayer utilityNetworkLayer = layer <span class="keyword">as</span> UtilityNetworkLayer;</span><br><span class="line">    utilityNetwork = utilityNetworkLayer.GetUtilityNetwork();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (layer <span class="keyword">is</span> SubtypeGroupLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    CompositeLayer compositeLayer = layer <span class="keyword">as</span> CompositeLayer;</span><br><span class="line">    utilityNetwork = GetUtilityNetworkFromLayer(compositeLayer.Layers.First());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (layer <span class="keyword">is</span> FeatureLayer)</span><br><span class="line">  &#123;</span><br><span class="line">    FeatureLayer featureLayer = layer <span class="keyword">as</span> FeatureLayer;</span><br><span class="line">    <span class="keyword">using</span> (FeatureClass featureClass = featureLayer.GetFeatureClass())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (featureClass.IsControllerDatasetSupported())</span><br><span class="line">      &#123;</span><br><span class="line">        IReadOnlyList&lt;Dataset&gt; controllerDatasets = <span class="keyword">new</span> List&lt;Dataset&gt;();</span><br><span class="line">        controllerDatasets = featureClass.GetControllerDatasets();</span><br><span class="line">        <span class="keyword">foreach</span> (Dataset controllerDataset <span class="keyword">in</span> controllerDatasets)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (controllerDataset <span class="keyword">is</span> UtilityNetwork)</span><br><span class="line">          &#123;</span><br><span class="line">            utilityNetwork = controllerDataset <span class="keyword">as</span> UtilityNetwork;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            controllerDataset.Dispose();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> utilityNetwork;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="元素"><a href="#元素" class="headerlink" title="元素"></a>元素</h2><h3 id="从元素中获取行"><a href="#从元素中获取行" class="headerlink" title="从元素中获取行"></a>从元素中获取行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// usage :   using (var row = FetchRowFromElement(...))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Row <span class="title">FetchRowFromElement</span>(<span class="params">UtilityNetwork utilityNetwork, Element element</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the table from the element</span></span><br><span class="line">  <span class="keyword">using</span> (Table table = utilityNetwork.GetTable(element.NetworkSource))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a query filter to fetch the appropriate row</span></span><br><span class="line">    QueryFilter queryFilter = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">    &#123;</span><br><span class="line">      ObjectIDs = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; element.ObjectID &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fetch and return the row</span></span><br><span class="line">    <span class="keyword">using</span> (RowCursor rowCursor = table.Search(queryFilter))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (rowCursor.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> rowCursor.Current;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编辑关联"><a href="#编辑关联" class="headerlink" title="编辑关联"></a>编辑关联</h2><h3 id="创建公共设施网络关联-1"><a href="#创建公共设施网络关联-1" class="headerlink" title="创建公共设施网络关联"></a>创建公共设施网络关联</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create edit operation</span></span><br><span class="line">EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">editOperation.Name = <span class="string">&quot;Create structural attachment association&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a RowHandle for the pole</span></span><br><span class="line"></span><br><span class="line">Element poleElement = utilityNetwork.CreateElement(poleAssetType, poleGlobalID);</span><br><span class="line">RowHandle poleRowHandle = <span class="keyword">new</span> RowHandle(poleElement, utilityNetwork);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a RowHandle for the transformer bank</span></span><br><span class="line"></span><br><span class="line">Element transformerBankElement = utilityNetwork.CreateElement(transformerBankAssetType, transformerBankGlobalID);</span><br><span class="line">RowHandle transformerBankRowHandle = <span class="keyword">new</span> RowHandle(transformerBankElement, utilityNetwork);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attach the transformer bank to the pole</span></span><br><span class="line"></span><br><span class="line">AssociationDescription structuralAttachmentAssociationDescription = <span class="keyword">new</span> AssociationDescription(AssociationType.Attachment, poleRowHandle, transformerBankRowHandle);</span><br><span class="line">editOperation.Create(structuralAttachmentAssociationDescription);</span><br><span class="line">editOperation.Execute();</span><br></pre></td></tr></table></figure>

<h3 id="在单个编辑操作中创建公共设施网络要素和关联-1"><a href="#在单个编辑操作中创建公共设施网络要素和关联-1" class="headerlink" title="在单个编辑操作中创建公共设施网络要素和关联"></a>在单个编辑操作中创建公共设施网络要素和关联</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an EditOperation</span></span><br><span class="line">EditOperation editOperation = <span class="keyword">new</span> EditOperation();</span><br><span class="line">editOperation.Name = <span class="string">&quot;Create pole; create transformer bank; attach transformer bank to pole&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the transformer bank</span></span><br><span class="line">RowToken transformerBankToken = editOperation.Create(transformerBankLayer, transformerBankAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a pole</span></span><br><span class="line">RowToken poleToken = editOperation.Create(poleLayer, poleAttributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a structural attachment association between the pole and the transformer bank</span></span><br><span class="line">RowHandle poleHandle = <span class="keyword">new</span> RowHandle(poleToken);</span><br><span class="line">RowHandle transformerBankHandle = <span class="keyword">new</span> RowHandle(transformerBankToken);</span><br><span class="line"></span><br><span class="line">AssociationDescription poleAttachment = <span class="keyword">new</span> AssociationDescription(AssociationType.Attachment, poleHandle, transformerBankHandle);</span><br><span class="line"></span><br><span class="line">editOperation.Create(poleAttachment);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the EditOperation</span></span><br><span class="line">editOperation.Execute();</span><br></pre></td></tr></table></figure>

<h2 id="遍历关联"><a href="#遍历关联" class="headerlink" title="遍历关联"></a>遍历关联</h2><h3 id="获取向下遍历产生的遍历关联"><a href="#获取向下遍历产生的遍历关联" class="headerlink" title="获取向下遍历产生的遍历关联"></a>获取向下遍历产生的遍历关联</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GetTraverseAssociationsResultFromDownwardTraversal</span>(<span class="params">UtilityNetwork utilityNetwork, IReadOnlyList&lt;Element&gt; startingElements</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Set downward traversal with maximum depth</span></span><br><span class="line">  TraverseAssociationsDescription traverseAssociationsDescription = <span class="keyword">new</span> TraverseAssociationsDescription(TraversalDirection.Descending);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get traverse associations result from the staring element up to maximum depth</span></span><br><span class="line">  TraverseAssociationsResult traverseAssociationsResult = utilityNetwork.TraverseAssociations(startingElements, traverseAssociationsDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get associations participated in traversal</span></span><br><span class="line">  IReadOnlyList&lt;Association&gt; associations = traverseAssociationsResult.Associations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取具有深度限制的向上遍历产生的遍历关联"><a href="#获取具有深度限制的向上遍历产生的遍历关联" class="headerlink" title="获取具有深度限制的向上遍历产生的遍历关联"></a>获取具有深度限制的向上遍历产生的遍历关联</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GetTraverseAssociationsResultFromUpwardTraversalWithDepthLimit</span>(<span class="params">UtilityNetwork utilityNetwork, IReadOnlyList&lt;Element&gt; startingElements</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// List of fields whose values will be fetched as name-values pairs during association traversal operation</span></span><br><span class="line">  List&lt;<span class="built_in">string</span>&gt; additionalFieldsToFetch = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;ObjectId&quot;</span>, <span class="string">&quot;AssetName&quot;</span>, <span class="string">&quot;AssetGroup&quot;</span>, <span class="string">&quot;AssetType&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set downward traversal with maximum depth level of 3 </span></span><br><span class="line">  TraverseAssociationsDescription traverseAssociationsDescription = <span class="keyword">new</span> TraverseAssociationsDescription(TraversalDirection.Ascending, <span class="number">3</span>) </span><br><span class="line">  &#123; </span><br><span class="line">    AdditionalFields = additionalFieldsToFetch </span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get traverse associations result from the staring element up to depth level 3</span></span><br><span class="line">  TraverseAssociationsResult traverseAssociationsResult = utilityNetwork.TraverseAssociations(startingElements, traverseAssociationsDescription);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// List of associations participated in traversal</span></span><br><span class="line">  IReadOnlyList&lt;Association&gt; associations = traverseAssociationsResult.Associations;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// KeyValue mapping between involved elements and their field name-values </span></span><br><span class="line">  <span class="comment">//At 2.x - IReadOnlyDictionary&lt;Element, IReadOnlyList&lt;AssociationElementFieldValue&gt;&gt; associationElementValuePairs = traverseAssociationsResult.AdditionalFieldValues;</span></span><br><span class="line">  IReadOnlyDictionary&lt;Element, IReadOnlyList&lt;FieldValue&gt;&gt; associationElementValuePairs = </span><br><span class="line">    traverseAssociationsResult.AdditionalFieldValues;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (KeyValuePair&lt;Element, IReadOnlyList&lt;FieldValue&gt;&gt; keyValuePair <span class="keyword">in</span> associationElementValuePairs)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Element </span></span><br><span class="line">    Element element = keyValuePair.Key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List of field names and their values </span></span><br><span class="line">    <span class="comment">//At 2.x - IReadOnlyList&lt;AssociationElementFieldValue&gt; elementFieldValues = keyValuePair.Value;</span></span><br><span class="line">    IReadOnlyList&lt;FieldValue&gt; elementFieldValues = keyValuePair.Value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="子网和层"><a href="#子网和层" class="headerlink" title="子网和层"></a>子网和层</h2><h3 id="查找给定域网络名称和层名称的层"><a href="#查找给定域网络名称和层名称的层" class="headerlink" title="查找给定域网络名称和层名称的层"></a>查找给定域网络名称和层名称的层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (UtilityNetworkDefinition utilityNetworkDefinition = utilityNetwork.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  DomainNetwork domainNetwork = utilityNetworkDefinition.GetDomainNetwork(domainNetworkName);</span><br><span class="line">  Tier tier = domainNetwork.GetTier(tierName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新层中的所有脏子网"><a href="#更新层中的所有脏子网" class="headerlink" title="更新层中的所有脏子网"></a>更新层中的所有脏子网</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (SubnetworkManager subnetworkManager = utilityNetwork.GetSubnetworkManager())</span><br><span class="line">&#123;</span><br><span class="line">  subnetworkManager.UpdateAllSubnetworks(tier, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  mapView.Redraw(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="具有一个控制器的简单径向子网的生命周期"><a href="#具有一个控制器的简单径向子网的生命周期" class="headerlink" title="具有一个控制器的简单径向子网的生命周期"></a>具有一个控制器的简单径向子网的生命周期</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a subnetwork named &quot;Radial1&quot; with a single controller</span></span><br><span class="line"><span class="comment">// elementR1 represents the device that serves as the subnetwork controller (e.g., circuit breaker)</span></span><br><span class="line">Subnetwork subnetworkRadial1 = subnetworkManager.EnableControllerInEditOperation(mediumVoltageTier, elementR1, <span class="string">&quot;Radial1&quot;</span>, <span class="string">&quot;R1&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the subnetwork and refresh the map</span></span><br><span class="line">subnetworkRadial1.Update();</span><br><span class="line">MapView.Active.Redraw(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// At some point, a subnetwork will need to be deleted.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// First step is to disable the controller</span></span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementR1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// At this point, the subnetwork is deleted, but all of the rows that have been labeled with the subnetwork ID need to be updated</span></span><br><span class="line">subnetworkRadial1.Update();</span><br><span class="line">MapView.Active.Redraw(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The final step is to notify external systems (if any) using the Export Subnetwork geoprocessing tool</span></span><br></pre></td></tr></table></figure>

<h3 id="具有多个控制器的网格子网的生命周期"><a href="#具有多个控制器的网格子网的生命周期" class="headerlink" title="具有多个控制器的网格子网的生命周期"></a>具有多个控制器的网格子网的生命周期</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a subnetwork named &quot;Mesh1&quot; from three controllers</span></span><br><span class="line"><span class="comment">// elementM1, elementM2, and elementM3 represent the devices that serve as subnetwork controllers (e.g., network protectors)</span></span><br><span class="line">subnetworkManager.EnableController(lowVoltageMeshTier, elementM1, <span class="string">&quot;Mesh1&quot;</span>, <span class="string">&quot;M1&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line">subnetworkManager.EnableController(lowVoltageMeshTier, elementM2, <span class="string">&quot;Mesh1&quot;</span>, <span class="string">&quot;M2&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line">Subnetwork subnetworkMesh1 = subnetworkManager.EnableController(lowVoltageMeshTier, elementM3, <span class="string">&quot;Mesh1&quot;</span>, <span class="string">&quot;M3&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line">subnetworkMesh1.Update();</span><br><span class="line">MapView.Active.Redraw(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// When deleting the subnetwork, each controller must be disabled before the subnetwork itself is deleted</span></span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementM1);</span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementM2);</span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementM3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// After the subnetwork is deleted, all of the rows that have been labeled with the subnetwork ID need to be updated</span></span><br><span class="line">subnetworkMesh1.Update();</span><br><span class="line">MapView.Active.Redraw(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The final step is to notify external systems (if any) using the Export Subnetwork geoprocessing tool</span></span><br></pre></td></tr></table></figure>

<h3 id="具有两个控制器的重馈径向子网的生命周期"><a href="#具有两个控制器的重馈径向子网的生命周期" class="headerlink" title="具有两个控制器的重馈径向子网的生命周期"></a>具有两个控制器的重馈径向子网的生命周期</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a subnetwork named &quot;R2, R3&quot; from two controllers</span></span><br><span class="line"><span class="comment">// elementR2 and elementR3 represent the devices that serve as subnetwork controllers (e.g., circuit breakers)</span></span><br><span class="line">subnetworkManager.EnableControllerInEditOperation(mediumVoltageTier, elementR2, <span class="string">&quot;R2, R3&quot;</span>, <span class="string">&quot;R2&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line">subnetworkManager.EnableControllerInEditOperation(mediumVoltageTier, elementR3, <span class="string">&quot;R2, R3&quot;</span>, <span class="string">&quot;R3&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If the tie switch between them is opened, the original subnetwork controllers must be disabled and re-enabled with different names</span></span><br><span class="line"><span class="comment">// This will create two new subnetworks, named &quot;R2&quot; and &quot;R3&quot;</span></span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementR2);</span><br><span class="line">subnetworkManager.DisableControllerInEditOperation(elementR3);</span><br><span class="line"></span><br><span class="line">Subnetwork subnetworkR2 = subnetworkManager.EnableControllerInEditOperation(mediumVoltageTier, elementR2, <span class="string">&quot;R2&quot;</span>, <span class="string">&quot;R2&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line">Subnetwork subnetworkR3 = subnetworkManager.EnableControllerInEditOperation(mediumVoltageTier, elementR3, <span class="string">&quot;R3&quot;</span>, <span class="string">&quot;R3&quot;</span>, <span class="string">&quot;my description&quot;</span>, <span class="string">&quot;my notes&quot;</span>);</span><br><span class="line"></span><br><span class="line">subnetworkR2.Update();</span><br><span class="line">subnetworkR3.Update();</span><br><span class="line">MapView.Active.Redraw(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h2 id="描图"><a href="#描图" class="headerlink" title="描图"></a>描图</h2><h3 id="创建下游跟踪程序"><a href="#创建下游跟踪程序" class="headerlink" title="创建下游跟踪程序"></a>创建下游跟踪程序</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (TraceManager traceManager = utilityNetwork.GetTraceManager())</span><br><span class="line">&#123;</span><br><span class="line">  DownstreamTracer downstreamTracer = traceManager.GetTracer&lt;DownstreamTracer&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建跟踪参数"><a href="#创建跟踪参数" class="headerlink" title="创建跟踪参数"></a>创建跟踪参数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IReadOnlyList&lt;Element&gt; startingPointList = <span class="keyword">new</span> List&lt;Element&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Code to fill in list of starting points goes here...</span></span><br><span class="line">TraceArgument traceArgument = <span class="keyword">new</span> TraceArgument(startingPointList);</span><br><span class="line"></span><br><span class="line">TraceConfiguration traceConfiguration = <span class="keyword">new</span> TraceConfiguration();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Code to fill in trace configuration goes here...</span></span><br><span class="line">traceArgument.Configuration = traceConfiguration;</span><br></pre></td></tr></table></figure>

<h3 id="创建条件以将网络属性与一组值进行比较"><a href="#创建条件以将网络属性与一组值进行比较" class="headerlink" title="创建条件以将网络属性与一组值进行比较"></a>创建条件以将网络属性与一组值进行比较</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a NetworkAttribute object for the Lifecycle network attribute from the UtilityNetworkDefinition</span></span><br><span class="line"><span class="keyword">using</span> (NetworkAttribute lifecycleNetworkAttribute = utilityNetworkDefinition.GetNetworkAttribute(<span class="string">&quot;Lifecycle&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a NetworkAttributeComparison that stops traversal if Lifecycle &lt;&gt; &quot;In Design&quot; (represented by the constant InDesign)</span></span><br><span class="line">  NetworkAttributeComparison inDesignNetworkAttributeComparison = <span class="keyword">new</span> NetworkAttributeComparison(lifecycleNetworkAttribute, Operator.NotEqual, InDesign);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a NetworkAttributeComparison to stop traversal if Lifecycle &lt;&gt; &quot;In Service&quot; (represented by the constant InService)</span></span><br><span class="line">  NetworkAttributeComparison inServiceNetworkAttributeComparison = <span class="keyword">new</span> NetworkAttributeComparison(lifecycleNetworkAttribute, Operator.NotEqual, InService);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Combine these two comparisons together with &quot;And&quot;</span></span><br><span class="line">  And lifecycleFilter = <span class="keyword">new</span> And(inDesignNetworkAttributeComparison, inServiceNetworkAttributeComparison);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Final condition stops traversal if Lifecycle &lt;&gt; &quot;In Design&quot; and Lifecycle &lt;&gt; &quot;In Service&quot;</span></span><br><span class="line">  traceConfiguration.Traversability.Barriers = lifecycleFilter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a NetworkAttribute object for the Load network attribute from the UtilityNetworkDefinition</span></span><br><span class="line"><span class="keyword">using</span> (NetworkAttribute loadNetworkAttribute = utilityNetworkDefinition.GetNetworkAttribute(<span class="string">&quot;Load&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a function to sum the Load</span></span><br><span class="line">  Add sumLoadFunction = <span class="keyword">new</span> Add(loadNetworkAttribute);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add this function to our trace configuration</span></span><br><span class="line">  traceConfiguration.Functions = <span class="keyword">new</span> List&lt;Function&gt;() &#123; sumLoadFunction &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建功能屏障"><a href="#创建功能屏障" class="headerlink" title="创建功能屏障"></a>创建功能屏障</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a NetworkAttribute object for the Shape length network attribute from the UtilityNetworkDefinition</span></span><br><span class="line"><span class="keyword">using</span> (NetworkAttribute shapeLengthNetworkAttribute = utilityNetworkDefinition.GetNetworkAttribute(<span class="string">&quot;Shape length&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a function that adds up shape length</span></span><br><span class="line">  Add lengthFunction = <span class="keyword">new</span> Add(shapeLengthNetworkAttribute);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a function barrier that stops traversal after 1000 feet</span></span><br><span class="line">  FunctionBarrier distanceBarrier = <span class="keyword">new</span> FunctionBarrier(lengthFunction, Operator.GreaterThan, <span class="number">1000.0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set this function barrier</span></span><br><span class="line">  traceConfiguration.Traversability.FunctionBarriers = <span class="keyword">new</span> List&lt;FunctionBarrier&gt;() &#123; distanceBarrier &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建输出条件"><a href="#创建输出条件" class="headerlink" title="创建输出条件"></a>创建输出条件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an output category to filter the trace results to only include</span></span><br><span class="line"><span class="comment">// features with the &quot;Service Point&quot; category assigned</span></span><br><span class="line">traceConfiguration.OutputCondition = <span class="keyword">new</span> CategoryComparison(CategoryOperator.IsEqual, <span class="string">&quot;Service Point&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建传播器"><a href="#创建传播器" class="headerlink" title="创建传播器"></a>创建传播器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a NetworkAttribute object for the Phases Normal attribute from the UtilityNetworkDefinition</span></span><br><span class="line"><span class="keyword">using</span> (NetworkAttribute normalPhaseAttribute = utilityNetworkDefinition.GetNetworkAttribute(<span class="string">&quot;Phases Normal&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a propagator to propagate the Phases Normal attribute downstream from the source, using a Bitwise And function</span></span><br><span class="line">  <span class="comment">// Allow traversal to continue as long as the Phases Normal value includes any of the ABC phases</span></span><br><span class="line">  <span class="comment">// (represented by the constant ABCPhase)</span></span><br><span class="line">  Propagator phasePropagator = <span class="keyword">new</span> Propagator(normalPhaseAttribute, PropagatorFunction.BitwiseAnd, Operator.IncludesAny, ABCPhase);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Assign this propagator to our trace configuration</span></span><br><span class="line">  traceConfiguration.Propagators = <span class="keyword">new</span> List&lt;Propagator&gt;() &#123; phasePropagator &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用函数结果"><a href="#使用函数结果" class="headerlink" title="使用函数结果"></a>使用函数结果</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get the FunctionOutputResult from the trace results</span></span><br><span class="line">FunctionOutputResult functionOutputResult = traceResults.OfType&lt;FunctionOutputResult&gt;().First();</span><br><span class="line"></span><br><span class="line"><span class="comment">// First() can be used here if only one Function was included in the TraceConfiguration.Functions collection.</span></span><br><span class="line"><span class="comment">// Otherwise you will have to search the list for the correct FunctionOutput object.</span></span><br><span class="line">FunctionOutput functionOutput = functionOutputResult.FunctionOutputs.First();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extract the total load from the GlobalValue property</span></span><br><span class="line"><span class="built_in">double</span> totalLoad = (<span class="built_in">double</span>)functionOutput.Value;</span><br></pre></td></tr></table></figure>

<h3 id="按名称获取命名跟踪配置"><a href="#按名称获取命名跟踪配置" class="headerlink" title="按名称获取命名跟踪配置"></a>按名称获取命名跟踪配置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GetNamedTraceConfigurationsByName</span>(<span class="params">UtilityNetwork utilityNetwork, <span class="built_in">string</span> configurationName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Query to find named trace configurations</span></span><br><span class="line">  NamedTraceConfigurationQuery namedTraceConfigurationQuery = <span class="keyword">new</span> NamedTraceConfigurationQuery &#123; Names = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; configurationName &#125; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the trace manager from the utility network</span></span><br><span class="line">  <span class="keyword">using</span> (TraceManager traceManager = utilityNetwork.GetTraceManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// A set of named trace configurations specified by the named traced configuration query </span></span><br><span class="line">    IReadOnlyList&lt;NamedTraceConfiguration&gt; namedTraceConfigurations = traceManager.GetNamedTraceConfigurations(namedTraceConfigurationQuery);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (NamedTraceConfiguration namedTraceConfiguration <span class="keyword">in</span> namedTraceConfigurations)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Use NamedTraceConfiguration&#x27;s object</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从公共设施网络图层获取指定追踪配置"><a href="#从公共设施网络图层获取指定追踪配置" class="headerlink" title="从公共设施网络图层获取指定追踪配置"></a>从公共设施网络图层获取指定追踪配置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GetNamedTraceConfigurationsFromUtilityNetworkLayer</span>(<span class="params">UtilityNetworkLayer utilityNetworkLayer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get all named trace configurations in the utility network</span></span><br><span class="line">  IReadOnlyList&lt;NamedTraceConfiguration&gt; namedTraceConfigurations = utilityNetworkLayer.GetNamedTraceConfigurations();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (NamedTraceConfiguration namedTraceConfiguration <span class="keyword">in</span> namedTraceConfigurations)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Use NamedTraceConfiguration&#x27;s object</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用指定追踪配置追踪公共设施网络"><a href="#使用指定追踪配置追踪公共设施网络" class="headerlink" title="使用指定追踪配置追踪公共设施网络"></a>使用指定追踪配置追踪公共设施网络</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">TraceUtilityNetworkUsingNamedTraceConfiguration</span>(<span class="params">UtilityNetwork utilityNetwork, NamedTraceConfiguration namedTraceConfiguration, Element startElement</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the trace manager from the utility network</span></span><br><span class="line">  <span class="keyword">using</span> (TraceManager traceManager = utilityNetwork.GetTraceManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get a tracer from the trace manager using the named trace configuration</span></span><br><span class="line">    Tracer upstreamTracer = traceManager.GetTracer(namedTraceConfiguration);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Trace argument holding the trace input parameters</span></span><br><span class="line">    TraceArgument upstreamTraceArgument = <span class="keyword">new</span> TraceArgument(namedTraceConfiguration, <span class="keyword">new</span> List&lt;Element&gt; &#123;startElement&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Trace results </span></span><br><span class="line">    IReadOnlyList&lt;Result&gt; upstreamTraceResults = upstreamTracer.Trace(upstreamTraceArgument);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络图"><a href="#网络图" class="headerlink" title="网络图"></a>网络图</h2><h3 id="获取图管理器"><a href="#获取图管理器" class="headerlink" title="获取图管理器"></a>获取图管理器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Todo - do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取网络图"><a href="#获取网络图" class="headerlink" title="获取网络图"></a>获取网络图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// get all the diagrams</span></span><br><span class="line">  IReadOnlyList&lt;NetworkDiagram&gt; diagrams = diagramManager.GetNetworkDiagrams();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get a diagram by name</span></span><br><span class="line">  NetworkDiagram diagram = diagramManager.GetNetworkDiagram(diagrameName);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get diagrams by extent</span></span><br><span class="line">  diagrams = diagramManager.GetNetworkDiagrams(extentOfInterest);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get diagrams from a set of utility network feature GlobalIDs</span></span><br><span class="line">  diagrams = diagramManager.GetNetworkDiagrams(globalIDs);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get diagrams from a set of utility network feature GlobalIDs within an extent</span></span><br><span class="line">  diagrams = diagramManager.GetNetworkDiagrams(extentOfInterest, globalIDs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取具有不一致一致性状态的网络图列表"><a href="#获取具有不一致一致性状态的网络图列表" class="headerlink" title="获取具有不一致一致性状态的网络图列表"></a>获取具有不一致一致性状态的网络图列表</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;NetworkDiagram&gt; <span class="title">GetInconsistentDiagrams</span>(<span class="params">UtilityNetwork utilityNetwork</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Get the DiagramManager from the utility network</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">  &#123;</span><br><span class="line">    List&lt;NetworkDiagram&gt; myList = <span class="keyword">new</span> List&lt;NetworkDiagram&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Loop through the network diagrams in the diagram manager</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (NetworkDiagram diagram <span class="keyword">in</span> diagramManager.GetNetworkDiagrams())</span><br><span class="line">    &#123;</span><br><span class="line">      NetworkDiagramInfo diagramInfo = diagram.GetDiagramInfo();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If the diagram is not a system diagram and is in an inconsistent state, add it to our list</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!diagramInfo.IsSystem &amp;&amp; diagram.GetConsistencyState() != NetworkDiagramConsistencyState.DiagramIsConsistent)</span><br><span class="line">      &#123;</span><br><span class="line">        myList.Add(diagram);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        diagram.Dispose(); <span class="comment">// If we are not returning it we need to Dispose it</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> myList;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从网络逻辑示意图中打开逻辑示意图窗格"><a href="#从网络逻辑示意图中打开逻辑示意图窗格" class="headerlink" title="从网络逻辑示意图中打开逻辑示意图窗格"></a>从网络逻辑示意图中打开逻辑示意图窗格</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a diagram layer from a NetworkDiagram (myDiagram)</span></span><br><span class="line">DiagramLayer diagramLayer = <span class="keyword">await</span> QueuedTask.Run&lt;DiagramLayer&gt;(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create the diagram map</span></span><br><span class="line">  <span class="keyword">var</span> newMap = MapFactory.Instance.CreateMap(myDiagram.Name, ArcGIS.Core.CIM.MapType.NetworkDiagram, MapViewingMode.Map);</span><br><span class="line">  <span class="keyword">if</span> (newMap == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Open the diagram map</span></span><br><span class="line">  <span class="keyword">var</span> mapPane = ArcGIS.Desktop.Core.ProApp.Panes.CreateMapPaneAsync(newMap, MapViewingMode.Map);</span><br><span class="line">  <span class="keyword">if</span> (mapPane == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Add the diagram to the map</span></span><br><span class="line">  <span class="keyword">return</span> newMap.AddDiagramLayer(myDiagram);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="从关系图层获取关系图"><a href="#从关系图层获取关系图" class="headerlink" title="从关系图层获取关系图"></a>从关系图层获取关系图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetDiagram</span>(<span class="params">DiagramLayer diagramLayer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// note - methods need to run on MCT</span></span><br><span class="line"></span><br><span class="line">  NetworkDiagram diagram = diagramLayer.GetNetworkDiagram();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the consistency state from the layer</span></span><br><span class="line">  DiagramLayerConsistencyState dlState = diagramLayer.ConsistencyState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// or from the diagram</span></span><br><span class="line">  NetworkDiagramConsistencyState ndState = diagram.GetConsistencyState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取图表模板"><a href="#获取图表模板" class="headerlink" title="获取图表模板"></a>获取图表模板</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RetrieveDiagramTemplates</span>(<span class="params">UtilityNetwork utilityNetwork</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get all templates</span></span><br><span class="line">    IReadOnlyList&lt;DiagramTemplate&gt; templates = diagramManager.GetDiagramTemplates();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get a template by name</span></span><br><span class="line">    DiagramTemplate template = diagramManager.GetDiagramTemplate(templateName);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从逻辑示意图模板获取网络逻辑示意图"><a href="#从逻辑示意图模板获取网络逻辑示意图" class="headerlink" title="从逻辑示意图模板获取网络逻辑示意图"></a>从逻辑示意图模板获取网络逻辑示意图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetNetworkDiagramFromDiagramTemplates</span>(<span class="params">UtilityNetwork utilityNetwork</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the first templates</span></span><br><span class="line">    DiagramTemplate template = diagramManager.GetDiagramTemplates().FirstOrDefault();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get the network diagrams fromt he template</span></span><br><span class="line">    IEnumerable&lt;NetworkDiagram&gt; diagrams = template.GetNetworkDiagrams();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// or get a network diagram by name</span></span><br><span class="line">    NetworkDiagram diagram = template.GetNetworkDiagram(diagrameName);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建网络图"><a href="#创建网络图" class="headerlink" title="创建网络图"></a>创建网络图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateNetworkDiagram</span>(<span class="params">UtilityNetwork utilityNetwork, IEnumerable&lt;Guid&gt; globalIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get the template</span></span><br><span class="line">    DiagramTemplate template = diagramManager.GetDiagramTemplate(templateName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create the diagram</span></span><br><span class="line">    NetworkDiagram diagram = diagramManager.CreateNetworkDiagram(template, globalIDs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="以-JSON-字符串形式获取网络逻辑示意图信息"><a href="#以-JSON-字符串形式获取网络逻辑示意图信息" class="headerlink" title="以 JSON 字符串形式获取网络逻辑示意图信息"></a>以 JSON 字符串形式获取网络逻辑示意图信息</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetDiagramContent</span>(<span class="params">UtilityNetwork utilityNetwork</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (DiagramManager diagramManager = utilityNetwork.GetDiagramManager())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// get a diagram by name</span></span><br><span class="line">    NetworkDiagram diagram = diagramManager.GetNetworkDiagram(templateName);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> json_content = diagram.GetContent(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取图元素"><a href="#获取图元素" class="headerlink" title="获取图元素"></a>获取图元素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetDiagramElements</span>(<span class="params">MapView mapView, NetworkDiagram networkDiagram</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a DiagramElementQueryByExtent to retrieve diagram element junctions whose extent</span></span><br><span class="line">  <span class="comment">// intersects the active map extent</span></span><br><span class="line"></span><br><span class="line">  DiagramElementQueryByExtent elementQuery = <span class="keyword">new</span> DiagramElementQueryByExtent();</span><br><span class="line">  elementQuery.ExtentOfInterest = MapView.Active.Extent;</span><br><span class="line">  elementQuery.AddContents = <span class="literal">false</span>;</span><br><span class="line">  elementQuery.QueryDiagramJunctionElement = <span class="literal">true</span>;</span><br><span class="line">  elementQuery.QueryDiagramEdgeElement = <span class="literal">false</span>;</span><br><span class="line">  elementQuery.QueryDiagramContainerElement = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use this DiagramElementQueryByExtent as an argument to the QueryDiagramElements method</span></span><br><span class="line">  DiagramElementQueryResult result = networkDiagram.QueryDiagramElements(elementQuery);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the container, junction, edge elements</span></span><br><span class="line">  <span class="comment">//    in this case result.DiagramJunctionElements and result.DiagramEdgeElements will be empty </span></span><br><span class="line">  <span class="comment">//    since elementQuery.QueryDiagramEdgeElement and elementQuery.QueryDiagramContainerElement are set to false</span></span><br><span class="line">  IReadOnlyList&lt;DiagramContainerElement&gt; containerElements = result.DiagramContainerElements;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;DiagramJunctionElement&gt; junctionElements = result.DiagramJunctionElements;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;DiagramEdgeElement&gt; edgeElements = result.DiagramEdgeElements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取逻辑示意图聚合"><a href="#获取逻辑示意图聚合" class="headerlink" title="获取逻辑示意图聚合"></a>获取逻辑示意图聚合</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetDiagramAggregation</span>(<span class="params">NetworkDiagram networkDiagram</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;DiagramAggregation&gt; aggregations = networkDiagram.GetAggregations();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> aggregation <span class="keyword">in</span> aggregations)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> type = aggregation.AggregationType;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找一组公共设施网络行的逻辑示意图要素"><a href="#查找一组公共设施网络行的逻辑示意图要素" class="headerlink" title="查找一组公共设施网络行的逻辑示意图要素"></a>查找一组公共设施网络行的逻辑示意图要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FindDiagramFeatures</span>(<span class="params">NetworkDiagram diagram, List&lt;Guid&gt; globalIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  FindDiagramFeatureQuery featureQuery = <span class="keyword">new</span> FindDiagramFeatureQuery();</span><br><span class="line">  featureQuery.NetworkRowGlobalIDs = globalIDs;</span><br><span class="line">  featureQuery.AddAggregations = <span class="literal">true</span>;</span><br><span class="line">  featureQuery.AddConnectivityAssociations = <span class="literal">true</span>;</span><br><span class="line">  featureQuery.AddStructuralAttachments = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;FindResultItem&gt; features = diagram.FindDiagramFeatures(featureQuery);</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> findFeature <span class="keyword">in</span> features)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">long</span> objectID = findFeature.ObjectID;</span><br><span class="line">    Guid guid = findFeature.GlobalID;</span><br><span class="line">    GeometryType geometryType = findFeature.GeometryType;</span><br><span class="line">    <span class="built_in">int</span> sourceID = findFeature.SourceID;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找一组逻辑示意图要素的公共设施网络行"><a href="#查找一组逻辑示意图要素的公共设施网络行" class="headerlink" title="查找一组逻辑示意图要素的公共设施网络行"></a>查找一组逻辑示意图要素的公共设施网络行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FindDiagramRows</span>(<span class="params">NetworkDiagram diagram, List&lt;Guid&gt; globalIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  FindNetworkRowQuery rowQuery = <span class="keyword">new</span> FindNetworkRowQuery();</span><br><span class="line">  rowQuery.DiagramFeatureGlobalIDs = globalIDs;</span><br><span class="line">  rowQuery.AddAggregations = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  IReadOnlyList&lt;FindResultItem&gt; rows = diagram.FindNetworkRows(rowQuery);</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> findRow <span class="keyword">in</span> rows)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">long</span> objectID = findRow.ObjectID;</span><br><span class="line">    Guid guid = findRow.GlobalID;</span><br><span class="line">    GeometryType geometryType = findRow.GeometryType;</span><br><span class="line">    <span class="built_in">int</span> sourceID = findRow.SourceID;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找用于创建网络逻辑示意图的初始网络行"><a href="#查找用于创建网络逻辑示意图的初始网络行" class="headerlink" title="查找用于创建网络逻辑示意图的初始网络行"></a>查找用于创建网络逻辑示意图的初始网络行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FindInitialNetworkRows</span>(<span class="params">NetworkDiagram diagram</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  IReadOnlyList&lt;FindResultItem&gt; rows = diagram.FindInitialNetworkRows();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> findRow <span class="keyword">in</span> rows)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">long</span> objectID = findRow.ObjectID;</span><br><span class="line">    Guid guid = findRow.GlobalID;</span><br><span class="line">    GeometryType geometryType = findRow.GeometryType;</span><br><span class="line">    <span class="built_in">int</span> sourceID = findRow.SourceID;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更改网络逻辑示意图的布局"><a href="#更改网络逻辑示意图的布局" class="headerlink" title="更改网络逻辑示意图的布局"></a>更改网络逻辑示意图的布局</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DiagramElementQueryResultAndNetworkDiagramSubsetClasses</span>(<span class="params">Geodatabase geodatabase, DiagramManager diagramManager, <span class="built_in">string</span> diagramName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Retrieve a diagram</span></span><br><span class="line">  <span class="keyword">using</span> (NetworkDiagram diagramTest = diagramManager.GetNetworkDiagram(diagramName))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Create a DiagramElementQueryByElementTypes query object to get the diagram elements we want to work with</span></span><br><span class="line">    DiagramElementQueryByElementTypes query = <span class="keyword">new</span> DiagramElementQueryByElementTypes();</span><br><span class="line">    query.QueryDiagramJunctionElement = <span class="literal">true</span>;</span><br><span class="line">    query.QueryDiagramEdgeElement = <span class="literal">true</span>;</span><br><span class="line">    query.QueryDiagramContainerElement = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve those diagram elements</span></span><br><span class="line">    DiagramElementQueryResult elements = diagramTest.QueryDiagramElements(query);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a NetworkDiagramSubset object to edit this set of diagram elements</span></span><br><span class="line">    NetworkDiagramSubset subset = <span class="keyword">new</span> NetworkDiagramSubset();</span><br><span class="line">    subset.DiagramJunctionElements = elements.DiagramJunctionElements;</span><br><span class="line">    subset.DiagramEdgeElements = elements.DiagramEdgeElements;</span><br><span class="line">    subset.DiagramContainerElements = elements.DiagramContainerElements;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Edit the shapes of the diagram elements - left as an exercise for the student</span></span><br><span class="line">    TranslateDiagramElements(subset);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save the new layout of the diagram elements</span></span><br><span class="line">    diagramTest.SaveLayout(subset, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编辑网络图"><a href="#编辑网络图" class="headerlink" title="编辑网络图"></a>编辑网络图</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EditDiagram</span>(<span class="params">NetworkDiagram diagram, List&lt;Guid&gt; globalIDs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//     These routines generate their own editing transaction, and therefore cannot be wrapped</span></span><br><span class="line">  <span class="comment">//     in a separate transaction. Because the editing performed by these routines cannot</span></span><br><span class="line">  <span class="comment">//     be undone, thise routines can also not be called within an editing session. All</span></span><br><span class="line">  <span class="comment">//     edits in the current edit session must be saved or discarded before calling these</span></span><br><span class="line">  <span class="comment">//     routines.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// refresh the diagram - synchronizes it based on the latest network topology</span></span><br><span class="line">  diagram.Update();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// append features to the diagram</span></span><br><span class="line">  diagram.Append(globalIDs);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// overite the diagram with a set of features </span></span><br><span class="line">  diagram.Overwrite(globalIDs);</span><br><span class="line"></span><br><span class="line">  NetworkDiagramInfo info = diagram.GetDiagramInfo();</span><br><span class="line">  <span class="keyword">if</span> (info.CanExtend)</span><br><span class="line">  &#123;</span><br><span class="line">    diagram.Extend(NetworkDiagramExtendType.ExtendByContainment);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// or extend for only a set of utility network globalIDs</span></span><br><span class="line">    diagram.Extend(NetworkDiagramExtendType.ExtendByContainment, globalIDs);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// delete a diagran</span></span><br><span class="line">  diagram.Delete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="宗地结构"><a href="#宗地结构" class="headerlink" title="宗地结构"></a>宗地结构</h1><h3 id="获取活动记录"><a href="#获取活动记录" class="headerlink" title="获取活动记录"></a>获取活动记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">    <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get Active Record.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置活动记录"><a href="#设置活动记录" class="headerlink" title="设置活动记录"></a>设置活动记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">string</span> sExistingRecord = <span class="string">&quot;MyRecordName&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> bSuccess = <span class="keyword">await</span> myParcelFabricLayer.SetActiveRecordAsync(sExistingRecord);</span><br><span class="line">    <span class="keyword">if</span> (!bSuccess)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No record called &quot;</span> + sExistingRecord + <span class="string">&quot; was found.&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Set Active Record.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建新记录"><a href="#创建新记录" class="headerlink" title="创建新记录"></a>创建新记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt; RecordAttributes = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line">  <span class="built_in">string</span> sNewRecord = <span class="string">&quot;MyRecordName&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> recordsLayer = <span class="keyword">await</span> myParcelFabricLayer.GetRecordsLayerAsync();</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Create Parcel Fabric Record&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Create Parcel Fabric Record...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">false</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    RecordAttributes.Add(<span class="string">&quot;Name&quot;</span>, sNewRecord);</span><br><span class="line">    <span class="keyword">var</span> editRowToken = editOper.Create(recordsLayer.FirstOrDefault(), RecordAttributes);</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> defOID = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">var</span> lOid = editRowToken.ObjectID.HasValue ? editRowToken.ObjectID.Value : defOID;</span><br><span class="line">    <span class="keyword">await</span> myParcelFabricLayer.SetActiveRecordAsync(lOid);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Create New Record.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将标准线要素复制到宗地类型"><a href="#将标准线要素复制到宗地类型" class="headerlink" title="将标准线要素复制到宗地类型"></a>将标准线要素复制到宗地类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run( <span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// check for selected layer</span></span><br><span class="line">  <span class="keyword">if</span> (MapView.Active.GetSelectedLayers().Count == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Please select a target parcel polygon layer in the table of contents.&quot;</span>;</span><br><span class="line">  <span class="comment">//get the feature layer that&#x27;s selected in the table of contents</span></span><br><span class="line">  <span class="keyword">var</span> destPolygonL = MapView.Active.GetSelectedLayers().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> pRec = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">    <span class="keyword">if</span> (pRec == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line">    <span class="built_in">string</span> ParcelTypeName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    IEnumerable&lt;<span class="built_in">string</span>&gt; parcelTypeNames = <span class="keyword">await</span> myParcelFabricLayer.GetParcelTypeNamesAsync();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">string</span> parcelTypeNm <span class="keyword">in</span> parcelTypeNames)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> polygonLyrParcelTypeEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(parcelTypeNm);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureLayer lyr <span class="keyword">in</span> polygonLyrParcelTypeEnum)</span><br><span class="line">        <span class="keyword">if</span> (lyr == destPolygonL)</span><br><span class="line">        &#123;</span><br><span class="line">          ParcelTypeName = parcelTypeNm;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (String.IsNullOrEmpty(ParcelTypeName))</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Please select a target parcel polygon layer in the table of contents.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> srcFeatLyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;().FirstOrDefault(l =&gt; l.Name.Contains(<span class="string">&quot;MySourceLines&quot;</span>) &amp;&amp; l.IsVisible);</span><br><span class="line">    <span class="keyword">if</span> (srcFeatLyr == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Looking for a layer named &#x27;MySourceLines&#x27; in the table of contents.&quot;</span>;</span><br><span class="line">    <span class="comment">//now get the line layer for this parcel type</span></span><br><span class="line">    <span class="keyword">var</span> destLineLyrEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelLineLayerByTypeNameAsync(ParcelTypeName);</span><br><span class="line">    <span class="keyword">if</span> (destLineLyrEnum.Count() == <span class="number">0</span>) <span class="comment">//make sure there is one in the map</span></span><br><span class="line">      <span class="keyword">return</span> ParcelTypeName + <span class="string">&quot; not found.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> destLineL = destLineLyrEnum.FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (destLineL == <span class="literal">null</span> || destPolygonL == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Copy Line Features To Parcel Type&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Copy Line Features To Parcel Type...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;((srcFeatLyr <span class="keyword">as</span> FeatureLayer).GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="keyword">if</span> (ids.Count == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No selected lines were found. Please select line features and try again.&quot;</span>;</span><br><span class="line">    editOper.CopyLineFeaturesToParcelType(srcFeatLyr, ids, destLineL, destPolygonL);</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Copy Line Features To Parcel Type.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将宗地行复制到宗地类型"><a href="#将宗地行复制到宗地类型" class="headerlink" title="将宗地行复制到宗地类型"></a>将宗地行复制到宗地类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run( <span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// check for selected layer</span></span><br><span class="line">  <span class="keyword">if</span> (MapView.Active.GetSelectedLayers().Count == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Please select a source parcel polygon feature layer in the table of contents.&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No parcel layer found in the map.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//get the feature layer that&#x27;s selected in the table of contents</span></span><br><span class="line">    <span class="keyword">var</span> srcParcelFeatLyr = MapView.Active.GetSelectedLayers().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="built_in">string</span> sTargetParcelType = <span class="string">&quot;Tax&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> destLineLEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelLineLayerByTypeNameAsync(sTargetParcelType);</span><br><span class="line">    <span class="keyword">if</span> (destLineLEnum.Count() == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> destLineL = destLineLEnum.FirstOrDefault();</span><br><span class="line">    <span class="keyword">var</span> destPolygonLEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(sTargetParcelType);</span><br><span class="line">    <span class="keyword">if</span> (destPolygonLEnum.Count() == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> destPolygonL = destPolygonLEnum.FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (destLineL == <span class="literal">null</span> || destPolygonL == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">    <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Copy Lines To Parcel Type&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Copy Lines To Parcel Type ...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(srcParcelFeatLyr.GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="keyword">if</span> (ids.Count == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No selected parcels found. Please select parcels and try again.&quot;</span>;</span><br><span class="line">    <span class="comment">//add the standard feature line layers source, and their feature ids to a new Dictionary</span></span><br><span class="line">    <span class="keyword">var</span> sourceParcelFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">    sourceParcelFeatures.Add(srcParcelFeatLyr, ids);</span><br><span class="line">    editOper.CopyParcelLinesToParcelType(myParcelFabricLayer, SelectionSet.FromDictionary(sourceParcelFeatures), destLineL, destPolygonL, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Copy Parcel Lines To Parcel Type.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将要素分配给活动记录"><a href="#将要素分配给活动记录" class="headerlink" title="将要素分配给活动记录"></a>将要素分配给活动记录</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run( () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//check for selected layer</span></span><br><span class="line">  <span class="keyword">if</span> (MapView.Active.GetSelectedLayers().Count == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Please select a source feature layer in the table of contents.&quot;</span>;</span><br><span class="line">  <span class="comment">//first get the feature layer that&#x27;s selected in the table of contents</span></span><br><span class="line">  <span class="keyword">var</span> srcFeatLyr = MapView.Active.GetSelectedLayers().OfType&lt;FeatureLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No parcel layer found in the map.&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">    <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Assign Features to Record&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Assign Features to Record...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//add parcel type layers and their feature ids to a new Dictionary</span></span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(srcFeatLyr.GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="keyword">var</span> sourceFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">    sourceFeatures.Add(srcFeatLyr, ids);</span><br><span class="line">    editOper.AssignFeaturesToRecord(myParcelFabricLayer, </span><br><span class="line">      SelectionSet.FromDictionary(sourceFeatures), theActiveRecord);</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Assign Features To Record.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建宗地种子"><a href="#创建宗地种子" class="headerlink" title="创建宗地种子"></a>创建宗地种子</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">  <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> guid = theActiveRecord.Guid;</span><br><span class="line">  <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Create Parcel Seeds&quot;</span>,</span><br><span class="line">    ProgressMessage = <span class="string">&quot;Create Parcel Seeds...&quot;</span>,</span><br><span class="line">    ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">    SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">    SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line">  editOper.CreateParcelSeedsByRecord(myParcelFabricLayer, guid, MapView.Active.Extent);</span><br><span class="line">  <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">    <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ex.Message;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="构建宗地"><a href="#构建宗地" class="headerlink" title="构建宗地"></a>构建宗地</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Parcel layer not found in map.&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">  <span class="keyword">var</span> guid = theActiveRecord.Guid;</span><br><span class="line">  <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Build Parcels&quot;</span>,</span><br><span class="line">    ProgressMessage = <span class="string">&quot;Build Parcels...&quot;</span>,</span><br><span class="line">    ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">    SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">    SelectModifiedFeatures = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  editOper.BuildParcelsByRecord(myParcelFabricLayer, guid);</span><br><span class="line">  <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">    <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ex.Message;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="重复的包裹"><a href="#重复的包裹" class="headerlink" title="重复的包裹"></a>重复的包裹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Parecl layer not found in the map.&quot;</span>;</span><br><span class="line"><span class="comment">//get the source polygon layer from the parcel fabric layer type, in this case a layer called Lot</span></span><br><span class="line"><span class="keyword">var</span> srcFeatLyrEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(<span class="string">&quot;Lot&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (srcFeatLyrEnum.Count() == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> sourcePolygonL = srcFeatLyrEnum.FirstOrDefault();</span><br><span class="line"><span class="comment">//get the target polygon layer from the parcel fabric layer type, in this case a layer called Tax</span></span><br><span class="line"><span class="keyword">var</span> targetFeatLyrEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(<span class="string">&quot;Tax&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (targetFeatLyrEnum.Count() == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> targetFeatLyr = targetFeatLyrEnum.FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(sourcePolygonL.GetSelection().GetObjectIDs());</span><br><span class="line"><span class="keyword">if</span> (ids.Count == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;No selected parcels found. Please select parcels and try again.&quot;</span>;</span><br><span class="line"><span class="comment">//add polygon layers and the feature ids to be duplicated to a new Dictionary</span></span><br><span class="line"><span class="keyword">var</span> sourceFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">sourceFeatures.Add(sourcePolygonL, ids);</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">  <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Duplicate Parcels&quot;</span>,</span><br><span class="line">    ProgressMessage = <span class="string">&quot;Duplicate Parcels...&quot;</span>,</span><br><span class="line">    ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">    SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">    SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line">  editOper.DuplicateParcels(myParcelFabricLayer, </span><br><span class="line">    SelectionSet.FromDictionary(sourceFeatures), theActiveRecord, targetFeatLyr);</span><br><span class="line">  <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">    <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ex.Message;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置历史宗地"><a href="#设置历史宗地" class="headerlink" title="设置历史宗地"></a>设置历史宗地</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Please add a parcel fabric to the map&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    FeatureLayer destPolygonL = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//find the first layer that is a parcel type, is non-historic, and has a selection</span></span><br><span class="line">    <span class="built_in">bool</span> bFound = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> ParcelTypesEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelTypeNamesAsync();</span><br><span class="line">    <span class="keyword">foreach</span> (FeatureLayer mapFeatLyr <span class="keyword">in</span> MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="built_in">string</span> ParcelType <span class="keyword">in</span> ParcelTypesEnum)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> layerEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(ParcelType);</span><br><span class="line">        <span class="keyword">foreach</span> (FeatureLayer flyr <span class="keyword">in</span> layerEnum)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (flyr == mapFeatLyr)</span><br><span class="line">          &#123;</span><br><span class="line">            bFound = mapFeatLyr.SelectionCount &gt; <span class="number">0</span>;</span><br><span class="line">            destPolygonL = mapFeatLyr;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bFound) <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (bFound) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!bFound)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Please select parcels to set as historic.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> theActiveRecord = myParcelFabricLayer.GetActiveRecord();</span><br><span class="line">    <span class="keyword">if</span> (theActiveRecord == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no Active Record. Please set the active record and try again.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(destPolygonL.GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="comment">//can do multi layer selection but using single per code above</span></span><br><span class="line">    <span class="keyword">var</span> sourceFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">    sourceFeatures.Add(destPolygonL, ids);</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Set Parcels Historic&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Set Parcels Historic...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    editOper.SetParcelHistoryRetired(myParcelFabricLayer, </span><br><span class="line">      SelectionSet.FromDictionary(sourceFeatures), theActiveRecord);</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Set Parcels Historic.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="将包裹收缩为种子"><a href="#将包裹收缩为种子" class="headerlink" title="将包裹收缩为种子"></a>将包裹收缩为种子</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Please add a parcel fabric to the map&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    FeatureLayer parcelPolygonLyr = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//find the first layer that is a polygon parcel type, is non-historic, and has a selection</span></span><br><span class="line">    <span class="built_in">bool</span> bFound = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> ParcelTypesEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelTypeNamesAsync();</span><br><span class="line">    <span class="keyword">foreach</span> (FeatureLayer mapFeatLyr <span class="keyword">in</span> MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;FeatureLayer&gt;())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="built_in">string</span> ParcelType <span class="keyword">in</span> ParcelTypesEnum)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> layerEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(ParcelType);</span><br><span class="line">        <span class="keyword">foreach</span> (FeatureLayer flyr <span class="keyword">in</span> layerEnum)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (flyr == mapFeatLyr)</span><br><span class="line">          &#123;</span><br><span class="line">            bFound = mapFeatLyr.SelectionCount &gt; <span class="number">0</span>;</span><br><span class="line">            parcelPolygonLyr = mapFeatLyr;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bFound) <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (bFound) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!bFound)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Please select parcels to shrink to seeds.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">    &#123;</span><br><span class="line">      Name = <span class="string">&quot;Shrink Parcels To Seeds&quot;</span>,</span><br><span class="line">      ProgressMessage = <span class="string">&quot;Shrink Parcels To Seeds...&quot;</span>,</span><br><span class="line">      ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">      SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">      SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(parcelPolygonLyr.GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="keyword">var</span> sourceParcelFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">    sourceParcelFeatures.Add(parcelPolygonLyr, ids);</span><br><span class="line">    editOper.ShrinkParcelsToSeeds(myParcelFabricLayer,SelectionSet.FromDictionary(sourceParcelFeatures));</span><br><span class="line">    <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">      <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Shrink Parcels To Seeds.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="更改宗地类型"><a href="#更改宗地类型" class="headerlink" title="更改宗地类型"></a>更改宗地类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//add polygon layers and the feature ids to change the type on to a new Dictionary</span></span><br><span class="line"><span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;(sourcePolygonL.GetSelection().GetObjectIDs());</span><br><span class="line"><span class="keyword">var</span> sourceFeatures = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">sourceFeatures.Add(sourcePolygonL, ids);</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> editOper = <span class="keyword">new</span> EditOperation()</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Change Parcel Type&quot;</span>,</span><br><span class="line">    ProgressMessage = <span class="string">&quot;Change Parcel Type...&quot;</span>,</span><br><span class="line">    ShowModalMessageAfterFailure = <span class="literal">true</span>,</span><br><span class="line">    SelectNewFeatures = <span class="literal">true</span>,</span><br><span class="line">    SelectModifiedFeatures = <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line">  editOper.ChangeParcelType(myParcelFabricLayer, SelectionSet.FromDictionary(sourceFeatures), targetFeatLyr);</span><br><span class="line">  <span class="keyword">if</span> (!editOper.Execute())</span><br><span class="line">    <span class="keyword">return</span> editOper.ErrorMessage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ex.Message;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="获取宗地要素"><a href="#获取宗地要素" class="headerlink" title="获取宗地要素"></a>获取宗地要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> sReportResult = <span class="string">&quot;Polygon Information --&quot;</span> + Environment.NewLine;</span><br><span class="line"><span class="built_in">string</span> sParcelTypeName = <span class="string">&quot;tax&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> myParcelFabricLayer =</span><br><span class="line">    MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">  <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;There is no fabric layer in the map.&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//first get the parcel type feature layer</span></span><br><span class="line">  <span class="keyword">var</span> featSrcLyr = myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(sParcelTypeName).Result.FirstOrDefault();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (featSrcLyr.SelectionCount == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;There is no selection on the &quot;</span> + sParcelTypeName + <span class="string">&quot; layer.&quot;</span>;</span><br><span class="line"></span><br><span class="line">  sReportResult += <span class="string">&quot; Parcel Type: &quot;</span> + sParcelTypeName + Environment.NewLine;</span><br><span class="line">  sReportResult += <span class="string">&quot; Poygons: &quot;</span> + featSrcLyr.SelectionCount + Environment.NewLine + Environment.NewLine;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// ------- get the selected parcels ---------</span></span><br><span class="line">    <span class="keyword">var</span> ids = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;((featSrcLyr <span class="keyword">as</span> FeatureLayer).GetSelection().GetObjectIDs());</span><br><span class="line">    <span class="keyword">var</span> sourceParcels = <span class="keyword">new</span> Dictionary&lt;MapMember, List&lt;<span class="built_in">long</span>&gt;&gt;();</span><br><span class="line">    sourceParcels.Add(featSrcLyr, ids);</span><br><span class="line">    <span class="comment">//---------------------------------------------</span></span><br><span class="line">    ParcelFeatures parcFeatures =</span><br><span class="line">                    <span class="keyword">await</span> myParcelFabricLayer.GetParcelFeaturesAsync(SelectionSet.FromDictionary(sourceParcels));</span><br><span class="line">    <span class="comment">//since we know that we want to report on Tax lines only, and for this functionality </span></span><br><span class="line">    <span class="comment">// we can use any of the Tax line layer instances (if there happens to be more than one)</span></span><br><span class="line">    <span class="comment">// we can get the first instance as follows</span></span><br><span class="line">    FeatureLayer myLineFeatureLyr =</span><br><span class="line">        myParcelFabricLayer.GetParcelLineLayerByTypeNameAsync(sParcelTypeName).Result.FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (myLineFeatureLyr == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> sParcelTypeName + <span class="string">&quot; line layer not found&quot;</span>;</span><br><span class="line"></span><br><span class="line">    FeatureLayer myPointFeatureLyr =</span><br><span class="line">        myParcelFabricLayer.GetPointsLayerAsync().Result.FirstOrDefault();</span><br><span class="line">    <span class="keyword">if</span> (myPointFeatureLyr == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;fabric point layer not found&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> LineInfo = parcFeatures.Lines; <span class="comment">//then get the line information from the parcel features object</span></span><br><span class="line">    <span class="comment">//... and then do some work for each of the lines</span></span><br><span class="line">    <span class="built_in">int</span> iRadiusAttributeCnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> iDistanceAttributeCnt = <span class="number">0</span>;</span><br><span class="line">    sReportResult += <span class="string">&quot;Line Information --&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (KeyValuePair&lt;<span class="built_in">string</span>, List&lt;<span class="built_in">long</span>&gt;&gt; kvp <span class="keyword">in</span> LineInfo)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (kvp.Key.ToLower() != sParcelTypeName)</span><br><span class="line">        <span class="keyword">continue</span>; <span class="comment">// ignore any other lines from different parcel types</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">foreach</span> (<span class="built_in">long</span> oid <span class="keyword">in</span> kvp.Value)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> insp = myLineFeatureLyr.Inspect(oid);</span><br><span class="line">        <span class="keyword">var</span> dRadius = insp[<span class="string">&quot;RADIUS&quot;</span>];</span><br><span class="line">        <span class="keyword">var</span> dDistance = insp[<span class="string">&quot;DISTANCE&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dRadius != DBNull.Value)</span><br><span class="line">          iRadiusAttributeCnt++;</span><br><span class="line">        <span class="keyword">if</span> (dDistance != DBNull.Value)</span><br><span class="line">          iDistanceAttributeCnt++;</span><br><span class="line">        <span class="comment">//Polyline poly = (Polyline)insp[&quot;SHAPE&quot;];</span></span><br><span class="line">      &#125;</span><br><span class="line">      sReportResult += Environment.NewLine + <span class="string">&quot; Distance attributes: &quot;</span> + iDistanceAttributeCnt.ToString();</span><br><span class="line">      sReportResult += Environment.NewLine + <span class="string">&quot; Radius attributes: &quot;</span> + iRadiusAttributeCnt.ToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> PointInfo = parcFeatures.Points; <span class="comment">//get the point information from the parcel features object</span></span><br><span class="line">    <span class="comment">//... and then do some work for each of the points</span></span><br><span class="line">    sReportResult += Environment.NewLine + Environment.NewLine + <span class="string">&quot;Point Information --&quot;</span>;</span><br><span class="line">    <span class="built_in">int</span> iFixedPointCnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> iNonFixedPointCnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">long</span> oid <span class="keyword">in</span> PointInfo)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> insp = myPointFeatureLyr.Inspect(oid);</span><br><span class="line">      <span class="keyword">var</span> isFixed = insp[<span class="string">&quot;ISFIXED&quot;</span>];</span><br><span class="line">      <span class="keyword">if</span> (isFixed == DBNull.Value || (<span class="built_in">int</span>)isFixed == <span class="number">0</span>)</span><br><span class="line">        iNonFixedPointCnt++;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        iFixedPointCnt++;</span><br><span class="line">      <span class="comment">// var pt = insp[&quot;SHAPE&quot;];</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    sReportResult += Environment.NewLine + <span class="string">&quot; Fixed Points: &quot;</span> + iFixedPointCnt.ToString();</span><br><span class="line">    sReportResult += Environment.NewLine + <span class="string">&quot; Non-Fixed Points: &quot;</span> + iNonFixedPointCnt.ToString();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get Parcel Features&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  MessageBox.Show(sReportResult, <span class="string">&quot;Get Parcel Features&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从宗地图层获取宗地结构数据集控制器"><a href="#从宗地图层获取宗地结构数据集控制器" class="headerlink" title="从宗地图层获取宗地结构数据集控制器"></a>从宗地图层获取宗地结构数据集控制器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricDataset = myParcelFabricLayer.GetParcelFabric();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get Parcel Fabric Dataset from layer.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取宗地结构数据集的宗地拓扑"><a href="#获取宗地结构数据集的宗地拓扑" class="headerlink" title="获取宗地结构数据集的宗地拓扑"></a>获取宗地结构数据集的宗地拓扑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricDataset = myParcelFabricLayer.GetParcelFabric();</span><br><span class="line">    <span class="keyword">var</span> myTopology = myParcelFabricDataset.GetParcelTopology();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get Parcel Fabric Topology.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从宗地结构数据集中获取点、连接和记录要素类"><a href="#从宗地结构数据集中获取点、连接和记录要素类" class="headerlink" title="从宗地结构数据集中获取点、连接和记录要素类"></a>从宗地结构数据集中获取点、连接和记录要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricDataset = myParcelFabricLayer.GetParcelFabric();</span><br><span class="line">    FeatureClass myPointsFC = myParcelFabricDataset.GetSystemTable(SystemTableType.Points) <span class="keyword">as</span> FeatureClass;</span><br><span class="line">    FeatureClass myCoonectionsFC = myParcelFabricDataset.GetSystemTable(SystemTableType.Connections) <span class="keyword">as</span> FeatureClass;</span><br><span class="line">    FeatureClass myRecordsFC = myParcelFabricDataset.GetSystemTable(SystemTableType.Records) <span class="keyword">as</span> FeatureClass;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get point, connection, and record feature classes.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从宗地结构数据集获取宗地类型要素类"><a href="#从宗地结构数据集获取宗地类型要素类" class="headerlink" title="从宗地结构数据集获取宗地类型要素类"></a>从宗地结构数据集获取宗地类型要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> errorMessage = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;ParcelLayer&gt;().FirstOrDefault();</span><br><span class="line">    <span class="comment">//if there is no fabric in the map then bail</span></span><br><span class="line">    <span class="keyword">if</span> (myParcelFabricLayer == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;There is no fabric in the map.&quot;</span>;</span><br><span class="line">    <span class="built_in">string</span> myParcelTypeName = <span class="string">&quot;Tax&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> myParcelFabricDataset = myParcelFabricLayer.GetParcelFabric();</span><br><span class="line">    <span class="keyword">var</span> typeInfo = myParcelFabricDataset.GetParcelTypeInfo();</span><br><span class="line">    FeatureClass lineFCType = <span class="literal">null</span>;</span><br><span class="line">    FeatureClass polyFCType = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> info <span class="keyword">in</span> typeInfo)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (info.Name.ToLower() == myParcelTypeName.ToLower())</span><br><span class="line">      &#123; </span><br><span class="line">        lineFCType = info.LineFeatureTable <span class="keyword">as</span> FeatureClass;</span><br><span class="line">        polyFCType = info.PolygonFeatureTable <span class="keyword">as</span> FeatureClass;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> ex.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(errorMessage))</span><br><span class="line">  MessageBox.Show(errorMessage, <span class="string">&quot;Get Parcel Type feature classes.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从要素图层获取宗地类型名称"><a href="#从要素图层获取宗地类型名称" class="headerlink" title="从要素图层获取宗地类型名称"></a>从要素图层获取宗地类型名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">GetParcelTypeNameFromFeatureLayer</span>(<span class="params">ParcelLayer myParcelFabricLayer, FeatureLayer featLayer, GeometryType geomType</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (featLayer == <span class="literal">null</span>) <span class="comment">//nothing to do, return empty string</span></span><br><span class="line">    <span class="keyword">return</span> String.Empty;</span><br><span class="line">  IEnumerable&lt;<span class="built_in">string</span>&gt; parcelTypeNames = <span class="keyword">await</span> myParcelFabricLayer.GetParcelTypeNamesAsync();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="built_in">string</span> parcelTypeName <span class="keyword">in</span> parcelTypeNames)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (geomType == GeometryType.Polygon)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> polygonLyrParcelTypeEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelPolygonLayerByTypeNameAsync(parcelTypeName);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureLayer lyr <span class="keyword">in</span> polygonLyrParcelTypeEnum)</span><br><span class="line">        <span class="keyword">if</span> (lyr == featLayer)</span><br><span class="line">          <span class="keyword">return</span> parcelTypeName;</span><br><span class="line"></span><br><span class="line">      polygonLyrParcelTypeEnum = <span class="keyword">await</span> myParcelFabricLayer.GetHistoricParcelPolygonLayerByTypeNameAsync(parcelTypeName);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureLayer lyr <span class="keyword">in</span> polygonLyrParcelTypeEnum)</span><br><span class="line">        <span class="keyword">if</span> (lyr == featLayer)</span><br><span class="line">          <span class="keyword">return</span> parcelTypeName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (geomType == GeometryType.Polyline)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> lineLyrParcelTypeEnum = <span class="keyword">await</span> myParcelFabricLayer.GetParcelLineLayerByTypeNameAsync(parcelTypeName);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureLayer lyr <span class="keyword">in</span> lineLyrParcelTypeEnum)</span><br><span class="line">        <span class="keyword">if</span> (lyr == featLayer)</span><br><span class="line">          <span class="keyword">return</span> parcelTypeName;</span><br><span class="line"></span><br><span class="line">      lineLyrParcelTypeEnum = <span class="keyword">await</span> myParcelFabricLayer.GetHistoricParcelLineLayerByTypeNameAsync(parcelTypeName);</span><br><span class="line">      <span class="keyword">foreach</span> (FeatureLayer lyr <span class="keyword">in</span> lineLyrParcelTypeEnum)</span><br><span class="line">        <span class="keyword">if</span> (lyr == featLayer)</span><br><span class="line">          <span class="keyword">return</span> parcelTypeName;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> String.Empty;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从表中获取宗地结构"><a href="#从表中获取宗地结构" class="headerlink" title="从表中获取宗地结构"></a>从表中获取宗地结构</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ParcelFabric <span class="title">GetParcelFabricFromTable</span>(<span class="params">Table table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  ParcelFabric myParcelFabricDataset = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (table.IsControllerDatasetSupported())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Tables can belong to multiple controller datasets, but at most one of them will be a parcel fabric</span></span><br><span class="line"></span><br><span class="line">    IReadOnlyList&lt;Dataset&gt; controllerDatasets = table.GetControllerDatasets();</span><br><span class="line">    <span class="keyword">foreach</span> (Dataset controllerDataset <span class="keyword">in</span> controllerDatasets)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (controllerDataset <span class="keyword">is</span> ParcelFabric)</span><br><span class="line">      &#123;</span><br><span class="line">        myParcelFabricDataset = controllerDataset <span class="keyword">as</span> ParcelFabric;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        controllerDataset.Dispose();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> myParcelFabricDataset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="光栅"><a href="#光栅" class="headerlink" title="光栅"></a>光栅</h1><h3 id="在文件夹中打开栅格数据集"><a href="#在文件夹中打开栅格数据集" class="headerlink" title="在文件夹中打开栅格数据集"></a>在文件夹中打开栅格数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileSystemConnectionPath using the folder path.</span></span><br><span class="line">FileSystemConnectionPath connectionPath = <span class="keyword">new</span> FileSystemConnectionPath(<span class="keyword">new</span> System.Uri(<span class="string">@&quot;C:\Temp&quot;</span>), FileSystemDatastoreType.Raster);</span><br><span class="line"><span class="comment">// Create a new FileSystemDatastore using the FileSystemConnectionPath.</span></span><br><span class="line">FileSystemDatastore dataStore = <span class="keyword">new</span> FileSystemDatastore(connectionPath);</span><br><span class="line"><span class="comment">// Open the raster dataset.</span></span><br><span class="line">RasterDataset fileRasterDataset = dataStore.OpenDataset&lt;RasterDataset&gt;(<span class="string">&quot;Sample.tif&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="在地理数据库中打开栅格数据集"><a href="#在地理数据库中打开栅格数据集" class="headerlink" title="在地理数据库中打开栅格数据集"></a>在地理数据库中打开栅格数据集</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a FileGeodatabaseConnectionPath using the path to the gdb. Note: This can be a path to a .sde file.</span></span><br><span class="line">FileGeodatabaseConnectionPath geodatabaseConnectionPath = <span class="keyword">new</span> FileGeodatabaseConnectionPath(<span class="keyword">new</span> Uri(<span class="string">@&quot;C:\Temp\rasters.gdb&quot;</span>));</span><br><span class="line"><span class="comment">// Create a new Geodatabase object using the FileGeodatabaseConnectionPath.</span></span><br><span class="line">Geodatabase geodatabase = <span class="keyword">new</span> Geodatabase(geodatabaseConnectionPath);</span><br><span class="line"><span class="comment">// Open the raster dataset.</span></span><br><span class="line">RasterDataset gdbRasterDataset = geodatabase.OpenDataset&lt;RasterDataset&gt;(<span class="string">&quot;sample&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="从栅格数据集获取栅格数据集定义"><a href="#从栅格数据集获取栅格数据集定义" class="headerlink" title="从栅格数据集获取栅格数据集定义"></a>从栅格数据集获取栅格数据集定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  RasterDatasetDefinition rasterDatasetDefinition = rasterDataset.GetDefinition();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// access the dataset definition properties</span></span><br><span class="line">  rasterDatasetDefinition.GetBandCount();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="访问栅格数据集中的波段"><a href="#访问栅格数据集中的波段" class="headerlink" title="访问栅格数据集中的波段"></a>访问栅格数据集中的波段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = rasterDataset.GetBandCount();</span><br><span class="line">RasterBand rasterBandByName = rasterDataset.GetBandByName(sBandName);</span><br><span class="line"><span class="keyword">var</span> index = rasterDataset.GetBandIndex(sBandName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get a RasterBand from the raster dataset</span></span><br><span class="line">RasterBand rasterBand = rasterDataset.GetBand(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the RasterBandDefinition from the raster band.</span></span><br><span class="line">RasterBandDefinition rasterBandDefinition = rasterBand.GetDefinition();</span><br><span class="line"><span class="comment">// Get the name of the raster band from the raster band.</span></span><br><span class="line"><span class="built_in">string</span> bandName = rasterBandDefinition.GetName();</span><br></pre></td></tr></table></figure>

<h3 id="访问栅格属性表中的行"><a href="#访问栅格属性表中的行" class="headerlink" title="访问栅格属性表中的行"></a>访问栅格属性表中的行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> raster = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;RasterLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (raster != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> rasterTbl = raster.GetRaster().GetAttributeTable();</span><br><span class="line">    <span class="keyword">var</span> cursor = rasterTbl.Search();</span><br><span class="line">    <span class="keyword">while</span> (cursor.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> row = cursor.Current;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建栅格光标以循环访问栅格数据"><a href="#创建栅格光标以循环访问栅格数据" class="headerlink" title="创建栅格光标以循环访问栅格数据"></a>创建栅格光标以循环访问栅格数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a full raster from the raster dataset.</span></span><br><span class="line">  ArcGIS.Core.Data.Raster.Raster raster = rasterDataset.CreateFullRaster();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate size of pixel blocks to process. Use 1000 or height/width of the raster, whichever is smaller.</span></span><br><span class="line">  <span class="keyword">var</span> height = raster.GetHeight();</span><br><span class="line">  <span class="keyword">var</span> width = raster.GetWidth();</span><br><span class="line">  <span class="built_in">int</span> pixelBlockHeight = height &gt; <span class="number">1000</span> ? <span class="number">1000</span> : height;</span><br><span class="line">  <span class="built_in">int</span> pixelBlockWidth = width &gt; <span class="number">1000</span> ? <span class="number">1000</span> : width;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the raster cursor using the height and width calculated.</span></span><br><span class="line">  RasterCursor rasterCursor = raster.CreateCursor(pixelBlockWidth, pixelBlockHeight);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use a do-while loop to iterate through the pixel blocks of the raster using the raster cursor.</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get the current pixel block from the cursor.</span></span><br><span class="line">    <span class="keyword">using</span> (PixelBlock currentPixelBlock = rasterCursor.Current)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Do something with the pixel block...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Once you are done, move to the next pixel block.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (rasterCursor.MoveNext());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用像素块在栅格数据集中读取和写入像素"><a href="#使用像素块在栅格数据集中读取和写入像素" class="headerlink" title="使用像素块在栅格数据集中读取和写入像素"></a>使用像素块在栅格数据集中读取和写入像素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Create a full raster from the raster dataset.</span></span><br><span class="line">  ArcGIS.Core.Data.Raster.Raster raster = rasterDataset.CreateFullRaster();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate size of pixel block to create. Use 128 or height/width of the raster, whichever is smaller.</span></span><br><span class="line">  <span class="keyword">var</span> height = raster.GetHeight();</span><br><span class="line">  <span class="keyword">var</span> width = raster.GetWidth();</span><br><span class="line">  <span class="built_in">int</span> pixelBlockHeight = height &gt; <span class="number">128</span> ? <span class="number">128</span> : height;</span><br><span class="line">  <span class="built_in">int</span> pixelBlockWidth = width &gt; <span class="number">128</span> ? <span class="number">128</span> : width;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a new (blank) pixel block.</span></span><br><span class="line">  PixelBlock currentPixelBlock = raster.CreatePixelBlock(pixelBlockWidth, pixelBlockHeight);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Read pixel values from the raster dataset into the pixel block starting from the given top left corner.</span></span><br><span class="line">  raster.Read(<span class="number">0</span>, <span class="number">0</span>, currentPixelBlock);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Do something with the pixel block...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Write the pixel block to the raster dataset starting from the given top left corner.</span></span><br><span class="line">  raster.Write(<span class="number">0</span>, <span class="number">0</span>, currentPixelBlock);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用像素块处理像素"><a href="#使用像素块处理像素" class="headerlink" title="使用像素块处理像素"></a>使用像素块处理像素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Read pixel values from the raster dataset into the pixel block starting from the given top left corner.</span></span><br><span class="line">  raster.Read(<span class="number">0</span>, <span class="number">0</span>, currentPixelBlock);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For each plane (band) in the pixel block</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> plane = <span class="number">0</span>; plane &lt; currentPixelBlock.GetPlaneCount(); plane++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get a copy of the array of pixels from the pixel block corresponding to the current plane.</span></span><br><span class="line">    Array sourcePixels = currentPixelBlock.GetPixelData(plane, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// Get the height and width of the pixel block.</span></span><br><span class="line">    <span class="built_in">int</span> pBHeight = currentPixelBlock.GetHeight();</span><br><span class="line">    <span class="built_in">int</span> pBWidth = currentPixelBlock.GetWidth();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Iterate through the pixels in the array.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pBHeight; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; pBWidth; j++)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Get the NoData mask value to see if the pixel is a valid pixel.</span></span><br><span class="line">        <span class="keyword">if</span> (Convert.ToByte(currentPixelBlock.GetNoDataMaskValue(plane, j, i)) == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// Get the pixel value from the array and process it (add 5 to the value).</span></span><br><span class="line">          <span class="comment">// Note: This is assuming the pixel type is Unisigned 8bit.</span></span><br><span class="line">          <span class="built_in">int</span> pixelValue = Convert.ToInt16(sourcePixels.GetValue(j, i)) + <span class="number">5</span>;</span><br><span class="line">          <span class="comment">// Make sure the pixel value does not go above the range of the pixel type.</span></span><br><span class="line">          pixelValue = pixelValue &gt; <span class="number">254</span> ? <span class="number">254</span> : pixelValue;</span><br><span class="line">          <span class="comment">// Set the new pixel value to the array.</span></span><br><span class="line">          <span class="comment">// Note: This is assuming the pixel type is Unisigned 8bit.</span></span><br><span class="line">          sourcePixels.SetValue(Convert.ToByte(pixelValue), j, i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Set the modified array of pixels back to the pixel block.</span></span><br><span class="line">    currentPixelBlock.SetPixelData(plane, sourcePixels);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Write the pixel block to the raster dataset starting from the given top left corner.</span></span><br><span class="line">  raster.Write(<span class="number">0</span>, <span class="number">0</span>, currentPixelBlock);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="计算栅格统计数据"><a href="#计算栅格统计数据" class="headerlink" title="计算栅格统计数据"></a>计算栅格统计数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//If a raster dataset has statistics, you can create a raster layer and get these statistics by accessing the colorizer.</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Accessing the raster layer</span></span><br><span class="line">  <span class="keyword">var</span> lyr = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;BasicRasterLayer&gt;().FirstOrDefault();</span><br><span class="line">  <span class="comment">//Getting the colorizer</span></span><br><span class="line">  <span class="keyword">var</span> colorizer = lyr.GetColorizer() <span class="keyword">as</span> CIMRasterStretchColorizer;</span><br><span class="line">  <span class="comment">//Accessing the statistics</span></span><br><span class="line">  <span class="keyword">var</span> stats = colorizer.StretchStats;</span><br><span class="line">  <span class="keyword">var</span> max = stats.max;</span><br><span class="line">  <span class="keyword">var</span> min = stats.min;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="场景图层"><a href="#场景图层" class="headerlink" title="场景图层"></a>场景图层</h1><p>创建场景图层</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sceneLayerUrl = <span class="string">@&quot;https://myportal.com/server/rest/services/Hosted/SceneLayerServiceName/SceneServer&quot;</span>;</span><br><span class="line"><span class="comment">//portal items also ok as long as the portal is the current active portal...</span></span><br><span class="line"><span class="comment">//var sceneLayerUrl = @&quot;https://myportal.com/home/item.html?id=123456789abcdef1234567890abcdef0&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Create with initial visibility set to false. Add to current scene</span></span><br><span class="line">  <span class="keyword">var</span> createparams = <span class="keyword">new</span> LayerCreationParams(<span class="keyword">new</span> Uri(sceneLayerUrl, UriKind.Absolute))</span><br><span class="line">  &#123;</span><br><span class="line">    IsVisible = <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//cast to specific type of scene layer being created - in this case FeatureSceneLayer</span></span><br><span class="line">  <span class="keyword">var</span> sceneLayer = LayerFactory.Instance.CreateLayer&lt;Layer&gt;(</span><br><span class="line">           createparams, MapView.Active.Map) <span class="keyword">as</span> FeatureSceneLayer;</span><br><span class="line">  <span class="comment">//or...specify the cast directly</span></span><br><span class="line">  <span class="keyword">var</span> sceneLayer2 = LayerFactory.Instance.CreateLayer&lt;FeatureSceneLayer&gt;(</span><br><span class="line">           createparams, MapView.Active.Map);</span><br><span class="line">  <span class="comment">//ditto for BuildingSceneLayer, PointCloudSceneLayer, IntegratedMeshSceneLayer</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="建筑领域场景图层"><a href="#建筑领域场景图层" class="headerlink" title="建筑领域场景图层"></a>建筑领域场景图层</h2><h3 id="获取建筑规程场景图层规程"><a href="#获取建筑规程场景图层规程" class="headerlink" title="获取建筑规程场景图层规程"></a>获取建筑规程场景图层规程</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bsl_discipline = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;BuildingDisciplineSceneLayer&gt;().FirstOrDefault(l =&gt; l.Name == <span class="string">&quot;Architectural&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> disciplineName = bsl_discipline.GetDiscipline();</span><br></pre></td></tr></table></figure>

<h3 id="枚举建筑物场景图层中的领域图层"><a href="#枚举建筑物场景图层中的领域图层" class="headerlink" title="枚举建筑物场景图层中的领域图层"></a>枚举建筑物场景图层中的领域图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">QueryBuildingSceneLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> bldgLayer = MapView.Active.Map.GetLayersAsFlattenedList().OfType&lt;BuildingSceneLayer&gt;().First();</span><br><span class="line">  <span class="keyword">var</span> disciplines = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, BuildingDisciplineSceneLayer&gt;();</span><br><span class="line">  <span class="comment">//A Building layer has two children - Overview and FullModel</span></span><br><span class="line">  <span class="comment">//Overview is a FeatureSceneLayer</span></span><br><span class="line">  <span class="comment">//Full Model is a BuildingDisciplineSceneLayer that contains the disciplines</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> fullModel = bldgLayer.FindLayers(<span class="string">&quot;Full Model&quot;</span>).First() </span><br><span class="line">                                 <span class="keyword">as</span> BuildingDisciplineSceneLayer;</span><br><span class="line">  CollectDisciplineLayers(fullModel, disciplines);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">void</span> <span class="title">CollectDisciplineLayers</span>(<span class="params">BuildingDisciplineSceneLayer disciplineLayer,</span></span></span><br><span class="line"><span class="params"><span class="function">  Dictionary&lt;<span class="built_in">string</span>, BuildingDisciplineSceneLayer&gt; disciplines</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//collect information on the disciplines</span></span><br><span class="line">  <span class="keyword">var</span> name = disciplineLayer.Name;</span><br><span class="line">  <span class="comment">//At 2.x - var layerType =</span></span><br><span class="line">  <span class="comment">//      ((ISceneLayerInfo)disciplineLayer).SceneServiceLayerType.ToString();</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> discipline = disciplineLayer.GetDiscipline();</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">  <span class="comment">//TODO - use collected information</span></span><br><span class="line"></span><br><span class="line">  disciplines.Add(discipline, disciplineLayer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Discipline layers are composite layers too</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> childDiscipline <span class="keyword">in</span> disciplineLayer.Layers</span><br><span class="line">                      .OfType&lt;BuildingDisciplineSceneLayer&gt;())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Discipline layers can also contain FeatureSceneLayers that render the</span></span><br><span class="line">    <span class="comment">//individual full model contents</span></span><br><span class="line">    <span class="keyword">var</span> content_names = <span class="built_in">string</span>.Join(<span class="string">&quot;, &quot;</span>, childDiscipline.Layers</span><br><span class="line">         .OfType&lt;FeatureSceneLayer&gt;().Select(fl =&gt; fl.Name));</span><br><span class="line">    CollectDisciplineLayers(childDiscipline, disciplines);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="建筑物场景图层"><a href="#建筑物场景图层" class="headerlink" title="建筑物场景图层"></a>建筑物场景图层</h2><h3 id="建筑物场景图层的名称"><a href="#建筑物场景图层的名称" class="headerlink" title="建筑物场景图层的名称"></a>建筑物场景图层的名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bsl = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                  .OfType&lt;BuildingSceneLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> scenelayerName = bsl.Name;</span><br></pre></td></tr></table></figure>

<h3 id="查询建筑物场景图层以获取可用的类型和值"><a href="#查询建筑物场景图层以获取可用的类型和值" class="headerlink" title="查询建筑物场景图层以获取可用的类型和值"></a>查询建筑物场景图层以获取可用的类型和值</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//Retrieve the complete set of types and values for the building scene</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//At 2.x - var dict = bsl.QueryAvailableFieldsAndValues();</span></span><br><span class="line"><span class="keyword">var</span> dict = bsl.GetAvailableFieldsAndValues();</span><br><span class="line"></span><br><span class="line"><span class="comment">//get a list of existing disciplines</span></span><br><span class="line"><span class="keyword">var</span> disciplines = dict.SingleOrDefault(</span><br><span class="line">         kvp =&gt; kvp.Key == <span class="string">&quot;Discipline&quot;</span>).Value ?? <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//get a list of existing categories</span></span><br><span class="line"><span class="keyword">var</span> categories = dict.SingleOrDefault(</span><br><span class="line">         kvp =&gt; kvp.Key == <span class="string">&quot;Category&quot;</span>).Value ?? <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//get a list of existing floors or &quot;levels&quot;</span></span><br><span class="line"><span class="keyword">var</span> floors = dict.SingleOrDefault(</span><br><span class="line">         kvp =&gt; kvp.Key == <span class="string">&quot;BldgLevel&quot;</span>).Value ?? <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br></pre></td></tr></table></figure>

<h3 id="创建默认筛选器并获取筛选器计数"><a href="#创建默认筛选器并获取筛选器计数" class="headerlink" title="创建默认筛选器并获取筛选器计数"></a>创建默认筛选器并获取筛选器计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//Creates a default filter on the building scene</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> filter1 = bsl.CreateDefaultFilter();</span><br><span class="line"><span class="keyword">var</span> values = filter1.FilterBlockDefinitions[<span class="number">0</span>].SelectedValues;</span><br><span class="line"><span class="comment">//values will be a single value for the type</span></span><br><span class="line"><span class="comment">//&quot;CreatedPhase&quot;, value &quot;New Construction&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//There will be at least one filter after &quot;CreateDefaultFilter()&quot; call</span></span><br><span class="line"><span class="keyword">var</span> filtersCount = bsl.GetFilters().Count;</span><br></pre></td></tr></table></figure>

<h3 id="获取包含线框块的所有过滤器"><a href="#获取包含线框块的所有过滤器" class="headerlink" title="获取包含线框块的所有过滤器"></a>获取包含线框块的所有过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//Note: wire_frame_filters can be null in this example</span></span><br><span class="line"><span class="keyword">var</span> wire_frame_filters = bsl.GetFilters().Where(</span><br><span class="line">  f =&gt; f.FilterBlockDefinitions.Any(</span><br><span class="line">    fb =&gt; fb.FilterBlockMode == Object3DRenderingMode.Wireframe));</span><br><span class="line"><span class="comment">//substitute Object3DRenderingMode.None to get blocks with a solid mode (default)</span></span><br><span class="line"><span class="comment">//and...</span></span><br><span class="line"><span class="comment">//fb.FilterBlockMode == Object3DRenderingMode.Wireframe &amp;&amp;</span></span><br><span class="line"><span class="comment">//fb.FilterBlockMode == Object3DRenderingMode.None</span></span><br><span class="line"><span class="comment">//for blocks with both</span></span><br></pre></td></tr></table></figure>

<h3 id="设置和清除建筑物场景图层的活动过滤器"><a href="#设置和清除建筑物场景图层的活动过滤器" class="headerlink" title="设置和清除建筑物场景图层的活动过滤器"></a>设置和清除建筑物场景图层的活动过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//Note: Use HasFilter to check if a given filter id exists in the layer</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="keyword">if</span> (bsl.HasFilter(filter1.ID))</span><br><span class="line">  bsl.SetActiveFilter(filter1.ID);</span><br><span class="line"><span class="keyword">var</span> activeFilter = bsl.GetActiveFilter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Clear the active filter</span></span><br><span class="line">bsl.ClearActiveFilter();</span><br></pre></td></tr></table></figure>

<h3 id="获取建筑物场景图层过滤器-ID-和过滤器"><a href="#获取建筑物场景图层过滤器-ID-和过滤器" class="headerlink" title="获取建筑物场景图层过滤器 ID 和过滤器"></a>获取建筑物场景图层过滤器 ID 和过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> filterID1 = filter1.ID;</span><br><span class="line"><span class="keyword">var</span> filter = bsl.GetFilter(filterID1);</span><br><span class="line"><span class="comment">//or via Linq</span></span><br><span class="line"><span class="comment">//var filter = bsl.GetFilters().FirstOrDefault(f =&gt; f.ID == filterID1);</span></span><br></pre></td></tr></table></figure>

<h3 id="修改建筑物场景图层过滤器名称和描述"><a href="#修改建筑物场景图层过滤器名称和描述" class="headerlink" title="修改建筑物场景图层过滤器名称和描述"></a>修改建筑物场景图层过滤器名称和描述</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//var filter1 = bsl.GetFilter(filterID1);</span></span><br><span class="line"></span><br><span class="line">filter1.Name = <span class="string">&quot;Updated Filter Name&quot;</span>;</span><br><span class="line">filter1.Description = <span class="string">&quot;Updated Filter description&quot;</span>;</span><br><span class="line"><span class="comment">//At 2.x - bsl.SetFilter(filter1);</span></span><br><span class="line">bsl.UpdateFilter(filter);</span><br></pre></td></tr></table></figure>

<h3 id="使用建筑物标高和类别创建过滤器"><a href="#使用建筑物标高和类别创建过滤器" class="headerlink" title="使用建筑物标高和类别创建过滤器"></a>使用建筑物标高和类别创建过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//refer to &quot;Query Building Scene Layer for available Types and Values&quot;</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//At 2.x</span></span><br><span class="line"><span class="comment">//var dict = bsl.QueryAvailableFieldsAndValues();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var dict = bsl.GetAvailableFieldsAndValues();</span></span><br><span class="line"><span class="comment">//var categories = dict.SingleOrDefault(kvp =&gt; kvp.Key == &quot;Category&quot;).Value;</span></span><br><span class="line"><span class="comment">//var floors = dict.SingleOrDefault(kvp =&gt; kvp.Key == &quot;BldgLevel&quot;).Value;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Make a new filter definition</span></span><br><span class="line"><span class="keyword">var</span> fd = <span class="keyword">new</span> FilterDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Floor and Category Filter&quot;</span>,</span><br><span class="line">  Description = <span class="string">&quot;Example filter&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Set up the values for the filter</span></span><br><span class="line"><span class="keyword">var</span> filtervals = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, List&lt;<span class="built_in">string</span>&gt;&gt;();</span><br><span class="line">filtervals.Add(<span class="string">&quot;BldgLevel&quot;</span>, <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; floors[<span class="number">0</span>] &#125;);</span><br><span class="line"><span class="keyword">var</span> category_vals = categories.Where(v =&gt; v == <span class="string">&quot;Walls&quot;</span> || v == <span class="string">&quot;Stairs&quot;</span>).ToList() ?? <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"><span class="keyword">if</span> (category_vals.Count() &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  filtervals.Add(<span class="string">&quot;Category&quot;</span>, category_vals);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Create a solid block (other option is &quot;Wireframe&quot;)</span></span><br><span class="line"><span class="keyword">var</span> fdef = <span class="keyword">new</span> FilterBlockDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  FilterBlockMode = Object3DRenderingMode.None,</span><br><span class="line">  Title = <span class="string">&quot;Solid Filter&quot;</span>,</span><br><span class="line">  SelectedValues = filtervals<span class="comment">//Floor and Category</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Apply the block</span></span><br><span class="line">fd.FilterBlockDefinitions = <span class="keyword">new</span> List&lt;FilterBlockDefinition&gt;() &#123; fdef &#125;;</span><br><span class="line"><span class="comment">//Add the filter definition to the layer</span></span><br><span class="line"><span class="comment">//At 2.x - bsl.SetFilter(fd);</span></span><br><span class="line">bsl.UpdateFilter(fd);</span><br><span class="line"><span class="comment">//Set it active. The ID is auto-generated</span></span><br><span class="line">bsl.SetActiveFilter(fd.ID);</span><br></pre></td></tr></table></figure>

<h3 id="修改建筑物场景图层过滤器块"><a href="#修改建筑物场景图层过滤器块" class="headerlink" title="修改建筑物场景图层过滤器块"></a>修改建筑物场景图层过滤器块</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//Assuming retrieve filter ok</span></span><br><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//var filter1 = bsl.GetFilter(...);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> filterBlock = <span class="keyword">new</span> FilterBlockDefinition();</span><br><span class="line">filterBlock.FilterBlockMode = Object3DRenderingMode.Wireframe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> selectedValues = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, List&lt;<span class="built_in">string</span>&gt;&gt;();</span><br><span class="line"><span class="comment">//We assume QueryAvailableFieldsAndValues() contains &quot;Walls&quot; and &quot;Doors&quot;</span></span><br><span class="line"><span class="comment">//For &#x27;Category&#x27;</span></span><br><span class="line">selectedValues[<span class="string">&quot;Category&quot;</span>] = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;Walls&quot;</span>, <span class="string">&quot;Doors&quot;</span> &#125;;</span><br><span class="line">filterBlock.SelectedValues = selectedValues;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Overwrite</span></span><br><span class="line">filter1.FilterBlockDefinitions = <span class="keyword">new</span> List&lt;FilterBlockDefinition&gt;() &#123; filterBlock &#125;;</span><br><span class="line"><span class="comment">//At 2.x - bsl.SetFilter(filter1);</span></span><br><span class="line">bsl.UpdateFilter(filter1);</span><br></pre></td></tr></table></figure>

<h3 id="移除建筑物场景图层过滤器"><a href="#移除建筑物场景图层过滤器" class="headerlink" title="移除建筑物场景图层过滤器"></a>移除建筑物场景图层过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var bsl = ...;</span></span><br><span class="line"><span class="comment">//Note: Use HasFilter to check if a given filter id exists in the layer</span></span><br><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="keyword">if</span> (bsl.HasFilter(filter1.ID))</span><br><span class="line">  bsl.RemoveFilter(filter1.ID);</span><br><span class="line"><span class="comment">//Or remove all filters</span></span><br><span class="line">bsl.RemoveAllFilters();</span><br></pre></td></tr></table></figure>

<h2 id="要素场景图层编辑"><a href="#要素场景图层编辑" class="headerlink" title="要素场景图层编辑"></a>要素场景图层编辑</h2><h3 id="确定要素场景图层是否支持编辑"><a href="#确定要素场景图层是否支持编辑" class="headerlink" title="确定要素场景图层是否支持编辑"></a>确定要素场景图层是否支持编辑</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featSceneLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                   .OfType&lt;FeatureSceneLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService || </span><br><span class="line">    !featSceneLayer.IsEditable)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//not supported</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//TODO continue editing here...</span></span><br></pre></td></tr></table></figure>

<h3 id="在要素场景图层中创建新点要素"><a href="#在要素场景图层中创建新点要素" class="headerlink" title="在要素场景图层中创建新点要素"></a>在要素场景图层中创建新点要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//must support editing!</span></span><br><span class="line"><span class="comment">//var featSceneLayer = ... ;</span></span><br><span class="line"><span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService || </span><br><span class="line">    !featSceneLayer.IsEditable)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Check geometry type...must be point in this example</span></span><br><span class="line"><span class="keyword">if</span> (featSceneLayer.ShapeType != esriGeometryType.esriGeometryPoint)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> editOp = <span class="keyword">new</span> EditOperation()</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Create new 3d point feature&quot;</span>,</span><br><span class="line">  SelectNewFeatures = <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> attributes = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line"><span class="comment">//mapPoint contains the new 3d point location</span></span><br><span class="line">attributes.Add(<span class="string">&quot;SHAPE&quot;</span>, mapPoint);</span><br><span class="line">attributes.Add(<span class="string">&quot;TreeID&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">editOp.Create(featSceneLayer, attributes);</span><br><span class="line">editOp.ExecuteAsync();<span class="comment">//fyi, no await</span></span><br></pre></td></tr></table></figure>

<h3 id="删除要素场景图层中的所有选定要素"><a href="#删除要素场景图层中的所有选定要素" class="headerlink" title="删除要素场景图层中的所有选定要素"></a>删除要素场景图层中的所有选定要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//must support editing!</span></span><br><span class="line"><span class="comment">//var featSceneLayer = .... ;</span></span><br><span class="line"><span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService || </span><br><span class="line">    !featSceneLayer.IsEditable)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> delOp = <span class="keyword">new</span> EditOperation()</span><br><span class="line">&#123;</span><br><span class="line">  Name = <span class="string">&quot;Delete selected features&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Assuming we have a selection on the layer...</span></span><br><span class="line">delOp.Delete(featSceneLayer, featSceneLayer.GetSelection().GetObjectIDs());</span><br><span class="line"><span class="keyword">await</span> delOp.ExecuteAsync();<span class="comment">//await if needed but not required</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑要素场景图层的属性"><a href="#编辑要素场景图层的属性" class="headerlink" title="编辑要素场景图层的属性"></a>编辑要素场景图层的属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//must support editing!</span></span><br><span class="line"><span class="keyword">var</span> featSceneLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                   .OfType&lt;FeatureSceneLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService || </span><br><span class="line">    !featSceneLayer.IsEditable)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ok = <span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> editOp = <span class="keyword">new</span> EditOperation()</span><br><span class="line">  &#123;</span><br><span class="line">    Name = <span class="string">&quot;Edit FeatureSceneLayer Attributes&quot;</span>,</span><br><span class="line">    SelectModifiedFeatures = <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//make an inspector</span></span><br><span class="line">  <span class="keyword">var</span> inspector = <span class="keyword">new</span> Inspector();</span><br><span class="line">  <span class="comment">//get the attributes for the specified oid</span></span><br><span class="line">  inspector.Load(featSceneLayer, oid);</span><br><span class="line">  inspector[<span class="string">&quot;PermitNotes&quot;</span>] = <span class="string">&quot;test&quot;</span>;<span class="comment">//modify</span></span><br><span class="line">  editOp.Modify(inspector);</span><br><span class="line">  <span class="keyword">return</span> editOp.Execute();<span class="comment">//synchronous flavor</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="要素场景图层"><a href="#要素场景图层" class="headerlink" title="要素场景图层"></a>要素场景图层</h2><h3 id="要素场景图层的名称"><a href="#要素场景图层的名称" class="headerlink" title="要素场景图层的名称"></a>要素场景图层的名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featSceneLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                 .OfType&lt;FeatureSceneLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> scenelayerName = featSceneLayer?.Name;</span><br></pre></td></tr></table></figure>

<h3 id="获取数据源类型"><a href="#获取数据源类型" class="headerlink" title="获取数据源类型"></a>获取数据源类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="keyword">var</span> dataSourceType = featSceneLayer?.GetDataSourceType() ?? </span><br><span class="line">                           SceneLayerDataSourceType.Unknown;</span><br><span class="line"><span class="keyword">if</span> (dataSourceType == SceneLayerDataSourceType.SLPK)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Uses SLPK - only cached attributes</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (dataSourceType == SceneLayerDataSourceType.Service)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Hosted service - can have live attributes - check HasAssociatedFeatureService</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取关联的要素类"><a href="#获取关联的要素类" class="headerlink" title="获取关联的要素类"></a>获取关联的要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ....;</span></span><br><span class="line"><span class="keyword">if</span> (featSceneLayer.HasAssociatedFeatureService)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Must be called on the MCT</span></span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> fc = featSceneLayer.GetFeatureClass())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//TODO query underlying feature class</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取字段定义"><a href="#获取字段定义" class="headerlink" title="获取字段定义"></a>获取字段定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ....;</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Get only the readonly fields</span></span><br><span class="line">  <span class="keyword">var</span> readOnlyFields = featSceneLayer.GetFieldDescriptions()</span><br><span class="line">                              .Where(fdesc =&gt; fdesc.IsReadOnly);</span><br><span class="line">  <span class="comment">//etc</span></span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置定义查询"><a href="#设置定义查询" class="headerlink" title="设置定义查询"></a>设置定义查询</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var featSceneLayer = ...;</span></span><br><span class="line">featSceneLayer.SetDefinitionQuery(<span class="string">&quot;Name = &#x27;Ponderosa Pine&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="通过地图视图选择要素"><a href="#通过地图视图选择要素" class="headerlink" title="通过地图视图选择要素"></a>通过地图视图选择要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//assume the geometry used in SelectFeaturesEx() is coming from a </span></span><br><span class="line"><span class="comment">//map tool...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//SketchType = SketchGeometryType.Rectangle;</span></span><br><span class="line"><span class="comment">//SketchOutputMode = SketchOutputMode.Screen;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> result = MapView.Active.SelectFeaturesEx(geometry);</span><br><span class="line">  <span class="comment">//Get scene layers with selections</span></span><br><span class="line">  <span class="comment">//At 2.x - var scene_layers = result.Where(kvp =&gt; kvp.Key is FeatureSceneLayer);</span></span><br><span class="line">  <span class="keyword">var</span> scene_layers = result.ToDictionary&lt;FeatureSceneLayer&gt;();</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> scene_layers)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> scene_layer = kvp.Key <span class="keyword">as</span> FeatureSceneLayer;</span><br><span class="line">    <span class="keyword">var</span> sel_oids = kvp.Value;</span><br><span class="line">    <span class="comment">//If there are attributes then get them</span></span><br><span class="line">    <span class="keyword">if</span> (scene_layer.HasAssociatedFeatureService)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> insp = <span class="keyword">new</span> Inspector();</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> oid <span class="keyword">in</span> sel_oids)</span><br><span class="line">      &#123;</span><br><span class="line">        insp.Load(scene_layer, oid);</span><br><span class="line">        <span class="comment">//TODO something with retrieved attributes</span></span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="具有关联的要素服务"><a href="#具有关联的要素服务" class="headerlink" title="具有关联的要素服务"></a>具有关联的要素服务</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> featSceneLayer = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                     .OfType&lt;FeatureSceneLayer&gt;().First();</span><br><span class="line"><span class="keyword">if</span> (featSceneLayer.HasAssociatedFeatureService)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Can Select and Search...possibly edit</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="搜索要素场景图层上的行"><a href="#搜索要素场景图层上的行" class="headerlink" title="搜索要素场景图层上的行"></a>搜索要素场景图层上的行</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ...;</span></span><br><span class="line"><span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//Search and Select not supported</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Multipatch (Object3D) or point?</span></span><br><span class="line"><span class="comment">//var is3dObject = ((ISceneLayerInfo)featSceneLayer).SceneServiceLayerType </span></span><br><span class="line"><span class="comment">//                                  == esriSceneServiceLayerType.Object3D;</span></span><br><span class="line"><span class="keyword">var</span> is3dObject = featSceneLayer.FeatureSceneLayerType == FeatureSceneLayerType.Object3D;</span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> queryFilter = <span class="keyword">new</span> QueryFilter</span><br><span class="line">  &#123;</span><br><span class="line">    WhereClause = <span class="string">&quot;Name = &#x27;Ponderosa Pine&#x27;&quot;</span>,</span><br><span class="line">    SubFields = <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> rowCount = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//or select... var select = featSceneLayer.Select(queryFilter)</span></span><br><span class="line">  <span class="keyword">using</span> (RowCursor rowCursor = featSceneLayer.Search(queryFilter))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (rowCursor.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> feature = rowCursor.Current <span class="keyword">as</span> Feature)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> oid = feature.GetObjectID();</span><br><span class="line">        <span class="keyword">var</span> shape = feature.GetShape();</span><br><span class="line">        <span class="keyword">var</span> attrib = feature[<span class="string">&quot;Name&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (is3dObject)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//shape is a multipatch</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//shape is a point</span></span><br><span class="line">        &#125;</span><br><span class="line">        rowCount += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="隐藏所选要素和显示隐藏要素"><a href="#隐藏所选要素和显示隐藏要素" class="headerlink" title="隐藏所选要素和显示隐藏要素"></a>隐藏所选要素和显示隐藏要素</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ...;</span></span><br><span class="line"><span class="keyword">if</span> (featSceneLayer.HasAssociatedFeatureService)</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//Search and Select not supported</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  QueryFilter qf = <span class="keyword">new</span> QueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    ObjectIDs = <span class="keyword">new</span> List&lt;<span class="built_in">long</span>&gt;() &#123; <span class="number">6069</span>, <span class="number">6070</span>, <span class="number">6071</span> &#125;,</span><br><span class="line">    SubFields = <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  featSceneLayer.Select(qf, SelectionCombinationMethod.New);</span><br><span class="line"></span><br><span class="line">  featSceneLayer.HideSelectedFeatures();</span><br><span class="line">  <span class="keyword">var</span> selectionCount = featSceneLayer.SelectionCount;</span><br><span class="line"></span><br><span class="line">  featSceneLayer.ShowHiddenFeatures();</span><br><span class="line">  selectionCount = featSceneLayer.SelectionCount;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用-MapView-Select-SelectFeaturesEx-或-GetFeaturesEx"><a href="#使用-MapView-Select-SelectFeaturesEx-或-GetFeaturesEx" class="headerlink" title="使用 MapView Select SelectFeaturesEx 或 GetFeaturesEx"></a>使用 MapView Select SelectFeaturesEx 或 GetFeaturesEx</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ...;</span></span><br><span class="line"><span class="keyword">var</span> sname = featSceneLayer.Name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Select all features within the current map view</span></span><br><span class="line">  <span class="keyword">var</span> sz = MapView.Active.GetViewSize();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> c_ll = <span class="keyword">new</span> Coordinate2D(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">var</span> c_ur = <span class="keyword">new</span> Coordinate2D(sz.Width, sz.Height);</span><br><span class="line">  <span class="comment">//Use screen coordinates for 3D selection on MapView</span></span><br><span class="line">  <span class="keyword">var</span> env = EnvelopeBuilderEx.CreateEnvelope(c_ll, c_ur);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//HasAssociatedFeatureService does not matter for SelectFeaturesEx</span></span><br><span class="line">  <span class="comment">//or GetFeaturesEx</span></span><br><span class="line">  <span class="keyword">var</span> result = MapView.Active.SelectFeaturesEx(env);</span><br><span class="line">  <span class="comment">//var result = MapView.Active.GetFeaturesEx(env);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//The list of object ids from SelectFeaturesEx</span></span><br><span class="line">  <span class="comment">//At 2.x - var oids1 = result.Where(kvp =&gt; kvp.Key.Name == sname).First().Value;</span></span><br><span class="line">  <span class="keyword">var</span> oids1 = result.ToDictionary().Where(kvp =&gt; kvp.Key.Name == sname).First().Value;</span><br><span class="line">  <span class="comment">//TODO - use the object ids</span></span><br><span class="line"></span><br><span class="line">  MapView.Active.Map.ClearSelection();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="对空间查询使用选择或搜索"><a href="#对空间查询使用选择或搜索" class="headerlink" title="对空间查询使用选择或搜索"></a>对空间查询使用选择或搜索</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var featSceneLayer = ...;</span></span><br><span class="line"><span class="comment">//var sname = featSceneLayer.Name;</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!featSceneLayer.HasAssociatedFeatureService)</span><br><span class="line">    <span class="keyword">return</span>;<span class="comment">//no search or select</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Select all features within the current map view</span></span><br><span class="line">  <span class="keyword">var</span> sz = MapView.Active.GetViewSize();</span><br><span class="line">  <span class="keyword">var</span> map_pt1 = MapView.Active.ClientToMap(<span class="keyword">new</span> System.Windows.Point(<span class="number">0</span>, sz.Height));</span><br><span class="line">  <span class="keyword">var</span> map_pt2 = MapView.Active.ClientToMap(<span class="keyword">new</span> System.Windows.Point(sz.Width, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Convert to an envelope</span></span><br><span class="line">  <span class="keyword">var</span> temp_env = EnvelopeBuilderEx.CreateEnvelope(map_pt1, map_pt2, MapView.Active.Map.SpatialReference);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Project if needed to the layer spatial ref</span></span><br><span class="line">  SpatialReference sr = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> fc = featSceneLayer.GetFeatureClass())</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> fdef = fc.GetDefinition())</span><br><span class="line">    sr = fdef.GetSpatialReference();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> env = GeometryEngine.Instance.Project(temp_env, sr) <span class="keyword">as</span> Envelope;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set up a query filter</span></span><br><span class="line">  <span class="keyword">var</span> sf = <span class="keyword">new</span> SpatialQueryFilter()</span><br><span class="line">  &#123;</span><br><span class="line">    FilterGeometry = env,</span><br><span class="line">    SpatialRelationship = SpatialRelationship.Intersects,</span><br><span class="line">    SubFields = <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Select against the feature service</span></span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">select</span> = featSceneLayer.Select(sf);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">select</span>.GetCount() &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//enumerate over the selected features</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = <span class="keyword">select</span>.Search())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> feature = rc.Current <span class="keyword">as</span> Feature)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">var</span> oid = feature.GetObjectID();</span><br><span class="line">          <span class="comment">//etc.</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MapView.Active.Map.ClearSelection();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="点云场景图层"><a href="#点云场景图层" class="headerlink" title="点云场景图层"></a>点云场景图层</h2><h3 id="点云场景图层的名称"><a href="#点云场景图层的名称" class="headerlink" title="点云场景图层的名称"></a>点云场景图层的名称</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pcsl = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">               .OfType&lt;PointCloudSceneLayer&gt;().FirstOrDefault();</span><br><span class="line"><span class="keyword">var</span> scenelayerName = pcsl?.Name;</span><br></pre></td></tr></table></figure>

<h3 id="获取点云场景图层的数据源类型"><a href="#获取点云场景图层的数据源类型" class="headerlink" title="获取点云场景图层的数据源类型"></a>获取点云场景图层的数据源类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="comment">//At 2.x - ISceneLayerInfo slInfo = pcsl as ISceneLayerInfo;</span></span><br><span class="line"><span class="comment">//         SceneLayerDataSourceType dataSourceType = slInfo.GetDataSourceType();</span></span><br><span class="line"></span><br><span class="line">SceneLayerDataSourceType dataSourceType = pcsl.GetDataSourceType();</span><br><span class="line"><span class="keyword">if</span> (dataSourceType == SceneLayerDataSourceType.Service)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//TODO...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (dataSourceType == SceneLayerDataSourceType.SLPK)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询点云场景图层中的所有类代码和标签"><a href="#查询点云场景图层中的所有类代码和标签" class="headerlink" title="查询点云场景图层中的所有类代码和标签"></a>查询点云场景图层中的所有类代码和标签</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="comment">//At 2.x - Dictionary&lt;int, string&gt; classCodesAndLabels =</span></span><br><span class="line"><span class="comment">//                    pcsl.QueryAvailableClassCodesAndLabels();</span></span><br><span class="line"></span><br><span class="line">Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; classCodesAndLabels = </span><br><span class="line">                pcsl.GetAvailableClassCodesAndLabels();</span><br></pre></td></tr></table></figure>

<h3 id="为点云场景图层设置过滤器"><a href="#为点云场景图层设置过滤器" class="headerlink" title="为点云场景图层设置过滤器"></a>为点云场景图层设置过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="comment">//Retrieve the available classification codes</span></span><br><span class="line"><span class="comment">//At 2.x - var dict = pcsl.QueryAvailableClassCodesAndLabels();</span></span><br><span class="line"><span class="keyword">var</span> dict = pcsl.GetAvailableClassCodesAndLabels();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Filter out low noise and unclassified (7 and 1 respectively)</span></span><br><span class="line"><span class="comment">//consult https://pro.arcgis.com/en/pro-app/help/data/las-dataset/storing-lidar-data.htm</span></span><br><span class="line"><span class="keyword">var</span> filterDef = <span class="keyword">new</span> PointCloudFilterDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  ClassCodes = dict.Keys.Where(c =&gt; c != <span class="number">7</span> &amp;&amp; c != <span class="number">1</span>).ToList(),</span><br><span class="line">  ReturnValues = <span class="keyword">new</span> List&lt;PointCloudReturnType&gt; &#123; </span><br><span class="line">                         PointCloudReturnType.FirstOfMany &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//apply the filter</span></span><br><span class="line">pcsl.SetFilters(filterDef.ToCIM());</span><br></pre></td></tr></table></figure>

<h3 id="更新-PointCloudSceneLayer-的类标志"><a href="#更新-PointCloudSceneLayer-的类标志" class="headerlink" title="更新 PointCloudSceneLayer 的类标志"></a>更新 PointCloudSceneLayer 的类标志</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> filters = pcsl.GetFilters();</span><br><span class="line">PointCloudFilterDefinition fdef = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (filters.Count() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  fdef = <span class="keyword">new</span> PointCloudFilterDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//7 is &quot;edge of flight line&quot; - exclude</span></span><br><span class="line">    ClassFlags = <span class="keyword">new</span> List&lt;ClassFlag&gt; &#123; </span><br><span class="line">       <span class="keyword">new</span> ClassFlag(<span class="number">7</span>, ClassFlagOption.Exclude) &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  fdef = PointCloudFilterDefinition.FromCIM(filters);</span><br><span class="line">  <span class="comment">//keep any include or ignore class flags</span></span><br><span class="line">  <span class="keyword">var</span> keep = fdef.ClassFlags.Where(</span><br><span class="line">         cf =&gt; cf.ClassFlagOption != ClassFlagOption.Exclude).ToList();</span><br><span class="line">  <span class="comment">//7 is &quot;edge of flight line&quot; - exclude</span></span><br><span class="line">  keep.Add(<span class="keyword">new</span> ClassFlag(<span class="number">7</span>, ClassFlagOption.Exclude));</span><br><span class="line">  fdef.ClassFlags = keep;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//apply</span></span><br><span class="line">pcsl.SetFilters(fdef.ToCIM());</span><br></pre></td></tr></table></figure>

<h3 id="获取-PointCloudSceneLayer-的过滤器"><a href="#获取-PointCloudSceneLayer-的过滤器" class="headerlink" title="获取 PointCloudSceneLayer 的过滤器"></a>获取 PointCloudSceneLayer 的过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line">IReadOnlyList&lt;CIMPointCloudFilter&gt; updatedFilter = pcsl.GetFilters();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> filter <span class="keyword">in</span> updatedFilter)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//There is either 0 or 1 of each</span></span><br><span class="line">  <span class="keyword">if</span> (filter <span class="keyword">is</span> CIMPointCloudReturnFilter returnFilter)</span><br><span class="line">  &#123;</span><br><span class="line">    PointCloudFilterDefinition pcfl = PointCloudFilterDefinition.FromCIM(updatedFilter);</span><br><span class="line">    List&lt;PointCloudReturnType&gt; updatedReturnValues = pcfl.ReturnValues;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (filter <span class="keyword">is</span> CIMPointCloudValueFilter classCodesFilter)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (filter <span class="keyword">is</span> CIMPointCloudBitFieldFilter classFlagsFilter)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="清除点云场景图层中的过滤器"><a href="#清除点云场景图层中的过滤器" class="headerlink" title="清除点云场景图层中的过滤器"></a>清除点云场景图层中的过滤器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line">pcsl.ClearFilters();</span><br></pre></td></tr></table></figure>

<h3 id="获取点云场景图层渲染器和渲染器类型"><a href="#获取点云场景图层渲染器和渲染器类型" class="headerlink" title="获取点云场景图层渲染器和渲染器类型"></a>获取点云场景图层渲染器和渲染器类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line">CIMPointCloudRenderer cimGetPCLRenderer = pcsl.GetRenderer();</span><br><span class="line"><span class="comment">//Can be one of Unknown, Stretch, ClassBreaks, UniqueValue, RGB</span></span><br><span class="line">PointCloudRendererType pclRendererType = pcsl.RendererType;</span><br></pre></td></tr></table></figure>

<h3 id="查询点云场景图层渲染器字段"><a href="#查询点云场景图层渲染器字段" class="headerlink" title="查询点云场景图层渲染器字段"></a>查询点云场景图层渲染器字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="comment">//At 2.x - IReadOnlyList&lt;string&gt; flds = pcsl.QueryAvailablePointCloudRendererFields(</span></span><br><span class="line"><span class="comment">//                                     PointCloudRendererType.UniqueValueRenderer);</span></span><br><span class="line">IReadOnlyList&lt;<span class="built_in">string</span>&gt; flds = pcsl.GetAvailablePointCloudRendererFields(</span><br><span class="line">                             PointCloudRendererType.UniqueValueRenderer);</span><br><span class="line"><span class="keyword">var</span> fldCount = flds.Count;</span><br></pre></td></tr></table></figure>

<h3 id="创建和设置拉伸渲染器"><a href="#创建和设置拉伸渲染器" class="headerlink" title="创建和设置拉伸渲染器"></a>创建和设置拉伸渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var fields = pcsl.QueryAvailablePointCloudRendererFields(</span></span><br><span class="line"><span class="comment">//                           PointCloudRendererType.StretchRenderer);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fields = pcsl.GetAvailablePointCloudRendererFields(</span><br><span class="line">                         PointCloudRendererType.StretchRenderer);</span><br><span class="line"><span class="keyword">var</span> stretchDef = <span class="keyword">new</span> PointCloudRendererDefinition(</span><br><span class="line">                          PointCloudRendererType.StretchRenderer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Will be either ELEVATION or INTENSITY</span></span><br><span class="line">  Field = fields[<span class="number">0</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create the CIM Renderer</span></span><br><span class="line"><span class="keyword">var</span> stretchRenderer = pcsl.CreateRenderer(stretchDef) </span><br><span class="line">                                   <span class="keyword">as</span> CIMPointCloudStretchRenderer;</span><br><span class="line"><span class="comment">//Apply a color ramp</span></span><br><span class="line"><span class="keyword">var</span> style = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                                .First(s =&gt; s.Name == <span class="string">&quot;ArcGIS Colors&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> colorRamp = style.SearchColorRamps(<span class="string">&quot;&quot;</span>).First();</span><br><span class="line">stretchRenderer.ColorRamp = colorRamp.ColorRamp;</span><br><span class="line"><span class="comment">//Apply modulation</span></span><br><span class="line">stretchRenderer.ColorModulation = <span class="keyword">new</span> CIMColorModulationInfo()</span><br><span class="line">&#123;</span><br><span class="line">  MinValue = <span class="number">0</span>,</span><br><span class="line">  MaxValue = <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//apply the renderer</span></span><br><span class="line">pcsl.SetRenderer(stretchRenderer);</span><br></pre></td></tr></table></figure>

<h3 id="创建和设置分类间隔渲染器"><a href="#创建和设置分类间隔渲染器" class="headerlink" title="创建和设置分类间隔渲染器"></a>创建和设置分类间隔渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//At 2.x - var fields = pcsl.QueryAvailablePointCloudRendererFields(</span></span><br><span class="line"><span class="comment">//                          PointCloudRendererType.ClassBreaksRenderer);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fields = pcsl.GetAvailablePointCloudRendererFields(</span><br><span class="line">                     PointCloudRendererType.ClassBreaksRenderer);</span><br><span class="line"><span class="keyword">var</span> classBreakDef = <span class="keyword">new</span> PointCloudRendererDefinition(</span><br><span class="line">                          PointCloudRendererType.ClassBreaksRenderer)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//ELEVATION or INTENSITY</span></span><br><span class="line">  Field = fields[<span class="number">0</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//create the renderer</span></span><br><span class="line"><span class="keyword">var</span> cbr = pcsl.CreateRenderer(classBreakDef) </span><br><span class="line">                          <span class="keyword">as</span> CIMPointCloudClassBreaksRenderer;</span><br><span class="line"><span class="comment">//Set up a color scheme to use</span></span><br><span class="line"><span class="keyword">var</span> style = Project.Current.GetItems&lt;StyleProjectItem&gt;()</span><br><span class="line">                           .First(s =&gt; s.Name == <span class="string">&quot;ArcGIS Colors&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> rampStyle = style.LookupItem(</span><br><span class="line">  StyleItemType.ColorRamp, <span class="string">&quot;Spectrum By Wavelength-Full Bright_Multi-hue_2&quot;</span>)</span><br><span class="line">                                                            <span class="keyword">as</span> ColorRampStyleItem;</span><br><span class="line"><span class="keyword">var</span> colorScheme = rampStyle.ColorRamp;</span><br><span class="line"><span class="comment">//Set up 6 manual class breaks</span></span><br><span class="line"><span class="keyword">var</span> breaks = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> colors = ColorFactory.Instance.GenerateColorsFromColorRamp(</span><br><span class="line">                                            colorScheme, breaks);</span><br><span class="line"><span class="keyword">var</span> classBreaks = <span class="keyword">new</span> List&lt;CIMColorClassBreak&gt;();</span><br><span class="line"><span class="keyword">var</span> min = cbr.Breaks[<span class="number">0</span>].UpperBound;</span><br><span class="line"><span class="keyword">var</span> max = cbr.Breaks[cbr.Breaks.Count() - <span class="number">1</span>].UpperBound;</span><br><span class="line"><span class="keyword">var</span> step = (max - min) / (<span class="built_in">double</span>)breaks;</span><br><span class="line"></span><br><span class="line"><span class="comment">//add in the class breaks</span></span><br><span class="line"><span class="built_in">double</span> upper = min;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> b = <span class="number">1</span>; b &lt;= breaks; b++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">double</span> lower = upper;</span><br><span class="line">  upper = b == breaks ? max : min + (b * step);</span><br><span class="line">  <span class="keyword">var</span> cb = <span class="keyword">new</span> CIMColorClassBreak()</span><br><span class="line">  &#123;</span><br><span class="line">    UpperBound = upper,</span><br><span class="line">    Label = <span class="built_in">string</span>.Format(<span class="string">&quot;&#123;0:#0.0#&#125; - &#123;1:#0.0#&#125;&quot;</span>, lower, upper),</span><br><span class="line">    Color = colors[b - <span class="number">1</span>]</span><br><span class="line">  &#125;;</span><br><span class="line">  classBreaks.Add(cb);</span><br><span class="line">&#125;</span><br><span class="line">cbr.Breaks = classBreaks.ToArray();</span><br><span class="line">pcsl.SetRenderer(cbr);</span><br></pre></td></tr></table></figure>

<h2 id="点云场景图层扩展属性"><a href="#点云场景图层扩展属性" class="headerlink" title="点云场景图层扩展属性"></a>点云场景图层扩展属性</h2><h3 id="编辑颜色调制"><a href="#编辑颜色调制" class="headerlink" title="编辑颜色调制"></a>编辑颜色调制</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> def = pcsl.GetDefinition() <span class="keyword">as</span> CIMPointCloudLayer;</span><br><span class="line"><span class="comment">//Get the ColorModulation off the renderer</span></span><br><span class="line"><span class="keyword">var</span> modulation = def.Renderer.ColorModulation;</span><br><span class="line"><span class="keyword">if</span> (modulation == <span class="literal">null</span>)</span><br><span class="line">  modulation = <span class="keyword">new</span> CIMColorModulationInfo();</span><br><span class="line"><span class="comment">//Set the minimum and maximum intensity as needed</span></span><br><span class="line">modulation.MinValue = <span class="number">0</span>;</span><br><span class="line">modulation.MaxValue = <span class="number">100.0</span>;</span><br><span class="line"><span class="comment">//apply back</span></span><br><span class="line">def.Renderer.ColorModulation = modulation;</span><br><span class="line"><span class="comment">//Commit changes back to the CIM</span></span><br><span class="line">pcsl.SetDefinition(def);</span><br></pre></td></tr></table></figure>

<h3 id="编辑渲染器以使用固定大小"><a href="#编辑渲染器以使用固定大小" class="headerlink" title="编辑渲染器以使用固定大小"></a>编辑渲染器以使用固定大小</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> def = pcsl.GetDefinition() <span class="keyword">as</span> CIMPointCloudLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the point shape and sizing on the renderer</span></span><br><span class="line">def.Renderer.PointShape = PointCloudShapeType.DiskShaded;</span><br><span class="line"><span class="keyword">var</span> pointSize = <span class="keyword">new</span> CIMPointCloudFixedSizeAlgorithm()</span><br><span class="line">&#123;</span><br><span class="line">  UseRealWorldSymbolSizes = <span class="literal">false</span>,</span><br><span class="line">  Size = <span class="number">8</span></span><br><span class="line">&#125;;</span><br><span class="line">def.Renderer.PointSizeAlgorithm = pointSize;</span><br><span class="line"><span class="comment">//Commit changes back to the CIM</span></span><br><span class="line">pcsl.SetDefinition(def);</span><br></pre></td></tr></table></figure>

<h3 id="编辑渲染器以缩放大小"><a href="#编辑渲染器以缩放大小" class="headerlink" title="编辑渲染器以缩放大小"></a>编辑渲染器以缩放大小</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> def = pcsl.GetDefinition() <span class="keyword">as</span> CIMPointCloudLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the point shape and sizing on the renderer</span></span><br><span class="line">def.Renderer.PointShape = PointCloudShapeType.DiskFlat;<span class="comment">//default</span></span><br><span class="line"><span class="keyword">var</span> scaleSize = <span class="keyword">new</span> CIMPointCloudSplatAlgorithm()</span><br><span class="line">&#123;</span><br><span class="line">  MinSize = <span class="number">8</span>,</span><br><span class="line">  ScaleFactor = <span class="number">1.0</span> <span class="comment">//100%</span></span><br><span class="line">&#125;;</span><br><span class="line">def.Renderer.PointSizeAlgorithm = scaleSize;</span><br><span class="line"><span class="comment">//Commit changes back to the CIM</span></span><br><span class="line">pcsl.SetDefinition(def);</span><br></pre></td></tr></table></figure>

<h3 id="编辑密度设置"><a href="#编辑密度设置" class="headerlink" title="编辑密度设置"></a>编辑密度设置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be called on the MCT</span></span><br><span class="line"><span class="comment">//var pcsl = ...;</span></span><br><span class="line"><span class="keyword">var</span> def = pcsl.GetDefinition() <span class="keyword">as</span> CIMPointCloudLayer;</span><br><span class="line"><span class="comment">//PointsBudget - corresponds to Display Limit on the UI</span></span><br><span class="line"><span class="comment">// - the absolute maximum # of points to display</span></span><br><span class="line">def.PointsBudget = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PointsPerInch - corresponds to Density Min --- Max on the UI</span></span><br><span class="line"><span class="comment">// - the max number of points per display inch to renderer</span></span><br><span class="line">def.PointsPerInch = <span class="number">15</span>;</span><br><span class="line"><span class="comment">//Commit changes back to the CIM</span></span><br><span class="line">pcsl.SetDefinition(def);</span><br></pre></td></tr></table></figure>

<h1 id="流图层"><a href="#流图层" class="headerlink" title="流图层"></a>流图层</h1><h2 id="创建流图层"><a href="#创建流图层" class="headerlink" title="创建流图层"></a>创建流图层</h2><h3 id="使用-URI-创建流图层"><a href="#使用-URI-创建流图层" class="headerlink" title="使用 URI 创建流图层"></a>使用 URI 创建流图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;https://geoeventsample1.esri.com:6443/arcgis/rest/services/AirportTraffics/StreamServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> createParam = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  IsVisible = <span class="literal">false</span> <span class="comment">//turned off by default</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> streamLayer = LayerFactory.Instance.CreateLayer&lt;StreamLayer&gt;(createParam, map);</span><br><span class="line"></span><br><span class="line"><span class="comment">//or use &quot;original&quot; create layer (will be visible by default)</span></span><br><span class="line">Uri uri = <span class="keyword">new</span> Uri(url);</span><br><span class="line">streamLayer = LayerFactory.Instance.CreateLayer(uri, map) <span class="keyword">as</span> StreamLayer;</span><br><span class="line">streamLayer.SetVisibility(<span class="literal">false</span>);<span class="comment">//turn off</span></span><br></pre></td></tr></table></figure>

<h3 id="使用定义查询创建流图层"><a href="#使用定义查询创建流图层" class="headerlink" title="使用定义查询创建流图层"></a>使用定义查询创建流图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on the QueuedTask</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;https://geoeventsample1.esri.com:6443/arcgis/rest/services/AirportTraffics/StreamServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> lyrCreateParam = <span class="keyword">new</span> FeatureLayerCreationParams(<span class="keyword">new</span> Uri(url))</span><br><span class="line">&#123;</span><br><span class="line">  IsVisible = <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//At 2.x - DefinitionFilter = new CIMDefinitionFilter()</span></span><br><span class="line">  <span class="comment">//&#123;</span></span><br><span class="line">  <span class="comment">//  DefinitionExpression = &quot;RWY = &#x27;29L&#x27;&quot;,</span></span><br><span class="line">  <span class="comment">//  Name = &quot;Runway&quot;</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  DefinitionQuery = <span class="keyword">new</span> DefinitionQuery(whereClause: <span class="string">&quot;RWY = &#x27;29L&#x27;&quot;</span>, name: <span class="string">&quot;Runway&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> streamLayer = LayerFactory.Instance.CreateLayer&lt;StreamLayer&gt;(lyrCreateParam, map);</span><br></pre></td></tr></table></figure>

<h3 id="使用简单渲染器创建流图层"><a href="#使用简单渲染器创建流图层" class="headerlink" title="使用简单渲染器创建流图层"></a>使用简单渲染器创建流图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">@&quot;https://geoeventsample1.esri.com:6443/arcgis/rest/services/LABus/StreamServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> uri = <span class="keyword">new</span> Uri(url, UriKind.Absolute);</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> FeatureLayerCreationParams(uri)</span><br><span class="line">&#123;</span><br><span class="line">  RendererDefinition = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">  &#123;</span><br><span class="line">    SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">                        ColorFactory.Instance.BlueRGB,</span><br><span class="line">                        <span class="number">12</span>,</span><br><span class="line">                 SimpleMarkerStyle.Pushpin).MakeSymbolReference()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> streamLayer = LayerFactory.Instance.CreateLayer&lt;StreamLayer&gt;(</span><br><span class="line">                    createParams, map);</span><br></pre></td></tr></table></figure>

<h3 id="为最新观测值设置唯一值渲染器"><a href="#为最新观测值设置唯一值渲染器" class="headerlink" title="为最新观测值设置唯一值渲染器"></a>为最新观测值设置唯一值渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">@&quot;https://geoeventsample1.esri.com:6443/arcgis/rest/services/AirportTraffics/StreamServer&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> uri = <span class="keyword">new</span> Uri(url, UriKind.Absolute);</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createParams = <span class="keyword">new</span> FeatureLayerCreationParams(uri)</span><br><span class="line">&#123;</span><br><span class="line">  IsVisible = <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> streamLayer = LayerFactory.Instance.CreateLayer&lt;StreamLayer&gt;(</span><br><span class="line">                    createParams, map);</span><br><span class="line"><span class="comment">//Define the unique values by hand</span></span><br><span class="line"><span class="keyword">var</span> uvr = <span class="keyword">new</span> CIMUniqueValueRenderer()</span><br><span class="line">&#123;</span><br><span class="line">  Fields = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;ACTYPE&quot;</span> &#125;,</span><br><span class="line">  UseDefaultSymbol = <span class="literal">true</span>,</span><br><span class="line">  DefaultLabel = <span class="string">&quot;Others&quot;</span>,</span><br><span class="line">  DefaultSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">              CIMColor.CreateRGBColor(<span class="number">185</span>, <span class="number">185</span>, <span class="number">185</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> classes = <span class="keyword">new</span> List&lt;CIMUniqueValueClass&gt;();</span><br><span class="line"><span class="comment">//add in classes - one for ACTYPE of 727, one for DC 9</span></span><br><span class="line">classes.Add(</span><br><span class="line">  <span class="keyword">new</span> CIMUniqueValueClass() &#123;</span><br><span class="line">        Values = <span class="keyword">new</span> CIMUniqueValue[] &#123;</span><br><span class="line">              <span class="keyword">new</span> CIMUniqueValue() &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;B727&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">        Visible = <span class="literal">true</span>,</span><br><span class="line">        Label = <span class="string">&quot;Boeing 727&quot;</span>,</span><br><span class="line">        Symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">              ColorFactory.Instance.RedRGB, <span class="number">10</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;);</span><br><span class="line">classes.Add(</span><br><span class="line">  <span class="keyword">new</span> CIMUniqueValueClass()</span><br><span class="line">  &#123;</span><br><span class="line">    Values = <span class="keyword">new</span> CIMUniqueValue[] &#123;</span><br><span class="line">              <span class="keyword">new</span> CIMUniqueValue() &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;DC9&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">    Visible = <span class="literal">true</span>,</span><br><span class="line">    Label = <span class="string">&quot;DC 9&quot;</span>,</span><br><span class="line">    Symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">              ColorFactory.Instance.GreenRGB, <span class="number">10</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">//add the classes to a group</span></span><br><span class="line"><span class="keyword">var</span> groups = <span class="keyword">new</span> List&lt;CIMUniqueValueGroup&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">new</span> CIMUniqueValueGroup() &#123;</span><br><span class="line">     Classes = classes.ToArray()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//add the groups to the renderer</span></span><br><span class="line">uvr.Groups = groups.ToArray();</span><br><span class="line"><span class="comment">//Apply the renderer (for current observations)</span></span><br><span class="line">streamLayer.SetRenderer(uvr);</span><br><span class="line">streamLayer.SetVisibility(<span class="literal">true</span>);<span class="comment">//turn on the layer</span></span><br></pre></td></tr></table></figure>

<h2 id="流图层设置和属性"><a href="#流图层设置和属性" class="headerlink" title="流图层设置和属性"></a>流图层设置和属性</h2><h3 id="查找所有可识别轨迹的流图层"><a href="#查找所有可识别轨迹的流图层" class="headerlink" title="查找所有可识别轨迹的流图层"></a>查找所有可识别轨迹的流图层</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> trackAwareLayers = MapView.Active.Map.GetLayersAsFlattenedList()</span><br><span class="line">                           .OfType&lt;StreamLayer&gt;().Where(sl =&gt; sl.IsTrackAware)?.ToList();</span><br></pre></td></tr></table></figure>

<h3 id="确定流图层类型"><a href="#确定流图层类型" class="headerlink" title="确定流图层类型"></a>确定流图层类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spatial or non-spatial?</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType == TrackType.AttributeOnly)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//this is a non-spatial stream layer</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//this must be a spatial stream layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查流图层连接状态"><a href="#检查流图层连接状态" class="headerlink" title="检查流图层连接状态"></a>检查流图层连接状态</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!streamLayer.IsStreamingConnectionOpen)</span><br><span class="line">  <span class="comment">//Must be on QueuedTask!</span></span><br><span class="line">  streamLayer.StartStreaming();</span><br></pre></td></tr></table></figure>

<h3 id="开始和停止流式传输"><a href="#开始和停止流式传输" class="headerlink" title="开始和停止流式传输"></a>开始和停止流式传输</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="comment">//Start...</span></span><br><span class="line">streamLayer.StartStreaming();</span><br><span class="line"><span class="comment">//Stop...</span></span><br><span class="line">streamLayer.StopStreaming();</span><br></pre></td></tr></table></figure>

<h3 id="删除所有当前和以前的观察结果"><a href="#删除所有当前和以前的观察结果" class="headerlink" title="删除所有当前和以前的观察结果"></a>删除所有当前和以前的观察结果</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="comment">//Must be called on the feature class</span></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line">  rfc.Truncate();</span><br></pre></td></tr></table></figure>

<h3 id="获取跟踪-ID-字段"><a href="#获取跟踪-ID-字段" class="headerlink" title="获取跟踪 ID 字段"></a>获取跟踪 ID 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (streamLayer.IsTrackAware)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> trackField = streamLayer.TrackIdFieldName;</span><br><span class="line">  <span class="comment">//TODO use the field name</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取曲目类型"><a href="#获取曲目类型" class="headerlink" title="获取曲目类型"></a>获取曲目类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> trackType = streamLayer.TrackType;</span><br><span class="line"><span class="keyword">switch</span>(trackType)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//TODO deal with tracktype</span></span><br><span class="line">  <span class="keyword">case</span> TrackType.None:</span><br><span class="line">  <span class="keyword">case</span> TrackType.AttributeOnly:</span><br><span class="line">  <span class="keyword">case</span> TrackType.Spatial:</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置要存储在内存中的先前观测值的最大计数"><a href="#设置要存储在内存中的先前观测值的最大计数" class="headerlink" title="设置要存储在内存中的先前观测值的最大计数"></a>设置要存储在内存中的先前观测值的最大计数</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"><span class="comment">//Set Expiration Method and Max Expiration Count</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.GetExpirationMethod() != FeatureExpirationMethod.MaximumFeatureCount)</span><br><span class="line">  streamLayer.SetExpirationMethod(FeatureExpirationMethod.MaximumFeatureCount);</span><br><span class="line">streamLayer.SetExpirationMaxCount(<span class="number">15</span>);</span><br><span class="line"><span class="comment">//FYI</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.IsTrackAware)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//MaxCount is per track! otherwise for the entire layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置要存储在内存中的先前观测值的最长期限"><a href="#设置要存储在内存中的先前观测值的最长期限" class="headerlink" title="设置要存储在内存中的先前观测值的最长期限"></a>设置要存储在内存中的先前观测值的最长期限</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"><span class="comment">//Set Expiration Method and Max Expiration Age</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.GetExpirationMethod() != FeatureExpirationMethod.MaximumFeatureAge)</span><br><span class="line">  streamLayer.SetExpirationMethod(FeatureExpirationMethod.MaximumFeatureAge);</span><br><span class="line"><span class="comment">//set to 12 hours (max is 24 hours)</span></span><br><span class="line">streamLayer.SetExpirationMaxAge(<span class="keyword">new</span> TimeSpan(<span class="number">12</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//FYI</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.IsTrackAware)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//MaxAge is per track! otherwise for the entire layer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过-CIM-设置各种流图层属性"><a href="#通过-CIM-设置各种流图层属性" class="headerlink" title="通过 CIM 设置各种流图层属性"></a>通过 CIM 设置各种流图层属性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"><span class="comment">//get the CIM Definition</span></span><br><span class="line"><span class="keyword">var</span> def = streamLayer.GetDefinition() <span class="keyword">as</span> CIMFeatureLayer;</span><br><span class="line"><span class="comment">//set the number of previous observations, </span></span><br><span class="line">def.PreviousObservationsCount = (<span class="built_in">int</span>)streamLayer.GetExpirationMaxCount() - <span class="number">1</span>;</span><br><span class="line"><span class="comment">//set show previous observations and track lines to true</span></span><br><span class="line">def.ShowPreviousObservations = <span class="literal">true</span>;</span><br><span class="line">def.ShowTracks = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//commit the changes</span></span><br><span class="line">streamLayer.SetDefinition(def);</span><br></pre></td></tr></table></figure>

<h1 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h1><h3 id="定义唯一值呈现器定义"><a href="#定义唯一值呈现器定义" class="headerlink" title="定义唯一值呈现器定义"></a>定义唯一值呈现器定义</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uvrDef = <span class="keyword">new</span> UniqueValueRendererDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  ValueFields = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;ACTYPE&quot;</span> &#125;,</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    ColorFactory.Instance.RedRGB, <span class="number">10</span>, SimpleMarkerStyle.Hexagon)</span><br><span class="line">      .MakeSymbolReference(),</span><br><span class="line">  ValuesLimit = <span class="number">5</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Note: CreateRenderer can only create value classes based on</span></span><br><span class="line"><span class="comment">//the current events it has received</span></span><br><span class="line">streamLayer.SetRenderer(streamLayer.CreateRenderer(uvrDef));</span><br></pre></td></tr></table></figure>

<h3 id="为最新观测值设置唯一值渲染器-1"><a href="#为最新观测值设置唯一值渲染器-1" class="headerlink" title="为最新观测值设置唯一值渲染器"></a>为最新观测值设置唯一值渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Define the classes by hand to avoid using CreateRenderer(...)</span></span><br><span class="line">CIMUniqueValueClass uvcB727 = <span class="keyword">new</span> CIMUniqueValueClass()</span><br><span class="line">&#123;</span><br><span class="line">  Values = <span class="keyword">new</span> CIMUniqueValue[] &#123; <span class="keyword">new</span> CIMUniqueValue() &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;B727&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">  Visible = <span class="literal">true</span>,</span><br><span class="line">  Label = <span class="string">&quot;Boeing 727&quot;</span>,</span><br><span class="line">  Symbol = SymbolFactory.Instance.ConstructPointSymbol(CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CIMUniqueValueClass uvcD9 = <span class="keyword">new</span> CIMUniqueValueClass()</span><br><span class="line">&#123;</span><br><span class="line">  Values = <span class="keyword">new</span> CIMUniqueValue[] &#123; <span class="keyword">new</span> CIMUniqueValue() &#123; FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;DC9&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">  Visible = <span class="literal">true</span>,</span><br><span class="line">  Label = <span class="string">&quot;DC 9&quot;</span>,</span><br><span class="line">  Symbol = SymbolFactory.Instance.ConstructPointSymbol(CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Assign the classes to a group</span></span><br><span class="line">CIMUniqueValueGroup uvGrp = <span class="keyword">new</span> CIMUniqueValueGroup()</span><br><span class="line">&#123;</span><br><span class="line">  Classes = <span class="keyword">new</span> CIMUniqueValueClass[] &#123; uvcB727, uvcD9 &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//assign the group to the renderer</span></span><br><span class="line"><span class="keyword">var</span> UVrndr = <span class="keyword">new</span> CIMUniqueValueRenderer()</span><br><span class="line">&#123;</span><br><span class="line">  Fields = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;ACTYPE&quot;</span> &#125;,</span><br><span class="line">  Groups = <span class="keyword">new</span> CIMUniqueValueGroup[] &#123; uvGrp &#125;,</span><br><span class="line">  UseDefaultSymbol = <span class="literal">true</span>,</span><br><span class="line">  DefaultLabel = <span class="string">&quot;Others&quot;</span>,</span><br><span class="line">  DefaultSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    CIMColor.CreateRGBColor(<span class="number">185</span>, <span class="number">185</span>, <span class="number">185</span>), <span class="number">8</span>, SimpleMarkerStyle.Hexagon).MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//set the renderer. Depending on the current events received, the</span></span><br><span class="line"><span class="comment">//layer may or may not have events for each of the specified</span></span><br><span class="line"><span class="comment">//unique value classes</span></span><br><span class="line">streamLayer.SetRenderer(UVrndr);</span><br></pre></td></tr></table></figure>

<h3 id="为先前的观测值设置唯一值渲染器"><a href="#为先前的观测值设置唯一值渲染器" class="headerlink" title="为先前的观测值设置唯一值渲染器"></a>为先前的观测值设置唯一值渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="comment">//Define unique value classes same as we do for current observations</span></span><br><span class="line"><span class="comment">//or use &quot;CreateRenderer(...)&quot; to assign them automatically</span></span><br><span class="line">CIMUniqueValueClass uvcB727Prev = <span class="keyword">new</span> CIMUniqueValueClass()</span><br><span class="line">&#123;</span><br><span class="line">  Values = <span class="keyword">new</span> CIMUniqueValue[] &#123; <span class="keyword">new</span> CIMUniqueValue() &#123;</span><br><span class="line">    FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;B727&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">  Visible = <span class="literal">true</span>,</span><br><span class="line">  Label = <span class="string">&quot;Boeing 727&quot;</span>,</span><br><span class="line">  Symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    CIMColor.CreateRGBColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">4</span>, SimpleMarkerStyle.Hexagon)</span><br><span class="line">    .MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CIMUniqueValueClass uvcD9Prev = <span class="keyword">new</span> CIMUniqueValueClass()</span><br><span class="line">&#123;</span><br><span class="line">  Values = <span class="keyword">new</span> CIMUniqueValue[] &#123; <span class="keyword">new</span> CIMUniqueValue() &#123;</span><br><span class="line">    FieldValues = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;DC9&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">  Visible = <span class="literal">true</span>,</span><br><span class="line">  Label = <span class="string">&quot;DC 9&quot;</span>,</span><br><span class="line">  Symbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    CIMColor.CreateRGBColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">4</span>, SimpleMarkerStyle.Hexagon)</span><br><span class="line">    .MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CIMUniqueValueGroup uvGrpPrev = <span class="keyword">new</span> CIMUniqueValueGroup()</span><br><span class="line">&#123;</span><br><span class="line">  Classes = <span class="keyword">new</span> CIMUniqueValueClass[] &#123; uvcB727Prev, uvcD9Prev &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> UVrndrPrev = <span class="keyword">new</span> CIMUniqueValueRenderer()</span><br><span class="line">&#123;</span><br><span class="line">  Fields = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;ACTYPE&quot;</span> &#125;,</span><br><span class="line">  Groups = <span class="keyword">new</span> CIMUniqueValueGroup[] &#123; uvGrpPrev &#125;,</span><br><span class="line">  UseDefaultSymbol = <span class="literal">true</span>,</span><br><span class="line">  DefaultLabel = <span class="string">&quot;Others&quot;</span>,</span><br><span class="line">  DefaultSymbol = SymbolFactory.Instance.ConstructPointSymbol(</span><br><span class="line">    CIMColor.CreateRGBColor(<span class="number">185</span>, <span class="number">185</span>, <span class="number">185</span>), <span class="number">4</span>, SimpleMarkerStyle.Hexagon)</span><br><span class="line">    .MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">streamLayer.SetRenderer(UVrndr, FeatureRendererTarget.PreviousObservations);</span><br></pre></td></tr></table></figure>

<h3 id="设置简单的渲染器以绘制轨迹线"><a href="#设置简单的渲染器以绘制轨迹线" class="headerlink" title="设置简单的渲染器以绘制轨迹线"></a>设置简单的渲染器以绘制轨迹线</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="comment">//Note: only a simple renderer with solid line symbol is supported for track </span></span><br><span class="line"><span class="comment">//line renderer</span></span><br><span class="line"><span class="keyword">var</span> trackRenderer = <span class="keyword">new</span> SimpleRendererDefinition()</span><br><span class="line">&#123;</span><br><span class="line">  SymbolTemplate = SymbolFactory.Instance.ConstructLineSymbol(</span><br><span class="line">      ColorFactory.Instance.BlueRGB, <span class="number">2</span>, SimpleLineStyle.Solid)</span><br><span class="line">        .MakeSymbolReference()</span><br><span class="line">&#125;;</span><br><span class="line">streamLayer.SetRenderer(</span><br><span class="line">     streamLayer.CreateRenderer(trackRenderer), </span><br><span class="line">       FeatureRendererTarget.TrackLines);</span><br></pre></td></tr></table></figure>

<h3 id="检查先前的观测值和轨道线可见性"><a href="#检查先前的观测值和轨道线可见性" class="headerlink" title="检查先前的观测值和轨道线可见性"></a>检查先前的观测值和轨道线可见性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial for these settings</span></span><br><span class="line"><span class="comment">//to have an effect</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"><span class="keyword">if</span> (!streamLayer.AreTrackLinesVisible)</span><br><span class="line">  streamLayer.SetTrackLinesVisibility(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span> (!streamLayer.ArePreviousObservationsVisible)</span><br><span class="line">  streamLayer.SetPreviousObservationsVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使轨迹线和先前的观测点可见"><a href="#使轨迹线和先前的观测点可见" class="headerlink" title="使轨迹线和先前的观测点可见"></a>使轨迹线和先前的观测点可见</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial for these settings</span></span><br><span class="line"><span class="comment">//to have an effect</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Note: Setting PreviousObservationsCount larger than the </span></span><br><span class="line"><span class="comment">//&quot;SetExpirationMaxCount()&quot; has no effect</span></span><br><span class="line">streamLayer.SetPreviousObservationsCount(<span class="number">6</span>);</span><br><span class="line"><span class="keyword">if</span> (!streamLayer.AreTrackLinesVisible)</span><br><span class="line">  streamLayer.SetTrackLinesVisibility(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span> (!streamLayer.ArePreviousObservationsVisible)</span><br><span class="line">  streamLayer.SetPreviousObservationsVisibility(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="检索当前观测渲染器"><a href="#检索当前观测渲染器" class="headerlink" title="检索当前观测渲染器"></a>检索当前观测渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="keyword">var</span> renderer = streamLayer.GetRenderer();</span><br></pre></td></tr></table></figure>

<h3 id="检索上一个观测渲染器"><a href="#检索上一个观测渲染器" class="headerlink" title="检索上一个观测渲染器"></a>检索上一个观测渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="keyword">var</span> prev_renderer = streamLayer.GetRenderer(</span><br><span class="line">    FeatureRendererTarget.PreviousObservations);</span><br></pre></td></tr></table></figure>

<h3 id="检索轨迹线渲染器"><a href="#检索轨迹线渲染器" class="headerlink" title="检索轨迹线渲染器"></a>检索轨迹线渲染器</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The layer must be track aware and spatial</span></span><br><span class="line"><span class="keyword">if</span> (streamLayer.TrackType != TrackType.Spatial)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//Must be on QueuedTask!</span></span><br><span class="line"><span class="keyword">var</span> track_renderer = streamLayer.GetRenderer(</span><br><span class="line">    FeatureRendererTarget.TrackLines);</span><br></pre></td></tr></table></figure>

<h1 id="订阅和搜索"><a href="#订阅和搜索" class="headerlink" title="订阅和搜索"></a>订阅和搜索</h1><h3 id="搜索和订阅流数据"><a href="#搜索和订阅流数据" class="headerlink" title="搜索和订阅流数据"></a>搜索和订阅流数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//query filter can be null to search and retrieve all rows</span></span><br><span class="line">  <span class="comment">//true means recycling cursor</span></span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rc = streamLayer.SearchAndSubscribe(qfilter, <span class="literal">true</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//waiting for new features to be streamed</span></span><br><span class="line">    <span class="comment">//default is no cancellation</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//determine the origin of the row event</span></span><br><span class="line">          <span class="keyword">switch</span> (row.GetRowSource())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">case</span> RealtimeRowSource.PreExisting:</span><br><span class="line">              <span class="comment">//pre-existing row at the time of subscribe</span></span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> RealtimeRowSource.EventInsert:</span><br><span class="line">              <span class="comment">//row was inserted after subscribe</span></span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> RealtimeRowSource.EventDelete:</span><br><span class="line">              <span class="comment">//row was deleted after subscribe</span></span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="comment">//row cursor is disposed. row cursor is unsubscribed</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//....or....</span></span><br><span class="line">  <span class="comment">//Use the feature class instead of the layer</span></span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//non-recycling cursor - 2nd param &quot;false&quot;</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = rfc.SearchAndSubscribe(qfilter, <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//waiting for new features to be streamed</span></span><br><span class="line">      <span class="comment">//default is no cancellation</span></span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//etc</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="搜索和订阅取消"><a href="#搜索和订阅取消" class="headerlink" title="搜索和订阅取消"></a>搜索和订阅取消</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Recycling cursor - 2nd param &quot;true&quot;</span></span><br><span class="line">  <span class="comment">//or streamLayer.Subscribe(qfilter, true) to just subscribe</span></span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rc = streamLayer.SearchAndSubscribe(qfilter, <span class="literal">true</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//auto-cancel after 20 seconds</span></span><br><span class="line">    <span class="keyword">var</span> cancel = <span class="keyword">new</span> CancellationTokenSource(<span class="keyword">new</span> TimeSpan(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>));</span><br><span class="line">    <span class="comment">//catch TaskCanceledException</span></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync(cancel.Token))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//check for row events</span></span><br><span class="line">        <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">//etc</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (TaskCanceledException tce)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Handle cancellation as needed</span></span><br><span class="line">    &#125;</span><br><span class="line">    cancel.Dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="显式取消等待行异步"><a href="#显式取消等待行异步" class="headerlink" title="显式取消等待行异步"></a>显式取消等待行异步</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//somewhere in our code we create a CancellationTokenSource</span></span><br><span class="line"><span class="keyword">var</span> cancel = <span class="keyword">new</span> CancellationTokenSource();</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//call cancel on the CancellationTokenSource anywhere in</span></span><br><span class="line"><span class="comment">//the add-in, assuming the CancellationTokenSource is in scope</span></span><br><span class="line"><span class="keyword">if</span> (SomeConditionForCancel)</span><br><span class="line">  cancel.Cancel();<span class="comment">//&lt;-- will cancel the token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Within QueuedTask we are subscribed! streamLayer.Subscribe() or SearchAndSubscribe()</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//TaskCanceledException will be thrown when the token is cancelled</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync(cancel.Token))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//check for row events</span></span><br><span class="line">    <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//etc</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (TaskCanceledException tce)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Handle cancellation as needed</span></span><br><span class="line">&#125;</span><br><span class="line">cancel.Dispose();</span><br></pre></td></tr></table></figure>

<h1 id="实时要素类"><a href="#实时要素类" class="headerlink" title="实时要素类"></a>实时要素类</h1><h3 id="从实时数据存储连接到实时要素类"><a href="#从实时数据存储连接到实时要素类" class="headerlink" title="从实时数据存储连接到实时要素类"></a>从实时数据存储连接到实时要素类</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;https://geoeventsample1.esri.com:6443/arcgis/rest/services/AirportTraffics/StreamServer&quot;</span>;</span><br><span class="line">     </span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> realtimeServiceConProp = <span class="keyword">new</span> RealtimeServiceConnectionProperties(</span><br><span class="line">                                   <span class="keyword">new</span> Uri(url),</span><br><span class="line">                                   RealtimeDatastoreType.StreamService</span><br><span class="line">                                );</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> realtimeDatastore = <span class="keyword">new</span> RealtimeDatastore(realtimeServiceConProp))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//A Realtime data store only contains **one** Realtime feature class (or table)</span></span><br><span class="line">    <span class="keyword">var</span> name = realtimeDatastore.GetTableNames().First();</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> realtimeFeatureClass = realtimeDatastore.OpenTable(name) <span class="keyword">as</span> RealtimeFeatureClass)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//feature class, by default, is not streaming (opposite of the stream layer)</span></span><br><span class="line">      realtimeFeatureClass.StartStreaming();</span><br><span class="line">      <span class="comment">//TODO use the feature class</span></span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="检查实时要素类是否可识别轨迹"><a href="#检查实时要素类是否可识别轨迹" class="headerlink" title="检查实时要素类是否可识别轨迹"></a>检查实时要素类是否可识别轨迹</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rfc_def = rfc.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (rfc_def.HasTrackIDField())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Track aware</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从实时要素类获取追踪-ID-字段"><a href="#从实时要素类获取追踪-ID-字段" class="headerlink" title="从实时要素类获取追踪 ID 字段"></a>从实时要素类获取追踪 ID 字段</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Must be on QueuedTask</span></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> rfc_def = rfc.GetDefinition())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (rfc_def.HasTrackIDField())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> fld_name = rfc_def.GetTrackIDField();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="订阅流数据"><a href="#订阅流数据" class="headerlink" title="订阅流数据"></a>订阅流数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: with feature class we can also use a System Task to subscribe and</span></span><br><span class="line"><span class="comment">//process rows</span></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// or var rfc = realtimeDatastore.OpenTable(name) as RealtimeFeatureClass</span></span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//non-recycling cursor - 2nd param &quot;false&quot;</span></span><br><span class="line">    <span class="comment">//subscribe, pre-existing rows are not searched</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = rfc.Subscribe(qfilter, <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      SpatialQueryFilter spatialFilter = <span class="keyword">new</span> SpatialQueryFilter();</span><br><span class="line">      <span class="comment">//waiting for new features to be streamed</span></span><br><span class="line">      <span class="comment">//default is no cancellation</span></span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">switch</span> (row.GetRowSource())</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> RealtimeRowSource.EventInsert:</span><br><span class="line">                <span class="comment">//getting geometry from new events as they arrive</span></span><br><span class="line">                Polygon poly = ((RealtimeFeature)row).GetShape() <span class="keyword">as</span> Polygon;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//using the geometry to select features from another feature layer</span></span><br><span class="line">                spatialFilter.FilterGeometry = poly;<span class="comment">//project poly if needed...</span></span><br><span class="line">                countyFeatureLayer.Select(spatialFilter);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;                  </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="comment">//row cursor is disposed. row cursor is unsubscribed</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="搜索现有数据并订阅流数据"><a href="#搜索现有数据并订阅流数据" class="headerlink" title="搜索现有数据并订阅流数据"></a>搜索现有数据并订阅流数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note we can use System Task with the Realtime feature class</span></span><br><span class="line"><span class="comment">//for subscribe</span></span><br><span class="line"><span class="keyword">await</span> System.Threading.Tasks.Task.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line"><span class="comment">// or use ... QueuedTask.Run()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//non-recycling cursor - 2nd param &quot;false&quot;</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = rfc.SearchAndSubscribe(qfilter, <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//waiting for new features to be streamed</span></span><br><span class="line">      <span class="comment">//default is no cancellation</span></span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//pre-existing rows will be retrieved that were searched</span></span><br><span class="line">        <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">using</span> (<span class="keyword">var</span> row = rc.Current)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">var</span> row_source = row.GetRowSource();</span><br><span class="line">            <span class="keyword">switch</span> (row_source)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> RealtimeRowSource.EventDelete:</span><br><span class="line">                <span class="comment">//TODO - handle deletes</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> RealtimeRowSource.EventInsert:</span><br><span class="line">                <span class="comment">//TODO handle inserts</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> RealtimeRowSource.PreExisting:</span><br><span class="line">                <span class="comment">//TODO handle pre-existing rows</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="comment">//row cursor is disposed. row cursor is unsubscribed</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="搜索和订阅取消-1"><a href="#搜索和订阅取消-1" class="headerlink" title="搜索和订阅取消"></a>搜索和订阅取消</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> System.Threading.Tasks.Task.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line"><span class="comment">// or use ... QueuedTask.Run()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> (<span class="keyword">var</span> rfc = streamLayer.GetFeatureClass())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Recycling cursor - 2nd param &quot;true&quot;</span></span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> rc = rfc.SearchAndSubscribe(qfilter, <span class="literal">true</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//auto-cancel after 20 seconds</span></span><br><span class="line">      <span class="keyword">var</span> cancel = <span class="keyword">new</span> CancellationTokenSource(<span class="keyword">new</span> TimeSpan(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>));</span><br><span class="line">      <span class="comment">//catch TaskCanceledException</span></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">await</span> rc.WaitForRowsAsync(cancel.Token))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//check for row events</span></span><br><span class="line">          <span class="keyword">while</span> (rc.MoveNext())</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> <span class="keyword">record</span> = rc.Current)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">//etc</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span>(TaskCanceledException tce)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Handle cancellation as needed</span></span><br><span class="line">      &#125;</span><br><span class="line">      cancel.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h1><h3 id="检索项目中的所有任务项"><a href="#检索项目中的所有任务项" class="headerlink" title="检索项目中的所有任务项"></a>检索项目中的所有任务项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;TaskProjectItem&gt; taskItems = Project.Current.GetItems&lt;TaskProjectItem&gt;();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> taskItems)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开任务文件-esriTasks-文件"><a href="#打开任务文件-esriTasks-文件" class="headerlink" title="打开任务文件 - .esriTasks 文件"></a>打开任务文件 - .esriTasks 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Open a task file</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// TODO - substitute your own .esriTasks file to be opened</span></span><br><span class="line">  <span class="built_in">string</span> taskFile = <span class="string">@&quot;c:\Tasks\Get Started.esriTasks&quot;</span>;</span><br><span class="line">  <span class="comment">//At 2.x -</span></span><br><span class="line">  <span class="comment">//System.Guid guid = await TaskAssistantModule.OpenTaskAsync(taskFile);</span></span><br><span class="line">  <span class="keyword">var</span> guid = <span class="keyword">await</span> TaskAssistantFactory.Instance.OpenTaskFileAsync(taskFile);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO - retain the guid returned for use with CloseTaskItemAsync</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (OpenTaskException e)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// exception thrown if task file doesn&#x27;t exist or has incorrect format</span></span><br><span class="line">  ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(e.Message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开项目任务项"><a href="#打开项目任务项" class="headerlink" title="打开项目任务项"></a>打开项目任务项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the first project task item</span></span><br><span class="line"><span class="keyword">var</span> taskItem = Project.Current.GetItems&lt;TaskProjectItem&gt;().FirstOrDefault();</span><br><span class="line"><span class="comment">// if there isn&#x27;t a project task item, return</span></span><br><span class="line"><span class="keyword">if</span> (taskItem == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Open it</span></span><br><span class="line">  <span class="comment">//At 2.x -</span></span><br><span class="line">  <span class="comment">//System.Guid guid = await TaskAssistantModule.OpenTaskItemAsync(taskItem.TaskItemGuid);</span></span><br><span class="line">  <span class="keyword">var</span> guid = <span class="keyword">await</span> TaskAssistantFactory.Instance.OpenTaskItemAsync(taskItem.TaskItemGuid);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO - retain the guid returned for use with CloseTaskItemAsync</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (OpenTaskException e)</span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(e.Message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭任务项"><a href="#关闭任务项" class="headerlink" title="关闭任务项"></a>关闭任务项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find the first project task item which is open</span></span><br><span class="line"><span class="keyword">var</span> taskItem = Project.Current.GetItems&lt;TaskProjectItem&gt;().FirstOrDefault(t =&gt; t.IsOpen == <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// if there isn&#x27;t a project task item, return</span></span><br><span class="line"><span class="keyword">if</span> (taskItem == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (taskItem.IsOpen)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// close it</span></span><br><span class="line">  <span class="comment">// NOTE : The task item will also be removed from the project</span></span><br><span class="line">  <span class="comment">//At 2.x -</span></span><br><span class="line">  <span class="comment">//TaskAssistantModule.CloseTaskAsync(taskItem.TaskItemGuid);</span></span><br><span class="line">  TaskAssistantFactory.Instance.CloseTaskItemAsync(taskItem.TaskItemGuid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导出任务项"><a href="#导出任务项" class="headerlink" title="导出任务项"></a>导出任务项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the first project task item</span></span><br><span class="line"><span class="keyword">var</span> taskItem = Project.Current.GetItems&lt;TaskProjectItem&gt;().FirstOrDefault();</span><br><span class="line"><span class="comment">// if there isn&#x27;t a project task item, return</span></span><br><span class="line"><span class="keyword">if</span> (taskItem == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// export the task item to the c:\Temp folder</span></span><br><span class="line">  <span class="built_in">string</span> exportFolder = <span class="string">@&quot;c:\temp&quot;</span>;</span><br><span class="line">  <span class="comment">//At 2.x -</span></span><br><span class="line">  <span class="comment">//string fileName = await TaskAssistantModule.ExportTaskAsync(taskItem.TaskItemGuid, exportFolder);</span></span><br><span class="line">  <span class="built_in">string</span> fileName = <span class="keyword">await</span> TaskAssistantFactory.Instance.ExportTaskItemAsync(taskItem.TaskItemGuid, exportFolder);</span><br><span class="line">  ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="string">&quot;Task saved to &quot;</span> + fileName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ExportTaskException e)</span><br><span class="line">&#123;</span><br><span class="line">  ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(<span class="string">&quot;Error saving task &quot;</span> + e.Message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取任务信息-从任务项目项"><a href="#获取任务信息-从任务项目项" class="headerlink" title="获取任务信息 - 从任务项目项"></a>获取任务信息 - 从任务项目项</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> taskItem = Project.Current.GetItems&lt;TaskProjectItem&gt;().FirstOrDefault();</span><br><span class="line"><span class="comment">// if there isn&#x27;t a project task item, return</span></span><br><span class="line"><span class="keyword">if</span> (taskItem == <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> message = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> isOpen = taskItem.IsOpen;</span><br><span class="line">  Guid taskGuid = taskItem.TaskItemGuid;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> msg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    TaskItemInfo taskItemInfo = <span class="keyword">await</span> taskItem.GetTaskItemInfoAsync();</span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&quot;Name : &quot;</span> + taskItemInfo.Name;</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Description : &quot;</span> + taskItemInfo.Description;</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Guid : &quot;</span> + taskItemInfo.Guid.ToString(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Task Count : &quot;</span> + taskItemInfo.GetTasks().Count();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// iterate the tasks in the task item</span></span><br><span class="line">    IEnumerable&lt;TaskInfo&gt; taskInfos = taskItemInfo.GetTasks();</span><br><span class="line">    <span class="keyword">foreach</span> (TaskInfo taskInfo <span class="keyword">in</span> taskInfos)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">string</span> name = taskInfo.Name;</span><br><span class="line">      Guid guid = taskInfo.Guid;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// do something </span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (OpenTaskException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file doesn&#x27;t exist or has incorrect format</span></span><br><span class="line">    msg = e.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (TaskFileVersionException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file does not support returning task information</span></span><br><span class="line">    msg = e.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> msg;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(message, <span class="string">&quot;Task Information&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取任务信息-从-esriTasks-文件"><a href="#获取任务信息-从-esriTasks-文件" class="headerlink" title="获取任务信息 - 从 .esriTasks 文件"></a>获取任务信息 - 从 .esriTasks 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO - substitute your own .esriTasks file</span></span><br><span class="line"><span class="built_in">string</span> taskFile = <span class="string">@&quot;c:\Tasks\Get Started.esriTasks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> message = <span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> msg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// retrieve the task item information</span></span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//TaskItemInfo taskItemInfo = await TaskAssistantModule.GetTaskItemInfoAsync(taskFile);</span></span><br><span class="line">    TaskItemInfo taskItemInfo = <span class="keyword">await</span> TaskAssistantFactory.Instance.GetTaskItemInfoAsync(taskFile);</span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&quot;Name : &quot;</span> + taskItemInfo.Name;</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Description : &quot;</span> + taskItemInfo.Description;</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Guid : &quot;</span> + taskItemInfo.Guid.ToString(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    msg += <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;Task Count : &quot;</span> + taskItemInfo.GetTasks().Count();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (OpenTaskException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file doesn&#x27;t exist or has incorrect format</span></span><br><span class="line">    msg = e.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (TaskFileVersionException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file does not support returning task information</span></span><br><span class="line">    msg = e.Message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> msg;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(message, <span class="string">&quot;Task Information&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="在任务文件中打开特定任务-esriTasks-文件"><a href="#在任务文件中打开特定任务-esriTasks-文件" class="headerlink" title="在任务文件中打开特定任务 - .esriTasks 文件"></a>在任务文件中打开特定任务 - .esriTasks 文件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO - substitute your own .esriTasks file to be opened</span></span><br><span class="line"><span class="built_in">string</span> taskFile = <span class="string">@&quot;c:\Tasks\Get Started.esriTasks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> QueuedTask.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// retrieve the task item information</span></span><br><span class="line">    <span class="comment">//At 2.x -</span></span><br><span class="line">    <span class="comment">//TaskItemInfo taskItemInfo = await TaskAssistantModule.GetTaskItemInfoAsync(taskFile);</span></span><br><span class="line">    <span class="keyword">var</span> taskItemInfo = <span class="keyword">await</span> TaskAssistantFactory.Instance.GetTaskItemInfoAsync(taskFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find the first task</span></span><br><span class="line">    TaskInfo taskInfo = taskItemInfo.GetTasks().FirstOrDefault();</span><br><span class="line"></span><br><span class="line">    Guid guid = Guid.Empty;</span><br><span class="line">    <span class="keyword">if</span> (taskInfo != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// if a task exists, open it</span></span><br><span class="line">      <span class="comment">//At 2.x -</span></span><br><span class="line">      <span class="comment">//guid = await TaskAssistantModule.OpenTaskAsync(taskFile, taskInfo.Guid);</span></span><br><span class="line">      guid = <span class="keyword">await</span> TaskAssistantFactory.Instance.OpenTaskFileAsync(taskFile, taskInfo.Guid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// else just open the task item</span></span><br><span class="line">      <span class="comment">//At 2.x -</span></span><br><span class="line">      <span class="comment">//guid = await TaskAssistantModule.OpenTaskAsync(taskFile);</span></span><br><span class="line">      guid = <span class="keyword">await</span> TaskAssistantFactory.Instance.OpenTaskFileAsync(taskFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO - retain the guid returned for use with CloseTaskItemAsync </span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (OpenTaskException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file doesn&#x27;t exist or has incorrect format</span></span><br><span class="line">    ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(e.Message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (TaskFileVersionException e)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// exception thrown if task file does not support returning task information</span></span><br><span class="line">    ArcGIS.Desktop.Framework.Dialogs.MessageBox.Show(e.Message);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="订阅任务事件"><a href="#订阅任务事件" class="headerlink" title="订阅任务事件"></a>订阅任务事件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TaskEvents</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  TaskStartedEvent.Subscribe(OnTaskStarted);</span><br><span class="line">  TaskEndedEvent.Subscribe(OnTaskCompletedOrCancelled);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTaskStarted</span>(<span class="params">TaskStartedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> userName = args.UserID;    <span class="comment">// ArcGIS Online signed in userName.  If not signed in to ArcGIS Online then returns the name of the user logged in to the Windows OS.</span></span><br><span class="line">  <span class="built_in">string</span> projectName = args.ProjectName;</span><br><span class="line"></span><br><span class="line">  Guid taskItemGuid = args.TaskItemGuid;</span><br><span class="line">  <span class="built_in">string</span> taskItemName = args.TaskItemName;</span><br><span class="line">  <span class="built_in">string</span> taskItemVersion = args.TaskItemVersion;</span><br><span class="line"></span><br><span class="line">  Guid taskGuid = args.TaskGuid;</span><br><span class="line">  <span class="built_in">string</span> taskName = args.TaskName;</span><br><span class="line"></span><br><span class="line">  DateTime startTime = args.StartTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTaskCompletedOrCancelled</span>(<span class="params">TaskEndedEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> userName = args.UserID;    <span class="comment">// ArcGIS Online signed in userName.  If not signed in to ArcGIS Online then returns the name of the user logged in to the Windows OS.</span></span><br><span class="line">  <span class="built_in">string</span> projectName = args.ProjectName;</span><br><span class="line"></span><br><span class="line">  Guid taskItemGuid = args.TaskItemGuid;</span><br><span class="line">  <span class="built_in">string</span> taskItemName = args.TaskItemName;</span><br><span class="line">  <span class="built_in">string</span> taskItemVersion = args.TaskItemVersion;</span><br><span class="line"></span><br><span class="line">  Guid taskGuid = args.TaskGuid;</span><br><span class="line">  <span class="built_in">string</span> taskName = args.TaskName;</span><br><span class="line"></span><br><span class="line">  DateTime startTime = args.StartTime;</span><br><span class="line">  DateTime endTime = args.EndTime;</span><br><span class="line">  <span class="built_in">double</span> duration = args.Duration;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> completed = args.Completed;    <span class="comment">// completed or cancelled</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="工作流管理器"><a href="#工作流管理器" class="headerlink" title="工作流管理器"></a>工作流管理器</h1><h3 id="如何获取管理器对象"><a href="#如何获取管理器对象" class="headerlink" title="如何获取管理器对象"></a>如何获取管理器对象</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WorkflowModule.GetManager returns a manager of the type specified</span></span><br><span class="line"><span class="comment">// keyword is currently just an empty string</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> configManager = wfCon.GetManager&lt;ConfigurationManager&gt;();</span><br></pre></td></tr></table></figure>

<h3 id="如何获取群组"><a href="#如何获取群组" class="headerlink" title="如何获取群组"></a>如何获取群组</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetAllGroups returns a list of Workflow Manager groups</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> configManager = wfCon.GetManager&lt;ConfigurationManager&gt;();</span><br><span class="line"><span class="keyword">var</span> allGroups = configManager.GetAllGroups();</span><br></pre></td></tr></table></figure>

<h3 id="如何获取用户"><a href="#如何获取用户" class="headerlink" title="如何获取用户"></a>如何获取用户</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetAllUsers returns a list of Workflow Manager users</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> configManager = wfCon.GetManager&lt;ConfigurationManager&gt;();</span><br><span class="line"><span class="keyword">var</span> allUsers = configManager.GetAllUsers();</span><br></pre></td></tr></table></figure>

<h3 id="如何获取作业类型"><a href="#如何获取作业类型" class="headerlink" title="如何获取作业类型"></a>如何获取作业类型</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetVisibleJobTypes returns a list of job types</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> configManager = wfCon.GetManager&lt;ConfigurationManager&gt;();</span><br><span class="line"><span class="keyword">var</span> jobTypes = configManager.GetVisibleJobTypes();</span><br></pre></td></tr></table></figure>

<h3 id="如何创建作业"><a href="#如何创建作业" class="headerlink" title="如何创建作业"></a>如何创建作业</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CreateJob returns an ID of a new job</span></span><br><span class="line"><span class="comment">// it is a passed a valid job type ID as an integer</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> jobID = jobManager.CreateNewJob(jobTypeID);</span><br></pre></td></tr></table></figure>

<h3 id="如何找到工作"><a href="#如何找到工作" class="headerlink" title="如何找到工作"></a>如何找到工作</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetJob returns an existing job</span></span><br><span class="line"><span class="comment">// it is passed a valid job ID as an integer</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> job = jobManager.GetJob(jobID);</span><br></pre></td></tr></table></figure>

<h3 id="如何获取与地图关联的作业"><a href="#如何获取与地图关联的作业" class="headerlink" title="如何获取与地图关联的作业"></a>如何获取与地图关联的作业</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a job associated with the map</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> job = jobManager.GetJob(map);</span><br><span class="line"><span class="keyword">if</span> (job != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Job found, do something with the job</span></span><br><span class="line">  <span class="keyword">var</span> jobId = job.ID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何关闭作业"><a href="#如何关闭作业" class="headerlink" title="如何关闭作业"></a>如何关闭作业</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CloseJobs returns a list of closed job IDs</span></span><br><span class="line"><span class="comment">// it is passed a list of job IDs to close</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> jobIDs = jobManager.CloseJobs(jobIdsToClose);</span><br></pre></td></tr></table></figure>

<h3 id="如何访问和更改工作信息"><a href="#如何访问和更改工作信息" class="headerlink" title="如何访问和更改工作信息"></a>如何访问和更改工作信息</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// You can change many of the exposed properties of a job and then save them</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> job = jobManager.GetJob(jobID);</span><br><span class="line">job.Description = <span class="string">&quot;This is a test&quot;</span>;</span><br><span class="line">job.Save();</span><br></pre></td></tr></table></figure>

<h3 id="如何在作业上执行步骤"><a href="#如何在作业上执行步骤" class="headerlink" title="如何在作业上执行步骤"></a>如何在作业上执行步骤</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gets the current step</span></span><br><span class="line"><span class="comment">// checks to see if it can execute it</span></span><br><span class="line"><span class="comment">// proceeds to do so if it can</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> job = jobManager.GetJob(jobID);</span><br><span class="line"><span class="built_in">string</span> stepID = job.GetCurrentSteps().First();</span><br><span class="line"><span class="keyword">if</span> (job.CanExecuteStep(stepID).Item1)</span><br><span class="line">  job.ExecuteStep(stepID);</span><br></pre></td></tr></table></figure>

<h3 id="如何执行查询"><a href="#如何执行查询" class="headerlink" title="如何执行查询"></a>如何执行查询</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ExecuteQuery returns a query result</span></span><br><span class="line"><span class="comment">// Its passed either an ID or a name</span></span><br><span class="line"><span class="keyword">var</span> wfCon = <span class="keyword">await</span> WorkflowModule.ConnectAsync();</span><br><span class="line"><span class="keyword">var</span> jobManager = wfCon.GetManager&lt;JobsManager&gt;();</span><br><span class="line"><span class="keyword">var</span> queryResultReturn = jobManager.ExecuteQuery(<span class="string">&quot;All Jobs&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>);</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1361151272@qq.com">shaozhy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://shaoshao.net.cn/2022/12/31/20221231171113000/">https://shaoshao.net.cn/2022/12/31/20221231171113000/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shaoshao.net.cn" target="_blank">WineMonk</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/discover/tags/CSharp/">CSharp</a><a class="post-meta__tags" href="/discover/tags/ArcGIS-Pro-SDK/">ArcGIS Pro SDK</a></div><div class="post_share"><div class="social-share" data-image="https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://shaoshao.net.cn/images/blog/cover/payqr/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/31/20221231205615000/"><img class="prev-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_09.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">C#中Brush、Color、String相互转换</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/28/20221228143257000/"><img class="next-cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_07.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ArcGIS Pro SDK 工作流管理器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/28/20221228133712000/" title="ArcGIS Pro SDK 框架"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_04.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 框架</div></div></a></div><div><a href="/2022/12/28/20221228134536000/" title="ArcGIS Pro SDK 核心主机"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_06.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 核心主机</div></div></a></div><div><a href="/2022/12/28/20221228134215000/" title="ArcGIS Pro SDK 内容"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 内容</div></div></a></div><div><a href="/2022/12/28/20221228134946000/" title="ArcGIS Pro SDK 编辑"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_07.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 编辑</div></div></a></div><div><a href="/2022/12/28/20221228135824000/" title="ArcGIS Pro SDK 图形图层"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 图形图层</div></div></a></div><div><a href="/2022/12/28/20221228135620000/" title="ArcGIS Pro SDK 地理处理"><img class="cover" src="https://shaoshao.net.cn/images/blog/cover/current/post_10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">ArcGIS Pro SDK 地理处理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E5%81%9C%E9%9D%A0%E7%AA%97%E6%A0%BC%E5%8F%AF%E8%A7%81%E6%88%96%E9%9A%90%E8%97%8F%E6%97%B6%E8%AE%A2%E9%98%85%E5%92%8C%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.0.1.</span> <span class="toc-text">如何在停靠窗格可见或隐藏时订阅和取消订阅事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.0.2.</span> <span class="toc-text">执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%B7%A5%E5%85%B7"><span class="toc-number">1.0.3.</span> <span class="toc-text">设置当前工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E9%80%89%E9%A1%B9%E5%8D%A1"><span class="toc-number">1.0.4.</span> <span class="toc-text">激活选项卡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB-x2F-%E5%81%9C%E7%94%A8%E7%8A%B6%E6%80%81-%E4%BF%AE%E6%94%B9%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.0.5.</span> <span class="toc-text">激活&#x2F;停用状态 - 修改条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%90%A6%E7%B9%81%E5%BF%99"><span class="toc-number">1.0.6.</span> <span class="toc-text">确定应用程序是否繁忙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%BB%E7%AA%97%E5%8F%A3"><span class="toc-number">1.0.7.</span> <span class="toc-text">获取应用程序主窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD-ArcGIS-Pro"><span class="toc-number">1.0.8.</span> <span class="toc-text">关闭 ArcGIS Pro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-ArcGIS-%E4%B8%93%E4%B8%9A%E7%89%88"><span class="toc-number">1.0.9.</span> <span class="toc-text">获取 ArcGIS 专业版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%89%B9%E5%AE%9A%E7%AA%97%E6%A0%BC"><span class="toc-number">1.0.10.</span> <span class="toc-text">关闭特定窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E7%AA%97%E6%A0%BC"><span class="toc-number">1.0.11.</span> <span class="toc-text">激活窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%89%E5%85%B3%E5%BD%93%E5%89%8D%E5%AE%89%E8%A3%85%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">1.0.12.</span> <span class="toc-text">获取有关当前安装的加载项的信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%A0%81%E5%A4%B4%E7%AA%97%E6%A0%BC"><span class="toc-number">1.0.13.</span> <span class="toc-text">查找码头窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%81%E5%A4%B4%E7%AA%97%E6%A0%BC%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.0.14.</span> <span class="toc-text">码头窗格属性和方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%81%E5%A4%B4%E7%AA%97%E6%A0%BC%E6%92%A4%E6%B6%88-x2F-%E9%87%8D%E5%81%9A"><span class="toc-number">1.0.15.</span> <span class="toc-text">码头窗格撤消&#x2F;重做</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%81%9C%E9%9D%A0%E7%AA%97%E6%A0%BC%E5%B9%B6%E8%8E%B7%E5%8F%96%E5%85%B6%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.0.16.</span> <span class="toc-text">查找停靠窗格并获取其视图模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E2%80%9C%E5%90%8E%E5%8F%B0%E2%80%9D%E9%80%89%E9%A1%B9%E5%8D%A1"><span class="toc-number">1.0.17.</span> <span class="toc-text">打开“后台”选项卡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%BD%93%E5%89%8D%E4%B8%BB%E9%A2%98"><span class="toc-number">1.0.18.</span> <span class="toc-text">访问当前主题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E4%B8%93%E4%B8%9A%E6%B6%88%E6%81%AF%E6%A1%86"><span class="toc-number">1.0.19.</span> <span class="toc-text">显示专业消息框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%90%90%E5%8F%B8%E9%80%9A%E7%9F%A5"><span class="toc-number">1.0.20.</span> <span class="toc-text">添加吐司通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%8C%89%E9%92%AE%E6%A0%87%E9%A2%98%E6%88%96%E5%9B%BE%E5%83%8F"><span class="toc-number">1.0.21.</span> <span class="toc-text">更改按钮标题或图像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%89%E9%92%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E6%8F%90%E7%A4%BA%E6%A0%87%E9%A2%98"><span class="toc-number">1.0.22.</span> <span class="toc-text">获取按钮的工具提示标题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E6%B4%BB%E5%8A%A8%E5%B7%A5%E5%85%B7%E6%9B%B4%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.0.23.</span> <span class="toc-text">订阅活动工具更改事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6%E5%99%A8-%E7%AE%80%E5%8D%95%E4%B8%94%E4%B8%8D%E5%8F%AF%E5%8F%96%E6%B6%88"><span class="toc-number">1.0.24.</span> <span class="toc-text">进度器 - 简单且不可取消</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6%E5%99%A8-%E5%8F%AF%E5%8F%96%E6%B6%88"><span class="toc-number">1.0.25.</span> <span class="toc-text">进度器 - 可取消</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE%E6%88%96%E5%B7%A5%E5%85%B7%E7%9A%84-disabedText-%E5%B1%9E%E6%80%A7"><span class="toc-number">1.0.26.</span> <span class="toc-text">自定义按钮或工具的 disabedText 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%BD%93%E5%89%8D%E7%A8%8B%E5%BA%8F%E9%9B%86%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%83%8F%E8%B5%84%E6%BA%90"><span class="toc-number">1.0.27.</span> <span class="toc-text">从当前程序集获取图像资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E6%AD%A2-ArcGIS-Pro-%E5%85%B3%E9%97%AD"><span class="toc-number">1.0.28.</span> <span class="toc-text">阻止 ArcGIS Pro 关闭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8-MapView-%E4%B8%AD%E5%AE%9A%E4%BD%8D%E5%8F%AF%E5%B5%8C%E5%85%A5%E6%8E%A7%E4%BB%B6"><span class="toc-number">1.0.29.</span> <span class="toc-text">如何在 MapView 中定位可嵌入控件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E9%80%89%E9%A1%B9%E5%8D%A1%E6%97%B6%E5%91%BD%E4%BB%A4%E6%90%9C%E7%B4%A2%E4%B8%AD%E5%BB%BA%E8%AE%AE%E7%9A%84%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9%E3%80%82"><span class="toc-number">1.0.30.</span> <span class="toc-text">激活选项卡时命令搜索中建议的命令选项。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%90%AF%E5%8A%A8-ArcGIS-Pro"><span class="toc-number">1.0.31.</span> <span class="toc-text">从命令行启动 ArcGIS Pro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="toc-number">1.0.32.</span> <span class="toc-text">获取命令行参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E9%80%9F%E5%99%A8%EF%BC%88%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%89"><span class="toc-number">1.0.33.</span> <span class="toc-text">应用程序加速器（快捷键）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%93%E4%B8%9A%E6%A0%B7%E5%BC%8F%E5%9C%A8-DAML-%E4%B8%AD%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6"><span class="toc-number">1.0.34.</span> <span class="toc-text">使用专业样式在 DAML 中定义控件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AE%B9"><span class="toc-number">2.</span> <span class="toc-text">内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text">项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A9%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text">创建一个空项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E5%90%8D%E7%A7%B0%E7%9A%84%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.2.</span> <span class="toc-text">创建具有指定名称的新项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Pro-%E7%9A%84%E9%BB%98%E8%AE%A4%E8%AE%BE%E7%BD%AE%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.3.</span> <span class="toc-text">使用 Pro 的默认设置创建新项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.4.</span> <span class="toc-text">使用自定义模板文件新建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ArcGIS-Pro-%E6%8F%90%E4%BE%9B%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.1.5.</span> <span class="toc-text">使用 ArcGIS Pro 提供的模板创建工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.6.</span> <span class="toc-text">打开现有项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.7.</span> <span class="toc-text">获取当前项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.8.</span> <span class="toc-text">获取当前项目的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%BB%98%E8%AE%A4-gdb-%E8%B7%AF%E5%BE%84"><span class="toc-number">2.1.9.</span> <span class="toc-text">获取项目的默认 gdb 路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.10.</span> <span class="toc-text">保存项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E4%BF%9D%E5%AD%98%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.11.</span> <span class="toc-text">检查是否需要保存项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A6%E5%AD%98%E4%B8%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.12.</span> <span class="toc-text">另存为项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.13.</span> <span class="toc-text">关闭项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%90%91%E5%B7%A5%E7%A8%8B%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.1.14.</span> <span class="toc-text">如何向工程添加新地图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">2.2.</span> <span class="toc-text">项目项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E5%A4%B9%E8%BF%9E%E6%8E%A5%E9%A1%B9%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">将文件夹连接项添加到当前项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">2.2.2.</span> <span class="toc-text">获取所有项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%89%80%E6%9C%89%E2%80%9CMapProjectItems%E2%80%9D"><span class="toc-number">2.2.3.</span> <span class="toc-text">获取项目的所有“MapProjectItems”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9CMapProjectItem%E2%80%9D"><span class="toc-number">2.2.4.</span> <span class="toc-text">获取特定的“MapProjectItem”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E2%80%9C%E6%A0%B7%E5%BC%8F%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.5.</span> <span class="toc-text">获取所有“样式项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9C%E6%A0%B7%E5%BC%8F%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.6.</span> <span class="toc-text">获取特定的“样式项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E2%80%9C%E6%94%B6%E8%97%8F%E5%A4%B9%E2%80%9D%E6%A0%B7%E5%BC%8F%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">2.2.7.</span> <span class="toc-text">获取“收藏夹”样式项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E2%80%9CGDBProjectItems%E2%80%9D"><span class="toc-number">2.2.8.</span> <span class="toc-text">获取所有“GDBProjectItems”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9CGDBProjectItem%E2%80%9D"><span class="toc-number">2.2.9.</span> <span class="toc-text">获取特定的“GDBProjectItem”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E2%80%9C%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9E%E6%8E%A5%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.10.</span> <span class="toc-text">获取所有“服务器连接项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9C%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9E%E6%8E%A5%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.11.</span> <span class="toc-text">获取特定的“服务器连接项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%A4%B9%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.2.12.</span> <span class="toc-text">获取项目中的所有文件夹连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E6%96%87%E4%BB%B6%E5%A4%B9%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.2.13.</span> <span class="toc-text">获取特定文件夹连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%89%B9%E5%AE%9A%E6%96%87%E4%BB%B6%E5%A4%B9%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.2.14.</span> <span class="toc-text">删除特定文件夹连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9C%E5%B8%83%E5%B1%80%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.15.</span> <span class="toc-text">获取特定的“布局项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E5%B8%83%E5%B1%80"><span class="toc-number">2.2.16.</span> <span class="toc-text">获取项目中的所有布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E2%80%9C%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E2%80%9D"><span class="toc-number">2.2.17.</span> <span class="toc-text">获取特定的“地理处理项目项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B7%A5%E7%A8%8B%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E5%B7%A5%E7%A8%8B%E9%A1%B9"><span class="toc-number">2.2.18.</span> <span class="toc-text">获取工程中的所有地理处理工程项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%89%B9%E5%AE%9A%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.19.</span> <span class="toc-text">在项目中搜索特定项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%BB%98%E8%AE%A4%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">2.2.20.</span> <span class="toc-text">获取默认项目文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E6%96%87%E4%BB%B6%E5%A4%B9%E8%BF%9E%E6%8E%A5%E9%A1%B9%E7%9A%84%E5%AD%90%E9%A1%B9"><span class="toc-number">2.2.21.</span> <span class="toc-text">刷新文件夹连接项的子项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E7%B1%BB%E5%88%AB"><span class="toc-number">2.2.22.</span> <span class="toc-text">获取项目类别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%A1%B9%E7%9B%AE%E7%B1%BB%E5%88%AB"><span class="toc-number">2.2.23.</span> <span class="toc-text">使用项目类别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.24.</span> <span class="toc-text">使用模板创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E9%A1%B9%E7%9B%AE%E5%AE%B9%E5%99%A8-%E7%94%A8%E4%BA%8E-SelectItemAsync"><span class="toc-number">2.2.25.</span> <span class="toc-text">选择项目容器 - 用于 SelectItemAsync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%A1%B9%EF%BC%9A%E8%8E%B7%E5%8F%96%E9%A1%B9%E6%88%96%E6%9F%A5%E6%89%BE%E9%A1%B9"><span class="toc-number">2.2.26.</span> <span class="toc-text">项目项：获取项或查找项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%9B%AE%E5%BD%95%E7%AA%97%E6%A0%BC%E4%B8%AD%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.27.</span> <span class="toc-text">在目录窗格中选择一个项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.</span> <span class="toc-text">地理数据库内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%B8%AD%E7%9A%84%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.1.</span> <span class="toc-text">浏览对话框中的地理数据库内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E4%B8%AD%E7%9A%84%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.2.</span> <span class="toc-text">目录中的地理数据库内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E8%97%8F-%E5%A4%B9"><span class="toc-number">2.4.</span> <span class="toc-text">收藏 夹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%94%B6%E8%97%8F%E5%A4%B9-%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">2.4.1.</span> <span class="toc-text">添加收藏夹 - 文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%94%B6%E8%97%8F%E5%A4%B9-%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B7%AF%E5%BE%84"><span class="toc-number">2.4.2.</span> <span class="toc-text">插入收藏夹 - 地理数据库路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%94%B6%E8%97%8F%E5%A4%B9-%E8%AE%BE%E7%BD%AE%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.4.3.</span> <span class="toc-text">添加收藏夹 - 设置项目项的样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E6%A0%87%E5%BF%97%E6%98%AF%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%89%80%E6%9C%89%E6%96%B0%E9%A1%B9%E7%9B%AE%E4%B8%BA%E6%94%B6%E8%97%8F%E5%A4%B9"><span class="toc-number">2.4.4.</span> <span class="toc-text">切换标志是添加到所有新项目为收藏夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%94%B6%E8%97%8F%E5%A4%B9%E9%9B%86%E5%B9%B6%E8%BF%AD%E4%BB%A3"><span class="toc-number">2.4.5.</span> <span class="toc-text">获取收藏夹集并迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%94%B6%E8%97%8F%E5%A4%B9"><span class="toc-number">2.4.6.</span> <span class="toc-text">删除所有收藏夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E5%A4%B9%E6%9B%B4%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.4.7.</span> <span class="toc-text">收藏夹更改事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.</span> <span class="toc-text">元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%85%B6-IMetadata-%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.5.1.</span> <span class="toc-text">项目：获取其 IMetadata 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E8%8E%B7%E5%8F%96XML"><span class="toc-number">2.5.2.</span> <span class="toc-text">项目：获取项目的元数据：获取XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E8%AE%BE%E7%BD%AE%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E8%AE%BE%E7%BD%AEXML%E9%A1%B9"><span class="toc-number">2.5.3.</span> <span class="toc-text">项目：设置项目的元数据：设置XML项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%A3%80%E6%9F%A5%E5%85%83%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E7%BC%96%E8%BE%91%EF%BC%9A%E5%8F%AF%E4%BB%A5%E7%BC%96%E8%BE%91"><span class="toc-number">2.5.4.</span> <span class="toc-text">项目：检查元数据是否可以编辑：可以编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BD%BF%E7%94%A8%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BD%93%E5%89%8D%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%90%8C%E6%AD%A5"><span class="toc-number">2.5.5.</span> <span class="toc-text">项目：使用项目的当前属性更新元数据：同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BB%8E%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%A4%8D%E5%88%B6%E5%85%83%E6%95%B0%E6%8D%AE%E4%BB%8E%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.6.</span> <span class="toc-text">项目：从源项目的元数据复制元数据：复制元数据从项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BB%8E%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%88%A0%E9%99%A4%E6%9F%90%E4%BA%9B%E5%86%85%E5%AE%B9%EF%BC%9A%E5%88%A0%E9%99%A4%E5%85%83%E6%95%B0%E6%8D%AE%E5%86%85%E5%AE%B9"><span class="toc-number">2.5.7.</span> <span class="toc-text">项目：从当前项目的元数据中删除某些内容：删除元数据内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%AF%BC%E5%85%A5%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E5%85%83%E6%95%B0%E6%8D%AE-%E8%BE%93%E5%85%A5%E8%B7%AF%E5%BE%84%E5%8F%AF%E4%BB%A5%E6%98%AF%E5%8C%85%E5%90%AB%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%98%AF-XML-%E6%96%87%E4%BB%B6%E7%9A%84-URI%EF%BC%9A%E5%AF%BC%E5%85%A5%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.8.</span> <span class="toc-text">项目：使用导入的元数据更新元数据 - 输入路径可以是包含元数据的项目的路径，也可以是 XML 文件的 URI：导入元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%AF%BC%E5%85%A5%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%AF%BC%E5%85%A5%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.9.</span> <span class="toc-text">项目：使用导入的元数据更新元数据：导入元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%AF%BC%E5%87%BA%E5%BD%93%E5%89%8D%E9%80%89%E5%AE%9A%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%AF%BC%E5%87%BA%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.10.</span> <span class="toc-text">项目：导出当前选定项目的元数据：导出元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%AF%BC%E5%87%BA%E5%BD%93%E5%89%8D%E9%80%89%E5%AE%9A%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%AF%BC%E5%87%BA%E5%85%83%E6%95%B0%E6%8D%AE-1"><span class="toc-number">2.5.11.</span> <span class="toc-text">项目：导出当前选定项目的元数据：导出元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%B0%86%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%8F%A6%E5%AD%98%E4%B8%BA-XML%EF%BC%9A%E5%B0%86%E5%85%83%E6%95%B0%E6%8D%AE%E5%8F%A6%E5%AD%98%E4%B8%BA-XML"><span class="toc-number">2.5.12.</span> <span class="toc-text">项目：将当前项目的元数据另存为 XML：将元数据另存为 XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%B0%86%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%8F%A6%E5%AD%98%E4%B8%BA-HTML%EF%BC%9A%E5%B0%86%E5%85%83%E6%95%B0%E6%8D%AE%E5%8F%A6%E5%AD%98%E4%B8%BAHTML"><span class="toc-number">2.5.13.</span> <span class="toc-text">项目：将当前项目的元数据另存为 HTML：将元数据另存为HTML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-XSLT-%E4%BF%9D%E5%AD%98%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E4%BF%9D%E5%AD%98%E5%85%83%E6%95%B0%E6%8D%AE%E4%BD%9C%E4%B8%BA%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-XSLT"><span class="toc-number">2.5.14.</span> <span class="toc-text">项目：使用自定义 XSLT 保存当前项目的元数据：保存元数据作为使用自定义 XSLT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%8D%87%E7%BA%A7%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%8D%87%E7%BA%A7%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.15.</span> <span class="toc-text">项目：升级当前项目的元数据：升级元数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8D%95%E4%BD%8D"><span class="toc-number">2.6.</span> <span class="toc-text">项目单位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%8F%AF%E7%94%A8%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%AE%8C%E6%95%B4%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.1.</span> <span class="toc-text">获取所有可用单位格式的完整列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.2.</span> <span class="toc-text">获取当前项目的单位格式列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%89%B9%E5%AE%9A%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.3.</span> <span class="toc-text">获取当前项目的特定单位格式列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%BB%98%E8%AE%A4%E6%A0%BC%E5%BC%8F%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.4.</span> <span class="toc-text">获取当前项目的默认格式列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%89%B9%E5%AE%9A%E9%BB%98%E8%AE%A4%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.6.5.</span> <span class="toc-text">获取当前项目的特定默认单位格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E8%AE%BE%E7%BD%AE%E7%89%B9%E5%AE%9A%E7%9A%84%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.6.</span> <span class="toc-text">为当前项目设置特定的单位格式列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%A1%B9%E7%9B%AE%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">2.6.7.</span> <span class="toc-text">设置项目单位格式的默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8D%95%E4%BD%8D%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.6.8.</span> <span class="toc-text">更新项目的单位格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">2.7.</span> <span class="toc-text">应用选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B8%B8%E8%A7%84%E9%80%89%E9%A1%B9"><span class="toc-number">2.7.1.</span> <span class="toc-text">获取常规选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E2%80%9C%E5%B8%B8%E8%A7%84%E9%80%89%E9%A1%B9%E2%80%9D%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.7.2.</span> <span class="toc-text">将“常规选项”设置为使用自定义设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%B8%B8%E8%A7%84%E9%80%89%E9%A1%B9%E4%BB%A5%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">2.7.3.</span> <span class="toc-text">设置常规选项以使用默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8B%E8%BD%BD%E9%80%89%E9%A1%B9"><span class="toc-number">2.7.4.</span> <span class="toc-text">获取下载选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%92%8C%E5%8F%91%E5%B8%83%E7%9A%84%E6%9A%82%E5%AD%98%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.7.5.</span> <span class="toc-text">设置共享和发布的暂存位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-PPKX-%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%80%89%E9%A1%B9"><span class="toc-number">2.7.6.</span> <span class="toc-text">设置 PPKX 的下载选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A7%A3%E5%8E%8B%E7%BC%A9%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%80%89%E9%A1%B9%E5%85%B6%E4%BB%96"><span class="toc-number">2.7.7.</span> <span class="toc-text">设置解压缩的下载选项其他</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%A6%BB%E7%BA%BF%E5%9C%B0%E5%9B%BE%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%80%89%E9%A1%B9"><span class="toc-number">2.7.8.</span> <span class="toc-text">设置离线地图的下载选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%B8%BB%E6%9C%BA"><span class="toc-number">3.</span> <span class="toc-text">核心主机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A0%B8%E5%BF%83%E4%B8%BB%E6%9C%BA"><span class="toc-number">3.0.1.</span> <span class="toc-text">初始化核心主机</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%BE%91"><span class="toc-number">4.</span> <span class="toc-text">编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">编辑操作方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.1.</span> <span class="toc-text">编辑操作创建要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.2.</span> <span class="toc-text">使用当前模板创建要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84%E6%A3%80%E6%9F%A5%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.3.</span> <span class="toc-text">从修改后的检查器创建要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-CSV-%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.4.</span> <span class="toc-text">从 CSV 文件创建要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C-%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%A8%A1%E6%9D%BF%E5%9C%A8%E8%A1%A8%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%8C"><span class="toc-number">4.1.5.</span> <span class="toc-text">编辑操作 使用表模板在表中创建行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%89%AA%E8%BE%91%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.6.</span> <span class="toc-text">编辑操作剪辑特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%88%87%E5%89%B2%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.7.</span> <span class="toc-text">编辑操作切割要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.8.</span> <span class="toc-text">编辑操作删除要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E9%87%8D%E5%A4%8D%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.9.</span> <span class="toc-text">编辑操作重复要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%88%86%E8%A7%A3%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.10.</span> <span class="toc-text">编辑操作分解特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%90%88%E5%B9%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">4.1.11.</span> <span class="toc-text">编辑操作合并功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9%E5%8D%95%E4%B8%AA%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.12.</span> <span class="toc-text">编辑操作 修改单个特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9%E5%A4%9A%E4%B8%AA%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.13.</span> <span class="toc-text">编辑操作 修改多个要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%9B%BE%E5%B1%82%E8%A6%81%E7%B4%A0%E5%B9%B6%E6%9B%B4%E6%96%B0%E5%AD%97%E6%AE%B5"><span class="toc-number">4.1.14.</span> <span class="toc-text">搜索图层要素并更新字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.15.</span> <span class="toc-text">移动要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A6%81%E7%B4%A0%E7%A7%BB%E5%8A%A8%E5%88%B0%E7%89%B9%E5%AE%9A%E5%9D%90%E6%A0%87"><span class="toc-number">4.1.16.</span> <span class="toc-text">将要素移动到特定坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%B9%B3%E9%9D%A2%E5%8C%96%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.17.</span> <span class="toc-text">编辑操作平面化要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%B9%B6%E8%A1%8C%E5%81%8F%E7%A7%BB"><span class="toc-number">4.1.18.</span> <span class="toc-text">编辑操作并行偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E9%87%8D%E5%A1%91%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.19.</span> <span class="toc-text">编辑操作重塑特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E6%97%8B%E8%BD%AC%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.20.</span> <span class="toc-text">编辑操作旋转要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E6%AF%94%E4%BE%8B%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.21.</span> <span class="toc-text">编辑操作比例要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E6%8B%86%E5%88%86%E8%A6%81%E7%B4%A0"><span class="toc-number">4.1.22.</span> <span class="toc-text">编辑操作拆分要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E5%8F%98%E6%8D%A2%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.23.</span> <span class="toc-text">编辑操作变换特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E6%A9%A1%E7%9A%AE%E6%9D%BF%E5%8A%9F%E8%83%BD"><span class="toc-number">4.1.24.</span> <span class="toc-text">编辑操作橡皮板功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C-%E6%89%A7%E8%A1%8C%E5%89%AA%E8%BE%91%E3%80%81%E5%89%AA%E5%88%87%E5%92%8C%E5%B9%B3%E5%9D%A6%E5%8C%96"><span class="toc-number">4.1.25.</span> <span class="toc-text">编辑操作 执行剪辑、剪切和平坦化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E9%93%BE-%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.26.</span> <span class="toc-text">编辑操作链 编辑操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E9%80%9A%E8%BF%87%E8%A1%8C%E4%BB%A4%E7%89%8C%E6%B7%BB%E5%8A%A0%E9%99%84%E4%BB%B6"><span class="toc-number">4.1.27.</span> <span class="toc-text">编辑操作通过行令牌添加附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetOnUndone%EF%BC%8C-SetOnRedone%EF%BC%8C-SetOnComitted"><span class="toc-number">4.1.28.</span> <span class="toc-text">SetOnUndone， SetOnRedone， SetOnComitted</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%BC%96%E8%BE%91"><span class="toc-number">4.2.</span> <span class="toc-text">启用编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%BC%96%E8%BE%91-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">启用编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E7%BC%96%E8%BE%91"><span class="toc-number">4.2.2.</span> <span class="toc-text">禁用编辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E6%8B%93%E6%89%91"><span class="toc-number">4.3.</span> <span class="toc-text">地图拓扑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%9C%B0%E5%9B%BE%E6%8B%93%E6%89%91"><span class="toc-number">4.3.1.</span> <span class="toc-text">构建地图拓扑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.4.</span> <span class="toc-text">行事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%A1%8C%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.4.1.</span> <span class="toc-text">订阅行事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A1%8C%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%98%A0%E5%B0%84%E4%B8%AD%E7%9A%84%E5%8D%95%E7%8B%AC%E8%A1%A8%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%AE%B0%E5%BD%95"><span class="toc-number">4.4.2.</span> <span class="toc-text">在行事件中的映射中的单独表中创建记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A1%8C%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8D%95%E7%8B%AC%E8%A1%A8%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%AE%B0%E5%BD%95"><span class="toc-number">4.4.3.</span> <span class="toc-text">在行事件中的单独表中创建记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%8C%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E8%AE%B0%E5%BD%95-%E4%BD%BF%E7%94%A8-Row-Store"><span class="toc-number">4.4.4.</span> <span class="toc-text">修改行事件中的记录 - 使用 Row.Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%8C%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E8%AE%B0%E5%BD%95-%E4%BD%BF%E7%94%A8-EditOperation-Modify"><span class="toc-number">4.4.5.</span> <span class="toc-text">修改行事件中的记录 - 使用 EditOperation.Modify</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%BC%96%E8%BE%91%E6%97%B6%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E6%98%AF%E5%90%A6%E6%9B%B4%E6%94%B9"><span class="toc-number">4.4.6.</span> <span class="toc-text">确定编辑时几何图形是否更改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.7.</span> <span class="toc-text">取消删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%B7%B2%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">编辑已完成事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E7%BC%96%E8%BE%91%E5%B7%B2%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.5.1.</span> <span class="toc-text">订阅编辑已完成事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%91%98"><span class="toc-number">4.6.</span> <span class="toc-text">检查员</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A6%81%E7%B4%A0%E4%BB%8E%E5%9B%BE%E5%B1%82%E5%8A%A0%E8%BD%BD%E5%88%B0%E6%A3%80%E6%9F%A5%E5%99%A8%E4%B8%AD"><span class="toc-number">4.6.1.</span> <span class="toc-text">将要素从图层加载到检查器中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E9%80%89%E6%8B%A9%E5%8A%A0%E8%BD%BD%E5%88%B0%E6%A3%80%E6%9F%A5%E5%99%A8%E4%B8%AD"><span class="toc-number">4.6.2.</span> <span class="toc-text">将地图选择加载到检查器中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-number">4.6.3.</span> <span class="toc-text">获取所选要素的属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E9%80%89%E6%8B%A9%E5%8A%A0%E8%BD%BD%E5%88%B0%E6%A3%80%E6%9F%A5%E5%99%A8%E5%B9%B6%E6%9B%B4%E6%94%B9%E5%B1%9E%E6%80%A7"><span class="toc-number">4.6.4.</span> <span class="toc-text">将地图选择加载到检查器并更改属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A3%80%E6%9F%A5%E5%99%A8%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E6%96%B9%E6%A1%88"><span class="toc-number">4.6.5.</span> <span class="toc-text">使用检查器获取图层方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%99%A8-%E6%B7%BB%E5%8A%A0%E9%AA%8C%E8%AF%81"><span class="toc-number">4.6.6.</span> <span class="toc-text">检查器.添加验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">4.7.</span> <span class="toc-text">访问 Blob 字段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B1%9E%E6%80%A7%E6%A3%80%E6%9F%A5%E5%99%A8%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">4.7.1.</span> <span class="toc-text">使用属性检查器读取和写入 Blob 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9B%9E%E8%B0%83%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%8C%E6%B8%B8%E6%A0%87%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">4.7.2.</span> <span class="toc-text">在回调中使用行游标读取和写入 Blob 字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%85%E6%A0%BC%E5%AD%97%E6%AE%B5"><span class="toc-number">4.8.</span> <span class="toc-text">访问栅格字段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%85%E6%A0%BC%E5%AD%97%E6%AE%B5%E8%AF%BB%E5%8F%96"><span class="toc-number">4.8.1.</span> <span class="toc-text">从栅格字段读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9B%BE%E5%83%8F%E5%86%99%E5%85%A5%E6%A0%85%E6%A0%BC%E5%AD%97%E6%AE%B5"><span class="toc-number">4.8.2.</span> <span class="toc-text">将图像写入栅格字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%8E%8B%E7%BC%A9%E5%9B%BE%E5%83%8F%E5%86%99%E5%85%A5%E6%A0%85%E6%A0%BC%E5%AD%97%E6%AE%B5"><span class="toc-number">4.8.3.</span> <span class="toc-text">将压缩图像写入栅格字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%8D%89%E5%9B%BE"><span class="toc-number">4.9.</span> <span class="toc-text">使用草图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E8%8D%89%E5%9B%BE%E9%80%89%E6%8B%A9%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.9.1.</span> <span class="toc-text">切换草图选择模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%86%E5%90%AC%E8%8D%89%E5%9B%BE%E4%BF%AE%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.9.2.</span> <span class="toc-text">聆听草图修改事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E5%90%AC%E8%8D%89%E5%9B%BE%E5%AE%8C%E6%88%90%E5%89%8D%E4%BA%8B%E4%BB%B6%E5%B9%B6%E4%BF%AE%E6%94%B9%E8%8D%89%E5%9B%BE"><span class="toc-number">4.9.3.</span> <span class="toc-text">收听草图完成前事件并修改草图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E5%90%AC%E8%8D%89%E5%9B%BE%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.9.4.</span> <span class="toc-text">收听草图完成事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E8%8D%89%E5%9B%BE%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E9%80%A0%E5%B7%A5%E5%85%B7"><span class="toc-number">4.9.5.</span> <span class="toc-text">触发草图事件的自定义构造工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8D%89%E5%9B%BE%E5%B7%A5%E5%85%B7%E7%9A%84%E8%8D%89%E5%9B%BE%E7%AC%A6%E5%8F%B7"><span class="toc-number">4.9.6.</span> <span class="toc-text">自定义自定义草图工具的草图符号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8D%95%E6%8D%89"><span class="toc-number">4.10.</span> <span class="toc-text">捕捉</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8D%95%E6%8D%89-%E6%89%93%E5%BC%80%E6%88%96%E5%85%B3%E9%97%AD%E6%8D%95%E6%8D%89"><span class="toc-number">4.10.1.</span> <span class="toc-text">配置捕捉 - 打开或关闭捕捉</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8D%95%E6%8D%89-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8D%95%E6%8D%89%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.10.2.</span> <span class="toc-text">配置捕捉 - 应用程序捕捉模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8D%95%E6%8D%89-%E5%9B%BE%E5%B1%82%E6%8D%95%E6%8D%89%E5%8F%AF%E6%8D%95%E6%8D%89%E6%80%A7"><span class="toc-number">4.10.3.</span> <span class="toc-text">配置捕捉 - 图层捕捉可捕捉性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8D%95%E6%8D%89-%E5%9B%BE%E5%B1%82%E6%8D%95%E6%8D%89%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.10.4.</span> <span class="toc-text">配置捕捉 - 图层捕捉模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8D%95%E6%8D%89-%E7%BB%84%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.10.5.</span> <span class="toc-text">配置捕捉 - 组合示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%95%E6%8D%89%E9%80%89%E9%A1%B9"><span class="toc-number">4.10.6.</span> <span class="toc-text">捕捉选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%92%A4%E6%B6%88-x2F-%E9%87%8D%E5%81%9A"><span class="toc-number">4.11.</span> <span class="toc-text">撤消&#x2F;重做</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%A4%E6%B6%88-x2F-%E9%87%8D%E5%81%9A%E6%9C%80%E8%BF%91%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.11.1.</span> <span class="toc-text">撤消&#x2F;重做最近的操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.</span> <span class="toc-text">编辑模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9B%BE%E5%B1%82%E4%B8%8A%E6%8C%89%E5%90%8D%E7%A7%B0%E6%9F%A5%E6%89%BE%E7%BC%96%E8%BE%91%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.1.</span> <span class="toc-text">在图层上按名称查找编辑模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%B1%9E%E4%BA%8E%E7%8B%AC%E7%AB%8B%E8%A1%A8%E7%9A%84%E8%A1%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.2.</span> <span class="toc-text">查找属于独立表的表模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.3.</span> <span class="toc-text">当前模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%A8%A1%E6%9D%BF%E7%9A%84%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%B7%A5%E5%85%B7"><span class="toc-number">4.12.4.</span> <span class="toc-text">更改模板的默认编辑工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E6%88%96%E6%98%BE%E7%A4%BA%E6%A8%A1%E6%9D%BF%E4%B8%8A%E7%9A%84%E7%BC%96%E8%BE%91%E5%B7%A5%E5%85%B7"><span class="toc-number">4.12.5.</span> <span class="toc-text">隐藏或显示模板上的编辑工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%B1%82%E5%88%9B%E5%BB%BA%E6%96%B0%E6%A8%A1%E6%9D%BF%E3%80%82%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.6.</span> <span class="toc-text">使用图层创建新模板。创建模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%88%9B%E5%BB%BA%E6%96%B0%E8%A1%A8%E6%A8%A1%E6%9D%BF%E3%80%82%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.7.</span> <span class="toc-text">使用表创建新表模板。创建模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.8.</span> <span class="toc-text">更新表模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E9%87%8A%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.9.</span> <span class="toc-text">创建注释模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.12.10.</span> <span class="toc-text">删除表模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E6%A8%A1%E6%9D%BF%E5%B7%B2%E6%9B%B4%E6%94%B9"><span class="toc-number">4.12.11.</span> <span class="toc-text">活动模板已更改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.13.</span> <span class="toc-text">注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="toc-number">4.13.1.</span> <span class="toc-text">注释构建工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E7%BC%96%E7%A8%8B%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E7%BC%96%E8%BE%91%E6%89%B9%E6%B3%A8"><span class="toc-number">4.13.2.</span> <span class="toc-text">以编程方式启动编辑批注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC"><span class="toc-number">4.13.3.</span> <span class="toc-text">更新批注文本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%89%B9%E6%B3%A8%E5%BD%A2%E7%8A%B6"><span class="toc-number">4.13.4.</span> <span class="toc-text">修改批注形状</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">4.13.5.</span> <span class="toc-text">修改批注文本图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProSnippet-%E7%BB%84-%EF%BC%9A-%E6%8E%A5%E5%9C%B0%E5%88%B0%E7%BD%91%E6%A0%BC"><span class="toc-number">4.13.6.</span> <span class="toc-text">ProSnippet 组 ： 接地到网格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G2G-%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.13.7.</span> <span class="toc-text">G2G 设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.</span> <span class="toc-text">编辑选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-x2F-%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%BE%91%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.1.</span> <span class="toc-text">获取&#x2F;设置编辑选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%8D%89%E5%9B%BE%E6%8A%98%E7%82%B9%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.2.</span> <span class="toc-text">获取草图折点符号系统选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%8D%89%E5%9B%BE%E7%BA%BF%E6%AE%B5%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.3.</span> <span class="toc-text">获取草图线段符号系统选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%8D%89%E5%9B%BE%E9%A1%B6%E7%82%B9%E7%AC%A6%E5%8F%B7%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.4.</span> <span class="toc-text">设置草图顶点符号选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%8D%89%E5%9B%BE%E7%BA%BF%E6%AE%B5%E7%AC%A6%E5%8F%B7%E9%80%89%E9%A1%B9"><span class="toc-number">4.14.5.</span> <span class="toc-text">设置草图线段符号选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%8D%89%E5%9B%BE%E9%A1%B6%E7%82%B9%E7%AC%A6%E5%8F%B7%E8%AE%BE%E7%BD%AE%E5%9B%9E%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">4.14.6.</span> <span class="toc-text">将草图顶点符号设置回默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%8D%89%E5%9B%BE%E7%BA%BF%E6%AE%B5%E7%AC%A6%E5%8F%B7%E8%AE%BE%E7%BD%AE%E5%9B%9E%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">4.14.7.</span> <span class="toc-text">将草图线段符号设置回默认值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E9%80%89%E9%A1%B9"><span class="toc-number">4.15.</span> <span class="toc-text">版本控制选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%92%8C%E8%AE%BE%E7%BD%AE%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E9%80%89%E9%A1%B9"><span class="toc-number">4.15.1.</span> <span class="toc-text">获取和设置版本控制选项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E6%9E%84%E9%80%A0%E5%B7%A5%E5%85%B7"><span class="toc-number">4.15.1.1.</span> <span class="toc-text">创建注记构造工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E3%80%82%E8%AD%A6%E5%91%8A%EF%BC%9ATEXTSTRING-Anno-%E5%B1%9E%E6%80%A7%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8"><span class="toc-number">4.15.1.2.</span> <span class="toc-text">通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%88%96%E7%A7%BB%E5%8A%A8%E6%89%B9%E6%B3%A8"><span class="toc-number">4.15.1.3.</span> <span class="toc-text">旋转或移动批注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">4.15.1.4.</span> <span class="toc-text">更改批注文本图形</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C"><span class="toc-number">4.16.</span> <span class="toc-text">公共设施网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E5%85%B3%E8%81%94"><span class="toc-number">4.16.0.1.</span> <span class="toc-text">创建公共设施网络关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E4%B8%AA%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E8%A6%81%E7%B4%A0%E5%92%8C%E5%85%B3%E8%81%94"><span class="toc-number">4.16.0.2.</span> <span class="toc-text">在单个编辑操作中创建公共设施网络要素和关联</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.</span> <span class="toc-text">地理数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-number">5.1.</span> <span class="toc-text">地理数据库和数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BB%99%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%9A%84%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.</span> <span class="toc-text">打开给定路径的文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7%E6%89%93%E5%BC%80%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.2.</span> <span class="toc-text">使用连接属性打开企业级地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-sde-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%89%93%E5%BC%80%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.3.</span> <span class="toc-text">使用 sde 文件路径打开企业级地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%B7%A5%E7%A8%8B%E9%A1%B9%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.4.</span> <span class="toc-text">从工程项获取地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7"><span class="toc-number">5.1.5.</span> <span class="toc-text">从连接文件获取数据库连接属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.6.</span> <span class="toc-text">从要素图层获取地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.1.7.</span> <span class="toc-text">执行 SQL 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">5.2.</span> <span class="toc-text">定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AE%9A%E4%B9%89"><span class="toc-number">5.2.1.</span> <span class="toc-text">从地理数据库获取定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AE%9A%E4%B9%89%E5%88%97%E8%A1%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">从地理数据库获取定义列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E5%AE%9A%E4%B9%89"><span class="toc-number">5.2.3.</span> <span class="toc-text">从地理数据库获取相关定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%B1%82%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%AE%9A%E4%B9%89"><span class="toc-number">5.2.4.</span> <span class="toc-text">从层获取表定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-number">5.3.</span> <span class="toc-text">数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%93%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.3.1.</span> <span class="toc-text">从地理数据库打开数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">检查表是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">5.3.3.</span> <span class="toc-text">检查要素类是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%85%B3%E7%B3%BB%E4%B8%A4%E4%B8%AA%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E7%B1%BB"><span class="toc-number">5.3.4.</span> <span class="toc-text">打开关系两个表之间的类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%B3%E7%B3%BB%E7%B1%BB%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.3.5.</span> <span class="toc-text">从关系类获取相关要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-shapefile-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%89%93%E5%BC%80%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.3.6.</span> <span class="toc-text">从 shapefile 数据存储打开要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80-CAD-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-number">5.3.7.</span> <span class="toc-text">打开 CAD 数据存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.4.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E7%AD%9B%E9%80%89%E5%99%A8%E6%90%9C%E7%B4%A2%E8%A1%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">使用查询筛选器搜索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A1%A8%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%9D%9E%E6%8B%89%E4%B8%81%E5%AD%97%E7%AC%A6"><span class="toc-number">5.4.2.</span> <span class="toc-text">在表中搜索非拉丁字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%80%E7%BB%84%E5%AF%B9%E8%B1%A1-ID-%E6%90%9C%E7%B4%A2%E8%A1%A8"><span class="toc-number">5.4.3.</span> <span class="toc-text">使用一组对象 ID 搜索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A9%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%E8%BF%87%E6%BB%A4%E5%99%A8%E6%90%9C%E7%B4%A2%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.4.4.</span> <span class="toc-text">使用空间查询过滤器搜索要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E9%80%89%E6%8B%A9%E8%A1%8C"><span class="toc-number">5.4.5.</span> <span class="toc-text">从表中选择行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A6%81%E7%B4%A0%E7%B1%BB%E4%B8%AD%E9%80%89%E6%8B%A9%E8%A6%81%E7%B4%A0"><span class="toc-number">5.4.6.</span> <span class="toc-text">从要素类中选择要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E4%B8%AD%E5%BD%93%E5%89%8D%E6%9C%89%E5%A4%9A%E5%B0%91%E8%A1%8C%E7%9A%84%E8%AE%A1%E6%95%B0"><span class="toc-number">5.4.7.</span> <span class="toc-text">获取表中当前有多少行的计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E7%9A%84%E7%89%B9%E5%BE%81%E8%AE%A1%E6%95%B0"><span class="toc-number">5.4.8.</span> <span class="toc-text">获取图层的特征计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%A1%A8%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">5.4.9.</span> <span class="toc-text">对表进行排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%A1%A8%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">5.4.10.</span> <span class="toc-text">计算表的统计信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E4%B8%AA%E8%A1%A8%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">5.4.11.</span> <span class="toc-text">在单个表上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WHERE-%E5%AD%90%E5%8F%A5%E8%AE%A1%E7%AE%97%E8%BF%9E%E6%8E%A5%E4%B8%8A%E7%9A%84-QueryDef"><span class="toc-number">5.4.12.</span> <span class="toc-text">使用 WHERE 子句计算连接上的 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%A4%96%E9%83%A8%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AE%A1%E7%AE%97-QueryDef"><span class="toc-number">5.4.13.</span> <span class="toc-text">在外部连接上计算 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%86%85%E9%83%A8%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">5.4.14.</span> <span class="toc-text">在内部连接上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B5%8C%E5%A5%97-INNER-%E5%92%8C-OUTER-%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%AF%84%E4%BC%B0-QueryDef"><span class="toc-number">5.4.15.</span> <span class="toc-text">在嵌套 - INNER 和 OUTER 连接上评估 QueryDef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%88%9B%E5%BB%BA%E9%BB%98%E8%AE%A4%E6%9F%A5%E8%AF%A2%E6%8F%8F%E8%BF%B0%E5%B9%B6%E8%8E%B7%E5%8F%96%E6%9F%A5%E8%AF%A2%E6%8F%8F%E8%BF%B0%E7%9A%84-ArcGIS-Core-Data-Table"><span class="toc-number">5.4.16.</span> <span class="toc-text">为数据库表创建默认查询描述并获取查询描述的 ArcGIS.Core.Data.Table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.17.</span> <span class="toc-text">从数据库表的自定义查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%B2%A1%E6%9C%89%E4%B8%8D%E5%8F%AF%E4%B8%BA%E7%A9%BA%E7%9A%84%E5%94%AF%E4%B8%80-id-%E5%88%97%E7%9A%84%E8%81%94%E6%8E%A5%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.18.</span> <span class="toc-text">从没有不可为空的唯一 id 列的联接查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%B7%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%BD%A2%E7%8A%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.19.</span> <span class="toc-text">从具有多个形状类型的数据库表的查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-SQLite-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.20.</span> <span class="toc-text">从 SQLite 数据库表的查询创建查询说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-SQLSyntax-%E5%BD%A2%E6%88%90%E4%B8%8E%E5%B9%B3%E5%8F%B0%E6%97%A0%E5%85%B3%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.4.21.</span> <span class="toc-text">使用 SQLSyntax 形成与平台无关的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A6%81%E7%B4%A0%E7%B1%BB%E8%BF%9E%E6%8E%A5%E5%88%B0%E5%85%B7%E6%9C%89%E8%99%9A%E6%8B%9F%E5%85%B3%E7%B3%BB%E7%B1%BB%E7%9A%84-Oracle-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E5%9B%BE%E5%B1%82%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.4.22.</span> <span class="toc-text">将文件地理数据库要素类连接到具有虚拟关系类的 Oracle 数据库查询图层要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9D%A5%E8%87%AA%E4%B8%8D%E5%90%8C%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%A4%E4%B8%AA%E8%A1%A8"><span class="toc-number">5.4.23.</span> <span class="toc-text">连接来自不同地理数据库的两个表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%BF%9E%E6%8E%A5%E4%B8%A4%E4%B8%AA%E7%89%88%E6%9C%AC%E5%8C%96%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E8%A1%A8"><span class="toc-number">5.4.24.</span> <span class="toc-text">使用在地理数据库中连接两个版本化表的查询创建查询表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AD%97%E6%AE%B5%E5%80%BC%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA"><span class="toc-number">5.4.25.</span> <span class="toc-text">检查字段值是否为空</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AD%97%E6%AE%B5%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">5.4.26.</span> <span class="toc-text">从字段中获取域字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91-1"><span class="toc-number">5.5.</span> <span class="toc-text">编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%8C"><span class="toc-number">5.5.1.</span> <span class="toc-text">创建行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%B9%E5%BE%81"><span class="toc-number">5.5.2.</span> <span class="toc-text">创建特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%8C"><span class="toc-number">5.5.3.</span> <span class="toc-text">修改行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%89%B9%E5%BE%81"><span class="toc-number">5.5.4.</span> <span class="toc-text">修改特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%80%BC%E5%86%99%E5%85%A5-Guid-%E5%88%97"><span class="toc-number">5.5.5.</span> <span class="toc-text">将值写入 Guid 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%8C-x2F-%E8%A6%81%E7%B4%A0"><span class="toc-number">5.5.6.</span> <span class="toc-text">删除行&#x2F;要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%99%84%E4%BB%B6"><span class="toc-number">5.5.7.</span> <span class="toc-text">添加附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%99%84%E4%BB%B6"><span class="toc-number">5.5.8.</span> <span class="toc-text">更新附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%99%84%E4%BB%B6"><span class="toc-number">5.5.9.</span> <span class="toc-text">删除附件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">5.5.10.</span> <span class="toc-text">写入 Blob 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96-Blob-%E5%AD%97%E6%AE%B5"><span class="toc-number">5.5.11.</span> <span class="toc-text">读取 Blob 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%89%E5%85%B3%E7%B3%BB%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E8%A1%8C"><span class="toc-number">5.5.12.</span> <span class="toc-text">获取按关系类关联的行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B3%E7%B3%BB"><span class="toc-number">5.5.13.</span> <span class="toc-text">创建关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%B3%E7%B3%BB"><span class="toc-number">5.5.14.</span> <span class="toc-text">删除关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E5%85%A5%E6%B8%B8%E6%A0%87"><span class="toc-number">5.5.15.</span> <span class="toc-text">使用插入游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-RowBuffer-%E5%9C%A8%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0"><span class="toc-number">5.5.16.</span> <span class="toc-text">使用 RowBuffer 在注记要素类中创建新的注记要素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">5.6.</span> <span class="toc-text">版本控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%88%B0%E7%89%88%E6%9C%AC"><span class="toc-number">5.6.1.</span> <span class="toc-text">连接到版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E7%8B%AC%E7%9A%84%E7%BC%96%E8%BE%91%E4%BC%9A%E8%AF%9D%E4%B8%AD%E5%8D%8F%E8%B0%83%E7%89%88%E6%9C%AC%E5%B9%B6%E5%B0%86%E5%85%B6%E4%B8%8E%E5%85%B6%E7%88%B6%E7%BA%A7%E8%BF%9B%E8%A1%8C%E6%A0%B8%E5%AF%B9%E5%92%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">5.6.2.</span> <span class="toc-text">在单独的编辑会话中协调版本并将其与其父级进行核对和提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%90%8C%E4%B8%80%E7%BC%96%E8%BE%91%E4%BC%9A%E8%AF%9D%E4%B8%AD%E5%8D%8F%E8%B0%83%E7%89%88%E6%9C%AC%E5%B9%B6%E5%B0%86%E5%85%B6%E4%B8%8E%E5%85%B6%E7%88%B6%E7%BA%A7%E6%8F%90%E4%BA%A4"><span class="toc-number">5.6.3.</span> <span class="toc-text">在同一编辑会话中协调版本并将其与其父级提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%89%88%E6%9C%AC"><span class="toc-number">5.6.4.</span> <span class="toc-text">使用版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC"><span class="toc-number">5.6.5.</span> <span class="toc-text">使用默认版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%88%E6%9C%AC"><span class="toc-number">5.6.6.</span> <span class="toc-text">创建版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC"><span class="toc-number">5.6.7.</span> <span class="toc-text">创建历史版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E5%88%87%E6%8D%A2"><span class="toc-number">5.6.8.</span> <span class="toc-text">在版本之间切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E8%BF%87%E8%B4%A6"><span class="toc-number">5.6.9.</span> <span class="toc-text">部分过账</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL"><span class="toc-number">5.7.</span> <span class="toc-text">DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">5.7.1.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.2.</span> <span class="toc-text">创建要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">5.7.3.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.4.</span> <span class="toc-text">删除要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.5.</span> <span class="toc-text">打开内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.6.</span> <span class="toc-text">创建内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%86%85%E5%AD%98%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.7.</span> <span class="toc-text">删除内存地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.8.</span> <span class="toc-text">创建文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.9.</span> <span class="toc-text">删除文件地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A7%BB%E5%8A%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.10.</span> <span class="toc-text">创建移动地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%A7%BB%E5%8A%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.7.11.</span> <span class="toc-text">删除移动地理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%8C%83%E5%9B%B4%E5%9F%9F"><span class="toc-number">5.7.12.</span> <span class="toc-text">创建范围域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BC%96%E7%A0%81%E5%80%BC%E5%9F%9F"><span class="toc-number">5.7.13.</span> <span class="toc-text">创建编码值域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.7.14.</span> <span class="toc-text">创建要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.7.15.</span> <span class="toc-text">删除要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.7.16.</span> <span class="toc-text">重命名要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E6%AC%A1%E6%93%8D%E4%BD%9C%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E8%A6%81%E7%B4%A0%E7%B1%BB%E7%9A%84%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.7.17.</span> <span class="toc-text">在一次操作中创建具有要素类的要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%8E%B0%E6%9C%89%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.18.</span> <span class="toc-text">在现有要素数据集中创建要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.7.19.</span> <span class="toc-text">将要素类添加到要素数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">5.7.20.</span> <span class="toc-text">重命名表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5"><span class="toc-number">5.7.21.</span> <span class="toc-text">向要素类添加字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BD%BF%E7%94%A8%E5%9F%9F%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">5.7.22.</span> <span class="toc-text">添加使用域的字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="toc-number">5.7.23.</span> <span class="toc-text">从表中删除字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.24.</span> <span class="toc-text">创建注记要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B3%E8%81%94%E8%A6%81%E7%B4%A0%E7%9A%84%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.25.</span> <span class="toc-text">创建关联要素的注记要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A6%81%E7%B4%A0%E6%95%B0%E6%8D%AE%E9%9B%86%E5%86%85%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">5.7.26.</span> <span class="toc-text">在要素数据集内创建注记要素类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8B%93%E6%89%91%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="toc-number">5.8.</span> <span class="toc-text">地理数据库拓扑代码段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E6%8B%93%E6%89%91%E5%92%8C%E8%BF%9B%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">5.8.1.</span> <span class="toc-text">开放拓扑和进程定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8B%93%E6%89%91%E8%A7%84%E5%88%99"><span class="toc-number">5.8.2.</span> <span class="toc-text">获取拓扑规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%8B%93%E6%89%91"><span class="toc-number">5.8.3.</span> <span class="toc-text">验证拓扑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8B%93%E6%89%91%E9%94%99%E8%AF%AF"><span class="toc-number">5.8.4.</span> <span class="toc-text">获取拓扑错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MarkAndUnmarkAsErrors"><span class="toc-number">5.8.5.</span> <span class="toc-text">MarkAndUnmarkAsErrors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">5.8.6.</span> <span class="toc-text">探索拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FindClosestElement"><span class="toc-number">5.8.7.</span> <span class="toc-text">FindClosestElement</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%A0%E4%BD%95"><span class="toc-number">6.</span> <span class="toc-text">几何</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83"><span class="toc-number">6.1.</span> <span class="toc-text">空间参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83-%E4%BB%8E%E5%B7%B2%E7%9F%A5-ID"><span class="toc-number">6.1.1.</span> <span class="toc-text">构造空间参考 - 从已知 ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E7%A9%BA%E9%97%B4%E5%BC%95%E7%94%A8-%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.1.2.</span> <span class="toc-text">构造空间引用 - 从字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WGS84-%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83"><span class="toc-number">6.1.3.</span> <span class="toc-text">使用 WGS84 空间参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9E%82%E7%9B%B4%E5%9D%90%E6%A0%87%E7%B3%BB%E6%9E%84%E9%80%A0%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83-%E4%BB%8E%E5%B7%B2%E7%9F%A5-ID"><span class="toc-number">6.1.4.</span> <span class="toc-text">使用垂直坐标系构造空间参考 - 从已知 ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9E%82%E7%9B%B4%E5%9D%90%E6%A0%87%E7%B3%BB%E6%9E%84%E9%80%A0%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83-%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.1.5.</span> <span class="toc-text">使用垂直坐标系构造空间参考 - 从字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-PCS-%E6%9E%84%E9%80%A0%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83-%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.1.6.</span> <span class="toc-text">使用自定义 PCS 构造空间参考 - 从字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.7.</span> <span class="toc-text">空间参考属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83"><span class="toc-number">6.1.8.</span> <span class="toc-text">导入和导出空间参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%BB%99%E5%AE%9A%E7%82%B9%E5%A4%84%E7%A9%BA%E9%97%B4%E5%8F%82%E8%80%83%E7%9A%84%E6%A0%BC%E7%BD%91%E6%94%B6%E6%95%9B"><span class="toc-number">6.1.9.</span> <span class="toc-text">确定给定点处空间参考的格网收敛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E5%87%86"><span class="toc-number">6.1.10.</span> <span class="toc-text">基准</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E5%8F%82%E7%85%A7%E5%9F%BA%E5%87%86%E5%92%8C%E5%9F%BA%E5%87%86%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.11.</span> <span class="toc-text">空间参照基准和基准属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9D%90%E6%A0%873D"><span class="toc-number">6.2.</span> <span class="toc-text">坐标3D</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E6%9E%81%E5%9D%90%E6%A0%87"><span class="toc-number">6.2.1.</span> <span class="toc-text">矢量极坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9F%A2%E9%87%8F%E5%80%BE%E8%A7%92"><span class="toc-number">6.2.2.</span> <span class="toc-text">获取矢量倾角</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9F%A2%E9%87%8F%E6%96%B9%E4%BD%8D%E8%A7%92"><span class="toc-number">6.2.3.</span> <span class="toc-text">获取矢量方位角</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E8%BF%90%E7%AE%97"><span class="toc-number">6.2.4.</span> <span class="toc-text">向量运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2D-%E7%9F%A2%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">6.2.5.</span> <span class="toc-text">2D 矢量操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text">生成器属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%B1%9E%E6%80%A7-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">生成器属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.4.</span> <span class="toc-text">地图点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.4.1.</span> <span class="toc-text">构造地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E7%94%9F%E6%88%90%E5%99%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">6.4.2.</span> <span class="toc-text">地图点生成器属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E6%98%AF%E5%B9%B3%E7%AD%89%E7%9A%84"><span class="toc-number">6.4.3.</span> <span class="toc-text">地图点是平等的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E6%8C%87%E5%AE%9A%E7%82%B9"><span class="toc-number">6.4.4.</span> <span class="toc-text">缩放至指定点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E7%BA%BF"><span class="toc-number">6.5.</span> <span class="toc-text">折线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%8A%98%E7%BA%BF-%E4%BB%8E%E6%98%A0%E5%B0%84%E7%82%B9%E7%9A%84%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.5.1.</span> <span class="toc-text">构造折线 - 从映射点的枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%98%E7%BA%BF%E7%9A%84%E7%82%B9"><span class="toc-number">6.5.2.</span> <span class="toc-text">获取折线的点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%98%E7%BA%BF%E7%9A%84%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-number">6.5.3.</span> <span class="toc-text">获取折线的各个部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E6%8A%98%E7%BA%BF%E7%9A%84%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-number">6.5.4.</span> <span class="toc-text">枚举折线的各个部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E8%BD%AC%E6%8A%98%E7%BA%BF%E4%B8%AD%E7%82%B9%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-number">6.5.5.</span> <span class="toc-text">反转折线中点的顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%98%E7%BA%BF%E7%9A%84%E6%AE%B5"><span class="toc-number">6.5.6.</span> <span class="toc-text">获取折线的段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%83%A8%E5%88%86%E6%8A%98%E7%BA%BF"><span class="toc-number">6.5.7.</span> <span class="toc-text">构建多部分折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%98%E7%BA%BF%E7%9A%84%E8%B5%B7%E7%82%B9"><span class="toc-number">6.5.8.</span> <span class="toc-text">折线的起点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E8%A7%92%E5%BA%A6%E6%9E%84%E9%80%A0%E5%B8%83%E6%96%99"><span class="toc-number">6.5.9.</span> <span class="toc-text">按角度构造布料</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%95%BF%E5%BA%A6%E6%9E%84%E9%80%A0%E5%B8%83%E6%96%99"><span class="toc-number">6.5.10.</span> <span class="toc-text">按长度构造布料</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E8%B7%9D%E7%A6%BB%E5%88%86%E5%89%B2%E6%8A%98%E7%BA%BF"><span class="toc-number">6.5.11.</span> <span class="toc-text">远距离分割折线</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.6.</span> <span class="toc-text">多边形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%A4%9A%E8%BE%B9%E5%BD%A2-%E4%BB%8E%E6%98%A0%E5%B0%84%E7%82%B9%E7%9A%84%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.6.1.</span> <span class="toc-text">构造多边形 - 从映射点的枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%A4%9A%E8%BE%B9%E5%BD%A2-%E4%BB%8E%E4%BF%A1%E5%B0%81"><span class="toc-number">6.6.2.</span> <span class="toc-text">构造多边形 - 从信封</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E7%82%B9"><span class="toc-number">6.6.3.</span> <span class="toc-text">获取多边形的点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-number">6.6.4.</span> <span class="toc-text">获取多边形的各个部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-number">6.6.5.</span> <span class="toc-text">枚举多边形的各个部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E7%BA%BF%E6%AE%B5"><span class="toc-number">6.6.6.</span> <span class="toc-text">获取多边形的线段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%9C%86%E7%8E%AF%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.6.7.</span> <span class="toc-text">构建圆环多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-N-%E4%BE%A7%E6%AD%A3%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.6.8.</span> <span class="toc-text">创建 N 侧正多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E5%A4%96%E7%8E%AF-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E3%80%82%E8%8E%B7%E5%8F%96%E5%A4%96%E9%83%A8%E7%8E%AF"><span class="toc-number">6.6.9.</span> <span class="toc-text">获取多边形的外环 - 多边形。获取外部环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%B0%81"><span class="toc-number">6.7.</span> <span class="toc-text">信封</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%B0%81%E5%A5%97"><span class="toc-number">6.7.1.</span> <span class="toc-text">构造封套</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E4%BF%A1%E5%B0%81-%E4%BB%8E-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.7.2.</span> <span class="toc-text">构造信封 - 从 JSON 字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E4%BF%A1%E5%B0%81"><span class="toc-number">6.7.3.</span> <span class="toc-text">合并两个信封</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E4%B8%A4%E4%B8%AA%E4%BF%A1%E5%B0%81%E7%9B%B8%E4%BA%A4"><span class="toc-number">6.7.4.</span> <span class="toc-text">与两个信封相交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E5%BC%80%E4%BF%A1%E5%B0%81"><span class="toc-number">6.7.5.</span> <span class="toc-text">展开信封</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%B0%81%E5%A5%97%E7%9A%84%E5%9D%90%E6%A0%87"><span class="toc-number">6.7.6.</span> <span class="toc-text">更新封套的坐标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%82%B9"><span class="toc-number">6.8.</span> <span class="toc-text">多点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%A4%9A%E7%82%B9-%E4%BB%8E%E6%98%A0%E5%B0%84%E7%82%B9%E7%9A%84%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.8.1.</span> <span class="toc-text">构造多点 - 从映射点的枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%A4%9A%E7%82%B9-%E4%BD%BF%E7%94%A8-MultipointBuilderEx"><span class="toc-number">6.8.2.</span> <span class="toc-text">构造多点 - 使用 MultipointBuilderEx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%9A%E7%82%B9%E7%9A%84%E7%82%B9"><span class="toc-number">6.8.3.</span> <span class="toc-text">修改多点的点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%A4%9A%E7%82%B9%E6%A3%80%E7%B4%A2%E7%82%B9%E3%80%812D-%E5%9D%90%E6%A0%87%E3%80%813D-%E5%9D%90%E6%A0%87"><span class="toc-number">6.8.4.</span> <span class="toc-text">从多点检索点、2D 坐标、3D 坐标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5"><span class="toc-number">6.9.</span> <span class="toc-text">线段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AA%E5%9C%B0%E5%9B%BE%E7%82%B9%E6%9E%84%E9%80%A0%E7%BA%BF%E6%AE%B5"><span class="toc-number">6.9.1.</span> <span class="toc-text">使用两个地图点构造线段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%BA%BF%E6%AE%B5%E5%9D%90%E6%A0%87"><span class="toc-number">6.9.2.</span> <span class="toc-text">更改线段坐标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%8B%E6%96%B9%E8%B4%9D%E5%A1%9E%E5%B0%94"><span class="toc-number">6.10.</span> <span class="toc-text">立方贝塞尔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%89%E6%AC%A1%E6%96%B9%E8%B4%9D%E5%A1%9E%E5%B0%94-%E4%BB%8E%E5%9D%90%E6%A0%87"><span class="toc-number">6.10.1.</span> <span class="toc-text">构建三次方贝塞尔 - 从坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%AB%8B%E6%96%B9%E8%B4%9D%E5%A1%9E%E5%B0%94-%E4%BB%8E%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.10.2.</span> <span class="toc-text">构建立方贝塞尔 - 从地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94-%E4%BB%8E%E6%98%A0%E5%B0%84%E7%82%B9%E7%9A%84%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.10.3.</span> <span class="toc-text">构造三次贝塞尔 - 从映射点的枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%8B%E6%96%B9%E8%B4%9D%E5%A1%9E%E5%B0%94%E7%94%9F%E6%88%90%E5%99%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">6.10.4.</span> <span class="toc-text">立方贝塞尔生成器属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%8B%E6%96%B9%E8%B4%9D%E5%A1%9E%E5%B0%94%E5%B1%9E%E6%80%A7"><span class="toc-number">6.10.5.</span> <span class="toc-text">立方贝塞尔属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%8A%98%E7%BA%BF-%E4%BB%8E%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94"><span class="toc-number">6.10.6.</span> <span class="toc-text">构造折线 - 从三次贝塞尔</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A7"><span class="toc-number">6.11.</span> <span class="toc-text">弧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E5%86%85%E9%83%A8%E7%82%B9"><span class="toc-number">6.11.1.</span> <span class="toc-text">构造圆弧 - 使用内部点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E5%BC%A6%E9%95%BF%E5%BA%A6%E5%92%8C%E6%96%B9%E4%BD%8D"><span class="toc-number">6.11.2.</span> <span class="toc-text">构造圆弧 - 使用弦长度和方位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%BF%83%E7%82%B9%E3%80%81%E8%A7%92%E5%BA%A6%E5%92%8C%E5%8D%8A%E5%BE%84"><span class="toc-number">6.11.3.</span> <span class="toc-text">构建圆弧 - 使用中心点、角度和半径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%A4%AD%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%BF%83%E7%82%B9%E5%92%8C%E6%97%8B%E8%BD%AC%E8%A7%92%E5%BA%A6"><span class="toc-number">6.11.4.</span> <span class="toc-text">构造椭圆弧 - 使用中心点和旋转角度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%BF%83%E7%82%B9%E5%92%8C%E6%96%B9%E5%90%91"><span class="toc-number">6.11.5.</span> <span class="toc-text">构造圆弧 - 使用中心点和方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%9C%86%E5%BC%A7-%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AA%E7%BA%BF%E6%AE%B5%E5%92%8C%E5%8D%8A%E5%BE%84"><span class="toc-number">6.11.6.</span> <span class="toc-text">构造圆弧 - 使用两个线段和半径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E5%9C%86"><span class="toc-number">6.11.7.</span> <span class="toc-text">构造一个圆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%A4%AD%E5%9C%86"><span class="toc-number">6.11.8.</span> <span class="toc-text">构造椭圆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Elliptic-Arc-Builder-Properties"><span class="toc-number">6.11.9.</span> <span class="toc-text">Elliptic Arc Builder Properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A4%AD%E5%9C%86%E5%BC%A7%E5%B1%9E%E6%80%A7"><span class="toc-number">6.11.10.</span> <span class="toc-text">椭圆弧属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E8%A2%8B"><span class="toc-number">6.12.</span> <span class="toc-text">几何袋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%A0%E4%BD%95%E5%8C%85"><span class="toc-number">6.12.1.</span> <span class="toc-text">构造几何包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%A0%E4%BD%95%E5%8C%85-%E4%BB%8E%E5%87%A0%E4%BD%95%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.12.2.</span> <span class="toc-text">构造几何包 - 从几何枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConstructingGeometryBag-%E6%9D%A5%E8%87%AA-JSON%E3%80%81Xml"><span class="toc-number">6.12.3.</span> <span class="toc-text">ConstructingGeometryBag - 来自 JSON、Xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%A0%E4%BD%95%E5%8C%85-%E6%B7%BB%E5%8A%A0%E6%88%96%E6%8F%92%E5%85%A5%E5%87%A0%E4%BD%95%E6%9E%9A%E4%B8%BE"><span class="toc-number">6.12.4.</span> <span class="toc-text">构造几何包 - 添加或插入几何枚举</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.</span> <span class="toc-text">多面体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%8B%89%E4%BC%B8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%88%96%E6%8A%98%E7%BA%BF%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.1.</span> <span class="toc-text">通过拉伸多边形或折线构建多面体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%9D%A2%E4%BD%93%E5%B1%9E%E6%80%A7"><span class="toc-number">6.13.2.</span> <span class="toc-text">多面体属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.3.</span> <span class="toc-text">构建多面体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87MultipatchBuilderEx%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.4.</span> <span class="toc-text">通过MultipatchBuilderEx构建多面体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%A4%9A%E9%9D%A2%E4%BD%93%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.5.</span> <span class="toc-text">从另一个多面体构建多面体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-3D-%E6%A8%A1%E5%9E%8B%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA%E5%A4%9A%E9%9D%A2%E4%BD%93"><span class="toc-number">6.13.6.</span> <span class="toc-text">从 3D 模型文件构建多面体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA-3D-%E7%89%B9%E6%AE%8A%E5%A4%9A%E9%9D%A2%E4%BD%93%E5%BD%A2%E7%8A%B6"><span class="toc-number">6.13.7.</span> <span class="toc-text">构建 3D 特殊多面体形状</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E6%9D%90%E6%96%99"><span class="toc-number">6.13.8.</span> <span class="toc-text">创建基本材料</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JPEG-%E7%BA%B9%E7%90%86%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E6%9D%90%E8%B4%A8"><span class="toc-number">6.13.9.</span> <span class="toc-text">使用 JPEG 纹理创建基本材质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%AA%E5%8E%8B%E7%BC%A9%E7%BA%B9%E7%90%86%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E6%9D%90%E8%B4%A8"><span class="toc-number">6.13.10.</span> <span class="toc-text">使用未压缩纹理创建基本材质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E9%9D%A2%E4%BD%93%E7%9A%84%E7%BA%B9%E7%90%86%E5%9B%BE%E5%83%8F"><span class="toc-number">6.13.11.</span> <span class="toc-text">获取多面体的纹理图像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E9%9D%A2%E4%BD%93%E7%9A%84%E6%B3%95%E7%BA%BF%E5%9D%90%E6%A0%87"><span class="toc-number">6.13.12.</span> <span class="toc-text">获取多面体的法线坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E9%9D%A2%E4%BD%93%E7%9A%84%E6%B3%95%E7%BA%BF"><span class="toc-number">6.13.13.</span> <span class="toc-text">获取多面体的法线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E9%9D%A2%E4%BD%93%E7%9A%84%E6%9D%90%E8%B4%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">6.13.14.</span> <span class="toc-text">获取多面体的材质属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%83%A8%E4%BB%B6"><span class="toc-number">6.14.</span> <span class="toc-text">多部件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E9%83%A8%E5%88%86%E8%A6%81%E7%B4%A0%E7%9A%84%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-number">6.14.1.</span> <span class="toc-text">获取多部分要素的各个部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E6%9C%80%E5%A4%96%E5%B1%82%E7%8E%AF"><span class="toc-number">6.14.2.</span> <span class="toc-text">获取多边形的最外层环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A3%80%E7%B4%A2%E5%87%A0%E4%BD%95"><span class="toc-number">6.15.</span> <span class="toc-text">从地理数据库检索几何</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A3%80%E7%B4%A2%E5%87%A0%E4%BD%95-1"><span class="toc-number">6.15.1.</span> <span class="toc-text">从地理数据库检索几何</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E3%80%81%E5%AF%BC%E5%87%BA%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">6.16.</span> <span class="toc-text">导入、导出几何图形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E4%B8%BA%E5%B7%B2%E7%9F%A5%E6%96%87%E6%9C%AC"><span class="toc-number">6.16.1.</span> <span class="toc-text">将几何图形导入和导出为已知文本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E5%88%B0%E4%BC%97%E6%89%80%E5%91%A8%E7%9F%A5%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6"><span class="toc-number">6.16.2.</span> <span class="toc-text">将几何图形导入和导出到众所周知的二进制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E5%88%B0-EsriShape"><span class="toc-number">6.16.3.</span> <span class="toc-text">将几何导入和导出到 EsriShape</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E4%B8%BA-JSON"><span class="toc-number">6.16.4.</span> <span class="toc-text">将几何图形导入和导出为 JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E4%B8%BA-XML"><span class="toc-number">6.16.5.</span> <span class="toc-text">将几何图形导入和导出为 XML</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.17.</span> <span class="toc-text">转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%B0%E7%90%86%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.17.1.</span> <span class="toc-text">创建地理转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%8D%E5%90%88%E5%9C%B0%E7%90%86%E5%8F%98%E6%8D%A2"><span class="toc-number">6.17.2.</span> <span class="toc-text">创建复合地理变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8A%95%E5%BD%B1%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.17.3.</span> <span class="toc-text">创建投影转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8E%8B%E5%9F%BA%E5%87%86%E5%8F%98%E6%8D%A2"><span class="toc-number">6.17.4.</span> <span class="toc-text">创建高压基准变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%8D%E5%90%88%E9%AB%98%E5%8E%8B%E5%9F%BA%E5%87%86%E5%8F%98%E6%8D%A2"><span class="toc-number">6.17.5.</span> <span class="toc-text">创建复合高压基准变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.17.6.</span> <span class="toc-text">确定转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.18.</span> <span class="toc-text">地图点地理坐标字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9-%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.18.1.</span> <span class="toc-text">地图点 - 地理坐标字符串转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E5%8D%95%E5%85%83"><span class="toc-number">6.19.</span> <span class="toc-text">角度单元</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E5%8D%95%E4%BD%8D-%E5%9C%A8%E5%BA%A6%E5%92%8C%E5%BC%A7%E5%BA%A6%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.19.1.</span> <span class="toc-text">角度单位 - 在度和弧度之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E5%8D%95%E4%BD%8D-%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%8E%82%E4%BB%A3%E7%A0%81%E5%88%9B%E5%BB%BA%E8%A7%92%E5%BA%A6%E5%8D%95%E4%BD%8D"><span class="toc-number">6.19.2.</span> <span class="toc-text">角度单位 - 使用工厂代码创建角度单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E5%8D%95%E4%BD%8D-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%92%E5%BA%A6%E5%8D%95%E4%BD%8D"><span class="toc-number">6.19.3.</span> <span class="toc-text">角度单位 - 创建自定义角度单位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D"><span class="toc-number">6.20.</span> <span class="toc-text">线性单位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D-%E5%9C%A8%E8%8B%B1%E5%B0%BA%E5%92%8C%E7%B1%B3%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.20.1.</span> <span class="toc-text">线性单位 - 在英尺和米之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D-%E5%9C%A8%E5%8E%98%E7%B1%B3%E5%92%8C%E6%AF%AB%E7%B1%B3%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.20.2.</span> <span class="toc-text">线性单位 - 在厘米和毫米之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D-%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%8E%82%E4%BB%A3%E7%A0%81%E5%88%9B%E5%BB%BA%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D"><span class="toc-number">6.20.3.</span> <span class="toc-text">线性单位 - 使用工厂代码创建线性单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E6%80%A7%E5%8D%95%E4%BD%8D"><span class="toc-number">6.20.4.</span> <span class="toc-text">线性单位 - 创建自定义线性单位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D"><span class="toc-number">6.21.</span> <span class="toc-text">面积单位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D-%E5%9C%A8%E5%B9%B3%E6%96%B9%E8%8B%B1%E5%B0%BA%E5%92%8C%E5%B9%B3%E6%96%B9%E7%B1%B3%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.21.1.</span> <span class="toc-text">面积单位 - 在平方英尺和平方米之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D-%E5%9C%A8%E5%85%AC%E9%A1%B7%E5%92%8C%E8%8B%B1%E4%BA%A9%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.21.2.</span> <span class="toc-text">面积单位 - 在公顷和英亩之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D-%E5%9C%A8%E5%85%AC%E9%A1%B7%E5%92%8C%E5%B9%B3%E6%96%B9%E8%8B%B1%E9%87%8C%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.21.3.</span> <span class="toc-text">面积单位 - 在公顷和平方英里之间转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D-%E5%90%84%E7%A7%8D%E5%8D%95%E4%BD%8D%E7%9A%84%E5%B9%B3%E6%96%B9%E7%B1%B3%E6%95%B0"><span class="toc-number">6.21.4.</span> <span class="toc-text">面积单位 - 各种单位的平方米数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D-%E5%88%9B%E5%BB%BA%E9%9D%A2%E7%A7%AF%E5%8D%95%E4%BD%8D"><span class="toc-number">6.21.5.</span> <span class="toc-text">面积单位 - 创建面积单位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E5%BC%95%E6%93%8E%E5%87%BD%E6%95%B0"><span class="toc-number">6.22.</span> <span class="toc-text">几何引擎函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E9%80%9F%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">6.22.1.</span> <span class="toc-text">加速几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E9%9D%A2%E7%9A%84%E9%9D%A2%E7%A7%AF"><span class="toc-number">6.22.2.</span> <span class="toc-text">确定面的面积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%A4%9A%E9%83%A8%E5%88%86%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E8%BE%B9%E7%95%8C"><span class="toc-number">6.22.3.</span> <span class="toc-text">确定多部分多边形的边界</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.22.4.</span> <span class="toc-text">缓冲地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%9C%86%E5%BC%A7"><span class="toc-number">6.22.5.</span> <span class="toc-text">缓冲圆弧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%A4%9A%E4%B8%AA%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.22.6.</span> <span class="toc-text">缓冲多个地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%A4%9A%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.22.7.</span> <span class="toc-text">缓冲多种不同的几何类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%8A%98%E7%BA%BF%E4%B8%8A%E6%8F%92%E5%80%BC-Z-%E5%80%BC"><span class="toc-number">6.22.8.</span> <span class="toc-text">在折线上插值 Z 值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E4%B8%8A%E6%8F%92%E5%80%BC-M-%E5%80%BC"><span class="toc-number">6.22.9.</span> <span class="toc-text">在多边形上插值 M 值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%B0%81%E5%A5%97%E5%9C%A8-X%EF%BC%8CY-%E5%91%A8%E5%9B%B4%E5%B1%85%E4%B8%AD"><span class="toc-number">6.22.10.</span> <span class="toc-text">将封套在 X，Y 周围居中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E8%B4%A8%E5%BF%83"><span class="toc-number">6.22.11.</span> <span class="toc-text">查找几何体的质心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E8%A3%81%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.12.</span> <span class="toc-text">剪裁折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%A4%9A%E8%BE%B9%E5%BD%A2%E8%A3%81%E5%89%AA%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.13.</span> <span class="toc-text">按多边形裁剪折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E8%B7%9D%E7%A6%BB%E5%92%8C%E6%96%B9%E4%BD%8D%E8%A7%92%E7%9A%84%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E7%BA%BF"><span class="toc-number">6.22.14.</span> <span class="toc-text">构建具有指定距离和方位角的大地测量线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%BF%9E%E6%8E%A5%E7%82%B9%E7%9A%84%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E7%BA%BF"><span class="toc-number">6.22.15.</span> <span class="toc-text">构建连接点的大地测量线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%B7%9D%E7%8E%B0%E6%9C%89%E7%82%B9%E4%B8%80%E5%AE%9A%E8%B7%9D%E7%A6%BB%E5%92%8C%E4%B8%80%E5%AE%9A%E8%A7%92%E5%BA%A6%E5%A4%84%E6%9E%84%E9%80%A0%E7%82%B9"><span class="toc-number">6.22.16.</span> <span class="toc-text">在距现有点一定距离和一定角度处构造点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E4%B8%80%E7%BB%84%E6%8A%98%E7%BA%BF%E6%9E%84%E9%80%A0%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.17.</span> <span class="toc-text">从一组折线构造多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%8C%85%E5%90%AB%E5%9C%B0%E5%9B%BE%E7%82%B9%E3%80%81%E6%8A%98%E7%BA%BF%E3%80%81%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.18.</span> <span class="toc-text">多边形包含地图点、折线、多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%87%B8%E5%8C%85"><span class="toc-number">6.22.19.</span> <span class="toc-text">确定凸包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E6%98%AF%E5%90%A6%E7%9B%B8%E4%BA%A4"><span class="toc-number">6.22.20.</span> <span class="toc-text">确定两个几何图形是否相交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8A%98%E7%BA%BF%E5%88%87%E5%89%B2%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">6.22.21.</span> <span class="toc-text">使用折线切割几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%95%BF%E5%BA%A6%E8%87%B4%E5%AF%86"><span class="toc-number">6.22.22.</span> <span class="toc-text">按长度致密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2%E4%B9%8B%E9%97%B4%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-number">6.22.23.</span> <span class="toc-text">两个多边形之间的差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E6%98%AF%E5%90%A6%E4%B8%8D%E7%9B%B8%E4%BA%A4"><span class="toc-number">6.22.24.</span> <span class="toc-text">确定两个几何是否不相交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB"><span class="toc-number">6.22.25.</span> <span class="toc-text">确定两个几何之间的距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E4%BD%93%E4%B9%8B%E9%97%B4%E7%9A%84-3D-%E8%B7%9D%E7%A6%BB"><span class="toc-number">6.22.26.</span> <span class="toc-text">确定两个几何体之间的 3D 距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E5%BC%80%E4%BF%A1%E5%B0%81-1"><span class="toc-number">6.22.27.</span> <span class="toc-text">展开信封</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.28.</span> <span class="toc-text">扩展折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E6%8B%AC"><span class="toc-number">6.22.29.</span> <span class="toc-text">概括</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E9%9D%A2%E7%9A%84%E6%B5%8B%E5%9C%B0%E7%BA%BF%E9%9D%A2%E7%A7%AF"><span class="toc-number">6.22.30.</span> <span class="toc-text">计算面的测地线面积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E6%B5%8B%E5%9C%B0%E7%BA%BF%E8%B7%9D%E7%A6%BB%E5%A4%84%E5%88%9B%E5%BB%BA%E7%BC%93%E5%86%B2%E5%8C%BA%E9%9D%A2"><span class="toc-number">6.22.31.</span> <span class="toc-text">在指定的测地线距离处创建缓冲区面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E4%B9%8B%E9%97%B4%E7%9A%84%E6%B5%8B%E5%9C%B0%E7%BA%BF%E8%B7%9D%E7%A6%BB"><span class="toc-number">6.22.32.</span> <span class="toc-text">确定两个几何之间的测地线距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E5%9C%B0%E7%BA%BF%E6%A4%AD%E5%9C%86"><span class="toc-number">6.22.33.</span> <span class="toc-text">测地线椭圆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%BA%BF%E7%9A%84%E6%B5%8B%E5%9C%B0%E7%BA%BF%E9%95%BF%E5%BA%A6"><span class="toc-number">6.22.34.</span> <span class="toc-text">确定线的测地线长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E5%9C%B0%E7%BA%BF%E6%89%87%E5%8C%BA"><span class="toc-number">6.22.35.</span> <span class="toc-text">测地线扇区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E8%87%B4%E5%AF%86%E5%8C%96%E5%81%8F%E5%B7%AE-%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.36.</span> <span class="toc-text">大地测量致密化偏差 - 折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E8%87%B4%E5%AF%86%E6%8C%89%E9%95%BF%E5%BA%A6-%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.37.</span> <span class="toc-text">大地测量致密按长度 - 多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E8%B7%9D%E7%A6%BB%EF%BC%8C%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E6%96%B9%E4%BD%8D%E8%A7%92"><span class="toc-number">6.22.38.</span> <span class="toc-text">计算大地测量距离，两点之间的方位角</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%B8%80%E7%BB%84%E5%9C%B0%E5%9B%BE%E7%82%B9%E6%89%A7%E8%A1%8C%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E7%A7%BB%E5%8A%A8"><span class="toc-number">6.22.39.</span> <span class="toc-text">对一组地图点执行大地测量移动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-number">6.22.40.</span> <span class="toc-text">检索坐标系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E7%B3%BB%E7%BB%9F%E5%9C%B0%E7%90%86%E5%8F%98%E6%8D%A2"><span class="toc-number">6.22.41.</span> <span class="toc-text">检索系统地理变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%98%E7%BA%BF%E6%88%96%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E5%AD%90%E6%9B%B2%E7%BA%BF"><span class="toc-number">6.22.42.</span> <span class="toc-text">获取折线或多边形的子曲线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">6.22.43.</span> <span class="toc-text">图形缓冲区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%BC%93%E5%86%B2%E5%99%A8%E5%BE%88%E5%A4%9A"><span class="toc-number">6.22.44.</span> <span class="toc-text">图形缓冲器很多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E6%9D%A1%E6%8A%98%E7%BA%BF%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%A4%E7%82%B9"><span class="toc-number">6.22.45.</span> <span class="toc-text">两条折线之间的交点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%A4%E7%82%B9"><span class="toc-number">6.22.46.</span> <span class="toc-text">两个多边形之间的交点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E6%A0%87%E6%B3%A8%E7%82%B9"><span class="toc-number">6.22.47.</span> <span class="toc-text">确定多边形的标注点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%BA%BF%E7%9A%84%E9%95%BF%E5%BA%A6%EF%BC%8C%E9%95%BF%E5%BA%A63D"><span class="toc-number">6.22.48.</span> <span class="toc-text">确定线的长度，长度3D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%80%E5%B0%8F%E5%92%8C%E6%9C%80%E5%A4%A7-M-%E5%80%BC-GetMinMaxM"><span class="toc-number">6.22.49.</span> <span class="toc-text">获取最小和最大 M 值 - GetMinMaxM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A-M-%E6%98%AF%E5%8D%95%E8%B0%83%E7%9A%84%EF%BC%8C%E6%98%AF%E5%8D%87%E5%BA%8F%E8%BF%98%E6%98%AF%E9%99%8D%E5%BA%8F-GetMMonotonic"><span class="toc-number">6.22.50.</span> <span class="toc-text">确定 M 是单调的，是升序还是降序 - GetMMonotonic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E4%B8%AD%E6%8C%87%E5%AE%9A-M-%E5%80%BC%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE%E7%9B%B8%E5%AF%B9%E5%BA%94%E7%9A%84%E5%A4%9A%E7%82%B9-GetPointsAtM"><span class="toc-number">6.22.51.</span> <span class="toc-text">获取与几何图形中指定 M 值出现的位置相对应的多点 - GetPointsAtM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E6%8C%87%E5%AE%9A-M-%E5%80%BC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%AD%90%E6%9B%B2%E7%BA%BF%E5%AF%B9%E5%BA%94%E7%9A%84%E6%8A%98%E7%BA%BF-GetSubCurveBetweenMs"><span class="toc-number">6.22.52.</span> <span class="toc-text">获取与指定 M 值之间的子曲线对应的折线 - GetSubCurveBetweenMs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E6%B2%BF%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E4%B8%AD%E5%87%BA%E7%8E%B0%E6%8C%87%E5%AE%9A-M-%E5%80%BC%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%A4%84%E7%9A%84%E6%B3%95%E7%BA%BF%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BA%BF%E6%AE%B5-GetNormalsAtM"><span class="toc-number">6.22.53.</span> <span class="toc-text">获取与沿几何图形中出现指定 M 值的位置处的法线对应的线段 - GetNormalsAtM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B2%BF%E5%A4%9A%E9%83%A8%E5%88%86%E7%9A%84%E6%8C%87%E5%AE%9A%E8%B7%9D%E7%A6%BB%E5%A4%84%E7%9A%84-M-%E5%80%BC"><span class="toc-number">6.22.54.</span> <span class="toc-text">获取沿多部分的指定距离处的 M 值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-M-%E5%80%BC%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%BB%8E%E5%A4%9A%E9%83%A8%E5%88%86%E5%BC%80%E5%A7%8B%E7%9A%84%E7%B4%AF%E7%A7%AF%E9%95%BF%E5%BA%A6-SetMsAsDistance"><span class="toc-number">6.22.55.</span> <span class="toc-text">将 M 值设置为从多部分开始的累积长度 - SetMsAsDistance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BB%99%E5%AE%9A%E8%B7%9D%E7%A6%BB%E5%A4%84%E6%8F%92%E5%85%A5-M-%E5%80%BC-%E6%8F%92%E5%85%A5%E8%B7%9D%E7%A6%BB"><span class="toc-number">6.22.56.</span> <span class="toc-text">在给定距离处插入 M 值 - 插入距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BE%93%E5%85%A5%E7%82%B9%E7%9A%84-M-%E5%80%BC%E6%A0%A1%E5%87%86-M-%E5%80%BC-CalibrateByMs"><span class="toc-number">6.22.57.</span> <span class="toc-text">使用输入点的 M 值校准 M 值 - CalibrateByMs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%AF%B9%E4%B8%80%E7%B3%BB%E5%88%97%E7%82%B9%E8%BF%9B%E8%A1%8C%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC%E7%94%9F%E6%88%90-M-%E5%80%BC-%E6%8F%92%E5%80%BCMsBetween"><span class="toc-number">6.22.58.</span> <span class="toc-text">通过对一系列点进行线性插值生成 M 值 - 插值MsBetween</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E7%9A%84%E5%BC%80%E5%A4%B4%E5%92%8C%E7%BB%93%E5%B0%BE%E8%AE%BE%E7%BD%AE-Ms%EF%BC%8C%E5%B9%B6%E5%9C%A8%E4%B8%A4%E4%B8%AA%E5%80%BC%E4%B9%8B%E9%97%B4%E6%8F%92%E5%80%BC-M-%E5%80%BC-SetAndIntervalateMsBetween"><span class="toc-number">6.22.59.</span> <span class="toc-text">在几何图形的开头和结尾设置 Ms，并在两个值之间插值 M 值 - SetAndIntervalateMsBetween</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.22.60.</span> <span class="toc-text">移动地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8-z-%E6%84%9F%E7%9F%A5%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.22.61.</span> <span class="toc-text">移动 z 感知地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.62.</span> <span class="toc-text">移动折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%82%B9%E6%B2%BF%E7%BA%BF"><span class="toc-number">6.22.63.</span> <span class="toc-text">移动点沿线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E7%BB%84%E4%BB%B6%E5%88%86%E7%A6%BB%E4%B8%BA%E5%8D%95%E4%B8%AA%E7%BB%84%E4%BB%B6%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">6.22.64.</span> <span class="toc-text">将几何体的组件分离为单个组件几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E8%BF%91%E7%82%B9%E4%B8%8E%E6%9C%80%E8%BF%91%E9%A1%B6%E7%82%B9"><span class="toc-number">6.22.65.</span> <span class="toc-text">最近点与最近顶点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A-3D-%E4%B8%AD%E7%9A%84%E6%9C%80%E8%BF%91%E7%82%B9"><span class="toc-number">6.22.66.</span> <span class="toc-text">确定 3D 中的最近点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E4%B8%8E%E6%BA%90%E7%9A%84%E5%87%A0%E4%BD%95%E5%81%8F%E7%A7%BB"><span class="toc-number">6.22.67.</span> <span class="toc-text">计算与源的几何偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E6%98%AF%E5%90%A6%E9%87%8D%E5%8F%A0"><span class="toc-number">6.22.68.</span> <span class="toc-text">确定几何图形是否重叠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-WGS84-%E5%88%B0-Web%E5%A2%A8%E5%8D%A1%E6%89%98%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.22.69.</span> <span class="toc-text">从 WGS84 到 Web墨卡托的项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WGS84%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.22.70.</span> <span class="toc-text">WGS84的项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%AD%A3%E5%B8%B8"><span class="toc-number">6.22.71.</span> <span class="toc-text">查询正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%82%B9"><span class="toc-number">6.22.72.</span> <span class="toc-text">查询点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%82%B9%E5%92%8C%E8%B7%9D%E7%A6%BB"><span class="toc-number">6.22.73.</span> <span class="toc-text">查询点和距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%87%E7%BA%BF"><span class="toc-number">6.22.74.</span> <span class="toc-text">查询切线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%B4%E7%BB%95%E7%BA%BF%E5%8F%8D%E5%B0%84%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.75.</span> <span class="toc-text">围绕线反射多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%A4%E4%B8%AA%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">6.22.76.</span> <span class="toc-text">确定两个几何图形之间的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%A4%9A%E8%BE%B9%E5%BD%A2%E4%B8%AD%E7%9A%84-NaN-Z"><span class="toc-number">6.22.77.</span> <span class="toc-text">替换多边形中的 NaN Z</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E5%BD%A2%E7%8A%B6"><span class="toc-number">6.22.78.</span> <span class="toc-text">改变多边形的形状</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E8%BD%AC%E5%A4%9A%E8%BE%B9%E5%BD%A2%E4%B8%AD%E7%82%B9%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-number">6.22.79.</span> <span class="toc-text">反转多边形中点的顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E5%9C%B0%E5%9B%BE%E7%82%B9"><span class="toc-number">6.22.80.</span> <span class="toc-text">旋转地图点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.81.</span> <span class="toc-text">旋转折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">6.22.82.</span> <span class="toc-text">缩放几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%8A%98%E7%BA%BF%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89-Z"><span class="toc-number">6.22.83.</span> <span class="toc-text">设置折线中的所有 Z</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%9C%B0%E7%90%83%E6%A4%AD%E7%90%83%E4%BD%93%E8%A1%A8%E9%9D%A2%E4%B8%8A%E7%9A%84%E5%87%A0%E4%BD%95%E9%9D%A2%E7%A7%AF-%E5%BD%A2%E7%8A%B6%E4%BF%9D%E5%AD%98%E9%9D%A2%E7%A7%AF"><span class="toc-number">6.22.84.</span> <span class="toc-text">计算地球椭球体表面上的几何面积 - 形状保存面积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%9C%B0%E7%90%83%E6%A4%AD%E7%90%83%E4%BD%93%E8%A1%A8%E9%9D%A2%E5%87%A0%E4%BD%95%E5%BD%A2%E7%8A%B6%E7%9A%84%E9%95%BF%E5%BA%A6-%E5%BD%A2%E7%8A%B6%E4%BF%9D%E5%AD%98%E9%95%BF%E5%BA%A6"><span class="toc-number">6.22.85.</span> <span class="toc-text">计算地球椭球体表面几何形状的长度 - 形状保存长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%A7%E7%BC%93%E5%86%B2%E5%99%A8"><span class="toc-number">6.22.86.</span> <span class="toc-text">侧缓冲器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%A7%E7%BC%93%E5%86%B2%E5%99%A8%E5%BE%88%E5%A4%9A"><span class="toc-number">6.22.87.</span> <span class="toc-text">侧缓冲器很多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8C%96%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.88.</span> <span class="toc-text">简化多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8C%96%E5%85%B7%E6%9C%89%E7%9B%B8%E4%BA%A4%E3%80%81%E9%87%8D%E5%8F%A0%E7%9A%84%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.89.</span> <span class="toc-text">简化具有相交、重叠的折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%88%87%E6%88%90%E7%9B%B8%E7%AD%89%E7%9A%84%E9%83%A8%E5%88%86"><span class="toc-number">6.22.90.</span> <span class="toc-text">将多边形切成相等的部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%82%B9%E6%8B%86%E5%88%86%E5%A4%9A%E9%83%A8%E5%88%86"><span class="toc-number">6.22.91.</span> <span class="toc-text">在点拆分多部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%8E%A5%E8%A7%A6%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.92.</span> <span class="toc-text">多边形接触另一个多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A22D"><span class="toc-number">6.22.93.</span> <span class="toc-text">转换2D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A23D"><span class="toc-number">6.22.94.</span> <span class="toc-text">转换3D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E5%9C%B0%E5%9B%BE%E7%82%B9-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%9A%E7%82%B9"><span class="toc-number">6.22.95.</span> <span class="toc-text">合并两个地图点 - 创建一个多点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E9%9B%86%E4%B8%A4%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.96.</span> <span class="toc-text">并集两个多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E8%AE%B8%E5%A4%9A%E6%8A%98%E7%BA%BF"><span class="toc-number">6.22.97.</span> <span class="toc-text">联合许多折线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E5%A4%9A%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.98.</span> <span class="toc-text">联合多个多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E3%80%81%E6%8A%98%E7%BA%BF%E3%80%81%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85%E7%9A%84%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">6.22.99.</span> <span class="toc-text">地图点、折线、多边形内的多边形</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">地理处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84"><span class="toc-number">7.1.</span> <span class="toc-text">常规</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7"><span class="toc-number">7.1.1.</span> <span class="toc-text">如何执行模型工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E8%8C%83%E5%9B%B4%E7%8E%AF%E5%A2%83"><span class="toc-number">7.1.2.</span> <span class="toc-text">设置地理处理范围环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E7%AA%97%E6%A0%BC%E4%B8%AD%E6%89%93%E5%BC%80%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">7.1.3.</span> <span class="toc-text">在地理处理窗格中打开脚本工具对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.1.4.</span> <span class="toc-text">获取地理处理工程项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E6%AD%A2%E4%BD%BF%E7%94%A8-GP-%E5%88%9B%E5%BB%BA%E7%9A%84%E8%A6%81%E7%B4%A0%E7%B1%BB%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">7.1.5.</span> <span class="toc-text">阻止使用 GP 创建的要素类自动添加到地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPExecuteToolFlags-AddToHistory-%E4%BC%9A%E5%B0%86%E6%89%A7%E8%A1%8C%E6%B6%88%E6%81%AF%E6%B7%BB%E5%8A%A0%E5%88%B0-Hisotry"><span class="toc-number">7.1.6.</span> <span class="toc-text">GPExecuteToolFlags.AddToHistory 会将执行消息添加到 Hisotry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%8E%AF%E7%BC%93%E5%86%B2%E5%99%A8"><span class="toc-number">7.1.7.</span> <span class="toc-text">多环缓冲器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E7%9A%84%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%89%A7%E8%A1%8C"><span class="toc-number">7.1.8.</span> <span class="toc-text">地理处理工具的非阻塞执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%A0%E9%80%92%E5%85%B7%E6%9C%89%E5%A4%9A%E4%B8%AA%E6%88%96%E5%A4%8D%E6%9D%82%E8%BE%93%E5%85%A5%E5%80%BC%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">7.1.9.</span> <span class="toc-text">如何传递具有多个或复杂输入值的参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E9%80%89%E9%A1%B9"><span class="toc-number">7.2.</span> <span class="toc-text">地理处理选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E9%80%89%E9%A1%B9"><span class="toc-number">7.2.1.</span> <span class="toc-text">获取地理处理选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9C%B0%E7%90%86%E5%A4%84%E7%90%86%E9%80%89%E9%A1%B9"><span class="toc-number">7.2.2.</span> <span class="toc-text">设置地理处理选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">8.</span> <span class="toc-text">图形图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84-1"><span class="toc-number">8.1.</span> <span class="toc-text">常规</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">8.1.1.</span> <span class="toc-text">创建图形图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%BD%A2%E5%B1%82"><span class="toc-number">8.1.2.</span> <span class="toc-text">访问图形层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.1.3.</span> <span class="toc-text">复制图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.1.4.</span> <span class="toc-text">删除图形元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.</span> <span class="toc-text">创建图形元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E7%9A%84%E7%82%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.1.</span> <span class="toc-text">使用 CIMG 图形元素的点图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E7%9A%84%E7%BA%BF%E6%9D%A1%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.2.</span> <span class="toc-text">使用 CIMG 的线条图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E7%9A%84%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.3.</span> <span class="toc-text">使用 CIMG 的多边形图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E7%9A%84%E5%A4%9A%E7%82%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.4.</span> <span class="toc-text">使用 CIMG 的多点图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMSymbol-%E7%9A%84%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.5.</span> <span class="toc-text">使用 CIMSymbol 的图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.6.</span> <span class="toc-text">文本图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%9B%BE%E5%BD%A2%E5%88%9B%E5%BB%BA"><span class="toc-number">8.2.7.</span> <span class="toc-text">批量图形创建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9"><span class="toc-number">8.3.</span> <span class="toc-text">图形元素选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.3.1.</span> <span class="toc-text">选择图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.3.2.</span> <span class="toc-text">查找图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82%E4%B8%AD%E5%85%83%E7%B4%A0%E7%9A%84%E7%A9%BA%E9%97%B4%E9%80%89%E6%8B%A9"><span class="toc-number">8.3.3.</span> <span class="toc-text">所有图形图层中元素的空间选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82%E4%B8%AD%E5%AF%B9%E5%85%83%E7%B4%A0%E8%BF%9B%E8%A1%8C%E7%A9%BA%E9%97%B4%E9%80%89%E6%8B%A9"><span class="toc-number">8.3.4.</span> <span class="toc-text">在一个图形图层中对元素进行空间选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.3.5.</span> <span class="toc-text">选择文本图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E9%80%89%E6%8B%A9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.3.6.</span> <span class="toc-text">取消选择图形元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E4%BA%8B%E4%BB%B6"><span class="toc-number">8.4.</span> <span class="toc-text">图形元素事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E6%9B%B4%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">8.4.1.</span> <span class="toc-text">订阅元素选择更改事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E5%92%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">8.5.</span> <span class="toc-text">对图形元素进行分组和排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.5.1.</span> <span class="toc-text">组图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E7%BB%84%E5%90%88%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.5.2.</span> <span class="toc-text">取消组合图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%85%83%E7%B4%A0%E7%9A%84%E7%88%B6%E7%BA%A7"><span class="toc-number">8.5.3.</span> <span class="toc-text">组元素的父级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%EF%BC%9A%E5%90%91%E5%90%8E%E5%8F%91%E9%80%81%E5%92%8C%E5%90%91%E5%89%8D%E5%8F%91%E9%80%81"><span class="toc-number">8.5.4.</span> <span class="toc-text">排序：向后发送和向前发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Z-%E9%A1%BA%E5%BA%8F"><span class="toc-number">8.5.5.</span> <span class="toc-text">获取 Z 顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.6.</span> <span class="toc-text">修改图形元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">8.6.1.</span> <span class="toc-text">移动图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number">8.6.2.</span> <span class="toc-text">修改图形元素的符号系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%83%E5%B1%80"><span class="toc-number">9.</span> <span class="toc-text">布局</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">9.1.</span> <span class="toc-text">布局项目项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%B8%83%E5%B1%80%E9%A1%B9%E7%9B%AE%E9%A1%B9%E5%8F%8A%E5%85%B6%E5%85%B3%E8%81%94%E5%B8%83%E5%B1%80"><span class="toc-number">9.1.1.</span> <span class="toc-text">参考布局项目项及其关联布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%96%B0%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%89%93%E5%BC%80%E5%B8%83%E5%B1%80%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">9.1.2.</span> <span class="toc-text">在新视图中打开布局项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E5%B7%B2%E6%89%93%E5%BC%80%E7%9A%84%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE"><span class="toc-number">9.1.3.</span> <span class="toc-text">激活已打开的布局视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%B4%BB%E5%8A%A8%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE"><span class="toc-number">9.1.4.</span> <span class="toc-text">引用活动布局视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-pagx-%E5%AF%BC%E5%85%A5%E5%88%B0%E9%A1%B9%E7%9B%AE%E4%B8%AD"><span class="toc-number">9.1.5.</span> <span class="toc-text">将 pagx 导入到项目中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%B8%83%E5%B1%80%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">9.1.6.</span> <span class="toc-text">删除布局项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80%E5%B9%B6%E5%B0%86%E5%85%B6%E6%89%93%E5%BC%80"><span class="toc-number">9.1.7.</span> <span class="toc-text">创建新的基本布局并将其打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84-CIM-%E5%88%9B%E5%BB%BA%E6%96%B0%E5%B8%83%E5%B1%80%E5%B9%B6%E5%B0%86%E5%85%B6%E6%89%93%E5%BC%80"><span class="toc-number">9.1.8.</span> <span class="toc-text">使用修改后的 CIM 创建新布局并将其打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%B8%83%E5%B1%80%E9%A1%B5%E9%9D%A2%E5%A4%A7%E5%B0%8F"><span class="toc-number">9.1.9.</span> <span class="toc-text">更改布局页面大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProSnippet-Group-CIM-Graphics-and-GraphicFactory"><span class="toc-number">9.1.10.</span> <span class="toc-text">ProSnippet Group CIM Graphics and GraphicFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%86%E5%BD%A2%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.11.</span> <span class="toc-text">创建圆形图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%86%E5%BD%A2%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.12.</span> <span class="toc-text">创建圆形文本图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B4%9D%E5%A1%9E%E5%B0%94%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.13.</span> <span class="toc-text">创建贝塞尔图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E4%BE%8B%E5%9B%BE%E9%9D%A2%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.14.</span> <span class="toc-text">创建图例图面图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AE%AD%E5%A4%B4%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.15.</span> <span class="toc-text">创建箭头图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E7%89%87%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.1.16.</span> <span class="toc-text">创建图片图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%83%E5%B1%80%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.</span> <span class="toc-text">创建布局图形元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A4%AD%E5%9C%86%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.1.</span> <span class="toc-text">创建椭圆图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A5%97%E7%B4%A2%E7%BA%BF%EF%BC%8C%E6%89%8B%E7%BB%98%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.2.</span> <span class="toc-text">创建套索线，手绘图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A5%97%E7%B4%A2%E5%A4%9A%E8%BE%B9%E5%BD%A2%EF%BC%8C%E6%89%8B%E7%BB%98%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.3.</span> <span class="toc-text">创建套索多边形，手绘元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.4.</span> <span class="toc-text">创建线元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%82%B9%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.5.</span> <span class="toc-text">创建点元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.6.</span> <span class="toc-text">创建多边形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9F%A9%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.7.</span> <span class="toc-text">创建矩形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.8.</span> <span class="toc-text">创建贝塞尔曲线元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.2.9.</span> <span class="toc-text">创建图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.10.</span> <span class="toc-text">使用 CIMG 创建图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMSymbol-%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.11.</span> <span class="toc-text">使用 CIMSymbol 创建图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%85%83%E7%B4%A0%E5%88%9B%E5%BB%BA"><span class="toc-number">9.2.12.</span> <span class="toc-text">批量元素创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMG-%E5%88%9B%E5%BB%BA%E5%85%83%E7%B4%A0"><span class="toc-number">9.2.13.</span> <span class="toc-text">使用 CIMG 创建元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA%E7%82%B9%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.2.14.</span> <span class="toc-text">使用符号系统创建点图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA%E7%BA%BF%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.2.15.</span> <span class="toc-text">使用符号系统创建线图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA%E7%9F%A9%E5%BD%A2%E5%9B%BE%E5%BD%A2"><span class="toc-number">9.2.16.</span> <span class="toc-text">使用简单符号系统创建矩形图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.</span> <span class="toc-text">创建文本图形元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%82%B9%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.3.1.</span> <span class="toc-text">创建点文本元素 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9F%A9%E5%BD%A2%E6%AE%B5%E8%90%BD%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.3.2.</span> <span class="toc-text">创建矩形段落文本元素 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E7%82%B9%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.3.</span> <span class="toc-text">创建动态点文本元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%82%B9%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0-2"><span class="toc-number">9.3.4.</span> <span class="toc-text">创建点文本元素 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%AE%B5%E8%90%BD%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.5.</span> <span class="toc-text">创建多边形段落文本元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9F%A9%E5%BD%A2%E6%AE%B5%E8%90%BD%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0-2"><span class="toc-number">9.3.6.</span> <span class="toc-text">创建矩形段落文本元素 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%86%E5%BD%A2%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.7.</span> <span class="toc-text">创建圆形文本元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.8.</span> <span class="toc-text">创建贝塞尔文本元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A4%AD%E5%9C%86%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0"><span class="toc-number">9.3.9.</span> <span class="toc-text">创建椭圆文本元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%92%8C%E7%AE%AD%E5%A4%B4"><span class="toc-number">9.4.</span> <span class="toc-text">创建预定义的形状和箭头</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.4.1.</span> <span class="toc-text">创建预定义的形状图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.4.2.</span> <span class="toc-text">创建预定义的形状图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0-2"><span class="toc-number">9.4.3.</span> <span class="toc-text">创建预定义的形状图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%AE%AD%E5%A4%B4%E5%85%83%E7%B4%A0"><span class="toc-number">9.4.4.</span> <span class="toc-text">创建线箭头元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%85%83%E7%B4%A0"><span class="toc-number">9.5.</span> <span class="toc-text">图片元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CIMSymbol-%E5%88%9B%E5%BB%BA%E5%9B%BE%E7%89%87%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0"><span class="toc-number">9.5.1.</span> <span class="toc-text">使用 CIMSymbol 创建图片图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%AB%98%E7%BA%A7%E7%AC%A6%E5%8F%B7%E8%AE%BE%E7%BD%AE%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%9B%BE%E7%89%87%E5%85%83%E7%B4%A0"><span class="toc-number">9.5.2.</span> <span class="toc-text">使用高级符号设置创建新的图片元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%B0%E5%9B%BE%E6%A1%86%E5%92%8C%E7%8E%AF%E7%BB%95%E8%A6%81%E7%B4%A0"><span class="toc-number">9.6.</span> <span class="toc-text">创建地图框和环绕要素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%B0%E5%9B%BE%E6%A1%86%E5%B9%B6%E8%AE%BE%E7%BD%AE%E7%85%A7%E7%9B%B8%E6%9C%BA"><span class="toc-number">9.6.1.</span> <span class="toc-text">创建地图框并设置照相机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E4%BE%8B"><span class="toc-number">9.6.2.</span> <span class="toc-text">创建图例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%B7%E5%BC%8F%E9%A1%B9%E5%88%9B%E5%BB%BA%E6%AF%94%E4%BE%8B%E5%B0%BA"><span class="toc-number">9.6.3.</span> <span class="toc-text">从样式项创建比例尺</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%B7%E5%BC%8F%E9%A1%B9-1-%E5%88%9B%E5%BB%BA%E6%8C%87%E5%8C%97%E9%92%88"><span class="toc-number">9.6.4.</span> <span class="toc-text">从样式项 1 创建指北针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%A0%BC%E6%A1%86"><span class="toc-number">9.6.5.</span> <span class="toc-text">创建表格框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%B0%E5%9B%BE%E6%A1%86-1"><span class="toc-number">9.6.6.</span> <span class="toc-text">创建地图框 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%B0%E5%9B%BE%E6%A1%86-2"><span class="toc-number">9.6.7.</span> <span class="toc-text">创建地图框 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E4%BE%8B-2"><span class="toc-number">9.6.8.</span> <span class="toc-text">创建图例 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%B7%E5%BC%8F%E9%A1%B9-2-%E5%88%9B%E5%BB%BA%E6%8C%87%E5%8C%97%E9%92%88"><span class="toc-number">9.6.9.</span> <span class="toc-text">从样式项 2 创建指北针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%A0%BC%E6%A1%86-1"><span class="toc-number">9.6.10.</span> <span class="toc-text">创建表格框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%AF%94%E4%BE%8B%E5%B0%BA"><span class="toc-number">9.6.11.</span> <span class="toc-text">创建比例尺</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%AF%94%E4%BE%8B%E7%BA%BF"><span class="toc-number">9.6.12.</span> <span class="toc-text">创建比例线</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%85%83%E7%B4%A0"><span class="toc-number">9.7.</span> <span class="toc-text">组元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A9%BA%E7%BB%84%E5%85%83%E7%B4%A0"><span class="toc-number">9.7.1.</span> <span class="toc-text">创建空组元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8C%85%E5%90%AB%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%84%E5%85%83%E7%B4%A0"><span class="toc-number">9.7.2.</span> <span class="toc-text">创建包含元素的组元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%85%83%E7%B4%A0%E5%92%8C%E9%80%89%E6%8B%A9"><span class="toc-number">9.8.</span> <span class="toc-text">布局元素和选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B8%83%E5%B1%80%E4%B8%8A%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.1.</span> <span class="toc-text">在布局上查找元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%B8%83%E5%B1%80%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.2.</span> <span class="toc-text">查找布局元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%85%83%E7%B4%A0%E5%B1%9E%E6%80%A7"><span class="toc-number">9.8.3.</span> <span class="toc-text">更新元素属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E8%AE%A1%E6%95%B0"><span class="toc-number">9.8.4.</span> <span class="toc-text">获取元素选择计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9"><span class="toc-number">9.8.5.</span> <span class="toc-text">设置元素选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E9%80%89%E6%8B%A9%E5%B8%83%E5%B1%80%E4%B8%8A%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.6.</span> <span class="toc-text">取消选择布局上的元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE%E4%B8%AD%E5%8F%96%E6%B6%88%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.7.</span> <span class="toc-text">在布局视图中取消选择元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">9.8.8.</span> <span class="toc-text">清除布局视图中的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%B8%83%E5%B1%80%E4%B8%AD%E7%9A%84%E6%89%80%E9%80%89%E5%86%85%E5%AE%B9"><span class="toc-number">9.8.9.</span> <span class="toc-text">清除布局中的所选内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%B8%83%E5%B1%80%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.10.</span> <span class="toc-text">复制布局元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%B8%83%E5%B1%80%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.11.</span> <span class="toc-text">删除布局元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%B8%83%E5%B1%80%E4%B8%8A%E7%9A%84%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.12.</span> <span class="toc-text">删除布局上的一个或多个元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%88%B0%E5%85%83%E7%B4%A0"><span class="toc-number">9.8.13.</span> <span class="toc-text">缩放到元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%8C%97%E9%92%88%E7%9A%84%E6%99%95%E5%9C%88%E5%B1%9E%E6%80%A7"><span class="toc-number">9.8.14.</span> <span class="toc-text">设置指北针的晕圈属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E5%92%8C%E6%8E%92%E5%BA%8F-1"><span class="toc-number">9.9.</span> <span class="toc-text">对图形元素进行分组和排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.9.1.</span> <span class="toc-text">组图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E7%BB%84%E5%90%88%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0-1"><span class="toc-number">9.9.2.</span> <span class="toc-text">取消组合图形元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%85%83%E7%B4%A0%E7%9A%84%E7%88%B6%E7%BA%A7-1"><span class="toc-number">9.9.3.</span> <span class="toc-text">组元素的父级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%85%83%E7%B4%A0%E4%B8%AD%E7%9A%84%E5%AD%90%E5%85%83%E7%B4%A0"><span class="toc-number">9.9.4.</span> <span class="toc-text">组元素中的子元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%EF%BC%9A%E5%90%91%E5%90%8E%E5%8F%91%E9%80%81%E5%92%8C%E5%90%91%E5%89%8D%E5%8F%91%E9%80%81-1"><span class="toc-number">9.9.5.</span> <span class="toc-text">排序：向后发送和向前发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Z-%E9%A1%BA%E5%BA%8F-1"><span class="toc-number">9.9.6.</span> <span class="toc-text">获取 Z 顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%B8%83%E5%B1%80%E5%85%83%E7%B4%A0"><span class="toc-number">9.10.</span> <span class="toc-text">更新布局元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%9C%AC%E5%85%83%E7%B4%A0%E5%B1%9E%E6%80%A7"><span class="toc-number">9.10.1.</span> <span class="toc-text">更新文本元素属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%9B%BE%E7%89%87%E5%85%83%E7%B4%A0"><span class="toc-number">9.10.2.</span> <span class="toc-text">更新图片元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%83%8C%E6%99%AF%E9%A2%9C%E8%89%B2%E5%BA%94%E7%94%A8%E4%BA%8E%E5%9C%B0%E5%9B%BE%E6%A1%86"><span class="toc-number">9.10.3.</span> <span class="toc-text">将背景颜色应用于地图框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%9C%B0%E5%9B%BE%E6%95%B4%E9%A5%B0"><span class="toc-number">9.10.4.</span> <span class="toc-text">更新地图整饰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E5%AE%9A%E5%85%83%E7%B4%A0"><span class="toc-number">9.10.5.</span> <span class="toc-text">锁定元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%85%83%E7%B4%A0%E9%80%8F%E6%98%8E%E5%BA%A6"><span class="toc-number">9.10.6.</span> <span class="toc-text">更新元素透明度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8B%E9%9A%86%E5%85%83%E7%B4%A0"><span class="toc-number">9.10.7.</span> <span class="toc-text">克隆元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">9.11.</span> <span class="toc-text">布局元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%85%83%E6%95%B0%E6%8D%AE-1"><span class="toc-number">9.11.1.</span> <span class="toc-text">布局元数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%9C%B0%E5%9B%BE%E6%A1%86"><span class="toc-number">9.12.</span> <span class="toc-text">布局地图框</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E4%B8%8E%E5%9C%B0%E5%9B%BE%E6%A1%86%E5%85%B3%E8%81%94%E7%9A%84%E5%9C%B0%E5%9B%BE"><span class="toc-number">9.12.1.</span> <span class="toc-text">更改与地图框关联的地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9C%B0%E5%9B%BE%E6%A1%86%E7%85%A7%E7%9B%B8%E6%9C%BA%E8%AE%BE%E7%BD%AE"><span class="toc-number">9.12.2.</span> <span class="toc-text">更改地图框照相机设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%A1%86%E7%BC%A9%E6%94%BE%E5%88%B0%E5%8D%95%E4%B8%AA%E5%9B%BE%E5%B1%82%E7%9A%84%E8%8C%83%E5%9B%B4"><span class="toc-number">9.12.3.</span> <span class="toc-text">将地图框缩放到单个图层的范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%A1%86%E8%8C%83%E5%9B%B4%E6%9B%B4%E6%94%B9%E4%B8%BA%E5%A4%9A%E4%B8%AA%E5%9B%BE%E5%B1%82%E4%B8%AD%E7%9A%84%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0"><span class="toc-number">9.12.4.</span> <span class="toc-text">将地图框范围更改为多个图层中的所选要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%A1%86%E8%8C%83%E5%9B%B4%E6%9B%B4%E6%94%B9%E4%B8%BA%E5%85%B7%E6%9C%89-15-%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E5%8D%95%E4%B8%AA%E8%A6%81%E7%B4%A0"><span class="toc-number">9.12.5.</span> <span class="toc-text">将地图框范围更改为具有 15% 缓冲区的单个要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E9%A1%B5%E9%9D%A2%E5%9D%90%E6%A0%87%E4%B8%AD%E7%9A%84%E7%82%B9%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9C%B0%E5%9B%BE%E5%9D%90%E6%A0%87%E4%B8%AD%E7%9A%84%E7%82%B9%E3%80%82"><span class="toc-number">9.12.6.</span> <span class="toc-text">将页面坐标中的点转换为地图坐标中的点。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E5%9D%90%E6%A0%87%E4%B8%AD%E7%9A%84%E7%82%B9%E8%BD%AC%E6%8D%A2%E4%B8%BA%E9%A1%B5%E9%9D%A2%E5%9D%90%E6%A0%87%E4%B8%AD%E7%9A%84%E7%82%B9"><span class="toc-number">9.12.7.</span> <span class="toc-text">将地图坐标中的点转换为页面坐标中的点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%9B%BE%E7%B3%BB%E5%88%97"><span class="toc-number">9.13.</span> <span class="toc-text">布局图系列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97"><span class="toc-number">9.13.1.</span> <span class="toc-text">修改现有地图系列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%A9%BA%E9%97%B4%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97"><span class="toc-number">9.13.2.</span> <span class="toc-text">创建新的空间地图系列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%AF%BC%E5%87%BA"><span class="toc-number">9.14.</span> <span class="toc-text">布局导出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%B8%83%E5%B1%80%E5%AF%BC%E5%87%BA%E4%B8%BA-PDF"><span class="toc-number">9.14.1.</span> <span class="toc-text">将布局导出为 PDF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%A1%86%E5%AF%BC%E5%87%BA%E4%B8%BA-JPG"><span class="toc-number">9.14.2.</span> <span class="toc-text">将地图框导出为 JPG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E4%B8%8E%E5%9C%B0%E5%9B%BE%E6%A1%86%E5%85%B3%E8%81%94%E7%9A%84%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E5%AF%BC%E5%87%BA%E5%88%B0-BMP"><span class="toc-number">9.14.3.</span> <span class="toc-text">将与地图框关联的地图视图导出到 BMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97%E5%AF%BC%E5%87%BA%E4%B8%BA%E5%8D%95%E4%B8%AA-PDF"><span class="toc-number">9.14.4.</span> <span class="toc-text">将地图系列导出为单个 PDF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97%E5%AF%BC%E5%87%BA%E5%88%B0%E5%8D%95%E4%B8%AA-TIFF-%E6%96%87%E4%BB%B6"><span class="toc-number">9.14.5.</span> <span class="toc-text">将地图系列导出到单个 TIFF 文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E9%80%89%E9%A1%B9"><span class="toc-number">9.15.</span> <span class="toc-text">布局选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B8%83%E5%B1%80%E9%80%89%E9%A1%B9"><span class="toc-number">9.15.1.</span> <span class="toc-text">获取布局选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%B8%83%E5%B1%80%E9%80%89%E9%A1%B9"><span class="toc-number">9.15.2.</span> <span class="toc-text">设置布局选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%92%8C%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E9%80%89%E9%A1%B9"><span class="toc-number">9.16.</span> <span class="toc-text">文本和图形元素选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%8F%AF%E7%94%A8%E5%AD%97%E4%BD%93"><span class="toc-number">9.16.1.</span> <span class="toc-text">获取所有可用字体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E6%9C%AC%E5%92%8C%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E9%80%89%E9%A1%B9"><span class="toc-number">9.16.2.</span> <span class="toc-text">获取文本和图形元素选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E6%9C%AC%E5%92%8C%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E9%80%89%E9%A1%B9"><span class="toc-number">9.16.3.</span> <span class="toc-text">设置文本和图形元素选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapFrame-Display-Constraints"><span class="toc-number">9.17.</span> <span class="toc-text">MapFrame_Display_Constraints</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E6%97%A0"><span class="toc-number">9.17.1.</span> <span class="toc-text">设置自动相机无</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E5%9B%BA%E5%AE%9A%E8%8C%83%E5%9B%B4"><span class="toc-number">9.17.2.</span> <span class="toc-text">设置自动相机固定范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E5%9B%BA%E5%AE%9A%E4%B8%AD%E5%BF%83"><span class="toc-number">9.17.3.</span> <span class="toc-text">设置自动相机固定中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E5%9B%BA%E5%AE%9A%E5%B1%85%E4%B8%AD%E5%92%8C%E7%BC%A9%E6%94%BE"><span class="toc-number">9.17.4.</span> <span class="toc-text">设置自动相机固定居中和缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E5%9B%BA%E5%AE%9A%E6%AF%94%E4%BE%8B"><span class="toc-number">9.17.5.</span> <span class="toc-text">设置自动相机固定比例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%85%A7%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E8%8C%83%E5%9B%B4"><span class="toc-number">9.17.6.</span> <span class="toc-text">设置自动照相机链接范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E4%B8%AD%E5%BF%83"><span class="toc-number">9.17.7.</span> <span class="toc-text">设置自动相机链接中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E4%B8%AD%E5%BF%83%E5%92%8C%E7%BC%A9%E6%94%BE"><span class="toc-number">9.17.8.</span> <span class="toc-text">设置自动相机链接中心和缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E7%BC%A9%E6%94%BE"><span class="toc-number">9.17.9.</span> <span class="toc-text">设置自动相机链接缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97%E5%BD%A2%E7%8A%B6"><span class="toc-number">9.17.10.</span> <span class="toc-text">设置自动相机链接地图系列形状</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%9B%B8%E6%9C%BA%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9B%BE%E7%B3%BB%E5%88%97%E4%B8%AD%E5%BF%83"><span class="toc-number">9.17.11.</span> <span class="toc-text">设置自动相机链接地图系列中心</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%83%E5%B1%80-%E6%8A%A5%E5%91%8A"><span class="toc-number">10.</span> <span class="toc-text">布局-报告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E5%91%8A%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">10.1.</span> <span class="toc-text">报告项目项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E6%8A%A5%E8%A1%A8"><span class="toc-number">10.1.1.</span> <span class="toc-text">获取当前项目中的所有报表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E6%8A%A5%E5%91%8A"><span class="toc-number">10.1.2.</span> <span class="toc-text">获取特定报告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%96%B0%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%89%93%E5%BC%80%E6%8A%A5%E8%A1%A8%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">10.1.3.</span> <span class="toc-text">在新视图中打开报表项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E5%B7%B2%E6%89%93%E5%BC%80%E7%9A%84%E6%8A%A5%E5%91%8A%E8%A7%86%E5%9B%BE"><span class="toc-number">10.1.4.</span> <span class="toc-text">激活已打开的报告视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%B4%BB%E5%8A%A8%E6%8A%A5%E8%A1%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">10.1.5.</span> <span class="toc-text">引用活动报表视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E6%8A%A5%E8%A1%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">10.1.6.</span> <span class="toc-text">刷新报表视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%88%B0%E6%95%B4%E4%B8%AA%E9%A1%B5%E9%9D%A2"><span class="toc-number">10.1.7.</span> <span class="toc-text">缩放到整个页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%88%B0%E6%8A%A5%E8%A1%A8%E8%A7%86%E5%9B%BE%E4%B8%8A%E7%9A%84%E7%89%B9%E5%AE%9A%E4%BD%8D%E7%BD%AE"><span class="toc-number">10.1.8.</span> <span class="toc-text">缩放到报表视图上的特定位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%AE%BD%E5%BA%A6"><span class="toc-number">10.1.9.</span> <span class="toc-text">缩放到页面宽度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8A%A5%E5%91%8A"><span class="toc-number">10.2.</span> <span class="toc-text">创建报告</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8A%A5%E5%91%8A-1"><span class="toc-number">10.2.1.</span> <span class="toc-text">创建报告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%8A%A5%E5%91%8A%E5%AF%BC%E5%87%BA%E4%B8%BA-pdf"><span class="toc-number">10.2.2.</span> <span class="toc-text">将报告导出为 pdf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%8A%A5%E5%91%8A%E6%96%87%E4%BB%B6"><span class="toc-number">10.2.3.</span> <span class="toc-text">导入报告文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%8A%A5%E8%A1%A8"><span class="toc-number">10.2.4.</span> <span class="toc-text">删除报表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%8A%A5%E8%A1%A8"><span class="toc-number">10.3.</span> <span class="toc-text">修改报表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E6%8A%A5%E8%A1%A8"><span class="toc-number">10.3.1.</span> <span class="toc-text">重命名报表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%8A%A5%E8%A1%A8%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.3.2.</span> <span class="toc-text">修改报表定义查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%8A%A5%E8%A1%A8%E9%A1%B5"><span class="toc-number">10.3.3.</span> <span class="toc-text">修改报表页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%AD%90%E6%8A%A5%E8%A1%A8"><span class="toc-number">10.3.4.</span> <span class="toc-text">添加子报表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">10.4.</span> <span class="toc-text">报表设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%A5%E5%91%8A%E6%A8%A1%E6%9D%BF"><span class="toc-number">10.4.1.</span> <span class="toc-text">获取报告模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%A5%E8%A1%A8%E6%A0%B7%E5%BC%8F"><span class="toc-number">10.4.2.</span> <span class="toc-text">获取报表样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E8%A1%A8%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.</span> <span class="toc-text">报表元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%90%84%E7%A7%8D%E6%8A%A5%E5%91%8A%E9%83%A8%E5%88%86"><span class="toc-number">10.5.1.</span> <span class="toc-text">获取各种报告部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.2.</span> <span class="toc-text">选择元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%89%80%E6%9C%89%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.3.</span> <span class="toc-text">选择所有元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E9%80%89%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.4.</span> <span class="toc-text">获取所选元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E6%89%80%E9%80%89%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.5.</span> <span class="toc-text">缩放至所选元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E6%99%B0%E7%9A%84%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9"><span class="toc-number">10.5.6.</span> <span class="toc-text">清晰的元素选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%90%8D%E7%A7%B0%E6%9F%A5%E6%89%BE%E6%8A%A5%E8%A1%A8%E4%B8%AD%E7%9A%84%E7%89%B9%E5%AE%9A%E5%85%83%E7%B4%A0%E3%80%82"><span class="toc-number">10.5.7.</span> <span class="toc-text">根据名称查找报表中的特定元素。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="toc-number">10.5.8.</span> <span class="toc-text">删除元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%8A%A5%E8%A1%A8%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%96%B0%E5%AD%97%E6%AE%B5"><span class="toc-number">10.5.9.</span> <span class="toc-text">在报表中创建新字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C"><span class="toc-number">11.</span> <span class="toc-text">地图创作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.1.</span> <span class="toc-text">地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.1.1.</span> <span class="toc-text">获取活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82%E5%88%9B%E5%BB%BA%E6%96%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.1.2.</span> <span class="toc-text">使用默认底图图层创建新地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E7%A8%8B%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%9C%B0%E5%9B%BE%E5%B9%B6%E5%B0%86%E5%85%B6%E6%89%93%E5%BC%80"><span class="toc-number">11.1.3.</span> <span class="toc-text">在工程中查找地图并将其打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80-web-%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.1.4.</span> <span class="toc-text">打开 web 地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9B%BE%E7%AA%97%E6%A0%BC"><span class="toc-number">11.1.5.</span> <span class="toc-text">获取地图窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E7%AA%97%E6%A0%BC%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%94%AF%E4%B8%80%E7%9A%84%E5%9C%B0%E5%9B%BE%E5%88%97%E8%A1%A8"><span class="toc-number">11.1.6.</span> <span class="toc-text">从地图窗格中获取唯一的地图列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9C%B0%E5%9B%BE%E5%90%8D%E7%A7%B0"><span class="toc-number">11.1.7.</span> <span class="toc-text">更改地图名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E7%AA%97%E6%A0%BC%E7%9A%84%E6%A0%87%E9%A2%98"><span class="toc-number">11.1.8.</span> <span class="toc-text">重命名窗格的标题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%B1%80%E9%83%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">11.1.9.</span> <span class="toc-text">将地图转换为局部场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BA%95%E5%9B%BE"><span class="toc-number">11.1.10.</span> <span class="toc-text">获取底图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E5%8F%A6%E5%AD%98%E4%B8%BA-MapX"><span class="toc-number">11.1.11.</span> <span class="toc-text">将地图另存为 MapX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-2D-%E5%9C%B0%E5%9B%BE%E5%8F%A6%E5%AD%98%E4%B8%BA-Web-%E5%9C%B0%E5%9B%BE-%E5%9C%A8%E7%A3%81%E7%9B%98%E4%B8%8A"><span class="toc-number">11.1.12.</span> <span class="toc-text">将 2D 地图另存为 Web 地图 在磁盘上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%81%E5%89%AA%E6%98%A0%E5%B0%84%E5%88%B0%E6%8F%90%E4%BE%9B%E7%9A%84%E8%A3%81%E5%89%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">11.1.13.</span> <span class="toc-text">裁剪映射到提供的裁剪多边形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E5%89%AA%E8%BE%91%E5%87%A0%E4%BD%95"><span class="toc-number">11.1.14.</span> <span class="toc-text">清除当前地图剪辑几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9B%BE%E8%A3%81%E5%89%AA%E5%87%A0%E4%BD%95"><span class="toc-number">11.1.15.</span> <span class="toc-text">获取地图裁剪几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E5%85%83"><span class="toc-number">11.1.16.</span> <span class="toc-text">获取当前地图位置单元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E7%9A%84%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E4%BD%8D%E5%88%97%E8%A1%A8"><span class="toc-number">11.1.17.</span> <span class="toc-text">获取可用的地图位置单位列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E4%BD%8D%E7%BD%AE%E5%8D%95%E5%85%83%E8%AE%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">11.1.18.</span> <span class="toc-text">使用当前地图位置单元设置位置格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%8D%95%E4%BD%8D"><span class="toc-number">11.1.19.</span> <span class="toc-text">设置当前地图的位置单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">11.1.20.</span> <span class="toc-text">获取当前地图高程单位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E7%9A%84%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D%E5%88%97%E8%A1%A8"><span class="toc-number">11.1.21.</span> <span class="toc-text">获取可用的地图高程单位列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D%E8%AE%BE%E7%BD%AE%E9%AB%98%E7%A8%8B%E6%A0%BC%E5%BC%8F"><span class="toc-number">11.1.22.</span> <span class="toc-text">使用当前地图高程单位设置高程格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E7%9A%84%E9%AB%98%E7%A8%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">11.1.23.</span> <span class="toc-text">设置当前地图的高程单位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.2.</span> <span class="toc-text">离线地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E6%98%AF%E5%90%A6%E5%85%B7%E6%9C%89%E5%90%AF%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">11.2.1.</span> <span class="toc-text">检查地图是否具有启用同步的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%90%AF%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E5%86%85%E5%AE%B9%E7%94%9F%E6%88%90%E5%89%AF%E6%9C%AC"><span class="toc-number">11.2.2.</span> <span class="toc-text">为启用同步的内容生成副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E6%98%AF%E5%90%A6%E5%85%B7%E6%9C%89%E6%9C%AC%E5%9C%B0%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9"><span class="toc-number">11.2.3.</span> <span class="toc-text">检查地图是否具有本地可同步内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9%E7%9A%84%E5%89%AF%E6%9C%AC"><span class="toc-number">11.2.4.</span> <span class="toc-text">同步可同步内容的副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%8F%AF%E5%90%8C%E6%AD%A5%E5%86%85%E5%AE%B9%E7%9A%84%E5%89%AF%E6%9C%AC"><span class="toc-number">11.2.5.</span> <span class="toc-text">删除可同步内容的副本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%9C%B0%E5%9B%BE%E6%A0%85%E6%A0%BC%E5%88%87%E7%89%87%E7%BC%93%E5%AD%98%E5%86%85%E5%AE%B9"><span class="toc-number">11.2.6.</span> <span class="toc-text">导出地图栅格切片缓存内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%9C%B0%E5%9B%BE%E7%9F%A2%E9%87%8F%E5%88%87%E7%89%87%E7%BC%93%E5%AD%98%E5%86%85%E5%AE%B9"><span class="toc-number">11.2.7.</span> <span class="toc-text">导出地图矢量切片缓存内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.</span> <span class="toc-text">创建图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.3.1.</span> <span class="toc-text">创建图层并将其添加到活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.2.</span> <span class="toc-text">使用创建参数创建图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%B1%82%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.3.3.</span> <span class="toc-text">创建要素图层并使用图层创建参数添加到地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%B8%8D%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%9C%B0%E5%9B%BE%E4%B8%AD%E3%80%82"><span class="toc-number">11.3.4.</span> <span class="toc-text">创建要素图层并设置为不显示在地图中。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.5.</span> <span class="toc-text">使用渲染器创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.6.</span> <span class="toc-text">使用查询定义创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9C%B0%E5%9B%BE%E6%B3%A8%E9%87%8A%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE"><span class="toc-number">11.3.7.</span> <span class="toc-text">将地图注释添加到活动地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%9B%BE%E5%B1%82%E7%9A%84%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number">11.3.8.</span> <span class="toc-text">应用目录中图层的符号系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%AD%90%E7%B1%BB%E5%9E%8B%E5%9B%BE%E5%B1%82%E7%BB%84"><span class="toc-number">11.3.9.</span> <span class="toc-text">创建新的子类型图层组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-lyrx-%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.10.</span> <span class="toc-text">从 lyrx 文件创建图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F%E5%BA%94%E7%94%A8%E4%BA%8E%E5%9B%BE%E5%B1%82%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.11.</span> <span class="toc-text">将符号系统应用于图层文件中的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-WMS-%E6%9C%8D%E5%8A%A1"><span class="toc-number">11.3.12.</span> <span class="toc-text">添加 WMS 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-WFS-%E6%9C%8D%E5%8A%A1"><span class="toc-number">11.3.13.</span> <span class="toc-text">添加 WFS 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%92%8C%E6%9B%B4%E6%94%B9-WMS-%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.3.14.</span> <span class="toc-text">添加和更改 WMS 服务图层的样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9F%A5%E8%AF%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.15.</span> <span class="toc-text">创建查询图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%80%BC%E5%88%86%E7%B1%BB%E9%97%B4%E9%9A%94%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.16.</span> <span class="toc-text">使用默认值分类间隔渲染器创建要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%86%E7%B1%BB%E9%97%B4%E9%9A%94%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.3.17.</span> <span class="toc-text">使用分类间隔渲染器创建要素图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">11.4.</span> <span class="toc-text">底图图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">11.4.1.</span> <span class="toc-text">更新地图的底图图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%A7%BB%E9%99%A4%E5%BA%95%E5%9B%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">11.4.2.</span> <span class="toc-text">从地图中移除底图图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.</span> <span class="toc-text">使用图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%8C%89%E5%9B%BE%E5%B1%82%E7%B1%BB%E5%9E%8B%E8%BF%87%E6%BB%A4%E7%9A%84%E5%9B%BE%E5%B1%82%E5%88%97%E8%A1%A8"><span class="toc-number">11.5.1.</span> <span class="toc-text">从地图中获取按图层类型过滤的图层列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.2.</span> <span class="toc-text">获取特定几何类型的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.3.</span> <span class="toc-text">查找图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">11.5.4.</span> <span class="toc-text">查找独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%83%A8%E5%88%86%E5%90%8D%E7%A7%B0%E6%90%9C%E7%B4%A2%E6%9F%A5%E6%89%BE%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.5.</span> <span class="toc-text">使用部分名称搜索查找图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%B1%82%E5%8F%AF%E8%A7%81%E6%80%A7%E3%80%81%E5%8F%AF%E7%BC%96%E8%BE%91%E6%80%A7%E3%80%81%E6%8D%95%E6%8D%89%E6%80%A7"><span class="toc-number">11.5.6.</span> <span class="toc-text">更改图层可见性、可编辑性、捕捉性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Lyrx-%E6%96%87%E4%BB%B6"><span class="toc-number">11.5.7.</span> <span class="toc-text">创建 Lyrx 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%9B%BE%E5%B1%82%E4%B8%8A%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">11.5.8.</span> <span class="toc-text">计算图层上所选要素的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9A%84%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5"><span class="toc-number">11.5.9.</span> <span class="toc-text">访问图层的显示字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9B%BE%E5%B1%82%E4%B8%8A%E5%90%AF%E7%94%A8%E6%A0%87%E6%B3%A8"><span class="toc-number">11.5.10.</span> <span class="toc-text">在图层上启用标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-2D-%E7%BB%84%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%B1%80%E9%83%A8%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84-3D-%E7%BB%84"><span class="toc-number">11.5.11.</span> <span class="toc-text">将 2D 组中的图层移动到局部场景中的 3D 组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E8%A6%81%E7%B4%A0%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E7%9A%84-URL"><span class="toc-number">11.5.12.</span> <span class="toc-text">重置要素服务图层的 URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E6%BA%90-%E7%9B%B8%E5%90%8C%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.5.13.</span> <span class="toc-text">更改要素图层的基础数据源 - 相同的工作空间类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E6%9B%B4%E6%94%B9%E4%B8%BA%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC"><span class="toc-number">11.5.14.</span> <span class="toc-text">将图层的地理数据库版本更改为地图中的指定版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.15.</span> <span class="toc-text">查询要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E7%9A%84%E5%B1%9E%E6%80%A7%E6%97%8B%E8%BD%AC%E5%AD%97%E6%AE%B5"><span class="toc-number">11.5.16.</span> <span class="toc-text">获取图层的属性旋转字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E8%A6%81%E6%97%8B%E8%BD%AC%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%B1%9E%E6%80%A7%E5%AD%97%E6%AE%B5"><span class="toc-number">11.5.17.</span> <span class="toc-text">查找要旋转的连接属性字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E2%80%9C%E8%AE%BE%E7%BD%AE%E5%8F%82%E8%80%83%E6%AF%94%E4%BE%8B%E6%97%B6%E7%BC%A9%E6%94%BE%E5%9B%BE%E5%B1%82%E7%AC%A6%E5%8F%B7%E2%80%9D"><span class="toc-number">11.5.18.</span> <span class="toc-text">切换“设置参考比例时缩放图层符号”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%BE%E5%B1%82%E7%BC%93%E5%AD%98"><span class="toc-number">11.5.19.</span> <span class="toc-text">设置图层缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%B1%82%E9%80%89%E6%8B%A9%E9%A2%9C%E8%89%B2"><span class="toc-number">11.5.20.</span> <span class="toc-text">更改图层选择颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%9C%AA%E9%80%89%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.21.</span> <span class="toc-text">删除所有未选中的图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%A9%BA%E7%BB%84"><span class="toc-number">11.5.22.</span> <span class="toc-text">删除空组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9C%B0%E5%9B%BE%E5%AE%9A%E4%B9%89%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%BC%A9%E5%86%99%E5%AD%97%E5%85%B8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%9B%BE%E5%B1%82"><span class="toc-number">11.5.23.</span> <span class="toc-text">在地图定义中创建缩写字典并将其应用于图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A1%A8-ITablePane"><span class="toc-number">11.6.</span> <span class="toc-text">属性表 - ITablePane</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E8%A1%A8%E7%9A%84%E7%BC%A9%E6%94%BE%E7%BA%A7%E5%88%AB"><span class="toc-number">11.6.1.</span> <span class="toc-text">设置属性表的缩放级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%B1%9E%E6%80%A7%E8%A1%A8%E4%B8%AD%E6%89%80%E9%80%89%E5%83%8F%E5%85%83%E7%9A%84%E5%80%BC"><span class="toc-number">11.6.2.</span> <span class="toc-text">检索属性表中所选像元的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%88%B0%E7%89%B9%E5%AE%9A%E8%A1%8C"><span class="toc-number">11.6.3.</span> <span class="toc-text">移动到特定行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE-1"><span class="toc-number">11.7.</span> <span class="toc-text">元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%92%8C%E8%AE%BE%E7%BD%AE%E5%9C%B0%E5%9B%BE%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">11.7.1.</span> <span class="toc-text">获取和设置地图元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%B1%82%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">11.7.2.</span> <span class="toc-text">图层元数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.8.</span> <span class="toc-text">渲染器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93%E5%99%A8%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.8.1.</span> <span class="toc-text">将唯一值渲染器设置为活动地图的所选要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E5%80%BC%E5%91%88%E7%8E%B0%E5%99%A8%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%80%BC%E7%9A%84%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.8.2.</span> <span class="toc-text">创建一个唯一值呈现器以指定值的符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%83%AD%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.8.3.</span> <span class="toc-text">创建热图渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%AA%E5%88%86%E7%B1%BB%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.8.4.</span> <span class="toc-text">创建未分类渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%80%E5%A4%A7%E5%92%8C%E6%9C%80%E5%B0%8F%E7%AC%A6%E5%8F%B7%E5%A4%A7%E5%B0%8F%E4%B8%8A%E9%99%90%E7%9A%84%E6%AF%94%E4%BE%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.8.5.</span> <span class="toc-text">创建最大和最小符号大小上限的比例渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9C%9F%E5%AE%9E%E6%AF%94%E4%BE%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.8.6.</span> <span class="toc-text">创建真实比例渲染器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%B1%E5%BB%8A"><span class="toc-number">11.9.</span> <span class="toc-text">拱廊</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Arcade-%E4%BF%AE%E6%94%B9%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">11.9.1.</span> <span class="toc-text">使用 Arcade 修改渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Arcade-%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">11.9.2.</span> <span class="toc-text">使用 Arcade 修改标注表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.</span> <span class="toc-text">高程表面图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%9C%B0%E8%A1%A8%E5%9B%BE%E5%B1%82%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">11.10.1.</span> <span class="toc-text">创建具有地表图层的场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2"><span class="toc-number">11.10.2.</span> <span class="toc-text">创建新的高程表面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E8%AE%BE%E7%BD%AE%E4%B8%BA-Z-%E6%84%9F%E7%9F%A5%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.3.</span> <span class="toc-text">将自定义高程表面设置为 Z 感知图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E9%AB%98%E7%A8%8B%E6%BA%90%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%8E%B0%E6%9C%89%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.4.</span> <span class="toc-text">将高程源添加到现有高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E8%8E%B7%E5%8F%96%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82%E5%92%8C%E9%AB%98%E7%A8%8B%E6%BA%90%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.5.</span> <span class="toc-text">从地图中获取高程表面图层和高程源图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.6.</span> <span class="toc-text">查找高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E9%AB%98%E7%A8%8B%E8%A1%A8%E9%9D%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.10.7.</span> <span class="toc-text">移除高程表面图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%9B%B2%E9%9D%A2%E8%8E%B7%E5%8F%96-Z-%E5%80%BC"><span class="toc-number">11.10.8.</span> <span class="toc-text">从曲面获取 Z 值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.</span> <span class="toc-text">栅格图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.1.</span> <span class="toc-text">创建栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.11.2.</span> <span class="toc-text">更新栅格图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.11.3.</span> <span class="toc-text">更新栅格图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%9F%90%E4%B8%AA%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.4.</span> <span class="toc-text">检查是否可以将某个着色器应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于栅格图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">11.11.7.</span> <span class="toc-text">使用新的着色器定义创建栅格图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%AC%E8%B5%9B%E5%85%8B%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.</span> <span class="toc-text">马赛克图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.1.</span> <span class="toc-text">创建镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.12.2.</span> <span class="toc-text">更新镶嵌图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.12.3.</span> <span class="toc-text">更新镶嵌图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%9F%90%E7%A7%8D%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E9%A9%AC%E8%B5%9B%E5%85%8B%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.4.</span> <span class="toc-text">检查是否可以将某种着色器应用于马赛克图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82"><span class="toc-number">11.12.7.</span> <span class="toc-text">使用新的着色器定义创建镶嵌图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E9%A1%BA%E5%BA%8F-%E9%95%B6%E5%B5%8C%E6%96%B9%E6%B3%95"><span class="toc-number">11.12.8.</span> <span class="toc-text">更新镶嵌图层上的排序顺序 - 镶嵌方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%95%B6%E5%B5%8C%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E8%A7%A3%E6%9E%90%E9%87%8D%E5%8F%A0-%E9%95%B6%E5%B5%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">11.12.9.</span> <span class="toc-text">更新镶嵌图层上的解析重叠 - 镶嵌运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.</span> <span class="toc-text">影像服务图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.1.</span> <span class="toc-text">创建影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%A0%85%E6%A0%BC%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.13.2.</span> <span class="toc-text">更新影像服务图层上的栅格着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84-RGB-%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">11.13.3.</span> <span class="toc-text">更新影像服务图层上的 RGB 着色器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%B0%86%E7%89%B9%E5%AE%9A%E7%9D%80%E8%89%B2%E5%99%A8%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.4.</span> <span class="toc-text">检查是否可以将特定着色器应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.5.</span> <span class="toc-text">基于默认着色器定义创建新的着色器并将其应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.6.</span> <span class="toc-text">基于自定义着色器定义创建新的着色器并将其应用于影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82"><span class="toc-number">11.13.7.</span> <span class="toc-text">使用新的着色器定义创建影像服务图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E9%A1%BA%E5%BA%8F-%E9%95%B6%E5%B5%8C%E6%96%B9%E6%B3%95"><span class="toc-number">11.13.8.</span> <span class="toc-text">更新影像服务图层上的排序顺序 - 镶嵌方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%B1%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E8%A7%A3%E5%86%B3%E9%87%8D%E5%8F%A0-%E9%95%B6%E5%B5%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">11.13.9.</span> <span class="toc-text">更新影像服务图层上的解决重叠 - 镶嵌运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">11.14.</span> <span class="toc-text">使用独立表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">11.14.1.</span> <span class="toc-text">创建独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E7%9A%84%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%A3%80%E7%B4%A2%E8%A1%A8"><span class="toc-number">11.14.2.</span> <span class="toc-text">从表的容器中检索表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">11.14.3.</span> <span class="toc-text">移动独立表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%8B%AC%E7%AB%8B%E8%A1%A8"><span class="toc-number">11.14.4.</span> <span class="toc-text">删除独立表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E5%9B%BE%E5%B1%82%E7%BB%98%E5%88%B6-%EF%BC%88SLD%EF%BC%89"><span class="toc-number">11.15.</span> <span class="toc-text">符号图层绘制 （SLD）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-SLD"><span class="toc-number">11.15.1.</span> <span class="toc-text">添加 SLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%9B%BE%E5%B1%82%E6%98%AF%E5%90%A6%E6%B7%BB%E5%8A%A0%E4%BA%86-SLD"><span class="toc-number">11.15.2.</span> <span class="toc-text">确定图层是否添加了 SLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-x2F-%E7%A6%81%E7%94%A8-SLD"><span class="toc-number">11.15.3.</span> <span class="toc-text">启用&#x2F;禁用 SLD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE-API%E3%80%81GPS-x2F-GNSS-%E8%AE%BE%E5%A4%87"><span class="toc-number">11.16.</span> <span class="toc-text">设备位置 API、GPS&#x2F;GNSS 设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%88%B0%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">11.16.1.</span> <span class="toc-text">连接到设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">11.16.2.</span> <span class="toc-text">获取当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">11.16.3.</span> <span class="toc-text">关闭当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">11.16.4.</span> <span class="toc-text">获取当前设备位置源和属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E4%B8%8A%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">11.16.5.</span> <span class="toc-text">更新当前设备位置源上的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E4%BA%8B%E4%BB%B6"><span class="toc-number">11.16.6.</span> <span class="toc-text">订阅设备位置属性更新事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90%E6%9B%B4%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">11.16.7.</span> <span class="toc-text">订阅设备位置源更改事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">11.17.</span> <span class="toc-text">映射设备位置选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-x2F-%E7%A6%81%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">11.17.1.</span> <span class="toc-text">启用&#x2F;禁用地图的当前设备位置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">11.17.2.</span> <span class="toc-text">获取当前地图设备位置选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9C%B0%E5%9B%BE%E4%B8%8A%E6%98%AF%E5%90%A6%E5%90%AF%E7%94%A8%E4%BA%86%E5%BD%93%E5%89%8D%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.17.3.</span> <span class="toc-text">检查地图上是否启用了当前设备位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9B%BE%E8%AE%BE%E5%A4%87%E4%BD%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">11.17.4.</span> <span class="toc-text">设置当前地图设备位置选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-x2F-%E5%B9%B3%E7%A7%BB%E5%9C%B0%E5%9B%BE%E5%88%B0%E6%9C%80%E6%96%B0%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.17.5.</span> <span class="toc-text">缩放&#x2F;平移地图到最新位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%9C%80%E6%96%B0%E4%BD%8D%E7%BD%AE%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%B1%82"><span class="toc-number">11.17.6.</span> <span class="toc-text">将最新位置添加到图形图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E4%BD%8D%E7%BD%AE%E5%BF%AB%E7%85%A7%E4%BA%8B%E4%BB%B6"><span class="toc-number">11.17.7.</span> <span class="toc-text">订阅位置快照事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E9%81%AE%E7%BD%A9"><span class="toc-number">11.18.</span> <span class="toc-text">特征遮罩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A6%81%E7%B4%A0%E7%9A%84%E9%81%AE%E7%BD%A9%E5%87%A0%E4%BD%95"><span class="toc-number">11.18.1.</span> <span class="toc-text">获取要素的遮罩几何</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A3%8E%E6%A0%BC%E7%AE%A1%E7%90%86"><span class="toc-number">11.19.</span> <span class="toc-text">风格管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8C%89%E5%90%8D%E7%A7%B0%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.1.</span> <span class="toc-text">如何按名称获取项目中的样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E6%96%B0%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.2.</span> <span class="toc-text">如何创建新样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%90%91%E9%A1%B9%E7%9B%AE%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.3.</span> <span class="toc-text">如何向项目添加样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%88%A0%E9%99%A4%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.4.</span> <span class="toc-text">如何从项目中删除样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E9%A1%B9%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.5.</span> <span class="toc-text">如何将样式项添加到样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E6%A0%B7%E5%BC%8F%E4%B8%AD%E5%88%A0%E9%99%A4%E6%A0%B7%E5%BC%8F%E9%A1%B9"><span class="toc-number">11.19.6.</span> <span class="toc-text">如何从样式中删除样式项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%8D%87%E7%BA%A7"><span class="toc-number">11.19.7.</span> <span class="toc-text">如何确定样式是否可以升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E4%B8%BA%E5%8F%AA%E8%AF%BB"><span class="toc-number">11.19.8.</span> <span class="toc-text">如何确定样式是否为只读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%A0%B7%E5%BC%8F%E6%98%AF%E5%90%A6%E4%B8%BA%E5%BD%93%E5%89%8D%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.9.</span> <span class="toc-text">如何确定样式是否为当前样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%8D%87%E7%BA%A7%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.19.10.</span> <span class="toc-text">如何升级样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.</span> <span class="toc-text">符号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E5%92%8C%E5%A4%A7%E5%B0%8F%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.1.</span> <span class="toc-text">如何构建特定颜色和大小的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%BD%A2%E7%8A%B6%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.2.</span> <span class="toc-text">如何构建特定颜色、大小和形状的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E6%A0%87%E8%AE%B0%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.3.</span> <span class="toc-text">如何根据标记构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E7%A3%81%E7%9B%98%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.4.</span> <span class="toc-text">如何从磁盘上的文件构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E5%86%85%E5%AD%98%E5%9B%BE%E5%BD%A2%E6%9E%84%E9%80%A0%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.5.</span> <span class="toc-text">如何从内存图形构造点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E9%80%A0%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E5%92%8C%E5%A1%AB%E5%85%85%E6%A0%B7%E5%BC%8F%E7%9A%84%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.6.</span> <span class="toc-text">如何构造特定颜色和填充样式的面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A1%AB%E5%85%85%E6%A0%B7%E5%BC%8F%E5%92%8C%E8%BD%AE%E5%BB%93%E7%9A%84%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.7.</span> <span class="toc-text">如何构建特定颜色、填充样式和轮廓的多边形符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%B2%A1%E6%9C%89%E8%BD%AE%E5%BB%93%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E6%9E%84%E5%BB%BA%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.8.</span> <span class="toc-text">如何在没有轮廓的情况下构建面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%89%B9%E5%AE%9A%E9%A2%9C%E8%89%B2%E3%80%81%E5%A4%A7%E5%B0%8F%E5%92%8C%E7%BA%BF%E6%9D%A1%E6%A0%B7%E5%BC%8F%E7%9A%84%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.9.</span> <span class="toc-text">如何构建特定颜色、大小和线条样式的线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E7%AC%94%E5%88%92%E6%9E%84%E9%80%A0%E7%BA%BF%E6%9D%A1%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.10.</span> <span class="toc-text">如何根据笔划构造线条符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E7%BA%BF%E7%AB%AF%E5%B8%A6%E6%9C%89%E5%9C%86%E5%BD%A2%E6%A0%87%E8%AE%B0%E7%9A%84%E5%A4%9A%E5%9B%BE%E5%B1%82%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.11.</span> <span class="toc-text">如何构建线端带有圆形标记的多图层线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E6%9C%AB%E7%AB%AF%E5%B8%A6%E6%9C%89%E7%AE%AD%E5%A4%B4%E7%9A%84%E5%A4%9A%E5%9B%BE%E5%B1%82%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.12.</span> <span class="toc-text">如何构建末端带有箭头的多图层线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E7%AC%A6%E5%8F%B7%E8%8E%B7%E5%8F%96%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8"><span class="toc-number">11.20.13.</span> <span class="toc-text">如何从符号获取符号引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BB%8E%E5%AD%97%E7%AC%A6%E6%A0%87%E8%AE%B0%E5%88%9B%E5%BB%BA%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.14.</span> <span class="toc-text">修改从字符标记创建的点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E5%AD%97%E4%BD%93%E7%9A%84%E5%88%97%E8%A1%A8"><span class="toc-number">11.20.15.</span> <span class="toc-text">获取可用字体的列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-x2F-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%97%E4%BD%93"><span class="toc-number">11.20.16.</span> <span class="toc-text">获取&#x2F;设置默认字体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%80%89%E9%A1%B9%E6%9E%84%E5%BB%BA%E6%96%87%E6%9C%AC%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.17.</span> <span class="toc-text">使用选项构建文本符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E7%BB%99%E5%AE%9A%E7%AC%A6%E5%8F%B7%E5%88%9B%E5%BB%BA%E8%89%B2%E6%9D%BF"><span class="toc-number">11.20.18.</span> <span class="toc-text">为给定符号创建色板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.20.19.</span> <span class="toc-text">查找符号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E6%90%9C%E7%B4%A2"><span class="toc-number">11.21.</span> <span class="toc-text">符号搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%89%B9%E5%AE%9A%E9%A1%B9%E7%9B%AE"><span class="toc-number">11.21.1.</span> <span class="toc-text">如何在样式中搜索特定项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%82%B9%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.21.2.</span> <span class="toc-text">如何在样式中搜索点符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%BA%BF%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.21.3.</span> <span class="toc-text">如何在样式中搜索线符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%9D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.21.4.</span> <span class="toc-text">如何在样式中搜索面符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%A2%9C%E8%89%B2"><span class="toc-number">11.21.5.</span> <span class="toc-text">如何在样式中搜索颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%89%B2%E5%B8%A6"><span class="toc-number">11.21.6.</span> <span class="toc-text">如何在样式中搜索色带</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%8C%87%E5%8C%97%E9%92%88"><span class="toc-number">11.21.7.</span> <span class="toc-text">如何在样式中搜索指北针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%AF%94%E4%BE%8B%E5%B0%BA"><span class="toc-number">11.21.8.</span> <span class="toc-text">如何在样式中搜索比例尺</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%A0%87%E7%AD%BE%E5%B1%95%E7%A4%BA%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.21.9.</span> <span class="toc-text">如何在样式中搜索标签展示位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9B%BE%E4%BE%8B"><span class="toc-number">11.21.10.</span> <span class="toc-text">如何在样式中搜索图例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9B%BE%E4%BE%8B%E9%A1%B9"><span class="toc-number">11.21.11.</span> <span class="toc-text">如何在样式中搜索图例项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E7%BD%91%E6%A0%BC"><span class="toc-number">11.21.12.</span> <span class="toc-text">如何在样式中搜索网格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%9C%B0%E5%9B%BE%E6%95%B4%E9%A5%B0"><span class="toc-number">11.21.13.</span> <span class="toc-text">如何在样式中搜索地图整饰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%A1%A8%E6%A0%BC%E6%A1%86"><span class="toc-number">11.21.14.</span> <span class="toc-text">如何在样式中搜索表格框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%B7%E5%BC%8F%E4%B8%AD%E6%90%9C%E7%B4%A2%E8%A1%A8%E6%A0%BC%E6%A1%86%E5%AD%97%E6%AE%B5"><span class="toc-number">11.21.15.</span> <span class="toc-text">如何在样式中搜索表格框字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%AC%A6%E5%8F%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number">11.22.</span> <span class="toc-text">要素图层符号系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%B8%BA%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E6%B8%B2%E6%9F%93%E5%99%A8%E7%AC%A6%E5%8F%B7%E5%8C%96%E7%9A%84%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E7%AC%A6%E5%8F%B7"><span class="toc-number">11.22.1.</span> <span class="toc-text">如何为使用简单渲染器符号化的要素图层设置符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E4%B8%AD%E7%9A%84%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.22.2.</span> <span class="toc-text">如何将样式中的符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E4%B8%AD%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.22.3.</span> <span class="toc-text">如何将样式中的点符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%A0%B7%E5%BC%8F%E7%9A%84%E8%89%B2%E5%B8%A6%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.22.4.</span> <span class="toc-text">如何将样式的色带应用于要素图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C-%E6%B3%A8%E9%87%8A%E7%89%87%E6%AE%B5"><span class="toc-number">11.23.</span> <span class="toc-text">地图创作-注释片段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B3%A8%E8%AE%B0%E6%9E%84%E9%80%A0%E5%B7%A5%E5%85%B7-1"><span class="toc-number">11.23.1.</span> <span class="toc-text">创建注记构造工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E3%80%82%E8%AD%A6%E5%91%8A%EF%BC%9ATEXTSTRING-Anno-%E5%B1%9E%E6%80%A7%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8-1"><span class="toc-number">11.23.2.</span> <span class="toc-text">通过属性更新批注文本。警告：TEXTSTRING Anno 属性必须存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%88%96%E7%A7%BB%E5%8A%A8%E6%89%B9%E6%B3%A8-1"><span class="toc-number">11.23.3.</span> <span class="toc-text">旋转或移动批注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%B9%E6%B3%A8%E6%96%87%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">11.23.4.</span> <span class="toc-text">获取批注文本图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A8%E9%87%8A%E7%9A%84%E8%BD%AE%E5%BB%93%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">11.23.5.</span> <span class="toc-text">获取注释的轮廓几何图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A8%E9%87%8A%E7%9A%84%E9%81%AE%E7%BD%A9%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">11.23.6.</span> <span class="toc-text">获取注释的遮罩几何图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C%E6%A0%87%E8%AE%B0%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="toc-number">11.24.</span> <span class="toc-text">地图创作标记代码段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E-Maplex-%E6%88%96%E6%A0%87%E5%87%86%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E"><span class="toc-number">11.24.1.</span> <span class="toc-text">获取活动地图的标注引擎 - Maplex 或标准标注引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%A0%87%E6%B3%A8%E5%BC%95%E6%93%8E%E4%BB%8E%E6%A0%87%E5%87%86%E6%9B%B4%E6%94%B9%E4%B8%BA-Maplex%EF%BC%8C%E5%8F%8D%E4%B9%8B%E4%BA%A6%E7%84%B6"><span class="toc-number">11.24.2.</span> <span class="toc-text">将活动地图的标注引擎从标准更改为 Maplex，反之亦然</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E6%9C%AC%E7%AC%A6%E5%8F%B7%E5%BA%94%E7%94%A8%E4%BA%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">11.24.3.</span> <span class="toc-text">将文本符号应用于要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%9B%BE%E5%B1%82%E6%A0%87%E6%B3%A8"><span class="toc-number">11.24.4.</span> <span class="toc-text">启用图层标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E7%82%B9%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.5.</span> <span class="toc-text">修改标签的位置&#x2F;位置 - 点几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E7%BA%BF%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.6.</span> <span class="toc-text">修改标签的位置&#x2F;位置 - 线几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E4%BD%8D%E7%BD%AE-x2F-%E4%BD%8D%E7%BD%AE-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.7.</span> <span class="toc-text">修改标注的位置&#x2F;位置 - 多边形几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MaplexEngine-%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E6%96%B9%E5%90%91-%E7%82%B9%E5%92%8C%E9%9D%A2%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.8.</span> <span class="toc-text">使用 MaplexEngine 修改标注的方向 - 点和面几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MaplexEngine-%E7%BA%BF%E5%87%A0%E4%BD%95%E4%BF%AE%E6%94%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E6%96%B9%E5%90%91"><span class="toc-number">11.24.9.</span> <span class="toc-text">使用 MaplexEngine - 线几何修改标注的方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E6%97%8B%E8%BD%AC-%E7%82%B9%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.10.</span> <span class="toc-text">修改标签旋转 - 点几何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95%E4%B8%AD%E5%B1%95%E5%BC%80%E6%A0%87%E6%B3%A8"><span class="toc-number">11.24.11.</span> <span class="toc-text">在多边形几何中展开标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E7%9A%84%E5%BC%95%E5%87%BA%E7%BA%BF%E9%94%9A%E7%82%B9%E5%B1%9E%E6%80%A7-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%87%A0%E4%BD%95"><span class="toc-number">11.24.12.</span> <span class="toc-text">修改标签的引出线锚点属性 - 多边形几何</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9B%E4%BD%9C-%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.</span> <span class="toc-text">地图创作-体素图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.1.</span> <span class="toc-text">创建体素图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BA%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.1.1.</span> <span class="toc-text">检查是否可以创建体素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82-1"><span class="toc-number">12.1.2.</span> <span class="toc-text">创建体素图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">12.2.</span> <span class="toc-text">体素图层设置和属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E7%9B%AE%E5%BD%95%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.2.1.</span> <span class="toc-text">从目录中获取体素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%9B%AE%E5%BD%95%E7%BB%84"><span class="toc-number">12.2.2.</span> <span class="toc-text">操作体素图层目录组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E7%9B%AE%E5%BD%95%E4%B8%AD%E8%8E%B7%E5%8F%96-x2F-%E8%AE%BE%E7%BD%AE%E9%80%89%E5%AE%9A%E7%9A%84%E4%BD%93%E7%B4%A0%E8%B5%84%E6%BA%90"><span class="toc-number">12.2.3.</span> <span class="toc-text">从目录中获取&#x2F;设置选定的体素资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E4%BD%93%E7%B4%A0%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%88%E6%9E%9C"><span class="toc-number">12.2.4.</span> <span class="toc-text">更改体素可视化效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%85%A7%E6%98%8E%E5%B1%9E%E6%80%A7%E3%80%81%E5%81%8F%E7%A7%BB%E3%80%81%E5%9E%82%E7%9B%B4%E5%A4%B8%E5%A4%A7"><span class="toc-number">12.2.5.</span> <span class="toc-text">照明属性、偏移、垂直夸大</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BD%93%E7%B4%A0%E4%BD%93%E7%A7%AF%E7%BB%B4%E5%BA%A6"><span class="toc-number">12.2.6.</span> <span class="toc-text">获取体素体积维度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">12.3.</span> <span class="toc-text">事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%AF%B9%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82%E7%9A%84%E6%9B%B4%E6%94%B9"><span class="toc-number">12.3.1.</span> <span class="toc-text">订阅对体素图层的更改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">12.4.</span> <span class="toc-text">变量配置文件 + 渲染器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%80%89%E5%AE%9A%E7%9A%84%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">12.4.1.</span> <span class="toc-text">获取选定的变量配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E9%80%89%E5%AE%9A%E7%9A%84%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">12.4.2.</span> <span class="toc-text">更改选定的变量配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">12.4.3.</span> <span class="toc-text">获取变量配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%98%E9%87%8F%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">12.4.4.</span> <span class="toc-text">获取变量渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8B%89%E4%BC%B8%E6%B8%B2%E6%9F%93%E5%99%A8%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E5%92%8C%E9%A2%9C%E8%89%B2%E8%8C%83%E5%9B%B4"><span class="toc-number">12.4.5.</span> <span class="toc-text">访问拉伸渲染器的统计信息和颜色范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%8B%89%E4%BC%B8%E6%B8%B2%E6%9F%93%E5%99%A8%E9%A2%9C%E8%89%B2%E8%8C%83%E5%9B%B4"><span class="toc-number">12.4.6.</span> <span class="toc-text">更改拉伸渲染器颜色范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9-CIMVoxelColorUniqueValue-%E7%B1%BB%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-number">12.4.7.</span> <span class="toc-text">更改 CIMVoxelColorUniqueValue 类的可见性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%89%E5%80%BC%E9%9D%A2"><span class="toc-number">12.5.</span> <span class="toc-text">等值面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%8F%98%E9%87%8F%E7%9A%84%E6%9C%80%E5%A4%A7%E7%AD%89%E5%80%BC%E9%9D%A2%E6%95%B0"><span class="toc-number">12.5.1.</span> <span class="toc-text">检查变量的最大等值面数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%8F%98%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.5.2.</span> <span class="toc-text">检查变量的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5CanCreateIsoSurface"><span class="toc-number">12.5.3.</span> <span class="toc-text">检查CanCreateIsoSurface</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AD%89%E5%80%BC%E9%9D%A2"><span class="toc-number">12.5.4.</span> <span class="toc-text">创建等值面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E7%AD%89%E5%80%BC%E9%9D%A2%E4%B8%8A%E7%9A%84%E5%80%BC%E5%92%8C%E9%A2%9C%E8%89%B2"><span class="toc-number">12.5.5.</span> <span class="toc-text">如何更改等值面上的值和颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-Isourface-%E9%A2%9C%E8%89%B2%E6%9B%B4%E6%94%B9%E5%9B%9E%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">12.5.6.</span> <span class="toc-text">将 Isourface 颜色更改回默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%AD%89%E5%80%BC%E9%9D%A2"><span class="toc-number">12.5.7.</span> <span class="toc-text">删除等值面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%87"><span class="toc-number">12.6.</span> <span class="toc-text">片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%88%87%E7%89%87%E9%9B%86%E5%90%88"><span class="toc-number">12.6.1.</span> <span class="toc-text">获取切片集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%88%87%E7%89%87"><span class="toc-number">12.6.2.</span> <span class="toc-text">获取切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%B8%AD%E7%9A%84%E9%80%89%E5%AE%9A%E5%88%87%E7%89%87"><span class="toc-number">12.6.3.</span> <span class="toc-text">获取目录中的选定切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%B8%AD%E6%89%80%E9%80%89%E5%88%87%E7%89%87%E7%9A%84%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.6.4.</span> <span class="toc-text">获取目录中所选切片的体素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%87%E7%89%87"><span class="toc-number">12.6.5.</span> <span class="toc-text">创建切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%88%87%E7%89%87%E7%9A%84%E5%80%BE%E6%96%9C%E5%BA%A6"><span class="toc-number">12.6.6.</span> <span class="toc-text">更改切片的倾斜度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%87%E7%89%87"><span class="toc-number">12.6.7.</span> <span class="toc-text">删除切片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E5%88%86"><span class="toc-number">12.7.</span> <span class="toc-text">部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%83%A8%E5%88%86"><span class="toc-number">12.7.1.</span> <span class="toc-text">获取部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%83%A8%E5%88%86%E9%9B%86%E5%90%88"><span class="toc-number">12.7.2.</span> <span class="toc-text">获取当前部分集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%B8%AD%E7%9A%84%E9%80%89%E5%AE%9A%E9%83%A8%E5%88%86"><span class="toc-number">12.7.3.</span> <span class="toc-text">获取目录中的选定部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%B8%AD%E6%89%80%E9%80%89%E9%83%A8%E5%88%86%E7%9A%84%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.7.4.</span> <span class="toc-text">获取目录中所选部分的体素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%BD%93%E7%B4%A0%E4%B8%AD%E7%82%B9%E5%A4%84%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%89%96%E9%9D%A2"><span class="toc-number">12.7.5.</span> <span class="toc-text">在体素中点处创建一个剖面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B0%B4%E5%B9%B3%E5%89%96%E9%9D%A2"><span class="toc-number">12.7.6.</span> <span class="toc-text">创建水平剖面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%9C%86%E5%BD%A2%E6%A8%A1%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%88%AA%E9%9D%A2"><span class="toc-number">12.7.7.</span> <span class="toc-text">以圆形模式创建截面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B0%86%E4%BD%93%E7%B4%A0%E5%B9%B3%E5%88%86%E7%9A%84%E9%83%A8%E5%88%86"><span class="toc-number">12.7.8.</span> <span class="toc-text">创建将体素平分的部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%BD%93%E7%B4%A0%E5%AF%B9%E8%A7%92%E7%BA%BF%E4%B8%8A%E5%88%9B%E5%BB%BA%E6%88%AA%E9%9D%A2"><span class="toc-number">12.7.9.</span> <span class="toc-text">在体素对角线上创建截面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%88%AA%E9%9D%A2%E6%96%B9%E5%90%91%E5%92%8C%E5%80%BE%E6%96%9C%E5%BA%A6"><span class="toc-number">12.7.10.</span> <span class="toc-text">更新截面方向和倾斜度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%89%88%E5%9D%97%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-number">12.7.11.</span> <span class="toc-text">更新版块可见性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%83%A8%E5%88%86"><span class="toc-number">12.7.12.</span> <span class="toc-text">删除部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86"><span class="toc-number">12.8.</span> <span class="toc-text">锁定部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86%E7%9A%84%E5%BD%93%E5%89%8D%E9%9B%86%E5%90%88"><span class="toc-number">12.8.1.</span> <span class="toc-text">获取锁定部分的当前集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%94%81%E5%AE%9A%E7%9A%84%E9%83%A8%E5%88%86"><span class="toc-number">12.8.2.</span> <span class="toc-text">获取锁定的部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%9B%AE%E5%BD%95%E4%B8%AD%E8%8E%B7%E5%8F%96%E9%80%89%E5%AE%9A%E7%9A%84%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86"><span class="toc-number">12.8.3.</span> <span class="toc-text">在目录中获取选定的锁定部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%B8%AD%E6%89%80%E9%80%89%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86%E7%9A%84%E4%BD%93%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">12.8.4.</span> <span class="toc-text">获取目录中所选锁定部分的体素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E9%80%89%E5%AE%9A%E7%9A%84%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86%E8%AE%BE%E7%BD%AE%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">12.8.5.</span> <span class="toc-text">为选定的锁定部分设置活动的变量配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E5%AE%9A%E5%88%86%E5%8C%BA-x2F-%E2%80%9C%E5%88%9B%E5%BB%BA%E2%80%9D%E9%94%81%E5%AE%9A%E5%88%86%E5%8C%BA"><span class="toc-number">12.8.6.</span> <span class="toc-text">锁定分区&#x2F;“创建”锁定分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-number">12.8.7.</span> <span class="toc-text">更新锁定部分可见性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%94%81%E9%94%81%E5%AE%9A%E9%83%A8%E5%88%86"><span class="toc-number">12.8.8.</span> <span class="toc-text">解锁锁定部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%94%81%E5%AE%9A%E7%9A%84%E5%88%86%E5%8C%BA"><span class="toc-number">12.8.9.</span> <span class="toc-text">删除锁定的分区</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E6%8E%A2%E7%B4%A2"><span class="toc-number">13.</span> <span class="toc-text">地图探索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE"><span class="toc-number">13.1.</span> <span class="toc-text">地图视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%A7%86%E5%9B%BE%E6%98%AF%E5%90%A6%E4%B8%BA-3D-%E8%A7%86%E5%9B%BE"><span class="toc-number">13.1.1.</span> <span class="toc-text">测试视图是否为 3D 视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%9F%A5%E7%9C%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.1.2.</span> <span class="toc-text">设置查看模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E8%A7%86%E5%9B%BE%E9%93%BE%E6%8E%A5"><span class="toc-number">13.1.3.</span> <span class="toc-text">启用视图链接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E8%8C%83%E5%9B%B4%EF%BC%88%E7%BC%A9%E6%94%BE%E3%80%81%E5%B9%B3%E7%A7%BB%E7%AD%89%EF%BC%89"><span class="toc-number">13.2.</span> <span class="toc-text">更新地图视图范围（缩放、平移等）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%9B%B8%E6%9C%BA"><span class="toc-number">13.2.1.</span> <span class="toc-text">转到上一个相机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%88%B0%E4%B8%8B%E4%B8%80%E4%B8%AA%E7%9B%B8%E6%9C%BA"><span class="toc-number">13.2.2.</span> <span class="toc-text">转到下一个相机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E5%85%A8%E5%9B%BE%E8%8C%83%E5%9B%B4"><span class="toc-number">13.2.3.</span> <span class="toc-text">缩放至全图范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E6%94%BE%E5%A4%A7"><span class="toc-number">13.2.4.</span> <span class="toc-text">固定放大</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E7%BC%A9%E5%B0%8F"><span class="toc-number">13.2.5.</span> <span class="toc-text">固定缩小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E6%9F%90%E4%B8%AA%E8%8C%83%E5%9B%B4"><span class="toc-number">13.2.6.</span> <span class="toc-text">缩放至某个范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E7%82%B9"><span class="toc-number">13.2.7.</span> <span class="toc-text">缩放至点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0"><span class="toc-number">13.2.8.</span> <span class="toc-text">缩放至所选要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%90%8D%E7%A7%B0%E7%BC%A9%E6%94%BE%E8%87%B3%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.2.9.</span> <span class="toc-text">按名称缩放至书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E5%8F%AF%E8%A7%81%E5%9B%BE%E5%B1%82"><span class="toc-number">13.2.10.</span> <span class="toc-text">缩放至可见图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%87%B3%E6%89%80%E9%80%89%E5%9B%BE%E5%B1%82"><span class="toc-number">13.2.11.</span> <span class="toc-text">缩放至所选图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E5%AE%9A%E7%A8%8B%E5%BA%A6%E4%B8%8A%E5%B9%B3%E7%A7%BB"><span class="toc-number">13.2.12.</span> <span class="toc-text">在一定程度上平移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E7%A7%BB%E5%88%B0%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0"><span class="toc-number">13.2.13.</span> <span class="toc-text">平移到所选要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E7%A7%BB%E5%88%B0%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.2.14.</span> <span class="toc-text">平移到书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E7%A7%BB%E5%88%B0%E5%8F%AF%E8%A7%81%E5%9B%BE%E5%B1%82"><span class="toc-number">13.2.15.</span> <span class="toc-text">平移到可见图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%B9%B3%E7%A7%BB%E5%88%B0%E6%89%80%E9%80%89%E5%9B%BE%E5%B1%82"><span class="toc-number">13.2.16.</span> <span class="toc-text">异步平移到所选图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE"><span class="toc-number">13.2.17.</span> <span class="toc-text">旋转地图视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E5%BC%80%E8%8C%83%E5%9B%B4"><span class="toc-number">13.2.18.</span> <span class="toc-text">展开范围</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE-1"><span class="toc-number">13.3.</span> <span class="toc-text">地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">13.3.1.</span> <span class="toc-text">获取活动地图的名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E9%80%89%E6%8B%A9"><span class="toc-number">13.3.2.</span> <span class="toc-text">清除活动地图中的所有选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%9C%B0%E5%9B%BE%E5%8D%95%E4%BD%8D%E8%AE%A1%E7%AE%97%E9%80%89%E6%8B%A9%E5%AE%B9%E5%B7%AE"><span class="toc-number">13.3.3.</span> <span class="toc-text">以地图单位计算选择容差</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E5%8F%A0%E5%8A%A0%E6%8E%A7%E5%88%B6"><span class="toc-number">13.3.4.</span> <span class="toc-text">地图视图叠加控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%82"><span class="toc-number">13.4.</span> <span class="toc-text">层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E7%9B%AE%E5%BD%95%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82"><span class="toc-number">13.4.1.</span> <span class="toc-text">选择目录中的所有要素图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AA%E7%83%81%E6%89%80%E9%80%89%E5%8A%9F%E8%83%BD"><span class="toc-number">13.4.2.</span> <span class="toc-text">闪烁所选功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%9B%BE%E5%B1%82%E5%9C%A8%E7%BB%99%E5%AE%9A%E7%9A%84%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A7%81"><span class="toc-number">13.4.3.</span> <span class="toc-text">检查图层在给定的地图视图中是否可见</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E5%9B%BE%E5%B1%82%E5%B9%B6%E6%89%93%E5%BC%80%E5%85%B6%E5%9B%BE%E5%B1%82%E5%B1%9E%E6%80%A7%E9%A1%B5%E9%9D%A2"><span class="toc-number">13.4.4.</span> <span class="toc-text">选择一个图层并打开其图层属性页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E7%89%B9%E5%AE%9A%E5%9B%BE%E5%B1%82%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">13.4.5.</span> <span class="toc-text">清除特定图层的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E6%88%90%E5%91%98%E7%9A%84%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%AA%97%E6%A0%BC"><span class="toc-number">13.4.6.</span> <span class="toc-text">地图成员的显示表窗格</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%BE%81"><span class="toc-number">13.5.</span> <span class="toc-text">特征</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%AE%E7%BD%A9%E5%8A%9F%E8%83%BD"><span class="toc-number">13.5.1.</span> <span class="toc-text">遮罩功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.</span> <span class="toc-text">弹出窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%A6%81%E7%B4%A0%E7%9A%84%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.1.</span> <span class="toc-text">显示要素的弹出窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.2.</span> <span class="toc-text">显示自定义弹出窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E5%B1%9E%E6%80%A7%E6%98%BE%E7%A4%BA%E8%A6%81%E7%B4%A0%E7%9A%84%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.3.</span> <span class="toc-text">使用弹出窗口属性显示要素的弹出窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E5%B1%9E%E6%80%A7%E6%98%BE%E7%A4%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.4.</span> <span class="toc-text">使用弹出窗口属性显示自定义弹出窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%B8%A6%E6%9C%89%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4%E7%9A%84%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.5.</span> <span class="toc-text">显示带有自定义命令的弹出窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%8A%A8%E6%80%81%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">13.6.6.</span> <span class="toc-text">显示动态弹出窗口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.</span> <span class="toc-text">书签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B4%BB%E5%8A%A8%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E5%88%9B%E5%BB%BA%E6%96%B0%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.1.</span> <span class="toc-text">使用活动地图视图创建新书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%81%94%E6%98%8C%E5%9B%BD%E9%99%85%E6%B7%BB%E5%8A%A0%E6%96%B0%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.2.</span> <span class="toc-text">从联昌国际添加新书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B9%A6%E7%AD%BE%E9%9B%86%E5%90%88"><span class="toc-number">13.7.3.</span> <span class="toc-text">获取项目的书签集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9B%BE%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.4.</span> <span class="toc-text">获取地图书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E4%B9%A6%E7%AD%BE%E7%A7%BB%E5%88%B0%E9%A1%B6%E9%83%A8"><span class="toc-number">13.7.5.</span> <span class="toc-text">将书签移到顶部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.6.</span> <span class="toc-text">重命名书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%B7%E6%9C%89%E7%BB%99%E5%AE%9A%E5%90%8D%E7%A7%B0%E7%9A%84%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.7.</span> <span class="toc-text">删除具有给定名称的书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E4%B9%A6%E7%AD%BE%E7%9A%84%E7%BC%A9%E7%95%A5%E5%9B%BE"><span class="toc-number">13.7.8.</span> <span class="toc-text">更改书签的缩略图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B9%A6%E7%AD%BE"><span class="toc-number">13.7.9.</span> <span class="toc-text">更新书签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B9%A6%E7%AD%BE%E7%9A%84%E8%8C%83%E5%9B%B4"><span class="toc-number">13.7.10.</span> <span class="toc-text">更新书签的范围</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">13.8.</span> <span class="toc-text">时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%8F%90%E5%89%8D-1-%E4%B8%AA%E6%9C%88"><span class="toc-number">13.8.1.</span> <span class="toc-text">时间提前 1 个月</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E5%9C%B0%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4%E3%80%82"><span class="toc-number">13.8.2.</span> <span class="toc-text">禁用地图中的时间。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">13.9.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%8A%A8%E7%94%BB%E9%95%BF%E5%BA%A6"><span class="toc-number">13.9.1.</span> <span class="toc-text">设置动画长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%8A%A8%E7%94%BB"><span class="toc-number">13.9.2.</span> <span class="toc-text">缩放动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E6%9C%BA%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="toc-number">13.9.3.</span> <span class="toc-text">相机关键帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%80%BC%E7%9B%B8%E6%9C%BA"><span class="toc-number">13.9.4.</span> <span class="toc-text">插值相机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%80%BC%E6%97%B6%E9%97%B4"><span class="toc-number">13.9.5.</span> <span class="toc-text">插值时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%80%BC%E8%8C%83%E5%9B%B4"><span class="toc-number">13.9.6.</span> <span class="toc-text">插值范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%91%84%E5%83%8F%E6%9C%BA%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="toc-number">13.9.7.</span> <span class="toc-text">创建摄像机关键帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%97%B6%E9%97%B4%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="toc-number">13.9.8.</span> <span class="toc-text">创建时间关键帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%8C%83%E5%9B%B4%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="toc-number">13.9.9.</span> <span class="toc-text">创建范围关键帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%B1%82%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="toc-number">13.9.10.</span> <span class="toc-text">创建图层关键帧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%8F%A0%E5%8A%A0"><span class="toc-number">13.10.</span> <span class="toc-text">图形叠加</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%8F%A0%E5%8A%A0-1"><span class="toc-number">13.10.1.</span> <span class="toc-text">图形叠加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%8F%A0%E5%8A%A0%E4%B8%8E-CIMPicture%E5%9B%BE%E5%BD%A2"><span class="toc-number">13.10.2.</span> <span class="toc-text">图形叠加与 CIMPicture图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%B8%A6%E6%9C%89%E6%96%87%E6%9C%AC%E7%9A%84%E5%8F%A0%E5%8A%A0%E5%9B%BE%E5%BD%A2"><span class="toc-number">13.10.3.</span> <span class="toc-text">添加带有文本的叠加图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">13.11.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E8%8D%89%E5%9B%BE%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AC%A6%E5%8F%B7"><span class="toc-number">13.11.1.</span> <span class="toc-text">更改草图工具的符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E4%BA%8E%E5%9C%B0%E5%9B%BE%E4%B8%AD%E5%8D%95%E5%87%BB%E7%9A%84%E7%82%B9%E7%9A%84%E8%BF%94%E5%9B%9E%E5%9D%90%E6%A0%87%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">13.11.2.</span> <span class="toc-text">创建用于地图中单击的点的返回坐标的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E4%BA%8E%E8%AF%86%E5%88%AB%E4%B8%8E%E8%8D%89%E5%9B%BE%E5%87%A0%E4%BD%95%E7%9B%B8%E4%BA%A4%E7%9A%84%E7%89%B9%E5%BE%81%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">13.11.3.</span> <span class="toc-text">创建用于识别与草图几何相交的特征的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%B7%A5%E5%85%B7%E7%9A%84%E5%85%89%E6%A0%87"><span class="toc-number">13.11.4.</span> <span class="toc-text">更改工具的光标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%8F%AF%E5%B5%8C%E5%85%A5%E6%8E%A7%E4%BB%B6%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">13.11.5.</span> <span class="toc-text">具有可嵌入控件的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%8F%AF%E5%B5%8C%E5%85%A5%E5%8F%A0%E5%8A%A0%E6%8E%A7%E4%BB%B6%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">13.11.6.</span> <span class="toc-text">具有可嵌入叠加控件的工具</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB"><span class="toc-number">14.</span> <span class="toc-text">共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ArcGIS-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B4%BB%E5%8A%A8%E9%97%A8%E6%88%B7"><span class="toc-number">14.0.1.</span> <span class="toc-text">ArcGIS 项目管理器：获取当前活动门户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ArcGIS-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%9A%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%97%A8%E6%88%B7%E7%9A%84%E5%88%97%E8%A1%A8"><span class="toc-number">14.0.2.</span> <span class="toc-text">ArcGIS 项目管理器：获取所有门户的列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ArcGIS-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%9A%E5%B0%86%E9%97%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%97%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">14.0.3.</span> <span class="toc-text">ArcGIS 项目管理器：将门户添加到门户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ArcGIS-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%9A%E8%8E%B7%E5%8F%96%E9%97%A8%E6%88%B7%E5%B9%B6%E7%99%BB%E5%BD%95%EF%BC%8C%E5%B0%86%E5%85%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%B4%BB%E5%8A%A8%E7%8A%B6%E6%80%81"><span class="toc-number">14.0.4.</span> <span class="toc-text">ArcGIS 项目管理器：获取门户并登录，将其设置为活动状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ArcGIS-%E7%A8%8B%E5%BA%8F%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%9A%E4%BE%A6%E5%90%AC%E9%97%A8%E6%88%B7%E4%BA%8B%E4%BB%B6"><span class="toc-number">14.0.5.</span> <span class="toc-text">ArcGIS 程序管理器：侦听门户事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E4%BB%8E%E6%B4%BB%E5%8A%A8%E9%97%A8%E6%88%B7%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7"><span class="toc-number">14.0.6.</span> <span class="toc-text">门户：从活动门户获取当前登录用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E7%9A%84%E2%80%9C%E8%81%94%E6%9C%BA%E2%80%9D%E9%97%A8%E6%88%B7%E8%A7%86%E5%9B%BE"><span class="toc-number">14.0.7.</span> <span class="toc-text">门户：获取当前用户的“联机”门户视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E7%9A%84%E7%BB%84%E7%BB%87-ID"><span class="toc-number">14.0.8.</span> <span class="toc-text">门户：获取当前用户的组织 ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E4%BB%8E%E6%B4%BB%E5%8A%A8%E9%97%A8%E6%88%B7%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E7%94%A8%E6%88%B7%E7%9A%84%E7%94%A8%E6%88%B7%E5%86%85%E5%AE%B9"><span class="toc-number">14.0.9.</span> <span class="toc-text">门户：从活动门户获取活动用户的用户内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E4%B8%8B%E8%BD%BD%E7%94%A8%E6%88%B7%E5%86%85%E5%AE%B9%E4%B8%AD%E7%9A%84%E4%BB%BB%E4%BD%95%E5%8C%85%E9%A1%B9"><span class="toc-number">14.0.10.</span> <span class="toc-text">门户：下载用户内容中的任何包项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E7%9A%84%E7%BB%84"><span class="toc-number">14.0.11.</span> <span class="toc-text">门户：获取指定用户的组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E6%88%B7%EF%BC%9A%E6%89%A7%E8%A1%8C%E9%97%A8%E6%88%B7%E6%90%9C%E7%B4%A2"><span class="toc-number">14.0.12.</span> <span class="toc-text">门户：执行门户搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EsriHttpClient%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7"><span class="toc-number">14.0.13.</span> <span class="toc-text">EsriHttpClient：获取当前登录用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E7%9A%84%E7%BB%84"><span class="toc-number">14.0.14.</span> <span class="toc-text">获取当前登录用户的组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EsriHttpClient%EF%BC%9A%E6%9F%A5%E8%AF%A2%E6%B4%BB%E5%8A%A8%E9%97%A8%E6%88%B7%E4%B8%8A%E7%9A%84-Esri-%E5%86%85%E5%AE%B9"><span class="toc-number">14.0.15.</span> <span class="toc-text">EsriHttpClient：查询活动门户上的 Esri 内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EsriHttpClient%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E7%9A%84-web-%E5%9C%B0%E5%9B%BE%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%B8%93%E4%B8%9A%E7%89%88"><span class="toc-number">14.0.16.</span> <span class="toc-text">EsriHttpClient：获取当前用户的 web 地图并将其添加到专业版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EsriHttpClient%EF%BC%9A%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%9B%BE%E5%B1%82%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%B8%93%E4%B8%9A%E7%89%88"><span class="toc-number">14.0.17.</span> <span class="toc-text">EsriHttpClient：获取服务图层并将其添加到专业版</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C-1"><span class="toc-number">15.</span> <span class="toc-text">公共设施网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C"><span class="toc-number">15.1.</span> <span class="toc-text">获取公共设施网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C"><span class="toc-number">15.1.1.</span> <span class="toc-text">从表中获取公共设施网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C"><span class="toc-number">15.1.2.</span> <span class="toc-text">从图层获取公共设施网络</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E7%B4%A0"><span class="toc-number">15.2.</span> <span class="toc-text">元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%83%E7%B4%A0%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%A1%8C"><span class="toc-number">15.2.1.</span> <span class="toc-text">从元素中获取行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%85%B3%E8%81%94"><span class="toc-number">15.3.</span> <span class="toc-text">编辑关联</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E5%85%B3%E8%81%94-1"><span class="toc-number">15.3.1.</span> <span class="toc-text">创建公共设施网络关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8D%95%E4%B8%AA%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E8%A6%81%E7%B4%A0%E5%92%8C%E5%85%B3%E8%81%94-1"><span class="toc-number">15.3.2.</span> <span class="toc-text">在单个编辑操作中创建公共设施网络要素和关联</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E5%85%B3%E8%81%94"><span class="toc-number">15.4.</span> <span class="toc-text">遍历关联</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%90%91%E4%B8%8B%E9%81%8D%E5%8E%86%E4%BA%A7%E7%94%9F%E7%9A%84%E9%81%8D%E5%8E%86%E5%85%B3%E8%81%94"><span class="toc-number">15.4.1.</span> <span class="toc-text">获取向下遍历产生的遍历关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%B7%E6%9C%89%E6%B7%B1%E5%BA%A6%E9%99%90%E5%88%B6%E7%9A%84%E5%90%91%E4%B8%8A%E9%81%8D%E5%8E%86%E4%BA%A7%E7%94%9F%E7%9A%84%E9%81%8D%E5%8E%86%E5%85%B3%E8%81%94"><span class="toc-number">15.4.2.</span> <span class="toc-text">获取具有深度限制的向上遍历产生的遍历关联</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%92%8C%E5%B1%82"><span class="toc-number">15.5.</span> <span class="toc-text">子网和层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%BB%99%E5%AE%9A%E5%9F%9F%E7%BD%91%E7%BB%9C%E5%90%8D%E7%A7%B0%E5%92%8C%E5%B1%82%E5%90%8D%E7%A7%B0%E7%9A%84%E5%B1%82"><span class="toc-number">15.5.1.</span> <span class="toc-text">查找给定域网络名称和层名称的层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%B1%82%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%84%8F%E5%AD%90%E7%BD%91"><span class="toc-number">15.5.2.</span> <span class="toc-text">更新层中的所有脏子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E4%B8%80%E4%B8%AA%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E7%AE%80%E5%8D%95%E5%BE%84%E5%90%91%E5%AD%90%E7%BD%91%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">15.5.3.</span> <span class="toc-text">具有一个控制器的简单径向子网的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%A4%9A%E4%B8%AA%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E7%BD%91%E6%A0%BC%E5%AD%90%E7%BD%91%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">15.5.4.</span> <span class="toc-text">具有多个控制器的网格子网的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E4%B8%A4%E4%B8%AA%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E9%87%8D%E9%A6%88%E5%BE%84%E5%90%91%E5%AD%90%E7%BD%91%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">15.5.5.</span> <span class="toc-text">具有两个控制器的重馈径向子网的生命周期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%8F%E5%9B%BE"><span class="toc-number">15.6.</span> <span class="toc-text">描图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8B%E6%B8%B8%E8%B7%9F%E8%B8%AA%E7%A8%8B%E5%BA%8F"><span class="toc-number">15.6.1.</span> <span class="toc-text">创建下游跟踪程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%9F%E8%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">15.6.2.</span> <span class="toc-text">创建跟踪参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9D%A1%E4%BB%B6%E4%BB%A5%E5%B0%86%E7%BD%91%E7%BB%9C%E5%B1%9E%E6%80%A7%E4%B8%8E%E4%B8%80%E7%BB%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E6%AF%94%E8%BE%83"><span class="toc-number">15.6.3.</span> <span class="toc-text">创建条件以将网络属性与一组值进行比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">15.6.4.</span> <span class="toc-text">创建函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%B1%8F%E9%9A%9C"><span class="toc-number">15.6.5.</span> <span class="toc-text">创建功能屏障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BE%93%E5%87%BA%E6%9D%A1%E4%BB%B6"><span class="toc-number">15.6.6.</span> <span class="toc-text">创建输出条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BC%A0%E6%92%AD%E5%99%A8"><span class="toc-number">15.6.7.</span> <span class="toc-text">创建传播器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E7%BB%93%E6%9E%9C"><span class="toc-number">15.6.8.</span> <span class="toc-text">使用函数结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%90%8D%E7%A7%B0%E8%8E%B7%E5%8F%96%E5%91%BD%E5%90%8D%E8%B7%9F%E8%B8%AA%E9%85%8D%E7%BD%AE"><span class="toc-number">15.6.9.</span> <span class="toc-text">按名称获取命名跟踪配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E8%BF%BD%E8%B8%AA%E9%85%8D%E7%BD%AE"><span class="toc-number">15.6.10.</span> <span class="toc-text">从公共设施网络图层获取指定追踪配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E8%BF%BD%E8%B8%AA%E9%85%8D%E7%BD%AE%E8%BF%BD%E8%B8%AA%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C"><span class="toc-number">15.6.11.</span> <span class="toc-text">使用指定追踪配置追踪公共设施网络</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9B%BE"><span class="toc-number">15.7.</span> <span class="toc-text">网络图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">15.7.1.</span> <span class="toc-text">获取图管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E5%9B%BE"><span class="toc-number">15.7.2.</span> <span class="toc-text">获取网络图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%B7%E6%9C%89%E4%B8%8D%E4%B8%80%E8%87%B4%E4%B8%80%E8%87%B4%E6%80%A7%E7%8A%B6%E6%80%81%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9B%BE%E5%88%97%E8%A1%A8"><span class="toc-number">15.7.3.</span> <span class="toc-text">获取具有不一致一致性状态的网络图列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E7%BD%91%E7%BB%9C%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E4%B8%AD%E6%89%93%E5%BC%80%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E7%AA%97%E6%A0%BC"><span class="toc-number">15.7.4.</span> <span class="toc-text">从网络逻辑示意图中打开逻辑示意图窗格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%85%B3%E7%B3%BB%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="toc-number">15.7.5.</span> <span class="toc-text">从关系图层获取关系图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">15.7.6.</span> <span class="toc-text">获取图表模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E6%A8%A1%E6%9D%BF%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-number">15.7.7.</span> <span class="toc-text">从逻辑示意图模板获取网络逻辑示意图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%9B%BE"><span class="toc-number">15.7.8.</span> <span class="toc-text">创建网络图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BD%A2%E5%BC%8F%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E4%BF%A1%E6%81%AF"><span class="toc-number">15.7.9.</span> <span class="toc-text">以 JSON 字符串形式获取网络逻辑示意图信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%85%83%E7%B4%A0"><span class="toc-number">15.7.10.</span> <span class="toc-text">获取图元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E8%81%9A%E5%90%88"><span class="toc-number">15.7.11.</span> <span class="toc-text">获取逻辑示意图聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E4%B8%80%E7%BB%84%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E8%A1%8C%E7%9A%84%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E8%A6%81%E7%B4%A0"><span class="toc-number">15.7.12.</span> <span class="toc-text">查找一组公共设施网络行的逻辑示意图要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E4%B8%80%E7%BB%84%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E8%A6%81%E7%B4%A0%E7%9A%84%E5%85%AC%E5%85%B1%E8%AE%BE%E6%96%BD%E7%BD%91%E7%BB%9C%E8%A1%8C"><span class="toc-number">15.7.13.</span> <span class="toc-text">查找一组逻辑示意图要素的公共设施网络行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%94%A8%E4%BA%8E%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E7%9A%84%E5%88%9D%E5%A7%8B%E7%BD%91%E7%BB%9C%E8%A1%8C"><span class="toc-number">15.7.14.</span> <span class="toc-text">查找用于创建网络逻辑示意图的初始网络行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%BD%91%E7%BB%9C%E9%80%BB%E8%BE%91%E7%A4%BA%E6%84%8F%E5%9B%BE%E7%9A%84%E5%B8%83%E5%B1%80"><span class="toc-number">15.7.15.</span> <span class="toc-text">更改网络逻辑示意图的布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E7%BD%91%E7%BB%9C%E5%9B%BE"><span class="toc-number">15.7.16.</span> <span class="toc-text">编辑网络图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84"><span class="toc-number">16.</span> <span class="toc-text">宗地结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B4%BB%E5%8A%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">16.0.1.</span> <span class="toc-text">获取活动记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%B4%BB%E5%8A%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">16.0.2.</span> <span class="toc-text">设置活动记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E8%AE%B0%E5%BD%95"><span class="toc-number">16.0.3.</span> <span class="toc-text">创建新记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%A0%87%E5%87%86%E7%BA%BF%E8%A6%81%E7%B4%A0%E5%A4%8D%E5%88%B6%E5%88%B0%E5%AE%97%E5%9C%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">16.0.4.</span> <span class="toc-text">将标准线要素复制到宗地类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%AE%97%E5%9C%B0%E8%A1%8C%E5%A4%8D%E5%88%B6%E5%88%B0%E5%AE%97%E5%9C%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">16.0.5.</span> <span class="toc-text">将宗地行复制到宗地类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A6%81%E7%B4%A0%E5%88%86%E9%85%8D%E7%BB%99%E6%B4%BB%E5%8A%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">16.0.6.</span> <span class="toc-text">将要素分配给活动记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%97%E5%9C%B0%E7%A7%8D%E5%AD%90"><span class="toc-number">16.0.7.</span> <span class="toc-text">创建宗地种子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%AE%97%E5%9C%B0"><span class="toc-number">16.0.8.</span> <span class="toc-text">构建宗地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E7%9A%84%E5%8C%85%E8%A3%B9"><span class="toc-number">16.0.9.</span> <span class="toc-text">重复的包裹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%8E%86%E5%8F%B2%E5%AE%97%E5%9C%B0"><span class="toc-number">16.0.10.</span> <span class="toc-text">设置历史宗地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%8C%85%E8%A3%B9%E6%94%B6%E7%BC%A9%E4%B8%BA%E7%A7%8D%E5%AD%90"><span class="toc-number">16.0.11.</span> <span class="toc-text">将包裹收缩为种子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%AE%97%E5%9C%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">16.0.12.</span> <span class="toc-text">更改宗地类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E8%A6%81%E7%B4%A0"><span class="toc-number">16.0.13.</span> <span class="toc-text">获取宗地要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%97%E5%9C%B0%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">16.0.14.</span> <span class="toc-text">从宗地图层获取宗地结构数据集控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E5%AE%97%E5%9C%B0%E6%8B%93%E6%89%91"><span class="toc-number">16.0.15.</span> <span class="toc-text">获取宗地结构数据集的宗地拓扑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%82%B9%E3%80%81%E8%BF%9E%E6%8E%A5%E5%92%8C%E8%AE%B0%E5%BD%95%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">16.0.16.</span> <span class="toc-text">从宗地结构数据集中获取点、连接和记录要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E9%9B%86%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E7%B1%BB%E5%9E%8B%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">16.0.17.</span> <span class="toc-text">从宗地结构数据集获取宗地类型要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A6%81%E7%B4%A0%E5%9B%BE%E5%B1%82%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E7%B1%BB%E5%9E%8B%E5%90%8D%E7%A7%B0"><span class="toc-number">16.0.18.</span> <span class="toc-text">从要素图层获取宗地类型名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%A1%A8%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%AE%97%E5%9C%B0%E7%BB%93%E6%9E%84"><span class="toc-number">16.0.19.</span> <span class="toc-text">从表中获取宗地结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%89%E6%A0%85"><span class="toc-number">17.</span> <span class="toc-text">光栅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%93%E5%BC%80%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">17.0.1.</span> <span class="toc-text">在文件夹中打开栅格数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%89%93%E5%BC%80%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">17.0.2.</span> <span class="toc-text">在地理数据库中打开栅格数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86%E8%8E%B7%E5%8F%96%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86%E5%AE%9A%E4%B9%89"><span class="toc-number">17.0.3.</span> <span class="toc-text">从栅格数据集获取栅格数据集定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E7%9A%84%E6%B3%A2%E6%AE%B5"><span class="toc-number">17.0.4.</span> <span class="toc-text">访问栅格数据集中的波段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%85%E6%A0%BC%E5%B1%9E%E6%80%A7%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%A1%8C"><span class="toc-number">17.0.5.</span> <span class="toc-text">访问栅格属性表中的行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC%E5%85%89%E6%A0%87%E4%BB%A5%E5%BE%AA%E7%8E%AF%E8%AE%BF%E9%97%AE%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE"><span class="toc-number">17.0.6.</span> <span class="toc-text">创建栅格光标以循环访问栅格数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%83%8F%E7%B4%A0%E5%9D%97%E5%9C%A8%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5%E5%83%8F%E7%B4%A0"><span class="toc-number">17.0.7.</span> <span class="toc-text">使用像素块在栅格数据集中读取和写入像素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%83%8F%E7%B4%A0%E5%9D%97%E5%A4%84%E7%90%86%E5%83%8F%E7%B4%A0"><span class="toc-number">17.0.8.</span> <span class="toc-text">使用像素块处理像素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%A0%85%E6%A0%BC%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">17.0.9.</span> <span class="toc-text">计算栅格统计数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82"><span class="toc-number">18.</span> <span class="toc-text">场景图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AD%91%E9%A2%86%E5%9F%9F%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82"><span class="toc-number">18.1.</span> <span class="toc-text">建筑领域场景图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BB%BA%E7%AD%91%E8%A7%84%E7%A8%8B%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%A7%84%E7%A8%8B"><span class="toc-number">18.1.1.</span> <span class="toc-text">获取建筑规程场景图层规程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E7%9A%84%E9%A2%86%E5%9F%9F%E5%9B%BE%E5%B1%82"><span class="toc-number">18.1.2.</span> <span class="toc-text">枚举建筑物场景图层中的领域图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82"><span class="toc-number">18.2.</span> <span class="toc-text">建筑物场景图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">18.2.1.</span> <span class="toc-text">建筑物场景图层的名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%80%BC"><span class="toc-number">18.2.2.</span> <span class="toc-text">查询建筑物场景图层以获取可用的类型和值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%BB%98%E8%AE%A4%E7%AD%9B%E9%80%89%E5%99%A8%E5%B9%B6%E8%8E%B7%E5%8F%96%E7%AD%9B%E9%80%89%E5%99%A8%E8%AE%A1%E6%95%B0"><span class="toc-number">18.2.3.</span> <span class="toc-text">创建默认筛选器并获取筛选器计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8C%85%E5%90%AB%E7%BA%BF%E6%A1%86%E5%9D%97%E7%9A%84%E6%89%80%E6%9C%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.2.4.</span> <span class="toc-text">获取包含线框块的所有过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%B8%85%E9%99%A4%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E6%B4%BB%E5%8A%A8%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.2.5.</span> <span class="toc-text">设置和清除建筑物场景图层的活动过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%BF%87%E6%BB%A4%E5%99%A8-ID-%E5%92%8C%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.2.6.</span> <span class="toc-text">获取建筑物场景图层过滤器 ID 和过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%BF%87%E6%BB%A4%E5%99%A8%E5%90%8D%E7%A7%B0%E5%92%8C%E6%8F%8F%E8%BF%B0"><span class="toc-number">18.2.7.</span> <span class="toc-text">修改建筑物场景图层过滤器名称和描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E7%AD%91%E7%89%A9%E6%A0%87%E9%AB%98%E5%92%8C%E7%B1%BB%E5%88%AB%E5%88%9B%E5%BB%BA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.2.8.</span> <span class="toc-text">使用建筑物标高和类别创建过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9D%97"><span class="toc-number">18.2.9.</span> <span class="toc-text">修改建筑物场景图层过滤器块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E5%BB%BA%E7%AD%91%E7%89%A9%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.2.10.</span> <span class="toc-text">移除建筑物场景图层过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%BC%96%E8%BE%91"><span class="toc-number">18.3.</span> <span class="toc-text">要素场景图层编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E7%BC%96%E8%BE%91"><span class="toc-number">18.3.1.</span> <span class="toc-text">确定要素场景图层是否支持编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%96%B0%E7%82%B9%E8%A6%81%E7%B4%A0"><span class="toc-number">18.3.2.</span> <span class="toc-text">在要素场景图层中创建新点要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E9%80%89%E5%AE%9A%E8%A6%81%E7%B4%A0"><span class="toc-number">18.3.3.</span> <span class="toc-text">删除要素场景图层中的所有选定要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">18.3.4.</span> <span class="toc-text">编辑要素场景图层的属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82"><span class="toc-number">18.4.</span> <span class="toc-text">要素场景图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">18.4.1.</span> <span class="toc-text">要素场景图层的名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">18.4.2.</span> <span class="toc-text">获取数据源类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%B3%E8%81%94%E7%9A%84%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">18.4.3.</span> <span class="toc-text">获取关联的要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%AE%9A%E4%B9%89"><span class="toc-number">18.4.4.</span> <span class="toc-text">获取字段定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2"><span class="toc-number">18.4.5.</span> <span class="toc-text">设置定义查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE%E9%80%89%E6%8B%A9%E8%A6%81%E7%B4%A0"><span class="toc-number">18.4.6.</span> <span class="toc-text">通过地图视图选择要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%85%B3%E8%81%94%E7%9A%84%E8%A6%81%E7%B4%A0%E6%9C%8D%E5%8A%A1"><span class="toc-number">18.4.7.</span> <span class="toc-text">具有关联的要素服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E8%A6%81%E7%B4%A0%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%8A%E7%9A%84%E8%A1%8C"><span class="toc-number">18.4.8.</span> <span class="toc-text">搜索要素场景图层上的行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E6%89%80%E9%80%89%E8%A6%81%E7%B4%A0%E5%92%8C%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F%E8%A6%81%E7%B4%A0"><span class="toc-number">18.4.9.</span> <span class="toc-text">隐藏所选要素和显示隐藏要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MapView-Select-SelectFeaturesEx-%E6%88%96-GetFeaturesEx"><span class="toc-number">18.4.10.</span> <span class="toc-text">使用 MapView Select SelectFeaturesEx 或 GetFeaturesEx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%A9%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8%E9%80%89%E6%8B%A9%E6%88%96%E6%90%9C%E7%B4%A2"><span class="toc-number">18.4.11.</span> <span class="toc-text">对空间查询使用选择或搜索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82"><span class="toc-number">18.5.</span> <span class="toc-text">点云场景图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">18.5.1.</span> <span class="toc-text">点云场景图层的名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">18.5.2.</span> <span class="toc-text">获取点云场景图层的数据源类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E7%B1%BB%E4%BB%A3%E7%A0%81%E5%92%8C%E6%A0%87%E7%AD%BE"><span class="toc-number">18.5.3.</span> <span class="toc-text">查询点云场景图层中的所有类代码和标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.5.4.</span> <span class="toc-text">为点云场景图层设置过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0-PointCloudSceneLayer-%E7%9A%84%E7%B1%BB%E6%A0%87%E5%BF%97"><span class="toc-number">18.5.5.</span> <span class="toc-text">更新 PointCloudSceneLayer 的类标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-PointCloudSceneLayer-%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.5.6.</span> <span class="toc-text">获取 PointCloudSceneLayer 的过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">18.5.7.</span> <span class="toc-text">清除点云场景图层中的过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E6%B8%B2%E6%9F%93%E5%99%A8%E5%92%8C%E6%B8%B2%E6%9F%93%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">18.5.8.</span> <span class="toc-text">获取点云场景图层渲染器和渲染器类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E6%B8%B2%E6%9F%93%E5%99%A8%E5%AD%97%E6%AE%B5"><span class="toc-number">18.5.9.</span> <span class="toc-text">查询点云场景图层渲染器字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E8%AE%BE%E7%BD%AE%E6%8B%89%E4%BC%B8%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">18.5.10.</span> <span class="toc-text">创建和设置拉伸渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E8%AE%BE%E7%BD%AE%E5%88%86%E7%B1%BB%E9%97%B4%E9%9A%94%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">18.5.11.</span> <span class="toc-text">创建和设置分类间隔渲染器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%B9%E4%BA%91%E5%9C%BA%E6%99%AF%E5%9B%BE%E5%B1%82%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7"><span class="toc-number">18.6.</span> <span class="toc-text">点云场景图层扩展属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%A2%9C%E8%89%B2%E8%B0%83%E5%88%B6"><span class="toc-number">18.6.1.</span> <span class="toc-text">编辑颜色调制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%B8%B2%E6%9F%93%E5%99%A8%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E5%A4%A7%E5%B0%8F"><span class="toc-number">18.6.2.</span> <span class="toc-text">编辑渲染器以使用固定大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%B8%B2%E6%9F%93%E5%99%A8%E4%BB%A5%E7%BC%A9%E6%94%BE%E5%A4%A7%E5%B0%8F"><span class="toc-number">18.6.3.</span> <span class="toc-text">编辑渲染器以缩放大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%AF%86%E5%BA%A6%E8%AE%BE%E7%BD%AE"><span class="toc-number">18.6.4.</span> <span class="toc-text">编辑密度设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.</span> <span class="toc-text">流图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.1.</span> <span class="toc-text">创建流图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-URI-%E5%88%9B%E5%BB%BA%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.1.1.</span> <span class="toc-text">使用 URI 创建流图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.1.2.</span> <span class="toc-text">使用定义查询创建流图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E6%B8%B2%E6%9F%93%E5%99%A8%E5%88%9B%E5%BB%BA%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.1.3.</span> <span class="toc-text">使用简单渲染器创建流图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E6%9C%80%E6%96%B0%E8%A7%82%E6%B5%8B%E5%80%BC%E8%AE%BE%E7%BD%AE%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">19.1.4.</span> <span class="toc-text">为最新观测值设置唯一值渲染器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">19.2.</span> <span class="toc-text">流图层设置和属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E5%8F%AF%E8%AF%86%E5%88%AB%E8%BD%A8%E8%BF%B9%E7%9A%84%E6%B5%81%E5%9B%BE%E5%B1%82"><span class="toc-number">19.2.1.</span> <span class="toc-text">查找所有可识别轨迹的流图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%B5%81%E5%9B%BE%E5%B1%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">19.2.2.</span> <span class="toc-text">确定流图层类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%B5%81%E5%9B%BE%E5%B1%82%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="toc-number">19.2.3.</span> <span class="toc-text">检查流图层连接状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%92%8C%E5%81%9C%E6%AD%A2%E6%B5%81%E5%BC%8F%E4%BC%A0%E8%BE%93"><span class="toc-number">19.2.4.</span> <span class="toc-text">开始和停止流式传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E5%BD%93%E5%89%8D%E5%92%8C%E4%BB%A5%E5%89%8D%E7%9A%84%E8%A7%82%E5%AF%9F%E7%BB%93%E6%9E%9C"><span class="toc-number">19.2.5.</span> <span class="toc-text">删除所有当前和以前的观察结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%B7%9F%E8%B8%AA-ID-%E5%AD%97%E6%AE%B5"><span class="toc-number">19.2.6.</span> <span class="toc-text">获取跟踪 ID 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9B%B2%E7%9B%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">19.2.7.</span> <span class="toc-text">获取曲目类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A6%81%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%85%88%E5%89%8D%E8%A7%82%E6%B5%8B%E5%80%BC%E7%9A%84%E6%9C%80%E5%A4%A7%E8%AE%A1%E6%95%B0"><span class="toc-number">19.2.8.</span> <span class="toc-text">设置要存储在内存中的先前观测值的最大计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A6%81%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%85%88%E5%89%8D%E8%A7%82%E6%B5%8B%E5%80%BC%E7%9A%84%E6%9C%80%E9%95%BF%E6%9C%9F%E9%99%90"><span class="toc-number">19.2.9.</span> <span class="toc-text">设置要存储在内存中的先前观测值的最长期限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-CIM-%E8%AE%BE%E7%BD%AE%E5%90%84%E7%A7%8D%E6%B5%81%E5%9B%BE%E5%B1%82%E5%B1%9E%E6%80%A7"><span class="toc-number">19.2.10.</span> <span class="toc-text">通过 CIM 设置各种流图层属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93"><span class="toc-number">20.</span> <span class="toc-text">渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%94%AF%E4%B8%80%E5%80%BC%E5%91%88%E7%8E%B0%E5%99%A8%E5%AE%9A%E4%B9%89"><span class="toc-number">20.0.1.</span> <span class="toc-text">定义唯一值呈现器定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E6%9C%80%E6%96%B0%E8%A7%82%E6%B5%8B%E5%80%BC%E8%AE%BE%E7%BD%AE%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93%E5%99%A8-1"><span class="toc-number">20.0.2.</span> <span class="toc-text">为最新观测值设置唯一值渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%85%88%E5%89%8D%E7%9A%84%E8%A7%82%E6%B5%8B%E5%80%BC%E8%AE%BE%E7%BD%AE%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">20.0.3.</span> <span class="toc-text">为先前的观测值设置唯一值渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%AE%80%E5%8D%95%E7%9A%84%E6%B8%B2%E6%9F%93%E5%99%A8%E4%BB%A5%E7%BB%98%E5%88%B6%E8%BD%A8%E8%BF%B9%E7%BA%BF"><span class="toc-number">20.0.4.</span> <span class="toc-text">设置简单的渲染器以绘制轨迹线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%85%88%E5%89%8D%E7%9A%84%E8%A7%82%E6%B5%8B%E5%80%BC%E5%92%8C%E8%BD%A8%E9%81%93%E7%BA%BF%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-number">20.0.5.</span> <span class="toc-text">检查先前的观测值和轨道线可见性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E8%BD%A8%E8%BF%B9%E7%BA%BF%E5%92%8C%E5%85%88%E5%89%8D%E7%9A%84%E8%A7%82%E6%B5%8B%E7%82%B9%E5%8F%AF%E8%A7%81"><span class="toc-number">20.0.6.</span> <span class="toc-text">使轨迹线和先前的观测点可见</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%BD%93%E5%89%8D%E8%A7%82%E6%B5%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">20.0.7.</span> <span class="toc-text">检索当前观测渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E4%B8%8A%E4%B8%80%E4%B8%AA%E8%A7%82%E6%B5%8B%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">20.0.8.</span> <span class="toc-text">检索上一个观测渲染器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E8%BD%A8%E8%BF%B9%E7%BA%BF%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-number">20.0.9.</span> <span class="toc-text">检索轨迹线渲染器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%92%8C%E6%90%9C%E7%B4%A2"><span class="toc-number">21.</span> <span class="toc-text">订阅和搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%92%8C%E8%AE%A2%E9%98%85%E6%B5%81%E6%95%B0%E6%8D%AE"><span class="toc-number">21.0.1.</span> <span class="toc-text">搜索和订阅流数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%92%8C%E8%AE%A2%E9%98%85%E5%8F%96%E6%B6%88"><span class="toc-number">21.0.2.</span> <span class="toc-text">搜索和订阅取消</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E5%BC%8F%E5%8F%96%E6%B6%88%E7%AD%89%E5%BE%85%E8%A1%8C%E5%BC%82%E6%AD%A5"><span class="toc-number">21.0.3.</span> <span class="toc-text">显式取消等待行异步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">22.</span> <span class="toc-text">实时要素类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E8%BF%9E%E6%8E%A5%E5%88%B0%E5%AE%9E%E6%97%B6%E8%A6%81%E7%B4%A0%E7%B1%BB"><span class="toc-number">22.0.1.</span> <span class="toc-text">从实时数据存储连接到实时要素类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AE%9E%E6%97%B6%E8%A6%81%E7%B4%A0%E7%B1%BB%E6%98%AF%E5%90%A6%E5%8F%AF%E8%AF%86%E5%88%AB%E8%BD%A8%E8%BF%B9"><span class="toc-number">22.0.2.</span> <span class="toc-text">检查实时要素类是否可识别轨迹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%9E%E6%97%B6%E8%A6%81%E7%B4%A0%E7%B1%BB%E8%8E%B7%E5%8F%96%E8%BF%BD%E8%B8%AA-ID-%E5%AD%97%E6%AE%B5"><span class="toc-number">22.0.3.</span> <span class="toc-text">从实时要素类获取追踪 ID 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E6%B5%81%E6%95%B0%E6%8D%AE"><span class="toc-number">22.0.4.</span> <span class="toc-text">订阅流数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%8E%B0%E6%9C%89%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%AE%A2%E9%98%85%E6%B5%81%E6%95%B0%E6%8D%AE"><span class="toc-number">22.0.5.</span> <span class="toc-text">搜索现有数据并订阅流数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%92%8C%E8%AE%A2%E9%98%85%E5%8F%96%E6%B6%88-1"><span class="toc-number">22.0.6.</span> <span class="toc-text">搜索和订阅取消</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">23.</span> <span class="toc-text">任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E4%BB%BB%E5%8A%A1%E9%A1%B9"><span class="toc-number">23.0.1.</span> <span class="toc-text">检索项目中的所有任务项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E4%BB%BB%E5%8A%A1%E6%96%87%E4%BB%B6-esriTasks-%E6%96%87%E4%BB%B6"><span class="toc-number">23.0.2.</span> <span class="toc-text">打开任务文件 - .esriTasks 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E9%A1%B9%E7%9B%AE%E4%BB%BB%E5%8A%A1%E9%A1%B9"><span class="toc-number">23.0.3.</span> <span class="toc-text">打开项目任务项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E4%BB%BB%E5%8A%A1%E9%A1%B9"><span class="toc-number">23.0.4.</span> <span class="toc-text">关闭任务项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E4%BB%BB%E5%8A%A1%E9%A1%B9"><span class="toc-number">23.0.5.</span> <span class="toc-text">导出任务项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BB%BB%E5%8A%A1%E4%BF%A1%E6%81%AF-%E4%BB%8E%E4%BB%BB%E5%8A%A1%E9%A1%B9%E7%9B%AE%E9%A1%B9"><span class="toc-number">23.0.6.</span> <span class="toc-text">获取任务信息 - 从任务项目项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BB%BB%E5%8A%A1%E4%BF%A1%E6%81%AF-%E4%BB%8E-esriTasks-%E6%96%87%E4%BB%B6"><span class="toc-number">23.0.7.</span> <span class="toc-text">获取任务信息 - 从 .esriTasks 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%BB%BB%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%AD%E6%89%93%E5%BC%80%E7%89%B9%E5%AE%9A%E4%BB%BB%E5%8A%A1-esriTasks-%E6%96%87%E4%BB%B6"><span class="toc-number">23.0.8.</span> <span class="toc-text">在任务文件中打开特定任务 - .esriTasks 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E4%BB%BB%E5%8A%A1%E4%BA%8B%E4%BB%B6"><span class="toc-number">23.0.9.</span> <span class="toc-text">订阅任务事件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">24.</span> <span class="toc-text">工作流管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%AE%A1%E7%90%86%E5%99%A8%E5%AF%B9%E8%B1%A1"><span class="toc-number">24.0.1.</span> <span class="toc-text">如何获取管理器对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84"><span class="toc-number">24.0.2.</span> <span class="toc-text">如何获取群组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7"><span class="toc-number">24.0.3.</span> <span class="toc-text">如何获取用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%BD%9C%E4%B8%9A%E7%B1%BB%E5%9E%8B"><span class="toc-number">24.0.4.</span> <span class="toc-text">如何获取作业类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%BD%9C%E4%B8%9A"><span class="toc-number">24.0.5.</span> <span class="toc-text">如何创建作业</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E5%B7%A5%E4%BD%9C"><span class="toc-number">24.0.6.</span> <span class="toc-text">如何找到工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%9C%B0%E5%9B%BE%E5%85%B3%E8%81%94%E7%9A%84%E4%BD%9C%E4%B8%9A"><span class="toc-number">24.0.7.</span> <span class="toc-text">如何获取与地图关联的作业</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%E4%BD%9C%E4%B8%9A"><span class="toc-number">24.0.8.</span> <span class="toc-text">如何关闭作业</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%BF%E9%97%AE%E5%92%8C%E6%9B%B4%E6%94%B9%E5%B7%A5%E4%BD%9C%E4%BF%A1%E6%81%AF"><span class="toc-number">24.0.9.</span> <span class="toc-text">如何访问和更改工作信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E4%BD%9C%E4%B8%9A%E4%B8%8A%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="toc-number">24.0.10.</span> <span class="toc-text">如何在作业上执行步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">24.0.11.</span> <span class="toc-text">如何执行查询</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://shaoshao.net.cn/images/blog/cover/current/post_08.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By shaozhy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img class="icp-icon" src="/img/icp.png"><span>冀ICP备2023009991号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'd990e8cbbd1dabc9c98e',
      clientSecret: '59676d5926f4df676ec1ba6b36395bf90a0aeb54',
      repo: 'WineMonk.github.io',
      owner: 'WineMonk',
      admin: ['WineMonk'],
      id: '543753e3ad4c643a29428b784b56e929',
      updateCountCallback: commentCount
    },{"proxy":"https://vercel.prohibitorum.top/github_access_token"}))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="茶飘香,酒罢去,聚朋友,再回楼" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>